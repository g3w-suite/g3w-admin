!function e(t,i,r){function o(a,s){if(!i[a]){if(!t[a]){var l="function"==typeof require&&require;if(!s&&l)return l(a,!0);if(n)return n(a,!0);var c=new Error("Cannot find module '"+a+"'");throw c.code="MODULE_NOT_FOUND",c}var u=i[a]={exports:{}};t[a][0].call(u.exports,function(e){var i=t[a][1][e];return o(i?i:e)},u,u.exports,e,t,i,r)}return i[a].exports}for(var n="function"==typeof require&&require,a=0;a<r.length;a++)o(r[a]);return o}({1:[function(e,t,i){var r="G3W Client",o={},n={tools:[]},a={resources:e("./locales/app.js")},s={debug:!0,local:!1},l={urls:{baseurl:"/",ows:"ows",api:"api",initconfig:"api/initconfig",config:"api/config"}};t.exports={apptitle:r,client:s,server:l,plugins:o,tools:n,i18n:a}},{"./locales/app.js":2}],2:[function(e,t,i){var r={it:{translation:{component:"Componente Generico",search:"Ricerche",print:"Stampa",dosearch:"Cerca",catalog:"Mappa",baselayers:"Basi",tools:"Strumenti",tree:"Strati",legend:"Legenda",street_search:"Cerca indirizzo",show:"Mostra",hide:"Nascondi",street_search:"Cerca indirizzo",copy_form_data:"Copia i dati del modulo",paste_form_data:"Incolla",copy_form_data_from_feature:"Copia i dati dalla mappa",could_not_load_vector_layers:"Errore di connessione al server: non è stato possibile caricare i vettoriali richiesti"}}};t.exports=r},{}],3:[function(e,t,i){function r(){return{apptitle:c.apptitle||"",logo_img:c.group.header_logo_img,logo_link:c.group.header_logo_link,terms_of_use_text:c.group.header_terms_of_use_text,terms_of_use_link:c.group.terms_of_use_link,debug:c.client.debug||!1,group:c.group,urls:c.server.urls,mediaurl:c.server.urls.mediaurl,resourcesurl:c.server.urls.clienturl,projects:c.group.projects,initproject:c.group.initproject,overviewproject:c.group.overviewproject&&c.group.overviewproject.gid?c.group.overviewproject:null,baselayers:c.group.baselayers,mapcontrols:c.group.mapcontrols,background_color:c.group.background_color,crs:c.group.crs,proj4:c.group.proj4,minscale:c.group.minscale,maxscale:c.group.maxscale,getWmsUrl:function(e){return c.server.urls.baseurl+c.server.urls.ows+"/"+c.group.id+"/"+e.type+"/"+e.id},getProjectConfigUrl:function(e){return c.server.urls.baseurl+c.server.urls.config+"/"+c.group.id+"/"+e.type+"/"+e.id},plugins:c.group.plugins,tools:c.tools,views:c.views||{},user:c.user||null}}function o(){var t=e("sdk").gui.vue.CatalogComponent,i=e("sdk").gui.vue.SearchComponent,r=e("sdk").gui.vue.PrintComponent,o=e("sdk").gui.vue.ToolsComponent,n=e("sdk").gui.vue.MapComponent,a=e("./template/js/contentsviewer"),s=e("sdk").gui.vue.QueryResultsComponent;return{title:c.apptitle,placeholders:{navbar:{components:[]},sidebar:{components:[new r({id:"print",open:!1,collapsible:!0,icon:"fa fa-print"}),new i({id:"search",open:!1,collapsible:!0,icon:"fa fa-search"}),new t({id:"catalog",open:!1,collapsible:!1,icon:"fa fa-map-o"}),new o({id:"tools",open:!1,collapsible:!0,icon:"fa fa-gears"})]},floatbar:{components:[]}},othercomponents:[new s({id:"queryresults"})],viewport:{components:{map:new n({id:"map"}),content:new a({id:"contents"})}}}}function n(e,t){t=t&&t.responseJSON&&t.responseJSON.error.data?t.responseJSON.error.data:"Errore di connessione",l.fail(e,t)}var a=e("sdk").core.i18n.init,s=e("sdk/sdk").core.ApplicationService,l=e("./template/js/template"),c=e("./config/config.js");window.g3wsdk=e("sdk"),a(c.i18n),s.on("ready",function(){var e=o();applicationTemplate=new l(e,this),applicationTemplate.init(),applicationTemplate.on("ready",function(){s.postBootstrap()})});var u=function(){s.obtainInitConfig(c.server.urls.initconfig).then(function(e){c.server.urls.baseurl=e.baseurl,c.server.urls.staticurl=e.staticurl,c.server.urls.clienturl=e.staticurl+e.client,c.server.urls.mediaurl=e.mediaurl,c.group=e.group,c.user=e.user;var t=r();s.init(t,!0).then(function(){}).fail(function(e){n(u,e)})}).fail(function(e){n(u,e)})};u()},{"./config/config.js":1,"./template/js/contentsviewer":13,"./template/js/template":19,sdk:175,"sdk/sdk":175}],4:[function(e,t,i){t.exports='<div class="wrapper">\n  <header class="main-header">\n    <!-- Logo -->\n    <!-- Header Navbar: style can be found in header.less -->\n    <nav class="navbar navbar-static-top" role="navigation">\n      <!-- Toggle button on navbar only for mobile -->\n      <a v-if="isMobile()" href="#" class="sidebar-toggle" data-toggle="offcanvas" role="button">\n        <span class="sr-only">Expand</span>\n      </a>\n      <div class="logo-wrapper">\n        <a v-if="logo_url" :href="logo_link" :target="logo_link_target" class=""><img :src="logo_url" style="height:40px"></a>\n        <span class="">{{project_title}}</span>\n      </div>\n      <div v-if="user" class="navbar-custom-menu">\n        <ul class="nav navbar-nav">\n          <li class="dropdown user" v-if="numberOfProjectsInGroup > 1">\n            <a href="#" @click="openProjectsMenu" class="dropdown-toggle" data-toggle="dropdown">\n              <i class="fa fa-th" aria-hidden="true"></i>\n              <span> Cambia Mappa</span>\n            </a>\n          </li>\n          <li class="dropdown user user-menu">\n            <a href="#" class="dropdown-toggle" data-toggle="dropdown">\n              <i class="fa fa-user"></i>\n              <span class="hidden-xs">{{ user.username }}</span>\n            </a>\n            <ul class="dropdown-menu">\n              <li class="user-header">\n                <p>\n                  {{ user.first_name }} {{ user.last_name }}\n                </p>\n              </li>\n              <li class="user-footer">\n                <div class="pull-left">\n                  <a :href="user.admin_url" class="btn btn-default btn-flat"><i class="fa fa-folder"></i> Admin</a>\n                </div>\n                <div class="pull-right">\n                  <a :href="user.logout_url" class="btn btn-default btn-flat"><i class="fa fa-sign-out"></i>Sign out</a>\n                </div>\n              </li>\n            </ul>\n          </li>\n          <li class="dropdown user user-menu">\n            <a href="#" data-toggle="modal" data-target="#credits" class="dropdown-toggle">\n              <span>Credits</span>\n            </a>\n          </li>\n        </ul>\n      </div>\n    </nav>\n  </header>\n  <!-- Left side column. contains the logo and sidebar -->\n  <sidebar></sidebar>\n  <!-- Content Wrapper. Contains page content -->\n  <div class="content-wrapper" style="background-color:white">\n    <viewport></viewport>\n  </div>\n  <!-- /.content-wrapper -->\n  <!-- Control Sidebar -->\n  <floatbar></floatbar>\n  <!-- /.control-sidebar -->\n  <!-- Add the sidebar\'s background. This div must be placed\n       immediately after the control sidebar -->\n  <div class="control-sidebar-bg"></div>\n  <!--full screen modal element-->\n  <div class="modal fade modal-fullscreen force-fullscreen" id="full-screen-modal" tabindex="-1" role="dialog" data-backdrop="static" data-keyboard="false" aria-labelledby="full-screen-modal" aria-hidden="true"></div>\n  <!---->\n  <div id="credits" class="modal fade">\n    <div class="modal-dialog" role="document">\n      <div class="modal-content">\n        <div class="modal-header">\n          <button type="button" class="close" data-dismiss="modal" aria-label="Close">\n            <span aria-hidden="true">&times;</span>\n          </button>\n          <a style="text-align: center!important;" href="http://www.gis3w.it" target="_blank">\n            <img src="http://gis3w.it/wp-content/uploads/sites/7/2017/01/logo_gis3w_156_85.png?x22227" class="img-responsive center-block" alt="">\n            <div style="text-align: center!important; margin-bottom:50px; margin-top:20px; color:#000000">\n              <h4>GIS3W s.n.c.</h4>\n            </div>\n          </a>\n          <address id="address-credits" style="line-height: 2; text-align: center;">\n            <i class="fa fa-map-marker" aria-hidden="true"></i>\n            <span> Viale Verdi, 24 - Montecatini Terme (PT)</span></br>\n            <i class="fa fa-mobile" aria-hidden="true"></i>\n            <span> +39 347 6597931</span></br>\n            <i class="fa fa-fax" aria-hidden="true"></i>\n            <span> +39 0572 901639</span></br>\n            <i class="fa fa-envelope" aria-hidden="true">\n            </i>\n            <span><a href="mailto:info@gis3w.it" style="color:#000000"> info@gis3w.it</a></span>\n          </address>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n'},{}],5:[function(e,t,i){t.exports='<div id="contents" class="contents"></div>\n'},{}],6:[function(e,t,i){t.exports='<aside class="control-sidebar control-sidebar-light" >\n  <a v-show="panelsinstack" href="#" class="floatbar-aside-toggle" data-toggle="control-sidebar" role="button">\n    <span class="sr-only">Expand</span>\n  </a>\n  <div id="floatbar-spinner" style="position:absolute"></div>\n  <div v-show="panelsinstack" class="g3w-sidebarpanel">\n    <div v-if="closable" class="row">\n      <div class="col-xs-12 col-sm-12 col-md-12">\n        <button class="glyphicon glyphicon-remove pull-right close-panel-button" @click="closePanel"></button>\n      </div>\n    </div>\n    <div v-if="panelname">\n      <h4 class="g3w-floatbarpanel-name">{{ panelname }}</h4>\n    </div>\n    <div id="g3w-floatbarpanel-placeholder" class="g3w-floatbarpanel-placeholder"></div>\n  </div>\n</aside>\n'},{}],7:[function(e,t,i){t.exports='<div id="menu-projects" class="container nano">\n  <div v-show="loading" class="bar-loader"></div>\n  <div class="nano-content">\n    <div class="row row-equal">\n      <!-- item -->\n      <div v-for="menuitem in state.menuitems"  @click="trigger(menuitem)" class="col-xs-12 col-sm-4 project-menu">\n        <div class="project-menu-item-image">\n          <img :src="logoSrc(menuitem.thumbnail)" class="img-responsive">\n        </div>\n        <div class="project-menu-item-content">\n          <div class="project-menu-item-text">\n            <h4 class="project-menu-item-title">{{ menuitem.title }}</h4>\n            <div v-html="menuitem.description"></div>\n          </div>\n        </div>\n      </div>\n      <div v-if="!state.menuitems.length" style="margin-left:15px;">\n        <h2>Non ci sono altri progetti in questo gruppo cartografico</h2>\n      </div>\n    </div>\n  </div>\n</div>\n'},{}],8:[function(e,t,i){t.exports='<li  v-show="state.visible" class="treeview sidebaritem" :class="{\'active\': open}">\n  <a @click="onClickItem" href="#">\n    <i :class="icon"></i>\n    <span class="treeview-label">{{title | t}}</span>\n    <i class="fa fa-angle-left pull-right"></i>\n  </a>\n  <div id="g3w-sidebarcomponent-placeholder"></div>\n</li>\n'},{}],9:[function(e,t,i){t.exports='<aside class="main-sidebar">\n  <!-- sidebar: style can be found in sidebar.less -->\n  <!-- Sidebar toggle button-->\n  <!-- Toggle button on the left side of main sidebar only if not mobile -->\n  <a v-if="!isMobile()" href="#" class="sidebar-aside-toggle" data-toggle="offcanvas" role="button">\n    <span class="sr-only">Expand</span>\n  </a>\n  <!--<div class="quick-actions-menu">-->\n    <!--<button class="btn btn-default btn-circle-medium glyphicon glyphicon-share-alt"></button>-->\n    <!--<button class="btn btn-default btn-circle-medium glyphicon glyphicon-modal-window"></button>-->\n    <!--<button class="btn btn-default btn-circle-medium glyphicon glyphicon-print"></button>-->\n    <!--<button class="btn btn-default btn-circle-medium glyphicon glyphicon-search"></button>-->\n  <!--</div>-->\n\t<section class="sidebar">\n    <div v-show="panelsinstack" class="g3w-sidebarpanel">\n      <div style="overflow: hidden;line-height: 14px;margin-top: 4px; font-size:1.5em">\n          <button class="glyphicon glyphicon-remove pull-right close-panel-button" @click="closePanel"></button>\n      </div>\n      <div id="g3w-sidebarpanel-placeholder" class="g3w-sidebarpanel-placeholder"></div>\n    </div>\n\t  <ul id="g3w-sidebarcomponents" v-show="showmainpanel" class="sidebar-menu"></ul>\n\t</section>\n\t<!-- /.sidebar -->\n</aside>\n'},{}],10:[function(e,t,i){t.exports='<div class="g3w-viewport">\n  <div id="g3w-view-map" class="g3w-view map" :style="{width:state.map.sizes.width+\'px\',height:state.map.sizes.height+\'px\'}">\n  </div>\n  <div id="g3w-view-content" class="g3w-view content" :style="{width:state.content.sizes.width+\'px\',height:state.content.sizes.height+\'px\'}">\n    <div v-if="(showtitle && contentTitle) || previousTitle || (state.content.closable && state.content.aside)" class="close-panel-block">\n      <div v-if="previousTitle" class="g3w_contents_back">\n        <span  @click="gotoPreviousContent()"><span class="glyphicon glyphicon-chevron-left"></span> Torna {{ previousTitle }}</span>\n      </div>\n      <button v-if="state.content.closable && state.content.aside" class="glyphicon glyphicon-remove pull-right close-panel-button" @click="closeContent"></button>\n      <div v-if="showtitle && contentTitle">\n        <span>{{ contentTitle }}</span>\n      </div>\n    </div>\n  </div>\n</div>\n'},{}],11:[function(e,t,i){var r=e("core/applicationservice"),o=e("core/project/projectsregistry"),n=e("./projectsmenu"),a=e("sdk/gui/gui"),s=e("./layout"),l=Vue.extend({template:e("../html/app.html"),mounted:function(){this.$nextTick(function(){function e(){$(i).css("max-height",$(window).innerHeight()),$(".g3w-sidebarpanel").css("height",$(window).height()-$(".main-header").height())}function t(){$("#g3w-modal-overlay").css("height",$(window).height())}s.loading(!1),s.setup(),s.pushMenu.expandOnHover(),s.controlSidebar._fix($(".control-sidebar-bg")),s.controlSidebar._fix($(".control-sidebar"));var i=s.options.controlSidebarOptions.selector;e(),$(window).resize(function(){e(),t()})})},computed:{logo_url:function(){var e,t=r.getConfig();return t.logo_img&&""!=t.logo_img&&(e=t.mediaurl+t.logo_img),e},logo_link:function(){var e=this.getLogoLink();return e?e:"#"},logo_link_target:function(){var e=this.getLogoLink();return e?"_blank":""},project_title:function(){var e=o.getCurrentProject();return e.state.name},user:function(){var e=r.getConfig().user;return _.isEmpty(e)&&(e=null),e},numberOfProjectsInGroup:function(){return o.getProjects().length}},methods:{closePanel:function(){sidebarService.closePanel()},isMobile:function(){return isMobile.any},getLogoLink:function(){var e=null;return r.getConfig().logo_link&&(e=r.getConfig().logo_link),e},openProjectsMenu:function(){var e=a.getComponent("contents");e.getComponentById("projectsmenu")?a.closeContent():a.setContent({content:new n,title:"",perc:100})}}});t.exports=l},{"../html/app.html":4,"./layout":15,"./projectsmenu":17,"core/applicationservice":22,"core/project/projectsregistry":76,"sdk/gui/gui":135}],12:[function(e,t,i){function r(){this._parent=null,this.state={contentsdata:[]}}var o=e("sdk/core/utils/utils"),n=e("sdk/core/utils/utils").inherit,a=e("sdk/core/g3wobject"),s=e("gui/vue/component"),l=e("gui/panel");n(r,a);var c=r.prototype;c.push=function(e,t){return this._parent=t.parent,this._mount(e,t)},c.pop=function(){var e=this,t=$.Deferred();if(this.state.contentsdata.length){var i=this.state.contentsdata.slice(-1)[0].content;return this._unmount(i).then(function(){e.state.contentsdata.pop()})}return t.resolve(),t.promise()},c.clear=function(){var e=this,t=$.Deferred();if(this.state.contentsdata.length){var i=[];_.forEach(this.state.contentsdata,function(t,r){i.push(e._unmount(t.content))}),$.when(i).then(function(){e.state.contentsdata.splice(0,e.state.contentsdata.length),t.resolve()})}else t.resolve();return t.promise()},c.getContentData=function(){return this.state.contentsdata},c.getCurrentContentData=function(){return this.state.contentsdata[this.state.contentsdata.length-1]},c.getPreviousContentData=function(){return this.state.contentsdata[this.state.contentsdata.length-2]},c._mount=function(e,t){if(e instanceof jQuery)return this._setJqueryContent(e);if(_.isString(e)){var i=$(e);return i.length||(i=$("<div>"+e+"</div>")),this._setJqueryContent(i)}return e.mount&&"function"==typeof e.mount?(this._checkDuplicateVueContent(e),this._setVueContent(e,t)):this._setDOMContent(e)},c._setJqueryContent=function(e,t){return $(this._parent).append(e),this.state.contentsdata.push({content:e,options:t}),o.resolve()},c._setDOMContent=function(e,t){return this._parent.appendChild(e),this.state.contentsdata.push({content:e,options:t}),o.resolve()},c._setVueContent=function(e,t){var i=this,r=$.Deferred(),o=t.append||!1;return e.mount(this._parent,o).then(function(){$(parent).localize(),i.state.contentsdata.push({content:e,options:t}),r.resolve()}),r.promise()},c._checkDuplicateVueContent=function(e){var t=this,i=null,r=e.getId();if(_.forEach(this.state.contentsdata,function(e,t){e.content.getId&&e.content.getId()==r&&(i=t)}),!_.isNull(i)){var o=t.state.contentsdata[i];o.content.unmount().then(function(){t.state.contentsdata.splice(i,1)})}},c._unmount=function(e){var t=$.Deferred();return e instanceof s||e instanceof l?e.unmount().then(function(){t.resolve()}):($(this._parent).empty(),t.resolve()),t.promise()},c.forEach=function(e){_.forEach(this.state.contentsdata,function(t){e(t.content)})},c.getLength=function(){return this.state.contentsdata.length},t.exports=r},{"gui/panel":144,"gui/vue/component":173,"sdk/core/g3wobject":36,"sdk/core/utils/utils":80}],13:[function(e,t,i){function r(e){n(this,e),this.stack=new a,this.setService(this),this.title="contents",this.contentsdata=this.stack.state.contentsdata,this.state.visible=!0,this.setInternalComponent(new l({service:this})),this.internalComponent.state=this.state}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("./barstack.js"),s=e("gui/vue/component"),l=Vue.extend({template:e("../html/contentsviewer.html"),data:function(){return{state:null}}});o(r,s);var c=r.prototype;c.setContent=function(e){var t=this,i=$.Deferred(),r=e.push||!1,o=e.content;return r?this.addContent(o,e).then(function(){i.resolve()}):this.clearContents().then(function(){t.addContent(o,e).then(function(){i.resolve()})}),this.setOpen(!0),i.promise()},c.addContent=function(e,t){var i=this;return t.parent=this.internalComponent.$el,t.append=!0,this.stack.push(e,t).then(function(){i.contentsdata=i.stack.state.contentsdata,i.updateContentVisibility()})},c.removeContent=function(){return this.setOpen(!1),this.clearContents()},c.popContent=function(){var e=this;return this.stack.pop().then(function(){e.contentsdata=e.stack.state.contentsdata,e.updateContentVisibility()})},c.getComponentByClass=function(e){var t,i=this.stack.getContentData();return _.forEach(i,function(i){if(i.content instanceof e)return t=i.content,!1}),t},c.getComponentById=function(e){var t,i=this.stack.getContentData();return _.forEach(i,function(i){if(i.content.id==e)return t=i.content,!1}),t},c.getContentData=function(){return this.stack.getContentData()},c.getCurrentContentData=function(){return this.stack.getCurrentContentData()},c.getPreviousContentData=function(){return this.stack.getPreviousContentData()},c.updateContentVisibility=function(){var e=$(this.internalComponent.$el).children();e.hide(),e.last().show()},c.clearContents=function(){var e=this;return this.stack.clear().then(function(){e.contentsdata=e.stack.state.contentsdata})},c.layout=function(e,t){var i=this,r=$(this.internalComponent.$el);Vue.nextTick(function(){var t=r.parent().height()-r.siblings(".close-panel-block").outerHeight(!0)-r.siblings(".g3w_contents_back").outerHeight(!0);r.height(t),r.children().first().height(t);var o=i.stack.state.contentsdata;o.forEach(function(i){"function"==typeof i.content.layout&&i.content.layout(e,t)})})},t.exports=r},{"../html/contentsviewer.html":5,"./barstack.js":12,"core/utils/utils":80,"gui/vue/component":173}],14:[function(e,t,i){function r(){this.stack=new o,this.init=function(e){this.layout=e,this.sidebarEl=$(this.layout.options.controlSidebarOptions.selector),this._zindex=this.sidebarEl.css("z-index"),this._modalOverlay=null,this._modal=!1,this._isopen=!1},this.isOpen=function(){return this._isopen},this.open=function(){this.layout.floatBar.open(this.sidebarEl,!0),this._isopen=!0},this.close=function(){this.layout.floatBar.close(this.sidebarEl,!0),this._isopen=!1},this.showPanel=function(e,t){var t=t||{};t.append||!1,t.modal||!1;t.parent="#g3w-floatbarpanel-placeholder",this.stack.push(e,t),this._isopen||this.open()},this.closePanel=function(e){e?this.stack.remove(e):this.stack.pop(),this.stack.getLength()||(this._modal?(n.setModal(!1),this.close(),$(".control-sidebar-bg").toggleClass("control-sidebar-bg-shadow"),this.sidebarEl.css("z-index",""),this.sidebarEl.css("padding-top","50px"),$(".control-sidebar-bg").css("z-index",""),this._modal=!1):this.close())},this.hidePanel=function(){this.close()}}var o=(e("sdk/core/i18n/i18n.service").t,e("./barstack.js")),n=e("sdk/gui/gui"),a=new r,s=Vue.extend({template:e("../html/floatbar.html"),data:function(){return{stack:a.stack.state}},computed:{panelsinstack:function(){return this.stack.contentsdata.length>0},panelname:function(){var e;return this.stack.contentsdata.length&&(e=this.stack.contentsdata.slice(-1)[0].content.getTitle()),e},closable:function(){return a.closable}},watch:{"stack.contentsdata":function(){var e=$("#g3w-floatbarpanel-placeholder").children();_.forEach(e,function(t,i){i==e.length-1?$(t).show():$(t).hide()})}},methods:{closePanel:function(){a.closePanel()}}});t.exports={FloatbarService:a,FloatbarComponent:s}},{"../html/floatbar.html":6,"./barstack.js":12,"sdk/core/i18n/i18n.service":39,"sdk/gui/gui":135}],15:[function(e,t,i){if("undefined"==typeof jQuery)throw new Error("LayoutManager requires jQuery");$.LayoutManager={},$.LayoutManager.options={navbarMenuSlimscroll:!0,navbarMenuSlimscrollWidth:"0px",navbarMenuHeight:"200px",animationSpeed:"fast",sidebarToggleSelector:"[data-toggle='offcanvas']",sidebarPushMenu:!0,sidebarSlimScroll:!0,sidebarExpandOnHover:!1,enableBoxRefresh:!0,enableBSToppltip:!0,BSTooltipSelector:"[data-toggle='tooltip']",enableFastclick:!0,enableControlSidebar:!0,controlSidebarOptions:{toggleBtnSelector:"[data-toggle='control-sidebar']",selector:".control-sidebar",slide:!0},enableBoxWidget:!0,boxWidgetOptions:{boxWidgetIcons:{collapse:"fa-minus",open:"fa-plus",remove:"fa-times"},boxWidgetSelectors:{remove:'[data-widget="remove"]',collapse:'[data-widget="collapse"]'}},directChat:{enable:!0,contactToggleSelector:'[data-widget="chat-pane-toggle"]'},colors:{lightBlue:"#3c8dbc",red:"#f56954",green:"#00a65a",aqua:"#00c0ef",yellow:"#f39c12",blue:"#0073b7",navy:"#001F3F",teal:"#39CCCC",olive:"#3D9970",lime:"#01FF70",orange:"#FF851B",fuchsia:"#F012BE",purple:"#8E24AA",maroon:"#D81B60",black:"#222222",gray:"#d2d6de"},screenSizes:{xs:480,sm:768,md:992,lg:1200}},$.LayoutManager._init=function(){"use strict";return $.LayoutManager.layout={activate:function(){var e=this;e.fix(),e.fixSidebar(),$(window,".wrapper").resize(function(){e.fix(),e.fixSidebar()})},fix:function(){var e=$(".main-header").outerHeight()+$(".main-footer").outerHeight(),t=$(window).height(),i=$(".sidebar").height();if($("body").hasClass("fixed"))$(".content-wrapper, .right-side").css("min-height",t-$(".main-footer").outerHeight()),$(".content-wrapper, .right-side").css("height",t-$(".main-footer").outerHeight());else{var r;t>=i?($(".content-wrapper, .right-side").css("min-height",t-e),r=t-e):($(".content-wrapper, .right-side").css("min-height",i),r=i);var o=$($.LayoutManager.options.controlSidebarOptions.selector);"undefined"!=typeof o&&o.height()>r&&$(".content-wrapper, .right-side").css("min-height",o.height())}},fixSidebar:function(){return $("body").hasClass("fixed")?("undefined"==typeof $.fn.slimScroll&&window.console&&window.console.error("Error: the fixed layout requires the slimscroll plugin!"),void($.LayoutManager.options.sidebarSlimScroll?"undefined"!=typeof $.fn.slimScroll&&($(".sidebar").slimScroll({destroy:!0}).height("auto"),$(".sidebar").slimscroll({height:$(window).height()-$(".main-header").height()+"px",color:"rgba(255,255,255,0.7)",size:"3px"})):$(".sidebar").css({height:$(window).height()-$(".main-header").height()+"px"}))):void("undefined"!=typeof $.fn.slimScroll&&$(".sidebar").slimScroll({destroy:!0}).height("auto"))}},$.LayoutManager.pushMenu={activate:function(e){var t=$.LayoutManager.options.screenSizes;$(e).on("click",function(e){e.preventDefault(),$(window).width()>t.sm-1?$("body").hasClass("sidebar-collapse")?$("body").removeClass("sidebar-collapse").trigger("expanded.pushMenu"):$("body").addClass("sidebar-collapse").trigger("collapsed.pushMenu"):$("body").hasClass("sidebar-open")?$("body").removeClass("sidebar-open").removeClass("sidebar-collapse").trigger("collapsed.pushMenu"):$("body").addClass("sidebar-open").trigger("expanded.pushMenu")}),($.LayoutManager.options.sidebarExpandOnHover||$("body").hasClass("fixed")&&$("body").hasClass("sidebar-mini"))&&this.expandOnHover()},expandOnHover:function(){var e=this,t=$.LayoutManager.options.screenSizes.sm-1;$(".main-sidebar").hover(function(){$("body").hasClass("sidebar-mini")&&$("body").hasClass("sidebar-collapse")&&$(window).width()>t&&e.expand()},function(){$("body").hasClass("sidebar-mini")&&$("body").hasClass("sidebar-expanded-on-hover")&&$(window).width()>t&&e.collapse()})},expand:function(){$("body").removeClass("sidebar-collapse").addClass("sidebar-expanded-on-hover")},collapse:function(){$("body").hasClass("sidebar-expanded-on-hover")&&$("body").removeClass("sidebar-expanded-on-hover").addClass("sidebar-collapse")}},$.LayoutManager.tree=function(e){var t=this,i=$.LayoutManager.options.animationSpeed;$(document).on("click",e+" li a",function(e){var r=$(this),o=r.next();if(o.is(".treeview-menu")&&o.is(":visible"))o.slideUp(i,function(){o.parent("li.treeview").removeClass("active"),o.removeClass("menu-open")});else if(o.is(".treeview-menu")&&!o.is(":visible")){var n,a=r.parents("ul").first(),s=r.parent("li"),l=s.siblings(),c=(a.height()-a.find("li.header").outerHeight(),s.outerHeight());l.not(".header").each(function(e,t){c+=$(t).find("a").outerHeight()});var u=a.find("ul.treeview-menu:visible").slideUp(i);u.removeClass("menu-open"),o.slideDown(i,function(){o.addClass("menu-open"),n=a.find("li.treeview.active"),n.removeClass("active"),s.addClass("active"),t.layout.fix()})}o.is(".treeview-menu")&&e.preventDefault()})},$.LayoutManager.floatBar=$.LayoutManager.controlSidebar={activate:function(){var e=this,t=$.LayoutManager.options.controlSidebarOptions,i=$(t.selector),r=$(t.toggleBtnSelector);r.on("click",function(r){r.preventDefault(),i.hasClass("control-sidebar-open")||$("body").hasClass("control-sidebar-open")?e.close(i,t.slide):e.open(i,t.slide)});var o=$(".control-sidebar-bg");e._fix(o),$("body").hasClass("fixed")?e._fixForFixed(i):$(".content-wrapper, .right-side").height()<i.height()&&e._fixForContent(i)},open:function(e,t){t?e.addClass("control-sidebar-open"):$("body").addClass("control-sidebar-open")},close:function(e,t){t?e.removeClass("control-sidebar-open"):$("body").removeClass("control-sidebar-open")},_fix:function(e){var t=this;$("body").hasClass("layout-boxed")?(e.css("position","absolute"),e.height($(".wrapper").height()),$(window).resize(function(){t._fix(e)})):e.css({position:"fixed",height:"auto"})},_fixForFixed:function(e){e.css({position:"fixed","max-height":"100%","padding-bottom":"50px"})},_fixForContent:function(e){$(".content-wrapper, .right-side").css("min-height",e.height())}},$.LayoutManager.boxWidget={selectors:$.LayoutManager.options.boxWidgetOptions.boxWidgetSelectors,icons:$.LayoutManager.options.boxWidgetOptions.boxWidgetIcons,animationSpeed:$.LayoutManager.options.animationSpeed,activate:function(e){var t=this;e||(e=document),$(e).on("click",t.selectors.collapse,function(e){e.preventDefault(),t.collapse($(this))}),$(e).on("click",t.selectors.remove,function(e){e.preventDefault(),t.remove($(this))})},collapse:function(e){var t=this,i=e.parents(".box").first(),r=i.find("> .box-body, > .box-footer, > form  >.box-body, > form > .box-footer");i.hasClass("collapsed-box")?(e.find(".btn-collapser").removeClass(t.icons.open).addClass(t.icons.collapse),r.slideDown(t.animationSpeed,function(){i.removeClass("collapsed-box")})):(e.find(".btn-collapser").removeClass(t.icons.collapse).addClass(t.icons.open),r.slideUp(t.animationSpeed,function(){i.addClass("collapsed-box")}))},remove:function(e){var t=e.parents(".box").first();t.slideUp(this.animationSpeed)}},$.LayoutManager},$.LayoutManager.addRefreshButton=function(){"use strict";return $.fn.boxRefresh=function(e){function t(e){e.append(o),r.onLoadStart.call(e)}function i(e){e.find(o).remove(),r.onLoadDone.call(e)}var r=$.extend({trigger:".refresh-btn",source:"",onLoadStart:function(e){return e},onLoadDone:function(e){return e}},e),o=$('<div class="overlay"><div class="fa fa-refresh fa-spin"></div></div>');return this.each(function(){if(""===r.source)return void(window.console&&window.console.log("Please specify a source first - boxRefresh()"));var e=$(this),o=e.find(r.trigger).first();o.on("click",function(o){o.preventDefault(),t(e),e.find(".box-body").load(r.source,function(){i(e)})})})},$.LayoutManager},$.LayoutManager.activateBox=function(){"use strict";return $.fn.activateBox=function(){$.LayoutManager.boxWidget.activate(this)},$.LayoutManager},$.LayoutManager.listCustomPlugin=function(){"use strict";return $.fn.todolist=function(e){var t=$.extend({onCheck:function(e){return e},onUncheck:function(e){return e}},e);return this.each(function(){"undefined"!=typeof $.fn.iCheck?($("input",this).on("ifChecked",function(){var e=$(this).parents("li").first();e.toggleClass("done"),t.onCheck.call(e)}),$("input",this).on("ifUnchecked",function(){var e=$(this).parents("li").first();e.toggleClass("done"),t.onUncheck.call(e)})):$("input",this).on("change",function(){var e=$(this).parents("li").first();e.toggleClass("done"),$("input",e).is(":checked")?t.onCheck.call(e):t.onUncheck.call(e)})})},$.LayoutManager},$.LayoutManager.setup=function(){"use strict";$("body").removeClass("hold-transition"),"undefined"!=typeof LayoutManagerOptions&&$.extend(!0,$.LayoutManager.options,LayoutManagerOptions);var e=$.LayoutManager.options;return $.LayoutManager._init(),$.LayoutManager.layout.activate(),$.LayoutManager.tree(".sidebar"),e.enableControlSidebar&&$.LayoutManager.controlSidebar.activate(),e.navbarMenuSlimscroll&&"undefined"!=typeof $.fn.slimscroll&&$(".navbar .menu").slimscroll({height:e.navbarMenuHeight,alwaysVisible:!1,size:e.navbarMenuSlimscrollWidth}).css("width","100%"),e.sidebarPushMenu&&$.LayoutManager.pushMenu.activate(e.sidebarToggleSelector),e.enableBSToppltip&&$("body").tooltip({selector:e.BSTooltipSelector}),e.enableBoxWidget&&$.LayoutManager.boxWidget.activate(),e.enableFastclick&&"undefined"!=typeof FastClick&&FastClick.attach(document.body),e.directChat.enable&&$(document).on("click",e.directChat.contactToggleSelector,function(){var e=$(this).parents(".direct-chat").first();e.toggleClass("direct-chat-contacts-open")}),$('.btn-group[data-toggle="btn-toggle"]').each(function(){var e=$(this);$(this).find(".btn").on("click",function(t){e.find(".btn.active").removeClass("active"),$(this).addClass("active"),t.preventDefault()})}),$.LayoutManager.addRefreshButton().activateBox().listCustomPlugin()},$.LayoutManager.loading=function(e){$("#initerror").remove();var e=!_.isBoolean(e)||e;e?$("body").append('<div id="loadspinner" class="loading"></div>'):$("#loadspinner").remove()},$.LayoutManager.reload=function(e){$("body").append('<div id="initerror"><h2>Oops!!! Si è verificato un errore</h2><h4>Causa:  '+e+'</h4><h5>Al momento non è possibile caricare la mappa</h5><button id="reload" type="button" class="btn btn-primary center-block" onclick="$.LayoutManager.loading();$.LayoutManager.bootstrap()"><span class="glyphicon glyphicon-refresh"></span> <strong>Riprova</strong></button></div>')},t.exports=$.LayoutManager},{}],16:[function(e,t,i){function r(e){e=e||{},n(this,e),this.title=e.title||"menu",this.state.visible=!0,this.state.menuitems=e.menuitems,a(this,e),this.internalComponent=new u({service:this
}),this.internalComponent.state=this.state}var o=(e("core/i18n/i18n.service").t,e("core/utils/utils").inherit),n=e("core/utils/utils").base,a=e("core/utils/utils").merge,s=e("gui/vue/component"),l=e("gui/gui"),c=e("core/project/projectsregistry"),u=Vue.extend({template:e("../html/menu.html"),data:function(){return{state:null,loading:!1}},methods:{trigger:function(e){var t=this;e.cbk?($("#full-screen-modal").modal("show"),this.loading=!0,e.cbk.apply(e).then(function(){t.loading=!1,$("#full-screen-modal").modal("hide")}).fail(function(){l.notify.error("<h4>Errore di caricamento della nuova mappa.</h4><h5>Controllare la connessione internet o contattare l'amministratore</h5>"),$("#full-screen-modal").modal("hide"),t.loading=!1})):e.href?window.open(e.href,"_blank"):e.route?l["goto"](e.route):console.log("Nessuna azione per "+e.title)},logoSrc:function(e){return e.indexOf("./")>-1?c.config.mediaurl+e:e}},mounted:function(){Vue.nextTick(function(){$("#menu-projects.nano").nanoScroller()})}});o(r,s);var p=r.prototype;p.trigger=function(e){},t.exports=r},{"../html/menu.html":7,"core/i18n/i18n.service":39,"core/project/projectsregistry":76,"core/utils/utils":80,"gui/gui":135,"gui/vue/component":173}],17:[function(e,t,i){function r(e){e=e||{},e.id="projectsmenu",n(this,e);var t=[],i=a.getListableProjects();_.forEach(i,function(e){t.push({title:e.title,description:e.description,thumbnail:e.thumbnail,cbk:function(){var t,i=$.Deferred();return a.getProject(e.gid).then(function(e){u.closeContent().then(function(){t=e;var r=window.location.href,o=r.split("/");o[o.length-1]?(o[o.length-1]=e.getId(),o[o.length-2]=e.getType()):(o[o.length-2]=e.getId(),o[o.length-3]=e.getType()),history.pushState(null,null,o.join("/")),s.reloadPlugins(e),a.setCurrentProject(t),c.reloadComponents(),i.resolve()})}).fail(function(){i.reject()}),i.promise()}})}),this.state.menuitems=t}var o=(e("core/i18n/i18n.service").t,e("core/utils/utils").inherit),n=e("core/utils/utils").base,a=e("core/project/projectsregistry"),s=e("core/plugin/pluginsregistry"),l=e("./menu"),c=e("./sidebar").SidebarService,u=e("sdk").gui.GUI;o(r,l),t.exports=r},{"./menu":16,"./sidebar":18,"core/i18n/i18n.service":39,"core/plugin/pluginsregistry":71,"core/project/projectsregistry":76,"core/utils/utils":80,sdk:175}],18:[function(e,t,i){function r(){this.stack=new a,this.setters={closeSidebarPanel:function(){},openCloseItem:function(e){}},this.state={components:[]},this.init=function(e){this.layout=e},this.addComponents=function(e){var t=this;return _.forEach(e,function(e){t.addComponent(e)}),!0},this.addComponent=function(e,t){var i=new c({service:this});i.title=e.title||i.title,i.open=e.state.open,i.icon=e.icon||i.icon,i.state=e.state||!0,i.collapsible=e.collapsible||!0,i.component=e;var r=i.$mount();return _.isNil(t)?(this.state.components.push(e),$("#g3w-sidebarcomponents").append(r.$el)):(this.state.components=this.state.components.splice(0,0,e),$("#g3w-sidebarcomponents").children().each(function(e,i){t==e&&$(r.$el).insertBefore(i)})),e.mount("#g3w-sidebarcomponent-placeholder"),_.has(e,"initService")&&e.initService(),!0},this.getComponent=function(e){var t;return _.forEach(this.state.components,function(i){if(i.getId()==e)return t=i,!1}),t},this.getComponents=function(){return this.state.components},this.reloadComponent=function(e){var t=this.getComponent(e);t.reload()},this.reloadComponents=function(){this.closePanel(),_.forEach(this.state.components,function(e){e.collapsible&&e.state.open&&($(e.getInternalComponent().$el).siblings().click(),e.setOpen(!1)),e.reload()})},this.removeComponent=function(e){var t=this;_.forEach(this.state.components,function(i,r){if(e==i)return e.unmount(),t.state.components.splice(r,1),!1})},this.showPanel=function(e){var t="#g3w-sidebarpanel-placeholder";this.stack.push(e,{parent:t})},this.closePanel=function(){this.closeSidebarPanel();this.stack.pop()},l(this)}var o=e("sdk/core/i18n/i18n.service").t,n=e("sdk/core/utils/utils").inherit,a=e("./barstack.js"),s=e("sdk/core/g3wobject"),l=e("sdk/core/utils/utils").base,c=Vue.extend({template:e("../html/sidebar-item.html"),data:function(){return{main:!0,component:null,active:!1,title:"component",open:!1,icon:null,state:null}},methods:{onClickItem:function(){var e=this,t=this.$options.service;this.component.setOpen(!this.component.state.open),_.forEach(t.state.components,function(t){t!=e.component&&e.component.collapsible&&t.setOpen(!1)})}}});n(r,s);var u=new r,p=Vue.extend({template:e("../html/sidebar.html"),data:function(){return{components:u.state.components,panels:u.stack.state.contentsdata,bOpen:!0,bPageMode:!1,header:o("main navigation")}},computed:{panelsinstack:function(){return this.panels.length>0},showmainpanel:function(){return this.components.length>0&&!this.panelsinstack},componentname:function(){var e="";return this.components.length&&(e=this.components.slice(-1)[0].getTitle()),e},panelname:function(){var e="";return this.panels.length&&(e=this.panels.slice(-1)[0].content.getTitle()),e}},methods:{closePanel:function(){u.closePanel()},isMobile:function(){return isMobile.any}}});t.exports={SidebarService:u,SidebarComponent:p}},{"../html/sidebar-item.html":8,"../html/sidebar.html":9,"./barstack.js":12,"sdk/core/g3wobject":36,"sdk/core/i18n/i18n.service":39,"sdk/core/utils/utils":80}],19:[function(e,t,i){var r=e("sdk/core/i18n/i18n.service").t;e("sdk/gui/vue/vue.directives");var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/g3wobject"),s=e("sdk/gui/componentsregistry"),l=e("sdk/gui/gui"),c=e("./sidebar"),u=e("./floatbar"),p=e("./viewport"),d=e("./applicationui"),h=e("./layout");h.loading(!0);var m=function(t,i){self=this,this.templateConfig=t,this.init=function(){i.getConfig();this._setupInterface(),this._setupLayout(),this._setUpServices()},this._setupLayout=function(){Vue.filter("t",function(e){return r(e)}),isMobile.any||$("<style type='text/css'> .ol-control-tl {top: 7px;left:43px;}</style>").appendTo("head"),Vue.component("sidebar",c.SidebarComponent),Vue.component("viewport",p.ViewportComponent),Vue.component("floatbar",u.FloatbarComponent),Vue.component("app",d);new Vue({el:"#app",mounted:function(){self._buildTemplate(),$(document).localize(),this.$nextTick(function(){self._setViewport(self.templateConfig.viewport),self.emit("ready"),l.ready()})}})},this._setUpServices=function(){_.forEach(m.Services,function(e,t){i.registerService(t,e)}),_.forEach(l.getComponents(),function(e){i.registerService(e.id,e.getService())})},this._buildTemplate=function(){var e=this;u.FloatbarService.init(h);var t=this.templateConfig.placeholders;_.forEach(t,function(t,i){e._addComponents(t.components,i)}),this._addOtherComponents()},this._addOtherComponents=function(){var e=this;this.templateConfig.othercomponents&&e._addComponents(this.templateConfig.othercomponents)},this._setViewport=function(e){e&&(m.Services.viewport.init(e),this._addComponents(e.components))},this._addComponent=function(e,t){this._addComponents([e],t)},this._addComponents=function(e,t){var i=!0;if(t&&m.PLACEHOLDERS.indexOf(t)>-1){var r=m.Services[t];r&&(i=r.addComponents(e))}_.forEach(e,function(e){i&&s.registerComponent(e)})},this._removeComponent=function(e){s.unregisterComponent(e)},this._showModalOverlay=function(e){var t=l.getComponent("map").getService();e?t.startDrawGreyCover():t.stopDrawGreyCover()},this._showSidebar=function(){},this._hideSidebar=function(){},this._setupInterface=function(){l.layout=h,l.addComponent=_.bind(this._addComponent,this),l.removeComponent=_.bind(this._removeComponent,this),l.getResourcesUrl=_.bind(function(){return i.getConfig().resourcesurl},this),l.showList=_.bind(u.FloatbarService.showPanel,u.FloatbarService),l.closeList=_.bind(u.FloatbarService.closePanel,u.FloatbarService),l.hideList=_.bind(u.FloatbarService.hidePanel,u.FloatbarService),l.showTable=function(){},l.closeTable=function(){},l.showContentFactory=function(e){var t;switch(e){case"query":t=l.showQueryResults;break;case"form":t=l.showForm}return t},l.showForm=function(t){var i=e("sdk").gui.vue.FormComponent,r=t.formComponent?new t.formComponent:new i({id:"form"}),o=r.getService();return o.setInitForm(t),l.setContent({content:r,push:!1,closable:!1}),o},l.closeForm=function(){p.ViewportService.removeContent(),l.setModal(!1)},l.closeContent=function(){return p.ViewportService.closeContent()},l.showQueryResults=function(e,t){var i=l.getComponent("queryresults"),r=i.getService();r.reset(),t&&r.setQueryResponse(t);var o=l.getComponent("contents");return!o.getContentData().length||1==o.getContentData().length&&"queryresults"==o.getCurrentContentData().content.getId()?l.showContextualContent({content:i,title:"Risultati "+e}):("queryresults"==o.getCurrentContentData().content.getId()&&o.popContent(),l.pushContent({content:i,backonclose:!0,closable:!1,perc:50,title:"Risultati "+e})),r},l.showPanel=_.bind(c.SidebarService.showPanel,c.SidebarService),l.closePanel=_.bind(c.SidebarService.closePanel,c.SidebarService),toastr.options.positionClass="toast-top-center",toastr.options.preventDuplicates=!0,toastr.options.timeOut=2e3,l.notify=toastr,l.dialog=bootbox,l.showSpinner=function(e){var t=e.container||"body",i=e.id||"loadspinner",r=e.where||"prepend",o=e.style||"",n=e.transparent?"background-color: transparent":"",a=e.center?"margin: auto":"";$("#"+i).length||$(t)[r].call($(t),'<div id="'+i+'" class="spinner-wrapper '+o+'" style="'+n+'"><div class="spinner '+o+'" style="'+a+'"></div></div>')},l.hideSpinner=function(e){$("#"+e).remove()},l.showFloatbar=function(){u.FloatbarService.open()},l.hideFloatbar=function(){u.FloatbarService.close()},l.showSidebar=_.bind(this._showSidebar,this),l.hideSidebar=_.bind(this._hideSidebar,this),l.setModal=_.bind(this._showModalOverlay,this),l.setPrimaryView=function(e){p.ViewportService.setPrimaryView(e)},l.showMap=function(){p.ViewportService.showMap()},l.showContextualMap=function(e,t){e=e||30,p.ViewportService.showContextualMap({perc:e,split:t})},l.setContextualMapComponent=function(e){p.ViewportService.setContextualMapComponent(e)},l.resetContextualMapComponent=function(){p.ViewportService.resetContextualMapComponent()},l.showContent=function(e){e=e||{},e.perc=100,l.setContent(e)},l.showContextualContent=function(e){e=e||{},e.perc=e.perc||50,l.setContent(e)},l.pushContent=function(e){e=e||{},e.perc=e.perc||100,e.push=!0,l.setContent(e)},l.pushContextualContent=function(e){e=e||{},e.perc=e.perc||50,e.push=!0,l.setContent(e)},l.setContent=function(e){e=e||{},e.content=e.content||null,e.title=e.title||"",e.push=!!_.isBoolean(e.push)&&e.push,e.perc=e.perc||0,e.split=e.split||"h",e.backonclose=!!_.isBoolean(e.backonclose)&&e.backonclose,e.showtitle=!_.isBoolean(e.showtitle)||e.showtitle,p.ViewportService.showContent(e)}},n(this)};o(m,a),m.fail=function(e,t){h.loading(!1),h.bootstrap||(h.bootstrap=e),h.reload(t)},m.PLACEHOLDERS=["navbar","sidebar","viewport","floatbar"],m.Services={navbar:null,sidebar:c.SidebarService,viewport:p.ViewportService,floatbar:c.FloatbarService},t.exports=m},{"./applicationui":11,"./floatbar":14,"./layout":15,"./sidebar":18,"./viewport":20,"core/g3wobject":36,"core/utils/utils":80,sdk:175,"sdk/core/i18n/i18n.service":39,"sdk/gui/componentsregistry":119,"sdk/gui/gui":135,"sdk/gui/vue/vue.directives":174}],20:[function(e,t,i){var r=e("sdk").core.utils.inherit,o=e("sdk").core.utils.base,n=e("sdk").core.G3WObject,a=e("sdk").gui.GUI,s=function(){this.state={primaryView:"map",secondaryPerc:0,split:"h",map:{sizes:{width:0,height:0},aside:!1},content:{sizes:{width:0,height:0},aside:!0,stack:[],closable:!0,backonclose:!1,contentsdata:[]}},this._components={map:null,content:null},this._defaultMapComponent,this._contextualMapComponent,this._secondaryViewMinWidth=300,this._secondaryViewMinHeight=200,this._immediateComponentsLayout=!0,this.init=function(e){var e=e||{};this.state.primaryView=e.primaryview?e.primaryview:"map",this.state.split=e.split?e.split:"h",this._addComponents(e.components)},this._addComponents=function(e){var t=this;_.forEach(e,function(e,i){["map","content"].indexOf(i)>-1&&e.mount("#g3w-view-"+i,!0).then(function(){t._components[i]=e,"map"==i&&(t._defaultMapComponent=e)})})},this.showMap=function(){this._toggleMapComponentVisibility(this._defaultMapComponent,!0),this._components.map=this._defaultMapComponent,this._showView("map")},this.showContextualMap=function(e){var t=this;if(this._contextualMapComponent||(this._contextualMapComponent=this._defaultMapComponent),this._contextualMapComponent!=this._defaultMapComponent&&this._toggleMapComponentVisibility(this._defaultMapComponent,!1),this._contextualMapComponent.ismount())t._components.map=this._contextualMapComponent,this._toggleMapComponentVisibility(this._contextualMapComponent,!0);else{var i=this._contextualMapComponent;i.mount("#g3w-view-map",!0).then(function(){t._components.map=i})}this._showView("map",e)},this.recoverDefaultMap=function(){this._components.map!=this._defaultMapComponent&&(this._components.map=this._defaultMapComponent,this._toggleMapComponentVisibility(this._contextualMapComponent,!1),this._toggleMapComponentVisibility(this._defaultMapComponent,!0))},this.setContextualMapComponent=function(e){e!=this._defaultMapComponent&&(this._contextualMapComponent&&this._contextualMapComponent.unmount(),this._contextualMapComponent=e)},this.resetContextualMapComponent=function(){this._contextualMapComponent&&this._contextualMapComponent.unmount(),this._contextualMapComponent=this._defaultMapComponent},this._toggleMapComponentVisibility=function(e,t){e.internalComponent.$el.style.display=t?"block":"none"},this.closeMap=function(){this.state.secondaryPerc="map"==this.state.primaryView?100:0,this.recoverDefaultMap(),this._layout()},this.showContent=function(e){var t=this;e.push=e.push||!1,this._prepareContentView(e),this._immediateComponentsLayout=!1,this._showView("content",e,!0),t._components.content.setContent(e).then(function(){t._layoutComponents(),t._immediateComponentsLayout=!0})},this.popContent=function(){var e=this;if(this.state.content.contentsdata.length){this.recoverDefaultMap();var t=this._components.content.getPreviousContentData();e._prepareContentView(t.options),this._immediateComponentsLayout=!1,this._showView("content"),this._components.content.popContent().then(function(){e._layoutComponents(),e._immediateComponentsLayout=!0})}},this.closeContent=function(){return this._components.content.removeContent(),this.recoverDefaultMap(),this.closeSecondaryView()},this.removeContent=function(){return this.state.content.backonclose&&this.state.content.contentsdata.length>1?void this.popContent():(this._components.content.removeContent(),this.recoverDefaultMap(),this.closeSecondaryView())},this.isPrimaryView=function(e){return this.state.primaryView==e},this.setPrimaryView=function(e){this.state.primaryView!=e&&(this.state.primaryView=e),this._layout()},this.showPrimaryView=function(e){e&&this.state.secondaryVisible&&100==this.state.secondaryPerc&&(this.state.secondaryPerc=100-e,this._layout())},this.showSecondaryView=function(e,t){this.state.secondaryVisible=!0,this.state.split=e?e:this.state.split,this.state.secondaryPerc=t?t:this.state.perc,this._layout()},this.closeSecondaryView=function(e){var t=$.Deferred(),i=this,r=this._components[this._otherView(this.state.primaryView)];return r.clearContents?r.clearContents().then(function(){i.state.secondaryVisible=!1,i._layout(),Vue.nextTick(function(){t.resolve()})}):(this.state.secondaryVisible=!1,this._layout(),Vue.nextTick(function(){t.resolve()})),t.promise()},this.getDefaultViewPerc=function(e){return this.isPrimaryView(e)?100:50},this._otherView=function(e){return"map"==e?"content":"map"},this._isSecondary=function(e){return this.state.primaryView!=e},this._setPrimaryView=function(e){this.state.primaryView!=e&&(this.state.primaryView=e)},this._prepareContentView=function(e){this.state.content.preferredPerc=e.perc||this.getDefaultViewPerc("content"),this.state.content.title=e.title,this.state.content.closable=!!_.isNil(e.closable)||e.closable,this.state.content.backonclose=!!_.isNil(e.backonclose)||e.backonclose,this.state.content.contentsdata=this._components.content.contentsdata},this._showView=function(e,t){t=t||{};var i,r=t.perc||this.getDefaultViewPerc(e),o=t.split||"h";i=!this.isPrimaryView(e)||"undefined"!=typeof t.aside&&t.aside,this.state[e].aside=i;var n=this.isPrimaryView(e)?100-r:r;return n>0?void this.showSecondaryView(o,n):this.closeSecondaryView()},this._getReducedSizes=function(){var e=$(".content"),t=0,i=0;if(e&&this.state.secondaryVisible&&100==this.state.secondaryPerc){var r=$(".sidebar-aside-toggle");if(r&&r.is(":visible")){var o=r.outerWidth();e.css("padding-left",o+5),t=o-5}}else e.css("padding-left",15);return{reducedWidth:t,reducedHeight:i}},this._layout=function(){var e=this,t="h"==this.state.split?"split-h":"split-v",i="h"==this.state.split?"split-v":"split-c";$(".g3w-viewport .g3w-view").addClass(t),$(".g3w-viewport .g3w-view").removeClass(i);var r=this._getReducedSizes();this._setViewSizes(r.reducedWidth,r.reducedHeight);var o=$("#closemap-btn");if(!o.length){var o=$('<div id="closemap-btn" @click="closeMap" style="        position: absolute;        right: 10px;        top: 7px;        line-height: 1;        padding: 7px 2px;        font-size: 1.5em;        background-color: #3c8dbc;        color: white;        z-index:1000;        height: 39px;        width: 39px">          <button class="glyphicon glyphicon-remove pull-right close-panel-button" style="background-color: transparent;border: 0px;"></button>        </div>');o.on("click",function(){e.closeMap()});var n=$(".g3w-viewport .map");n.append(o)}this.state.secondaryVisible&&this._isSecondary("content")&&this.state.secondaryPerc<this.state.content.preferredPerc?o.show():o.hide(),this._immediateComponentsLayout&&this._layoutComponents()},this._setViewSizes=function(){var e=this.state.primaryView,t=this._otherView(e),i=this._viewportWidth(),r=this._viewportHeight(),o=i,n=r,a=this.state.secondaryPerc/100;"h"==this.state.split?(secondaryWidth=this.state.secondaryVisible?Math.max(i*a,this._secondaryViewMinWidth):0,secondaryHeight=r,o=i-secondaryWidth,n=r):(secondaryWidth=i,secondaryHeight=this.state.secondaryVisible?Math.max(r*a,this._secondaryViewMinHeight):0,o=i,n=r-secondaryHeight),this.state[e].sizes.width=o,this.state[e].sizes.height=n,this.state[t].sizes.width=secondaryWidth,this.state[t].sizes.height=secondaryHeight},this._viewportHeight=function(){var e=$(".navbar").innerHeight();return $(window).innerHeight()-e},this._viewportWidth=function(){var e=$(".main-sidebar").offset().left,t=$(".main-sidebar").innerWidth(),i=t+e;return $(window).innerWidth()-i},this._layoutComponents=function(){var e=this;Vue.nextTick(function(){var t=e._getReducedSizes();reducedWidth=t.reducedWidth||0,reducedHeight=t.reducedHeight||0,_.forEach(e._components,function(t,i){var r=e.state[i].sizes.width-reducedWidth,o=e.state[i].sizes.height-reducedHeight;t.layout(r,o)})})},this._firstLayout=function(){function e(){o=!0,t()}function t(){o===!0?(o=!1,r=!0,i._layout(!0),requestAnimationFrame(t)):r=!1}var i=this,r=!1,o=!1;a.on("ready",function(){var t=i.state.primaryView,o=i._otherView(t),n=$(".g3w-viewport ."+o),s=n.css("min-width");""==s||_.isNaN(parseFloat(s))||(i._secondaryViewMinWidth=parseFloat(s));var l=n.css("min-height");""==l||_.isNaN(parseFloat(l))||(i._secondaryViewMinHeight=parseFloat(l)),i._layout(!0),a.on("guiresized",function(){e()}),$(window).resize(function(){r===!1&&e()}),$(".main-sidebar").on("webkitTransitionEnd transitionend msTransitionEnd oTransitionEnd",function(){$(this).trigger("trans-end"),e()})})},this._firstLayout(),o(this)};r(s,n);var l=new s,c=Vue.extend({template:e("../html/viewport.html"),data:function(){return{state:l.state}},computed:{showtitle:function(){var e=!0,t=this.state.content.contentsdata;if(t.length){var i=t[t.length-1].options;_.isBoolean(i.showtitle)&&(e=i.showtitle)}return e},contentTitle:function(){var e=this.state.content.contentsdata;if(e.length)return e[e.length-1].options.title},previousTitle:function(){var e=this.state.content.contentsdata;return e.length>1&&(e[e.length-2].options.title?"a "+e[e.length-2].options.title:"indietro")},contentSmallerThenPreferred:function(){return this.state.secondaryPerc<this.state.content.preferredPerc}},methods:{closeContent:function(){l.removeContent()},closeMap:function(){l.closeMap()},gotoPreviousContent:function(){l.popContent()}}});t.exports={ViewportService:l,ViewportComponent:c}},{"../html/viewport.html":10,sdk:175}],21:[function(e,t,i){function r(){this._config=null,this._baseUrl=null,this.init=function(e){var t=$.Deferred();return this._config=e,this._baseUrl=e.urls.api,this._apiEndpoints=e.urls.apiEndpoints,t.resolve(),t.promise()};var e=0;this._incrementLoaders=function(){0==e&&this.emit("apiquerystart"),e+=1},this._decrementLoaders=function(){e-=1,0==e&&this.emit("apiqueryend")},this.get=function(e,t){var i=this,r=this._apiEndpoints[e];if(r){var o=this._baseUrl+"/"+r;t.request&&(o=o+"/"+t.request);var n=t.params||{};return i.emit(e+"querystart"),this._incrementLoaders(),$.get(o,n).done(function(t){return i.emit(e+"queryend",t),t}).fail(function(t){return i.emit(e+"queryfail",t),t}).always(function(){i._decrementLoaders()})}return s()},n(this)}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/g3wobject"),s=e("core/utils/utils").reject;o(r,a),t.exports=new r},{"core/g3wobject":36,"core/utils/utils":80}],22:[function(e,t,i){var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,n=e("core/g3wobject"),a=e("core/apiservice"),s=e("core/router"),l=e("core/project/projectsregistry"),c=e("core/plugin/pluginsregistry"),u=e("core/clipboardservice"),p="1499354629775",d=function(){var e=this;this.version=p.indexOf("G3W_VERSION")==-1?p:"",this.secret="### G3W Client Application Service ###",this.ready=!1,this.complete=!1,this._modalOverlay=null,this._acquirePostBoostrap=!1,this._applicationServices={},this.config={},this._initConfigUrl=null,this._initConfig={},o(this),this.init=function(e,t){return this._config=e,t&&(this._acquirePostBoostrap=!0),this._bootstrap()},this.getConfig=function(){return this._config},this.getRouterService=function(){return s},this.getClipboardService=function(){return u},this.obtainInitConfig=function(e){var t=this;this._initConfigUrl||(this._initConfigUrl=e);var i=$.Deferred();if(window.initConfig)return this._initConfig=window.initConfig,i.resolve(window.initConfig);var r,o;if(location.search?(o=location.search.substring(1).split("&"),_.forEach(o,function(e){e.indexOf("project")>-1&&(r=e.split("=")[1])})):r=location.pathname.split("/").splice(-4,3).join("/"),r){var n=this._initConfigUrl;r&&(n=n+"/"+r),$.get(n).then(function(e){e.staticurl="../dist/",e.clienturl="../dist/",t._initConfig=e,window.initConfig=e,i.resolve(e)}).fail(function(e){i.reject(e)})}return i.promise()},this.getInitConfig=function(){return this._initConfig},this.getInitConfigUrl=function(){return this._initConfigUrl},this.setInitConfigUrl=function(e){this._initConfigUrl=e},this.postBootstrap=function(){this.complete||(s.init(),c.init({pluginsBaseUrl:e._config.urls.staticurl,pluginsConfigs:e._config.plugins,otherPluginsConfig:l.getCurrentProject().getState()}),this.complete=!0)},this._bootstrap=function(){var e=this,t=$.Deferred();return this.ready||$.when(l.init(this._config),a.init(this._config)).then(function(){e.emit("ready"),e._acquirePostBoostrap||e.postBootstrap(),this.initialized=!0,t.resolve()}).fail(function(e){t.reject(e)}),t.promise()},this.registerService=function(e,t){this._applicationServices[e]=t},this.unregisterService=function(e){delete this._applicationServices[e]},this.getService=function(e){return this._applicationServices[e]},this.errorHandler=function(e){console.log(e)}};r(d,n),t.exports=new d},{"core/apiservice":21,"core/clipboardservice":24,"core/g3wobject":36,"core/plugin/pluginsregistry":71,"core/project/projectsregistry":76,"core/router":78,"core/utils/utils":80}],23:[function(e,t,i){function r(){n(this)}var o=e("core/utils/utils").inherit,n=e("core/utils//utils").base,a=e("core/layers/layersstoresregistry");o(r,a),t.exports=new r},{"core/layers/layersstoresregistry":49,"core/utils//utils":80,"core/utils/utils":80}],24:[function(e,t,i){function r(){this._data={},this.set=function(e,t){var i=e.split("form")[0];this._data[i]=t},this.get=function(e){var t=this._data[e]||{};return this._data[e]={},t}}t.exports=new r},{}],25:[function(e,t,i){function r(e){n(this),this._layer=e}var o=e("core/utils/utils").inherit,n=e("core/utils//utils").base,a=e("core/g3wobject");o(r,a);var s=r.prototype;s.getLayer=function(){return this._layer},t.exports=r},{"core/g3wobject":36,"core/utils//utils":80,"core/utils/utils":80}],26:[function(e,t,i){function r(e,t){var t=t||{};this._editor=e,this._origVectorLayer=new ol.layer.Vector({source:new ol.source.Vector}),this._cloneLayer(),this._geometriesBuffer={},this._attributesBuffer={},this._relationsBuffers={},this._relationEditBuffer=t.relationEditBuffer||a}var o=e("core/utils/utils").inherit,n=e("core/g3wobject"),a=e("./relationeditbuffer");o(r,n),t.exports=r;var s=r.prototype;s.commit=function(){var e=this,t=this._editor.getVectorLayer(),i=this._editor.getEditVectorLayer().getFeatures();i&&(_.forEach(i,function(t,r){i[r]=e._editor._transformCoordinateFeatureFromLayerToMap(t)}),t.addFeatures(i)),_.forEach(this._geometriesBuffer,function(i,r){if(!e._isNewFeature(r)){var o=t.getFeatureById(r);o&&(o=e._editor._transformCoordinateFeatureFromLayerToMap(o),o.setStyle(null),t.modifyFeatureGeometry(r,o.getGeometry()))}}),this._editor.getEditVectorLayer().clear(),this._clearBuffers(),this._cloneLayer()},s.undoAll=function(){this._resetVectorLayer(),this._clearBuffers()},s.destroy=function(){this._clearBuffers()},s.generateId=function(){return this._editor.generateId()},s.addFeature=function(e){e.getId()||e.setId(this.generateId()),this._addEditToGeometryBuffer(e,"add")},s.updateFeature=function(e){this._addEditToGeometryBuffer(e,"update")},s.deleteFeature=function(e,t){this._addEditToGeometryBuffer(e,"delete"),this._addEditToValuesBuffers(e,t,"delete")},s.updateFields=function(e,t){e.getId()||e.setId(this.generateId()),this._addEditToValuesBuffers(e,t)},s.getFeatureAttributes=function(e){return this._attributesBuffer[e]?this._attributesBuffer[e].slice(-1)[0]:null},s.areFeatureAttributesEdited=function(e){return!!this._attributesBuffer[e]&&this._attributesBuffer[e].length>-1},s.hasRelationsEdits=function(e){var t=!1;return _.forEach(this._relationsBuffers[e],function(e){t=t||e.hasRelationElements()}),t},s.getRelationsEdits=function(e){var t={};return _.forEach(this._relationsBuffers[e],function(e){t[e.getRelationName()]=e.getRelationElements()}),t},s.collectFeatureIds=function(){var e=this._geometriesBuffer,t=this._attributesBuffer,i=[];return i=_.concat(i,_.keys(e)),i=_.concat(i,_.keys(t)),_.uniq(i)},s.collectFeatures=function(e,t){var i,r=this,t=t||!1,o=new ol.format.GeoJSON,n=this.collectFeatureIds();i="new"==e?r._editor.getEditVectorLayer():r._editor.getVectorLayer();var a=[];return _.forEach(n,function(n){var s=i.getFeatureById(n),l=r._isNewFeature(n),c="new"==e&&l&&s,u="updated"==e&&!l&&s,p="deleted"==e&&!l&&!s;c||u?(t&&(s=o.writeFeatureObject(s)),a.push(s)):p&&a.push(n)}),a},s.createFeature=function(e,t,i){var r=new ol.Feature;return r.setId(e),r.setGeometry(t),r.setProperties(i),r},s.collectRelations=function(){var e={add:[],"delete":[],update:[]};return _.forEach(this._relationsBuffers,function(t,i){var r={fid:i,relations:{}},o={fid:i,relations:{}},n={fid:i,relations:{}};_.forEach(t,function(e){var t=e.getRelationName(),i=e.getRelationElementsOnlyFieldsValues("NEW"),a=e.getRelationElementsOnlyFieldsValues("OLD"),s=e.getRelationElementsOnlyFieldsValues("OLD_DELETED"),l=[],c=[],u=[];_.forEach(i,function(e){l.push({id:e.id,fields:e.fields})}),_.forEach(a,function(e){c.push({id:e.id,fields:e.fields})}),_.forEach(s,function(e){u.push({id:e.id})}),r.relations[t]=l,o.relations[t]=c,n.relations[t]=u}),e.add.push(r),e.update.push(o),e["delete"].push(n)}),e},s._addEditToValuesBuffers=function(e,t){var i=e.getId(),r=e.getProperties(),o=this._attributesBuffer;_.has(o,i)||(o[i]=[]),o[i].push(r),this._addDeleteRelationsBuffers(t,i),this._setDirty(!0)},s._addEditToGeometryBuffer=function(e,t){var i=this._geometriesBuffer,r=e.getId(),o=e.getGeometry();if("delete"==t){o=null;var n=this._isNewFeature(r)?this._editor.getEditVectorLayer():this._editor.getVectorLayer();n.getSource().removeFeature(e)}_.has(i,r)||(i[r]=[]),i[r].push(o),this._setDirty(!0)},s._addDeleteRelationsBuffers=function(e,t){var i=this;e&&_.forEach(e,function(e){_.has(i._relationsBuffers,t)||(i._relationsBuffers[t]={}),_.has(i._relationsBuffers[t],e.name)||(i._relationsBuffers[t][e.name]=new i._relationEditBuffer(i,e.name));var r=i._relationsBuffers[t][e.name];r.updateRelation(e)})},s._isNewFeature=function(e){return this._editor.isNewFeature(e)},s._setDirty=function(e){var t=e||!_.isEmpty(this._geometriesBuffer)||!_.isEmpty(this._attributesBuffer)||!_.isEmpty(this._relationsAttributesBuffer);this._editor._setDirty(t)},s._resetVectorLayer=function(){this._editor.vectoLayer=this._origVectorLayer,this._origVectorLayer.getSource().clear()},s._clearBuffers=function(){this._geometriesBuffer={},this._attributesBuffer={},this._relationsAttributesBuffer={},this._relationsBuffers={},this._editor._setDirty(!1)},s._cloneLayer=function(){var e=[];this._editor.getVectorLayer().getSource().forEachFeature(function(t){e.push(t.clone())},this),this._origVectorLayer.getSource().addFeatures(e)}},{"./relationeditbuffer":28,"core/g3wobject":36,"core/utils/utils":80}],27:[function(e,t,i){function r(e){var e=e||{};this._formComponent=e.formComponent||null,this._mapService=e.mapService||{},this._vectorLayer=null,this._editVectorLayer=null,this._editBufferClass=e.editBufferClass||g,this._editBuffer=null,this._activeTool=null,this._dirty=!1,this._newPrefix="_new_",this._featureLocks=null,this._started=!1,this._editingVectorStyle=e.editingVectorStyle||null,this.checkOneRelation=e.checkOneRelation||!1,this._copyAndPasteFieldsNotOverwritable=e.copyAndPasteFieldsNotOverwritable||{},this._fieldsLayerbindToRelationsFileds=e.fieldsLayerbindToRelationsFileds||{},this._formTools=e.formTools||["copypaste"],this._pickedFeature=null,this._formService=null,this._setterslisteners={before:{},after:{}},this._geometrytypes=["Point","MultiPoint","LineString","Line","MultiLineString","Polygon","MultiPolygon"],this._toolsForGeometryTypes={Point:{addfeature:u,movefeature:p,deletefeature:h,editattributes:m},MultiPoint:{addfeature:u,movefeature:p,deletefeature:h,editattributes:m},Line:{addfeature:u,modifyvertex:d,movefeature:p,deletefeature:h,editattributes:m,cutline:f},LineString:{addfeature:u,modifyvertex:d,movefeature:p,deletefeature:h,editattributes:m,cutline:f},Polygon:{addfeature:u,modifyvertex:d,movefeature:p,deletefeature:h,editattributes:m},MultiPolygon:{addfeature:u,modifyvertex:d,movefeature:p,deletefeature:h,editattributes:m}},this._activeTool=new function(){this.type=null,this.instance=null,this.setTool=function(e,t){this.type=e,this.instance=t},this.getType=function(){return this.type},this.getTool=function(){return this.instance},this.clear=function(){this.type=null,this.instance=null}},this._tools={},this._setupAddFeatureAttributesEditingListeners(),this._setupEditAttributesListeners(),this._askConfirmToDeleteEditingListener(),n(this)}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/utils/utils").resolve,s=e("core/g3wobject"),l=e("gui/gui"),c=e("core/map/layer/vectorlayer"),u=e("./tools/addfeaturetool"),p=e("./tools/movepointtool"),d=e("./tools/modifyfeaturetool"),h=e("./tools/deletefeaturetool"),m=e("./tools/pickfeaturetool"),f=e("./tools/cutlinetool"),g=e("./editbuffer");o(r,s);var y=r.prototype;y._askConfirmToDeleteEditingListener=function(){var e=this;this.onbeforeasync("deleteFeature",function(t,i,r){e._deleteFeatureDialog(r)})},y._deleteFeatureDialog=function(e){
l.dialog.confirm("Vuoi eliminare l'elemento selezionato?",function(t){e(t)})},y._setupAddFeatureAttributesEditingListeners=function(){var e=this;this.onbeforeasync("addFeature",function(t,i){e._openEditorForm("new",t,i)},100)},y._setupEditAttributesListeners=function(){var e=this;this.onbeforeasync("pickFeature",function(t,i){var r=e.isNewFeature(t.getId())?"new":"old";e._openEditorForm(r,t,i)})},y.getcopyAndPasteFieldsNotOverwritable=function(){return this._copyAndPasteFieldsNotOverwritable},y.setcopyAndPasteFieldsNotOverwritable=function(e){this._copyAndPasteFieldsNotOverwritable=e},y.getfieldsLayerbindToRelationsFileds=function(){return this._fieldsLayerbindToRelationsFileds},y.setFormService=function(e){this._formService=e},y.getFormService=function(){return this._formService},y.getMapService=function(){return this._mapService},y.getPickedFeature=function(){return this._pickedFeature},y.setPickedFeature=function(e){this._pickedFeature=e},y.cleanUpPickedFeature=function(){this._pickedFeature.setStyle(null),this._pickedFeature=null},y.setFormData=function(e){this.formData=e},y.setVectorLayer=function(e){var t=e.geometrytype;if(!t||!this._isCompatibleType(t))throw Error("Vector geometry type "+t+" is not valid for editing");this._setToolsForVectorType(t),this._vectorLayer=e},y.addEditingLayerToMap=function(e){this._editVectorLayer=new c({name:"editvector",geometrytype:e}),this._editingVectorStyle&&this._editVectorLayer.setStyle(this._editingVectorStyle.url),this._mapService.viewer.map.addLayer(this._editVectorLayer.getMapLayer())},y.removeEditingLayerFromMap=function(){this._mapService.viewer.removeLayerByName(this._editVectorLayer.name),this._editVectorLayer=null},y.start=function(){var e=!1;return this._vectorLayer&&(this.stop(),this.addEditingLayerToMap(this._vectorLayer.geometrytype),this._editBuffer=new this._editBufferClass(this),this._setStarted(!0),e=!0),e},y.stop=function(){return!this.isStarted()||!!this.stopTool()&&(this._editBuffer.destroy(),this._editBuffer=null,this.removeEditingLayerFromMap(),this._setStarted(!1),!0)},y.destroy=function(){this.stop()&&this.removeAllListeners()},y.setTool=function(e,t){if(!this.stopTool())return!1;var i=this._tools[e];if(i){var r=new i(this,t);return this._activeTool.setTool(e,r),this._setToolSettersListeners(r),r.run(),!0}},y.stopTool=function(){return!(this._activeTool.instance&&!this._activeTool.instance.stop())&&(l.closeForm(),l.setModal(!1),this._activeTool.clear(),!0)},y.getActiveTool=function(){return this._activeTool},y.isStarted=function(){return this._started},y.hasActiveTool=function(){return!_.isNull(this._activeTool.instance)},y.isToolActive=function(e){return!!this._activeTool.toolType&&this._activeTool.toolType==e},y.commit=function(e){this._editBuffer.commit(),this._formService&&this._formService.cleanStateAfterCommit(e)},y.undoAll=function(){this._editBuffer.undoAll()},y.setFeatureLocks=function(e){this._featureLocks=e},y.getFeatureLocks=function(){return this._featureLocks},y.getFeatureLockIds=function(){return _.map(this._vectorLayer.getFeatureLocks(),function(e){return e.lockid})},y.getFeatureLocksLockIds=function(e){var e=e||this._vectorLayer.getFeatureLocks();return _.map(e,function(e){return e.lockid})},y.getFeatureLocksFeatureIds=function(e){var e=e||this._vectorLayer.getFeatureLocks();return _.map(e,function(e){return e.featureid})},y.getFeatureLockIdsForFeatureIds=function(e){var t=_.filter(this._vectorLayer.getFeatureLocks(),function(t){return _.includes(e,t.featureid)});return this.getFeatureLocksLockIds(t)},y.getFeatureLockForFeatureIds=function(e){return this._vectorLayer.getFeatureLocks()},y.getEditedFeatures=function(){var e=this._editBuffer.collectFeatureIds(),t=this.getFeatureLockForFeatureIds(e);return{add:this._editBuffer.collectFeatures("new",!0),update:this._editBuffer.collectFeatures("updated",!0),"delete":this._editBuffer.collectFeatures("deleted",!0),relationsedits:this.collectRelations(),lockids:t}},y.collectRelations=function(){return relationsEdits=this._editBuffer.collectRelations(),relationsEdits},y.setFieldsWithValues=function(e,t,i){var r={};_.forEach(t,function(e){"null"==e.value&&(e.value=null),r[e.name]=e.value}),e.setProperties(r),this._editBuffer.updateFields(e,i),i&&this._vectorLayer.setRelationsData(e.getId(),i)},y.getRelationsWithValues=function(e){var t=e.getId();if(this._vectorLayer.hasRelations()){var i;if(t)if(this._vectorLayer.getFeatureById(t)){var r=this._editBuffer.hasRelationsEdits(t);if(r){var o=this._editBuffer.getRelationsEdits(t),n=this._vectorLayer.getRelations();_.forEach(n,function(e){e.elements=_.cloneDeep(o[e.name])}),i=a(n)}else i=this._vectorLayer.getRelationsWithValues(t)}else if(this._vectorLayer.featureHasRelationsFksWithValues(e)){var s=this._vectorLayer.getRelationsFksWithValuesForFeature(e);i=this._vectorLayer.getNewRelationsWithValuesFromFks(s)}else i=this._vectorLayer.getRelationsWithValues(t);else i=this._vectorLayer.getRelationsWithValues()}else i=a(null);return i},y.createRelationElement=function(e){var t={},i=_.cloneDeep(this._vectorLayer.getRelationFields(e));return _.forEach(i,function(e){e.value=null}),t.fields=i,t.id=this.generateId(),t.state="NEW",t},y.getRelationPkFieldIndex=function(e){return this._vectorLayer.getRelationPkFieldIndex(e)},y.getField=function(e,t){var t=t||this.getVectorLayer().getFieldsWithValues(),i=null;return _.forEach(t,function(t){t.name==e&&(i=t)}),i},y.isDirty=function(){return this._dirty},y.onafter=function(e,t,i){this._onaftertoolaction(e,t,i)},y.onbefore=function(e,t,i){this._onbeforetoolaction(e,t,!1,i)},y.onbeforeasync=function(e,t,i){this._onbeforetoolaction(e,t,!0,i)},y._onaftertoolaction=function(e,t,i){i=i||0,_.get(this._setterslisteners.after,e)||(this._setterslisteners.after[e]=[]),this._setterslisteners.after[e].push({fnc:t,priority:i})},y._onbeforetoolaction=function(e,t,i,r){r=r||0,_.get(this._setterslisteners.before,e)||(this._setterslisteners.before[e]=[]),this._setterslisteners.before[e].push({fnc:t,how:i?"async":"sync",priority:r})},y._setToolSettersListeners=function(e){_.forEach(this._setterslisteners.before,function(t,i){_.hasIn(e.setters,i)&&_.forEach(t,function(t){"sync"==t.how?e.onbefore(i,t.fnc,t.priority):e.onbeforeasync(i,t.fnc,t.priority)})}),_.forEach(this._setterslisteners.after,function(t,i){_.hasIn(e.setters,i)&&_.forEach(t,function(t){e.onafter(i,t.fnc,t.priority)})})},y._transformCoordinateFeatureFromMapToLayer=function(e){var t=this._mapService.getProjection().getCode(),i=this._vectorLayer.getCrs(),r=e.getGeometry().getCoordinates();return r=ol.proj.transform(r,t,i),e.getGeometry().setCoordinates(r),e},y._transformCoordinateFeatureFromLayerToMap=function(e){var t=this._mapService.getProjection().getCode(),i=this._vectorLayer.getCrs(),r=e.getGeometry().getCoordinates();return r=ol.proj.transform(r,i,t),e.getGeometry().setCoordinates(r),e},y.addFeature=function(e){e=this._transformCoordinateFeatureFromMapToLayer(e),this._editBuffer.addFeature(e)},y.updateFeature=function(e){e=this._transformCoordinateFeatureFromMapToLayer(e),this._editBuffer.updateFeature(e)},y.pickFeature=function(e){this.updateFeature(e)},y.moveFeature=function(e){this.updateFeature(e)},y.deleteFeature=function(e,t,i){this._editBuffer.deleteFeature(e,t)},y.getVectorLayer=function(){return this._vectorLayer},y.getEditVectorLayer=function(){return this._editVectorLayer},y.generateId=function(){return this._newPrefix+Date.now()},y.generateFormId=function(e){return e+"form"+Date.now()},y.isNewFeature=function(e){return!e||0==e.toString().indexOf(this._newPrefix)},y._isCompatibleType=function(e){return this._geometrytypes.indexOf(e)>-1},y._setToolsForVectorType=function(e){var t=this,i=this._toolsForGeometryTypes[e];_.forEach(i,function(e,i){t._tools[i]=e})},y._setStarted=function(e){this._started=e},y._setDirty=function(e){_.isNil(e)?this._dirty=!0:this._dirty=e,this.emit("dirty",this._dirty)},y._onSaveEditorForm=function(e,t,i,r){var o=this,r=r,e=e;return function(t,i){o.setFieldsWithValues(e,t,i),r&&r(!0),l.setModal(!1)}},y._openEditorForm=function(e,t,i){var r=this,o=this.getVectorLayer(),n=o.getFieldsWithValues(t),a=o.pk;a&&_.isNull(this.getField(a))&&_.forEach(t.getProperties(),function(e,t){var i=r.getField(t,n);i&&(i.value=e)});var s=l.showContentFactory("form"),c=this.getRelationsWithValues(t);c.then(function(e){var e=_.cloneDeep(e);s({provider:r,name:"Edita attributi "+o.name,formId:r.generateFormId(o.name),dataid:o.name,vectorLayer:o,pk:o.pk,isnew:r.isNewFeature(t.getId()),fields:n,relations:e,relationOne:r.checkOneRelation,tools:r._formTools,formComponent:r._formComponent,editor:r,buttons:[{title:"Salva",type:"save","class":"btn-danger",cbk:r._onSaveEditorForm(t,n,e,i)},{title:"Cancella",type:"cancel","class":"btn-primary",cbk:function(){i&&i(!1),l.setModal(!1)}}]})}).fail(function(){i&&i(!1),l.setModal(!1)})},t.exports=r},{"./editbuffer":26,"./tools/addfeaturetool":29,"./tools/cutlinetool":30,"./tools/deletefeaturetool":31,"./tools/modifyfeaturetool":33,"./tools/movepointtool":34,"./tools/pickfeaturetool":35,"core/g3wobject":36,"core/map/layer/vectorlayer":65,"core/utils/utils":80,"gui/gui":135}],28:[function(e,t,i){function r(e,t){this._relationName=t,this._editorBuffer=e,this._elementsBuffer={}}var o=e("core/utils/utils").inherit,n=e("core/g3wobject");o(r,n),t.exports=r;var a=r.prototype;a.commit=function(){this._clearBuffers()},a.undoAll=function(){this._clearBuffers()},a.destroy=function(){this._clearBuffers()},a.getRelationName=function(){return this._relationName},a.generateId=function(){return this._editorBuffer.generateId()},a.getAddedElements=function(){},a.getDeletedElements=function(){},a.getUpdatedElements=function(){},a.updateRelation=function(e){var t=this;_.forEach(e.elements,function(e){t._editElementsBuffer(e)})},a._editElementsBuffer=function(e){var t=_.some(e.fields,function(e){return!_.isNil(e.value)});if(t){var i=e.id;_.has(this._elementsBuffer,i)||(this._elementsBuffer[i]=[]),this._elementsBuffer[i].push(e),this._setDirty(!0)}},a.getRelationElements=function(e,t){var i=[];return _.forEach(this._elementsBuffer,function(r){var o=r.slice(-1)[0];(o||"ALL"==e)&&(!e||e&&o.state==e)&&(t&&(o=_.cloneDeep(o),o.fields=_.map(o.fields,function(e){return{name:e.name,value:e.value}})),i.push(o))}),i},a.getRelationElementsOnlyFieldsValues=function(e){return this.getRelationElements(e,!0)},a.hasRelationElements=function(){var e=!1;return _.forEach(this._elementsBuffer,function(t){e=e||t.length>0}),e},a._setDirty=function(e){this._editorBuffer._setDirty(e)},a._clearBuffers=function(){this._elementsBuffer={},this._setDirty(!1)}},{"core/g3wobject":36,"core/utils/utils":80}],29:[function(e,t,i){function r(e,t){t=t||{},this._running=!1,this._busy=!1,this.source=e.getEditVectorLayer().getMapLayer().getSource(),this.type=this.editor.getEditVectorLayer().geometrytype,this.drawInteraction=null,this._snap=t.snap||null,this._snapInteraction=null,this._finishCondition=t.finishCondition||_.constant(!0),this._condition=t.condition||_.constant(!0),this.setters={addFeature:{fnc:r.prototype._addFeature,fallback:r.prototype._fallBack}},n(this,e)}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("./editingtool");o(r,a),t.exports=r;var s=r.prototype;s.run=function(){var e=this;this.drawInteraction=new ol.interaction.Draw({type:this.type,source:this.source,condition:this._condition,finishCondition:this._finishCondition});var t=this.editor._editingVectorStyle?this.editor._editingVectorStyle.add:null;this.addInteraction(this.drawInteraction),this.drawInteraction.setActive(!0),this.drawInteraction.on("drawstart",function(t){e.editor.emit("drawstart",t)}),this.drawInteraction.on("drawend",function(i){i.feature.setStyle(t),e.editor.emit("drawend",i),e._busy||(e._busy=!0,e.pause(),e.addFeature(i.feature))}),this._snap&&(this._snapInteraction=new ol.interaction.Snap({source:this._snap.vectorLayer.getSource()}),this.addInteraction(this._snapInteraction))},s.pause=function(e){_.isUndefined(e)||e===!0?(this._snapInteraction&&this._snapInteraction.setActive(!1),this.drawInteraction.setActive(!1)):(this._snapInteraction&&this._snapInteraction.setActive(!0),this.drawInteraction.setActive(!0))},s.stop=function(){return this._snapInteraction&&(this.removeInteraction(this._snapInteraction),this._snapInteraction=null),this.removeInteraction(this.drawInteraction),this.drawInteraction=null,!0},s.removeLastPoint=function(){if(this.drawInteraction)try{this.drawInteraction.removeLastPoint()}catch(e){}},s._addFeature=function(e){return e.setStyle(null),this.editor.addFeature(e),this._busy=!1,this.pause(!1),!0},s._fallBack=function(e){this._busy=!1,this.source.getFeaturesCollection().getLength()&&(this.source.getFeaturesCollection().pop(),this.pause(!1))}},{"./editingtool":32,"core/utils/utils":80}],30:[function(e,t,i){function r(e,t){this.setters={cutLine:r.prototype._cutLine},n(this,e,t),this.steps=new c.Steps(r.steps),this._origFeature=null,this._origGeometry=null,this._newFeatures=[],this._linePickInteraction=null,this._pointPickInteraction=null,this._pointLayer=t.pointLayer||null,this._minCutPointDistance=t.minCutPointDistance||1/0,this._modType=t.modType||"MODONCUT",this._selectedLineOverlay=new ol.layer.Vector({source:new ol.source.Vector,style:new ol.style.Style({stroke:new ol.style.Stroke({color:"rgb(255,255,0)",width:4})})}),this._lineToKeepOverlay=new ol.layer.Vector({source:new ol.source.Vector})}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/geometry/geom"),s=e("g3w-ol3/src/interactions/pickfeatureinteraction"),l=e("g3w-ol3/src/interactions/pickcoordinatesinteraction"),c=e("./editingtool");o(r,c),t.exports=r;var u=r.prototype;u.run=function(){var e=this;this._linePickInteraction=new s({layers:[this.layer,this.editingLayer]}),this.addInteraction(this._linePickInteraction),e.steps.next(),this._linePickInteraction.on("picked",function(t){var i,r=e._origFeature=t.feature;e._origGeometry=r.getGeometry().clone(),e._showSelection(e._origGeometry,300),e.removeInteraction(this),e._pointLayer?e._pointPickInteraction=new s({layers:[e._pointLayer]}):e._pointPickInteraction=new l,e.steps.next(),e._pointPickInteraction.on("picked",function(t){e.removeInteraction(this);var o;if(t.feature?(i=t.feature,o=i.getGeometry().getCoordinates()):o=t.coordinate,o){var n=r.getGeometry().getClosestPoint(o),s=a.distance(o,n);if(s<e._minCutPointDistance){var l=e._cut(r.getGeometry(),n);if(l){var c=l[0],u=l[1],p=e.editor.generateId();c.setId(p+"_1"),u.setId(p+"_2");var d=r.getProperties();if(delete d[r.getGeometryName()],e._showSelection(c.getGeometry(),300),setTimeout(function(){e._showSelection(u.getGeometry(),300)},300),"MODONCUT"==e._modType)e.steps.next(),e._selectLineToKeep(c,u).then(function(t){r.setGeometry(t.getGeometry().clone());var o;c.getId()==t.getId()?(delete c,o=u):u.getId()==t.getId()&&(delete u,o=c),e._newFeatures.push(o),o.setProperties(d),e.editingLayer.getSource().addFeatures([o]);var n={added:[o],updated:r,cutfeature:i};e.cutLine(n,e._modType).fail(function(){e._rollBack(),e.rerun()})});else{e.layer.getSource().removeFeature(r),e._newFeatures.push(c),e._newFeatures.push(u),e.editingLayer.getSource().addFeatures([featureToAdd,c]);var h={added:[c,u],removed:r};e.cutLine(h,e._modType).fail(function(){e._rollBack(),e.rerun()})}}else e.rerun()}}}),e.addInteraction(e._pointPickInteraction)})},u.pause=function(e){_.isUndefined(e)||e?(this._linePickInteraction.setActive(!1),this._pointPickInteraction.setActive(!1)):(this._linePickInteraction.setActive(!0),this._pointPickInteraction.setActive(!0))},u.rerun=function(){this.stop(),this.run()},u.stop=function(){this._cleanUp();var e=n(this,"stop");return e&&(this.removeInteraction(this._linePickInteraction),this.removeInteraction(this._pointPickInteraction),this._linePickInteraction=null,this._pointPickInteraction=null),e},u._cleanUp=function(){this.steps.completed(),this._origFeature=null,this._origGeometry=null,this._newFeatures=[],this._lineToKeepOverlay.setMap(null),this._selectedLineOverlay.setMap(null)},u._rollBack=function(){this._origFeature.setGeometry(this._origGeometry);try{_.forEach(this._newFeatures,function(e){self.editingLayer.getSource().removeFeature(e)})}catch(e){}},u._cutLine=function(e,t){if("MODONCUT"==t){var i=e.updated,r=e.added[0];this.editor.updateFeature(i),this.editor.addFeature(r)}else{var o=e.removed,n=e.added[0],a=e.added[1];this.editor.deleteFeature(o),this.editor.addFeature(n),this.editor.addFeature(a)}return this._busy=!1,this.pause(!1),this.rerun(),!0},u._selectLineToKeep=function(e,t){var i=$.Deferred(),r=this,o=this._lineToKeepOverlay;o.getSource().addFeatures([e,t]),o.setMap(this.editor.getMapService().viewer.map);var n=new s({layers:[this._lineToKeepOverlay]});return this.addInteraction(n),n.on("picked",function(e){o.setMap(null),r.removeInteraction(this),i.resolve(e.feature)}),i.promise()},u._fallBack=function(e){this._busy=!1,this.pause(!1)},u._cut=function(e,t){for(;t.length<e.getLayout().length;)t.push(0);var i=1/0,r=0,o=0;e.forEachSegment(function(e,n){var s=a.closestOnSegment(t,[e,n]),l=a.distance(t,s);l<i&&(i=l,r=o),o+=1});var n=e.getCoordinates(),s=n.slice(0,r+1);s.splice(s.length,0,t);var l=n.slice(r);if(l.splice(0,1,t),s.length<2||l.length<2)return!1;var c=new ol.geom.LineString;c.setCoordinates(s);var u=new ol.geom.LineString;u.setCoordinates(l);var p=new ol.Feature({geometry:c}),d=new ol.Feature({geometry:u});return[p,d]},u._showSelection=function(e,t){var i=this,t=t||null,r=this._selectedLineOverlay,o=new ol.Feature;o.setGeometry(e),r.getSource().addFeatures([o]),r.setMap(this.editor.getMapService().viewer.map),t&&setTimeout(function(){r.setMap(null),i._selectedLineOverlay.getSource().clear()},t)},u._isNew=function(e){return!_.isNil(this.editingLayer.getSource().getFeatureById(e.getId()))},r.steps=[{type:"selectline"},{type:"selectcutpoint"},{type:"selectparttokeep"}]},{"./editingtool":32,"core/geometry/geom":37,"core/utils/utils":80,"g3w-ol3/src/interactions/pickcoordinatesinteraction":103,"g3w-ol3/src/interactions/pickfeatureinteraction":104}],31:[function(e,t,i){function r(e){this.editor=e,this.drawInteraction=null,this.layer=null,this.editingLayer=null,this.setters={deleteFeature:r.prototype._deleteFeature},n(this,e)}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("g3w-ol3/src/interactions/deletefeatureinteraction"),s=e("./editingtool");o(r,s),t.exports=r;var l=r.prototype;ol.geom.GeometryType={POINT:"Point",LINE_STRING:"LineString",LINEAR_RING:"LinearRing",POLYGON:"Polygon",MULTI_POINT:"MultiPoint",MULTI_LINE_STRING:"MultiLineString",MULTI_POLYGON:"MultiPolygon",GEOMETRY_COLLECTION:"GeometryCollection",CIRCLE:"Circle"};var c={},u=[255,255,255,1],p=[255,0,0,1],d=3;c[ol.geom.GeometryType.POLYGON]=[new ol.style.Style({stroke:new ol.style.Stroke({color:"red",width:3}),fill:new ol.style.Fill({color:"rgba(255, 0, 0, 0.1)"})})],c[ol.geom.GeometryType.MULTI_POLYGON]=c[ol.geom.GeometryType.POLYGON],c[ol.geom.GeometryType.LINE_STRING]=[new ol.style.Style({stroke:new ol.style.Stroke({color:u,width:d+2})}),new ol.style.Style({stroke:new ol.style.Stroke({color:p,width:d})})],c[ol.geom.GeometryType.MULTI_LINE_STRING]=c[ol.geom.GeometryType.LINE_STRING],c[ol.geom.GeometryType.CIRCLE]=c[ol.geom.GeometryType.POLYGON].concat(c[ol.geom.GeometryType.LINE_STRING]),c[ol.geom.GeometryType.POINT]=[new ol.style.Style({image:new ol.style.Circle({radius:2*d,fill:new ol.style.Fill({color:p}),stroke:new ol.style.Stroke({color:u,width:d/2})}),zIndex:1/0})],c[ol.geom.GeometryType.MULTI_POINT]=c[ol.geom.GeometryType.POINT],c[ol.geom.GeometryType.GEOMETRY_COLLECTION]=c[ol.geom.GeometryType.POLYGON].concat(c[ol.geom.GeometryType.LINE_STRING],c[ol.geom.GeometryType.POINT]),c[ol.geom.GeometryType.POLYGON]=_.concat(c[ol.geom.GeometryType.POLYGON],c[ol.geom.GeometryType.LINE_STRING]),c[ol.geom.GeometryType.GEOMETRY_COLLECTION]=_.concat(c[ol.geom.GeometryType.GEOMETRY_COLLECTION],c[ol.geom.GeometryType.LINE_STRING]),l.run=function(){var e=this;this.layer=this.editor.getVectorLayer().getMapLayer(),this.editingLayer=this.editor.getEditVectorLayer().getMapLayer(),this._selectInteraction=new ol.interaction.Select({layers:[this.layer,this.editingLayer],condition:ol.events.condition.click,style:function(t,i){var r=e.editor._editingVectorStyle?e.editor._editingVectorStyle["delete"]:c[t.getGeometry().getType()];return r}}),this.addInteraction(this._selectInteraction),this._deleteInteraction=new a({features:this._selectInteraction.getFeatures()}),this.addInteraction(this._deleteInteraction),this._deleteInteraction.on("deleteend",function(t){var i=t.features.getArray()[0],r=e._isNew(i);e._busy||(e._busy=!0,e.pause(!0),e.deleteFeature(i,r).always(function(){e._busy=!1,e.pause(!1)}))})},l.pause=function(e){_.isUndefined(e)||e?(this._selectInteraction.setActive(!1),this._deleteInteraction.setActive(!1)):(this._selectInteraction.setActive(!0),this._deleteInteraction.setActive(!0))},l.stop=function(){return this._selectInteraction.getFeatures().clear(),this.removeInteraction(this._selectInteraction),this._selectInteraction=null,this.removeInteraction(this._deleteInteraction),this._deleteInteraction=null,!0},l._deleteFeature=function(e,t){var i=[],r=this.editor.getRelationsWithValues(e);return r.then(function(e){i=e}),this.editor.deleteFeature(e,i,t),this._selectInteraction.getFeatures().clear(),this._busy=!1,this.pause(!1),!0},l._fallBack=function(e){this._busy=!1,this.pause(!1)},l._isNew=function(e){return!_.isNil(this.editingLayer.getSource().getFeatureById(e.getId()))}},{"./editingtool":32,"core/utils/utils":80,"g3w-ol3/src/interactions/deletefeatureinteraction":100}],32:[function(e,t,i){function r(e,t){this._interactions=[],this.editor=e,this.layer=this.editor.getVectorLayer().getMapLayer(),this.editingLayer=this.editor.getEditVectorLayer().getMapLayer(),this.options=t||{},this.steps=null,n(this)}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/g3wobject");o(r,a);var s=r.prototype;s.addInteraction=function(e){var t=this.editor.getMapService();t.addInteraction(e),this._interactions.push(e)},s.removeInteraction=function(e){var t=this._interactions,i=this.editor.getMapService();_.forEach(t,function(i,r){i==e&&t.splice(r,1)}),i.removeInteraction(e)},s.ownsInteraction=function(e){var t=!1;return _.forEach(this._interactions,function(i){i==e&&(t=!0)}),t},s.stop=function(){return this.steps&&this.steps.destroy(),!0},s.run=function(){console.log("Se appare quasto messaggio significa che non è stato sovrascritto il metodo run() dalla sottoclasse")},r.Steps=function(e){var t=-1,e=e;this.next=function(){t+=1;var i=e[t];this.emit("step",t,i)},this.currentStep=function(){return e[t]},this.currentStepIndex=function(){return t},this.totalSteps=function(){return e.length},this.reset=function(){t=0},this.destroy=function(){this.removeAllListeners()},this.completed=function(){this.emit("complete"),this.reset()},this.insertStepAt=function(t,i){e.splice(t,0,i)}},o(r.Steps,a),t.exports=r},{"core/g3wobject":36,"core/utils/utils":80}],33:[function(e,t,i){function r(e,t){t=t||{},this.editor=e,this.isPausable=!0,this.drawInteraction=null,this._deleteCondition=t.deleteCondition||void 0,this._snap=t.snap||null,this._snapInteraction=null,this.setters={modifyFeature:r.prototype._modifyFeature},n(this,e)}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=(e("core/g3wobject"),e("g3w-ol3/src/interactions/pickfeatureinteraction")),s=e("./editingtool");o(r,s),t.exports=r;var l=r.prototype;l.run=function(){var e=this;this.pickedFeatures=new ol.Collection;var t=[this.editor.getVectorLayer().getMapLayer(),this.editor.getEditVectorLayer().getMapLayer()];this._pickInteraction=new a({layers:t}),this.addInteraction(this._pickInteraction),this._pickInteraction.on("picked",function(t){e.pickedFeatures.clear(),e.pickedFeatures.push(t.feature)}),this._modifyInteraction=new ol.interaction.Modify({features:this.pickedFeatures,deleteCondition:this._deleteCondition}),this.addInteraction(this._modifyInteraction);var i=null;this._modifyInteraction.on("modifystart",function(e){var t=e.features.getArray()[0];i=t.getGeometry().clone()}),this._modifyInteraction.on("modifyend",function(t){var r=t.features.getArray()[0],o=e._isNew(r);e._busy||(e._busy=!0,e.pause(!0),e.modifyFeature(r,o).fail(function(){r.setGeometry(i)}).always(function(){e._busy=!1,e.pause(!1)}))}),this._snap&&(this._snapInteraction=new ol.interaction.Snap({source:this._snap.vectorLayer.getSource()}),this.addInteraction(this._snapInteraction))},l.pause=function(e){_.isUndefined(e)||e?(this._snapInteraction&&this._snapInteraction.setActive(!1),this._pickInteraction.setActive(!1),this._modifyInteraction.setActive(!1)):(this._snapInteraction&&this._snapInteraction.setActive(!0),this._pickInteraction.setActive(!0),this._modifyInteraction.setActive(!0))},l.stop=function(){return this.pickedFeatures.clear(),this._snapInteraction&&(this.removeInteraction(this._snapInteraction),this._snapInteraction=null),this.removeInteraction(this._pickInteraction),this._pickInteraction=null,this.removeInteraction(this._modifyInteraction),this._modifyInteraction=null,!0},l._modifyFeature=function(e,t){return this.editor.updateFeature(e,t),this._busy=!1,this.pause(!1),!0},l.removePoint=function(e){if(this._modifyInteraction)try{this._modifyInteraction.removePoint()}catch(t){console.log(t)}},l._fallBack=function(e){this._busy=!1,this.pause(!1)},l._isNew=function(e){return!_.isNil(this.editingLayer.getSource().getFeatureById(e.getId()))}},{"./editingtool":32,"core/g3wobject":36,"core/utils/utils":80,"g3w-ol3/src/interactions/pickfeatureinteraction":104}],34:[function(e,t,i){function r(e){this.editor=e,this.isPausable=!0,this.drawInteraction=null,this._origGeometry=null,this.setters={moveFeature:{fnc:r.prototype._moveFeature,fallback:r.prototype._fallBack}},n(this,e)}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("./editingtool");o(r,a),t.exports=r;var s=r.prototype;s.run=function(){var e=this,t=[this.editor.getVectorLayer().getMapLayer(),this.editor.getEditVectorLayer().getMapLayer()],i=this.editor._editingVectorStyle?this.editor._editingVectorStyle.move:null;this._selectInteraction=new ol.interaction.Select({layers:t,condition:ol.events.condition.click,style:i,hitTolerance:isMobile&&isMobile.any?10:0}),this.addInteraction(this._selectInteraction),this._translateInteraction=new ol.interaction.Translate({features:this._selectInteraction.getFeatures(),hitTolerance:isMobile&&isMobile.any?10:0}),this.addInteraction(this._translateInteraction),this._translateInteraction.on("translatestart",function(t){var i=t.features.getArray()[0];e._origGeometry=i.getGeometry().clone(),e.editor.emit("movestart",i)}),this._translateInteraction.on("translateend",function(t){var i=t.features.getArray()[0];e._busy||(e._busy=!0,e.pause(),e.moveFeature(i).then(function(t){e.pause(!1)}).fail(function(){i.setGeometry(e._origGeometry)}))})},s.pause=function(e){_.isUndefined(e)||e?(this._selectInteraction.setActive(!1),this._translateInteraction.setActive(!1)):(this._selectInteraction.setActive(!0),this._translateInteraction.setActive(!0))},s.stop=function(){return this._selectInteraction.getFeatures().clear(),this.removeInteraction(this._selectInteraction),this._selectInteraction=null,this.removeInteraction(this._translateInteraction),this._translateInteraction=null,!0},s._moveFeature=function(e){return this.editor.emit("moveend",e),this.editor.moveFeature(e),this._selectInteraction.getFeatures().clear(),this._busy=!1,this.pause(!1),!0},s._fallBack=function(e){this._busy=!1,this.pause(!1)}},{"./editingtool":32,"core/utils/utils":80}],35:[function(e,t,i){function r(e){this.isPausable=!0,this.pickFeatureInteraction=null,this._running=!1,this._busy=!1,this._originalFeatureStyle=null,this.setters={pickFeature:{fnc:r.prototype._pickFeature,fallback:r.prototype._fallBack}},n(this,e)}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=(e("core/utils/utils").noop,e("g3w-ol3/src/interactions/pickfeatureinteraction")),s=e("./editingtool");o(r,s),t.exports=r;var l=r.prototype;l._pickFeature=function(e){this.editor.pickFeature(e)},l.run=function(){var e=this,t=(new ol.style.Style({image:new ol.style.Circle({radius:5,fill:new ol.style.Fill({color:"red"})})}),this.editor._editingVectorStyle?this.editor._editingVectorStyle.edit:null),i=[this.editor.getVectorLayer().getMapLayer(),this.editor.getEditVectorLayer().getMapLayer()];this.pickFeatureInteraction=new a({layers:i}),this.pickFeatureInteraction.on("picked",function(i){e.editor.setPickedFeature(i.feature),e._busy||(i.feature.setStyle(t),e._busy=!0,e.pause(!0),e.pickFeature(i.feature).then(function(t){e._busy=!1,e.pause(!1)}))}),this.addInteraction(this.pickFeatureInteraction)},l.pause=function(e){_.isUndefined(e)||e?this.pickFeatureInteraction.setActive(!1):this.pickFeatureInteraction.setActive(!0)},l.stop=function(){return this.removeInteraction(this.pickFeatureInteraction),this.pickFeatureInteraction=null,!0},l._fallBack=function(e){this._busy=!1,this.pause(!1)}},{"./editingtool":32,"core/utils/utils":80,"g3w-ol3/src/interactions/pickfeatureinteraction":104}],36:[function(e,t,i){var r=e("core/utils/utils").inherit,o=e("core/utils/utils").noop,n=function(){this.setters&&this._setupListenersChain(this.setters)};r(n,EventEmitter);var a=n.prototype;a.onafter=function(e,t,i){return this._onsetter("after",e,t,!1,i)},a.onbefore=function(e,t,i){return this._onsetter("before",e,t,!1,i)},a.onbeforeasync=function(e,t,i){return this._onsetter("before",e,t,!0,i)},a.un=function(e,t){_.forEach(this.settersListeners,function(i){_.forEach(i[e],function(r,o){r.key==t&&i[e].slice(o,1)})})},a._onsetter=function(e,t,i,r,o){var n=this.settersListeners[e],a=""+Math.floor(1e6*Math.random())+Date.now();o=o||0;var s=n[t];return s.push({key:a,fnc:i,async:r,priority:o}),n[t]=_.sortBy(s,function(e){return e.priority}),a},a._setupListenersChain=function(e){var t=this;this.settersListeners={after:{},before:{}},_.forEach(e,function(e,i){var r=o,n=o;_.isFunction(e)?r=e:(r=e.fnc,n=e.fallback||o),t.settersListeners.after[i]=[],t.settersListeners.before[i]=[],t[i]=function(){function e(){c=r.apply(t,s),l.resolve(c);var e=t.settersListeners.after[i];_.forEach(e,function(e){e.fnc.apply(t,s)})}function o(){n.apply(t,s),l.reject()}function a(r){var n=!0;_.isBoolean(r)&&(n=r);var l=Array.prototype.slice.call(s);if(n===!1||u==p.length)n===!1?o.apply(t,s):(completed=e.apply(t,s),(_.isUndefined(completed)||completed===!0)&&t.emitEvent("set:"+i,s));else if(n){var c=p[u].fnc;if(p[u].async)l.push(a),u+=1,c.apply(t,l);else{var d=c.apply(t,l);u+=1,a(d)}}}var s=arguments,l=$.Deferred(),c=null,u=0,p=t.settersListeners.before[i];return u=0,a(),l.promise()}})},a.un=function(e){_.forEach(this.settersListeners,function(t){_.forEach(t,function(i,r){i.key==e&&t.splice(r,1)})})},t.exports=n},{"core/utils/utils":80}],37:[function(e,t,i){var r={distance:function(e,t){return Math.sqrt(r.squaredDistance(e,t))},squaredDistance:function(e,t){var i=e[0],r=e[1],o=t[0],n=t[1],a=o-i,s=n-r;return a*a+s*s},closestOnSegment:function(e,t){var i,r,o=e[0],n=e[1],a=t[0],s=t[1],l=a[0],c=a[1],u=s[0],p=s[1],d=u-l,h=p-c,m=0===d&&0===h?0:(d*(o-l)+h*(n-c))/(d*d+h*h||0);return m<=0?(i=l,r=c):m>=1?(i=u,r=p):(i=l+m*d,r=c+m*h),[i,r]}};t.exports=r},{}],38:[function(e,t,i){var r={};r.GeometryTypes={POINT:"Point",MULTIPOINT:"MultiPoint",LINESTRING:"Line",MULTILINESTRING:"MultiLine",POLYGON:"Polygon",MULTIPOLYGON:"MultiPolygon",GEOMETRYCOLLECTION:"GeometryCollection"},r.SupportedGeometryTypes=[r.GeometryTypes.POINT,r.GeometryTypes.MULTIPOINT,r.GeometryTypes.LINESTRING,r.GeometryTypes.MULTILINESTRING,r.GeometryTypes.POLYGON,r.GeometryTypes.MULTIPOLYGON],t.exports=r},{}],39:[function(e,t,i){function r(e){i18next.use(i18nextXHRBackend).init({lng:"it",ns:"app",fallbackLng:"it",resources:e.resources}),jqueryI18next.init(i18next,$,{tName:"t",i18nName:"i18n",handleName:"localize",selectorAttr:"data-i18n",targetAttr:"data-i18n-target",optionsAttr:"data-i18n-options",
useOptionsAttr:!1,parseDefaultValueFromContent:!0})}var o=function(e){var t=i18next.t(e);return t};t.exports={init:r,t:o}},{}],40:[function(e,t,i){var r=function(e){ol.Feature.call(this),e=e||{};var t=e.feature;if(t){this.setId(t.getId()),this.setProperties(t.getProperties()),this.setGeometryName(t.getGeometryName());var i=t.getGeometry();i&&this.setGeometry(i);var r=this.getStyle();r&&this.setStyle(r)}this.state={}};ol.inherits(r,ol.Feature),proto=r.prototype,proto.setState=function(e){this.state=e},proto.getState=function(){return this.state},t.exports=r},{}],41:[function(e,t,i){function r(e){var t=this;e=e||{},this._features=[],this._provider=e.provider||null,this.setters={addFeatures:function(e){_.forEach(e,function(e){t._addFeature(e)})},addFeature:function(e){t._addFeature(e)},removeFeature:function(e){t._removeFeature(e)},clearFeatures:function(){t._clearFeatures()}},n(this)}var o=e("core/utils/utils").inherit,n=e("core/utils//utils").base,a=e("core/g3wobject");o(r,a),proto=r.prototype,proto.getFeatures=function(e){var t=this,i=$.Deferred();return this._provider.getFeatures(e).then(function(e){console.log(e),t.addFeatures(e),i.resolve(t._features)}),i.promise()},proto._addFeature=function(e){this._features.push(e)},proto._removeFeature=function(e){this._features.push(e)},proto._clearFeatures=function(){this._features.splice(0,this._features.length)},proto.getDataProvider=function(){return this._dataprovider},t.exports=r},{"core/g3wobject":36,"core/utils//utils":80,"core/utils/utils":80}],42:[function(e,t,i){function r(e){e=e||{}}var o={eq:"=",gt:">",gte:">=",lt:"<",lte:"=<",LIKE:"LIKE",ILIKE:"ILIKE",AND:"AND",OR:"OR",NOT:"!="},n=r.prototype;n._createFilter=function(e,t){function i(e){var t,r=[],n="",a="",s="'";return _.forEach(e,function(e,l,c){t=o[l],_.forEach(e,function(e){a="",_.forEach(e,function(t,l,c){if(_.isArray(t))n=i(c);else{"LIKE"!=l&&"ILIKE"!=l||(a="%"),filterOp=o[l];_.forEach(e,function(e,t,i){_.forEach(e,function(e,t,i){_.isNull(e)||_.isNaN(e)||""==_.trim(e)||(n='"'+t+'" '+filterOp+" "+s+a+e+a+s,r.push(n))})})}})}),t=r.length>0&&r.join(" "+t+" ")}),t}return!!i(e)&&t+":"+i(e)},t.exports=r},{}],43:[function(e,t,i){function r(){this._bbox=null,this._geometry=null,this._fids=null,this._expression=null}var o=(e("./expression"),r.prototype);o.setExpression=function(e){this._expression=e},o.getExpression=function(){return this._expression},o.setGeometry=function(e){return this._geometry=e,this},o.getGeometry=function(){return this._geometry},o.setBBOX=function(e){return this._bbox=[e],this},o.getBBOX=function(){return this._bbox},o.setFids=function(e){return this._fids=e,this},o.getFids=function(){return this._fids},o.serialize=function(){return JSON.stringify(this)},t.exports=r},{"./expression":42}],44:[function(e,t,i){function r(e){}var o=(e("core/layers/layer"),e("g3w-ol3/src/projection/projections")),n=r.prototype;n.setup=function(e){return this.config?(this.config.multilayerid=e.multilayer,_.extend(this.state,{geolayer:!0,bbox:e.bbox||null}),void(e.projection?this.config.projection=e.projection:e.crs&&e.project&&(e.project.getProjection().getCode()!=e.crs?o.get(e.crs,e.proj4):this.config.projection=e.project.getProjection()))):void console.log("GeoLayerMixin must be used from a valid (geo) Layer instance")},n.getConfig=function(){return this.config},n.getState=function(){return this.state},n.getMultiLayerId=function(){return this.config.multilayerid},n.getGeometryType=function(){return this.config.geometrytype},n.getMultiLayerId=function(){return this.config.multilayerid},n.setProjection=function(e,t){this.config.projection=o.get(e,t)},n.getProjection=function(){return this.config.projection},n.getCrs=function(){if(this.config.projection)return this.config.projection.getCode()},n.isCached=function(){return this.config.cache_url&&""!=this.config.cache_url},n.getCacheUrl=function(){if(this.isCached())return this.config.cache_url},t.exports=r},{"core/layers/layer":46,"g3w-ol3/src/projection/projections":109}],45:[function(e,t,i){function r(e){e=e||{},n(this,e),this.config.baselayer=e.baselayer||!1,this.type=s.LayerTypes.IMAGE,this.setup(e)}var o=e("core/utils/utils").inherit,n=e("core/utils//utils").base,a=e("core/utils/utils").mixin,s=e("core/layers/layer"),l=e("./vectorlayer"),c=e("./geolayermixin");o(r,s),a(r,c);var u=r.prototype;u.getEditingLayer=function(){if(this.isEditable()){var e=_.cloneDeep(this.config);return new l(e)}},u.isBaseLayer=function(){return this.config.baselayer},u.isWMS=function(){return r.WMSServerTypes.indexOf(this.config.servertype)>-1},u.isExternalWMS=function(){return this.config.source&&this.config.source.url},u.getWMSLayerName=function(){var e=this.config.name;return this.config.source&&this.config.source.layers&&(e=this.config.source.layers),e},u.getWmsUrl=function(){var e;return e=this.config.source&&"wms"==this.config.source.type&&this.config.source.url?this.config.source.url:this.config.wmsUrl},u.getQueryUrl=function(){var e=n(this,"getQueryUrl");return"QGIS"==this.getServerType()&&this.config.source&&"wms"==this.config.source.type&&this.config.source.external&&(e+="SOURCE=wms"),e},u.getLegendUrl=function(){var e=this.getWmsUrl();return sep=e.indexOf("?")>-1?"&":"?",e+sep+"SERVICE=WMS&VERSION=1.3.0&REQUEST=GetLegendGraphic&SLD_VERSION=1.1.0&FORMAT=image/png&TRANSPARENT=true&ITEMFONTCOLOR=white&LAYERTITLE=True&ITEMFONTSIZE=10&WIDTH=300&LAYER="+this.getWMSLayerName()},u.getWFSLayerName=function(){var e=this.config.origname;return this.config.source&&this.config.source.layers&&(e=this.config.source.layers),e},u.getWfsCapabilities=function(){return this.config.wfscapabilities||1==this.config.capabilities},r.WMSServerTypes=[s.ServerTypes.QGIS,s.ServerTypes.Mapserver,s.ServerTypes.Geoserver,s.ServerTypes.OGC],t.exports=r},{"./geolayermixin":44,"./vectorlayer":59,"core/layers/layer":46,"core/utils//utils":80,"core/utils/utils":80}],46:[function(e,t,i){function r(e){var t=this;e=e||{},this.config=_.extend({id:e.id||"Layer",title:e.title||null,name:e.name||null,origname:e.origname||null,capabilities:e.capabilities||null,editops:e.editops||null,infoformat:e.infoformat||null,infourl:e.infourl||null,servertype:e.servertype||null,source:e.source||null,geolayer:!1},e),this.state={id:e.id,title:e.name,visible:e.visible,selected:e.selected|!1,disabled:e.disabled|!1,editing:!1,modified:!1,hidden:e.hidden||!1},this.type=null,this.fields=e.fields,this.relations=e.relations||null,this.setters={startEditing:function(){t._startEditing()},stopEditing:function(){t._stopEditing()},clearFeatures:function(){t._clearFeatures()}};var i=this.config.servertype,r=this.config.source.type;this.providers={query:s.build("query",i,r,{layer:this}),filter:s.build("filter",i,r,{layer:this}),data:s.build("data",i,r,{layer:this})},n(this)}var o=e("core/utils/utils").inherit,n=e("core/utils//utils").base,a=e("core/g3wobject"),s=e("core/layers/providers/providersfactory");o(r,a);var l=r.prototype;l.getProject=function(){return this.config.project},l.getConfig=function(){return this.config},l.getState=function(){return this.state},l.getEditingLayer=function(){return self},l.isHidden=function(){return this.state.hidden},l.setHidden=function(e){this.state.hidden=!_.isBoolean(e)||e},l.isModified=function(){return this.state.modified},l.getId=function(){return this.config.id},l.getTitle=function(){return this.config.title},l.getName=function(){return this.config.name},l.getOrigName=function(){return this.config.origname},l.getServerType=function(){return this.config.servertype&&""!=this.config.servertype?this.config.servertype:ServerTypes.QGIS},l.getType=function(){return this.type},l.isSelected=function(){return this.state.selected},l.isDisabled=function(){return this.state.disabled},l.isVisible=function(){return this.state.visible},l.isQueryable=function(){var e=!1,t=this.config.capabilities&&this.config.capabilities&r.CAPABILITIES.QUERYABLE;return t&&(e=this.state.visible&&!this.state.disabled,_.isUndefined(this.config.infowhennotvisible)||this.config.infowhennotvisible!==!0||(e=!0)),e},l.isFilterable=function(){return void 0!=this.providers.filter},l.isEditable=function(){return"QGIS"==this.config.servertype&&[r.SourceTypes.POSTGIS,r.SourceTypes.SPATIALITE].indexOf(this.config.source.type)>-1},l.query=function(e){e=e||{};var t=$.Deferred(),i=(e.type,this.providers.query);return e.filter&&(i=this.providers.filter),i?i.query(e).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}):t.reject("Il layer non è interrogabile tramite filtri"),t.promise()},l.getQueryUrl=function(){var e;return e=this.config.infourl&&""!=this.config.infourl?this.config.infourl:this.config.wmsUrl},l.setQueryUrl=function(e){this.config.inforurl=e},l.getQueryLayerName=function(){var e;return e=this.config.infolayer&&""!=this.config.infolayer?this.config.infolayer:this.config.name},l.getQueryLayerOrigName=function(){var e;return e=this.state.infolayer&&""!=this.config.infolayer?this.config.infolayer:this.config.origname},l.getInfoFormat=function(e){return this.config.infoformat&&""!=this.config.infoformat&&"wfs"!=e?this.config.infoformat:"application/vnd.ogc.gml"},l.setInfoFormat=function(e){this.state.infoformat=e},l.getAttributes=function(){return this.fields},l.changeAttribute=function(e,t,i){_.forEach(this.fields,function(r){r.name==e&&(r.type=t,r.options=i)})},l.getAttributeLabel=function(e){var t;return _.forEach(this.getAttributes(),function(i){i.name==e&&(t=i.label)}),t},l.getRelations=function(){return this.state.relations},l.getRelationAttributes=function(e){var t=[];return _.forEach(this.state.relations,function(i){if(i.name==e)return t=i.fields,!1}),t},l.getRelationsAttributes=function(){var e={};return _.forEach(this.state.relations,function(t){e[t.name]=t.fields}),e},l.getProvider=function(e){return this.providers[e]},r.LayerTypes={TABLE:"table",IMAGE:"image",VECTOR:"vector"},r.ServerTypes={OGC:"OGC",QGIS:"QGIS",Mapserver:"Mapserver",Geoserver:"Geoserver",ArcGIS:"ArcGIS",OSM:"OSM",Bing:"Bing",Local:"Local"},r.SourceTypes={POSTGIS:"postgres",SPATIALITE:"spatialite",CSV:"delimitedtext",WMS:"wms"},r.CAPABILITIES={QUERYABLE:1,FILTERABLE:3,EDITABLE:5},r.EDITOPS={INSERT:1,UPDATE:2,DELETE:4},t.exports=r},{"core/g3wobject":36,"core/layers/providers/providersfactory":53,"core/utils//utils":80,"core/utils/utils":80}],47:[function(e,t,i){function r(){this.build=function(e){var t=this.get(e);return t?new t(e):null},this.get=function(e){var t,i=e.servertype;if("QGIS"==i)t=s,e.source&&e.geometrytype&&[o.SourceTypes.POSTGIS,o.SourceTypes.SPATIALITE,o.SourceTypes.CSV].indexOf(e.source.type)>-1&&e.geometrytype&&void 0==e.geometrytype&&(t=n);else if("OGC"==i){if(e.source){var r=e.source.type;switch(r){case"WMS":t=s;break;case"WFS":t=a}}}else"Local"==i&&(t=a);return t}}var o=e("./layer"),n=e("./tablelayer"),a=e("./vectorlayer"),s=e("./imagelayer");t.exports=new r},{"./imagelayer":45,"./layer":46,"./tablelayer":58,"./vectorlayer":59}],48:[function(e,t,i){function r(e){e=e||{},this.config={id:e.id||Date.now(),projection:e.projection,extent:e.extent,initextent:e.initextent,wmsUrl:e.wmsUrl,catalog:!_.isBoolean(e.catalog)||e.catalog},this.state={layerstree:[]},this._layers=this.config.layers||{},this.setters={setLayersVisible:function(e,t){var i=this;_.forEach(e,function(e){i.getLayerById(e).state.visible=t})},setLayerSelected:function(e,t){var i=this.getLayers();_.forEach(i,function(i){i.state.selected=e==i.getId()&&t||!1})},addLayer:function(e){this._addLayer(e)},removeLayer:function(e){this._removeLayer(e)}},n(this)}var o=e("core/utils/utils").inherit,n=e("core/utils//utils").base,a=e("core/g3wobject");o(r,a),proto=r.prototype,proto.showOnCatalog=function(){return this.config.catalog},proto.setOptions=function(e){this.config=e},proto.getId=function(){return this.config.id},proto._addLayer=function(e){this._layers[e.getId()]=e},proto.addLayers=function(e){var t=this;_.forEach(e,function(e){t.addLayer(e)})},proto._removeLayer=function(e){delete this._layers[e]},proto.removeLayers=function(e){_.forEach(e,function(e){self.removeLayer(layer)})},proto.getLayersDict=function(e){if(!e)return this._layers;var e=e||{},t=e.ACTIVE,i=e.QUERYABLE,r=e.FILTERABLE,o=e.EDITABLE,n=e.VISIBLE,a=e.SELECTED,s=e.CACHED,l=e.SELECTEDORALL,c=e.ALLNOTSELECTED,u=e.SERVERTYPE,p=e.BASELAYER||!1,d=e.GEOLAYER,h=e.HIDDEN;e.WFS;if(l&&(a=null),_.isUndefined(i)&&_.isUndefined(r)&&_.isUndefined(o)&&_.isUndefined(n)&&_.isUndefined(t)&&_.isUndefined(a)&&_.isUndefined(s)&&_.isUndefined(l)&&_.isUndefined(u)&&_.isUndefined(d)&&_.isUndefined(h)&&_.isUndefined(p))return this._layers;var m=[];if(_.forEach(this._layers,function(e,t){m.push(e)}),"boolean"==typeof t&&(m=_.filter(m,function(e){return t==!e.isDisabled()})),"boolean"==typeof i&&(m=_.filter(m,function(e){return i==e.isQueryable()})),"boolean"==typeof r&&(m=_.filter(m,function(e){return r==e.isFilterable()})),"boolean"==typeof o&&(m=_.filter(m,function(e){return o==e.isEditable()})),"boolean"==typeof n&&(m=_.filter(m,function(e){return n==e.isVisible()})),"boolean"==typeof s&&(m=_.filter(m,function(e){return s==e.isCached()})),"boolean"==typeof a&&(m=_.filter(m,function(e){return a==e.isSelected()})),"boolean"==typeof p&&(m=_.filter(m,function(e){return p==e.isBaseLayer()})),"boolean"==typeof d&&(m=_.filter(m,function(e){return d==e.state.geolayer})),"boolean"==typeof h&&(m=_.filter(m,function(e){return h==e.isHidden()})),"string"==typeof u&&""!=u&&(m=_.filter(m,function(e){return u=e.getServerType()})),l){var f=m;m=_.filter(m,function(e){return e.isSelected()}),m=m.length?m:f}if(c){var f=m;m=_.filter(m,function(e){return!e.isSelected()}),m=m.length?m:f}return m},proto.getLayers=function(e){var t=this.getLayersDict(e);return _.values(t)},proto.getBaseLayers=function(){return this.getLayersDict({BASELAYER:!0})},proto.getLayerById=function(e){return this.getLayersDict()[e]},proto.getLayerByName=function(e){var t=null;return _.forEach(this.getLayersDict(),function(t){t.getName()==e&&(t=_layer)}),t},proto.getLayerAttributes=function(e){return this.getLayerById(e).getAttributes()},proto.getLayerAttributeLabel=function(e,t){return this.getLayerById(e).getAttributeLabel(t)},proto.getGeoLayers=function(){return this.getLayers({GEOLAYER:!0})},proto.toggleLayer=function(e,t){var i=this.getLayerById(e),t=t||!i.state.visible;this.setLayersVisible([e],t)},proto.toggleLayers=function(e,t){this.setLayersVisible(e,t)},proto.selectLayer=function(e){this.setLayerSelected(e,!0)},proto.unselectLayer=function(e){this.setLayerSelected(e,!1)},proto.getProjection=function(){return this.config.projection},proto.getExtent=function(){return this.config.extent},proto.getInitExtent=function(){return this.config.initextent},proto.getWmsUrl=function(){return this.config.wmsUrl},proto.setLayersTree=function(e,t){function i(e){_.forIn(e,function(t,o){_.isNil(t.id)||(e[o]=r.getLayerById(t.id).getState()),_.isNil(t.nodes)||i(t.nodes)})}var r=this;i(e),this.state.layerstree.splice(0,0,{title:t||this.config.id,expanded:!0,nodes:e})},proto.createLayersTree=function(e,t){function i(e,t){_.forIn(e,function(e){var r={};_.isNil(e.id)||(r.id=e.id),_.isNil(e.nodes)||(r.title=e.name,r.expanded=e.expanded,r.nodes=[],i(e.nodes,r.nodes)),t.push(r)})}var t=t||{},r=t.full||!1,o=t.layerstree||null,n=[];if(o){if(r===!0)return this.state.layerstree;i(o,n)}else _.forEach(this.getGeoLayers(),function(e){n.push({id:e.getId(),name:e.getName(),title:e.getTitle(),visible:e.isVisible()||!1})});this.setLayersTree(n,e)},proto.removeLayersTree=function(e){this.state.layerstree.splice(0,this.state.layerstree.length)},proto.getLayersTree=function(e){return this.state.layerstree},t.exports=r},{"core/g3wobject":36,"core/utils//utils":80,"core/utils/utils":80}],49:[function(e,t,i){function r(){this.stores={},this.storesArray=[],this.setters={addLayersStore:function(e,t){this._addLayersStore(e,t)},removeLayersStore:function(e){this._removeLayersStore(e)}},n(this)}var o=e("core/utils/utils").inherit,n=e("core/utils//utils").base,a=e("core/g3wobject");o(r,a),proto=r.prototype,proto.getLayersStore=function(e){return this.stores[e]},proto.getLayersStores=function(){var e=this,t=[];return _.forEach(this.storesArray,function(i){t.push(e.stores[i])}),t},proto._addLayersStore=function(e,t){var i=e.getId();this.stores[i]=e,_.isNil(t)?this.storesArray.push(i):this.storesArray.splice(t,0,i)},proto._removeLayersStore=function(e){if(e){var t=e.getId(),i=this.storesArray.indexOf(t);delete this.stores[t],this.storesArray.splice(i,1)}},t.exports=r},{"core/g3wobject":36,"core/utils//utils":80,"core/utils/utils":80}],50:[function(e,t,i){function r(e){e=e||{},n(this),this._name="geojson"}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/layers/providers/provider");o(r,a);var s=r.prototype;s.getFearures=function(){var e=$.Deferred();return e.promise()},s._getVectorLayerConfig=function(e){var t=$.Deferred();return $.get(this._baseUrl+e+"/?config"+this._customUrlParameters).done(function(e){t.resolve(e)}).fail(function(){t.reject()}),t.promise()},s._getVectorLayerData=function(e,t){var i,r=$.Deferred(),o="w"==this.getMode();return i=o?this._baseUrl+e[this._editingApiField]+"/?editing":this._baseUrl+e[this._editingApiField]+"/?",$.get(i+this._customUrlParameters+"&in_bbox="+t[0]+","+t[1]+","+t[2]+","+t[3]).done(function(e){r.resolve(e)}).fail(function(){r.reject()}),r.promise()},t.exports=r},{"core/layers/providers/provider":52,"core/utils/utils":80}],51:[function(e,t,i){function r(e){e=e||{},n(this),this._name="kml"}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/layers/providers/provider");o(r,a);var s=r.prototype;s.getData=function(){var e=$.Deferred();return e.promise()},t.exports=r},{"core/layers/providers/provider":52,"core/utils/utils":80}],52:[function(e,t,i){function r(e){e=e||{},this._isReady=!1,this._name="provider",this._layer=e.layer,n(this)}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/g3wobject");e("core/layers/features/feature");o(r,a);var s=r.prototype;s.getFeatures=function(){console.log("da sovrascrivere")},s.query=function(e){console.log("metodo da sovrascrivere")},s.setReady=function(e){this._isReady=e},s.isReady=function(){return this._isReady},s.error=function(){},s.isValid=function(){console.log("deve essere implementatato dai singoli provider")},s.getName=function(){return this._name},s.handleQueryResponseFromServer=function(e,t){var i,r,o,n,a,s=this;switch(this._layer.getInfoFormat()){case"json":r=this._parseLayerGeoJSON,o=e.vector.data;break;default:var l=new X2JS;try{i=_.isString(e)?l.xml_str2json(e):l.xml2json(e)}catch(c){return}var u=_.keys(i)[0];switch(u){case"FeatureCollection":r=this._parseLayerFeatureCollection,o=i;break;case"msGMLOutput":r=this._parseLayermsGMLOutput,o=e;break;case"ServiceExceptionReport":a="an error occured while querying the layer",i.ServiceExceptionReport.ServiceException&&(a=i.ServiceExceptionReport.ServiceException.toString())}}return r&&(n=r.call(s,o,t)),[{layer:this._layer,features:n,error:a}]},s._parseLayerFeatureCollection=function(e,t){var i="wfs"==t?this._layer.getWMSLayerName().replace(/ /g,"_"):this._layer.getWMSLayerName().replace(/ /g,""),r=_.cloneDeep(e);r.FeatureCollection.featureMember=[];var o=e.FeatureCollection.featureMember;o=_.isArray(o)?o:[o],_.forEach(o,function(e){var t=_.get(e,i);t&&r.FeatureCollection.featureMember.push(e)});var n=new X2JS,a=n.json2xml_str(r),s=new ol.format.WMSGetFeatureInfo;return s.readFeatures(a)},s._parseLayermsGMLOutput=function(e){var t=this._layer.getQueryLayerOrigName(),i=new ol.format.WMSGetFeatureInfo({layers:t});return i.readFeatures(e)},s._parseLayerGeoJSON=function(e){var t=new ol.format.GeoJSON({defaultDataProjection:this.crs,geometryName:"geometry"});return t.readFeatures(e)},t.exports=r},{"core/g3wobject":36,"core/layers/features/feature":40,"core/utils/utils":80}],53:[function(e,t,i){function r(){this.build=function(e,t,i,r){var o=this.get(e,t,i);return o?new o(r):null},this.get=function(e,t,i){return n[t][i][e]}}var o={geojson:e("./geojsonprovider"),kml:e("./kmlprovider"),xml:e("./xmlprovider"),qgis:e("./qgisprovider"),wms:e("./wmsprovider"),wfs:e("./wfsprovider")},n={QGIS:{postgres:{query:o.wms,filter:o.qgis,data:o.qgis},spatialite:{query:o.wms,filter:o.qgis,data:o.qgis},ogr:{query:o.wms,filter:o.wfs,data:null},delimitedtext:{query:o.wms,filter:o.wfs,data:null},wms:{query:o.wms,filter:o.wfs,data:null},wfs:{query:o.wms,filter:o.wfs,data:o.wfs},gdal:{query:o.wms,filter:null,data:null}},OGC:{wms:{query:o.wms,filter:null,data:null}}};t.exports=new r},{"./geojsonprovider":50,"./kmlprovider":51,"./qgisprovider":54,"./wfsprovider":55,"./wmsprovider":56,"./xmlprovider":57}],54:[function(e,t,i){function r(e){e=e||{},n(this),this._name="qgis",this._layer=e.layer||null,this._layerName=e.layerName||null,this._infoFormat=e.infoFormat||"application/vnd.ogc.gml"}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/layers/providers/provider"),s=e("core/layers/features/feature");o(r,a);var l=r.prototype;l.query=function(e){var t=$.Deferred();e=e||{};var i=e.filter||null;return i&&(i.bbox,t.resolve({query:"",data:[{features:[],layer:this._layer}]})),t.promise()},l.getFeatures=function(e){var t=$.Deferred();e=e||{};var i=[],r=c;return _.forEach(this._parseLayerGeoJSON(r),function(e){i.push(new s({feature:e}))}),t.resolve(i),t.promise()},l._loadLayerData=function(e,t){var i=this,r=$.Deferred();_.forEach(this._layers,function(e,t){_.isNull(e.vector)&&noVectorlayerCodes.push(t)});var o=_.map(noVectorlayerCodes,function(e){return i._setupVectorLayer(e)});return i.emit("loadingvectorlayersstart"),$.when.apply(this,o).then(function(){var e=Array.prototype.slice.call(arguments);i.emit("loadingvectolayersdatastart"),i.loadAllVectorsData(e).then(function(){i._vectorLayersCodes=e,r.resolve(e),i.emit("loadingvectorlayersend"),i.setReady(!0)}).fail(function(){_.forEach(i._layers,function(e){e.vector=null}),r.reject(),i.emit("errorloadingvectorlayersend"),i.setReady(!1)})}).fail(function(){i.setReady(!1),i.emit("errorloadingvectorlayersend"),r.reject()}),r.promise()},l.setVectorLayersCodes=function(e){this._vectorLayersCodes=e},l.getVectorLayersCodes=function(){return this._vectorLayersCodes},l.getLayers=function(){return this._layers},l.reloadVectorData=function(e){var t=this,i=$.Deferred(),r=this._mapService.state.bbox;return t._createVectorLayerFromConfig(e).then(function(e){t._getVectorLayerData(e,r).then(function(r){t.setVectorLayerData(e[t._editingApiField],r),e.setData(r.vector.data),i.resolve(e)})}),i.promise()},l.loadAllVectorsData=function(e){var t=this,i=$.Deferred(),r=this._layers,o=this._mapService.state.bbox,n=this._loadedExtent;if(n&&ol.extent.containsExtent(n,o))return resolvedValue();n?this._loadedExtent=ol.extent.extend(n,o):this._loadedExtent=o,e&&(r=[],_.forEach(e,function(e){r.push(t._layers[e])}));var a=_.map(r,function(e){return t._loadVectorData(e.vector,o)});return $.when.apply(this,a).then(function(){i.resolve(e)}).fail(function(){i.reject()}),i.promise()},l._setCustomUrlParameters=function(e){this._customUrlParameters=e},l._checkVectorGeometryTypeFromConfig=function(e){switch(e.geometrytype){case"Line":e.geometrytype="LineString";break;case"MultiLine":e.geometrytype="MultiLineString"}return e},l._createVectorLayerFromConfig=function(e){var t=this,i=this._layers[e],r=$.Deferred();return this._getVectorLayerConfig(i[this._editingApiField]).then(function(e){var o=e.vector;o=t._checkVectorGeometryTypeFromConfig(o);var n=i.crs||t._mapService.getProjection().getCode(),a=t._createVectorLayer({geometrytype:o.geometrytype,format:o.format,crs:t._mapService.getProjection().getCode(),crsLayer:n,id:i.id,name:i.name,pk:o.pk,editing:t._editingMode});a.setFields(o.fields),a.setCrs(n);var s=o.relations;s&&(a.lazyRelations=!0,a.setRelations(s)),i.style&&a.setStyle(i.style),r.resolve(a)}).fail(function(){r.reject()}),r.promise()},l._setupVectorLayer=function(e){var t=this,i=$.Deferred();return this._createVectorLayerFromConfig(e).then(function(r){var o=t._layers[e];o.vector=r,i.resolve(e)}).fail(function(){i.reject()}),i.promise()},l._loadVectorData=function(e,t){var i=this;return i._getVectorLayerData(e,t).then(function(t){if(i.setVectorLayerData(e[i._editingApiField],t),i._editingMode&&t.featurelocks&&i.setVectorFeaturesLock(e,t.featurelocks),e.setData(t.vector.data),i._)return t}).fail(function(){return!1})},l.getVectorLayerData=function(e){return this._vectorLayersData[e]},l.getVectorLayersData=function(){return this._vectorLayersData},l.setVectorLayerData=function(e,t){this._vectorLayersData[e]=t},l.setVectorFeaturesLock=function(e,t){var i=_.differenceBy(t,e.getFeatureLocks(),"featureid");_.forEach(i,function(t){e.addLockId(t)})},l.cleanVectorFeaturesLock=function(e){e.cleanFeatureLocks()},l.lockFeatures=function(e){var t=this,i=$.Deferred(),r=this._mapService.state.bbox,o=this._layers[e].vector;return $.get(this._baseUrl+e+"/?lock"+this._customUrlParameters+"&in_bbox="+r[0]+","+r[1]+","+r[2]+","+r[3]).done(function(e){t.setVectorFeaturesLock(o,e.featurelocks),i.resolve(e)}).fail(function(){i.reject()}),i.promise()},l._getVectorLayerConfig=function(e){var t=$.Deferred();return $.get(this._baseUrl+e+"/?config"+this._customUrlParameters).done(function(e){t.resolve(e)}).fail(function(){t.reject()}),t.promise()},l._getVectorLayerData=function(e,t){var i,r=$.Deferred(),o="w"==this.getMode();return i=o?this._baseUrl+e[this._editingApiField]+"/?editing":this._baseUrl+e[this._editingApiField]+"/?",$.get(i+this._customUrlParameters+"&in_bbox="+t[0]+","+t[1]+","+t[2]+","+t[3]).done(function(e){r.resolve(e)}).fail(function(){r.reject()}),r.promise()},l._createVectorLayer=function(e){var t=new VectorLayer(e);return t},l.cleanUpLayers=function(){this._loadedExtent=null},t.exports=r;var c={type:"FeatureCollection",crs:{type:"name",properties:{name:"urn:ogc:def:crs:EPSG::3003"}},features:[{type:"Feature",properties:{gid:1,area:0,perimeter:0,am_cam_:"1",am_cam_id:"1",nome:"CASENTINO",tipo_ente:"COMUNIT MONTANA"},geometry:{type:"MultiPoint",coordinates:[[1723520.24329738,4845229.65344778]]}},{type:"Feature",properties:{gid:2,area:0,perimeter:0,am_cam_:"2",am_cam_id:"2",nome:"PRATOMAGNO",tipo_ente:"COMUNIT MONTANA"},geometry:{type:"MultiPoint",coordinates:[[1712658.505333,4829966.87325079]]}},{type:"Feature",properties:{gid:3,area:0,perimeter:0,am_cam_:"3",am_cam_id:"3",nome:"VALTIBERINA",tipo_ente:"COMUNIT MONTANA"},geometry:{type:"MultiPoint",coordinates:[[1753621.60567692,4828969.30874292]]}},{type:"Feature",properties:{gid:4,area:0,perimeter:0,am_cam_:"4",am_cam_id:"4",nome:"CASTELLINA IN CHIANTI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1684911.21800134,4815562.95964471]]}},{type:"Feature",properties:{gid:5,area:0,perimeter:0,am_cam_:"5",am_cam_id:"5",nome:"SAN QUIRICO D'ORCIA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1712169.13475135,4770662.07895588]]}},{type:"Feature",properties:{gid:6,area:0,perimeter:0,am_cam_:"6",am_cam_id:"6",nome:"MURLO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1694406.39198484,4782312.86656864]]}},{type:"Feature",properties:{gid:7,area:0,perimeter:0,am_cam_:"7",am_cam_id:"7",nome:"MONTICIANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1677328.33840318,4778658.68862327]]}},{type:"Feature",properties:{gid:8,area:0,perimeter:0,am_cam_:"8",am_cam_id:"8",nome:"BUONCONVENTO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1701895.50073138,4779181.66243883]]}},{type:"Feature",properties:{gid:9,area:0,perimeter:0,am_cam_:"9",am_cam_id:"9",nome:"ASCIANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1707861.9077233,4790092.74594612]]}},{type:"Feature",properties:{gid:10,area:0,perimeter:0,am_cam_:"10",am_cam_id:"10",nome:"CHIUSI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1740247.0489217,4766895.92489835]]}},{type:"Feature",properties:{gid:11,area:0,perimeter:0,am_cam_:"11",am_cam_id:"11",nome:"CHIANCIANO TERME",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1730593.42291587,4771235.03348176]]}},{type:"Feature",properties:{gid:12,area:0,perimeter:0,am_cam_:"12",am_cam_id:"12",nome:"TREQUANDA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1716798.97167126,4785272.23524141]]}},{type:"Feature",properties:{gid:13,area:0,perimeter:0,am_cam_:"13",am_cam_id:"13",nome:"CHIUSDINO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1669823.7378614,4780151.4217217]]}},{type:"Feature",properties:{gid:14,area:0,perimeter:0,am_cam_:"14",am_cam_id:"14",nome:"SOVICILLE",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1680783.46463942,4794404.78966729]]}},{type:"Feature",properties:{gid:15,area:0,perimeter:0,am_cam_:"15",am_cam_id:"15",nome:"RADDA IN CHIANTI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1692016.77690218,4817593.90822071]]}},{type:"Feature",properties:{gid:16,area:0,perimeter:0,am_cam_:"16",am_cam_id:"16",nome:"RADICONDOLI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1665768.49347095,4791853.67119123]]}},{type:"Feature",properties:{gid:17,area:0,perimeter:0,am_cam_:"17",am_cam_id:"17",nome:"ABBADIA SAN SALVATORE",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1718680.79666574,4751088.90677273]]}},{type:"Feature",properties:{gid:18,area:0,perimeter:0,am_cam_:"18",am_cam_id:"18",nome:"MONTEPULCIANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1726333.05818974,4774888.6750148]]}},{type:"Feature",properties:{gid:19,area:0,perimeter:0,am_cam_:"19",am_cam_id:"19",nome:"MONTALCINO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1702774.09806304,4770643.30083602]]}},{type:"Feature",properties:{gid:20,area:0,perimeter:0,am_cam_:"20",am_cam_id:"20",nome:"CASTELNUOVO BERARDENGA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1702825.24010343,4802242.92606464]]}},{type:"Feature",properties:{gid:21,area:0,perimeter:0,am_cam_:"21",am_cam_id:"21",nome:"CASOLE D'ELSA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1665624.44215204,4800624.81071927]]}},{type:"Feature",properties:{gid:22,area:0,perimeter:0,am_cam_:"22",am_cam_id:"22",nome:"CETONA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1736615.4075093,4760786.46751659]]}},{type:"Feature",properties:{gid:23,area:0,perimeter:0,am_cam_:"23",am_cam_id:"23",nome:"MONTERIGGIONI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1679735.51178678,4806871.75640306]]}},{type:"Feature",properties:{gid:24,area:0,perimeter:0,am_cam_:"24",am_cam_id:"24",nome:"CASTIGLIONE D'ORCIA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1713248.17983055,4764785.87559004]]}},{type:"Feature",properties:{gid:25,area:0,perimeter:0,am_cam_:"25",am_cam_id:"25",nome:"GAIOLE IN CHIANTI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1696917.75518576,4815675.54161354]]}},{type:"Feature",properties:{gid:26,area:0,perimeter:0,am_cam_:"26",am_cam_id:"26",nome:"MONTERONI D'ARBIA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1696705.39685449,4789357.04363924]]}},{type:"Feature",properties:{gid:27,area:0,perimeter:0,am_cam_:"27",am_cam_id:"27",nome:"SAN GIOVANNI D'ASSO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1710606.39052539,4781048.14571115]]}},{type:"Feature",properties:{gid:28,area:0,perimeter:0,am_cam_:"28",am_cam_id:"28",nome:"RAPOLANO TERME",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1711303.36976227,4795939.20327105]]}},{type:"Feature",properties:{gid:29,area:0,perimeter:0,am_cam_:"29",am_cam_id:"29",nome:"RADICOFANI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1725916.790967,4753085.81937915]]}},{type:"Feature",properties:{gid:30,area:0,perimeter:0,am_cam_:"30",am_cam_id:"30",nome:"PIANCASTAGNAIO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1719985.63382248,4747618.86360846]]}},{type:"Feature",properties:{gid:31,area:0,perimeter:0,
am_cam_:"31",am_cam_id:"31",nome:"PIENZA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1718139.37307653,4772827.29768104]]}},{type:"Feature",properties:{gid:32,area:0,perimeter:0,am_cam_:"32",am_cam_id:"32",nome:"SAN CASCIANO DEI BAGNI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1734892.56946998,4750548.45321274]]}},{type:"Feature",properties:{gid:33,area:0,perimeter:0,am_cam_:"33",am_cam_id:"33",nome:"TORRITA DI SIENA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1725357.68588096,4783075.49048917]]}},{type:"Feature",properties:{gid:34,area:0,perimeter:0,am_cam_:"34",am_cam_id:"34",nome:"SINALUNGA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1722346.64926429,4788025.95979594]]}},{type:"Feature",properties:{gid:35,area:0,perimeter:0,am_cam_:"35",am_cam_id:"35",nome:"SARTEANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1733863.58705213,4763644.6306013]]}},{type:"Feature",properties:{gid:36,area:0,perimeter:0,am_cam_:"36",am_cam_id:"36",nome:"POGGIBONSI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1673670.92056689,4814959.41797909]]}},{type:"Feature",properties:{gid:37,area:0,perimeter:0,am_cam_:"37",am_cam_id:"37",nome:"COLLE DI VAL D'ELSA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1671458.86045911,4809808.50671786]]}},{type:"Feature",properties:{gid:38,area:0,perimeter:0,am_cam_:"38",am_cam_id:"38",nome:"SAN GIMIGNANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1665301.62413816,4814786.52314513]]}},{type:"Feature",properties:{gid:39,area:0,perimeter:0,am_cam_:"39",am_cam_id:"39",nome:"SIENA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1689137.73666455,4798806.56776204]]}},{type:"Feature",properties:{gid:40,area:0,perimeter:0,am_cam_:"40",am_cam_id:"40",nome:"AMIATA SENESE",tipo_ente:"COMUNIT MONTANA"},geometry:{type:"MultiPoint",coordinates:[[1719437.39512115,4747805.34423345]]}},{type:"Feature",properties:{gid:41,area:0,perimeter:0,am_cam_:"41",am_cam_id:"41",nome:"VAL DI MERSE",tipo_ente:"COMUNIT MONTANA"},geometry:{type:"MultiPoint",coordinates:[[1665768.49347095,4791853.67119123]]}},{type:"Feature",properties:{gid:42,area:0,perimeter:0,am_cam_:"42",am_cam_id:"42",nome:"CETONA",tipo_ente:"COMUNIT MONTANA"},geometry:{type:"MultiPoint",coordinates:[[1733870.03652897,4763626.94937098]]}},{type:"Feature",properties:{gid:43,area:0,perimeter:0,am_cam_:"43",am_cam_id:"43",nome:"SIENA",tipo_ente:"PROVINCIA"},geometry:{type:"MultiPoint",coordinates:[[1688915.46363086,4798666.07687358]]}},{type:"Feature",properties:{gid:44,area:0,perimeter:0,am_cam_:"44",am_cam_id:"44",nome:"PESCIA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1635647.50488851,4862652.65393824]]}},{type:"Feature",properties:{gid:45,area:0,perimeter:0,am_cam_:"45",am_cam_id:"45",nome:"UZZANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1637288.41524274,4860167.36969592]]}},{type:"Feature",properties:{gid:46,area:0,perimeter:0,am_cam_:"46",am_cam_id:"46",nome:"BUGGIANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1638812.48835253,4860008.63082772]]}},{type:"Feature",properties:{gid:47,area:0,perimeter:0,am_cam_:"47",am_cam_id:"47",nome:"MASSA E COZZILE",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1641117.7602249,4860925.48352829]]}},{type:"Feature",properties:{gid:48,area:0,perimeter:0,am_cam_:"48",am_cam_id:"48",nome:"MONTECATINI TERME",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1642446.45953843,4860538.39124798]]}},{type:"Feature",properties:{gid:49,area:0,perimeter:0,am_cam_:"49",am_cam_id:"49",nome:"PIEVE A NIEVOLE",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1644160.67953932,4859992.65601103]]}},{type:"Feature",properties:{gid:50,area:0,perimeter:0,am_cam_:"50",am_cam_id:"50",nome:"MONSUMMANO TERME",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1645837.52413729,4859322.74216775]]}},{type:"Feature",properties:{gid:51,area:0,perimeter:0,am_cam_:"51",am_cam_id:"51",nome:"LAMPORECCHIO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1652571.87346973,4853309.4022369]]}},{type:"Feature",properties:{gid:52,area:0,perimeter:0,am_cam_:"52",am_cam_id:"52",nome:"CHIESINA UZZANESE",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1638272.83837338,4855478.37470015]]}},{type:"Feature",properties:{gid:53,area:0,perimeter:0,am_cam_:"53",am_cam_id:"53",nome:"PONTE BUGGIANESE",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1640506.92843191,4855689.43339121]]}},{type:"Feature",properties:{gid:54,area:0,perimeter:0,am_cam_:"54",am_cam_id:"54",nome:"PISTOIA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1653981.51820148,4866326.56772577]]}},{type:"Feature",properties:{gid:55,area:0,perimeter:0,am_cam_:"55",am_cam_id:"55",nome:"SAN MARCELLO PISTOIESE",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1643547.88954245,4879627.21182907]]}},{type:"Feature",properties:{gid:56,area:0,perimeter:0,am_cam_:"56",am_cam_id:"56",nome:"PITEGLIO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1641636.96633579,4876562.94751247]]}},{type:"Feature",properties:{gid:57,area:0,perimeter:0,am_cam_:"57",am_cam_id:"57",nome:"MONTALE",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1662288.34971743,4866638.33544027]]}},{type:"Feature",properties:{gid:58,area:0,perimeter:0,am_cam_:"58",am_cam_id:"58",nome:"CUTIGLIANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1640457.42428341,4884591.82480421]]}},{type:"Feature",properties:{gid:59,area:0,perimeter:0,am_cam_:"59",am_cam_id:"59",nome:"ABETONE",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1633155.13259245,4889161.19251626]]}},{type:"Feature",properties:{gid:60,area:0,perimeter:0,am_cam_:"60",am_cam_id:"60",nome:"SAMBUCA PISTOIESE",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1660026.39502951,4885391.94414582]]}},{type:"Feature",properties:{gid:62,area:0,perimeter:0,am_cam_:"62",am_cam_id:"62",nome:"LARCIANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1651026.16152937,4854087.36279128]]}},{type:"Feature",properties:{gid:63,area:0,perimeter:0,am_cam_:"63",am_cam_id:"63",nome:"APPENNINO PISTOIESE",tipo_ente:"COMUNIT MONTANA"},geometry:{type:"MultiPoint",coordinates:[[1643475.75518433,4879837.94228652]]}},{type:"Feature",properties:{gid:64,area:0,perimeter:0,am_cam_:"64",am_cam_id:"64",nome:"QUARRATA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1659071.70202914,4856823.23458812]]}},{type:"Feature",properties:{gid:65,area:0,perimeter:0,am_cam_:"65",am_cam_id:"65",nome:"PISTOIA",tipo_ente:"PROVINCIA"},geometry:{type:"MultiPoint",coordinates:[[1654015.93499543,4866171.01154521]]}},{type:"Feature",properties:{gid:66,area:0,perimeter:0,am_cam_:"66",am_cam_id:"66",nome:"SERRAVALLE PISTOIESE",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1647203.90795616,4863058.82844008]]}},{type:"Feature",properties:{gid:67,area:0,perimeter:0,am_cam_:"67",am_cam_id:"67",nome:"AGLIANA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1660922.21095049,4863122.5006185]]}},{type:"Feature",properties:{gid:68,area:0,perimeter:0,am_cam_:"68",am_cam_id:"68",nome:"VERNIO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1672731.9375,4880098.5]]}},{type:"Feature",properties:{gid:69,area:0,perimeter:0,am_cam_:"69",am_cam_id:"69",nome:"CANTAGALLO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1668891.9375,4877183.5]]}},{type:"Feature",properties:{gid:70,area:0,perimeter:0,am_cam_:"70",am_cam_id:"70",nome:"VAIANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1670347.3125,4870594.25]]}},{type:"Feature",properties:{gid:71,area:0,perimeter:0,am_cam_:"71",am_cam_id:"71",nome:"MONTEMURLO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1663541.4375,4865829]]}},{type:"Feature",properties:{gid:72,area:0,perimeter:0,am_cam_:"72",am_cam_id:"72",nome:"PRATO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1668484.81249,4860788.75]]}},{type:"Feature",properties:{gid:73,area:0,perimeter:0,am_cam_:"73",am_cam_id:"73",nome:"PRATO",tipo_ente:"PROVINCIA"},geometry:{type:"MultiPoint",coordinates:[[1668561.25001,4860734]]}},{type:"Feature",properties:{gid:74,area:0,perimeter:0,am_cam_:"74",am_cam_id:"74",nome:"POGGIO A CAIANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1665395.875,4853541.5]]}},{type:"Feature",properties:{gid:75,area:0,perimeter:0,am_cam_:"75",am_cam_id:"75",nome:"CARMIGNANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1662347.25,4853225.25]]}},{type:"Feature",properties:{gid:76,area:0,perimeter:0,am_cam_:"76",am_cam_id:"76",nome:"VAL DI BISENZIO",tipo_ente:"COMUNIT MONTANA"},geometry:{type:"MultiPoint",coordinates:[[1672351.10487701,4879258.36087433]]}},{type:"Feature",properties:{gid:77,area:0,perimeter:0,am_cam_:"77",am_cam_id:"77",nome:"PISA",tipo_ente:"PROVINCIA"},geometry:{type:"MultiPoint",coordinates:[[1612673.18479443,4840667.9967823]]}},{type:"Feature",properties:{gid:78,area:0,perimeter:0,am_cam_:"78",am_cam_id:"78",nome:"PISA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1612913.95506888,4841242.7897776]]}},{type:"Feature",properties:{gid:79,area:0,perimeter:0,am_cam_:"79",am_cam_id:"79",nome:"VECCHIANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1611604.99540736,4848564.07520776]]}},{type:"Feature",properties:{gid:80,area:0,perimeter:0,am_cam_:"80",am_cam_id:"80",nome:"SAN GIULIANO TERME",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1616195.32156872,4846639.97667135]]}},{type:"Feature",properties:{gid:81,area:0,perimeter:0,am_cam_:"81",am_cam_id:"81",nome:"BUTI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1627873.50405891,4842850.59750956]]}},{type:"Feature",properties:{gid:82,area:0,perimeter:0,am_cam_:"82",am_cam_id:"82",nome:"BIENTINA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1630520.39281688,4840954.605]]}},{type:"Feature",properties:{gid:83,area:0,perimeter:0,am_cam_:"83",am_cam_id:"83",nome:"CASTELFRANCO DI SOTTO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1640660.6352533,4840008.96477979]]}},{type:"Feature",properties:{gid:84,area:0,perimeter:0,am_cam_:"84",am_cam_id:"84",nome:"SANTA MARIA A MONTE",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1636419.72991936,4839681.53496554]]}},{type:"Feature",properties:{gid:85,area:0,perimeter:0,am_cam_:"85",am_cam_id:"85",nome:"SAN MINIATO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1649322.97504381,4837961.53749233]]}},{type:"Feature",properties:{gid:86,area:0,perimeter:0,am_cam_:"86",am_cam_id:"86",nome:"VICOPISANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1627737.25603715,4839752.05833546]]}},{type:"Feature",properties:{gid:87,area:0,perimeter:0,am_cam_:"87",am_cam_id:"87",nome:"CALCINAIA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1630259.07813058,4837924.48916135]]}},{type:"Feature",properties:{gid:88,area:0,perimeter:0,am_cam_:"88",am_cam_id:"88",nome:"PONTEDERA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1631892.67020488,4835860.14084502]]}},{type:"Feature",properties:{gid:89,area:0,perimeter:0,am_cam_:"89",am_cam_id:"89",nome:"MONTOPOLI IN VAL D'ARNO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1641959.50412825,4836609.02674679]]}},{type:"Feature",properties:{gid:90,area:0,perimeter:0,am_cam_:"90",am_cam_id:"90",nome:"PALAIA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1643127.20354034,4829528.78957111]]}},{type:"Feature",properties:{gid:91,area:0,perimeter:0,am_cam_:"91",am_cam_id:"91",nome:"PONSACCO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1631814.55229193,4831024.16542251]]}},{type:"Feature",properties:{gid:92,area:0,perimeter:0,am_cam_:"92",am_cam_id:"92",nome:"CAPANNOLI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1634643.48064014,4828105.27334183]]}},{type:"Feature",properties:{gid:93,area:0,perimeter:0,am_cam_:"93",am_cam_id:"93",nome:"LARI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1628621.96145329,4824963.82500638]]}},{type:"Feature",properties:{gid:94,area:0,perimeter:0,am_cam_:"94",am_cam_id:"94",nome:"FAUGLIA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1622439.95103078,4824920.82416773]]}},{type:"Feature",properties:{gid:95,area:0,perimeter:0,am_cam_:"95",am_cam_id:"95",nome:"CASCIANA TERME",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1630724.78271444,4820452.91542251]]}},{type:"Feature",properties:{gid:96,area:0,perimeter:0,am_cam_:"96",am_cam_id:"96",nome:"TERRICCIOLA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1635494.80603715,4820471.37457749]]}},{type:"Feature",properties:{gid:97,area:0,perimeter:0,am_cam_:"97",am_cam_id:"97",nome:"PECCIOLI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1639051.38729831,4823124.20083227]]}},{type:"Feature",properties:{gid:98,area:0,perimeter:0,am_cam_:"98",am_cam_id:"98",nome:"ORCIANO PISANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1622189.9785276,4816710.40343912]]}},{type:"Feature",properties:{gid:99,area:0,perimeter:0,am_cam_:"99",am_cam_id:"99",nome:"SANTA LUCE",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1626689.98313058,4814500.68333546]]}},{type:"Feature",properties:{gid:100,area:0,perimeter:0,am_cam_:"100",am_cam_id:"100",nome:"CHIANNI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1632860.03896285,4816103.46250319]]}},{type:"Feature",properties:{gid:101,area:0,perimeter:0,am_cam_:"101",am_cam_id:"101",nome:"LAJATICO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1639825.7548015,4815035.68]]}},{type:"Feature",properties:{gid:102,area:0,perimeter:0,am_cam_:"102",am_cam_id:"102",nome:"VOLTERRA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1650601.63405254,4807135.66624841]]}},{type:"Feature",properties:{gid:103,area:0,perimeter:0,am_cam_:"103",am_cam_id:"103",nome:"CASTELLINA MARITTIMA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1627590.99562739,4807779.83332908]]}},{type:"Feature",properties:{gid:104,area:0,perimeter:0,am_cam_:"104",am_cam_id:"104",nome:"RIPARBELLA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1629647.15813058,4802566.25541614]]}},{type:"Feature",properties:{gid:105,area:0,perimeter:0,am_cam_:"105",am_cam_id:"105",nome:"MONTESCUDAIO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1631958.42645966,4798384.38875797]]}},{type:"Feature",properties:{gid:106,area:0,perimeter:0,am_cam_:"106",am_cam_id:"106",nome:"GUARDISTALLO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1632442.95562739,4796862.74624841]]}},{type:"Feature",properties:{gid:107,area:0,perimeter:0,am_cam_:"107",am_cam_id:"107",nome:"CASALE MARITTIMO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1631073.32895647,4795114.40459024]]}},{type:"Feature",properties:{gid:108,area:0,perimeter:0,am_cam_:"108",am_cam_id:"108",nome:"MONTECATINI VAL DI CECINA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1641733.24604353,4805895.32421873]]}},{type:"Feature",properties:{gid:109,area:0,perimeter:0,am_cam_:"109",am_cam_id:"109",nome:"MONTEVERDI MARITTIMO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1639413.45487753,4781906.75560787]]}},{type:"Feature",properties:{gid:110,area:0,perimeter:0,am_cam_:"110",am_cam_id:"110",nome:"POMARANCE",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1652013.62563377,4795862.25667092]]}},{type:"Feature",properties:{gid:111,area:0,perimeter:0,am_cam_:"111",am_cam_id:"111",nome:"CASTELNUOVO DI VAL DI CECINA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1654775.2968758,4785881.27583865]]}},{type:"Feature",properties:{gid:112,area:0,perimeter:0,am_cam_:"112",am_cam_id:"112",nome:"CASCINA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1625032.0018758,4837110.25167092]]}},{type:"Feature",properties:{gid:113,area:0,perimeter:0,am_cam_:"113",am_cam_id:"113",nome:"CALCI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1622111.39320211,4842551.01900054]]}},{type:"Feature",properties:{gid:114,area:0,perimeter:0,am_cam_:"114",am_cam_id:"114",nome:"CRESPINA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1626323.27576815,4825758.10045402]]}},{type:"Feature",properties:{gid:115,area:0,perimeter:0,am_cam_:"115",am_cam_id:"115",nome:"VAL DI CECINA",tipo_ente:"COMUNIT MONTANA"},geometry:{type:"MultiPoint",coordinates:[[1652127.72603715,4795628.51665817]]}},{type:"Feature",properties:{gid:116,area:0,perimeter:0,am_cam_:"116",am_cam_id:"116",nome:"SANTA CROCE SULL'ARNO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1643345.76040976,4841371.47103715]]}},{type:"Feature",properties:{gid:117,area:0,perimeter:0,am_cam_:"117",am_cam_id:"117",nome:"LORENZANA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1624008.1491741,4821507.28437898]]}},{type:"Feature",properties:{gid:118,area:0,perimeter:0,am_cam_:"118",am_cam_id:"118",nome:"MASSA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1591447.03088353,4876584.5330424]]}},{type:"Feature",properties:{gid:119,area:0,perimeter:0,am_cam_:"119",am_cam_id:"119",nome:"MONTIGNOSO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1594280.14301417,4874530.74872049]]}},{type:"Feature",properties:{gid:120,area:0,perimeter:0,am_cam_:"120",am_cam_id:"120",nome:"CARRARA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1587838.28444817,4881082.90943059]]}},{type:"Feature",properties:{gid:121,area:0,perimeter:0,am_cam_:"121",am_cam_id:"121",nome:"MASSA-CARRARA",tipo_ente:"PROVINCIA"},geometry:{type:"MultiPoint",coordinates:[[1591564.90409964,4876575.83813039]]}},{type:"Feature",properties:{gid:122,area:0,perimeter:0,am_cam_:"122",am_cam_id:"122",nome:"AULLA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1577377.87055043,4895571.13690008]]}},{type:"Feature",properties:{gid:123,area:0,perimeter:0,am_cam_:"123",am_cam_id:"123",nome:"VILLAFRANCA IN LUNIGIANA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1575926.89218108,4904816.7862527]]}},{type:"Feature",properties:{gid:124,area:0,perimeter:0,am_cam_:"124",am_cam_id:"124",nome:"FIVIZZANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1589700.99792191,4898876.27360716]]}},{type:"Feature",properties:{gid:125,area:0,perimeter:0,am_cam_:"125",am_cam_id:"125",nome:"LUNIGIANA",tipo_ente:"COMUNIT MONTANA"},geometry:{type:"MultiPoint",coordinates:[[1590049.98249823,4899090.04442336]]}},{type:"Feature",properties:{gid:126,area:0,perimeter:0,am_cam_:"126",am_cam_id:"126",nome:"PONTREMOLI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1570384.88334392,4914177.04974941]]}},{type:"Feature",properties:{gid:127,area:0,perimeter:0,am_cam_:"127",am_cam_id:"127",nome:"BAGNONE",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1579350.97570427,4907410.52276711]]}},{type:"Feature",properties:{gid:128,area:0,perimeter:0,am_cam_:"128",am_cam_id:"128",nome:"TRESANA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1575976.00219713,4898736.71847103]]}},{type:"Feature",properties:{gid:129,area:0,perimeter:0,am_cam_:"129",am_cam_id:"129",nome:"PODENZANA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1575195.0729804,4895241.47385978]]}},{type:"Feature",properties:{gid:130,area:0,perimeter:0,am_cam_:"130",am_cam_id:"130",nome:"MULAZZO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1572370.32814577,4907978.51899164]]}},{type:"Feature",properties:{gid:131,area:0,perimeter:0,am_cam_:"131",am_cam_id:"131",nome:"ZERI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1560879.73229507,4911380.28168281]]}},{type:"Feature",properties:{gid:132,area:0,perimeter:0,am_cam_:"132",am_cam_id:"132",nome:"FILATTIERA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1574729.74113997,4909133.45448072]]}},{type:"Feature",properties:{gid:133,area:0,perimeter:0,am_cam_:"133",am_cam_id:"133",nome:"FOSDINOVO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1581541.13660231,4887341.29414042]]}},{type:"Feature",properties:{gid:134,area:0,perimeter:0,am_cam_:"134",am_cam_id:"134",nome:"LICCIANA NARDI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1582910.94274759,4901864.90823395]]}},{type:"Feature",properties:{gid:135,area:0,perimeter:0,am_cam_:"135",am_cam_id:"135",nome:"COMANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1590108.65494629,4904850.38170873]]}},{type:"Feature",properties:{gid:136,area:0,perimeter:0,am_cam_:"136",am_cam_id:"136",nome:"CASOLA IN LUNIGIANA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1593972.21443789,4894907.46905947]]}},{type:"Feature",properties:{gid:137,area:0,perimeter:0,am_cam_:"137",am_cam_id:"137",nome:"CAPANNORI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1626652.83790075,4856365.04153808]]}},{type:"Feature",properties:{gid:138,area:0,perimeter:0,am_cam_:"138",am_cam_id:"138",nome:"LUCCA",tipo_ente:"PROVINCIA"},geometry:{type:"MultiPoint",coordinates:[[1620712.14530885,4855384.28273004]]}},{type:"Feature",properties:{gid:139,area:0,perimeter:0,am_cam_:"139",am_cam_id:"139",nome:"LUCCA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1620729.96823646,4855680.48454636]]}},{type:"Feature",properties:{gid:140,area:0,perimeter:0,am_cam_:"140",am_cam_id:"140",nome:"AREA LUCCHESE",tipo_ente:"COMUNIT MONTANA"},geometry:{type:"MultiPoint",coordinates:[[1621086.00429715,4855994.61878925]]}},{type:"Feature",properties:{gid:141,area:0,perimeter:0,am_cam_:"141",am_cam_id:"141",nome:"PORCARI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1629966.00103854,4855381.6294312]]}},{type:"Feature",properties:{gid:142,area:0,perimeter:0,am_cam_:"142",am_cam_id:"142",nome:"MONTECARLO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1634144.65525056,4856634.58966008]]}},{type:"Feature",properties:{gid:143,area:0,perimeter:0,am_cam_:"143",am_cam_id:"143",nome:"ALTOPASCIO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1634721.00357444,4852705.25281553]]}},{type:"Feature",properties:{gid:144,area:0,perimeter:0,am_cam_:"144",am_cam_id:"144",nome:"VILLA BASILICA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1632071.38467385,4865181.72481243]]}},{type:"Feature",properties:{gid:145,area:0,perimeter:0,am_cam_:"145",am_cam_id:"145",nome:"PESCAGLIA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1613195.33778992,4869086.11548565]]}},{type:"Feature",properties:{gid:146,area:0,perimeter:0,am_cam_:"146",am_cam_id:"146",nome:"MEDIA VALLE DEL SERCHIO",tipo_ente:"COMUNIT MONTANA"},geometry:{type:"MultiPoint",coordinates:[[1623995.03277854,4870734.09985409]]}},{type:"Feature",properties:{gid:147,area:0,perimeter:0,am_cam_:"147",am_cam_id:"147",nome:"BORGO A MOZZANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1623821.93129714,4870645.91608055]]}},{type:"Feature",properties:{gid:148,area:0,perimeter:0,am_cam_:"148",am_cam_id:"148",nome:"CAMPORGIANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1606630.79047452,4890390.08284122]]}},{type:"Feature",properties:{gid:149,area:0,perimeter:0,am_cam_:"149",am_cam_id:"149",nome:"PIEVE FOSCIANA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1612946.65753396,4887620.81832423]]}},{type:"Feature",properties:{gid:150,area:0,perimeter:0,am_cam_:"150",am_cam_id:"150",nome:"GARFAGNANA",tipo_ente:"COMUNIT MONTANA"},geometry:{type:"MultiPoint",coordinates:[[1613122.42258881,4884995.45852425]]}},{type:"Feature",properties:{gid:151,area:0,perimeter:0,am_cam_:"151",am_cam_id:"151",nome:"CASTELNUOVO DI GARFAGNANA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1612988.74974955,4885060.42102557]]}},{type:"Feature",properties:{gid:152,area:0,perimeter:0,am_cam_:"152",am_cam_id:"152",nome:"VIAREGGIO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1600459.93873854,4857870.5540106]]}},{type:"Feature",properties:{gid:153,area:0,perimeter:0,am_cam_:"153",am_cam_id:"153",nome:"MASSAROSA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1607883.61715305,4858163.80453097]]}},{type:"Feature",properties:{gid:154,area:0,perimeter:0,am_cam_:"154",am_cam_id:"154",nome:"CAMAIORE",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1604702.34003007,4865888.56150873]]}},{type:"Feature",properties:{gid:155,area:0,perimeter:0,am_cam_:"155",am_cam_id:"155",nome:"PIETRASANTA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1598478.50404405,4868087.83357906]]}},{type:"Feature",properties:{gid:156,area:0,perimeter:0,am_cam_:"156",am_cam_id:"156",nome:"FORTE DEI MARMI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1593894.60808248,4867925.12122011]]}},{type:"Feature",properties:{gid:157,area:0,perimeter:0,am_cam_:"157",am_cam_id:"157",nome:"SERVEZZA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1598517.36295824,4872101.30686031]]}},{type:"Feature",properties:{gid:158,area:0,perimeter:0,am_cam_:"158",am_cam_id:"158",nome:"STAZZEMA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1603926.76514817,4872397.03129419]]}},{type:"Feature",properties:{gid:159,area:0,perimeter:0,am_cam_:"159",am_cam_id:"159",nome:"S.ROMANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1607742.78134399,4891466.54575291]]}},{type:"Feature",properties:{gid:160,area:0,perimeter:0,am_cam_:"160",am_cam_id:"160",nome:"FOSCIANDORA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1616479.88546834,4885731.21896411]]}},{type:"Feature",properties:{gid:161,area:0,perimeter:0,am_cam_:"161",am_cam_id:"161",nome:"VAGLI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1602505.23172052,4885268.29974293]]}},{type:"Feature",properties:{gid:162,area:0,perimeter:0,am_cam_:"162",am_cam_id:"162",nome:"PIAZZA AL SERCHIO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1603904.69936877,4893032.65633046]]}},{type:"Feature",properties:{gid:163,area:0,perimeter:0,am_cam_:"163",am_cam_id:"163",nome:"MINUCCIANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1596581.14571234,4891560.04010676]]}},{type:"Feature",properties:{gid:164,area:0,perimeter:0,am_cam_:"164",am_cam_id:"164",nome:"GIUNCUGNANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1600437.37322746,4896790.45936575]]}},{type:"Feature",properties:{gid:165,area:0,perimeter:0,am_cam_:"165",am_cam_id:"165",nome:"SILLANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1603866.2698849,4897496.70616417]]}},{type:"Feature",properties:{gid:166,area:0,perimeter:0,am_cam_:"166",am_cam_id:"166",nome:"CASTIGLIONE DI GARFAGNANA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1612766.63521331,4889355.4121437]]}},{type:"Feature",properties:{gid:167,area:0,perimeter:0,am_cam_:"167",am_cam_id:"167",nome:"VILLA COLLEMANDINA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1611714.75344152,4890565.34634048]]}},{type:"Feature",properties:{gid:168,area:0,perimeter:0,am_cam_:"168",am_cam_id:"168",nome:"CAREGGINE",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1606044.45294529,4886148.53683927]]}},{type:"Feature",properties:{gid:169,area:0,perimeter:0,am_cam_:"169",am_cam_id:"169",nome:"FABBRICHE DI VALLICO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1614859.19654927,4872817.1905028]]}},{type:"Feature",properties:{gid:170,area:0,perimeter:0,am_cam_:"170",am_cam_id:"170",nome:"ALTA VERSILIA",tipo_ente:"COMUNIT MONTANA"},geometry:{type:"MultiPoint",coordinates:[[1598252.95199908,4871955.08821657]]}},{type:"Feature",properties:{gid:171,area:0,perimeter:0,am_cam_:"171",am_cam_id:"171",nome:"COREGLIA ANT",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1622188.24202965,4880177.52105538]]}},{type:"Feature",properties:{gid:172,area:0,perimeter:0,am_cam_:"172",am_cam_id:"172",nome:"BARGA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1618921.03910731,4881160.91233173]]}},{type:"Feature",properties:{gid:173,area:0,perimeter:0,am_cam_:"173",am_cam_id:"173",nome:"GALLICANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1614986.86956249,4879644.31282979]]}},{type:"Feature",properties:{gid:174,area:0,perimeter:0,am_cam_:"174",am_cam_id:"174",nome:"BAGNI DI LUCCA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1627585.40366809,4874281.34375551]]}},{type:"Feature",properties:{gid:175,area:0,perimeter:0,am_cam_:"175",am_cam_id:"175",nome:"VERGEMOLI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1610724.45252055,4878638.07378783]]}},{type:"Feature",properties:{gid:176,area:0,perimeter:0,am_cam_:"176",am_cam_id:"176",nome:"MOLAZZANA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1613664.72299464,4880937.59932191]]}},{type:"Feature",properties:{gid:177,area:0,perimeter:0,am_cam_:"177",am_cam_id:"177",nome:"COLLESALVETTI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1619181.30599508,4827319.17168938]]}},{type:"Feature",properties:{gid:178,area:0,perimeter:0,am_cam_:"178",am_cam_id:"178",nome:"ROSIGNANO MARITTIMO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1619218.07357515,4806895.2701153]]}},{type:"Feature",properties:{gid:179,area:0,perimeter:0,am_cam_:"179",am_cam_id:"179",nome:"LIVORNO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1605687.97283253,4822999.11238451]]}},{type:"Feature",properties:{gid:180,area:0,perimeter:0,am_cam_:"180",am_cam_id:"180",nome:"PIOMBINO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1624641.57507039,4753291.72795082]]}},{type:"Feature",properties:{gid:181,area:0,perimeter:0,am_cam_:"181",am_cam_id:"181",nome:"SAN VINCENZO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1625192.13798926,4773168.42395456]]}},{type:"Feature",properties:{gid:182,area:0,perimeter:0,am_cam_:"182",am_cam_id:"182",nome:"CAMPIGLIA MARITTIMA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1631702.78898425,4768651.38244643]]}},{type:"Feature",properties:{gid:183,area:0,perimeter:0,am_cam_:"183",am_cam_id:"183",nome:"SUVERETO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1636693.58356306,4770995.20151859]]}},{type:"Feature",properties:{gid:184,area:0,perimeter:0,am_cam_:"184",am_cam_id:"184",nome:"CECINA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1623246.76685669,4796622.74200652]]}},{type:"Feature",properties:{gid:185,area:0,perimeter:0,am_cam_:"185",am_cam_id:"185",nome:"CASTAGNETO CARDUCCI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1630926.1888933,4779929.97972558]]}},{type:"Feature",properties:{gid:186,area:0,perimeter:0,am_cam_:"186",am_cam_id:"186",nome:"CAMPO NELL'ELBA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1600975.53945927,4733212.92727864]]}},{type:"Feature",properties:{gid:187,area:0,perimeter:0,am_cam_:"187",am_cam_id:"187",nome:"PORTOFERRAIO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1608845.54815433,4741159.12731555]]}},{type:"Feature",properties:{gid:188,area:0,perimeter:0,am_cam_:"188",am_cam_id:"188",nome:"CAPOLIVERI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1613014.95171597,4733222.91870873]]}},{type:"Feature",properties:{gid:189,area:0,perimeter:0,am_cam_:"189",am_cam_id:"189",nome:"CAPRAIA ISOLA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1568639.50608466,4766718.4999971]]
}},{type:"Feature",properties:{gid:190,area:0,perimeter:0,am_cam_:"190",am_cam_id:"190",nome:"SASSETTA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1633752.17319363,4776375.43347141]]}},{type:"Feature",properties:{gid:191,area:0,perimeter:0,am_cam_:"191",am_cam_id:"191",nome:"BIBBONA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1629761.55977979,4791986.44597159]]}},{type:"Feature",properties:{gid:192,area:0,perimeter:0,am_cam_:"192",am_cam_id:"192",nome:"MARCIANA MARINA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1597868.31296635,4739885.72682685]]}},{type:"Feature",properties:{gid:193,area:0,perimeter:0,am_cam_:"193",am_cam_id:"193",nome:"RIO NELL'ELBA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1614460.97935884,4741072.53292716]]}},{type:"Feature",properties:{gid:194,area:0,perimeter:0,am_cam_:"194",am_cam_id:"194",nome:"RIO MARINA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1616698.48905917,4741339.41671719]]}},{type:"Feature",properties:{gid:195,area:0,perimeter:0,am_cam_:"195",am_cam_id:"195",nome:"PORTO AZZURRO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1614471.4465318,4735640.10125642]]}},{type:"Feature",properties:{gid:196,area:0,perimeter:0,am_cam_:"196",am_cam_id:"196",nome:"MARCIANA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1595597.86896998,4738104.24180011]]}},{type:"Feature",properties:{gid:197,area:0,perimeter:0,am_cam_:"197",am_cam_id:"197",nome:"VAL DI CORNIA",tipo_ente:"CIRCONDARIO"},geometry:{type:"MultiPoint",coordinates:[[1624694.72310544,4754030.66386839]]}},{type:"Feature",properties:{gid:198,area:0,perimeter:0,am_cam_:"198",am_cam_id:"198",nome:"ELBA - CAPRAIA",tipo_ente:"COMUNIT MONTANA"},geometry:{type:"MultiPoint",coordinates:[[1608318.25110732,4741214.46773837]]}},{type:"Feature",properties:{gid:199,area:0,perimeter:0,am_cam_:"199",am_cam_id:"199",nome:"LIVORNO",tipo_ente:"PROVINCIA"},geometry:{type:"MultiPoint",coordinates:[[1605797.66889176,4822986.55429434]]}},{type:"Feature",properties:{gid:200,area:0,perimeter:0,am_cam_:"200",am_cam_id:"200",nome:"MONTEROTONDO MARITTIMO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1650937.05586872,4778650.62214138]]}},{type:"Feature",properties:{gid:201,area:0,perimeter:0,am_cam_:"201",am_cam_id:"201",nome:"MONTIERI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1664022.97801079,4777311.87022919]]}},{type:"Feature",properties:{gid:202,area:0,perimeter:0,am_cam_:"202",am_cam_id:"202",nome:"MASSA MARITTIMA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1653770.3115001,4768140.39086627]]}},{type:"Feature",properties:{gid:203,area:0,perimeter:0,am_cam_:"203",am_cam_id:"203",nome:"ROCCASTRADA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1676662.05387501,4764363.69960274]]}},{type:"Feature",properties:{gid:204,area:0,perimeter:0,am_cam_:"204",am_cam_id:"204",nome:"CIVITELLA PAGANICO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1686024.59938886,4762682.71005713]]}},{type:"Feature",properties:{gid:205,area:0,perimeter:0,am_cam_:"205",am_cam_id:"205",nome:"SEGGIANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1708840.13885524,4756075.87582732]]}},{type:"Feature",properties:{gid:206,area:0,perimeter:0,am_cam_:"206",am_cam_id:"206",nome:"FOLLONICA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1643656.83195237,4753685.0513888]]}},{type:"Feature",properties:{gid:207,area:0,perimeter:0,am_cam_:"207",am_cam_id:"207",nome:"GAVORRANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1655564.14726073,4754306.20346665]]}},{type:"Feature",properties:{gid:208,area:0,perimeter:0,am_cam_:"208",am_cam_id:"208",nome:"SCARLINO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1651185.82994684,4752233.54891212]]}},{type:"Feature",properties:{gid:209,area:0,perimeter:0,am_cam_:"209",am_cam_id:"209",nome:"CASTEL DEL PIANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1707126.44644134,4752097.2209686]]}},{type:"Feature",properties:{gid:210,area:0,perimeter:0,am_cam_:"210",am_cam_id:"210",nome:"CINIGIANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1695556.50238983,4751528.54205781]]}},{type:"Feature",properties:{gid:211,area:0,perimeter:0,am_cam_:"211",am_cam_id:"211",nome:"CAMPAGNATICO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1685804.28904938,4750328.01529863]]}},{type:"Feature",properties:{gid:212,area:0,perimeter:0,am_cam_:"212",am_cam_id:"212",nome:"ARCIDOSSO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1707401.80335873,4749685.11322491]]}},{type:"Feature",properties:{gid:213,area:0,perimeter:0,am_cam_:"213",am_cam_id:"213",nome:"SANTA FIORA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1711383.14308088,4745367.59203363]]}},{type:"Feature",properties:{gid:214,area:0,perimeter:0,am_cam_:"214",am_cam_id:"214",nome:"ROCCALBEGNA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1705130.30282884,4740102.89378485]]}},{type:"Feature",properties:{gid:215,area:0,perimeter:0,am_cam_:"215",am_cam_id:"215",nome:"GROSSETO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1672979.06901722,4736365.00938899]]}},{type:"Feature",properties:{gid:216,area:0,perimeter:0,am_cam_:"216",am_cam_id:"216",nome:"CASTELL'AZZARA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1720880.66380898,4739002.49722677]]}},{type:"Feature",properties:{gid:217,area:0,perimeter:0,am_cam_:"217",am_cam_id:"217",nome:"CASTIGLIONE DELLA PESCAIA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1653756.8717185,4736121.42405142]]}},{type:"Feature",properties:{gid:218,area:0,perimeter:0,am_cam_:"218",am_cam_id:"218",nome:"SEMPRONIANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1708133.77848977,4734021.36046052]]}},{type:"Feature",properties:{gid:219,area:0,perimeter:0,am_cam_:"219",am_cam_id:"219",nome:"SORANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1722385.51512329,4729067.91126849]]}},{type:"Feature",properties:{gid:220,area:0,perimeter:0,am_cam_:"220",am_cam_id:"220",nome:"SCANSANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1691185.21159061,4728823.18718434]]}},{type:"Feature",properties:{gid:221,area:0,perimeter:0,am_cam_:"221",am_cam_id:"221",nome:"PITIGLIANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1718885.93276022,4723765.30720052]]}},{type:"Feature",properties:{gid:222,area:0,perimeter:0,am_cam_:"222",am_cam_id:"222",nome:"MANCIANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1706460.2156998,4718066.73119399]]}},{type:"Feature",properties:{gid:223,area:0,perimeter:0,am_cam_:"223",am_cam_id:"223",nome:"MAGLIANO IN TOSCANA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1688274.3663813,4718725.39625863]]}},{type:"Feature",properties:{gid:224,area:0,perimeter:0,am_cam_:"224",am_cam_id:"224",nome:"CAPALBIO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1699284.57812493,4702967.24218749]]}},{type:"Feature",properties:{gid:225,area:0,perimeter:0,am_cam_:"225",am_cam_id:"225",nome:"ORBETELLO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1681914.45342156,4700873.70845319]]}},{type:"Feature",properties:{gid:226,area:0,perimeter:0,am_cam_:"226",am_cam_id:"226",nome:"MONTE ARGENTARIO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1674021.97512671,4700737.75380563]]}},{type:"Feature",properties:{gid:227,area:0,perimeter:0,am_cam_:"227",am_cam_id:"227",nome:"ISOLA DEL GIGLIO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1656564.89702526,4692171.70254556]]}},{type:"Feature",properties:{gid:228,area:0,perimeter:0,am_cam_:"228",am_cam_id:"228",nome:"GROSSETO",tipo_ente:"PROVINCIA"},geometry:{type:"MultiPoint",coordinates:[[1673030.15994216,4736303.67290939]]}},{type:"Feature",properties:{gid:229,area:0,perimeter:0,am_cam_:"229",am_cam_id:"229",nome:"COLLINE METALLIFERE",tipo_ente:"COMUNIT MONTANA"},geometry:{type:"MultiPoint",coordinates:[[1654002.33267987,4768142.37119094]]}},{type:"Feature",properties:{gid:230,area:0,perimeter:0,am_cam_:"230",am_cam_id:"230",nome:"COLLINE DEL FIORA",tipo_ente:"COMUNIT MONTANA"},geometry:{type:"MultiPoint",coordinates:[[1719215.6931189,4723627.45206193]]}},{type:"Feature",properties:{gid:231,area:0,perimeter:0,am_cam_:"231",am_cam_id:"231",nome:"AMIATA GROSSETANO",tipo_ente:"COMUNIT MONTANA"},geometry:{type:"MultiPoint",coordinates:[[1707299.66945418,4750317.13165168]]}},{type:"Feature",properties:{gid:232,area:0,perimeter:0,am_cam_:"232",am_cam_id:"232",nome:"FIRENZE",tipo_ente:"REGIONE"},geometry:{type:"MultiPoint",coordinates:[[1681603.56917086,4849371.79830877]]}},{type:"Feature",properties:{gid:233,area:0,perimeter:0,am_cam_:"233",am_cam_id:"233",nome:"FIRENZE",tipo_ente:"PROVINCIA"},geometry:{type:"MultiPoint",coordinates:[[1681578.38722191,4849364.21689323]]}},{type:"Feature",properties:{gid:234,area:0,perimeter:0,am_cam_:"234",am_cam_id:"234",nome:"BAGNO A RIPOLI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1686778.06,4846884.46]]}},{type:"Feature",properties:{gid:235,area:0,perimeter:0,am_cam_:"235",am_cam_id:"235",nome:"BARBERINO DI MUGELLO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1679508.88,4874365.47]]}},{type:"Feature",properties:{gid:236,area:0,perimeter:0,am_cam_:"236",am_cam_id:"236",nome:"BARBERINO VAL D'ELSA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1675448.42,4823274.61]]}},{type:"Feature",properties:{gid:237,area:0,perimeter:0,am_cam_:"237",am_cam_id:"237",nome:"BORGO SAN LORENZO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1691608.12,4869643.48]]}},{type:"Feature",properties:{gid:238,area:0,perimeter:0,am_cam_:"238",am_cam_id:"238",nome:"CALENZANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1674177.13,4859257.23]]}},{type:"Feature",properties:{gid:239,area:0,perimeter:0,am_cam_:"239",am_cam_id:"239",nome:"CAMPI BISENZIO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1671939.7,4854195.7]]}},{type:"Feature",properties:{gid:240,area:0,perimeter:0,am_cam_:"240",am_cam_id:"240",nome:"DICOMANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1702794.09,4862920.57]]}},{type:"Feature",properties:{gid:241,area:0,perimeter:0,am_cam_:"241",am_cam_id:"241",nome:"FIESOLE",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1684455.01,4852942.35]]}},{type:"Feature",properties:{gid:242,area:0,perimeter:0,am_cam_:"242",am_cam_id:"242",nome:"FIGLINE VALDARNO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1699606.14,4832512.66]]}},{type:"Feature",properties:{gid:244,area:0,perimeter:0,am_cam_:"244",am_cam_id:"244",nome:"FIRENZUOLA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1690455.08,4887822.56]]}},{type:"Feature",properties:{gid:245,area:0,perimeter:0,am_cam_:"245",am_cam_id:"245",nome:"GREVE IN CHIANTI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1687072.02,4828167]]}},{type:"Feature",properties:{gid:246,area:0,perimeter:0,am_cam_:"246",am_cam_id:"246",nome:"IMPRUNETA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1681760.78,4839460.13]]}},{type:"Feature",properties:{gid:247,area:0,perimeter:0,am_cam_:"247",am_cam_id:"247",nome:"INCISA IN VAL D'ARNO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1697535.85,4837432.93]]}},{type:"Feature",properties:{gid:248,area:0,perimeter:0,am_cam_:"248",am_cam_id:"248",nome:"LASTRA A SIGNA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1669522.73,4848503.62]]}},{type:"Feature",properties:{gid:249,area:0,perimeter:0,am_cam_:"249",am_cam_id:"249",nome:"LONDA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1706316.89,4859607.04]]}},{type:"Feature",properties:{gid:250,area:0,perimeter:0,am_cam_:"250",am_cam_id:"250",nome:"MARRADI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1709233.89,4883594.87]]}},{type:"Feature",properties:{gid:251,area:0,perimeter:0,am_cam_:"251",am_cam_id:"251",nome:"PALAZZUOLO SUL SENIO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1703942.33,4887513.88]]}},{type:"Feature",properties:{gid:252,area:0,perimeter:0,am_cam_:"252",am_cam_id:"252",nome:"PELAGO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1701352.43,4849676.23]]}},{type:"Feature",properties:{gid:253,area:0,perimeter:0,am_cam_:"253",am_cam_id:"253",nome:"PONTASSIEVE",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1696391.09,4849878.93]]}},{type:"Feature",properties:{gid:254,area:0,perimeter:0,am_cam_:"254",am_cam_id:"254",nome:"REGGELLO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1704459.09,4839751.71]]}},{type:"Feature",properties:{gid:255,area:0,perimeter:0,am_cam_:"255",am_cam_id:"255",nome:"RIGNANO SULL'ARNO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1697658.24,4843922.95]]}},{type:"Feature",properties:{gid:256,area:0,perimeter:0,am_cam_:"256",am_cam_id:"256",nome:"RUFINA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1700256.95,4855720.81]]}},{type:"Feature",properties:{gid:257,area:0,perimeter:0,am_cam_:"257",am_cam_id:"257",nome:"SAN CASCIANO IN VAL DI PESA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1676203.14,4836218.84]]}},{type:"Feature",properties:{gid:258,area:0,perimeter:0,am_cam_:"258",am_cam_id:"258",nome:"SAN GODENZO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1710306.06,4866866.94]]}},{type:"Feature",properties:{gid:259,area:0,perimeter:0,am_cam_:"259",am_cam_id:"259",nome:"SAN PIERO A SIEVE",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1686446.69,4870233.26]]}},{type:"Feature",properties:{gid:261,area:0,perimeter:0,am_cam_:"261",am_cam_id:"261",nome:"SCARPERIA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1688866.51,4874255.28]]}},{type:"Feature",properties:{gid:262,area:0,perimeter:0,am_cam_:"262",am_cam_id:"262",nome:"SESTO FIORENTINO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1676784.73,4855597.57]]}},{type:"Feature",properties:{gid:263,area:0,perimeter:0,am_cam_:"263",am_cam_id:"263",nome:"SIGNA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1668827.9,4849871.92]]}},{type:"Feature",properties:{gid:264,area:0,perimeter:0,am_cam_:"264",am_cam_id:"264",nome:"TAVARNELLE VAL DI PESA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1675502.37,4825435.85]]}},{type:"Feature",properties:{gid:266,area:0,perimeter:0,am_cam_:"266",am_cam_id:"266",nome:"VICCHIO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1697906.91,4867482.06]]}},{type:"Feature",properties:{gid:267,area:0,perimeter:0,am_cam_:"267",am_cam_id:"267",nome:"MONTAGNA FIORENTINA",tipo_ente:"COMUNIT MONTANA"},geometry:{type:"MultiPoint",coordinates:[[1699684.47536306,4855085.50844968]]}},{type:"Feature",properties:{gid:268,area:0,perimeter:0,am_cam_:"268",am_cam_id:"268",nome:"MUGELLO",tipo_ente:"COMUNIT MONTANA"},geometry:{type:"MultiPoint",coordinates:[[1692139.54498375,4869455.14423432]]}},{type:"Feature",properties:{gid:269,area:0,perimeter:0,am_cam_:"269",am_cam_id:"269",nome:"FUCECCHIO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1645807.68526174,4843338.59123823]]}},{type:"Feature",properties:{gid:270,area:0,perimeter:0,am_cam_:"270",am_cam_id:"270",nome:"CERRETO GUIDI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1651173.93439603,4846910.57051915]]}},{type:"Feature",properties:{gid:271,area:0,perimeter:0,am_cam_:"271",am_cam_id:"271",nome:"VINCI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1655044.82328857,4850026.82796556]]}},{type:"Feature",properties:{gid:272,area:0,perimeter:0,am_cam_:"272",am_cam_id:"272",nome:"CAPRAIA E LIMITE",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1659438.18125554,4845416.18602404]]}},{type:"Feature",properties:{gid:273,area:0,perimeter:0,am_cam_:"273",am_cam_id:"273",nome:"MONTELUPO FIORENTINO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1662712.80260803,4843844.55213049]]}},{type:"Feature",properties:{gid:274,area:0,perimeter:0,am_cam_:"274",am_cam_id:"274",nome:"MONTESPERTOLI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1667430.0925893,4834423.45433853]]}},{type:"Feature",properties:{gid:275,area:0,perimeter:0,am_cam_:"275",am_cam_id:"275",nome:"EMPOLI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1656888.5007045,4842533.71700871]]}},{type:"Feature",properties:{gid:276,area:0,perimeter:0,am_cam_:"276",am_cam_id:"276",nome:"CASTELFIORENTINO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1659114.92452641,4829993.86426176]]}},{type:"Feature",properties:{gid:277,area:0,perimeter:0,am_cam_:"277",am_cam_id:"277",nome:"MONTAIONE",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1654437.60958126,4823952.81601418]]}},{type:"Feature",properties:{gid:278,area:0,perimeter:0,am_cam_:"278",am_cam_id:"278",nome:"GAMBASSI TERME",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1657861.23654671,4822512.30118979]]}},{type:"Feature",properties:{gid:279,area:0,perimeter:0,am_cam_:"279",am_cam_id:"279",nome:"CERTALDO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1664890.91962481,4823644.76435419]]}},{type:"Feature",properties:{gid:280,area:0,perimeter:0,am_cam_:"280",am_cam_id:"280",nome:"CIRCONDARIO EMPOLESE-VALDELSA",tipo_ente:"CIRCONDARIO"},geometry:{type:"MultiPoint",coordinates:[[1657061.87871633,4842571.8235304]]}},{type:"Feature",properties:{gid:281,area:0,perimeter:0,am_cam_:"281",am_cam_id:"281",nome:"CORTONA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1742259.86,4795706.54]]}},{type:"Feature",properties:{gid:282,area:0,perimeter:0,am_cam_:"282",am_cam_id:"282",nome:"FOIANO DELLA CHIANA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1728821.105,4792708.565]]}},{type:"Feature",properties:{gid:283,area:0,perimeter:0,am_cam_:"283",am_cam_id:"283",nome:"CASTIGLION FIORENTINO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1737033.605,4802913.255]]}},{type:"Feature",properties:{gid:284,area:0,perimeter:0,am_cam_:"284",am_cam_id:"284",nome:"MARCIANO DELLA CHIANA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1725998.22,4798471.41]]}},{type:"Feature",properties:{gid:285,area:0,perimeter:0,am_cam_:"285",am_cam_id:"285",nome:"MONTE SAN SAVINO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1720954.065,4801240.69]]}},{type:"Feature",properties:{gid:286,area:0,perimeter:0,am_cam_:"286",am_cam_id:"286",nome:"MONTERCHI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1751676.28,4819458.985]]}},{type:"Feature",properties:{gid:287,area:0,perimeter:0,am_cam_:"287",am_cam_id:"287",nome:"ANGHIARI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1747021.935,4825395.32]]}},{type:"Feature",properties:{gid:288,area:0,perimeter:0,am_cam_:"288",am_cam_id:"288",nome:"SANSEPOLCRO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1753729.79,4829035.15]]}},{type:"Feature",properties:{gid:289,area:0,perimeter:0,am_cam_:"289",am_cam_id:"289",nome:"CIVITELLA IN VAL DI CHIANA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1724404.03,4809340.575]]}},{type:"Feature",properties:{gid:290,area:0,perimeter:0,am_cam_:"290",am_cam_id:"290",nome:"AREZZO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1733152.38,4816687.27]]}},{type:"Feature",properties:{gid:291,area:0,perimeter:0,am_cam_:"291",am_cam_id:"291",nome:"PERGINE VALDARNO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1717264.72,4816587.165]]}},{type:"Feature",properties:{gid:292,area:0,perimeter:0,am_cam_:"292",am_cam_id:"292",nome:"CASTIGLION FIBOCCHI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1723369.835,4823192.535]]}},{type:"Feature",properties:{gid:293,area:0,perimeter:0,am_cam_:"293",am_cam_id:"293",nome:"LATERINA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1719040.01,4820785.41]]}},{type:"Feature",properties:{gid:294,area:0,perimeter:0,am_cam_:"294",am_cam_id:"294",nome:"CAPOLONA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1730957.395,4827388.69]]}},{type:"Feature",properties:{gid:295,area:0,perimeter:0,am_cam_:"295",am_cam_id:"295",nome:"SUBBIANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1731800.26,4828748.99]]}},{type:"Feature",properties:{gid:296,area:0,perimeter:0,am_cam_:"296",am_cam_id:"296",nome:"BUCINE",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1711685.365,4817399.63]]}},{type:"Feature",properties:{gid:297,area:0,perimeter:0,am_cam_:"297",am_cam_id:"297",nome:"MONTEVARCHI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1707517.68,4822186.495]]}},{type:"Feature",properties:{gid:298,area:0,perimeter:0,am_cam_:"298",am_cam_id:"298",nome:"CAVRIGLIA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1701139.685,4821835.395]]}},{type:"Feature",properties:{gid:299,area:0,perimeter:0,am_cam_:"299",am_cam_id:"299",nome:"TERRANUOVA BRACCIOLINI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1708912.915,4825261.715]]}},{type:"Feature",properties:{gid:300,area:0,perimeter:0,am_cam_:"300",am_cam_id:"300",nome:"LORO CIUFFENNA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1712454.495,4830085.585]]}},{type:"Feature",properties:{gid:301,area:0,perimeter:0,am_cam_:"301",am_cam_id:"301",nome:"SAN GIOVANNI VALDARNO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1704364.555,4826656.905]]}},{type:"Feature",properties:{gid:302,area:0,perimeter:0,am_cam_:"302",am_cam_id:"302",nome:"PIEVE SANTO STEFANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1745244.85,4839605.5]]}},{type:"Feature",properties:{gid:303,area:0,perimeter:0,am_cam_:"303",am_cam_id:"303",nome:"SESTINO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1765684.89,4844782.79]]}},{type:"Feature",properties:{gid:304,area:0,perimeter:0,am_cam_:"304",am_cam_id:"304",nome:"BADIA TEDALDA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1756646.65,4844481.46]]}},{type:"Feature",properties:{gid:305,area:0,perimeter:0,am_cam_:"305",am_cam_id:"305",nome:"CAPRESE MICHELANGELO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1740833.8,4836709.95]]}},{type:"Feature",properties:{gid:306,area:0,perimeter:0,am_cam_:"306",am_cam_id:"306",nome:"TALLA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1724946.55,4831459.75]]}},{type:"Feature",properties:{gid:307,area:0,perimeter:0,am_cam_:"307",am_cam_id:"307",nome:"CASTEL FOCOGNANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1728705.52,4837089.35]]}},{type:"Feature",properties:{gid:260,area:0,perimeter:0,am_cam_:"260",am_cam_id:"260",nome:"SCANDICCI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1673835.0913760145,4846658.266475415]]}},{type:"Feature",properties:{gid:308,area:0,perimeter:0,am_cam_:"308",am_cam_id:"308",nome:"CHITIGNANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1732292.75,4838309.8]]}},{type:"Feature",properties:{gid:309,area:0,perimeter:0,am_cam_:"309",am_cam_id:"309",nome:"BIBBIENA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1727137.625,4841808]]}},{type:"Feature",properties:{gid:310,area:0,perimeter:0,am_cam_:"310",am_cam_id:"310",nome:"ORTIGNANO RAGGIOLO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1721892.3,4840200.15]]}},{type:"Feature",properties:{gid:311,area:0,perimeter:0,am_cam_:"311",am_cam_id:"311",nome:"CHIUSI DELLA VERNA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1736484.52,4842753.43]]}},{type:"Feature",properties:{gid:312,area:0,perimeter:0,am_cam_:"312",am_cam_id:"312",nome:"POPPI",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1722787.665,4844874.375]]}},{type:"Feature",properties:{gid:313,area:0,perimeter:0,am_cam_:"313",am_cam_id:"313",nome:"CASTEL SAN NICCOL",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1717872.475,4846782.845]]}},{type:"Feature",properties:{gid:314,area:0,perimeter:0,am_cam_:"314",am_cam_id:"314",nome:"STIA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1717925.385,4853100.09]]}},{type:"Feature",properties:{gid:315,area:0,perimeter:0,am_cam_:"315",am_cam_id:"315",nome:"PRATOVECCHIO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1718984.7,4852103.48]]}},{type:"Feature",properties:{gid:316,area:0,perimeter:0,am_cam_:"316",am_cam_id:"316",nome:"CASTELFRANCO DI SOPRA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1706127.95,4832965.8]]}},{type:"Feature",properties:{gid:317,area:0,perimeter:0,am_cam_:"317",am_cam_id:"317",nome:"MONTEMIGNAIO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1710986.46729795,4846341.57]]}},{type:"Feature",properties:{gid:318,area:0,perimeter:0,am_cam_:"318",am_cam_id:"318",nome:"PIAN DI SC",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1705488.65,4835211.65]]}},{type:"Feature",properties:{gid:319,area:0,perimeter:0,am_cam_:"319",am_cam_id:"319",nome:"LUCIGNANO",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1722875.335,4795008.775]]}},{type:"Feature",properties:{gid:320,area:0,perimeter:0,am_cam_:"320",am_cam_id:"320",nome:"AREZZO",tipo_ente:"PROVINCIA"},geometry:{type:"MultiPoint",coordinates:[[1733221.82663486,4816678.42556777]]}},{type:"Feature",properties:{gid:265,area:0,perimeter:0,am_cam_:"265",am_cam_id:"265",nome:"VAGLIA",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1686501.7526898214,4862889.18760077]]}},{type:"Feature",properties:{gid:243,area:0,perimeter:0,am_cam_:"243",am_cam_id:"243",nome:"FIRENZE",tipo_ente:"COMUNE"},geometry:{type:"MultiPoint",coordinates:[[1681145.3531140334,4848869.348600103]]}}]}},{"core/layers/features/feature":40,"core/layers/providers/provider":52,"core/utils/utils":80}],55:[function(e,t,i){function r(e){e=e||{},n(this,e),this._name="wfs"}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/layers/providers/provider"),s=e("core/layers/filter/filter");o(r,a);var l=r.prototype;l.getData=function(){var e=$.Deferred();return e.promise()},l.query=function(e){var t=this,i=e.filter,r=$.Deferred();return this._doRequest(i).done(function(e){var i=t.handleQueryResponseFromServer(e,"wfs");r.resolve({data:i})}).fail(function(e){r.reject(e)}),r.promise()},l._post=function(e,t){return e+="/",$.post(e,t)},l._get=function(e,t){var i=$.param(t);return e=e+"?"+i,$.get(e)},l._doRequest=function(e){if(e instanceof s){var t=this._layer,i=t.getQueryUrl(),r=t.getProjection().getCode(),o=t.getInfoFormat(),n={SERVICE:"WFS",VERSION:"1.3.0",REQUEST:"GetFeature",TYPENAME:t.getQueryLayerName().replace(/ /g,"_"),OUTPUTFORMAT:o,SRSNAME:r},a=e.getBBOX();if(a)n.BBOX=a.join(),request=this._get(i,n);else{var l=e.getGeometry();if(l){var c=ol.format.filter,u=(new ol.format.WFS).writeGetFeature({featureTypes:[t],filter:c.intersects("the_geom",l)});e=u.children[0].innerHTML,n.FILTER=e,request=this._post(i,n)}}return request}},t.exports=r},{"core/layers/filter/filter":43,"core/layers/providers/provider":52,"core/utils/utils":80}],56:[function(e,t,i){function r(e){e=e||{},n(this,e),this._name="wms",this._url=this._layer.getQueryUrl(),this._layerName=this._layer.getName()||null,this._infoFormat=this._layer.getInfoFormat()||"application/vnd.ogc.gml"}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/utils/utils"),s=e("g3w-ol3/src/utils/utils"),l=e("core/layers/providers/provider"),c=10,u=[101,101];o(r,l);var p=r.prototype;p._getRequestUrl=function(e,t,i,r,o,n){n.CRS=o.getCode(),"STYLES"in n||(n.STYLES=""),n.DPI=90*r,n.WIDTH=i[0],n.HEIGHT=i[1];var s,l=o.getAxisOrientation();return s="ne"==l.substr(0,2)?[t[1],t[0],t[3],t[2]]:t,n.BBOX=s.join(","),a.appendParams(e,n)},p._getGetFeatureInfoUrlForLayer=function(e,t,i,r){var o=s.getExtentForViewAndSize(t,i,0,u),n={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetFeatureInfo",FORMAT:"image/png",TRANSPARENT:!0,QUERY_LAYERS:this._layer.getName()};_.merge(n,r);var a=Math.floor((t[0]-o[0])/i),l=Math.floor((o[3]-t[1])/i);return n.I=a,n.J=l,this._getRequestUrl(e,o,u,1,this._layer.getProjection(),n)},p.query=function(e){var t=$.Deferred(),i=e.coordinates||[],r=e.resolution||null,o=this._url,n=o.split("SOURCE");n.length&&(o=n[0],n=n.length>1?"&SOURCE"+n[1]:"");var a={LAYERS:this._layerName,QUERY_LAYERS:this._layerName,INFO_FORMAT:this._infoFormat,FEATURE_COUNT:10,FI_POINT_TOLERANCE:c,FI_LINE_TOLERANCE:c,FI_POLYGON_TOLERANCE:c,G3W_TOLERANCE:c*r},s=this._getGetFeatureInfoUrlForLayer(o,i,r,a),l=s.split("?")[1];return o+="?"+l+n,this.makeQueryForLayer(o,i,r).then(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}),t.promise()},p.makeQueryForLayer=function(e,t,i){var r=$.Deferred(),o={coordinates:t,resolution:i};return this.doRequestAndParse(e).then(function(e){r.resolve({data:e,query:o})}).fail(function(e){r.reject(e)}),r.promise()},p.doRequestAndParse=function(e){var t=this,i=$.Deferred();return $.get(e).done(function(e){var r=t.handleQueryResponseFromServer(e,this._infoFormat,this._layerName);i.resolve(r)}).fail(function(){i.reject()}),i},t.exports=r},{"core/layers/providers/provider":52,"core/utils/utils":80,"g3w-ol3/src/utils/utils":111}],57:[function(e,t,i){function r(e){e=e||{},n(this),this._name="xml"}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/layers/providers/provider");o(r,a);var s=r.prototype;s.getData=function(){var e=$.Deferred();return e.promise()},t.exports=r},{"core/layers/providers/provider":52,"core/utils/utils":80}],58:[function(e,t,i){function r(e){n(this,e),this.type=a.LayerTypes.TABLE,this._editor=new s(this),this._featuresStore=new l({provider:this.providers.data})}var o=e("core/utils/utils").inherit,n=e("core/utils//utils").base,a=e("./layer"),s=e("core/editing/editor"),l=e("./features/featuresstore");o(r,a);var c=r.prototype;c.getEditor=function(){return this._editor},c.setEditor=function(e){this._editor=e},c._startEditing=function(){console.log("start editing")},c._stopEditing=function(){console.log("stop editing")},c.getFeaturesStore=function(){return this._featuresStore},c.readFeatures=function(){return this._featuresStore.readFeatures()},c._clearFeatures=function(){this._featuresStore.clearFeatures()},c.getFeatures=function(e){var t=$.Deferred();return this._featuresStore.getFeatures(e).then(function(e){return t.resolve(e)}),t.promise()},t.exports=r},{"./features/featuresstore":41,"./layer":46,"core/editing/editor":25,"core/utils//utils":80,"core/utils/utils":80}],59:[function(e,t,i){function r(e){e=e||{},n(this,e),this.type=Layer.LayerTypes.VECTOR,_.extend(this.state,{geolayer:!0,bbox:e.bbox||null})}var o=e("core/utils/utils").inherit,n=e("core/utils//utils").base,a=e("core/utils/utils").mixin,s=e("./tablelayer"),l=e("./geolayermixin");o(r,s),a(r,l);r.prototype;t.exports=r},{"./geolayermixin":44,"./tablelayer":58,"core/utils//utils":80,"core/utils/utils":80}],60:[function(e,t,i){function r(e,t){n(this,e),this.layer=null}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=(e("core/utils/geo"),e("core/map/layer/maplayer"));e("g3w-ol3/src/layers/bases");o(r,a);var s=r.prototype;s.getOLLayer=function(){var e=this._olLayer;return e||(e=this._olLayer=this._makeOlLayer()),e},s.getSource=function(){return this.getOLLayer().getSource()},s.getLayerConfigs=function(){return this.layer},s.addLayer=function(e){this.layer=e},s.toggleLayer=function(e){this._updateLayers()},s.update=function(e,t){this._updateLayer(e,t)},s.isVisible=function(){return layer.state.visible},s._makeOlLayer=function(){
var e,t=this,i=this.layer.state.source?this.layer.state.source.subtype:null;switch(i){case"streets":e=BaseLayers.BING.Road;break;case"aerial":e=BaseLayers.BING.Aerial;break;case"aerialwithlabels":e=BaseLayers.BING.AerialWithLabels;break;default:e=BaseLayers.BING.Aerial}return e.getSource().on("imageloadstart",function(){t.emit("loadstart")}),e.getSource().on("imageloadend",function(){t.emit("loadend")}),e},s._updateLayer=function(e,t){this._olLayer.setVisible(this.layer.isVisible())},t.exports=r},{"core/map/layer/maplayer":63,"core/utils/geo":79,"core/utils/utils":80,"g3w-ol3/src/layers/bases":105}],61:[function(e,t,i){function r(){this._layers={},this._type="tipo di layers",this._isReady=!1,n(this)}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/g3wobject");o(r,a);var s=r.prototype;s.getLoaderType=function(){return this._type},s.getLayers=function(){return this._layers},s.getLayer=function(e){return this._layers[e]},s.loadLayer=function(e,t){},s.loadLayers=function(){},s.cleanUpLayers=function(){},s.setReady=function(e){this._isReady=e},s.isReady=function(){return this._isReady},s.setMode=function(e){switch(e){case"w":this._editingMode=!0;break;case"r":this._editingMode=!1;break;default:e="w",this._editingMode=!0}this._mode=e,this.emit("setmode",e)},s.getMode=function(){return this._mode},t.exports=r},{"core/g3wobject":36,"core/utils/utils":80}],62:[function(e,t,i){function r(){this._layer={},this._type="vector",this._layerCodes=[],this._baseUrl="",this._mapService=null,this._loadedExtent=null,this._editingMode=!1,this._customUrlParameters="",this._vectorLayersCodes=[],this._vectorLayersData={},n(this),this.init=function(e){this._layers=e.layers||{},this._baseUrl=e.baseurl||"",this._mapService=e.mapService||null,this._layerCodes=_.keys(this._layers),this._editingApiField=e.editingApiField||"name"}}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/utils/utils").resolve,s=e("core/map/layer/vectorlayer"),l=e("./loaderlayer");o(r,l);var c=r.prototype;c.loadLayers=function(e,t){var i=this,r=$.Deferred(),o=[];this.setMode(e),t&&this._setCustomUrlParameters(t),_.forEach(this._layers,function(e,t){_.isNull(e.vector)&&o.push(t)});var n=_.map(o,function(e){return i._setupVectorLayer(e)});return i.emit("loadingvectorlayersstart"),$.when.apply(this,n).then(function(){var e=Array.prototype.slice.call(arguments);i.emit("loadingvectolayersdatastart"),i.loadAllVectorsData(e).then(function(){i._vectorLayersCodes=e,r.resolve(e),i.emit("loadingvectorlayersend"),i.setReady(!0)}).fail(function(){_.forEach(i._layers,function(e){e.vector=null}),r.reject(),i.emit("errorloadingvectorlayersend"),i.setReady(!1)})}).fail(function(){i.setReady(!1),i.emit("errorloadingvectorlayersend"),r.reject()}),r.promise()},c.setVectorLayersCodes=function(e){this._vectorLayersCodes=e},c.getVectorLayersCodes=function(){return this._vectorLayersCodes},c.getLayers=function(){return this._layers},c.reloadVectorData=function(e){var t=this,i=$.Deferred(),r=this._mapService.state.bbox;return t._createVectorLayerFromConfig(e).then(function(e){t._getVectorLayerData(e,r).then(function(r){t.setVectorLayerData(e[t._editingApiField],r),e.setData(r.vector.data),i.resolve(e)})}),i.promise()},c.loadAllVectorsData=function(e){var t=this,i=$.Deferred(),r=this._layers,o=this._mapService.state.bbox,n=this._loadedExtent;if(n&&ol.extent.containsExtent(n,o))return a();n?this._loadedExtent=ol.extent.extend(n,o):this._loadedExtent=o,e&&(r=[],_.forEach(e,function(e){r.push(t._layers[e])}));var s=_.map(r,function(e){return t._loadVectorData(e.vector,o)});return $.when.apply(this,s).then(function(){i.resolve(e)}).fail(function(){i.reject()}),i.promise()},c._setCustomUrlParameters=function(e){this._customUrlParameters=e},c._checkVectorGeometryTypeFromConfig=function(e){switch(e.geometrytype){case"Line":e.geometrytype="LineString";break;case"MultiLine":e.geometrytype="MultiLineString"}return e},c._createVectorLayerFromConfig=function(e){var t=this,i=this._layers[e],r=$.Deferred();return this._getVectorLayerConfig(i[this._editingApiField]).then(function(e){var o=e.vector;o=t._checkVectorGeometryTypeFromConfig(o);var n=i.crs||t._mapService.getProjection().getCode(),a=t._createVectorLayer({geometrytype:o.geometrytype,format:o.format,crs:t._mapService.getProjection().getCode(),crsLayer:n,id:i.id,name:i.name,pk:o.pk,editing:t._editingMode});a.setFields(o.fields),a.setCrs(n);var s=o.relations;s&&(a.lazyRelations=!0,a.setRelations(s)),i.style&&a.setStyle(i.style),r.resolve(a)}).fail(function(){r.reject()}),r.promise()},c._setupVectorLayer=function(e){var t=this,i=$.Deferred();return this._createVectorLayerFromConfig(e).then(function(r){var o=t._layers[e];o.vector=r,i.resolve(e)}).fail(function(){i.reject()}),i.promise()},c._loadVectorData=function(e,t){var i=this;return i._getVectorLayerData(e,t).then(function(t){if(i.setVectorLayerData(e[i._editingApiField],t),i._editingMode&&t.featurelocks&&i.setVectorFeaturesLock(e,t.featurelocks),e.setData(t.vector.data),i._)return t}).fail(function(){return!1})},c.getVectorLayerData=function(e){return this._vectorLayersData[e]},c.getVectorLayersData=function(){return this._vectorLayersData},c.setVectorLayerData=function(e,t){this._vectorLayersData[e]=t},c.setVectorFeaturesLock=function(e,t){var i=_.differenceBy(t,e.getFeatureLocks(),"featureid");_.forEach(i,function(t){e.addLockId(t)})},c.cleanVectorFeaturesLock=function(e){e.cleanFeatureLocks()},c.lockFeatures=function(e){var t=this,i=$.Deferred(),r=this._mapService.state.bbox,o=this._layers[e].vector;return $.get(this._baseUrl+e+"/?lock"+this._customUrlParameters+"&in_bbox="+r[0]+","+r[1]+","+r[2]+","+r[3]).done(function(e){t.setVectorFeaturesLock(o,e.featurelocks),i.resolve(e)}).fail(function(){i.reject()}),i.promise()},c._getVectorLayerConfig=function(e){var t=$.Deferred();return $.get(this._baseUrl+e+"/?config"+this._customUrlParameters).done(function(e){t.resolve(e)}).fail(function(){t.reject()}),t.promise()},c._getVectorLayerData=function(e,t){var i,r=$.Deferred(),o="w"==this.getMode();return i=o?this._baseUrl+e[this._editingApiField]+"/?editing":this._baseUrl+e[this._editingApiField]+"/?",$.get(i+this._customUrlParameters+"&in_bbox="+t[0]+","+t[1]+","+t[2]+","+t[3]).done(function(e){r.resolve(e)}).fail(function(){r.reject()}),r.promise()},c._createVectorLayer=function(e){var t=new s(e);return t},c.cleanUpLayers=function(){this._loadedExtent=null},t.exports=r},{"./loaderlayer":61,"core/map/layer/vectorlayer":65,"core/utils/utils":80}],63:[function(e,t,i){function r(e){this.config=e||{},this.id=e.id,this.projection=e.projection,this._olLayer=null,n(this)}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/g3wobject");o(r,a);var s=r.prototype;s.getId=function(){return this.id},t.exports=r},{"core/g3wobject":36,"core/utils/utils":80}],64:[function(e,t,i){function r(e,t){n(this,e),this.layer=null}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=(e("core/utils/geo"),e("core/map/layer/maplayer")),s=e("g3w-ol3/src/layers/bases");o(r,a);var l=r.prototype;l.getOLLayer=function(){var e=this._olLayer;return e||(e=this._olLayer=this._makeOlLayer()),e},l.getSource=function(){return this.getOLLayer().getSource()},l.getLayerConfigs=function(){return this.layer},l.addLayer=function(e){this.layer=e},l.toggleLayer=function(e){this._updateLayers()},l.update=function(e,t){this._updateLayer(e,t)},l.isVisible=function(){return layer.state.visible},l._makeOlLayer=function(){var e=this,t=s.OSM;return t.getSource().on("imageloadstart",function(){e.emit("loadstart")}),t.getSource().on("imageloadend",function(){e.emit("loadend")}),t},l._updateLayer=function(e,t){this._olLayer.setVisible(this.layer.isVisible())},t.exports=r},{"core/map/layer/maplayer":63,"core/utils/geo":79,"core/utils/utils":80,"g3w-ol3/src/layers/bases":105}],65:[function(e,t,i){function r(e){var e=e||{};this.geometrytype=e.geometrytype||null,this.format=e.format||null,this.crs=e.crs||null,this.crsLayer=e.crsLayer||this.crs,this.id=e.id||null,this.name=e.name||"",this.pk=e.pk||"id",this._newPrefix="_new_",this._olSource=new ol.source.Vector({features:new ol.Collection}),this._olLayer=new ol.layer.Vector({name:this.name,source:this._olSource}),this._isReady=!1,this._PKinAttributes=!1,this._featuresFilter=null,this._fields=null,this._relationsDataLoaded={},this.lazyRelations=!0,this._relations=null,this._editingMode=e.editing||!1,this._loadedIds=[],this._featureLocks=[],this._crs=null}var o=e("core/utils/utils").inherit,n=(e("core/utils/utils").truefnc,e("core/utils/utils").resolve),a=(e("core/utils/utils").reject,e("core/g3wobject"));o(r,a),t.exports=r;var s=r.prototype;s.getPk=function(){return this.pk},s.setData=function(e){var t,i=this,r=[];if(this.format){switch(this.format){case"GeoJSON":var o=new ol.format.GeoJSON({geometryName:"geometry"});t=o.readFeatures(e,{dataProjection:i.crsLayer,featureProjection:i.crs})}if(this._editingMode&&this._featureLocks&&(t=_.filter(t,function(e){var t=!1;return _.forEach(i._featureLocks,function(i){i.featureid==e.getId()&&(t=!0,r.push(e.getId()))}),t})),t&&t.length){_.isNull(this._featuresFilter)||(t=_.map(t,function(e){return i._featuresFilter(e)}));var n=_.filter(t,function(e){return!_.includes(i._loadedIds,e.getId())});this._olSource.addFeatures(n);var a=this.getSource().getFeatures()[0].getProperties();this._PKinAttributes=!!_.get(a,this.pk),this._loadedIds=_.union(this._loadedIds,r)}}else console.log("VectorLayer format not defined")},s.cleanFeatureLocks=function(){this._featureLocks=[]},s.setFeatureLocks=function(e){this._featureLocks=e},s.getFeatureLocks=function(){return this._featureLocks},s.addLockId=function(e){this._featureLocks.push(e)},s.setFeatureData=function(e,t,i,r){var o=this.getFeatureById(e)||this.getFeatureById(t);if(o&&(e&&e!=t&&o.setId(t),i&&o.setGeometry(i),r)){var n=o.getProperties(),a=_.assign(n,r);o.setProperties(a)}return r&&r.relations&&this.addRelationElements(r.relations),o},s.addRelationElements=function(e){var t=this,i=e.featureid;this.getFeatureById(i);_.forEach(e,function(e,r){_.forEach(t._relationsDataLoaded[i],function(t){t.name==r&&_.forEach(e,function(e){_.forEach(t.elements,function(t){t.id==e.clientid&&(t.id=e.id)})})})})},s.addFeature=function(e){this.getSource().addFeature(e)},s.addFeatures=function(e){this.getSource().addFeatures(e)},s.modifyFeatureGeometry=function(e,t){var i=this.getFeatures(),r=null;return _.forEach(i,function(r,o){if(r.getId()==e)return i[o].setGeometry(t),r=r[o]}),r},s.setFeaturesFilter=function(e){this._featuresFilter=e},s.setFields=function(e){this._fields=e},s.setCrs=function(e){this._crs=e},s.getCrs=function(){return this._crs},s.setPkField=function(){var e=this,t=!1;_.forEach(this._fields,function(i){i.name==e.pk&&(t=!0)}),t||this._fields},s.getFeatures=function(){return this.getSource().getFeatures()},s.getFeatureIds=function(){var e=_.map(this.getSource().getFeatures(),function(e){return e.getId()});return e},s.getIntersectedFeatures=function(e){var t=[];return _.forEach(this.getFeatures(),function(i){e.intersectsExtent(i.getGeometry().getExtent())&&t.push(i)}),t},s.getFields=function(){return _.cloneDeep(this._fields)},s.getAttributes=function(){return this._fields},s.getFieldsNames=function(){return _.map(this._fields,function(e){return e.name})},s.getFieldsWithValues=function(e){var t,i,r=this,o=_.cloneDeep(this._fields);return e instanceof ol.Feature?t=e:e&&(t=this.getFeatureById(e)),t&&(i=t.getProperties()),_.forEach(o,function(e){t?this._PKinAttributes||e.name!=r.pk?e.value=i[e.name]:r.isNewFeature(t.getId())?e.value=null:e.value=t.getId():e.value=null}),o},s.setRelations=function(e){this._relations=e,_.forEach(e,function(e){_.forEach(e.fields,function(t,i){t.name==e.pk&&(e.pkFieldIndex=i)})})},s.getRelations=function(){return this._relations},s.getRelationsAttributes=function(){var e={};return _.forEach(this._relations,function(t){e[t.name]=t.fields}),e},s.getRelation=function(e){var t;return _.forEach(this._relations,function(i){i.name==e&&(t=i)}),t},s.hasRelations=function(){return!_.isNull(this._relations)},s.getRelationPkFieldIndex=function(e){var t;return _.forEach(e.fields,function(i,r){i.name==e.pk&&(t=r)}),t},s.getRelationElementPkValue=function(e,t){var i=this.getRelationPkFieldIndex(e);return t.fields[i].value},s.getRelationsFksKeys=function(){var e=[];return _.forEach(this._relations,function(t){e.push(t.fk)}),e},s.getRelationFields=function(e){return e.fields},s.getRelationFieldsNames=function(e){return _.map(relationFields,function(e){return e.name})},s.getRelationsWithValues=function(e){var t=this;this._relations||n([]);var i=_.cloneDeep(this._relations);if(e||this.getFeatureById(e)){if(this.lazyRelations){if(t._relationsDataLoaded[e])return n(this._relationsDataLoaded[e]);var r=$.Deferred(),o=this.getFeatureById(e).getProperties(),a={};return _.forEach(i,function(i){_.forEach(i.fk,function(i){i==t.pk?a[i]=e:a[i]=o[i]})}),this.getRelationsWithValuesFromFks(a).then(function(i){t._relationsDataLoaded[e]=i,r.resolve(i)}).fail(function(){r.reject()}),r.promise()}return n(this._relations)}return _.forEach(i,function(e){e.elements=[]}),n(i)},s.getRelationsWithValuesFromFks=function(e,t){var i=_.cloneDeep(this._relations),r=[];return _.forEach(i,function(i){i.elements=[];var o=i.url,n=[];_.forEach(i.fk,function(t){var i=e[t];n.push(t+"="+i)});var a=_.join(n,"&");o+="?"+a,r.push($.get(o).then(function(e){e.length&&_.forEach(e,function(e){var r={};r.fields=_.cloneDeep(i.fields),_.forEach(r.fields,function(o){if(o.value=e[o.name],o.name==i.pk){r.id=o.value;var n=t?"NEW":"OLD";r.state=n}}),i.elements.push(r)})}))}),$.when.apply(this,r).then(function(){return i})},s.getNewRelationsWithValuesFromFks=function(e){return this.getRelationsWithValuesFromFks(e,!0)},s.featureHasRelationsFksWithValues=function(e){var t=e.getProperties(),i=this.getRelationsFksKeys();return _.every(i,function(e){var i=t[e];return!_.isNil(i)&&""!=i})},s.getRelationsFksWithValuesForFeature=function(e){var t=e.getProperties(),i={},r=this.getRelationsFksKeys();return _.forEach(r,function(e){i[e]=t[e]}),i},s.setRelationsData=function(e,t){this._relationsDataLoaded[e]=t},s.setStyle=function(e){this._olLayer.setStyle(e)},s.getMapLayer=function(){return this._olLayer},s.getSource=function(){return this._olLayer.getSource()},s.getFeatureById=function(e){if(e)return this._olLayer.getSource().getFeatureById(e)},s.isVisible=function(){return this._olLayer.getVisible()},s.setVisible=function(e){this._olLayer.setVisible(e)},s.clear=function(){this.getSource().clear()},s.addToMap=function(e){e.addLayer(this._olLayer)},s.isNewFeature=function(e){return!e||0==e.toString().indexOf(this._newPrefix)}},{"core/g3wobject":36,"core/utils/utils":80}],66:[function(e,t,i){function r(e,t){this.LAYERTYPE={LAYER:"layer",MULTILAYER:"multilayer"},this.extraParams=t,this.layers=[],n(this,e)}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/utils/geo"),s=e("core/map/layer/maplayer"),l=e("g3w-ol3/src/layers/rasters");o(r,s);var c=r.prototype;c.getOLLayer=function(e){var t=this._olLayer;return t||(t=this._olLayer=this._makeOlLayer(e)),t},c.getSource=function(){return this.getOLLayer().getSource()},c.getInfoFormat=function(){return"application/vnd.ogc.gml"},c.getGetFeatureInfoUrl=function(e,t,i,r){return this.getOLLayer().getSource().getGetFeatureInfoUrl(e,t,i,r)},c.getLayerConfigs=function(){return this.layers},c.addLayer=function(e){this.layers.push(e)},c.toggleLayer=function(e){_.forEach(this.layers,function(t){t.id==e.id&&(t.visible=e.visible)}),this._updateLayers()},c.update=function(e,t){this._updateLayers(e,t)},c.isVisible=function(){return this._getVisibleLayers().length>0},c.getQueryUrl=function(){var e=this.layers[0];return e.infourl&&""!=e.infourl?e.infourl:this.config.url},c.getQueryableLayers=function(){return _.filter(this.layers,function(e){return e.isQueryable()})},c._getVisibleLayers=function(e){var t=[];return _.forEach(this.layers,function(i){var r=!i.state.maxresolution||i.state.maxresolution&&i.state.maxresolution>e.resolution;i.state.visible&&r&&t.push(i)}),t},c._makeOlLayer=function(e){var t=this,i={url:this.config.url,id:this.config.id};e&&(i.layers=_.map(this.layers,function(e){return e.getWMSLayerName()}));var r=this.layers[0];r.state.source&&"wms"==r.state.source.type&&r.state.source.url&&(i.url=r.state.source.url);var o=new l.WMSLayer(i,this.extraParams);return o.getSource().on("imageloadstart",function(){t.emit("loadstart")}),o.getSource().on("imageloadend",function(){t.emit("loadend")}),o},c.checkLayerDisabled=function(e,t){var i=a.resToScale(t),r=!0;e.config.maxresolution&&(r=r&&e.config.maxresolution>t),e.config.minresolution&&(r=r&&e.config.minresolution<t),e.config.minscale&&(r=r&&e.config.minscale>i),e.config.maxscale&&(r=r&&e.config.maxscale<i),e.state.disabled=!r},c.checkLayersDisabled=function(e){var t=this;_.forEach(this.layers,function(i){t.checkLayerDisabled(i,e)})},c._updateLayers=function(e,t){this.checkLayersDisabled(e.resolution);var i=this._getVisibleLayers(e);if(i.length>0){var r={LAYERS:_.join(_.map(i,function(e){return e.getWMSLayerName()}),",")};t&&(r=_.assign(r,t)),this._olLayer.setVisible(!0),this._olLayer.getSource().updateParams(r)}else this._olLayer.setVisible(!1)},t.exports=r},{"core/map/layer/maplayer":63,"core/utils/geo":79,"core/utils/utils":80,"g3w-ol3/src/layers/rasters":106}],67:[function(e,t,i){function r(e,t){n(this,e),this.layer=null}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=(e("core/utils/geo"),e("core/map/layer/maplayer")),s=e("g3w-ol3/src/layers/rasters");o(r,a);var l=r.prototype;l.getOLLayer=function(){var e=this._olLayer;return e||(e=this._olLayer=this._makeOlLayer()),e},l.getSource=function(){return this.getOLLayer().getSource()},l.getLayerConfigs=function(){return this.layer},l.addLayer=function(e){this.layer=e},l.toggleLayer=function(e){this._updateLayers()},l.update=function(e,t){this._updateLayer(e,t)},l.isVisible=function(){return layer.state.visible},l._makeOlLayer=function(){var e=this,t=this.projection?this.projection:this.layer.getProjection(),i={url:this.layer.getCacheUrl()+"/{z}/{x}/{y}.png",maxZoom:20};i.projection=t;var r=s.XYZLayer(i);return r.getSource().on("imageloadstart",function(){e.emit("loadstart")}),r.getSource().on("imageloadend",function(){e.emit("loadend")}),r},l._updateLayer=function(e,t){this._olLayer.setVisible(this.layer.isVisible())},t.exports=r},{"core/map/layer/maplayer":63,"core/utils/geo":79,"core/utils/utils":80,"g3w-ol3/src/layers/rasters":106}],68:[function(e,t,i){function r(){n(this)}var o=e("core/utils/utils").inherit,n=e("core/utils//utils").base,a=e("core/layers/layersstoresregistry");o(r,a),t.exports=new r},{"core/layers/layersstoresregistry":49,"core/utils//utils":80,"core/utils/utils":80}],69:[function(e,t,i){var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,n=e("core/g3wobject"),a=e("core/project/projectsregistry"),s=e("./pluginsregistry"),l=function(){o(this),this.name="(no name)",this.config=null,this.service=null};r(l,n);var c=l.prototype;c.getService=function(){return this.service},c.setService=function(e){this.service=e},c.getName=function(){return this.name},c.setName=function(e){this.name=e},c.getConfig=function(e){return e=e||this.name,s.getPluginConfig(e)},c.setConfig=function(e){this.config=e},c.isCurrentProjectCompatible=function(e){var t=a.getCurrentProject();return e==t.getGid()},c.registerPlugin=function(e){return!!this.isCurrentProjectCompatible(e)&&(s.registerPlugin(this),!0)},c.setupGui=function(){},c.unload=function(){},c.load=function(){},t.exports=l},{"./pluginsregistry":71,"core/g3wobject":36,"core/project/projectsregistry":76,"core/utils/utils":80}],70:[function(e,t,i){function r(e){var e=e||{};n(this,e),this.init=function(e){this.config=e}}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/g3wobject");o(r,a);var s=r.prototype;s.getConfig=function(){return this.config},s.setConfig=function(e){this.config=e},t.exports=r},{"core/g3wobject":36,"core/utils/utils":80}],71:[function(e,t,i){function r(){var t=this;this.config=null,this._plugins={},this._loadedPluginUrls=[],this.setters={registerPlugin:function(e){t._plugins[e.name]||(t._plugins[e.name]=e)}},o(this),this.init=function(e){var t=this;this.pluginsBaseUrl=e.pluginsBaseUrl,this.pluginsConfigs=e.pluginsConfigs,this.otherPluginsConfig=e.otherPluginsConfig,this.setOtherPlugins(),_.forEach(this.pluginsConfigs,function(e,i){t._setup(i,e)})},this.setOtherPlugins=function(){this.otherPluginsConfig&&this.otherPluginsConfig.law&&this.otherPluginsConfig.law.length&&(this.pluginsConfigs.law=this.otherPluginsConfig.law)},this.reloadPlugins=function(t){var i=this,r=e("core/applicationservice");window.initConfig=null,r.obtainInitConfig().then(function(e){s.getComponent("tools").getService().removeTools(),i.setPluginsConfig(e.group.plugins),i.setOtherPlugins();var t=$("script");_.forEach(i.getPlugins(),function(e,r){_.keys(i.pluginsConfigs).indexOf(r)==-1?(e.unload(),delete i._plugins[r],_.forEach(t,function(e){_.forEach(i._loadedPluginUrls,function(t,o){if(e.getAttribute("src")==t&&t.indexOf(r)!=-1)return e.parentNode.removeChild(e),i._loadedPluginUrls.splice(o,1),!1})})):(e.load(),delete i.pluginsConfigs[r])}),_.forEach(i.pluginsConfigs,function(e,t){i._setup(t,e)})})},this.setPluginsConfig=function(e){this.pluginsConfigs=e},this._setup=function(e,t){if(t){var i=this.pluginsBaseUrl+e+"/js/plugin.js?"+Date.now();$script(i),this._loadedPluginUrls.push(i)}},this.getPluginConfig=function(e){return this.pluginsConfigs[e]},this.getPlugins=function(){return this._plugins},this.getPlugin=function(e){return this._plugins[e]}}var o=e("core/utils/utils").base,n=e("core/utils/utils").inherit,a=e("core/g3wobject"),s=e("gui/gui");n(r,a),t.exports=new r},{"core/applicationservice":22,"core/g3wobject":36,"core/utils/utils":80,"gui/gui":135}],72:[function(e,t,i){function r(){n(this),this.print=function(e){var e=e||{},t=e.type||"QGIS",i=new s(t),r=i.print(e);return $.get(r)}}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/g3wobject"),s=e("./providers/printerprovider");o(r,a),t.exports=new r},{"./providers/printerprovider":73,"core/g3wobject":36,"core/utils/utils":80}],73:[function(e,t,i){function r(e){var e=e||{},t=e.serverType||"QGIS";this._provider=l[t],this.print=function(e){return this._provider.print(e)},n(this)}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/g3wobject"),s=e("./qgis/printerQGISProvider"),l={QGIS:s};o(r,a),t.exports=r},{"./qgis/printerQGISProvider":74,"core/g3wobject":36,"core/utils/utils":80}],74:[function(e,t,i){function r(){n(this),this._getPrintUrl=function(e){var e=e||{},t=s.getCurrentProject().getLayersStore(),i=e.map||"map0",r=t.getWmsUrl(),o=_.reverse(t.getLayers({ACTIVE:!0,VISIBLE:!0,SERVERTYPE:"QGIS"}));o=_.map(o,function(e){return e.getQueryLayerName()});var n={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetPrint",TEMPLATE:e.template,DPI:e.dpi,FORMAT:"pdf",CRS:t.getProjection().getCode(),LAYERS:o.join()};return n[i+":SCALE"]=e.scale,n[i+":EXTENT"]=e.extent,n[i+":ROTATION"]=e.rotation,r=r+"?"+$.param(n)},this.print=function(e){var e=e||{};return this._getPrintUrl(e)}}var o=e("core/utils/utils").inherit,n=(e("core/utils/utils").resolve,e("core/utils/utils").base),a=e("core/g3wobject"),s=e("core/project/projectsregistry");o(r,a),t.exports=new r},{"core/g3wobject":36,"core/project/projectsregistry":76,"core/utils/utils":80}],75:[function(e,t,i){function r(e){var t=this;this.state=e,this._processLayers(),this._projection=c.get(this.state.crs,this.state.proj4),this._layersStore=this._buildLayersStore(),this.setters={setBaseLayer:function(e){_.forEach(t.state.baselayers,function(t){t.visible=t.id==e||t.fixed===!0})}},n(this)}var o=e("core/utils/utils").inherit,n=e("core/utils//utils").base,a=e("core/g3wobject"),s=e("core/layers/layerfactory"),l=(e("core/layers/imagelayer"),e("core/layers/layersstore")),c=e("g3w-ol3/src/projection/projections");o(r,a);var u=r.prototype;u._processLayers=function(){function e(i){_.forIn(i,function(r,o){if(!_.isNil(r.id)){var n;_.forEach(t.state.layers,function(e){if(r.id==e.id)return e.wmsUrl=t.getWmsUrl(),e.project=t,n=_.merge(e,r),!1}),i[parseInt(o)]=n}_.isNil(r.nodes)||(r.title=r.name,e(r.nodes))})}var t=this;e(this.state.layerstree),_.forEach(this.state.baselayers,function(e){var i=!1;t.state.initbaselayer&&(i=e.id==t.state.initbaselayer),e.fixed&&(i=e.fixed),e.visible=i,e.baselayer=!0})},u._buildLayersStore=function(){var e=this,t=new l,i=this.state.overviewprojectgid?this.state.overviewprojectgid.gid:null;return t.setOptions({id:this.state.gid,projection:this._projection,extent:this.state.extent,initextent:this.state.initextent,wmsUrl:this.state.WMSUrl,catalog:this.state.gid!=i}),_.forEach(this.getLayers(),function(i){i.projection=e._projection;var r=s.build(i);t.addLayer(r)}),t.createLayersTree(this.state.name,{layerstree:this.state.layerstree}),t},u.getLayers=function(){return _.concat(this.state.layers,this.state.baselayers)},u.getState=function(){return this.state},u.getId=function(){return this.state.id},u.getType=function(){return this.state.type},u.getGid=function(){return this.state.gid},u.getName=function(){return this.state.name},u.getOverviewProjectGid=function(){return this.state.overviewprojectgid?this.state.overviewprojectgid.gid:null},u.getCrs=function(){return this._projection.getCode()},u.getProjection=function(){return this._projection},u.getWmsUrl=function(){return this.state.WMSUrl},u.getInfoFormat=function(){return"application/vnd.ogc.gml"},u.getLayersStore=function(){return this._layersStore},t.exports=r},{"core/g3wobject":36,"core/layers/imagelayer":45,"core/layers/layerfactory":47,"core/layers/layersstore":48,"core/utils//utils":80,"core/utils/utils":80,"g3w-ol3/src/projection/projections":109}],76:[function(e,t,i){function r(){var e=this;this.config=null,this.initialized=!1,this.projectType=null,this.setters={setCurrentProject:function(t){this.state.currentProject&&LayersStoresRegistry.removeLayersStore(this.state.currentProject.getLayersStore()),e.state.currentProject=t,e.setProjectType(t.state.type),c.addLayersStore(t.getLayersStore(),0),u.addLayersStore(t.getLayersStore(),0)}},this.state={baseLayers:{},minScale:null,maxscale:null,currentProject:null},this._pendingProjects=[],this._projects={},n(this)}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/utils/utils").reject,s=e("core/g3wobject"),l=e("core/project/project"),c=e("core/catalog/cataloglayersstoresregistry"),u=e("core/map/maplayersstoresregistry");o(r,s);var p=r.prototype;p.init=function(e){var t=this,i=$.Deferred();return this.initialized||(this.initialized=!0,this.config=e,this.overviewproject=e.overviewproject,this.setupState(),this.getProject(e.initproject).then(function(e){t.setCurrentProject(e),i.resolve(e)}).fail(function(){i.reject()})),i.promise()},p.setProjectType=function(e){this.projectType=e},p.getConfig=function(){return this.config},p.getState=function(){return this.state},p.setupState=function(){var e=this;e.state.baseLayers=e.config.baselayers,e.state.minScale=e.config.minscale,e.state.maxScale=e.config.maxscale,e.state.crs=e.config.crs,e.state.proj4=e.config.proj4;var t=e.config.overviewproject&&e.config.overviewproject.gid?e.config.overviewproject:null;e.config.projects.forEach(function(i){i.baselayers=_.cloneDeep(e.config.baselayers),i.minscale=e.config.minscale,i.maxscale=e.config.maxscale,i.crs=e.config.crs,i.proj4=e.config.proj4,i.overviewprojectgid=t,e._pendingProjects.push(i)})},p.getProjectType=function(){return this.projectType},p.getPendingProjects=function(){return this._pendingProjects},p.getProjects=function(){return this._pendingProjects},p.getListableProjects=function(){var e=this.getCurrentProject().getId();return _.filter(this.getProjects(),function(t){return _.isNil(t.listable)?t.overviewprojectgid&&t.gid!=t.overviewprojectgid.gid&&t.id!=e||t.id!=e?t:void 0:t.listable})},p.getCurrentProject=function(){return this.state.currentProject},p.getProject=function(e){var t,i=this,r=$.Deferred(),o=null;return this._pendingProjects.forEach(function(r){r.gid==e&&(t=r,o=i._projects[e])}),t?o?r.resolve(o):this._getProjectFullConfig(t).then(function(e){var o=_.merge(t,e);o.WMSUrl=i.config.getWmsUrl(o);var n=new l(o);return i._projects[o.gid]=n,r.resolve(n)}).fail(function(){return r.reject()}):a("Project doesn't exist")},p._getProjectFullConfig=function(e){var t=$.Deferred(),i=this.config.getProjectConfigUrl(e);return $.get(i).done(function(e){t.resolve(e)}).fail(function(){t.reject()}),t.promise()},t.exports=new r},{"core/catalog/cataloglayersstoresregistry":23,"core/g3wobject":36,"core/map/maplayersstoresregistry":68,"core/project/project":75,"core/utils/utils":80}],77:[function(e,t,i){function r(){n(this)}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/g3wobject");e("gui/gui");o(r,a),t.exports=new r},{"core/g3wobject":36,"core/utils/utils":80,"gui/gui":135}],78:[function(e,t,i){var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,n=(e("core/utils/utils").Base64,e("core/g3wobject"));crossroads.ignoreState=!0,crossroads.greedy=!0;var a=function(){this._initialLocationQuery,this._routeQuery="",this.setters={setRouteQuery:function(e){this._routeQuery=e,crossroads.parse(e)}},o(this)};r(a,n);var s=a.prototype;s.init=function(){var e=window.location.search;this._setRouteQueryFromLocationQuery(e)},s.addRoute=function(e,t,i){return crossroads.addRoute(e,t,i)},s.removeRoute=function(e){return crossroads.removeRoute(e)},s.removeAllRoutes=function(){return crossroads.removeAllRoutes()},s.parse=function(e,t){return crossroads.parse(e,t)},s["goto"]=function(e){this._initialQuery||(this._initialLocationQuery=this._stripInitialQuery(location.search.substring(1))),e&&this.setRouteQuery(e)},s.makePermalink=function(e){this._initialQuery||(this._initialLocationQuery=this._stripInitialQuery(location.search.substring(1)));this._encodeRouteQuery(e);return"?"+this._initialLocationQuery+"&q="+this._encodeRouteQuery(e)},s.makeQueryString=function(e){},s.slicePath=function(e){return e.split("?")[0].split("/")},s.sliceFirst=function(e){var t=e.split("?"),i=t[1],r=t[0].split("/"),o=r[0];return e=r.slice(1).join("/"),e=[e,i].join("?"),[o,e]},s.getQueryParams=function(e){e=e.replace("?","");var t={},i=[];i=""!=e&&e.indexOf("&")==-1?[e]:e.split("&");try{_.forEach(i,function(e){var i=e.split("="),r=i[0],o=i[1];t[r]=o})}catch(r){}return t},s.getQueryString=function(e){return e.split("?")[1]},s._getQueryPortion=function(e,t){var i;try{var r=e.split("&");_.forEach(r,function(e){var r=e.split("="),o=r[0];o==t&&(i=e)})}catch(o){}return i},s._encodeRouteQuery=function(e){return e=e.replace("?","@"),e=e.replace("&","|"),e=e.replace("=","!")},s._decodeRouteQuery=function(e){return e=e.replace("@","?"),e=e.replace("|","&"),e=e.replace("!","=")},s._setRouteQueryFromLocationQuery=function(e){var t=this._getRouteQueryFromLocationQuery(e);if(t){var i=this._decodeRouteQuery(t);this.setRouteQuery(i)}},s._getRouteQueryFromLocationQuery=function(e){return this.getQueryParams(e).q},s._stripInitialQuery=function(e){var t=this._getQueryPortion(e,"q");if(t){var i=t.length,r=e.indexOf(t);queryPrefix=_.trimEnd(e.substring(0,r),"&"),querySuffix=e.substring(r+i),querySuffix=""!=queryPrefix?querySuffix:_.trimStart(querySuffix,"&"),e=queryPrefix+querySuffix}return e},t.exports=new a},{"core/g3wobject":36,"core/utils/utils":80}],79:[function(e,t,i){var r=.28;t.exports={resToScale:function(e,t){var i,t=t||"m";switch(t){case"m":var i=1e3*e/r}return i},scaleToRes:function(e,t){var i,t=t||"m";switch(t){case"m":var i=e*r/1e3}return i}}},{}],80:[function(e,t,i){function r(e,t,i){return"undefined"==typeof i||0===+i?Math[e](t):(t=+t,i=+i,isNaN(t)||"number"!=typeof i||i%1!==0?NaN:(t=t.toString().split("e"),t=Math[e](+(t[0]+"e"+(t[1]?+t[1]-i:-i))),t=t.toString().split("e"),+(t[0]+"e"+(t[1]?+t[1]+i:i))))}Math.round10||(Math.round10=function(e,t){
return r("round",e,t)}),Math.floor10||(Math.floor10=function(e,t){return r("floor",e,t)}),Math.ceil10||(Math.ceil10=function(e,t){return r("ceil",e,t)}),String.prototype.hashCode=function(){var e,t,i,r=0;if(0===this.length)return r;for(e=0,i=this.length;e<i;e++)t=this.charCodeAt(e),r=(r<<5)-r+t,r|=0;return r};var o={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,i,r,n,a,s,l,c="",u=0;for(e=o._utf8_encode(e);u<e.length;)t=e.charCodeAt(u++),i=e.charCodeAt(u++),r=e.charCodeAt(u++),n=t>>2,a=(3&t)<<4|i>>4,s=(15&i)<<2|r>>6,l=63&r,isNaN(i)?s=l=64:isNaN(r)&&(l=64),c=c+this._keyStr.charAt(n)+this._keyStr.charAt(a)+this._keyStr.charAt(s)+this._keyStr.charAt(l);return c},decode:function(e){var t,i,r,n,a,s,l,c="",u=0;for(e=e.replace(/[^A-Za-z0-9+\/=]/g,"");u<e.length;)n=this._keyStr.indexOf(e.charAt(u++)),a=this._keyStr.indexOf(e.charAt(u++)),s=this._keyStr.indexOf(e.charAt(u++)),l=this._keyStr.indexOf(e.charAt(u++)),t=n<<2|a>>4,i=(15&a)<<4|s>>2,r=(3&s)<<6|l,c+=String.fromCharCode(t),64!=s&&(c+=String.fromCharCode(i)),64!=l&&(c+=String.fromCharCode(r));return c=o._utf8_decode(c)},_utf8_encode:function(e){e=e.replace(/rn/g,"n");for(var t="",i=0;i<e.length;i++){var r=e.charCodeAt(i);r<128?t+=String.fromCharCode(r):r>127&&r<2048?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t},_utf8_decode:function(e){for(var t="",i=0,r=c1=c2=0;i<e.length;)r=e.charCodeAt(i),r<128?(t+=String.fromCharCode(r),i++):r>191&&r<224?(c2=e.charCodeAt(i+1),t+=String.fromCharCode((31&r)<<6|63&c2),i+=2):(c2=e.charCodeAt(i+1),c3=e.charCodeAt(i+2),t+=String.fromCharCode((15&r)<<12|(63&c2)<<6|63&c3),i+=3);return t}},n={basemixin:function(e,t){return n.merge(e.prototype,t)},mixin:function(e,t){var i=new t;n.merge(e,i),n.merge(e.prototype,t.prototype)},merge:function(e,t){var i;for(i in t)n.hasOwn(t,i)&&(e[i]=t[i])},hasOwn:function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},inherit:function(e,t){function i(){}i.prototype=t.prototype,e.superClass_=t.prototype,e.prototype=new i,e.prototype.constructor=e},base:function(e,t,i){var r=arguments.callee.caller;if(r.superClass_)return r.superClass_.constructor.apply(e,Array.prototype.slice.call(arguments,1));for(var o=Array.prototype.slice.call(arguments,2),n=!1,a=e.constructor;a;a=a.superClass_&&a.superClass_.constructor)if(a.prototype[t]===r)n=!0;else if(n)return a.prototype[t].apply(e,o);if(e[t]===r)return e.constructor.prototype[t].apply(e,o);throw Error("base called from a method of one name to a method of a different name")},noop:function(){},truefnc:function(){return!0},falsefnc:function(){return!0},resolve:function(e){var t=$.Deferred();return t.resolve(e),t.promise()},reject:function(e){var t=$.Deferred();return t.reject(e),t.promise()},appendParams:function(e,t){var i=[];Object.keys(t).forEach(function(e){null!==t[e]&&void 0!==t[e]&&i.push(e+"="+encodeURIComponent(t[e]))});var r=i.join("&");return e=e.replace(/[?&]$/,""),e=e.indexOf("?")===-1?e+"?":e+"&",e+r},Base64:o};t.exports=n},{}],81:[function(e,t,i){function r(e){n(this),e=e||{},this._inputs=e.inputs||null,this._task=e.task||null,this._outputs=e.outputs||null,this.state={id:e.id||null,name:e.name||null,help:e.help||null,running:!1,error:null,message:null}}var o=e("core/utils/utils").inherit,n=e("core/utils//utils").base,a=e("core/g3wobject");o(r,a);var s=r.prototype;s.run=function(e,t){if(this._task)try{this._task.run(e,t),this.state.running=!0}catch(i){this.state.running=!1,this.state.error=i}},s.revert=function(){this._task&&this._task.revert&&this._task.revert()},s.panic=function(){this._task&&this._task.panic&&this._task.panic()},s.getId=function(){return this.state.id},s.getName=function(){return this.state.name},s.getHelp=function(){return this.state.help},s.getError=function(){return this.state.error},s.getMessage=function(){return this.state.message},s.setInputs=function(e){this._inputs=e},s.getInputs=function(){return this._inputs},s.setTask=function(e){this._task=e},s.getTask=function(){return this._task},s.setOutputs=function(e){this._outputs=e},s.getOutputs=function(){return this._outputs},t.exports=r},{"core/g3wobject":36,"core/utils//utils":80,"core/utils/utils":80}],82:[function(e,t,i){function r(){n(this),this._inputs=null,this._context=null,this._steps=[]}var o=e("core/utils/utils").inherit,n=e("core/utils//utils").base,a=e("core/g3wobject");o(r,a);var s=r.prototype;s.getInputs=function(){return this._inputs},s.getContext=function(){return this._context},s.addStep=function(e){this._steps.push(e)},s.setSteps=function(e){this._steps=e},s.getSteps=function(){return this._steps},s.start=function(e,t){var i=$.Deferred();this._inputs=e,this._context=t;var o=new r.Flow;o.start(workflow).then(function(e){i.resolve(e)}).fail(function(e){i.reject(e)})},r.Flow=function(){var e=$.Deferred(),t=[],i=0,r=null;this.start=function(e,o,n){i>0&&(console.log("reset workflow before restarting"),n("workflow not reset"));var a=e.getInputs();r=e.getContext(),t=this._workflow.getSteps(),t&&this.runStep(t[0],a)},this.runStep=function(e,t){e.run(t,r,_.bind(this.onDone,this),_.bind(this.onError,this))},this.onDone=function(r){return i==t.length?void e.resolve(r):(i++,void this.runStep(t[i],r))},this.onError=function(t){console.log("step error"),e.reject(t)}},t.exports=r},{"core/g3wobject":36,"core/utils//utils":80,"core/utils/utils":80}],83:[function(e,t,i){function r(){var e={name:"addlayer",tipLabel:"AddLayer",label:""};o.call(this,e),this._layerstore=null}var o=e("./control");ol.inherits(r,o);var n=r.prototype;n.setMap=function(e){var t=this;o.prototype.setMap.call(this,e),$(this.element).on("click",function(){t.dispatchEvent("addlayer")})},n.layout=function(e){o.prototype.layout.call(this,e)},n.getLayersSore=function(){return this._layerstore},n.setLayersStore=function(e){this._layerstore=e},t.exports=r},{"./control":85}],84:[function(e,t,i){var r=e("../utils"),o=e("../interactions/areainteraction"),n=e("./measurecontrol"),a=function(e){var t={name:"Area",label:"",interactionClass:o};e=r.merge(e,t),n.call(this,e)};ol.inherits(a,n),t.exports=a},{"../interactions/areainteraction":99,"../utils":110,"./measurecontrol":89}],85:[function(e,t,i){var r=function(e){var t=e.name||"?";if(this.name=t.split(" ").join("-").toLowerCase(),this.id=this.name+"_"+Math.floor(1e6*Math.random()),this.positionCode=e.position||"tl",this.priority=e.priority||0,!e.element){var i="ol-"+this.name.split(" ").join("-").toLowerCase(),o=e.tipLabel||this.name,n=e.label||"?";e.element=$('<div class="'+i+' ol-unselectable ol-control"><button type="button" title="'+o+'">'+n+"</button></div>")[0]}$(e.element).addClass("ol-control-"+this.positionCode);var a=e.buttonClickHandler||r.prototype._handleClick.bind(this);$(e.element).on("click",a),ol.control.Control.call(this,e),this._postRender()};ol.inherits(r,ol.control.Control);var o=r.prototype;o.getPosition=function(e){var e=e||this.positionCode,t={};return t.top=e.indexOf("t")>-1,t.left=e.indexOf("l")>-1,t},o._handleClick=function(e){e.preventDefault();var t=this,i=this.getMap(),r=null,o=i.getControls();o.forEach(function(e){e.id&&e.toggle&&e.id!=t.id&&(e.toggle(!1),"reset"==e.name&&(r=e))}),!t._toggled&&r&&r.toggle(!0),this.dispatchEvent("controlclick")},o.shiftPosition=function(e){$(this.element).css(hWhere,e+"px")},o.layout=function(e){if(e){var t=this.getPosition(),i=e.getViewport(),r=$(i).find(".ol-control-"+this.positionCode+":visible");if(r.length){previusControl=r.last();var o=t.left?previusControl.position().left:previusControl.position().top,n=t.left?"left":"top",a=previusControl[0].offsetWidth,s=$(this.element).position()[n]+o+a;$(this.element).css(n,s+"px")}}},o.setMap=function(e){e&&(this.layout(e),ol.control.Control.prototype.setMap.call(this,e))},o.hideControl=function(){var e=$(this.element).position().left,t=$(this.element).outerWidth(),i=e,r=$(this.element).siblings(".ol-control-tl");r.each(function(){$(this).position().left>e&&(i=$(this).position().left,t>$(this).outerWidth()&&(e+=t-$(this).outerWidth()),$(this).css("left",e+"px"),e=i,t=$(this).outerWidth())}),$(this.element).hide()},o._postRender=function(){},t.exports=r},{}],86:[function(e,t,i){function r(){var e={name:"geolocation",tipLabel:"Geolocation",label:""};o.call(this,e)}var o=e("./control");ol.inherits(r,o);var n=r.prototype;n.setMap=function(e){var t=this;o.prototype.setMap.call(this,e);var i=new ol.Geolocation({projection:e.getView().getProjection(),tracking:!0});i.once("change:position",function(e){this.getPosition()?($(t.element).removeClass("g3w-ol-disabled"),$(t.element).on("click",function(){var e=t.getMap(),r=e.getView();coordinates=i.getPosition(),r.setCenter(coordinates),t.dispatchEvent({type:"click",coordinates:coordinates})})):t.hideControl()}),i.once("error",function(e){t.hideControl(),1!=e.code&&t.dispatchEvent("error")})},n.layout=function(e){o.prototype.layout.call(this,e),$(this.element).addClass("g3w-ol-disabled")},t.exports=r},{"./control":85}],87:[function(e,t,i){var r=e("./control"),o=function(e){this._toggled=this._toggled||!1,this._interactionClass=e.interactionClass||null,this._interaction=null,this._autountoggle=e.autountoggle||!1,this._geometryTypes=e.geometryTypes||[],this._onSelectLayer=e.onselectlayer||!1,this._enabled=e.enabled!==!1,this._onhover=e.onhover||!1,this._help=e.help||null,this._modalHelp=this._help?e.modalHelp||toastr:null,e.buttonClickHandler=o.prototype._handleClick.bind(this),r.call(this,e),this._help&&this._createModalHelp()};ol.inherits(o,r);var n=o.prototype;n._clearModalHelp=function(e){var t=this;$("body").delegate("#"+e,"change",function(){t._modalHelp=null})},n._showModalHelp=function(){var e=toastr.options.positionClass,t=$("#g3w-view-content");if(this._modalHelp){toastr.options.positionClass="toast-top-right",this._modalHelp.clear();var i=this._modalHelp.info(this._help);if(t){var r=t.css("width");$(i).css("right",r)}toastr.options.positionClass=e}},n._createModalHelp=function(){var e=this,t="close_button"+Math.floor(1e6*Math.random())+Date.now();this._help+='<label for="'+t+'" style="float:right">Non mostrare più</label><input type="checkbox" id="'+t+'" class="pull-right"/>',this._onhover&&$(this.element).on("mouseenter",function(){e._enabled||e._showModalHelp()}),this._clearModalHelp(t)},n.getGeometryTypes=function(){return this._geometryTypes},n.getInteraction=function(){return this._interaction},n.isToggled=function(){return this._toggled},n.toggle=function(e){var e=void 0!==e?e:!this._toggled;this._toggled=e;var t=$(this.element).find("button").first();e?(this._showModalHelp(),this._interaction&&this._interaction.setActive(!0),t.addClass("g3w-ol-toggled")):(this._interaction&&this._interaction.setActive(!1),t.removeClass("g3w-ol-toggled"))},n.setEnable=function(e){var t=$(this.element).find("button").first();e?t.removeClass("g3w-ol-disabled"):(t.addClass("g3w-ol-disabled"),t.removeClass("g3w-ol-toggled"),this._interaction&&this._interaction.setActive(!1)),this._enabled=e},n.getEnable=function(){return this._enabled},n.getGeometryTypes=function(){return this._geometryTypes},n.setGeometryTypes=function(e){this._geometryTypes=e},n.onSelectLayer=function(){return this._onSelectLayer},n.setMap=function(e){!this._interaction&&this._interactionClass&&(this._interaction=new this._interactionClass,e.addInteraction(this._interaction),this._interaction.setActive(!1)),r.prototype.setMap.call(this,e)},n._handleClick=function(e){this._enabled&&(this.toggle(),r.prototype._handleClick.call(this,e))},n.getIteraction=function(){return this._interaction},t.exports=o},{"./control":85}],88:[function(e,t,i){var r=e("../utils"),o=e("../interactions/lengthinteraction"),n=e("./measurecontrol"),a=function(e){var t={name:"Lunghezza",label:"",interactionClass:o};e=r.merge(e,t),n.call(this,e)};ol.inherits(a,n),t.exports=a},{"../interactions/lengthinteraction":101,"../utils":110,"./measurecontrol":89}],89:[function(e,t,i){var r=e("./interactioncontrol"),o=function(e){this._map=null,this._projection=null,r.call(this,e)};ol.inherits(o,r);var n=o.prototype;n.setMap=function(e){r.prototype.setMap.call(this,e)},n.toggle=function(e){r.prototype.toggle.call(this,e),this.isToggled()||this.getIteraction().clear()},t.exports=o},{"./interactioncontrol":87}],90:[function(e,t,i){function r(){this.options={provider:"osm",placeholder:"Città, indirizzo ... ",targetType:"text-input",lang:"it-IT",limit:5,keepOpen:!0,preventDefault:!1,autoComplete:!1,autoCompleteMinLength:4,debug:!1};var e="gcd-input-query",t="gcd-input-reset",i={namespace:"ol-geocoder",spin:"gcd-pseudo-rotate",hidden:"gcd-hidden",country:"gcd-country",city:"gcd-city",road:"gcd-road",olControl:"ol-control",glass:{container:"gcd-gl-container",control:"gcd-gl-control",button:"gcd-gl-btn",input:"gcd-gl-input",expanded:"gcd-gl-expanded",reset:"gcd-gl-reset",result:"gcd-gl-result"},inputText:{container:"gcd-txt-container",control:"gcd-txt-control",input:"gcd-txt-input",reset:"gcd-txt-reset",icon:"gcd-txt-glass",result:"gcd-txt-result"}},r={GLASS:"glass-button",INPUT:"text-input"},n=Object.freeze({inputQueryId:e,inputResetId:t,cssClasses:i,"default":{inputQueryId:e,inputResetId:t,cssClasses:i}}),a={toQueryString:function(e){var t=this;return Object.keys(e).reduce(function(i,r){return i.push("object"==typeof e[r]?t.toQueryString(e[r]):encodeURIComponent(r)+"="+encodeURIComponent(e[r])),i},[]).join("&")},encodeUrlXhr:function(e,t){if(t&&"object"==typeof t){var i=this.toQueryString(t);e+=(/\?/.test(e)?"&":"?")+i}return e},json:function(e,t){return $.get(e,t)},jsonp:function(e,t,i){var r=document.head,o=document.createElement("script"),n="f"+Math.round(Math.random()*Date.now());o.setAttribute("src",e+(e.indexOf("?")>0?"&":"?")+t+"="+n),window[n]=function(e){window[n]=void 0,setTimeout(function(){r.removeChild(o)},0),i(e)},r.appendChild(o)},now:function(){if("performance"in window==!1&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==!1){var e=Date.now();performance.timing&&performance.timing.navigationStart&&(e=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-e}}return window.performance.now()},flyTo:function(e,t,i,r){r=r||2.388657133911758,i=i||500;var o=e.getView();o.animate({duration:i,resolution:r},{duration:i,center:t})},randomId:function(e){var t=this.now().toString(36);return e?e+t:t},isNumeric:function(e){return/^\d+$/.test(e)},classRegex:function(e){return new RegExp("(^|\\s+) "+e+" (\\s+|$)")},addClass:function(e,t,i){var r=this;if(Array.isArray(e))return void e.forEach(function(e){r.addClass(e,t)});for(var o=Array.isArray(t)?t:t.split(/\s+/),n=o.length;n--;)r.hasClass(e,o[n])||r._addClass(e,o[n],i)},_addClass:function(e,t,i){var r=this;e.classList?e.classList.add(t):e.className=(e.className+" "+t).trim(),i&&this.isNumeric(i)&&window.setTimeout(function(){r._removeClass(e,t)},i)},removeClass:function(e,t,i){var r=this;if(Array.isArray(e))return void e.forEach(function(e){r.removeClass(e,t,i)});for(var o=Array.isArray(t)?t:t.split(/\s+/),n=o.length;n--;)r.hasClass(e,o[n])&&r._removeClass(e,o[n],i)},_removeClass:function(e,t,i){var r=this;e.classList?e.classList.remove(t):e.className=e.className.replace(this.classRegex(t)," ").trim(),i&&this.isNumeric(i)&&window.setTimeout(function(){r._addClass(e,t)},i)},hasClass:function(e,t){return e.classList?e.classList.contains(t):this.classRegex(t).test(e.className)},toggleClass:function(e,t){var i=this;return Array.isArray(e)?void e.forEach(function(e){i.toggleClass(e,t)}):void(e.classList?e.classList.toggle(t):this.hasClass(e,t)?this._removeClass(e,t):this._addClass(e,t))},find:function(e,t,i){void 0===t&&(t=window.document);var r=/^(#?[\w-]+|\.[\w-.]+)$/,o=/\./g,n=Array.prototype.slice,a=[];if(r.test(e))switch(e[0]){case"#":a=[this.$(e.substr(1))];break;case".":a=n.call(t.getElementsByClassName(e.substr(1).replace(o," ")));break;default:a=n.call(t.getElementsByTagName(e))}else a=n.call(t.querySelectorAll(e));return i?a:a[0]},$:function(e){return e="#"===e[0]?e.substr(1,e.length):e,document.getElementById(e)},isElement:function(e){return"HTMLElement"in window?!!e&&e instanceof HTMLElement:!!e&&"object"==typeof e&&1===e.nodeType&&!!e.nodeName},getAllChildren:function(e,t){return[].slice.call(e.getElementsByTagName(t))},isEmpty:function(e){return!e||0===e.length},emptyArray:function(e){for(;e.length;)e.pop()},anyMatchInArray:function(e,t){return e.some(function(e){return t.indexOf(e)>=0})},everyMatchInArray:function(e,t){return t.every(function(t){return e.indexOf(t)>=0})},anyItemHasValue:function(e,t){var i=this;void 0===t&&(t=!1);var r=Object.keys(e);return r.forEach(function(r){i.isEmpty(e[r])||(t=!0)}),t},removeAllChildren:function(e){for(;e.firstChild;)e.removeChild(e.firstChild)},removeAll:function(e){for(var t;t=e[0];)t.parentNode.removeChild(t)},getChildren:function(e,t){return[].filter.call(e.childNodes,function(e){return t?1===e.nodeType&&e.tagName.toLowerCase()===t:1===e.nodeType})},template:function(e,t){var i=this;return e.replace(/\{ *([\w_-]+) *\}/g,function(e,r){var o=void 0===t[r]?"":t[r];return i.htmlEscape(o)})},htmlEscape:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")},mergeOptions:function(e,t){var i={};for(var r in e)i[r]=e[r];for(var o in t)i[o]=t[o];return i},createElement:function(e,t){var i;if(Array.isArray(e)){if(i=document.createElement(e[0]),e[1].id&&(i.id=e[1].id),e[1].classname&&(i.className=e[1].classname),e[1].attr){var r=e[1].attr;if(Array.isArray(r))for(var o=-1;++o<r.length;)i.setAttribute(r[o].name,r[o].value);else i.setAttribute(r.name,r.value)}}else i=document.createElement(e);i.innerHTML=t;for(var n=document.createDocumentFragment();i.childNodes[0];)n.appendChild(i.childNodes[0]);return i.appendChild(n),i},assert:function(e,t){if(void 0===t&&(t="Assertion failed"),!e){if("undefined"!=typeof Error)throw new Error(t);throw t}}},s=n.cssClasses,l=n.cssClasses,c=function(e){this.options=e.options,this.els=this.createControl()};c.prototype.createControl=function(){var e,t,i;return this.options.targetType===r.INPUT?(t=s.namespace+" "+s.inputText.container,e=a.createElement(["div",{classname:t}],c.input),i={container:e,control:a.find("."+s.inputText.control,e),input:a.find("."+s.inputText.input,e),reset:a.find("."+s.inputText.reset,e),result:a.find("."+s.inputText.result,e)}):(t=s.namespace+" "+s.glass.container,e=a.createElement(["div",{classname:t}],c.glass),i={container:e,control:a.find("."+s.glass.control,e),button:a.find("."+s.glass.button,e),input:a.find("."+s.glass.input,e),reset:a.find("."+s.glass.reset,e),result:a.find("."+s.glass.result,e)}),i.input.placeholder=this.options.placeholder,i},c.glass=['<div class="',s.glass.control," ",s.olControl,'">','<button type="button" class="',s.glass.button,'"></button>','<input type="text"',' id="',n.inputQueryId,'"',' class="',s.glass.input,'"',' autocomplete="off" placeholder="Search ...">',"<a",' id="',n.inputResetId,'"',' class="',s.glass.reset," ",s.hidden,'"',"></a>","</div>",'<ul class="',s.glass.result,'"></ul>'].join(""),c.input=['<div class="',s.inputText.control,'">','<input type="text"',' id="',n.inputQueryId,'"',' class="',s.inputText.input,'"',' autocomplete="off" placeholder="Search ...">','<button type="button" class="btn btn-primary" id="search_nominatim"><i class="fa fa-search" aria-hidden="true"></i></button>','<button type="button"',' id="',n.inputResetId,'"',' class="',s.inputText.reset," ",s.hidden,'"',"></button>","</div>",'<ul class="',s.inputText.result,'"></ul>'].join("");var u=function(){this.settings={url:"//nominatim.openstreetmap.org/search/",params:{q:"",format:"json",addressdetails:1,limit:10,countrycodes:"IT","accept-language":"it-IT"}}};u.prototype.getParameters=function(e){return{url:this.settings.url,params:{q:e.query,format:"json",addressdetails:1,limit:e.limit||this.settings.params.limit,countrycodes:e.countrycodes||this.settings.params.countrycodes,"accept-language":e.lang||this.settings.params["accept-language"]}}},u.prototype.handleResponse=function(e){return e.map(function(e){return{lon:e.lon,lat:e.lat,address:{name:e.address.neighbourhood||"",road:e.address.road||"",postcode:e.address.postcode,city:e.address.city||e.address.town,state:e.address.state,country:e.address.country},original:{formatted:e.display_name,details:e.address}}})};var p=function(e,t){this.Base=e,this.options=e.options,this.options.provider=this.options.provider.toLowerCase(),this.els=t,this.lastQuery="",this.container=this.els.container,this.registeredListeners={mapClick:!1},this.setListeners(),this.OpenStreet=new u};p.prototype.setListeners=function(){var e,t,i=this,o=function(){a.hasClass(i.els.control,l.glass.expanded)?i.collapse():i.expand()},n=function(e){var t=e.target.value.trim(),r=e.key?"Enter"===e.key:e.which?13===e.which:!!e.keyCode&&13===e.keyCode;r&&(e.preventDefault(),i.query(t))},s=function(e){i.els.input.focus(),i.els.input.value="",i.lastQuery="",a.addClass(i.els.reset,l.hidden),i.clearResults()},c=function(r){var o=r.target.value.trim();o.length?a.removeClass(i.els.reset,l.hidden):a.addClass(i.els.reset,l.hidden),i.options.autoComplete&&o!==t&&(t=o,e&&clearTimeout(e),e=setTimeout(function(){o.length>=i.options.autoCompleteMinLength&&i.query(o)},200))};this.els.input.addEventListener("keyup",n,!1),this.els.input.addEventListener("input",c,!1),this.els.reset.addEventListener("click",s,!1),this.options.targetType===r.GLASS&&this.els.button.addEventListener("click",o,!1)},p.prototype.query=function(e){var t=this,i={},r=this.options,o=this.getProvider({query:e,provider:r.provider,key:r.key,lang:r.lang,countrycodes:r.countrycodes,limit:r.limit});this.lastQuery===e&&this.els.result.firstChild||(this.lastQuery=e,this.clearResults(),a.addClass(this.els.reset,l.spin),i.url=document.location.protocol+o.url,i.data=o.params,a.json(i).done(function(e){a.removeClass(t.els.reset,l.spin);var i=e.length?t.OpenStreet.handleResponse(e):void 0;t.createList(i),i&&t.listenMapClick()}).fail(function(e){a.removeClass(t.els.reset,l.spin);var i=a.createElement("li","<h5>  Il server non risponde</h5>");t.els.result.appendChild(i)}))},p.prototype.createList=function(e){var t=this,i=this.els.result;e?e.forEach(function(e){var r=t.addressTemplate(e.address),o=['<a href="#">',r,"</a>"].join(""),n=a.createElement("li",o);n.addEventListener("click",function(i){i.preventDefault(),t.chosen(e,r,e.address,e.original)},!1),i.appendChild(n)}):(li=a.createElement("li","Nessun Risultato"),i.appendChild(li))},p.prototype.chosen=function(e,t,i,r){var o=this.Base.getMap(),n=[parseFloat(e.lon),parseFloat(e.lat)],a=o.getView().getProjection(),s=ol.proj.transform(n,"EPSG:4326",a),l={formatted:t,details:i,original:r};this.options.keepOpen===!1&&this.clearResults(!0),this.Base.dispatchEvent({type:"addresschosen",address:l,coordinate:s})},p.prototype.addressTemplate=function(e){var t=[];return e.name&&t.push(['<div class="',l.road,'">{name}</div>'].join("")),(e.road||e.building||e.house_number)&&t.push(['<div class="',l.road,'">{building} {road} {house_number}</div>'].join("")),(e.city||e.town||e.village)&&t.push(['<div class="',l.city,'">{postcode} {city} {town} {village}</div>'].join("")),(e.state||e.country)&&t.push(['<div class="',l.country,'">{state} {country}</div>'].join("")),a.template(t.join("<br>"),e)},p.prototype.getProvider=function(e){return this.OpenStreet.getParameters(e)},p.prototype.expand=function(){var e=this;a.removeClass(this.els.input,l.spin),a.addClass(this.els.control,l.glass.expanded),window.setTimeout(function(){return e.els.input.focus()},100),this.listenMapClick()},p.prototype.collapse=function(){this.els.input.value="",this.els.input.blur(),a.addClass(this.els.reset,l.hidden),a.removeClass(this.els.control,l.glass.expanded),this.clearResults()},p.prototype.listenMapClick=function(){if(!this.registeredListeners.mapClick){var e=this,t=this.Base.getMap().getTargetElement();this.registeredListeners.mapClick=!0,t.addEventListener("click",{handleEvent:function(i){e.clearResults(!0),t.removeEventListener(i.type,this,!1),e.registeredListeners.mapClick=!1}},!1)}},p.prototype.clearResults=function(e){e&&this.options.targetType===r.GLASS?this.collapse():a.removeAllChildren(this.els.result)},p.prototype.getSource=function(){return this.layer.getSource()},p.prototype.addLayer=function(){var e=this,t=!1,i=this.Base.getMap();i.getLayers().forEach(function(i){i===e.layer&&(t=!0)}),t||i.addLayer(this.layer)};var d=new c(this);this.container=d.els.container,this.nominatim=new p(this,d.els),this.layer=this.nominatim.layer,o.call(this,{element:this.container,name:"nominatim"})}var o=e("./control");ol.inherits(r,o),proto=r.prototype,t.exports=r},{"./control":85}],91:[function(e,t,i){var r=function(e){switch(this._control=null,this.positionCode=e.position||"tl",e.type){case"zoom":this._control=new ol.control.Zoom(e);break;case"zoomtoextent":this._control=new ol.control.ZoomToExtent(e);break;case"scaleline":this._control=new ol.control.ScaleLine(e);break;case"overview":this._control=new ol.control.OverviewMap(e)}$(this._control.element).addClass("ol-control-"+this.positionCode),ol.control.Control.call(this,{element:this._control.element})};ol.inherits(r,ol.control.Control),t.exports=r;var o=r.prototype;o.getPosition=function(e){var e=e||this.positionCode,t={};return t.top=e.indexOf("t")>-1,t.left=e.indexOf("l")>-1,t},o.layout=function(e){if(e){var t=this.getPosition(),i=e.getViewport(),r=$(i).find(".ol-control-"+this.positionCode);if(r.length){previusControl=r.last();var o=t.left?previusControl.position().left:previusControl.position().right,n=t.left?"left":"right",a=previusControl[0].offsetWidth,s=$(this.element).position()[n]+o+a+2;$(this.element).css(n,s+"px")}}},o.setMap=function(e){this.layout(e),this._control.setMap(e)}},{}],92:[function(e,t,i){var r=e("../utils"),o=e("./interactioncontrol"),n=function(e){this._startCoordinate=null;var t={name:"querybbox",tipLabel:"Query BBox layer",label:"",interactionClass:ol.interaction.DragBox,help:"<h4>Guida - Query BBox layer</h4><ul><li>Disegna un rettangolo per interrogare gli strati evidenziati in giallo</li></ul>"};e=r.merge(e,t),o.call(this,e)};ol.inherits(n,o);var a=n.prototype;a.setMap=function(e){var t=this;o.prototype.setMap.call(this,e),this._interaction.on("boxstart",function(e){t._startCoordinate=e.coordinate}),this._interaction.on("boxend",function(e){var i=t._startCoordinate,r=e.coordinate,o=ol.extent.boundingExtent([i,r]);t.dispatchEvent({type:"bboxend",extent:o}),t._startCoordinate=null,t._autountoggle&&t.toggle()})},t.exports=n},{"../utils":110,"./interactioncontrol":87}],93:[function(e,t,i){var r=e("../utils"),o=e("./interactioncontrol"),n=e("../interactions/pickcoordinatesinteraction"),a=function(e){var t={name:"querybypolygon",tipLabel:"Query By Polygon",label:"",geometryTypes:["Polygon","MultiPolygon"],onselectlayer:!0,interactionClass:n,help:"<h4>Guida - Query By Polygon</h4><ul><li>Seleziona uno strato poligonale</li><li>Clicca su una feature dello strato selezionato per lanciare la selezione</li></ul>",onhover:!0};e=r.merge(e,t),o.call(this,e)};ol.inherits(a,o);var s=a.prototype;s.setMap=function(e){var t=this;o.prototype.setMap.call(this,e),this._interaction.on("boxstart",function(e){t._startCoordinate=e.coordinate}),this._interaction.on("picked",function(e){t.dispatchEvent({type:"picked",coordinates:e.coordinate}),t._autountoggle&&t.toggle()}),this.setEnable(!1)},t.exports=a},{"../interactions/pickcoordinatesinteraction":103,"../utils":110,"./interactioncontrol":87}],94:[function(e,t,i){var r=e("../utils"),o=e("./interactioncontrol"),n=e("../interactions/pickcoordinatesinteraction"),a=function(e){var t={name:"querylayer",tipLabel:"Query layer",label:"",interactionClass:n};e=r.merge(e,t),o.call(this,e)};ol.inherits(a,o);var s=a.prototype;s.setMap=function(e){var t=this;o.prototype.setMap.call(this,e),this._interaction.on("boxstart",function(e){t._startCoordinate=e.coordinate}),this._interaction.on("picked",function(e){t.dispatchEvent({type:"picked",coordinates:e.coordinate}),t._autountoggle&&t.toggle()})},t.exports=a},{"../interactions/pickcoordinatesinteraction":103,"../utils":110,"./interactioncontrol":87}],95:[function(e,t,i){var r=e("../utils"),o=e("./interactioncontrol"),n=function(e){this._toggled=!0,this._startCoordinate=null;var t={name:"reset",tipLabel:"Pan",label:""};e=r.merge(e,t),o.call(this,e)};ol.inherits(n,o),t.exports=n;var a=n.prototype;a._postRender=function(){this.toggle(!0)}},{"../utils":110,"./interactioncontrol":87}],96:[function(e,t,i){var r=e("../utils"),o=e("./interactioncontrol"),n=e("../interactions/pickcoordinatesinteraction"),a=function(e){var t={name:"streetview",tipLabel:"StreetView",label:"",interactionClass:n};this._sv=null,this._panorama=null,this._map=null,this._projection=null,this._streetViewFeature=new ol.Feature,this._streetViewFeature.setStyle(style=new ol.style.Style({text:new ol.style.Text({text:"",font:"bold 30px icomoon",textBaseline:"Bottom",fill:new ol.style.Fill({color:"#3c8dbc"})})}));var i=new ol.source.Vector({features:[]});this._layer=new ol.layer.Vector({source:i}),e=r.merge(e,t),o.call(this,e)};ol.inherits(a,o);var s=a.prototype;s.getLayer=function(){return this._layer},s.setProjection=function(e){this._projection=e},s.setPosition=function(e){var t,i,r=this;this._sv||(this._sv=new google.maps.StreetViewService),this._sv.getPanorama({location:e},function(e){r._panorama=new google.maps.StreetViewPanorama(document.getElementById("streetview")),r._panorama.addListener("position_changed",function(){r.isToggled()&&(t=ol.proj.transform([this.getPosition().lng(),this.getPosition().lat()],"EPSG:4326",r._projection.getCode()),r._layer.getSource().getFeatures()[0].setGeometry(new ol.geom.Point(t)),i=r._map.getPixelFromCoordinate(t),(i[0]+15>r._map.getSize()[0]||i[1]+15>r._map.getSize()[1]||i[0]<15||i[1]<15)&&r._map.getView().setCenter(t))}),e&&e.location&&(r._panorama.setPov({pitch:0,heading:0}),r._panorama.setPosition(e.location.latLng))})},s.setMap=function(e){var t=this;this._map=e,o.prototype.setMap.call(this,e),this._interaction.on("picked",function(e){t.dispatchEvent({type:"picked",coordinates:e.coordinate}),t._autountoggle&&t.toggle()})},s.clear=function(){this._layer.getSource().clear(),this._streetViewFeature.setGeometry(null)},s.toggle=function(e){o.prototype.toggle.call(this,e),this.isToggled()?this._layer.getSource().addFeatures([this._streetViewFeature]):this.clear()},t.exports=a},{"../interactions/pickcoordinatesinteraction":103,"../utils":110,"./interactioncontrol":87}],97:[function(e,t,i){var r=e("../utils"),o=e("./interactioncontrol"),n=function(e){this._startCoordinate=null;var t={name:"zoombox",tipLabel:"Zoom to box",label:"",interactionClass:ol.interaction.DragBox};e=r.merge(e,t),o.call(this,e)};ol.inherits(n,o),t.exports=n;var a=n.prototype;a.setMap=function(e){var t=this;o.prototype.setMap.call(this,e),this._interaction.on("boxstart",function(e){t._startCoordinate=e.coordinate}),this._interaction.on("boxend",function(e){var i=t._startCoordinate,r=e.coordinate,o=ol.extent.boundingExtent([i,r]);t.dispatchEvent({type:"zoomend",extent:o}),t._startCoordinate=null,t._autountoggle&&t.toggle()})}},{"../utils":110,"./interactioncontrol":87}],98:[function(e,t,i){var r=e("./utils"),o=e("./map/maphelpers");!function(e,r,o){"function"==typeof define&&define.amd?define(o):"object"==typeof i?t.exports=o():r[e]=o()}("g3wol3",this,function(){"use strict";var e=r.merge({},o);return{helpers:e}})},{"./map/maphelpers":107,"./utils":110}],99:[function(e,t,i){var r=e("./measureinteraction"),o=function(){var e={};e.geometryType="Polygon",r.call(this,e)};ol.inherits(o,r),t.exports=o},{"./measureinteraction":102}],100:[function(e,t,i){var r=function(e,t,i){this.type=e,this.features=t,this.coordinate=i},o=function(e){ol.interaction.Pointer.call(this,{handleDownEvent:o.handleDownEvent_,
handleMoveEvent:o.handleMoveEvent_,handleUpEvent:o.handleUpEvent_,handleEvent:o.handleEvent_}),this.previousCursor_=void 0,this.lastCoordinate_=null,this.features_=void 0!==e.features?e.features:null};ol.inherits(o,ol.interaction.Pointer),o.handleEvent_=function(e){return"keydown"!=e.type?ol.interaction.Pointer.handleEvent.call(this,e):this.features_.getArray().length&&46==e.originalEvent.keyCode?(this.dispatchEvent(new r("deleteend",this.features_,event.coordinate)),!0):void 0},o.handleDownEvent_=function(e){return this.lastFeature_=this.featuresAtPixel_(e.pixel,e.map),!!this.lastFeature_&&(o.handleMoveEvent_.call(this,e),this.dispatchEvent(new r("deleteend",this.features_,e.coordinate)),!0)},o.handleMoveEvent_=function(e){var t=e.map.getTargetElement(),i=e.map.forEachFeatureAtPixel(e.pixel,function(e){return e});i?(this.previousCursor_=t.style.cursor,t.style.cursor="pointer"):(t.style.cursor=void 0!==this.previousCursor_?this.previousCursor_:"",this.previousCursor_=void 0)},o.prototype.featuresAtPixel_=function(e,t){var i=null,r=t.forEachFeatureAtPixel(e,function(e){return e});return this.features_&&_.includes(this.features_.getArray(),r)&&(i=r),i},t.exports=o},{}],101:[function(e,t,i){var r=e("./measureinteraction"),o=function(){var e={};e.geometryType="LineString",r.call(this,e)};ol.inherits(o,r),t.exports=o},{"./measureinteraction":102}],102:[function(e,t,i){var r=function(e){this._helpTooltip,this._measureTooltipElement,this._measureTooltip,this._featureGeometryChangelistener,this._poinOnMapMoveListener;var t=new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:3}),image:new ol.style.Circle({radius:5,stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.7)"}),fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"})})}),i=e.geometryType||"LineString";switch(this._formatMeasure=null,this._helpMsg=null,this._keyDownEventHandler=null,i){case"LineString":this._formatMeasure=function(e){var t;t=Math.round(100*e.getLength())/100;var i;return i=t>1e3?Math.round(t/1e3*1e3)/1e3+" km":Math.round(100*t)/100+" m"},this._helpMsg="Clicca sulla mappa per continuare a disegnare la linea.<br>CANC se si vuole cancellare l'ultimo vertice inserito";break;case"Polygon":this._formatMeasure=function(e){var t;t=Math.round(100*e.getArea())/100;var i;return i=t>1e3?Math.round(t/1e3*1e3)/1e3+" km<sup>2</sup>":Math.round(100*t)/100+" m<sup>2</sup>"},this._helpMsg="Click per continuare a disegnare il poligono.<br>CANC se si vuole cancellare l'ultimo vertice inserito"}var r=new ol.source.Vector;this._helpTooltipElement,this._map=null,this._feature=null,this._layer=new ol.layer.Vector({source:r,style:function(e){var t=[new ol.style.Style({stroke:new ol.style.Stroke({lineDash:[10,10],width:3}),fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"})})];return t}}),ol.interaction.Draw.call(this,{source:r,type:i,style:t}),this.set("beforeRemove",this.clear),this.set("layer",this._layer),this.on("drawstart",this._drawStart),this.on("drawend",this._drawEnd)};ol.inherits(r,ol.interaction.Draw);var o=r.prototype;o.clear=function(){this._layer.getSource().clear(),this._clearMessagesAndListeners(),this._map&&(this._map.removeOverlay(this._measureTooltip),this._map.removeLayer(this._layer))},o._clearMessagesAndListeners=function(){this._feature=null,this._map&&(this._measureTooltipElement=null,this._helpTooltipElement.innerHTML="",this._helpTooltipElement.classList.add("hidden"),ol.Observable.unByKey(this._featureGeometryChangelistener),ol.Observable.unByKey(this._poinOnMapMoveListener),$(document).off("keydown",this._keyDownEventHandler))},o._removeLastPoint=function(e){var t=this._feature.getGeometry();46===e.keyCode&&(t instanceof ol.geom.Polygon&&t.getCoordinates()[0].length>2?this.removeLastPoint():t instanceof ol.geom.LineString&&t.getCoordinates().length>1&&this.removeLastPoint())},o._drawStart=function(e){var t=this;this._map=this.getMap(),this._createMeasureTooltip(),this._createHelpTooltip(),this._feature=e.feature,this._keyDownEventHandler=_.bind(this._removeLastPoint,this),$(document).on("keydown",this._keyDownEventHandler),this._layer.getSource().clear(),this._poinOnMapMoveListener=this._map.on("pointermove",function(e){e.dragging||(t._feature&&(helpMsg=t._helpMsg),t._helpTooltipElement.innerHTML=helpMsg,t._helpTooltip.setPosition(e.coordinate),t._helpTooltipElement.classList.remove("hidden"))});var i=e.coordinate;this._featureGeometryChangelistener=this._feature.getGeometry().on("change",function(e){var r,o=e.target;o instanceof ol.geom.Polygon?i=o.getInteriorPoint().getCoordinates():o instanceof ol.geom.LineString&&(i=o.getLastCoordinate()),r=t._formatMeasure(o),t._measureTooltipElement.innerHTML=r,t._measureTooltip.setPosition(i)})},o._drawEnd=function(){this._measureTooltipElement.className="mtooltip mtooltip-static",this._measureTooltip.setOffset([0,-7]),this._clearMessagesAndListeners(),this._map.addLayer(this._layer)},o._createHelpTooltip=function(){this._helpTooltipElement&&this._helpTooltipElement.parentNode.removeChild(this._helpTooltipElement),this._helpTooltip&&this._map.removeOverlay(this._helpTooltip),this._helpTooltipElement=document.createElement("div"),this._helpTooltipElement.className="mtooltip hidden",this._helpTooltip=new ol.Overlay({element:this._helpTooltipElement,offset:[15,0],positioning:"center-left"}),this._map.addOverlay(this._helpTooltip)},o._createMeasureTooltip=function(){this._measureTooltipElement&&this._measureTooltipElement.parentNode.removeChild(this._measureTooltipElement),this._measureTooltip&&this._map.removeOverlay(this._measureTooltip),this._measureTooltipElement=document.createElement("div"),this._measureTooltipElement.className="mtooltip mtooltip-measure",this._measureTooltip=new ol.Overlay({element:this._measureTooltipElement,offset:[0,-15],positioning:"bottom-center"}),this._map.addOverlay(this._measureTooltip)},t.exports=r},{}],103:[function(e,t,i){var r={PICKED:"picked"},o=function(e,t){this.type=e,this.coordinate=t},n=function(e){this.previousCursor_=null,ol.interaction.Pointer.call(this,{handleDownEvent:n.handleDownEvent_,handleUpEvent:n.handleUpEvent_,handleMoveEvent:n.handleMoveEvent_})};ol.inherits(n,ol.interaction.Pointer),n.handleDownEvent_=function(e){return!0},n.handleUpEvent_=function(e){return this.dispatchEvent(new o(r.PICKED,e.coordinate)),!0},n.handleMoveEvent_=function(e){var t=e.map.getTargetElement();t.style.cursor="pointer"},n.prototype.shouldStopEvent=function(){return!1},n.prototype.setActive=function(e){var t=this.getMap();if(t){var i=t.getTargetElement();i.style.cursor=""}ol.interaction.Pointer.prototype.setActive.call(this,e)},n.prototype.setMap=function(e){if(!e){var t=this.getMap().getTargetElement();t.style.cursor=""}ol.interaction.Pointer.prototype.setMap.call(this,e)},t.exports=n},{}],104:[function(e,t,i){var r={PICKED:"picked"},o=function(e,t,i){this.type=e,this.feature=i,this.coordinate=t},n=function(e){var t=this;ol.interaction.Pointer.call(this,{handleDownEvent:n.handleDownEvent_,handleUpEvent:n.handleUpEvent_,handleMoveEvent:n.handleMoveEvent_}),this.features_=e.features||null,this.layers_=e.layers||null,this.pickedFeature_=null,this.layerFilter_=function(e){return _.includes(t.layers_,e)}};ol.inherits(n,ol.interaction.Pointer),n.handleDownEvent_=function(e){return this.pickedFeature_=this.featuresAtPixel_(e.pixel,e.map),!0},n.handleUpEvent_=function(e){return this.pickedFeature_&&this.dispatchEvent(new o(r.PICKED,e.coordinate,this.pickedFeature_)),!0},n.handleMoveEvent_=function(e){var t=e.map.getTargetElement(),i=this.featuresAtPixel_(e.pixel,e.map);i?t.style.cursor="pointer":t.style.cursor=""},n.prototype.featuresAtPixel_=function(e,t){var i=null,r=this,o=t.forEachFeatureAtPixel(e,function(e){return r.features_?r.features_.indexOf(e)>-1?e:null:e},{layerFilter:r.layerFilter_,hitTolerance:isMobile&&isMobile.any?10:0});return o&&(i=o),i},n.prototype.shouldStopEvent=function(){return!1},n.prototype.setMap=function(e){if(!e){var t=this.getMap().getTargetElement();t.style.cursor=""}ol.interaction.Pointer.prototype.setMap.call(this,e)},t.exports=n},{}],105:[function(e,t,i){var r={};r.OSM=new ol.layer.Tile({source:new ol.source.OSM({attributions:[new ol.Attribution({html:'All maps &copy; <a href="http://www.openstreetmap.org/">OpenStreetMap</a>'}),ol.source.OSM.ATTRIBUTION],url:"http://{a-c}.tile.openstreetmap.org/{z}/{x}/{y}.png",crossOrigin:null}),id:"osm",title:"OSM",basemap:!0}),r.BING={},r.BING.Road=new ol.layer.Tile({name:"Road",visible:!1,preload:1/0,source:new ol.source.BingMaps({key:"Am_mASnUA-jtW3O3MxIYmOOPLOvL39dwMvRnyoHxfKf_EPNYgfWM9imqGETWKGVn",imagerySet:"Road"}),basemap:!0}),r.BING.AerialWithLabels=new ol.layer.Tile({name:"AerialWithLabels",visible:!0,preload:1/0,source:new ol.source.BingMaps({key:"Am_mASnUA-jtW3O3MxIYmOOPLOvL39dwMvRnyoHxfKf_EPNYgfWM9imqGETWKGVn",imagerySet:"AerialWithLabels"}),basemap:!0}),r.BING.Aerial=new ol.layer.Tile({name:"Aerial",visible:!1,preload:1/0,source:new ol.source.BingMaps({key:"Am_mASnUA-jtW3O3MxIYmOOPLOvL39dwMvRnyoHxfKf_EPNYgfWM9imqGETWKGVn",imagerySet:"Aerial"}),basemap:!0}),t.exports=r},{}],106:[function(e,t,i){var r=e("../utils"),o={};o.TiledWMSLayer=function(e,t){var i={layerObj:e,extraParams:t||{},tiled:!0};return o._WMSLayer(i)},o.WMSLayer=function(e,t){var i={layerObj:e,extraParams:t||{}};return o._WMSLayer(i)},o._WMSLayer=function(e){var t=e.layerObj,i=e.extraParams,o=e.tiled||!1,n={LAYERS:t.layers||"",VERSION:"1.3.0",TRANSPARENT:!0,SLD_VERSION:"1.1.0"};n=r.merge(n,i);var a,s,l={url:t.url,params:n,ratio:1},c={id:t.id,name:t.name,opacity:t.opacity||1,visible:t.visible,maxResolution:t.maxResolution};return o?(s=new ol.source.TileWMS(l),a=ol.layer.Tile):(s=new ol.source.ImageWMS(l),a=ol.layer.Image),c.source=s,new a(c)},o.XYZLayer=function(e){if(e.url){var t={url:e.url};return e.projection&&(t.projection=e.projection),e.maxZoom&&(t.maxZoom=e.maxZoom),e.minZoom&&(t.minZoom=e.minZoom),new ol.layer.Tile({source:new ol.source.XYZ(t)})}},t.exports=o},{"../utils":110}],107:[function(e,t,i){BaseLayers=e("../layers/bases");var r={createViewer:function(e){return new o(e)}},o=function(e){var t=ol.control.defaults({attributionOptions:{collapsible:!1},zoom:!1,attribution:!1}),i=ol.interaction.defaults().extend([new ol.interaction.DragRotate]);i.removeAt(1);var r;r=e.view instanceof ol.View?e.view:new ol.View(e.view);var o={controls:t,interactions:i,ol3Logo:!1,view:r,keyboardEventTarget:document};e.id&&(o.target=e.id);var n=new ol.Map(o);this.map=n};o.prototype.destroy=function(){this.map&&(this.map.dispose(),this.map=null)},o.prototype.getView=function(){return this.map.getView()},o.prototype.updateMap=function(e){},o.prototype.updateView=function(){},o.prototype.getMap=function(){return this.map},o.prototype.setTarget=function(e){this.map.setTarget(e)},o.prototype.goTo=function(e,t){var t=t||{},i=t.animate||!0,r=t.zoom||!1,o=this.map.getView();if(i){var n={duration:500,center:e};if(r)var a={duration:500,zoom:r};else var a={duration:500,resolution:o.getResolution()};o.animate(n,a)}else o.setCenter(e),r&&o.setZoom(r)},o.prototype.goToRes=function(e,t){var t=t||{},i=t.animate||!0,r=this.map.getView(),o=t.resolution||r.getResolution();if(i){var n={duration:300,center:e},a={duration:300,resolution:o};r.animate(n,a)}else r.setCenter(e),r.setResolution(o)},o.prototype.fit=function(e,t){var i=this.map.getView(),t=t||{},r=t.animate||!0;if(r){i.animate({duration:300,center:i.getCenter()}),i.animate({duration:300,resolution:i.getResolution()})}t.animate&&delete t.animate,t.constrainResolution=t.constrainResolution||!0,i.fit(e,this.map.getSize(),t)},o.prototype.getZoom=function(){var e=this.map.getView();return e.getZoom()},o.prototype.getResolution=function(){var e=this.map.getView();return e.getResolution()},o.prototype.getCenter=function(){var e=this.map.getView();return e.getCenter()},o.prototype.getBBOX=function(){return this.map.getView().calculateExtent(this.map.getSize())},o.prototype.getLayerByName=function(e){for(var t=this.map.getLayers(),i=t.getLength(),r=0;r<i;r++)if(e===t.item(r).get("name"))return t.item(r);return null},o.prototype.removeLayerByName=function(e){var t=this.getLayerByName(e);t&&(this.map.removeLayer(t),delete t)},o.prototype.getActiveLayers=function(){var e=[];return this.map.getLayers().forEach(function(t){var i=t.getProperties();1!=i.basemap&&i.visible&&e.push(t)}),e},o.prototype.removeLayers=function(){this.map.getLayers().clear()},o.prototype.getLayersNoBase=function(){var e=[];return this.map.getLayers().forEach(function(t){var i=t.getProperties();1!=i.basemap&&e.push(t)}),e},o.prototype.addBaseLayer=function(e){var t;t=e?BaseLayers[e]:BaseLayers.BING.Aerial,this.map.addLayer(t)},o.prototype.changeBaseLayer=function(e){var t=this.getLayerByName(layername),i=this.map.getLayers();i.insertAt(0,t)},t.exports=r},{"../layers/bases":105}],108:[function(e,t,i){var r=[0,0,8388608,8388608],o=function(e){if(!e.crs)return null;if(e.proj4def&&proj4.defs(e.crs,e.proj4def),ol.proj.Projection.call(this,{code:e.crs,extent:e.extent?e.extent:r}),this._axisOrientation=e.axisOrientation?e.axisOrientation:"enu",e.proj4def){var t=proj4.defs(e.crs);void 0!=t.axis&&(this._axisOrientation=t.axis)}};ol.inherits(o,ol.proj.Projection);var n=o.prototype;n.getAxisOrientation=function(){return this._axisOrientation},t.exports=o},{}],109:[function(e,t,i){var r=e("./projection"),o={get:function(e,t,i){e=o.normalizeCrs(e);var n=ol.proj.projections?ol.proj.projections:ol.proj,a=n.get(e);if(a)return a;var s=new r({crs:e,proj4def:t,extent:i});return n.add?n.add(e,s):n.addProjection(s),s},normalizeCrs:function(e){return"number"==typeof e?"EPSG:"+e:(e=e.replace(/[^\d\.\-]/g,""),""!=e?"EPSG:"+parseInt(e):void 0)}};t.exports=o},{"./projection":108}],110:[function(e,t,i){var r={merge:function(e,t){var i={};for(var r in e)i[r]=e[r];for(var r in t)i[r]=t[r];return i}};t.exports=r},{}],111:[function(e,t,i){var r={getExtentForViewAndSize:function(e,t,i,r){var o=t*r[0]/2,n=t*r[1]/2,a=Math.cos(i),s=Math.sin(i),l=o*a,c=o*s,u=n*a,p=n*s,d=e[0],h=e[1],m=d-l+p,f=d-l-p,g=d+l-p,y=d+l+p,_=h-c-u,v=h-c+u,b=h+c+u,C=h+c-u;return[Math.min(m,f,g,y),Math.min(_,v,b,C),Math.max(m,f,g,y),Math.max(_,v,b,C)]}};t.exports=r},{}],112:[function(e,t,i){function r(){var e=this;this.state={prstate:s.state,highlightlayers:!1,externallayers:[],layerstrees:[]},this.setters={},this.addExternalLayer=function(e){this.state.externallayers.push(e)},this.removeExternalLayer=function(e){var t=this;_.forEach(this.state.externallayers,function(i,r){if(i.name==e)return t.state.externallayers.splice(r,1),!1})},this.addLayersStoreToLayersTrees=function(e){this.state.layerstrees.push({tree:e.getLayersTree(),storeid:e.getId()})},n(this);var t=l.getLayersStores();_.forEach(t,function(t){e.addLayersStoreToLayersTrees(t)}),l.onafter("addLayersStore",function(t){e.addLayersStoreToLayersTrees(t)}),l.onafter("removeLayersStore",function(t){_.forEach(e.state.layerstrees,function(i,r){if(i.storeid==t.getId())return e.state.layerstrees.splice(r,1),!1})})}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/g3wobject"),s=e("core/project/projectsregistry"),l=e("core/catalog/cataloglayersstoresregistry");o(r,a),t.exports=r},{"core/catalog/cataloglayersstoresregistry":23,"core/g3wobject":36,"core/project/projectsregistry":76,"core/utils/utils":80}],113:[function(e,t,i){t.exports='<!-- item template -->\n<div id="catalog" @contextmenu.prevent.stop="" class="tabbable-panel catalog">\n  <!--<div class="title">{{ title }}</div>-->\n  <div class="tabbable-line">\n    <ul class="nav nav-tabs" role="tablist">\n      <li role="presentation" class="active" :style="{width: hasBaseLayers ? \'32%\' : \'48%\'}"><a href="#tree" aria-controls="tree" role="tab" data-toggle="tab" data-i18n="tree">Data</a></li>\n      <li v-if="hasBaseLayers" role="presentation" style="width: 32%"><a href="#baselayers" aria-controls="baselayers" role="tab" data-toggle="tab" data-i18n="baselayers">Layer Base</a></li>\n      <li role="presentation" :style="{width: hasBaseLayers ? \'32%\' : \'48%\'}"><a href="#legend" aria-controls="legend" role="tab" data-toggle="tab" data-i18n="legend">Legenda</a></li>\n    </ul>\n    <div  class="tab-content">\n      <div role="tabpanel" class="tab-pane active tree" id="tree">\n        <ul class="tree-root" v-for="_layerstree in state.layerstrees">\n          <tristate-tree  :highlightlayers="state.highlightlayers" :layerstree="layerstree" class="item" v-for="layerstree in _layerstree.tree" :storeid="_layerstree.storeid" :key="layerstree.id">\n          </tristate-tree>\n        </ul>\n        <!--<ul>\n          <tristate-tree  :externallayers="state.externallayers" :layerstree="layerstree" class="item" v-for="layerstree in state.externallayers" :key="layerstree.id">\n          </tristate-tree>\n        </ul>-->\n      </div>\n      <div v-if="hasBaseLayers" role="tabpanel" class="tab-pane baselayers" id="baselayers">\n        <form>\n          <ul>\n            <li v-if="!baselayer.fixed" v-for="baselayer in baselayers">\n              <div class="radio">\n                <label><input type="radio" name="baselayer" v-checked="baselayer.visible" @click="setBaseLayer(baselayer.id)">{{ baselayer.title }}</label>\n              </div>\n            </li>\n          </ul>\n        </form>\n      </div>\n      <layerslegend v-for="_layerstree in state.layerstrees" :layerstree="_layerstree"></layerslegend>\n    </div>\n  </div>\n  <ul id="layer-menu" v-click-outside-layer-menu="closeLayerMenu"  tabindex="-1" v-if="layerMenu.show"  :style="{top: layerMenu.top + \'px\', left: layerMenu.left + \'px\' }">\n    <li @click.prevent.stop="zoomToLayer"><span class="glyphicon glyphicon-search"> </span> Zoom to Layer</li>\n    <li @click.prevent.stop="startEditing"><span class="glyphicon glyphicon-pencil"> </span> Start Editing</li>\n    <li @click.prevent.stop="" v-if="layerMenu.layer.external" @mouseleave.self="showColorMenu(false,$event)" @mouseover.self="showColorMenu(true,$event)"> Setta/Cambia Colore <i class="fa fa-chevron-right" style="padding-left:10px;" aria-hidden="true"></i>\n      <ul v-if="layerMenu.colorMenu.show" style="position:fixed" :style="{ top: layerMenu.colorMenu.top + \'px\', left: layerMenu.colorMenu.left +   \'px\' }">\n        <li style="padding:0;">\n          <chrome-picker @click.prevent.stop="" v-model="layerMenu.colorMenu.color" @change-color="onChangeColor" style="width: 100%"></chrome-picker>\n        </li>\n      </ul>\n    </li>\n  </ul>\n</div>\n'},{}],114:[function(e,t,i){function r(e){function t(e){var t=e.getService();i.state.visible=!t.state.hidden,t.onafter("setHidden",function(e){i.state.visible=!t.state.hidden,i.state.expanded=!0})}n(this);var i=this;this.id="catalog-component",this.title="catalog",this.mapComponentId=e.mapcomponentid;var r=e.service||new d;if(this.setService(r),this.setInternalComponent(new g({service:r})),this.internalComponent.state=this.getService().state,this.mapComponentId){var o=c.getComponent(this.mapComponentId);o?t(o):l.on("componentregistered",function(e){e.getId()==i.mapComponentId&&t(e)})}a(this,e)}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/utils/utils").merge,s=e("gui/vue/component"),l=e("gui/componentsregistry"),c=e("gui/gui"),u=e("gui/map/control/registry"),p=e("core/catalog/cataloglayersstoresregistry"),d=e("../catalogservice"),h=VueColor.Chrome,m=new Vue,f={template:e("./catalog.html"),data:function(){return{state:null,layerMenu:{show:!1,top:0,left:0,name:"",layer:null,colorMenu:{show:!1,top:0,left:0,color:null}}}},directives:{"click-outside-layer-menu":{bind:function(e,t,i){this.event=function(r){e==r.target||e.contains(r.target)||i.context[t.expression](r)},document.body.addEventListener("click",this.event)},unbind:function(e){document.body.removeEventListener("click",this.event)}}},components:{"chrome-picker":h},computed:{project:function(){return this.state.prstate.currentProject},title:function(){return this.project.state.name},baselayers:function(){return this.project.state.baselayers},hasBaseLayers:function(){return this.project.state.baselayers.length>0}},methods:{setBaseLayer:function(e){this.project.setBaseLayer(e)},zoomToLayer:function(){var e;this.layerMenu.layer.bbox&&(e=[this.layerMenu.layer.bbox.minx,this.layerMenu.layer.bbox.miny,this.layerMenu.layer.bbox.maxx,this.layerMenu.layer.bbox.maxy]);var t=c.getComponent("map").getService();t.goToBBox(e),this.layerMenu.show=!1},startEditing:function(){var e,t=this;_.forEach(p.getLayersStores(),function(i){if(e=i.getLayerById(t.layerMenu.layer.id))return!1}),e.getFeatures()},closeLayerMenu:function(){this.layerMenu.show=!1,this.showColorMenu(!1)},onChangeColor:function(e){var t=c.getComponent("map").getService();this.layerMenu.colorMenu.color=e;var i=t.getLayerByName(this.layerMenu.name);i.setStyle(t.setExternalLayerColor(e))},showColorMenu:function(e,t){if(e){var i=$(t.target);this.layerMenu.colorMenu.top=i.offset().top,this.layerMenu.colorMenu.left=i.offset().left+i.width()+(i.outerWidth()-i.width())/2}this.layerMenu.colorMenu.show=e}},mounted:function(){var e=this;m.$on("treenodetoogled",function(e,t){if(t.external){var i,r=c.getComponent("map").getService();i=r.getLayerByName(t.name),i.setVisible(!i.getVisible()),t.visible=!t.visible}else p.getLayersStore(e).toggleLayer(t.id)}),m.$on("treenodestoogled",function(e,t,i){function r(e){e.nodes?_.forEach(e.nodes,function(e){r(e)}):o.push(e.id)}var o=[];_.map(t,r),p.getLayersStore(e).toggleLayers(o,i)}),m.$on("treenodeselected",function(e,t){var i=c.getComponent("map").getService(),r=p.getLayersStore(e).getLayerById(t.id);r.isSelected()?(p.getLayersStore(e).unselectLayer(t.id),i.emit("cataloglayerunselected",r)):(p.getLayersStore(e).selectLayer(t.id),i.emit("cataloglayerselected",r))}),m.$on("showmenulayer",function(t,i){e.layerMenu.top=i.y,e.layerMenu.left=i.x,e.layerMenu.name=t.name,e.layerMenu.layer=t,e.layerMenu.show=!0,e.layerMenu.colorMenu.color=t.color}),u.onafter("registerControl",function(t,i){"querybbox"==t&&i.getInteraction().on("propertychange",function(t){"active"==t.key&&(e.state.highlightlayers=!t.oldValue)})}),$("input:file").filestyle({buttonText:"",input:!1,buttonName:"btn-primary",iconName:"glyphicon glyphicon-plus"})}},g=Vue.extend(f);Vue.component("g3w-catalog",f),Vue.component("tristate-tree",{template:e("./tristate-tree.html"),props:{layerstree:{},storeid:null,checked:!1,parentFolder:!1,externallayers:null},data:function(){return{expanded:this.layerstree.expanded,parentChecked:!this.checked,controltoggled:!1,n_childs:null}},watch:{checked:function(e){this.layerstree.visible=e}},computed:{isFolder:function(){var e=0,t=0;!function r(i){_.forEach(i.nodes,function(i){i.nodes||(t+=1),i.visible?e+=1:i.nodes&&r(i)})}(this.layerstree),this.n_childs=t;var i=!!this.n_childs;return i&&(this.n_parentChilds=this.n_childs-e),i},isHidden:function(){return this.layerstree.hidden&&this.layerstree.hidden===!0},selected:function(){var e=this.layerstree.selected?"SI":"NO";return e},isHighLight:function(){return this.layerstree.id,!1}},methods:{toggle:function(e){var t="true"==e;this.isFolder&&!t?this.layerstree.expanded=!this.layerstree.expanded:t?(this.parentChecked&&!this.n_parentChilds?this.parentChecked=!1:this.parentChecked&&this.n_parentChilds?this.parentChecked=!0:this.parentChecked=!this.parentChecked,m.$emit("treenodestoogled",this.storeid,this.layerstree.nodes,this.parentChecked)):m.$emit("treenodetoogled",this.storeid,this.layerstree)},select:function(){this.isFolder||this.layerstree.external||m.$emit("treenodeselected",this.storeid,this.layerstree)},triClass:function(){return this.n_parentChilds?this.n_parentChilds>0&&this.n_parentChilds<this.n_childs?"fa-square":"fa-square-o":"fa-check-square-o"},removeExternalLayer:function(e){var t=c.getComponent("map").getService();t.getLayerByName(e);t.removeExternalLayer(e)},showLayerMenu:function(e,t){this.isFolder||m.$emit("showmenulayer",e,t)}}}),Vue.component("layerslegend",{template:e("./legend.html"),props:["layerstree"],data:function(){return{}},computed:{visiblelayers:function(){function e(i){_.forIn(i,function(i,r){!_.isNil(i.id)&&i.visible&&t.push(i),_.isNil(i.nodes)||e(i.nodes)})}var t=[],i=this.layerstree.tree;return e(i),t}},watch:{layerstree:{handler:function(e,t){},deep:!0}},mounted:function(){Vue.nextTick(function(){$(".legend-item").perfectScrollbar()})}}),Vue.component("layerslegend-item",{template:e("./legend_item.html"),props:["layer"],computed:{legendurl:function(){var e,t=this;return _.forEach(p.getLayersStores(),function(i){if(i.getLayerById(t.layer.id))return e=i.getLayerById(t.layer.id).getLegendUrl(),!1}),e}},methods:{updateLegendScroll:function(e){$(e.target).perfectScrollbar("update")}}}),o(r,s),t.exports=r},{"../catalogservice":112,"./catalog.html":113,"./legend.html":115,"./legend_item.html":116,"./tristate-tree.html":117,"core/catalog/cataloglayersstoresregistry":23,"core/utils/utils":80,"gui/componentsregistry":119,"gui/gui":135,"gui/map/control/registry":139,"gui/vue/component":173}],115:[function(e,t,i){t.exports='<div role="tabpanel" class="tab-pane" id="legend">\n  <layerslegend-item :layer="layer" v-for="layer in visiblelayers" :key="layer.id"></layerslegend-item>\n</div>\n'},{}],116:[function(e,t,i){t.exports='  <div class="legend-item" @mouseenter="updateLegendScroll($event)">\n    <img :src="legendurl">\n    <span class="divider"></span>\n  </div>\n'},{}],117:[function(e,t,i){t.exports='<li class="tree-item" @contextmenu.prevent.stop="showLayerMenu(layerstree, $event)" @click="select()" :class="{selected: !isFolder ? layerstree.selected : false, itemmarginbottom: !isFolder }">\n  <span :class="{bold: isFolder, \'fa-chevron-down\': layerstree.expanded, \'fa-chevron-right\': !layerstree.expanded}" @click="toggle" v-if="isFolder" class="root fa"></span>\n  <span v-if="isFolder" @click.stop="toggle(\'true\')" :class="[triClass()]" class="fa"></span>\n  <span v-show="!layerstree.hidden" v-else @click.stop="toggle" :class="[layerstree.visible  ? \'fa-check-square-o\': \'fa-square-o\',layerstree.disabled  ? \'disabled\': \'\',  parentFolder ? \'child\' : \'root\' ]" class="fa checkbox-layer"></span>\n  <span v-show="!layerstree.hidden || isFolder" class="tree-node-title" :class="{bold: isFolder, disabled: layerstree.disabled, highlightlayer: isHighLight }">{{ layerstree.title }}</span><i v-if="layerstree.external" class="glyphicon glyphicon glyphicon-trash link trash pull-right" @click="removeExternalLayer(layerstree.name)"></i>\n  <ul v-show="layerstree.expanded" v-if="isFolder">\n    <tristate-tree :parentFolder="isFolder" :n_parent-childs="n_parentChilds" :layerstree="layerstree" :storeid="storeid" v-for="layerstree in layerstree.nodes" :key="layerstree.id">\n    </tristate-tree>\n  </ul>\n</li>'},{}],118:[function(e,t,i){var r=e("core/utils/utils").inherit,o=e("core/utils/utils").merge,n=e("core/utils/utils").base,a=e("core/g3wobject"),s=["methods","computed","data","components"],l=function(e){e=e||{},this.internalComponent=null,this.id=e.id||1e3*Math.random(),this.title=e.title||"",this.state={visible:e.visible||!0,open:e.open||!1},this.setters={setOpen:function(e){this.state.open=e,this._setOpen()},setVisible:function(e){this.state.visible=e,this._setVisible()},reload:function(){this._reload()}},n(this)};r(l,a);var c=l.prototype;c.getId=function(){return this.id},c.setId=function(e){this.id=e},c.getOpen=function(){return this.state.open},c.getVisible=function(){return this.state.visible},c.getTitle=function(){return this.state.title},c.setTitle=function(e){this.state.title=e},c.getService=function(){return this._service},c.setService=function(e){this._service=e},c.getInternalComponent=function(){return this.internalComponent},c.setInternalComponent=function(e){!e&&this.internalComponentClass?this.internalComponent=new this.internalComponentClass:this.internalComponent=e},c.createVueComponent=function(e){return _.cloneDeep(e)},c.addInternalComponentData=function(e){_.merge(this.internalComponent,e)},c.overwriteServiceMethod=function(e,t){this._service[e]=t},c.overwriteServiceMethods=function(e){var t=this;_.forEach(e,function(e,i){t.overwriteServiceMethod(i,e)})},c.extendService=function(e){this._service&&o(this._service,e)},c.extendInternalComponent=function(e){var t=this;this.vueComponent?_.forEach(e,function(e,i){if(s.indexOf(i)>-1)switch(i){case"methods":t.extendInternalComponentMethods(e);break;case"components":t.extendInternalComponentComponents(e);break;default:o(t.vueComponent[i],e)}}):this.vueComponent=e},c.extendInternalComponentComponents=function(e){e&&o(this.vueComponent.components,e)},c.extendInternalComponentMethods=function(e){e&&(_.forEach(e,function(t,i){t instanceof Function||delete e[i]}),o(this.vueComponent.methods,e))},c.extendInternalComponentComputed=function(e){e&&(_.forEach(e,function(t,i){t instanceof Function||delete e[i]}),o(this.vueComponent.computed,e))},c.setInternalComponentTemplate=function(e){e&&(this.vueComponent.template=e)},c.getInternalTemplate=function(){return this.vueComponent.template},c.mount=function(e){},c.unmount=function(){},c.ismount=function(){return!0},c._setOpen=function(){},c._setVisible=function(){},c._reload=function(){},c.layout=function(e,t){},t.exports=l},{"core/g3wobject":36,"core/utils/utils":80}],119:[function(e,t,i){function r(){this.components={},this.registerComponent=function(e){var t=e.getId();this.components[t]||(this.components[t]=e,this.emit("componentregistered",e))},this.getComponent=function(e){return this.components[e]},this.getComponents=function(){return this.components},this.unregisterComponent=function(e){var t=this._components[e];t&&(_.isFunction(t.destroy)&&t.destroy(),delete t,this._components[e]=null)},a(this)}var o=e("core/g3wobject"),n=e("core/utils/utils").inherit,a=e("core/utils/utils").base;n(r,o),t.exports=new r},{"core/g3wobject":36,"core/utils/utils":80}],120:[function(e,t,i){function r(e){n(this),this._editor=options.editor,this._tools=options.tools,this.state={loading:!1,enabled:!1,editing:{on:!1,dirty:!1}}}var o=e("core/utils/utils").inherit,n=e("core/utils//utils").base,a=e("core/g3wobject");e("./editingservice");o(r,a);r.prototype;t.exports=r},{"./editingservice":122,"core/g3wobject":36,"core/utils//utils":80,"core/utils/utils":80}],121:[function(e,t,i){function r(){this.build=function(e){var t=e.getLayer(),i=t.getLayerType(),r=[];switch(i){case o.LayerTypes.VECTOR:var m=t.getGeometryType();switch(m){case n.GeometryTypes.POINT:case n.GeometryTypes.MULTIPOINT:r=[new a({id:"point_addfeature",name:"Inserisci punto",icon:"addPoint.png",editor:e,op:l}),new a({id:"point_movefeature",name:"Modifica punto",icon:"movePoint.png",editor:e,op:c}),new a({id:"point_deletefeature",name:"Elimina punto",icon:"deletePoint.png",editor:e,op:d}),new a({id:"point_editattributes",name:"Modifica attributi",icon:"editAttributes.png",editor:e,op:h})];break;case n.GeometryTypes.LINESTRING:case n.GeometryTypes.MULTILINESTRING:r=[new a({id:"line_addfeature",name:"Inserisci linea",icon:"addLine.png",editor:e,op:l}),new a({id:"line_movevertex",name:"Modifica vertice",icon:"moveVertex.png",editor:e,op:u}),new a({id:"line_deletefeature",name:"Elimina linea",icon:"deleteLine.png",editor:e,op:d}),new a({id:"line_editattributes",name:"Modifica attributi",icon:"editAttributes.png",editor:e,op:h})];break;case n.GeometryTypes.POLYGON:case n.GeometryTypes.MULTIPOLYGON:r=[new a({id:"polygon_addfeature",name:"Inserisci linea",icon:"AddPolygon.png",editor:e,op:l}),new a({id:"polygon_movefeature",name:"Inserisci linea",icon:"MovePolygon.png",editor:e,op:p}),new a({id:"polygon_movevertex",name:"Modifica vertice",icon:"moveVertex.png",editor:e,op:u}),new a({id:"polygon_deletefeature",name:"Elimina linea",icon:"deleteLine.png",editor:e,op:d}),new a({id:"polygon_editattributes",name:"Modifica attributi",icon:"editAttributes.png",editor:e,op:h})]}break;case o.LayerTypes.TABLE:r=[];break;default:r=[]}return new s({
editor:e,tools:r})}}var o=e("core/layers/layer"),n=e("core/geometry/geometry"),a=e("./tool"),s=e("./control"),l=e("./workflows/geometryadd"),c=e("./workflows/geometrymodify"),u=e("./workflows/geometrymodifyvertex"),p=e("./workflows/geometrymove"),d=e("./workflows/geometrydelete"),h=e("./workflows/editfeatureattributes");t.exports=new r},{"./control":120,"./tool":123,"./workflows/editfeatureattributes":124,"./workflows/geometryadd":125,"./workflows/geometrydelete":126,"./workflows/geometrymodify":127,"./workflows/geometrymodifyvertex":128,"./workflows/geometrymove":129,"core/geometry/geometry":38,"core/layers/layer":46}],122:[function(e,t,i){function r(e){this._editorsControls=[],this.state={}}var o=e("core/utils/utils").resolve,n=(e("core/utils/utils").reject,e("gui/gui")),a=e("./controlfactory"),s=r.prototype;s.stop=function(){var e=this,t=$.Deferred();return this._cancelOrSave().then(function(){e._stopEditing(),t.resolve()}).fail(function(){t.reject()}).always(function(){n.closeForm()}),t.promise()},s.getOperations=function(){return this._operations},s.addEditor=function(e){var t=a.build(e);this._editorsControls.push(t)},s.getEditorsControls=function(){return this._editorsControls},s._cancelOrSave=function(){return o()},s._stopEditing=function(){},t.exports=r},{"./controlfactory":121,"core/utils/utils":80,"gui/gui":135}],123:[function(e,t,i){function r(e){n(this),e=e||{},this._editor=e.editor,this._session=e.session,this._op=e.op,this.state={id:e.id,name:e.name,enabled:!1,started:!1,icon:e.icon}}var o=(e("core/utils/utils").resolve,e("core/utils/utils").inherit),n=e("core/utils//utils").base,a=e("core/g3wobject");o(r,a);var s=r.prototype;s.getId=function(){return this.state.id},s.getName=function(){return this.state.name},s.start=function(){if(this._op){var e=this._editor.getLayer();return this._op.start(e,{session:this._session})}},s.stop=function(){if(this._op)return this._op.stop()},t.exports=r},{"core/g3wobject":36,"core/utils//utils":80,"core/utils/utils":80}],124:[function(e,t,i){function r(){n(this)}var o=e("core/utils/utils").inherit,n=e("core/utils//utils").base,a=e("core/workflow/workflow");o(r,a);r.prototype;t.exports=r},{"core/utils//utils":80,"core/utils/utils":80,"core/workflow/workflow":82}],125:[function(e,t,i){function r(){n(this),this._steps=[]}var o=e("core/utils/utils").inherit,n=e("core/utils//utils").base,a=e("core/workflow/workflow");e("core/workflow/step");o(r,a);r.prototype;t.exports=r},{"core/utils//utils":80,"core/utils/utils":80,"core/workflow/step":81,"core/workflow/workflow":82}],126:[function(e,t,i){function r(){n(this)}var o=e("core/utils/utils").inherit,n=e("core/utils//utils").base,a=e("core/workflow/workflow");o(r,a);r.prototype;t.exports=r},{"core/utils//utils":80,"core/utils/utils":80,"core/workflow/workflow":82}],127:[function(e,t,i){function r(){n(this)}var o=e("core/utils/utils").inherit,n=e("core/utils//utils").base,a=e("core/workflow/workflow");o(r,a);r.prototype;t.exports=r},{"core/utils//utils":80,"core/utils/utils":80,"core/workflow/workflow":82}],128:[function(e,t,i){function r(){n(this)}var o=e("core/utils/utils").inherit,n=e("core/utils//utils").base,a=e("core/workflow/workflow");o(r,a);r.prototype;t.exports=r},{"core/utils//utils":80,"core/utils/utils":80,"core/workflow/workflow":82}],129:[function(e,t,i){function r(){n(this)}var o=e("core/utils/utils").inherit,n=e("core/utils//utils").base,a=e("core/workflow/workflow");o(r,a);r.prototype;t.exports=r},{"core/utils//utils":80,"core/utils/utils":80,"core/workflow/workflow":82}],130:[function(e,t,i){t.exports='<div class="g3w-editing-panel">\n  <template v-for="toolbar in editorstoolbars">\n    <div class="panel panel-primary">\n      <div class="panel-heading">\n        <h3 class="panel-title">{{ toolbar.name }}</h3>\n      </div>\n      <div class="panel-body">\n        <template v-for="tool in toolbar.tools">\n          <div class="editbtn" :class="{\'enabled\' : (state.editing.on && editingtoolbtnEnabled(tool)), \'toggled\' : editingtoolbtnToggled(toolbar.layercode,tool.tooltype)}">\n            <img height="30px" width="30px" @click="toggleEditTool(toolbar.layercode,tool.tooltype)" :alt="tool.title" :title="tool.title" :src="resourcesurl+\'images/\'+tool.icon"/>\n          </div>\n        </template>\n      </div>\n    </div>\n  </template>\n  <div>\n    <button class="btn btn-primary" v-disabled="editingbtnEnabled" :class="{\'btn-success\' : state.editingOn}" @click="toggleEditing">{{ editingbtnlabel }}</button>\n    <button class="btn btn-danger" v-disabled="!state.hasEdits" @click="saveEdits">{{ savebtnlabel }}</button>\n    <img v-show="state.retrievingData" :src="resourcesurl +\'images/loader.svg\'">\n  </div>\n  <div class="message" v-html="message"></div>\n</div>\n'},{}],131:[function(e,t,i){function r(e){var t=this;l(this,e),this.vueComponent=p,this.name=e.name||"Gestione dati",c(this,e),this.internalComponent=null,this._template=e.template||u,this._editorsToolbars=e.editorsToolBars||[],this._saveBtnLabel=e.saveBtnLabel||"Salva",this._resourcesUrl=e.resourcesUrl||n.getResourcesUrl();var i=e.serviceOptions||{};this._service=e.service||new s(i),this.setInternalComponent=function(){var e=Vue.extend(this.vueComponent);return this.internalComponent=new e({service:this._service,template:this._template,data:function(){return{state:t._service.state,resourcesurl:t._resourcesUrl,editorstoolbars:t._editorsToolbars,savebtnlabel:t._saveBtnLabel}}}),this.internalComponent},this.mount=function(e){return l(this,"mount",e,!0)},this.unmount=function(){return this._service.stop(),l(this,"unmount")}}var o=e("core/utils/utils").inherit,n=e("gui/gui"),a=e("gui/vue/component"),s=e("gui/editing/editingservice"),l=e("core/utils/utils").base,c=e("core/utils/utils").merge,u=e("./editing.html"),p={template:null,data:null,transitions:{addremovetransition:"showhide"},methods:{toggleEditing:function(){this.$options.service.toggleEditing()},saveEdits:function(){this.$options.service.saveEdits()},toggleEditTool:function(e,t){""!=t&&this.state.editing.on&&this.$options.service.toggleEditTool(e,t)},editingtoolbtnToggled:function(e,t){return this.state.editing.layerCode==e&&this.state.editing.toolType==t},editingtoolbtnEnabled:function(e){return""!=e.tooltype},onClose:function(){this.$options.service.stop()}},computed:{editingbtnlabel:function(){return this.state.editing.on?"Termina editing":"Avvia editing"},editingbtnEnabled:function(){return this.state.editing.error||!this.state.editing.enabled&&!this.state.editing.on?"disabled":""},message:function(){var e="";if(this.state.editing.enabled){if(this.state.editing.toolstep.message){var t=this.state.editing.toolstep.n,i=this.state.editing.toolstep.total,r=this.state.editing.toolstep.message;e='<div style="margin-top:20px">GUIDA STRUMENTO:</div><div><span>['+t+"/"+i+'] </span><span style="color: yellow">'+r+"</span></div>"}}else e='<span style="color: red">Aumentare il livello di zoom per abilitare l\'editing';return e}}};o(r,a),t.exports=r},{"./editing.html":130,"core/utils/utils":80,"gui/editing/editingservice":122,"gui/gui":135,"gui/vue/component":173}],132:[function(e,t,i){function r(){this._actions={},this.state=null,this._pickInteraction=null,this.setters={setInitForm:function(e){this._setInitForm(e)},setFormRelations:function(e){this.state.relations=e},setFormFields:function(e){this.state.fields=e},setupFields:function(){this._setupFields()},setupRelationsFields:function(){this._setupRelationsFields()},setFormData:function(e,t){this.setFormFields(e),this.setFormRelations(t)},setField:function(e){},setState:function(e){this._setState(e)},addActionsForForm:function(e){},postRender:function(e){}},this._setInitForm=function(e){this.provider=e.provider||null,this.formId=e.formId,this.name=e.name,this.dataid=e.dataid,this.editor=e.editor||{},this.relationOne=e.relationOne||null,this.pk=e.pk||null,this.tools=e.tools||[],this.isnew=!(!_.isNil(e.isnew)&&_.isBoolean(e.isnew))||e.isnew,this._defaults=e.defaults||d.defaults,this.buttons=e.buttons,this._clipBoard=c;var t=this.formId.split("form")[0];this._pickedPromise=null,this.state={fields:null,relations:null,editor:this.editor,isnew:this.isnew,buttons:this.buttons,tools:{},relationOne:this.relationOne,canpaste:_.has(this._clipBoard._data,t)},this.setFormFields(e.fields),this.setFormRelations(e.relations);var i=this.getUniqueRelationsElementId();this.state.elementsBoxes=i,this._setFormTools(this.tools),this.editor.setFormService(this)},this.cleanStateAfterCommit=function(e){var t=e&&e.length>0?e[0].relations:{};_.forEach(this.state.relations,function(e){var i=t[e.name];_.forEachRight(e.elements,function(t,r){t.state.indexOf("DELETE")>-1&&e.elements.splice(r,1),"NEW"==t.state&&(_.forEach(i,function(e){if(t.id==e.clientid)return t.id=e.id,!1}),t.state="OLD")})})},this.createPickInteraction=function(){return this._pickInteraction=new l,this._pickInteraction},this.getState=function(){return this.state},this._setState=function(e){this.state=e},this._checkFieldsValidation=function(e){var t=this,i=!0,r=!0;return _.forEach(e,function(e){t._isEditable(e)&&t._isVisible(e)&&e.validate&&e.validate.required&&(!_.isNil(e.value)&&_.trim(e.value)||t._isSelect(e)||(r=!1),i=i&&r)}),i},this.getFields=function(){return this._fields},this._getRelationsOne=function(){var e=this,t=[];return _.forEach(this.state.relations,function(i,r){"ONE"==i.type&&t.push(e.state.relations[r])}),t},this._getLayerFormFromId=function(){return this.formId.split("form")[0]},this._copyFormToClipBoard=function(){var e=_.cloneDeep(this.state);return this._clipBoard.set(this.formId,e),this.state.canpaste=!0,!0},this._setFieldValueLayerFromToRelationField=function(e,t){},this._checkIfFieldIsOverwritable=function(e,t){var i=null;return _.forEach(t,function(t){_.isNil(t[e])||(i=t[e])}),i},this._pasteStateWithoutPk=function(e,t){var i=this,r=[],o=i.editor.getcopyAndPasteFieldsNotOverwritable(),n={};_.isNil(o.layer)||(r=o.layer),_.isNil(o.relations)||(n=o.relations);var a;_.forEach(e,function(t,o){a=i._checkIfFieldIsOverwritable(t.name,r),i.pk==t.name?e[o].value=i.isnew?null:i.state.fields[o].value:_.isNull(a)||(e[o].value=a&&i.isnew?void 0:i.state.fields[o].value)}),_.forEach(t,function(e,i){_.forEach(e.elements,function(r,o){t[i].elements[o].state="NEW",_.forEach(r.fields,function(r,a){_.forEach(n[e.name],function(e){r.name==e&&(t[i].elements[o].fields[a].value=void 0)})})})}),this.setFormData(e,t);var s=this.getUniqueRelationsElementId(!1);return this.state.elementsBoxes=s,!0},this._pasteClipBoardToForm=function(e){var t=this._clipBoard.get(e);this._pasteStateWithoutPk(t.fields,t.relations),this.state.canpaste=!1},this._isNew=function(){return this.isnew},this._hasFieldsRequired=function(){var e=_.some(this.state.fields,function(e){return e.validate&&e.validate.required}),t=_.some(this.state.relations,function(e){return e.validate&&e.validate.required});return e||t},this._isVisible=function(e){return!(!e.editable&&(""==e.value||_.isNull(e.value)))&&e.name!=this.pk},this._isEditable=function(e){return e.editable},this._isSimple=function(e){return!_.includes(d.specialInputs,e.input.type)&&_.includes(d.simpleFieldTypes,e.type)},this._isTextarea=function(e){return e.input.type==d.TEXTAREA},this._isSelect=function(e){return _.includes(d.specialInputs,e.input.type)&&e.input.type==d.SELECT},this._isRadio=function(e){return _.includes(d.specialInputs,e.input.type)&&e.input.type==d.RADIO},this._isCheckbox=function(e){return _.includes(d.specialInputs,e.input.type)&&e.input.type==d.CHECKBOX},this._isLayerPicker=function(e){return _.includes(d.specialInputs,e.input.type)&&e.input.type==d.LAYERPICKER},this._isImage=function(e){return e.input.type==d.IMAGE},this._cleanUpPickLayer=function(){var e=a.getComponent("map").getService();e.removeInteraction(this._pickInteraction),this._pickInteraction=null,a.setModal(!0)},this._pickLayerInputFieldChange=function(e,t){console.log("funzione che deve essere sovrascritta dal plugin")},this._pickLayer=function(e,t){var i=$.Deferred();a.notify.info("Seleziona un'elemento dalla mappa per ottenere il valore di "+e.label+" o scrivilo direttamentene");var r=this;a.setModal(!1);var o=a.getComponent("map").getService(),n=o.getLayersStore.getLayerById(e.input.options.layerid),s=e.input.options.field,l=n.getAttributeLabel(e.input.options.field);return o.addInteraction(this.createPickInteraction()),this._pickInteraction.on("picked",function(t){u.queryByLocation(t.coordinate,[n]).then(function(t){var r=t.data;if(r.length&&r[0].features.length){var o=r[0].features[0].getProperties(),n=o[s]?o[s]:o[l];e.value=n,i.resolve(o)}else i.reject()}).fail(function(){i.reject()}).always(function(){r._cleanUpPickLayer()})}),i.promise()},this._pickLayerToClipBoard=function(){var e=this,t=$.Deferred();if(this._pickedPromise)return this._pickedPromise;a.setModal(!1);var i=a.getComponent("map").getService(),r=this.editor.getVectorLayer(),o=i.getLayersStore().getLayerById(r.id);return i.addInteraction(this.createPickInteraction()),this._pickInteraction.on("picked",function(i){u.queryByLocation(i.coordinate,[o]).then(function(i){var o=i.data;if(o.length&&o[0].features.length){var n=o[0].features[0],a=r.getPk(),s=r.getFeatureById(n.get(a));s||(s=r.getFeatureById(n.getId()));var l=r.getFieldsWithValues(s),c=e.editor.getRelationsWithValues(s);c.then(function(i){e._pasteStateWithoutPk(l,i),t.resolve()})}}).fail(function(){t.reject()}).always(function(){e._cleanUpPickLayer()})}),t.promise()},this._getDefaultValue=function(e){return e.input&&e.input.options&&e.input.options["default"]?e.input.options["default"]:this._isSelect(e)?e.input.options.values[0].key:""},this._getlayerPickerLayerName=function(e){var t=p.getCurrentProject().getLayersStore().getLayerById(e);return t?t.getName():""},this._shouldShowRelation=function(e){return!0},this._setupFields=function(){var e=this,t=_.filter(this.state.fields,function(t){return!e.pk||null!=t.value||t.name!=e.pk});_.forEach(t,function(t){if(_.isNil(t.value)){var i=e._getDefaultValue(t);i&&(t.value=i)}})},this._setupRelationsFields=function(e){var t=this;e=e||this.state.relations,e&&_.forEach(e,function(e){_.forEach(e.elements,function(e){t._setupRelationElementFields(e)})})},this._setupRelationElementFields=function(e){var t=this;_.forEach(e.fields,function(e){_.isNil(e.value)&&(e.value=t._getDefaultValue(e))})},this._setupPanel=function(){var e=this.internalComponent=new this._formPanel({form:this});this.options.buttons&&(e.buttons=this.options.buttons);var t=this.getUniqueRelationsElementId();return this.state.elementsBoxes=t,e.state=this.state,this._setFormTools(this.tools),e},this._setFormTools=function(e){var t=this;_.forEach(e,function(e){t.state.tools[e]=!0})},this.getUniqueRelationsElementId=function(e){var t=this,i={},r=!!_.isNil(e)||e;return _.forEach(this.state.relations,function(e){_.forEach(e.elements,function(o){var n=t.getUniqueRelationElementId(e,o);i[n]={collapsed:r}})}),i},this.getUniqueRelationElementId=function(e,t){return e.name+"_"+t.id},this._getField=function(e){var t=null;return _.forEach(this.state.fields,function(i){i.name==e&&(t=i)}),t},this._setImageStyleInput=function(){$("input:file").filestyle({buttonText:" Foto",buttonName:"btn-primary",iconName:"glyphicon glyphicon-camera"})},this._addRelationElement=function(e){var t=this,i=this.provider.createRelationElement(e),r=this.getUniqueRelationElementId(e,i);Vue.set(this.state.elementsBoxes,r,{collapsed:!1}),this._setupRelationElementFields(i),e.elements.push(i),_.forEach(i.fields,function(e){t._isImage(e)&&Vue.nextTick(function(){t._setImageStyleInput()})})},this._removeRelationElement=function(e,t){var i=this;_.forEach(e.elements,function(e,r){e.id==t.id&&(t.state=t.state+"_DELETED",delete i.state.elementsBoxes.elmentBoxId)})},this._removeRelationElements=function(e){var t=this;_.forEach(e.elements,function(i){t._removeRelationElement(e,i)})},this._getRelationField=function(e,t){var i=null;return _.forEach(this.state.relations,function(r){t==r.name&&_.forEach(r.fields,function(t){t.name==e&&(i=t)})}),i},this._getRelationElementField=function(e,t){var i;return _.forEach(t.fields,function(t){t.name==e&&(i=t)}),i},n(this)}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("gui/gui"),s=e("core/g3wobject"),l=e("g3w-ol3/src/interactions/pickcoordinatesinteraction"),c=e("core/clipboardservice"),u=e("core/query/queryservice"),p=e("core/project/projectsregistry"),d={};d.STRING="string",d.INTEGER="integer",d.FLOAT="float",d.BOOLEAN="boolean",d.defaults={},d.defaults[d.STRING]="",d.defaults[d.INTEGER]=0,d.defaults[d.FLOAT]=0,d.simpleFieldTypes=[d.STRING,d.INTEGER,d.FLOAT],d.TEXTAREA="textarea",d.SELECT="select",d.RADIO="radio",d.CHECKBOX="checkbox",d.LAYERPICKER="layerpicker",d.IMAGE="image",d.specialInputs=[d.TEXTAREA,d.SELECT,d.RADIO,d.CHECKBOX,d.LAYERPICKER,d.IMAGE],o(r,s),t.exports=r},{"core/clipboardservice":24,"core/g3wobject":36,"core/project/projectsregistry":76,"core/query/queryservice":77,"core/utils/utils":80,"g3w-ol3/src/interactions/pickcoordinatesinteraction":103,"gui/gui":135}],133:[function(e,t,i){function r(e){var e=e||{};e.id=e.id||"form",l(this,e);var t=e.service?new e.service:new s,i=e.vueComponentOptions||u;this.vueComponent=this.createVueComponent(i),this.setService(t);var r=e.template||c;this.setInternalComponentTemplate(r),this.setInternalComponent=function(){var e=Vue.extend(this.vueComponent);this.internalComponent=new e({formService:this.getService(),template:this.getInternalTemplate()}),this.internalComponent.state=this.getService().state},this.mount=function(e,t){var i=this;return l(this,"mount",e,t).then(function(){i.getService().setupFields(),i.getService().setupRelationsFields(),n.setModal(!0)})},this.layout=function(e,t){var i=$(this.internalComponent.$el).find(".g3w-form-component_header").height(),r=t-i;$(this.internalComponent.$el).find(".g3w-form-component_body").height(r),$(".nano").nanoScroller()}}var o=e("core/utils/utils").inherit,n=e("gui/gui"),a=e("gui/vue/component"),s=e("gui/form/formservice"),l=e("core/utils/utils").base,c=e("./templateform.html");Vue.filter("startcase",function(e){return _.startCase(e)}),Vue.filter("lowerCase",function(e){return _.lowerCase(e)}),Vue.filter("relationplural",function(e){return e.plural?e.plural:_.startCase(e.name)});var u={template:null,data:function(){return{state:null,tools:{copypaste:!1}}},components:{},transitions:{addremovetransition:"showhide"},methods:{exec:function(e){var t=this.state.relations||null;e(this.state.fields,t),this.state.editor.getPickedFeature()&&this.state.editor.cleanUpPickedFeature(),n.closeForm()},btnEnabled:function(e){return"save"!=e.type||"save"==e.type&&this.isValidForm()},hasFieldsRequired:function(){return this.$options.formService._hasFieldsRequired()},isEditable:function(e){return this.$options.formService._isEditable(e)},isSimple:function(e){return this.$options.formService._isSimple(e)},isTextarea:function(e){return this.$options.formService._isTextarea(e)},isSelectOptionsNull:function(e){return _.isNil(e)?"null":e},isSelect:function(e){return this.$options.formService._isSelect(e)},isRadio:function(e){return this.$options.formService._isRadio(e)},isCheckbox:function(e){return this.$options.formService._isCheckbox(e)},multiCheckBoxValue:function(e,t){t.value||(filed.value=[]),e.target.checked?t.push(e.target.value):_.remove(t,function(t){return t==e.target.value})},isLayerPicker:function(e){return this.$options.formService._isLayerPicker(e)},removeImage:function(e){e.value=null},isImage:function(e){return this.$options.formService._isImage(e)},layerPickerPlaceHolder:function(e){return this.$options.formService._getlayerPickerLayerName(e.input.options.layerid)},pickLayer:function(e,t){this.checkPickLayer(),this.$options.formService._pickLayer(e,t)},pickLayerInputFieldChange:function(e,t){this.$options.formService._pickLayerInputFieldChange(e,t)},pickLayerToClipBoard:function(){this.checkPickLayer(),this.$options.formService._pickLayerToClipBoard().then(function(){})},isValidForm:function(){var e=this,t=this.$options.formService._checkFieldsValidation(this.state.fields);return _.forEach(this.state.relations,function(i){e.showRelation(i)&&_.forEach(i.elements,function(i){return i.state.indexOf("DELETE")>-1||void(t=t&&e.$options.formService._checkFieldsValidation(i.fields))})}),t},pickLayerInputChange:function(){this.$options.formService._cleanUpPickLayer()},checkPickLayer:function(){this.$options.formService._pickInteraction&&this.$options.formService._cleanUpPickLayer()},isVisible:function(e){return this.$options.formService._isVisible(e)},visibleElements:function(e){return _.filter(e.elements,function(e){return"NEW_DELETED"!=e.state&&"OLD_DELETED"!=e.state})},visibleElementsLength:function(e){return this.visibleElements(e).length},showRelation:function(e){return this.$options.formService._shouldShowRelation(e)},relationPkFieldName:function(e){return e.pk},isRelationElementDeletable:function(e,t){if(t["new"])return!0;var i;return i="ONE"==e.type?1:Number.NEGATIVE_INFINITY,e.min&&(i=Math.min(i.relation.min)),i<e.elements.length},canAddRelationElements:function(e){var t=!0;if("ONE"==e.type)t=!e.elements.length;else{var i=e.max?e.max:Number.POSITIVE_INFINITY;t=e.elements.length<i}return t},addRelationElement:function(e){this.$options.formService._addRelationElement(e)},removeRelationElement:function(e,t){this.$options.formService._removeRelationElement(e,t)},visibleElementFields:function(e){var t=this;return _.filter(e,function(e){return t.isVisible(e)})},fieldsSubset:function(e){var t=_.filter(e,function(e){return"image"!=e.type}),i=Math.min(3,t.length);return t.slice(0,i)},fieldsSubsetLength:function(e){return this.fieldsSubset(e).length},collapseElementBox:function(e,t){var i=this.getUniqueRelationElementId(e,t);if(this.state.elementsBoxes[i])return this.state.elementsBoxes[i].collapsed},toggleElementBox:function(e,t){var i=this.getUniqueRelationElementId(e,t);this.state.elementsBoxes[i].collapsed=!this.state.elementsBoxes[i].collapsed},getUniqueRelationElementId:function(e,t){return this.$options.formService.getUniqueRelationElementId(e,t)},pasteClipBoardToForm:function(){var e=this.$options.formService._getLayerFormFromId();this.$options.formService._pasteClipBoardToForm(e),this.$validate(),this.$validate(this.state.relations),this.$resetValidation()},copyToClipBoard:function(){this.$options.formService._copyFormToClipBoard()},onSelectChange:function(e,t){e.value=t.target.value},onFileChange:function(e,t,i){var r,o={},a=this.$cookie.get("csrftoken");a&&(o.csrfmiddlewaretoken=a),r=t?$("#foto-spinner"+t):$("#foto-spinner"),n.showSpinner({container:r,id:"fotoloadspinner",style:"white",center:!0}),$(i.target).fileupload({dataType:"json",formData:o,done:function(t,i){$.each(i.result,function(t,i){e.value=i.filename})},fail:function(){$(this).siblings(".bootstrap-filestyle").find("input").val(e.value),n.notify.error("Si è verificato un errore nel caricamento")},always:function(){n.hideSpinner("fotoloadspinner")}});var s=i.target.files||i.dataTransfer.files;!s.length},createImage:function(e,t){var i=new FileReader;i.onload=function(e){t.value=e.target.result},i.readAsDataURL(e)},checkFileSrc:function(e){var e=e;return _.isNil(e)&&(e=""),e},setImageStyleInput:function(){this.$options.formService._setImageStyleInput()}},computed:{isValid:function(e){return this.$validate(e.name)},hasRelations:function(){return this.state.relations.length},fields:function(){return this.state.fields}},watch:{"state.fields":function(){this.setImageStyleInput()}},mounted:function(){var e=this;if(this.state.relationOne&&this.state.isnew){var t=this.$options.formService._getRelationsOne();_.forEach(t,function(t){t.elements.length||e.addRelationElement(t)})}this.$nextTick(function(){e.setImageStyleInput(),e.$options.formService.postRender()})},beforeDestroy:function(){this.$options.formService._cleanUpPickLayer()}};o(r,a),t.exports=r},{"./templateform.html":134,"core/utils/utils":80,"gui/form/formservice":132,"gui/gui":135,"gui/vue/component":173}],134:[function(e,t,i){t.exports='<div>\n  <div class="g3w-form-component_header">\n    <div class="quick-actions-menu">\n      <div v-if="state.tools.copypaste" class="pull-right">\n        <button v-if=\'state.isnew\' class="btn btn-default glyphicon glyphicon-screenshot" data-placement="bottom" @click="pickLayerToClipBoard"  data-i18n="[title]copy_form_data_from_feature"></button>\n        <button v-if=\'!state.isnew\' class="btn btn-default glyphicon glyphicon-copy" data-placement="bottom" @click="copyToClipBoard"  data-i18n="[title]copy_form_data"></button>\n        <button v-if=\'state.isnew\' class="btn btn-default glyphicon glyphicon-paste" data-placement="bottom" @click="pasteClipBoardToForm" v-disabled="!state.canpaste" data-i18n="[title]paste_form_data"></button>\n      </div>\n    </div>\n  </div>\n  <div class="g3w-form-component_body nano">\n    <form name="validation" novalidate class="form-horizontal g3w-form nano-content">\n        <div class="box box-primary">\n          <div class="box-header with-border">\n            <h3 class="box-title">Attributi elemento</h3>\n            <div class="box-tools pull-right">\n            </div>\n          </div>\n          <div class="box-body">\n            <template v-for="field in fields">\n              <div v-if="isVisible(field)" class="form-group has-feedback">\n                <label :for="field.name" class="col-sm-4 control-label">{{ field.label }}<span v-if="field.validate && field.validate.required">*</span></label>\n                <div class="col-sm-8">\n                  <input v-if="isSimple(field)" @focus="checkPickLayer" :field="field.name" v-disabled="!isEditable(field)" class="form-control" v-model="field.value" :id="field.name" :placeholder="field.input.label">\n                  <textarea v-if="isTextarea(field)" @focus="checkPickLayer" :field="field.name" v-disabled="!isEditable(field)" class="form-control" v-model="field.value" :id="field.name" :placeholder="field.input.label">\n                  </textarea>\n                  <select v-if="isSelect(field)" @focus="checkPickLayer" :field="field.name" v-disabled="!isEditable(field)" class="form-control" @change="onSelectChange(field, $event)" :value="isSelectOptionsNull(field.value)" :id="field.name" :placeholder="field.input.label">\n                    <option v-for="value in field.input.options.values"  :value="isSelectOptionsNull(value.key)" >{{ value.value }}</option>\n                  </select>\n                  <div v-if="isLayerPicker(field)">\n                    <input class="form-control picklayerinput" @click="pickLayer(field)" @change="pickLayerInputChange" :field="field.name" data-toggle="tooltip" :title="\'Ottieni il dato da un elemento del layer \\\'\' + layerPickerPlaceHolder(field) + \'\\\' o scrivilo direttamente qui\'" v-disabled="!isEditable(field)" v-model="field.value" :id="field.name" :placeholder="\'[\'+layerPickerPlaceHolder(field)+\']\'">\n                    <i class="glyphicon glyphicon-screenshot form-control-feedback" ></i>\n                  </div>\n                  <div v-if="isRadio(field)">\n                    <template v-for="(value,index) in field.input.options.values">\n                      <input class="magic-radio" type="radio" :value="value.value" v-model="field.value" :field="field.name" v-disabled="!isEditable(field)" :id="field.name + value.value" :placeholder="value.key">\n                      <label :for="field.name + value.value">{{ value.key }}</label>\n                    </template>\n                  </div>\n                  <div v-if="isImage(field)">\n                    <i v-if="checkFileSrc(field.value)" class="glyphicon glyphicon glyphicon-trash pull-right link trash" @click="removeImage(field)"></i>\n                    <img v-if="checkFileSrc(field.value)" class="photo-preview img-responsive img-thumbnail rounded"  :src="field.value" />\n                    <div id="foto-spinner"></div>\n                    <input type="file" :name="field.name" :data-url="field.uploadurl" :field="field.name" title="Foto" accept="image/*;capture=camera" class="filestyle" @change="onFileChange(field, null, $event)">\n                  </div>\n                </div>\n              </div>\n            </template>\n          </div>\n        </div>\n        <div v-for="relation, relationIndex in state.relations" style="margin-top:10px">\n          <transition name="expand">\n          <div v-if="showRelation(relation)">\n            <div class="box box-default">\n              <div class="box-header with-border">\n                <h3 class="box-title">{{ relation | relationplural }}</h3>\n              </div>\n              <div class="box-body">\n                <table v-if="visibleElementsLength(relation)" class="table table-striped">\n                  <thead>\n                  <tr>\n                    <th v-for="field in fieldsSubset(relation.fields)">{{field.label}}</th>\n                  </tr>\n                  </thead>\n                  <tbody>\n                  <template v-for="element in visibleElements(relation)">\n                    <tr class="attributes-preview" @click="toggleElementBox(relation, element)">\n                      <td v-for="relfield in fieldsSubset(element.fields)">\n                        <span>{{relfield.value}}</span>\n                      </td>\n                      <td class="pull-right">\n                        <i v-if="isRelationElementDeletable(relation,element)" class="glyphicon glyphicon glyphicon-trash link trash" @click.stop.prevent="removeRelationElement(relation,element)"></i>\n                        <i class="glyphicon glyphicon-option-horizontal link morelink"></i>\n                      </td>\n                    </tr>\n                    <tr v-show="!collapseElementBox(relation,element)" class="queryresults-featurebox">\n                      <td :colspan="fieldsSubsetLength(element.fields)+1">\n                        <template v-for="field in element.fields">\n                          <div v-if="isVisible(field)" class="form-group has-feedback">\n                            <label :for="field.name" class="col-sm-4 control-label">{{ field.label }}<span v-if="field.validate && field.validate.required">*</span></label>\n                            <div class="col-sm-8">\n                              <input v-if="isSimple(field)" @focus="checkPickLayer" :field="field.name" v-disabled="!isEditable(field)" class="form-control" v-model="field.value" :id="field.name" :placeholder="field.input.label">\n                              <textarea v-if="isTextarea(field)" @focus="checkPickLayer" :field="field.name" v-disabled="!isEditable(field)" class="form-control" v-model="field.value" :id="field.name" :placeholder="field.input.label"></textarea>\n                              <select v-if="isSelect(field)" @focus="checkPickLayer" :field="field.name" v-disabled="!isEditable(field)" class="form-control" @change="onSelectChange(field, $event)" :value="isSelectOptionsNull(field.value)" :id="field.name" :placeholder="field.input.label">\n                                <option v-for="value in field.input.options.values"  :value="isSelectOptionsNull(value.key)" >{{ value.value }}</option>\n                              </select>\n                              <div v-if="isRadio(field)">\n                                <template v-for="(value, index) in field.input.options.values">\n                                  <input class="magic-radio" type="radio" :value="value.value" v-model="field.value" :field="field.name" v-disabled="!isEditable(field)" :id="field.name + value.value" :placeholder="value.key">\n                                  <label :for="field.name + value.value">{{ value.key }} </label>\n                                </template>\n                              </div>\n                              <div v-if="isCheckbox(field)">\n                                <template v-for="(value, index) in field.input.options.values">\n                                  <label :for="field.name + value.value">{{ value.key }} </label>\n                                  <input type="radio" :value="value.value" v-model="field.value" :field="field.name" v-disabled="!isEditable(field)" :id="field.name + value.value" :placeholder="value.key">\n                                </template>\n                              </div>\n                              <div v-if="isLayerPicker(field)">\n                                <input class="form-control picklayerinput" @click="pickLayer(field, relation)" @input="pickLayerInputFieldChange(field, relation)"  :field="field.name" data-toggle="tooltip" :title="\'Ottieni il dato da un elemento del layer \\\'\' + layerPickerPlaceHolder(field) + \'\\\' o scrivilo direttamente qui\'" v-disabled="!isEditable(field)" v-model="field.value" :id="field.name" :placeholder="\'[\'+layerPickerPlaceHolder(field)+\']\'">\n                                <i class="glyphicon glyphicon-screenshot form-control-feedback" ></i>\n                              </div>\n                              <div v-if="isRadio(field)">\n                                <template v-for="(value,index) in field.input.options.values">\n                                  <input class="magic-radio" type="radio" :value="value.value" v-model="field.value" :field="field.name" v-disabled="!isEditable(field)" :id="field.name + value.value" :placeholder="value.key">\n                                  <label :for="field.name + value.value">{{ value.key }}</label>\n                                </template>\n                              </div>\n                              <div v-if="isImage(field)" style="position:relative;">\n                                <i v-if="checkFileSrc(field.value)" class="glyphicon glyphicon glyphicon-trash pull-right link trash" @click="removeImage(field)"></i>\n                                <i v-if="checkFileSrc(field.value)" class="glyphicon glyphicon glyphicon-trash pull-right link trash" @click="removeImage(field)"></i>\n                                <img v-if="checkFileSrc(field.value)" class="photo-preview img-responsive img-thumbnail rounded" :src="field.value" />\n                                <div :id="\'foto-spinner\'+relationIndex"></div>\n                                <input type="file" :name="field.name" :data-url="field.uploadurl" :field="field.name" title="Foto" accept="image/*;capture=camera" class="filestyle" @change="onFileChange(field, relationIndex, $event)">\n                              </div>\n                            </div>\n                          </div>\n                        </template>\n                      </td>\n                    </tr>\n                  </template>\n                  </tbody>\n                </table>\n                <div v-if="canAddRelationElements(relation)" class="row" style="margin:0px"><i class="glyphicon glyphicon-plus-sign pull-right btn-add" @click="addRelationElement(relation)"></i></div>\n              </div>\n            </div>\n          </div>\n          </transition>\n        </div>\n        <div class="form-group">\n          <div class="col-sm-offset-4 col-sm-8">\n            <div v-if="hasFieldsRequired" style="margin-bottom:10px">\n              <span>* Campi richiesti</span>\n            </div>\n            <span v-for="button in state.buttons">\n              <button class="btn " :class="[button.class]" @click.stop.prevent="exec(button.cbk)" v-disabled="!btnEnabled(button)">{{ button.title }}</button>\n            </span>\n          </div>\n        </div>\n    </form>\n  </div>\n</div>';
},{}],135:[function(e,t,i){function r(){this.ready=!1,this.getResourcesUrl=o,this.showForm=o,this.closeForm=o,this.showListing=o,this.closeListing=o,this.hideListing=o,this.showQueryResults=function(e){},this.hideQueryResults=o,this.showPanel=o,this.hidePanel=o,this.addComponent=function(e,t){},this.removeComponent=function(e){},this.setComponent=function(e){l.registerComponent(e)},this.getComponent=function(e){return l.getComponent(e)},this.getComponents=function(){return l.getComponents()},this["goto"]=function(e){s["goto"](e)},this.ready=function(){this.emit("ready"),this.ready=!0},this.guiResized=function(){this.emit("guiresized")},this.showSpinner=function(e){},this.hideSpinner=function(e){},this.notify=o,this.dialog=o}var o=e("core/utils/utils").noop,n=e("core/utils/utils").inherit,a=e("core/g3wobject"),s=e("core/router"),l=e("gui/componentsregistry");n(r,a),t.exports=new r},{"core/g3wobject":36,"core/router":78,"core/utils/utils":80,"gui/componentsregistry":119}],136:[function(e,t,i){t.exports="<div>\n  Lista di oggetti\n</div>\n"},{}],137:[function(e,t,i){function r(e){this.panelComponent=null,this.options=e||{},this.id=e.id||null,this.name=e.name||null,this.state={list:e.list||[]},this._listPanelComponent=e.listPanelComponent||a}var o=e("core/utils/utils").resolve,n=(e("core/utils/utils").reject,e("gui/gui")),a=Vue.extend({template:e("./listpanel.html"),methods:{exec:function(e){var t=this.state.relations||null;e(this.state.fields,t),n.closeForm()}}}),s=r.prototype;s.onShow=function(e){var t=this._setupPanel();return this._mountPanel(t,e),o(!0)},s.onClose=function(){return this.panelComponent.$destroy(!0),this.panelComponent=null,o(!0)},s._setupPanel=function(){var e=this.panelComponent=new this._listPanelComponent({panel:this});return e.state=this.state,e},s._mountPanel=function(e,t){e.$mount().$appendTo(t)},t.exports={ListPanelComponent:a,ListPanel:r}},{"./listpanel.html":136,"core/utils/utils":80,"gui/gui":135}],138:[function(e,t,i){var r=e("g3w-ol3/src/controls/resetcontrol"),o=e("g3w-ol3/src/controls/querycontrol"),n=e("g3w-ol3/src/controls/zoomboxcontrol"),a=e("g3w-ol3/src/controls/querybboxcontrol"),s=e("g3w-ol3/src/controls/querybypolygoncontrol"),l=e("g3w-ol3/src/controls/geolocationcontrol"),c=e("g3w-ol3/src/controls/streetviewcontrol"),u=e("g3w-ol3/src/controls/addlayers"),p=e("g3w-ol3/src/controls/lengthcontrol"),d=e("g3w-ol3/src/controls/areacontrol"),h=e("g3w-ol3/src/controls/control"),m=e("g3w-ol3/src/controls/olcontrol"),f=e("g3w-ol3/src/controls/nominatimcontrol"),g={create:function(e){var t,i=g.CONTROLS[e.type],r=e.layers;if(i&&(t=new i(e)),r&&t instanceof h){if(!r.length)return null;var o=t.getGeometryTypes(),n=!o.length;return _.forEach(r,function(e){if(o.indexOf(e.getGeometryType())>-1)return n=!0,!1}),n?t:null}return t}};g.CONTROLS={reset:r,zoombox:n,zoomtoextent:m,query:o,querybbox:a,querybypolygon:s,geolocation:l,streetview:c,zoom:m,scaleline:m,overview:m,nominatim:f,addlayers:u,length:p,area:d},t.exports=g},{"g3w-ol3/src/controls/addlayers":83,"g3w-ol3/src/controls/areacontrol":84,"g3w-ol3/src/controls/control":85,"g3w-ol3/src/controls/geolocationcontrol":86,"g3w-ol3/src/controls/lengthcontrol":88,"g3w-ol3/src/controls/nominatimcontrol":90,"g3w-ol3/src/controls/olcontrol":91,"g3w-ol3/src/controls/querybboxcontrol":92,"g3w-ol3/src/controls/querybypolygoncontrol":93,"g3w-ol3/src/controls/querycontrol":94,"g3w-ol3/src/controls/resetcontrol":95,"g3w-ol3/src/controls/streetviewcontrol":96,"g3w-ol3/src/controls/zoomboxcontrol":97}],139:[function(e,t,i){function r(){this._controls={},this.setters={registerControl:function(e,t){this._registerControl(e,t)}},this._registerControl=function(e,t){this._controls[e]=t},this.getControl=function(e){return this._controls[e]},this.getControls=function(){return this._controls},this.unregisterControl=function(e){var t=this.getControl(e),i=s.getComponet("map").getService(),r=i.getMap();return!!t&&(r.removeControl(t),delete this._controls[e],!0)},n(this)}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/g3wobject"),s=e("gui/gui");o(r,a),t.exports=new r},{"core/g3wobject":36,"core/utils/utils":80,"gui/gui":135}],140:[function(e,t,i){function r(e){var t=this;this.viewer=null,this.target=null,this._layersStoresEventKeys={},this.project=null,this._mapControls=[],this._mapLayers=[],this.mapBaseLayers={},this.layersExtraParams={},this.state={bbox:[],resolution:null,center:null,loading:!1,hidden:!0},this._greyListenerKey=null,this._drawShadow={type:"coordinate",outer:[],inner:[],scale:null,rotation:null},this.config=e.config||l.getConfig(),this._howManyAreLoading=0,this._incrementLoaders=function(){0==this._howManyAreLoading&&(this.emit("loadstart"),s.showSpinner({container:$("#map-spinner"),id:"maploadspinner",style:"blue"})),this._howManyAreLoading+=1},this._decrementLoaders=function(){this._howManyAreLoading-=1,0==this._howManyAreLoading&&(this.emit("loadend"),s.hideSpinner("maploadspinner"))},_.isNil(e.project)?(this.project=c.getCurrentProject(),c.onafter("setCurrentProject",function(e){t._removeListeners(),t.project=e,t._setupLayers(),t._resetView()})):this.project=e.project,this._setupListeners(),this._marker=null,this.setters={setMapView:function(e,t,i){this.state.bbox=e,this.state.resolution=t,this.state.center=i,this.updateMapLayers(this._mapLayers)},setHidden:function(e){this.state.hidden=e},setupViewer:function(e,i){0!=e&&0!=i&&(t.viewer&&(t.viewer.destroy(),t.viewer=null),t._setupViewer(e,i),t.state.bbox=this.viewer.getBBOX(),t.state.resolution=this.viewer.getResolution(),t.state.center=this.viewer.getCenter(),t.setupControls(),t._setupLayers(),t.emit("viewerset"))},controlClick:function(){}},this.on("cataloglayerselected",function(e){e&&_.forEach(this._mapControls,function(t){_.indexOf(_.keysIn(t.control),"onSelectLayer")>-1&&t.control.onSelectLayer()&&(t.control.getGeometryTypes().indexOf(e.getGeometryType())>-1?t.control.setEnable(!0):t.control.setEnable(!1))})}),this.on("cataloglayerunselected",function(e){_.forEach(this._mapControls,function(e){_.indexOf(_.keysIn(e.control),"onSelectLayer")>-1&&e.control.onSelectLayer()&&e.control.setEnable(!1)})}),_.forEach(u.getLayersStores(),function(e){t._setUpEventsKeysToLayersStore(e)}),u.onafter("addLayersStore",function(e){t._setUpEventsKeysToLayersStore(e)}),u.onafter("removeLayersStore",function(e){t._removeEventsKeysToLayersStore(e)}),n(this)}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/g3wobject"),s=e("gui/gui"),l=e("core/applicationservice"),c=e("core/project/projectsregistry"),u=(e("core/layers/layer"),e("core/map/maplayersstoresregistry")),p=e("core/layers/layersstore"),d=e("core/layers/filter/filter"),h=e("core/layers/providers/wfsprovider"),m=e("g3w-ol3/src/g3w.ol3").helpers,f=e("core/map/layer/wmslayer"),g=e("core/map/layer/xyzlayer"),y=e("gui/map/control/factory"),v=e("gui/streetview/streetviewservice"),b=e("gui/map/control/registry");o(r,a);var C=r.prototype;C.slaveOf=function(e,t){},C.setLayersExtraParams=function(e,t){this.layersExtraParams=_.assign(this.layersExtraParams,e),this.emit("extraParamsSet",e,t)},C.getProject=function(){return this.project},C.getMap=function(){return this.viewer.map},C.defineProjection=function(e){switch(e){case"3003":proj4.defs("EPSG:"+e,"+proj=tmerc +lat_0=0 +lon_0=9 +k=0.9996 +x_0=1500000 +y_0=0 +ellps=intl +units=m +no_defs")}},C.getProjection=function(){return this.project.getProjection()},C.getCrs=function(){return this.getProjection().getCode()},C.getViewerElement=function(){return this.viewer.map.getTargetElement()},C.getViewport=function(){return this.viewer.map.getViewport()},C.getResolution=function(){return this.viewer.map.getView().getResolution()},C.getEpsg=function(){return this.viewer.map.getView().getProjection().getCode()},C.getGetFeatureInfoUrlForLayer=function(e,t,i,r,o){var n=this.getMapLayerForLayer(e);return n.getGetFeatureInfoUrl(t,i,r,o)},C.showMarker=function(e,t){t=t||1e3;var i=this;this._marker.setPosition(e),setTimeout(function(){i._marker.setPosition()},t)},C.getLayerByName=function(e){var t=this.viewer.map,i=null;return t.getLayers().forEach(function(t){if(t.get("name")==e)return i=t,!1}),i},C.getLayerById=function(e){var t=this.viewer.map;return t.getLayers().forEach(function(t){if(t.get("id")==e)return layer=t,!1}),layer},C.setupControls=function(){var e=this;this.config&&this.config.mapcontrols&&_.forEach(this.config.mapcontrols,function(t){var i;switch(t){case"reset":isMobile.any||(i=y.create({type:t})),e.addControl(t,i);break;case"zoom":i=y.create({type:t,zoomInLabel:"",zoomOutLabel:""}),e.addControl(t,i);break;case"zoombox":isMobile.any||(i=y.create({type:t}),i.on("zoomend",function(t){e.viewer.fit(t.extent)}),e.addControl(t,i));break;case"zoomtoextent":isMobile.any||(i=y.create({type:t,label:"",extent:e.project.state.initextent}),e.addControl(t,i));break;case"query":i=y.create({type:t}),i.on("picked",function(t){var i=t.coordinates;e.showMarker(i);var r=s.showContentFactory("query"),o=e.getLayers({QUERYABLE:!0,SELECTEDORALL:!0}),n=[];_.forEach(o,function(t){n.push(t.query({coordinates:i,resolution:e.getResolution()}))});var a=r("interrogazione");$.when.apply(this,n).then(function(){results=arguments,results.query=results[0].query;var t=[];_.forEach(results,function(e){t.push(e.data)}),results.data=t,a.setQueryResponse(results,i,e.state.resolution)}).fail(function(){s.notify.error("Si è verificato un errore nella richiesta al server"),s.closeContent()})}),e.addControl(t,i);break;case"querybypolygon":var r=e.getLayers({QUERYABLE:!0,SELECTEDORALL:!0});if(i=y.create({type:t,layers:r})){var o=s.showContentFactory("query");i.on("picked",function(t){var i,r={},n=[],a=[],l=t.coordinates,c=e.getLayers({QUERYABLE:!0,SELECTED:!0});_.forEach(c,function(t){a.push(t.query({type:"query",coordinates:l,resolution:e.getResolution()}))}),$.when.apply(this,a).then(function(){a=[],n=arguments,r={},r.query=n[0].query;var t=[];if(_.forEach(n,function(e){t.push(e.data[0])}),r.data=t,r&&r.data&&r.data.length){i=r.data[0].features[0].getGeometry();var l=e.getLayers({QUERYABLE:!0,ALLNOTSELECTED:!0,WFS:!0});_.forEach(l,function(e){var t=QueryService.createQueryFilterObject({queryLayer:e,ogcService:"wfs",filter:{geometry:i}});a.push(e.query({type:"filter",filter:t}))}),e.highlightGeometry(i);var c=o("interrogazione");$.when.apply(this,a).then(function(){n=arguments,r={},r.query=n[0].query;var t=[];_.forEach(n,function(e){t.push(e.data)}),r.data=t,c.setQueryResponse(r,i,e.state.resolution)}).fail(function(){s.notify.error("Si è verificato un errore nella richiesta al server"),s.closeContent()}).always(function(){e.clearHighlightGeometry()})}}).fail(function(){s.notify.error("Si è verificato un errore nella richiesta al server"),s.closeContent()})}),e.addControl(t,i)}break;case"querybbox":if(!isMobile.any&&e.filterableLayersAvailable()){var r=e.getLayers({QUERYABLE:!0,SELECTEDORALL:!0,WFS:!0});i=y.create({type:t,layers:r}),i&&(i.on("bboxend",function(t){var i=t.extent,r=e.getLayers({QUERYABLE:!0,SELECTEDORALL:!0,WFS:!0}),o=[];_.forEach(r,function(e){var t=new d;t.setBBOX(i),o.push(e.query({filter:t}))});var n=s.showContentFactory("query"),a=n("interrogazione");$.when.apply(this,o).then(function(){results=arguments,results.query=results[0].query;var t=[];_.forEach(results,function(e){t.push(e.data)}),results.data=t,a.setQueryResponse(results,i,e.state.resolution)}).fail(function(e){var t="Si è verificato un errore nella richiesta al server";e&&(t+=" "+e),s.notify.error(t),s.closeContent()})}),e.addControl(t,i))}break;case"streetview":isMobile.any||(i=y.create({type:t}),i.setProjection(e.getProjection()),e.addControl(t,i),e.on("viewerset",function(){e.viewer.map.addLayer(i.getLayer())}),$script("https://maps.googleapis.com/maps/api/js?key=AIzaSyBCHtKGx3yXWZZ7_gwtJKG8a_6hArEFefs",function(){var t={lat:null,lng:null},r=new v;r.onafter("postRender",function(e){i.setPosition(e)}),i&&(i.on("picked",function(i){var o=i.coordinates,n=ol.proj.transform(o,e.getProjection().getCode(),"EPSG:4326");t.lat=n[1],t.lng=n[0],r.showStreetView(t)}),i.on("disabled",function(){panorama&&(panorama=null)}))}));break;case"scaleline":i=y.create({type:t,position:"br"}),e.addControl(t,i);break;case"overview":if(!isMobile.any){var n=e.config.overviewproject.gid;n&&c.getProject(n).then(function(r){var o=e.getOverviewMapLayers(r);i=y.create({type:t,position:"bl",className:"ol-overviewmap ol-custom-overviewmap",collapseLabel:$('<span class="glyphicon glyphicon-menu-left"></span>')[0],label:$('<span class="glyphicon glyphicon-menu-right"></span>')[0],collapsed:!1,layers:o,view:new ol.View({projection:e.getProjection()})}),e.addControl(t,i)})}break;case"nominatim":i=y.create({type:t}),i.on("addresschosen",function(t){var i=t.coordinate,r=new ol.geom.Point(i);e.highlightGeometry(r)}),e.addControl(t,i),$("#search_nominatim").click(function(){i.nominatim.query($("input.gcd-txt-input").val())}),$(".gcd-txt-result").perfectScrollbar();break;case"geolocation":isMobile.any||(i=y.create({type:t}),i.on("click",function(t){e.showMarker(t.coordinates)}),i.on("error",function(e){s.notify.error("Non è possibile calcolare la tua posizione. Si è verificato un errore di connessione al server")}),e.addControl(t,i));break;case"addlayers":isMobile.any||(i=y.create({type:t}),i.on("addlayer",function(){if(!i.getLayersStore()){new p}e.emit("addexternallayer")}),e.addControl(t,i));break;case"length":isMobile.any||(i=y.create({type:t}),e.addControl(t,i));break;case"area":isMobile.any||(i=y.create({type:t}),e.addControl(t,i))}})},C.getLayers=function(e){e=e||{};var t={GEOLAYER:!0,HIDDEN:!1};e=_.merge(e,t);var i=[];return _.forEach(u.getLayersStores(),function(t){_.merge(i,t.getLayers(e))}),i},C.filterableLayersAvailable=function(){var e=this,t=this.getLayers({QUERYABLE:!0,FILTERABLE:!0,SELECTEDORALL:!0});return _.some(t,function(t){return!(t.getProvider("filter")instanceof h)||t.getProjection().getCode()==e.project.getLayersStore().getProjection().getCode()})},C.addControl=function(e,t){var i=this;this.viewer.map.addControl(t),this._mapControls.push({type:e,control:t,visible:!0}),t.on("controlclick",function(){i.controlClick()}),b.registerControl(e,t)},C.showControl=function(e){this.showControls([e])},C.hideControl=function(e){this.hideControls([e])},C.showControls=function(e){this.toggleControls(!0,e)},C.hideControls=function(e){this.toggleControls(!1,e)},C.showAllControls=function(){this.toggleControls(!0)},C.hideAllControls=function(){this.toggleControls(!1)},C.toggleControls=function(e,t){this._removeControls(),_.forEach(this._mapControls,function(i){t?t.indexOf(i.type)>-1&&(i.visible=e):i.visible=e}),this._layoutControls()},C._layoutControls=function(){var e=this;_.forEach(this._mapControls,function(t){t.visible&&e.viewer.map.addControl(t.control)})},C.removeControl=function(e){var t=this;_.forEach(this._mapControls,function(i,r){if(e==i.type)return t._mapControls.splice(r,1),t.viewer.map.removeControl(i.control),!1})},C._removeControls=function(){var e=this;_.forEach(this._mapControls,function(t){e.viewer.map.removeControl(t.control)})},C._unToggleControls=function(){_.forEach(this._mapControls,function(e){e.control.toggle&&e.control.toggle(!1)})},C.addMapLayer=function(e){this._mapLayers.push(e)},C.getMapLayers=function(){return this._mapLayers},C.getMapLayerForLayer=function(e){var t,i="layer_"+e.getMultiLayerId();return _.forEach(this.getMapLayers(),function(e){if(e.getId()==i)return t=e,!1}),t},C.getProjectLayer=function(e){return this.layersstore.getLayerById(e)},C._resetView=function(){var e=this.viewer.map.getSize()[0],t=this.viewer.map.getSize()[1],i=this.project.state.extent,r=ol.extent.getWidth(i)/e,o=ol.extent.getHeight(i)/t,n=Math.max(r,o)>this.viewer.map.getView().getMaxResolution()?Math.max(r,o):this.viewer.map.getView().getMaxResolution(),a=new ol.View({extent:i,projection:this.viewer.map.getView().getProjection(),center:this.viewer.map.getView().getCenter(),resolution:this.viewer.map.getView().getResolution(),maxResolution:n});this.viewer.map.setView(a)},C._setupViewer=function(e,t){var i=this,r=this.getProjection(),o=i.project.state.initextent,n=i.project.state.extent,a=ol.extent.getWidth(n)/e,s=ol.extent.getHeight(n)/t,l=Math.max(a,s),c=ol.extent.getWidth(o)/e,u=ol.extent.getHeight(o)/t,p=Math.max(c,u);this.viewer=m.createViewer({id:this.target,view:{projection:r,center:ol.extent.getCenter(o),extent:n,maxResolution:l}}),this.config.background_color&&$("#"+this.target).css("background-color",this.config.background_color),$(this.viewer.map.getViewport()).prepend('<div id="map-spinner" style="position:absolute;right:0px;"></div>'),this.viewer.map.getInteractions().forEach(function(e){i._watchInteraction(e)}),this.viewer.map.getInteractions().on("add",function(e){i._watchInteraction(e.element)}),this.viewer.map.getInteractions().on("remove",function(e){}),this.viewer.map.getView().setResolution(p),this.viewer.map.on("moveend",function(e){i._setMapView()}),this._marker=new ol.Overlay({position:void 0,positioning:"center-center",element:document.getElementById("marker"),stopEvent:!1}),this.viewer.map.addOverlay(this._marker),this.emit("ready")},C._removeListeners=function(){this._setBaseLayerListenerKey&&this.project.un("setBaseLayer",this._setBaseLayerListenerKey)},C._removeEventsKeysToLayersStore=function(e){var t=this,i=e.getId();t._layersStoresEventKeys[i]&&_.forEach(t._layersStoresEventKeys[i],function(t){_.forEach(t,function(t,i){e.un(i,t)})})},C._setUpEventsKeysToLayersStore=function(e){var t=this,i=e.getId();if(!this._layersStoresEventKeys[i]){this._layersStoresEventKeys[i]=[];var r=e.onafter("setLayersVisible",function(i){var r=_.map(i,function(i){var r=e.getLayerById(i);return t.getMapLayerForLayer(r)});t.updateMapLayers(r)});this._layersStoresEventKeys[e.getId()].push({setLayersVisible:r})}},C._setupListeners=function(){this._setBaseLayerListenerKey=this.project.onafter("setBaseLayer",function(){self.updateMapLayers(self.mapBaseLayers)})},C._setupBaseLayers=function(){var t=this,i=t.getLayers({BASELAYER:!0});i.length&&(this.mapBaseLayers={},_.forEach(i,function(i){if(i.isWMS())var r={url:i.getWmsUrl(),id:i.state.id,tiled:i.state.tiled},o=new f(r);else switch(i.getServerType()){case"OSM":var n=e("core/map/layer/osmlayer"),o=new n({id:i.state.id});break;case"Bing":var a=e("core/map/layer/binglayer"),o=new a({id:i.state.id})}t.addMapLayer(o),t.registerListeners(o),o.addLayer(i),t.mapBaseLayers[i.getId()]=o}),_.forEach(_.values(this.mapBaseLayers).reverse(),function(e){t.viewer.map.addLayer(e.getOLLayer()),e.update(t.state)}))},C._setupLayers=function(){var e=this;this.viewer.removeLayers(),this._setupBaseLayers(),this._reset();var t=this.getLayers(),i=_.groupBy(t,function(e){return e.getMultiLayerId()});return _.forEach(i,function(t,i){var r,o="layer_"+i,n=t[0];1==t.length&&n.isCached()?(r=new g({id:o,projection:e.getProjection()}),e.addMapLayer(r),e.registerListeners(r),r.addLayer(n)):(r=new f({url:n.getWmsUrl(),id:o},e.layersExtraParams),e.addMapLayer(r),e.registerListeners(r),_.forEach(t.reverse(),function(e){r.addLayer(e)}))}),_.forEach(this.getMapLayers().reverse(),function(t){e.viewer.map.addLayer(t.getOLLayer()),t.update(e.state,e.layersExtraParams)}),this.mapLayers},C.getOverviewMapLayers=function(e){var t=e.getLayersStore().getLayers({VISIBLE:!0,GEOLAYER:!0,HIDDEN:!1}),i=_.groupBy(t,function(e){return e.getMultiLayerId()}),r=[];return _.forEach(i,function(t,i){var o="overview_layer_"+i,n=t[0].state.tiled,a={url:e.getWmsUrl(),id:o,tiled:n},s=new f(a);_.forEach(t.reverse(),function(e){s.addLayer(e)}),r.push(s.getOLLayer(!0))}),r.reverse()},C.updateMapLayers=function(e){var t=this;_.forEach(e,function(e){e.update(t.state,t.layersExtraParams)})},C.registerListeners=function(e){var t=this;e.on("loadstart",function(){t._incrementLoaders()}),e.on("loadend",function(){t._decrementLoaders(!1)}),this.on("extraParamsSet",function(t,i){i&&e.update(this.state,t)})},C.setTarget=function(e){this.target=e},C.addInteraction=function(e){this._unToggleControls(),this.viewer.map.addInteraction(e),e.setActive(!0)},C.removeInteraction=function(e){this.viewer.map.removeInteraction(e)},C._watchInteraction=function(e){var t=this;e.on("change:active",function(e){e.target instanceof ol.interaction.Pointer&&e.target.getActive()&&t.emit("pointerInteractionSet",e.target)})},C.goTo=function(e,t){var i={zoom:t||6};this.viewer.goTo(e,i)},C.goToRes=function(e,t){var i={resolution:t};this.viewer.goToRes(e,i)},C.goToBBox=function(e){this.viewer.fit(e)},C.goToWGS84=function(e,t){var e=ol.proj.transform(e,"EPSG:4326","EPSG:"+this.project.state.crs);this.goTo(e,t)},C.extentToWGS84=function(e){return ol.proj.transformExtent(e,"EPSG:"+this.project.state.crs,"EPSG:4326")},C.getResolutionForMeters=function(e){var t=this.viewer.map.getViewport();return e/Math.max(t.clientWidth,t.clientHeight)};var w=null,E=!1;C.highlightGeometry=function(e,t){var i=this;this.clearHighlightGeometry();var r,t=t||{},o="boolean"!=typeof t.zoom||t.zoom,n="boolean"!=typeof t.highlight||t.highlight,a=t.duration||2e3;this.viewer.map.getView();if(e instanceof ol.geom.Geometry)r=e;else{var s=new ol.format.GeoJSON;r=s.readGeometry(e)}t.fromWGS84&&r.transform("EPSG:4326","EPSG:"+ProjectService.state.project.crs);var l=r.getType();if(o)if("Point"==l||"MultiPoint"==l&&1==r.getPoints().length){var c="Point"==l?r.getCoordinates():r.getPoint(0).getCoordinates();if(4326!=this.project.state.crs&&3857!=this.project.state.crs){var u=this.getResolutionForMeters(100);i.goToRes(c,u)}else o=i.viewer.map.getView().getZoom()>6?i.viewer.map.getView().getZoom():6,i.goTo(c,o)}else this.viewer.fit(r,t);if(n){var p=new ol.Feature({geometry:r});w||(w=new ol.layer.Vector({source:new ol.source.Vector,style:function(e){var t=[],i=e.getGeometry().getType();if("LineString"==i||"MultiLineString"==i){var r=new ol.style.Style({stroke:new ol.style.Stroke({color:"rgb(255,255,0)",width:4})});t.push(r)}else if("Point"==i||"MultiPoint"==i){var r=new ol.style.Style({image:new ol.style.Circle({radius:6,fill:new ol.style.Fill({color:"rgb(255,255,0)"})}),zIndex:1/0});t.push(r)}else if("MultiPolygon"==i||"Polygon"==i){var r=new ol.style.Style({stroke:new ol.style.Stroke({color:"rgb(255,255,0)",width:4}),fill:new ol.style.Fill({color:"rgba(255, 255, 0, 0.5)"})});t.push(r)}return t}}),w.setMap(this.viewer.map)),w.getSource().clear(),w.getSource().addFeature(p),a&&(E=!0,setTimeout(function(){w.getSource().clear(),E=!1},a))}},C.clearHighlightGeometry=function(){w&&!E&&w.getSource().clear()},C.refreshMap=function(){_.forEach(this._mapLayers,function(e){e.getOLLayer().getSource().updateParams({time:Date.now()})})},C.layout=function(e,t){this.viewer||this.setupViewer(e,t),this.viewer&&(this.setHidden(0==e||0==t),this.getMap().updateSize(),this._setMapView())},C._reset=function(){this._mapLayers=[]},C._setMapView=function(){var e=this.viewer.getBBOX(),t=this.viewer.getResolution(),i=this.viewer.getCenter();this.setMapView(e,t,i)},C.getMapSize=function(){var e=this.viewer.map;return e.getSize()},C.setInnerGreyCoverScale=function(e){this._drawShadow.scale=e},C._resetDrawShadowInner=function(){this._drawShadow={type:"coordinate",outer:[],inner:[],scale:null,rotation:null}},C.setInnerGreyCoverBBox=function(e){var t,i,e=e||{},r=this.viewer.map,o=e.type||"coordinate",n=e.inner||null,a=e.rotation,s=e.scale;if(n){switch(o){case"coordinate":t=r.getPixelFromCoordinate([n[0],n[1]]),i=r.getPixelFromCoordinate([n[2],n[3]]);break;case"pixel":t=[n[0],n[1]],i=[n[2],n[3]]}var l=t[1]*ol.has.DEVICE_PIXEL_RATIO,c=t[0]*ol.has.DEVICE_PIXEL_RATIO,u=i[1]*ol.has.DEVICE_PIXEL_RATIO,p=i[0]*ol.has.DEVICE_PIXEL_RATIO;this._drawShadow.inner[0]=c,this._drawShadow.inner[1]=l,this._drawShadow.inner[2]=p,this._drawShadow.inner[3]=u}_.isNil(s)?this._drawShadow.scale=this._drawShadow.scale||1:this._drawShadow.scale=s,_.isNil(a)?this._drawShadow.rotation=this._drawShadow.rotation||0:this._drawShadow.rotation=a,this._drawShadow.outer&&r.render()},C.startDrawGreyCover=function(){function e(e){var l=e.context,c=this.getSize(),u=c[1]*ol.has.DEVICE_PIXEL_RATIO,p=c[0]*ol.has.DEVICE_PIXEL_RATIO;s._drawShadow.outer=[0,0,p,u],l.restore(),l.beginPath(),l.moveTo(0,0),l.lineTo(p,0),l.lineTo(p,u),l.lineTo(0,u),l.lineTo(0,0),l.closePath(),s._drawShadow.inner.length&&(l.save(),t=s._drawShadow.inner[0],r=s._drawShadow.inner[3],i=s._drawShadow.inner[2],o=s._drawShadow.inner[1],n=s._drawShadow.rotation,a=s._drawShadow.scale,l.translate((i+t)/2,(o+r)/2),l.rotate(n*Math.PI/180),l.moveTo(-((i-t)/2),(o-r)/2),l.lineTo((i-t)/2,(o-r)/2),l.lineTo((i-t)/2,-((o-r)/2)),l.lineTo(-((i-t)/2),-((o-r)/2)),l.lineTo(-((i-t)/2),(o-r)/2),l.closePath()),l.fillStyle="rgba(0, 5, 25, 0.40)",l.fill(),l.restore()}var t,i,r,o,n,a,s=this,l=this.viewer.map;this._greyListenerKey&&this.stopDrawGreyCover(),this._greyListenerKey=l.on("postcompose",e)},C.stopDrawGreyCover=function(){var e=this.viewer.map;ol.Observable.unByKey(this._greyListenerKey),this._greyListenerKey=null,this._drawShadow.inner.length&&this._resetDrawShadowInner(),e.render()},C.removeExternalLayer=function(e){var t=this.getLayerByName(e),i=s.getComponent("catalog").getService(),r=s.getComponent("queryresults").getService();r.unregisterVectorLayer(t),this.viewer.map.removeLayer(t),i.removeExternalLayer(e)},C.addExternalLayer=function(e){function t(t,i){r=t.readFeatures(i,{dataProjection:"EPSG:"+h,featureProjection:l.getEpsg()}),o=new ol.source.Vector({features:r}),n=new ol.layer.Vector({source:o,name:u}),n.setStyle(l.setExternalLayerColor(p)),a=n.getSource().getExtent(),e.bbox={minx:a[0],miny:a[1],maxx:a[2],maxy:a[3]},c.addLayer(n),g.registerVectorLayer(n),f.addExternalLayer(e),c.getView().fit(o.getExtent())}var i,r,o,n,a,l=this,c=this.viewer.map,u=e.name,p=e.color,d=e.type,h=e.crs,m=e.data,f=s.getComponent("catalog").getService(),g=s.getComponent("queryresults").getService(),y=this.getLayerByName(u);if(y)s.notify.info("Layer già aggiunto");else switch(h!=l.getCrs()&&l.defineProjection(h),d){case"geojson":i=new ol.format.GeoJSON,t(i,m);break;case"kml":i=new ol.format.KML({extractStyles:!1}),t(i,m);break;case"zip":var _;loadshp({url:m,encoding:"big5",EPSG:h},function(e){_||(_=e,h="4326",m=JSON.stringify(e),i=new ol.format.GeoJSON,t(i,m))})}},C.setExternalLayerColor=function(e){var e=e.rgba;e="rgba("+e.r+","+e.g+","+e.b+","+e.a+")";var t={Point:new ol.style.Style({image:new ol.style.Circle({fill:new ol.style.Fill({color:e}),radius:5,stroke:new ol.style.Stroke({color:e,width:1})})}),LineString:new ol.style.Style({stroke:new ol.style.Stroke({color:e,width:3})}),Polygon:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255,255,255,0.5)"}),stroke:new ol.style.Stroke({color:e,width:3})}),MultiPoint:new ol.style.Style({image:new ol.style.Circle({fill:new ol.style.Fill({color:e}),radius:5,stroke:new ol.style.Stroke({color:e,width:1})})}),MultiLineString:new ol.style.Style({stroke:new ol.style.Stroke({color:e,width:3})}),MultiPolygon:new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255,255,255,0.5)"}),stroke:new ol.style.Stroke({color:e,width:3})})},i=function(e,i){var r=e.getStyleFunction();return r?r.call(e,i):t[e.getGeometry().getType()]};return i},t.exports=r},{"core/applicationservice":22,"core/g3wobject":36,"core/layers/filter/filter":43,"core/layers/layer":46,"core/layers/layersstore":48,"core/layers/providers/wfsprovider":55,"core/map/layer/binglayer":60,"core/map/layer/osmlayer":64,"core/map/layer/wmslayer":66,"core/map/layer/xyzlayer":67,"core/map/maplayersstoresregistry":68,"core/project/projectsregistry":76,"core/utils/utils":80,"g3w-ol3/src/g3w.ol3":98,"gui/gui":135,"gui/map/control/factory":138,"gui/map/control/registry":139,"gui/streetview/streetviewservice":167}],141:[function(e,t,i){t.exports='<!-- Modal -->\n<div class="modal fade" id="modal-addlayer" role="dialog">\n  <div class="modal-dialog">\n    <!-- Modal content-->\n    <div class="modal-content">\n      <div class="modal-header">\n        <button type="button" class="close" data-dismiss="modal">&times;</button>\n        <h4 class="modal-title">Aggiungi Layer</h4>\n      </div>\n      <div class="modal-body">\n        <div class="form-group">\n          <label for="proiezione-layer">Seleziona il sistema di proiezione del layer</label>\n          <select class="form-control" id="proiezione-layer" v-model="layer.crs">\n            <option value="3003">EPSG:3003</option>\n            <option value="3857">EPSG:3857</option>\n            <option value="4326">EPSG:4326</option>\n          </select>\n        </div>\n        <p style="font-weight: 700;">Seleziona il colore del layer</p>\n        <chrome-picker v-model="layer.color" @change-color="onChangeColor" style="width:90%;margin:auto"></chrome-picker>\n        <form id="addcustomlayer">\n          <input type="file" title=" " @change="onAddLayer($event)" accept=".kml,.geojson, .KML, .GEOJSON, .zip">\n          <h4>Trascina qui il file o clicca sull\'area</h4>\n          <h4 v-if="layer.name">{{ layer.name }}</h4>\n          <div>\n            <i class="fa fa-cloud-upload fa-5x" aria-hidden="true"></i>\n          </div>\n          <p>.geojson, .kml, .zip(shapefile)</p>\n        </form>\n      </div>\n      <div class="modal-footer">\n        <button type="button" class="btn btn-default pull-left" @click="addLayer" data-dismiss="modal">Aggiungi</button>\n        <button type="button" class="btn btn-default" data-dismiss="modal" @click="clearLayer">Chiudi</button>\n      </div>\n    </div>\n  </div>\n</div>'},{}],142:[function(e,t,i){t.exports='<div :id="target" style="width:100%;height:100%">\n  <div style="display: none;">\n    <div id="marker"></div>\n  </div>\n  <addlayer :service="service"></addlayer>\n</div>\n\n\n'},{}],143:[function(e,t,i){function r(e){n(this,e),this.id="map-component",this.title="Catalogo dati",this.target=e.target||"map",this.setService(new l(e)),a(this,e),this.internalComponent=new d({mapService:this._service}),this.internalComponent.target=this.target}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/utils/utils").merge,s=e("gui/vue/component"),l=e("../mapservice"),c=VueColor.Chrome;c.mounted=function(){this.$nextTick(function(){$(".vue-color__chrome__toggle-btn").remove(),$(".vue-color__editable-input__label").remove(),$(".vue-color__chrome__saturation-wrap").css("padding-bottom","100px"),$(".vue-color__chrome").css({"box-shadow":"0 0 0 0",border:"1px solid #97A1A8"})})};var u={template:e("./addlayer.html"),props:["service"],data:function(){return{layer:{name:null,type:null,crs:null,color:{hex:"#194d33",rgba:{r:25,g:77,b:51,a:1},a:1},data:null,visible:!0,title:null,id:null,external:!0}}},components:{"chrome-picker":c},mounted:function(){this.layer.crs=this.service.getCrs(),this.service.on("addexternallayer",function(){$("#modal-addlayer").modal("show")})},methods:{onChangeColor:function(e){this.layer.color=e},onAddLayer:function(e){var t=this,i=new FileReader,r=e.target.files[0].name;this.layer.name=r,this.layer.title=r,this.layer.id=r;var o=e.target.files[0].name.split(".");this.layer.type=o[o.length-1].toLowerCase(),"zip"==this.layer.type?(t.layer.data=e.target.files[0],$("input:file").val(null)):(i.onload=function(e){t.layer.data=e.target.result,$("input:file").val(null)},i.readAsText(e.target.files[0]))},addLayer:function(){if(this.layer.name){var e=_.cloneDeep(this.layer);this.service.addExternalLayer(e),$("#modal-addlayer").modal("hide"),this.clearLayer()}},clearLayer:function(){this.layer.name=null,this.layer.title=null,this.layer.id=null,this.layer.type=null,this.layer.crs=this.service.getCrs(),this.layer.color={hex:"#194d33",rgba:{r:25,g:77,b:51,a:1},a:1},this.layer.data=null}}},p={template:e("./map.html"),data:function(){return{target:"map",service:this.$options.mapService}},components:{addlayer:u},mounted:function(){var e=this,t=this.$options.mapService;this.crs=t.getCrs(),this.$nextTick(function(){t.setTarget(e.$el.id)}),t.onafter("setupViewer",function(){t.setTarget(e.$el.id)})}},d=Vue.extend(p);Vue.component("g3w-map",p),o(r,s);var h=r.prototype;
h.layout=function(e,t){$("#"+this.target).height(t),$("#"+this.target).width(e),this._service.layout(e,t)},t.exports=r},{"../mapservice":140,"./addlayer.html":141,"./map.html":142,"core/utils/utils":80,"gui/vue/component":173}],144:[function(e,t,i){var r=e("core/utils/utils").inherit,o=e("core/utils/utils").resolve,n=e("core/g3wobject"),a=function(e){this.internalPanel=null;var e=e||{};this.id=e.id||null,this.title=e.title||""};r(a,n);var s=a.prototype;s.getId=function(){return this.id},s.getTitle=function(){return this.title},s.getInternalPanel=function(){return this.internalPanel},s.setInternalPanel=function(e){this.internalPanel=e},s.mount=function(e){var t=this.internalPanel,i=t.$mount();return $(e).append(i.$el),i.$nextTick(function(){$(e).localize(),t.onShow&&t.onShow()}),o(!0)},s.unmount=function(){var e=this.internalPanel,t=$.Deferred();return e.$destroy(!0),$(e.$el).remove(),e.onClose&&e.onClose(),this.internalComponent=null,t.resolve(),t.promise()},s.onResize=function(e,t){},t.exports=a},{"core/g3wobject":36,"core/utils/utils":80}],145:[function(e,t,i){var r=[{value:500,label:"1:500"},{value:1e3,label:"1:1.000"},{value:2e3,label:"1:2.000"},{value:2500,label:"1:2.500"},{value:5e3,label:"1:5.000"},{value:1e4,label:"1:10.000"},{value:25e3,label:"1:25.000"},{value:5e4,label:"1:50.000"},{value:1e5,label:"1:100.000"},{value:25e4,label:"1:250.000"},{value:5e5,label:"1:500.000"},{value:1e6,label:"1:1.000.000"}],o=[150,300];t.exports={scale:r,dpis:o}},{}],146:[function(e,t,i){function r(){n(this),this._initialized=!1,this.state={},this._moveMapKeyEvent=null,this._page=null,this._mapService=null,this._map=null,this._isOpen=!1,this._scalesResolutions={},this.init=function(){this._project=l.getCurrentProject(),this.state.print=this._project.state.print,this.state.visible=!(!this.state.print||!this.state.print.length),this.state.isShow=!1,this.state.loading=!1,this.state.url=null,this.state.visible&&(this.state.template=this.state.print[0].name,this.state.rotation=0,this.state.inner=null,this.state.center=null,this.state.size=null,this.state.scale=m,this.state.scala=null,this.state.dpis=f,this.state.dpi=f[0],this.state.map=null,this.state.width=null,this.state.height=null)},this.changeTemplate=function(){var e=this;if(this.state.template){var t=this.state.template;_.forEach(this.state.print,function(i){i.name==t&&(e.state.width=i.maps[0].w,e.state.height=i.maps[0].h,e.state.map=i.maps[0].name)}),this._setPrintArea()}},this.changeScale=function(){this.state.scala&&this._setPrintArea()},this.changeRotation=function(){this._mapService.setInnerGreyCoverBBox({rotation:this.state.rotation}),this._changePrintOutput()},this._getOptionsPrint=function(){var e={scale:this.state.scala,extent:this.state.inner.join(),rotation:this.state.rotation,dpi:this.state.dpi,template:this.state.template,map:this.state.map};return e},this.print=function(){var e=this;this._page=new h({service:e});var t=this._getOptionsPrint();a.setContent({content:e._page,title:"Stampa",perc:100}),c.print(t).then(function(t,i,r){e.state.url=this.url}).fail(function(){a.notify.error("Si è verificato un errore nella richiesta al server"),a.closeContent()})},this._calculateInternalPrintExtent=function(e){var t,i,r=this.state.width/this.state.height,o=this.state.size[0]/this.state.size[1];o>1?r>1?(t=r>o?this.state.size[0]/2:this.state.size[0]*(r/o)/2,t-=parseInt(t/10),i=t/r):(i=this.state.size[1]/2,i-=parseInt(i/10),t=i*r):r>1?(t=this.state.size[0]/2,t-=parseInt(t/10),i=t/r):(i=r<o?this.state.size[1]/2:this.state.size[1]*(o/r)/2,i-=parseInt(i/10),t=i*r),x_min=this.state.center[0]-t*e,x_max=this.state.center[0]+t*e,y_min=this.state.center[1]-i*e,y_max=this.state.center[1]+i*e,this.state.inner=[x_min,y_min,x_max,y_max]},this._setPrintArea=function(){this.state.size=this._map.getSize(),this.state.currentScala=u(this._map.getView().getResolution()),this.state.center=this._map.getView().getCenter();var e=p(this.state.scala);this._calculateInternalPrintExtent(e),this._mapService.setInnerGreyCoverBBox({inner:this.state.inner,rotation:this.state.rotation})},this._clearPrint=function(){ol.Observable.unByKey(this._moveMapKeyEvent),this._moveMapKeyEvent=null,this._mapService.stopDrawGreyCover()},this._changePrintOutput=function(){var e=this;if(this.state.isShow){this.state.loading=!0;var t=this._getOptionsPrint();c.print(t).then(function(t){e.state.url==t&&(e.state.loading=!1),e.state.url=t})}},this._setAllScalesBasedOnMaxResolution=function(e){var t=this,i=e,r=u(i),o=_.orderBy(this.state.scale,["value"],["desc"]),n=[];_.forEach(o,function(e){r>e.value&&(n.push(e),i=p(e.value),t._scalesResolutions[e.value]=i,i/=2)}),this.state.scale=_.orderBy(n,["value"],["asc"])},this._setInitialScalaSelect=function(){var e=this,t=this._map.getView().getResolution(),i=u(t),r=!1;_.forEach(this.state.scale,function(t,o){if(i<t.value&&!e.state.scala){var n=o?o-1:o;return e.state.scala=e.state.scale[n].value,$("#scala").val(e.state.scala),r=!0,!1}}),r||(this.state.scala=this.state.scale[this.state.scale.length-1].value)},this._setCurrentScala=function(e){var t=this;_.forEach(this._scalesResolutions,function(i,r){if(i==e)return t.state.scala=r,!1})},this._setMoveendMapEvent=function(){var e=this;this._moveMapKeyEvent=this._map.on("moveend",function(){e._setPrintArea()})},this._showPrintArea=function(){this._setPrintArea(),this._mapService.startDrawGreyCover()},this._initPrintConfig=function(){var e;if(this._initialized)e=this._map.getView().getResolution(),this._setCurrentScala(e);else{var t=this._map.getView().getMaxResolution();this._setAllScalesBasedOnMaxResolution(t),this._setInitialScalaSelect(),this._initialized=!0}},this._setMapInfo=function(){var e=this;_.forEach(this.state.print[0].maps,function(t){if("map0"==t.name)return e.state.map=t.name,e.state.width=t.w,e.state.height=t.h,!1})},this.showPrintArea=function(e){this._mapService=a.getComponent("map").getService(),this._map=this._mapService.viewer.map,e?(this._setMapInfo(),this._setMoveendMapEvent(),this._initPrintConfig(),this._showPrintArea()):this._clearPrint()},this.reload=function(){var e=this;this._project=l.getCurrentProject(),this._mapService=a.getComponent("map").getService(),this._map=this._mapService.viewer.map,this.state.print=this._project.state.print,this.state.visible=!(!this.state.print||!this.state.print.length),this.state.visible?(this.state.template=this.state.print[0].name,this._initialized||this.init(),this._initPrintConfig(),this._mapService.on("changeviewaftercurrentproject",function(){var t=e._map.getView().getMaxResolution();e.state.scale=m,e._setAllScalesBasedOnMaxResolution(t)})):this._clearPrint()}}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("gui/gui"),s=e("core/g3wobject"),l=e("core/project/projectsregistry"),c=e("core/print/printservice"),u=e("core/utils/geo").resToScale,p=e("core/utils/geo").scaleToRes,d=e("./printconfig"),h=e("./vue/printpage"),m=d.scale,f=d.dpis;o(r,s),t.exports=r},{"./printconfig":145,"./vue/printpage":150,"core/g3wobject":36,"core/print/printservice":72,"core/project/projectsregistry":76,"core/utils/geo":79,"core/utils/utils":80,"gui/gui":135}],147:[function(e,t,i){t.exports='<ul id="print" class="treeview-menu">\n  <li>\n    <form id="g3w-search-form" class="form-horizonal">\n      <div class="box-body">\n        <label for="templates">Template</label>\n        <select class="form-control" @change="onChangeTemplate" v-model="state.template" id="templates" placeholder="Seleziona il template">\n          <option v-for="print in state.print">{{ print.name }}</option>\n        </select>\n        <label for="scala">Scala</label>\n        <select class="form-control" @change="onChangeScale" v-model="state.scala" id="scala" placeholder="Seleziona la scala">\n          <option v-for="scala in state.scale" :value="scala.value">{{ scala.label }}</option>\n        </select>\n        <label for="dpi">dpi</label>\n        <select class="form-control" @change="onChangeDpi"  v-model="state.dpi" id="dpi" placeholder="Seleziona i dpi">\n          <option v-for="dpi in state.dpis" >{{ dpi }}</option>\n        </select>\n        <label for="rotation">Rotazione</label>\n        <input min="-360" max="360"  @input="onChangeRotation" v-model="state.rotation" id="rotation" class="form-control" type="number">\n      </div>\n      <div class="box-footer" style="background-color: transparent">\n        <span>\n          <button style="width:100%; background-color: #3c8dbc" class="btn " @click.stop.prevent="exec(button.cbk)" v-disabled="btnEnabled(button)">{{ button.title }}</button>\n        </span>\n      </div>\n    </form>\n    <div id="message" style="text-align:center; padding:3px; color: yellow" class="message" v-show="btnEnabled(button)">\n      <div>\n        <span>Muovendoti all\'interno della mappa</span>\n      </div>\n      <div>\n        <span>o cambiando i parametri della stampa</span>\n      </div>\n      <div>\n        <span>il PDF si aggiornerà automaticamente</span>\n      </div>\n    </div>\n  </li>\n</ul>\n'},{}],148:[function(e,t,i){function r(e){s(this,e),this.title="print",this.vueComponent=c,this.internalComponent=null;var t=e.service||new a;this.setService(t),this._service.init(),this.setInternalComponent=function(){var e=Vue.extend(this.vueComponent);return this.internalComponent=new e({service:t}),this.state.visible=t.state.visible,this.internalComponent.state=t.state,this.internalComponent},this._reload=function(){var e=this.getService();e.reload(),this.state.visible=e.state.visible},this._setOpen=function(){this._service.showPrintArea(this.state.open)},l(this,e)}var o=e("core/utils/utils").inherit,n=e("gui/vue/component"),a=e("gui/print/printservice"),s=e("core/utils/utils").base,l=e("core/utils/utils").merge,c={template:e("./print.html"),data:function(){var e=this;return{state:null,button:{title:"Crea PDF","class":"btn-success",type:"stampa",disabled:!1,cbk:function(){e.print()}}}},methods:{exec:function(e){e()},btnEnabled:function(e){return e.disabled},isAnnullaButton:function(e){return"annulla"==e},onChangeTemplate:function(){this.$options.service.changeTemplate()},onChangeScale:function(){this.$options.service.changeScale()},onChangeDpi:function(){},onChangeRotation:function(e){this.state.rotation>=0&&!_.isNil(this.state.rotation)&&""!=this.state.rotation?(this.state.rotation=this.state.rotation>360?360:this.state.rotation,e.target.value=this.state.rotation):this.state.rotation<0?(this.state.rotation=this.state.rotation<-360?-360:this.state.rotation,e.target.value=this.state.rotation):this.state.rotation=0,this.$options.service.changeRotation()},print:function(){this.$options.service.print()}}};o(r,n),t.exports=r},{"./print.html":147,"core/utils/utils":80,"gui/print/printservice":146,"gui/vue/component":173}],149:[function(e,t,i){t.exports='<div id="pdf-output" style="height:100%">\n  <div v-show="state.loading" class="bar-loader"></div>\n  <iframe id="pdf" style="border:0px;width:100%;height:100%" :src="state.url"></iframe>\n</div>'},{}],150:[function(e,t,i){var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,n=e("gui/vue/component"),a=Vue.extend({template:e("./printpage.html"),data:function(){return{state:null}},mounted:function(){var e=this;this.state.loading=!0,this.$nextTick(function(){$("#pdf").load(function(){e.state.loading=!1})})}}),s=function(e){o(this);var e=e||{},t=e.service;this.setService(t);var i=new a;this.setInternalComponent(i),this.internalComponent.state=t.state};r(s,n),t.exports=s},{"./printpage.html":149,"core/utils/utils":80,"gui/vue/component":173}],151:[function(e,t,i){function r(e){this.state={},n(this)}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/g3wobject");o(r,a),t.exports=r},{"core/g3wobject":36,"core/utils/utils":80}],152:[function(e,t,i){t.exports='<div id="photo" style="margin: 10px;">\n  <img :src="url" style="width: 100%;">\n</div>'},{}],153:[function(e,t,i){var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,n=e("gui/vue/component"),a=e("../photoservice"),s=Vue.extend({template:e("./photo.html"),data:function(){return{state:null,url:this.$options.url}}}),l=function(e){o(this);var e=e||{},t=e.service||new a({}),i=e.url||null;this.setService(t);var r=new s({service:t,url:i});this.setInternalComponent(r),this.internalComponent.state=t.state};r(l,n),t.exports=l},{"../photoservice":151,"./photo.html":152,"core/utils/utils":80,"gui/vue/component":173}],154:[function(e,t,i){function r(e){this.state={},this._project=a.getCurrentProject(),n(this),this.getRelations=function(e){var t=this._project.state.id;e=e||{};var i=e.value||null,r=e.id||null;return $.get("/qdjango/api/relations/"+t+"/"+r+"/"+i)},this.buildRelationTable=function(e){var t=_.keys(e[0]),i=[];return _.forEach(e,function(e){i.push(_.values(e))}),{columns:t,rows:i}}}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/project/projectsregistry"),s=e("core/g3wobject");e("gui/gui");o(r,s),t.exports=r},{"core/g3wobject":36,"core/project/projectsregistry":76,"core/utils/utils":80,"gui/gui":135}],155:[function(e,t,i){t.exports='<div class="query-relation">\n  <div class="back-btn" @click="back">\n    <span class="back-link">\n      <span class="glyphicon glyphicon-chevron-left"></span>\n      Ritorna alle Relazioni\n    </span>\n  </div>\n  <div class="header">\n    <div>\n      Dati relativi alla relazione <b>{{ relation.name }}</b>\n    </div>\n  </div>\n  <div class="nano" v-if="table.rows.length">\n    <div class="nano-content">\n      <table class="table table-striped">\n        <thead>\n          <tr>\n            <th v-for="column in table.columns">{{ column }}</th>\n          </tr>\n        </thead>\n        <tbody>\n          <tr v-for="row in table.rows">\n            <td v-for="value in row">{{ value }}</td>\n          </tr>\n        </tbody>\n        </table>\n    </div>\n  </div>\n  <div v-else> Non ci sono relazioni </div>\n\n</div>\n'},{}],156:[function(e,t,i){t.exports='<div class="query-relations">\n  <div class="header">\n    <div>Elenco Relazioni della feature <span v-for="info in featureInfo()"><b>{{ info.key }}</b>: {{ info.value }} </span></div>\n  </div>\n  <div class="nano">\n    <div class="nano-content">\n      <table class="table table-bordered table-hover">\n        <thead>\n        </thead>\n        <tbody>\n          <tr @click="showRelation(relation)" v-for="relation in relations" style="cursor:pointer">\n            <td>\n              <span >{{ relation.name }}</span>\n              <span class="glyphicon glyphicon-chevron-right pull-right" aria-hidden="true"></span>\n            </td>\n          </tr>\n        </tbody>\n      </table>\n    </div>\n  </div>\n</div>\n'},{}],157:[function(e,t,i){t.exports='<div class="query-relations-page">\n    <component\n        :is="currentview"\n        :relations="relations"\n        :relation="relation"\n        :feature="feature"\n        :table="table">\n    </component>\n</div>'},{}],158:[function(e,t,i){var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,n=e("gui/vue/component"),a=e("../relationsservice"),s={template:e("./relations.html"),props:["relations","feature"],methods:{showRelation:function(e){this.$parent.showRelation(e)},featureInfo:function(){var e=[],t=0;return _.forEach(this.feature.attributes,function(i,r){return!(t>2)&&void(i&&_.isString(i)&&i.indexOf("/")==-1&&(e.push({key:r,value:i}),t+=1))}),e}}},l={template:e("./relation.html"),props:["table","relation"],methods:{back:function(){this.$parent.setRelationsList()}}},c=Vue.extend({template:e("./relationspage.html"),data:function(){return{state:null,table:null,relation:null,relations:this.$options.relations,feature:this.$options.feature,currentview:"relations"}},components:{relations:s,relation:l},methods:{showRelation:function(e){var t=this;this.relation=e;var i=e.fieldRef.referencedField,r=this.feature.attributes[i];this.$options.service.getRelations({id:e.id,value:r}).then(function(e){t.table=t.$options.service.buildRelationTable(e),t.currentview="relation",Vue.nextTick(function(){$(".nano").nanoScroller()})})},setRelationsList:function(){this.currentview="relations"}}}),u=function(e){o(this);var e=e||{},t=e.service||new a({}),i=e.relations||[],r=e.feature||null;this.setService(t);var n=new c({service:t,relations:i,feature:r});this.setInternalComponent(n),n.state=t.state};r(u,n),t.exports=u},{"../relationsservice":154,"./relation.html":155,"./relations.html":156,"./relationspage.html":157,"core/utils/utils":80,"gui/vue/component":173}],159:[function(e,t,i){function r(){var e=this;this._relations=a.getCurrentProject().state.relations?_.groupBy(a.getCurrentProject().state.relations,"referencedLayer"):null,this._actions={zoomto:r.zoomToElement,highlightgeometry:r.highlightGeometry,clearHighlightGeometry:r.clearHighlightGeometry},this.state={},this.init=function(e){this.clearState()},this._vectorLayers=[],this.setters={setQueryResponse:function(e,t,i){this.clearState(),this.state.query=e.query;var r=this._digestFeaturesForLayers(e.data);this.setLayersData(r)},setLayersData:function(e){this.state.loading=!1,this.state.layers=e,this.setActionsForLayers(e)},addActionsForLayers:function(e){},postRender:function(e){}},this.clearState=function(){this.state.layers=[],this.state.query={},this.state.querytitle="",this.state.loading=!0,this.state.layersactions={}},this.getState=function(){return this.state},this.setState=function(e){this.state=e},this.setTitle=function(e){this.state.querytitle=e||""},this.reset=function(){this.clearState()},this._digestFeaturesForLayers=function(e){var t,i,r,o,n=this,a=0,l=[];return _.forEach(e,function(e){e=e[0];var c=e.layer;c instanceof s?(t=c.getAttributes(),i=c.getRelationsAttributes(),r=c.getTitle(),o=c.getId()):c instanceof ol.layer.Vector&&(t=c.getProperties(),i=[],r=c.get("name"),o=c.get("id"));var u={title:r,id:o,attributes:[],features:[],hasgeometry:!1,show:!0,expandable:!0,hasImageField:!1,relationsattributes:i,error:""};e.features&&e.features.length?(u.attributes=n._parseAttributes(t,e.features[0].getProperties()),_.forEach(u.attributes,function(e){"image"==e.type&&(u.hasImageField=!0)}),_.forEach(e.features,function(e){var t=e.getId()?e.getId():a,i=e.getGeometry();i&&(u.hasgeometry=!0);var r={id:t,attributes:e.getProperties(),geometry:e.getGeometry(),show:!0};u.features.push(r),a+=1}),l.push(u)):e.error&&(u.error=e.error,console.log(e.error))}),l},this._parseAttributes=function(e,t){var i=_.keys(t);if(i=_.filter(i,function(e){return["boundedBy","geom","the_geom","geometry","bbox","GEOMETRY"].indexOf(e)==-1}),e&&e.length){var i=_.keys(t);return _.filter(e,function(e){return i.indexOf(e.name)>-1})}return _.map(i,function(e){return{name:e,label:e}})},this.setActionsForLayers=function(e){var t=this;_.forEach(e,function(e){t.state.layersactions[e.id]||(t.state.layersactions[e.id]=[]),e.hasgeometry&&t.state.layersactions[e.id].push({id:"gotogeometry","class":"glyphicon glyphicon-map-marker",hint:"Visualizza sulla mappa",cbk:r.goToGeometry}),t._relations&&_.forEach(t._relations,function(i,o){return e.id==o&&t.state.layersactions[e.id].push({id:"show-query-relations","class":"fa fa-sitemap",hint:"Visualizza Relazioni",cbk:r.showQueryRelations,relations:i}),!1})}),this.addActionsForLayers(t.state.layersactions)},this.trigger=function(t,i,r){var o=this._actions[t];if(o&&o(i,r),i){var n=e.state.layersactions[i.id];if(n){var a;_.forEach(n,function(e){e.id==t&&(a=e)}),a&&this.triggerLayerAction(a,i,r)}}},this.triggerLayerAction=function(e,t,i){if(e.cbk&&e.cbk(t,i,e),e.route){var r,o=e.route;r=o.replace(/{(\w*)}/g,function(e,t){return i.attributes.hasOwnProperty(t)?i.attributes[t]:""}),r&&""!=r&&l["goto"](r)}},this.showFullPhoto=function(e){l.pushContent({content:new h({url:e}),backonclose:!0,closable:!1})},this.registerVectorLayer=function(e){this._vectorLayers.indexOf(e)==-1&&(e.state={},e.state.title=e.name,e.state.id=e.id,this._vectorLayers.push(e))},this.unregisterVectorLayer=function(e){var t=this._vectorLayers.indexOf(e);t!=-1&&this._vectorLayers.splice(t,1)},this._addVectorLayersDataToQueryResponse=function(){var e=this;this.onbefore("setQueryResponse",function(t,i,r){var o=p.getComponent("map").getService(),n=!1;_.forEach(e._vectorLayers,function(e){var r,a,s=[];switch(e.constructor){case u:n=!e.isVisible();break;case ol.layer.Vector:n=!e.getVisible()}if(t.data&&t.data.length&&t.data[0].layer==e||!i||n)return!0;if(_.isArray(i)){if(2==i.length){var l=o.viewer.map.getPixelFromCoordinate(i);r=o.viewer.map.forEachFeatureAtPixel(l,function(e,t){return e},{layerFilter:function(t){return t===e}}),r&&(d.convertG3wRelations(r),s.push(r))}else if(4==i.length)switch(a=ol.geom.Polygon.fromExtent(i),e.constructor){case u:s=e.getIntersectedFeatures(a);break;case ol.layer.Vector:_.forEach(e.getSource().getFeatures(),function(e){a.intersectsExtent(e.getGeometry().getExtent())&&s.push(e)})}}else if(i instanceof ol.geom.Polygon||i instanceof ol.geom.MultiPolygon)switch(a=i,e.constructor){case u:s=e.getIntersectedFeatures(a);break;case ol.layer.Vector:_.forEach(e.getSource().getFeatures(),function(e){a.intersectsExtent(e.getGeometry().getExtent())&&s.push(e)})}_.forEach(s,function(e){d.convertG3wRelations(e)}),t.data=t.data?t.data:[],t.data.push({features:s,layer:e})})})},n(this),this._addVectorLayersDataToQueryResponse()}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/project/projectsregistry"),s=e("core/layers/layer"),l=e("gui/gui"),c=e("core/g3wobject"),u=e("core/map/layer/vectorlayer"),p=e("gui/componentsregistry"),d=e("core/query/queryservice"),h=e("./components/photo/vue/photo"),m=e("./components/relations/vue/relationspage");r.zoomToElement=function(e,t){},r.goToGeometry=function(e,t){if(t.geometry){var i=p.getComponent("map").getService();i.highlightGeometry(t.geometry,{duration:4e3})}},r.highlightGeometry=function(e,t){if(t.geometry){var i=p.getComponent("map").getService();i.highlightGeometry(t.geometry,{zoom:!1})}},r.clearHighlightGeometry=function(e,t){var i=p.getComponent("map").getService();i.clearHighlightGeometry()},r.showQueryRelations=function(e,t,i){l.pushContent({content:new m({relations:i.relations,feature:t}),backonclose:!0,closable:!1})},o(r,c),t.exports=r},{"./components/photo/vue/photo":153,"./components/relations/vue/relationspage":158,"core/g3wobject":36,"core/layers/layer":46,"core/map/layer/vectorlayer":65,"core/project/projectsregistry":76,"core/query/queryservice":77,"core/utils/utils":80,"gui/componentsregistry":119,"gui/gui":135}],160:[function(e,t,i){t.exports='<div id="search-results" class="queryresults-wrapper">\n  <h3 v-if="state.querytitle">Risultati {{state.querytitle.toLowerCase()}}</h3>\n  <div v-show="state.loading" class="bar-loader"></div>\n  <div class="queryresults-container">\n    <ul v-if="hasResults()" class="queryresults" id="queryresults">\n      <li v-if="layerHasFeatures(layer) && layer.show" v-for="layer in state.layers">\n        <div class="box box-primary">\n          <div class="box-header with-border" data-widget="collapse">\n            <h3 class="box-title">{{ layer.title }} ({{layer.features.length}})</h3>\n            <div class="box-tools pull-right">\n              <button class="btn btn-box-tool" data-widget="collapse"><i class="btn-collapser fa fa-minus"></i></button>\n            </div>\n          </div>\n          <div class="box-body">\n            <table class="table table-striped">\n              <thead>\n              <tr>\n                <th v-if="layer.hasgeometry"></th>\n                <th v-for="(attribute, index) in attributesSubset(layer.attributes)" :style="{ width:cellWidth(index,layer) + \'%\' }">{{attribute.label}}</th>\n                <th :style="{ width:headerExpandActionCellWidth + \'%\' }"></th>\n              </tr>\n              </thead>\n              <tbody>\n              <template v-if="feature.show" v-for="feature in layer.features">\n                <tr @click="toggleFeatureBoxAndZoom(layer,feature);" @mouseover="trigger(\'highlightgeometry\',layer,feature)" @mouseout="trigger(\'clearHighlightGeometry\')" class="featurebox-header">\n                  <td v-if="geometryAvailable(feature)" class="action-cell">\n                    <span @click.stop.prevent="trigger(\'gotogeometry\',layer,feature)" class="glyphicon glyphicon-map-marker action-button-icon"></span>\n                  </td>\n                  <td v-for="attribute in attributesSubset(layer.attributes)">\n                    <span>{{feature.attributes[attribute.name]}}</span>\n                  </td>\n                  <td class="action-cell">\n                    <span class="fa link morelink" :class="[collapsedFeatureBox(layer,feature) ? \'fa-plus\' : \'fa-minus\']"></span>\n                  </td>\n                </tr>\n                <tr v-show="!collapsedFeatureBox(layer,feature)" class="featurebox-body">\n                  <td :colspan="attributesSubsetLength(layer.attributes)+2">\n                    <div class="action-buttons-container">\n                      <template v-for="action in state.layersactions[layer.id]">\n                        <div @click="trigger(action.id,layer,feature)"  class="action-button hint--top-right" data-placement="auto bottom" data-toggle="tooltip" :title="action.hint">\n                          <span :class="\'action-button-icon \' + action.class"></span>\n                        </div>\n                      </template>\n                    </div>\n                    <table>\n                      <tr v-for="attribute in layer.attributes">\n                        <td class="attr-label">{{attribute.label}}</td>\n                        <!--<td class="attr-value">{{feature.attributes[attribute.name]}}</td>-->\n                        <td class="attr-value">\n                          <span v-if="is(\'simple\',layer,attribute.name,feature.attributes[attribute.name])">{{feature.attributes[attribute.name]}}</span>\n                          <img v-if="is(\'photo\',layer,attribute.name,feature.attributes[attribute.name])"  class="photo-preview img-responsive img-thumbnail" title="Clicca per allargare"  @click="showFullPhoto(isRelativePath(feature.attributes[attribute.name]))" :src="isRelativePath(feature.attributes[attribute.name])">\n                          <!--<span v-if="isRoute(layer,feature,attribute)" class="link dashboardlink" @click="goto(layer,feature.attributes[attribute.name])">{{ feature.attributes[attribute.name] }}</span>-->\n                          <!--<img v-if="isPhoto(layer,feature,attribute)" :data-url="getPhotoUrl(feature.attributes[attribute.name])" style="max-width:50px" :src="getPhotoUrl(feature.attributes[attribute.name],thumb)" />-->\n                          <img v-else-if="checkField(\'image\', attribute.label, layer.attributes)"  class="photo-preview img-responsive img-thumbnail" title="Clicca per allargare"  @click="showFullPhoto(isRelativePath(attribute.value))" :src="isRelativePath(attribute.value)">\n                          <a v-if="is(\'link\',layer,attribute.name,feature.attributes[attribute.name])" :href="feature.attributes[attribute.name]" target="_blank" class="glyphicon glyphicon-link"></a>\n                        </td>\n                      </tr>\n                    </table>\n                  </td>\n                </tr>\n                <tr v-show="collapsedFeatureBox(layer,feature) && feature.attributes.relations">\n                  <td :colspan="attributesSubsetLength(layer.attributes)+2">\n                    <!--Relazioni-->\n                    <div class="queryresults-container">\n                      <ul class="queryresults" id="relations">\n                        <template v-for="relation in feature.attributes.relations">\n                          <li>\n                            <div class="box box-solid box-default relationsbox collapsed-box">\n                              <div class="box-header with-border" data-widget="collapse">\n                                <h3 class="box-title">{{ relation.name }} ({{ relation.elements.length }})</h3>\n                                <div class="box-tools pull-right">\n                                  <button class="btn btn-box-tool" data-widget="collapse"><i class="btn-collapser fa fa-plus"></i></button>\n                                </div>\n                              </div>\n                              <div class="box-body">\n                                <template v-for="(element, index) in relation.elements">\n                                  <table class="table table-striped">\n                                    <thead>\n                                    <tr>\n                                      <th v-for="attribute in relationsAttributesSubset(element)">\n                                        {{attribute.label}}\n                                      </th>\n                                      <th></th>\n                                    </tr>\n                                    </thead>\n                                    <tbody>\n                                    <tr @click="toggleFeatureBox(layer, feature, relation.name+index)"  class="featurebox-header">\n                                      <td v-for="attribute in relationsAttributesSubset(element)">\n                                        <span>{{attribute.value}}</span>\n                                      </td>\n                                      <td class="action-cell text-center">\n                                        <span class="fa link morelink" :class="[collapsedFeatureBox(layer, feature, relation.name+index) ? \'fa-minus\' : \'fa-plus\']" style="text-align: right"></span>\n                                      </td>\n                                    </tr>\n                                    <tr v-show="collapsedFeatureBox(layer, feature, relation.name+index)" class="featurebox-body">\n                                      <td :colspan="relationsAttributesSubsetLength(element)+1">\n                                        <table>\n                                          <tr v-for="relattribute in relationsAttributes(element)">\n                                            <td class="attr-label">{{relattribute.label}}</td>\n                                            <!--<td class="attr-value">{{attribute.value}}</td>-->\n                                            <td class="attr-value">\n                                              <div v-if="isArray(relattribute.value)" v-for="value in relattribute.value">\n                                                <div v-for="value, label in value">\n                                                  <span>{{ label }}</span><span class="pull-right">{{ value }}</span>\n                                                </div>\n                                                <span class="divider"></span>\n                                              </div>\n                                              <span v-if="isSimple(layer,relattribute.name, relattribute.value)">{{relattribute.value}}</span>\n                                              <!--<img v-if="is(\'photo\',layer,relattribute.name,feature.attributes[attribute.name])"  class="photo-preview img-responsive img-thumbnail" title="Clicca per allargare"  @click="showFullPhoto(isRelativePath(feature.attributes[attribute.name]))" :src="isRelativePath(feature.attributes[attribute.name])">-->\n                                              <!--<img v-if="relattribute.label == \'image\'"  class="photo-preview img-responsive img-thumbnail" title="Clicca per allargare"  @click="showFullPhoto(isRelativePath(relattribute.value))" :src="isRelativePath(relattribute.value)">-->\n                                              <img v-else-if="checkField(\'image\', relattribute.label, layer.relationsattributes[relation.name])"  class="photo-preview img-responsive img-thumbnail" title="Clicca per allargare"  @click="showFullPhoto(isRelativePath(relattribute.value))" :src="isRelativePath(relattribute.value)">\n                                              <img v-else-if="is(\'photo\',layer, relattribute.name, relattribute.value)"  class="photo-preview img-responsive img-thumbnail" title="Clicca per allargare"  @click="showFullPhoto(isRelativePath(relattribute.value))" :src="isRelativePath(relattribute.value)">\n                                              <!--&lt;!&ndash;<span v-if="isRoute(layer,feature,attribute)" class="link dashboardlink" @click="goto(layer,feature.attributes[attribute.name])">{{ feature.attributes[attribute.name] }}</span>&ndash;&gt;-->\n                                              <!--<img v-if="isPhoto(layer,feature,attribute)" v-bind:data-url="getPhotoUrl(feature.attributes[attribute.name])" style="max-width:50px" :src="getPhotoUrl(feature.attributes[attribute.name],thumb)" />-->\n                                              <a v-if="isLink(layer,relattribute.name, relattribute.value)" :href="relattribute.value" target="_blank" class="glyphicon glyphicon-link"></a>\n                                            </td>\n                                          </tr>\n                                        </table>\n                                      </td>\n                                    </tr>\n                                    </tbody>\n                                  </table>\n                                </template>\n                              </div>\n                            </div>\n                          </li>\n                        </template>\n                      </ul>\n                    </div>\n                    <!--Fine Relazioni-->\n                  </td>\n                </tr>\n              </template>\n              </tbody>\n            </table>\n          </div>\n        </div>\n      </li>\n    </ul>\n  </div>\n  <span v-if="!hasResults() && !state.loading">Nessun risultato</span>\n</div>\n\n';
},{}],161:[function(e,t,i){function r(e,t,i){var r=/^(https?:\/\/[^\s]+)/g,o=/[^\s]+.(png|jpg|jpeg)$/g;if(_.isNil(i))return Fields.SIMPLE;i=i.toString();i.split(".").pop();return i.match(o)?Fields.PHOTO:i.match(r)?Fields.LINK:Fields.SIMPLE}function o(e,t,i,o){var n=r(t,i,o);return n===e}function n(e){s(this,e);var t=this;this.id="queryresults",this.title="Query Results",this._service=new u,this.setInternalComponent=function(){this.internalComponent=new g({queryResultsService:this._service}),this.createLayersFeaturesBoxes(),this.internalComponent.querytitle=this._service.state.querytitle},this.getElement=function(){if(this.internalComponent)return this.internalComponent.$el},this._service.onafter("setLayersData",function(){t.internalComponent||t.setInternalComponent(),t.createLayersFeaturesBoxes()}),l(this,e),this.createLayersFeaturesBoxes=function(){var e={},t=this._service.state.layers;_.forEach(t,function(t){t.attributes.length<=d&&!t.hasImageField&&(t.expandable=!1),_.forEach(t.features,function(i,r){var o=!0,n=t.id+"_"+i.id;e[n]={collapsed:o},i.attributes.relations&&(n="",_.forEach(i.attributes.relations,function(r){n=t.id+"_"+i.id+"_"+r.name,_.forEach(r.elements,function(t,i){e[n+i]={collapsed:!0}})}))})}),this.internalComponent.layersFeaturesBoxes=e},this.layout=function(e,t){}}var a=e("core/utils/utils").inherit,s=e("core/utils/utils").base,l=e("core/utils/utils").merge,c=e("gui/vue/component"),u=e("gui/queryresults/queryresultsservice"),p=e("core/project/projectsregistry");Fields={},Fields.SIMPLE="simple",Fields.LINK="link",Fields.PHOTO="photo",Fields.IMAGE="image",Fields.POINTLINK="pointlink",Fields.ROUTE="route";var d=3,h=10,m=10,f={template:e("./queryresults.html"),data:function(){return{state:this.$options.queryResultsService.state,layersFeaturesBoxes:{},headerExpandActionCellWidth:h,headerActionsCellWidth:m}},methods:{isArray:function(e){return _.isArray(e)},isSimple:function(e,t,i){return!this.isArray(i)&&o(Fields.SIMPLE,e,t,i)},isLink:function(e,t,i){return o(Fields.LINK,e,t,i)},is:function(e,t,i,r){return o(e,t,i,r)},checkField:function(e,t,i){var r=!1;return _.forEach(i,function(i){i.name==t&&(r=i.type==e)}),r},isRelativePath:function(e){return _.startsWith(e,"/")?e:p.getConfig().mediaurl+e},layerHasFeatures:function(e){return!!e.features&&e.features.length>0},hasResults:function(){return this.state.layers.length},layerHasActions:function(e){return this.state.layersactions[e.id].length>0},featureHasActions:function(e,t){return this.geometryAvailable(t)},geometryAvailable:function(e){return!!e.geometry},attributesSubset:function(e){var e=_.filter(e,function(e){return"image"!=e.type}),t=Math.min(d,e.length);return e.slice(0,t)},relationsAttributesSubset:function(e){var t=[];_.forEach(e,function(e,i){_.isArray(e)||t.push({label:i,value:e})});var i=Math.min(d,t.length);return t.slice(0,i)},relationsAttributes:function(e){var t=[];return _.forEach(e,function(e,i){t.push({label:i,value:e})}),t},attributesSubsetLength:function(e){return this.attributesSubset(e).length},cellWidth:function(e,t){var i=this.attributesSubsetLength(t.attributes),r=d-i;actionsCellWidth=t.hasgeometry?m:0;var o=100-h-actionsCellWidth,n=o/d;return e==i-1&&r>0?n*(r+1):n},featureBoxColspan:function(e){var t=this.attributesSubsetLength(e.attributes);return e.expandable&&(t+=1),e.hasgeometry&&(t+=1),t},relationsAttributesSubsetLength:function(e){return this.relationsAttributesSubset(e).length},collapsedFeatureBox:function(e,t,i){var r,o=!0;return r=_.isNil(i)?e.id+"_"+t.id:e.id+"_"+t.id+"_"+i,this.layersFeaturesBoxes[r]&&(o=this.layersFeaturesBoxes[r].collapsed),o},toggleFeatureBox:function(e,t,i){var r;r=_.isNil(i)?e.id+"_"+t.id:e.id+"_"+t.id+"_"+i,this.layersFeaturesBoxes[r].collapsed=!this.layersFeaturesBoxes[r].collapsed},toggleFeatureBoxAndZoom:function(e,t,i){this.toggleFeatureBox(e,t,i)},trigger:function(e,t,i){this.$options.queryResultsService.trigger(e,t,i)},showFullPhoto:function(e){this.$options.queryResultsService.showFullPhoto(e)}},watch:{"state.layers":function(e){var t=this;e.length&&this.$nextTick(function(){t.$options.queryResultsService.postRender(t.$el)})}},mounted:function(){Vue.nextTick(function(){$('[data-toggle="tooltip"]').tooltip()})}},g=Vue.extend(f);a(n,c),t.exports=n},{"./queryresults.html":160,"core/project/projectsregistry":76,"core/utils/utils":80,"gui/queryresults/queryresultsservice":159,"gui/vue/component":173}],162:[function(e,t,i){function r(){this.init=function(e){var t=e||a.getCurrentProject().state.search;this.state.searches=t},this.state={searches:[]},this.showSearchPanel=function(e){var t=new l;return t.init(e),n.showPanel(t),t},this.cleanSearchPanels=function(){this.state.panels={}},this.stop=function(){var e=$.Deferred();return e.resolve(),e.promise()},this.reload=function(){var e=a.getCurrentProject().state.search;Vue.set(this.state,"searches",e)}}var o=e("core/utils/utils").inherit,n=e("gui/gui"),a=e("core/project/projectsregistry"),s=e("core/g3wobject"),l=e("gui/search/vue/panel/searchpanel");o(r,s),t.exports=r},{"core/g3wobject":36,"core/project/projectsregistry":76,"core/utils/utils":80,"gui/gui":135,"gui/search/vue/panel/searchpanel":164}],163:[function(e,t,i){t.exports='<div class="g3w-search-panel form-group">\n  <h4><b>{{ title }}</b></h4>\n  <form id="g3w-search-form">\n    <template v-for="(forminput, index) in forminputs">\n      <div v-if="forminput.input.type == \'numberfield\'" class="form-group numeric">\n        <label :for="forminput.id + \' \'">{{ forminput.label }}</label>\n        <input type="number" v-model="formInputValues[index].value" class="form-control" :id="forminput.id">\n      </div>\n      <div v-if="forminput.input.type == \'textfield\' || forminput.input.type == \'textField\'" class="form-group text">\n        <label :for="forminput.id">{{ forminput.label }}</label>\n        <input type="text" v-model="formInputValues[index].value" class="form-control" :id="forminput.id">\n      </div>\n    </template>\n    <div class="form-group">\n      <button style="background-color:#3c8dbc" class="btn btn-block pull-right" @click="doSearch($event)" data-i18n="dosearch">Search</button>\n    </div>\n  </form>\n</div>\n'},{}],164:[function(e,t,i){function r(e){self=this;var e=e||{};this.config={},this.filter={},this.id=null,this.querylayerid=null,this.internalPanel=e.internalPanel||new c,this.init=function(e){this.config=e||{},this.name=this.config.name||this.name,this.id=this.config.id||this.id,this.filter=this.config.options.filter||this.filter,this.internalPanel.queryurl=this.config.options.queryurl||null;var t=this.config.options.querylayerid||this.querylayerid;this.queryLayer=l.getCurrentProject().getLayersStore().getLayerById(t),this.fillInputsFormFromFilter();var i=a.createQueryFilterFromConfig(this.filter);this.internalPanel.filterObject=a.createQueryFilterObject({queryLayers:[this.queryLayer],filter:i}),this.internalPanel.filterObject=this.internalPanel.filterObject[0],this.internalPanel.fillFilterInputsWithValues=this.fillFilterInputsWithValues,this.internalPanel.title=this.name},this.fillInputsFormFromFilter=function(){var e,t=0;_.forEach(this.filter,function(i,r,o){_.forEach(i,function(i){e={},i.id=t,e.type=i.input.type,e.value=null,self.internalPanel.formInputValues.push(e),self.internalPanel.forminputs.push(i),t+=1})})},this.fillFilterInputsWithValues=function(e,t,i){function r(e,t){switch(e){case"numberfield":t=parseInt(t)}return t}return _.forEach(e.filter,function(e,o){_.forEach(e,function(e,o){_.forEach(e,function(n,a,s){_.isArray(n)?fillFilterInputsWithValues(e,t,o):_.forEach(n,function(e,n,a){index=i?i+o:o,a[n]=r(t[index].type,t[index].value)})})})}),e}}var o=e("core/utils/utils").inherit,n=(e("core/i18n/i18n.service").t,e("core/utils/utils").resolve,e("gui/gui")),a=e("core/query/queryservice"),s=(e("gui/listpanel").ListPanel,e("gui/panel")),l=e("core/project/projectsregistry"),c=Vue.extend({template:e("./searchpanel.html"),data:function(){return{title:"",forminputs:[],filterObject:{},formInputValues:[],queryurl:null}},methods:{doSearch:function(e){var t=this;e.preventDefault(),this.filterObject=this.fillFilterInputsWithValues(this.filterObject,this.formInputValues),this.queryurl&&(this.filterObject.url=this.queryurl);var i=n.showContentFactory("query"),r=i(t.title);a.queryByFilter([this.filterObject]).then(function(e){r.setQueryResponse(e)}).fail(function(){n.notify.error("Si è verificato un errore nella richiesta al server"),n.closeContent()})}}});o(r,s),t.exports=r},{"./searchpanel.html":163,"core/i18n/i18n.service":39,"core/project/projectsregistry":76,"core/query/queryservice":77,"core/utils/utils":80,"gui/gui":135,"gui/listpanel":137,"gui/panel":144}],165:[function(e,t,i){t.exports='<ul id="g3w-search" class="treeview-menu g3w-search g3w-tools menu-items">\n  <li v-for="search in state.searches" class="menu-item" @click="showSearchPanel(search)">\n    <i class="fa fa-circle-o"></i>\n    <span>{{ search.name }}</span>\n  </li>\n</ul>\n'},{}],166:[function(e,t,i){function r(e){n(this,e),this.id="search-component",this.title="search",this._service=new c,this.internalComponent=new p({searchesService:this._service}),this.internalComponent.state=this._service.state,this.state.visible=l.getCurrentProject().state.search.length>0,a(this,e),this.initService=function(){this._service.init()},this._reload=function(){this.state.visible=l.getCurrentProject().state.search.length>0,this._service.reload()}}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/utils/utils").merge,s=e("gui/vue/component"),l=e("core/project/projectsregistry"),c=e("gui/search/searchesservice"),u={template:e("./search.html"),data:function(){return{state:null}},methods:{showSearchPanel:function(e){this.$options.searchesService.showSearchPanel(e)}}},p=Vue.extend(u);o(r,s),t.exports=r},{"./search.html":165,"core/project/projectsregistry":76,"core/utils/utils":80,"gui/search/searchesservice":162,"gui/vue/component":173}],167:[function(e,t,i){function r(){this._position=null,this.setters={postRender:function(e){}},this.getPosition=function(){return this._position},this.showStreetView=function(e){this._position=e,s.setContent({content:new l({service:this}),title:"StreetView"})},n(this)}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/g3wobject"),s=e("gui/gui"),l=e("gui/streetview/vue/streetview");o(r,a),t.exports=r},{"core/g3wobject":36,"core/utils/utils":80,"gui/gui":135,"gui/streetview/vue/streetview":169}],168:[function(e,t,i){t.exports='<div id="streetview"></div>'},{}],169:[function(e,t,i){var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,n=e("gui/vue/component"),a=Vue.extend({template:e("./streetview.html"),data:function(){return{state:null}},mounted:function(){var e=this;this.$nextTick(function(){var t=e.$options.service.getPosition();e.$options.service.postRender(t)})}}),s=function(e){o(this);var e=e||{},t=e.service;this.setService(t);var i=new a({service:t});this.setInternalComponent(i),this.unmount=function(){return o(this,"unmount")}};r(s,n),t.exports=s},{"./streetview.html":168,"core/utils/utils":80,"gui/vue/component":173}],170:[function(e,t,i){function r(){var e=this;this.config=null,this._actions={},this.state={toolsGroups:[]},this.setters={addTools:function(t,i,r){e._addTools(t,i,r)},addToolGroup:function(t,i){e.state.toolsGroups.splice(t,0,i)},removeTools:function(){e._removeTools()}},this._addTools=function(e,t,i){var r=this,o=this._getToolsGroup(t);o||(o={name:t,tools:[]},this.addToolGroup(e,o)),_.forEach(i,function(e){o.tools.push(e),r._addAction(e)})},this._removeTool=function(e){this.state.toolsGroups=this.state.toolsGroups.splice(e,1)},this._removeTools=function(){var e=this;_.forEach(this.state.toolsGroups,function(t,i){e.state.toolsGroups.splice(0,1)})},this.updateToolsGroup=function(e,t){Vue.set(this.state.toolsGroups,e,t)},this.getState=function(){return this.state},this.fireAction=function(e){var t=this._actions[e];t()},this._getToolsGroup=function(e){var t=null;return _.forEach(this.state.toolsGroups,function(i){i.name==e&&(t=i)}),t},this._addAction=function(e){var t=Math.floor(1e6*Math.random())+1;e.actionId=t,this._actions[t]=e.action},n(this)}var o=e("core/utils/utils").inherit,n=e("core/utils/utils").base,a=e("core/g3wobject");o(r,a),t.exports=r},{"core/g3wobject":36,"core/utils/utils":80}],171:[function(e,t,i){t.exports='<ul class="g3w-tools treeview-menu">\n  <li v-for="group in state.toolsGroups">\n    <div class="tool-header">\n      <i class="fa fa-gear"></i>\n      <span style="">{{ group.name }}</span>\n    </div>\n    <div :id="group.name + \'-tools\'" class="tool-box">\n      <template v-for="tool in group.tools">\n        <div v-if="tool.type == \'checkbox\' " class="checkbox">\n          <label>\n            <input style="cursor:pointer" :id="tool.layerName" v-model="tool.isCheck" type="checkbox" :value="tool.layerName" @click="fireAction(tool.actionId)">{{ tool.name }}\n          </label>\n        </div>\n        <div v-else class="tool" @click="fireAction(tool.actionId)">\n          <i class="fa fa-caret-right"></i>\n          <span >{{ tool.name }}</span>\n        </div>\n      </template>\n    </div>\n  </li>\n</ul>\n\n'},{}],172:[function(e,t,i){function r(e){n(this,e);var t=this;this._service=new l,this.id="tools-component",this.title="tools",this.state.visible=!1,this._service.onafter("addTools",function(){t.state.visible=t._service.state.toolsGroups.length>0}),this._service.onafter("removeTools",function(){t.state.visible=t._service.state.toolsGroups.length>0}),a(this,e),this.internalComponent=new c({toolsService:this._service}),this.internalComponent.state=this._service.state}var o=(e("core/i18n/i18n.service").t,e("core/utils/utils").inherit),n=e("core/utils/utils").base,a=e("core/utils/utils").merge,s=e("gui/vue/component"),l=e("gui/tools/toolsservice"),c=Vue.extend({template:e("./tools.html"),data:function(){return{state:null}},methods:{fireAction:function(e){this.$options.toolsService.fireAction(e)}}});o(r,s);r.prototype;t.exports=r},{"./tools.html":171,"core/i18n/i18n.service":39,"core/utils/utils":80,"gui/tools/toolsservice":170,"gui/vue/component":173}],173:[function(e,t,i){var r=e("core/utils/utils").inherit,o=e("core/utils/utils").base,n=e("core/utils/utils").resolve,a=e("gui/component"),s=function(e){o(this,e)};r(s,a);var l=s.prototype;l.mount=function(e,t){var i=$.Deferred();if(this.internalComponent||this.setInternalComponent(),t){var r=this.internalComponent.$mount();$(e).append(r.$el)}else this.internalComponent.$mount(e);return Vue.nextTick(function(){$(e).localize(),i.resolve(!0)}),i.promise()},l.unmount=function(){if(_.isNil(this.internalComponent)){return n()}return this.internalComponent.$destroy(!0),$(this.internalComponent.$el).remove(),this.internalComponent=null,n()},l.ismount=function(){return this.internalComponent&&this.internalComponent.$el},l.layout=function(e,t){this.internalComponent},t.exports=s},{"core/utils/utils":80,"gui/component":118}],174:[function(e,t,i){var r=e("core/i18n/i18n.service").t;Vue.directive("disabled",function(e,t){t.value?e.setAttribute("disabled","disabled"):e.removeAttribute("disabled")}),Vue.directive("checked",function(e,t){t.value?e.setAttribute("checked","checked"):e.removeAttribute("checked")}),Vue.directive("selected-first",function(e,t){0==t.value?e.setAttribute("selected",""):e.removeAttribute("selected")}),Vue.directive("t",function(e,t){return r(t.value)})},{"core/i18n/i18n.service":39}],175:[function(e,t,i){var r=r||{};r.core={G3WObject:e("core/g3wobject"),utils:e("core/utils/utils"),ApplicationService:e("core/applicationservice"),ApiService:e("core/apiservice"),Router:e("core/router"),i18n:e("core/i18n/i18n.service"),project:{ProjectsRegistry:e("core/project/projectsregistry"),Project:e("core/project/project")},map:{MapLayersStoreRegistry:e("core/map/maplayersstoresregistry")},catalog:{CatalogLayersStoresRegistry:e("core/catalog/cataloglayersstoresregistry")},layer:{LayersStoreRegistry:e("core/layers/layersstoresregistry"),LayersStore:e("core/layers/layersstore"),LayerFactory:e("core/layers/layerfactory"),TableLayer:e("core/layers/tablelayer"),VectorLayer:e("core/layers/vectorlayer"),ImageLayer:e("core/layers/imagelayer"),WmsLayer:e("core/map/layer/wmslayer"),VectorLayerLoader:e("core/map/layer/loader/vectorloaderlayer"),geometry:{Geometry:e("core/geometry/geometry"),geom:e("core/geometry/geom")},MapLayer:e("core/map/layer/maplayer")},query:{QueryService:e("core/query/queryservice")},interaction:{PickCoordinatesInteraction:e("g3w-ol3/src/interactions/pickcoordinatesinteraction"),PickFeatureInteraction:e("g3w-ol3/src/interactions/pickfeatureinteraction")},plugin:{Plugin:e("core/plugin/plugin"),PluginsRegistry:e("core/plugin/pluginsregistry"),PluginService:e("core/plugin/pluginservice")},editor:{Editor:e("core/editing_old/editor"),EditBuffer:e("core/editing_old/editbuffer"),RelationEditBuffer:e("core/editing_old/relationeditbuffer")}},r.gui={GUI:e("gui/gui"),Panel:e("gui/panel"),ControlFactory:e("gui/map/control/factory"),vue:{Component:e("gui/vue/component"),SearchComponent:e("gui/search/vue/search"),SearchPanel:e("gui/search/vue/panel/searchpanel"),PrintComponent:e("gui/print/vue/print"),CatalogComponent:e("gui/catalog/vue/catalog"),MapComponent:e("gui/map/vue/map"),ToolsComponent:e("gui/tools/vue/tools"),QueryResultsComponent:e("gui/queryresults/vue/queryresults"),FormComponent:e("gui/form/vue/form"),EditingComponent:e("gui/editing_old/vue/editing")}},r.ol3={interactions:{PickFeatureInteraction:e("g3w-ol3/src/interactions/pickfeatureinteraction")},controls:{}},t.exports={core:r.core,gui:r.gui,ol3:r.ol3}},{"core/apiservice":21,"core/applicationservice":22,"core/catalog/cataloglayersstoresregistry":23,"core/editing_old/editbuffer":26,"core/editing_old/editor":27,"core/editing_old/relationeditbuffer":28,"core/g3wobject":36,"core/geometry/geom":37,"core/geometry/geometry":38,"core/i18n/i18n.service":39,"core/layers/imagelayer":45,"core/layers/layerfactory":47,"core/layers/layersstore":48,"core/layers/layersstoresregistry":49,"core/layers/tablelayer":58,"core/layers/vectorlayer":59,"core/map/layer/loader/vectorloaderlayer":62,"core/map/layer/maplayer":63,"core/map/layer/wmslayer":66,"core/map/maplayersstoresregistry":68,"core/plugin/plugin":69,"core/plugin/pluginservice":70,"core/plugin/pluginsregistry":71,"core/project/project":75,"core/project/projectsregistry":76,"core/query/queryservice":77,"core/router":78,"core/utils/utils":80,"g3w-ol3/src/interactions/pickcoordinatesinteraction":103,"g3w-ol3/src/interactions/pickfeatureinteraction":104,"gui/catalog/vue/catalog":114,"gui/editing_old/vue/editing":131,"gui/form/vue/form":133,"gui/gui":135,"gui/map/control/factory":138,"gui/map/vue/map":143,"gui/panel":144,"gui/print/vue/print":148,"gui/queryresults/vue/queryresults":161,"gui/search/vue/panel/searchpanel":164,"gui/search/vue/search":166,"gui/tools/vue/tools":172,"gui/vue/component":173}]},{},[3]);