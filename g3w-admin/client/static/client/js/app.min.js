!function n(i,r,o){function s(t,e){if(!r[t]){if(!i[t]){var a="function"==typeof require&&require;if(!e&&a)return a(t,!0);if(l)return l(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}a=r[t]={exports:{}},i[t][0].call(a.exports,function(e){return s(i[t][1][e]||e)},a,a.exports,n,i,r,o)}return r[t].exports}for(var l="function"==typeof require&&require,e=0;e<o.length;e++)s(o[e]);return s}({1:[function(e,t,a){var n,i,t=t.exports={};function r(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}try{n="function"==typeof setTimeout?setTimeout:r}catch(e){n=r}try{i="function"==typeof clearTimeout?clearTimeout:o}catch(e){i=o}function s(t){if(n===setTimeout)return setTimeout(t,0);if((n===r||!n)&&setTimeout)return(n=setTimeout)(t,0);try{return n(t,0)}catch(e){try{return n.call(null,t,0)}catch(e){return n.call(this,t,0)}}}var l,u=[],c=!1,d=-1;function p(){c&&l&&(c=!1,l.length?u=l.concat(u):d=-1,u.length)&&f()}function f(){if(!c){for(var e=s(p),t=(c=!0,u.length);t;){for(l=u,u=[];++d<t;)l&&l[d].run();d=-1,t=u.length}l=null,c=!1,!function(t){if(i===clearTimeout)return clearTimeout(t);if((i===o||!i)&&clearTimeout)return(i=clearTimeout)(t);try{i(t)}catch(e){try{return i.call(null,t)}catch(e){return i.call(this,t)}}}(e)}}function g(e,t){this.fun=e,this.array=t}function h(){}t.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var a=1;a<arguments.length;a++)t[a-1]=arguments[a];u.push(new g(e,t)),1!==u.length||c||s(f)},g.prototype.run=function(){this.fun.apply(null,this.array)},t.title="browser",t.browser=!0,t.env={},t.argv=[],t.version="",t.versions={},t.on=h,t.addListener=h,t.once=h,t.off=h,t.removeListener=h,t.removeAllListeners=h,t.emit=h,t.prependListener=h,t.prependOnceListener=h,t.listeners=function(e){return[]},t.binding=function(e){throw new Error("process.binding is not supported")},t.cwd=function(){return"/"},t.chdir=function(e){throw new Error("process.chdir is not supported")},t.umask=function(){return 0}},{}],2:[function(e,t,a){var n=a.cache={};function i(){}a.insert=function(e){if(n[e])return i;n[e]=!0;var t=document.createElement("style");return t.setAttribute("type","text/css"),"textContent"in t?t.textContent=e:t.styleSheet.cssText=e,document.getElementsByTagName("head")[0].appendChild(t),function(){document.getElementsByTagName("head")[0].removeChild(t),n[e]=!1}}},{}],3:[function(e,t,a){var n=l(e("components/FieldText.vue")),i=l(e("components/FieldLink.vue")),r=l(e("components/FieldImage.vue")),o=l(e("components/FieldGeo.vue")),s=l(e("components/FieldMedia.vue")),e=l(e("components/FieldVue.vue"));function l(e){return e&&e.__esModule?e:{default:e}}t.exports={simple_field:n.default,text_field:n.default,link_field:i.default,image_field:r.default,geo_field:o.default,photo_field:r.default,media_field:s.default,vue_field:e.default}},{"components/FieldGeo.vue":45,"components/FieldImage.vue":46,"components/FieldLink.vue":47,"components/FieldMedia.vue":48,"components/FieldText.vue":49,"components/FieldVue.vue":50}],4:[function(e,t,a){var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=e("utils/toRawType"),r=e("./fields");t.exports={getType:function(e){var t=e.type;return"vue"!==t&&((e=!(e=e.value)||"Object"!==(0,i.toRawType)(e)||e.coordinates||e.vue?e:e.value)?"object"===(void 0===e?"undefined":n(e))?e.coordinates?t="geo":e.vue&&(t="vue"):t=e&&Array.isArray(e)?e.length&&e[0].photo?"photo":"simple":e.toString().toLowerCase().match(/[^\s]+.(png|jpg|jpeg|gif)$/g)?"photo":e.toString().match(/^(https?:\/\/[^\s]+)/g)?"link":"simple":t="simple"),t+"_field"},isSimple:function(e){return"simple_field"===this.getType(e)},isLink:function(e){return"link_field"===this.getType(e)},isImage:function(e){return"image_field"===this.getType(e)},isPhoto:function(e){return"photo_field"===this.getType(e)},isVue:function(e){return"vue_field"===this.getType(e)},add:function(e){var t=e.type;r[t]=e.field},remove:function(e){delete r[e]}}},{"./fields":3,"utils/toRawType":257}],5:[function(e,t,a){var i=function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e};function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=e("gui/inputs/service");t.exports=(()=>{var e=n,t=r;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,a=n;if(!(t instanceof a))throw new TypeError("Cannot call a class as a function");e.validatorOptions={values:e.state.input.options.values.map(function(e){return e})};t=this,a=(n.__proto__||Object.getPrototypeOf(n)).call(this,e);if(t)return!a||"object"!=typeof a&&"function"!=typeof a?t:a;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t),i(n,[{key:"convertCheckedToValue",value:function(t){return t=![null,void 0].includes(t)&&t,this.state.value=[!0,!1].includes(this.state.value)?(this.state.input.options.values.find(function(e){return t===e.checked})||{}).value:""+(this.state.input.options.values.find(function(e){return t===e.checked})||{}).value,this.state.value}},{key:"convertValueToChecked",value:function(){var e,t=this;return![null,void 0].includes(this.state.value)&&(void 0===(e=this.state.input.options.values.find(function(e){return t.state.value==e.value}))&&(e=this.state.input.options.values.find(function(e){return!1===e.checked}),this.state.value=e.value),e.checked)}}]),n})()},{"gui/inputs/service":27}],6:[function(e,t,a){e=(e=>{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t})(e("components/InputCheckbox.vue"));e=Vue.extend(e);t.exports=e},{"components/InputCheckbox.vue":72}],7:[function(e,t,a){e=(e=>{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t})(e("components/InputColor.vue"));e=Vue.extend(e);t.exports=e},{"components/InputColor.vue":73}],8:[function(e,t,a){var i=function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e};function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=e("utils/convertQGISDateTimeFormatToMoment");var o=e("gui/inputs/service");t.exports=(()=>{var e=n,t=o;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,a=n;if(t instanceof a)return(t=((e,t)=>{if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")})(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e))).validatorOptions={},t;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t),i(n,[{key:"getLocale",value:function(){return window.initConfig.user.i18n||"en"}},{key:"convertQGISDateTimeFormatToMoment",value:function(e){return(0,r.convertQGISDateTimeFormatToMoment)(e)}},{key:"setValidatorOptions",value:function(){this.validatorOptions=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}}}]),n})()},{"gui/inputs/service":27,"utils/convertQGISDateTimeFormatToMoment":202}],9:[function(e,t,a){e=(e=>{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t})(e("components/InputDateTimePicker.vue"));e=Vue.extend(e);t.exports=e},{"components/InputDateTimePicker.vue":74}],10:[function(e,t,a){var i=e("gui/inputs/service");t.exports=(()=>{var e=n,t=i;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,a=n;if(!(t instanceof a))throw new TypeError("Cannot call a class as a function");t=this,a=(n.__proto__||Object.getPrototypeOf(n)).call(this,e);if(t)return!a||"object"!=typeof a&&"function"!=typeof a?t:a;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t),n})()},{"gui/inputs/service":27}],11:[function(e,t,a){e=(e=>{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t})(e("components/InputFloat.vue"));e=Vue.extend(e);t.exports=e},{"components/InputFloat.vue":75}],12:[function(e,t,a){var n=o(e("store/application")),i=o(e("components/InputBase.vue")),r=e("mixins");function o(e){return e&&e.__esModule?e:{default:e}}function s(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}var l=e("./services"),e={props:["state"],mixins:[r.baseInputMixin],components:{baseinput:i.default},watch:{notvalid:function(e){e&&this.service.setErrorMessage()},"state.value":function(){var e=this;void 0!==this.state.input.options.default_expression&&setTimeout(function(){return e.change()})}},created:function(){var e=this;this.service=new l[this.state.input.type]({state:this.state}),this.$watch(function(){return n.default.language},s(function*(){e.state.visible&&(e.state.visible=!1,e.service.setErrorMessage(),yield e.$nextTick(),e.state.visible=!0)})),this.state.editable&&this.state.validate.required&&this.service.validate(),this.$emit("addinput",this.state),this.state.value_from_default_value&&this.$emit("changeinput",this.state)},destroyed:function(){this.$emit("removeinput",this.state)}};t.exports=e},{"./services":28,"components/InputBase.vue":71,mixins:180,"store/application":193}],13:[function(e,t,a){var i=e("gui/inputs/service");t.exports=(()=>{var e=n,t=i;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,a=n;if(!(t instanceof a))throw new TypeError("Cannot call a class as a function");t=this,a=(n.__proto__||Object.getPrototypeOf(n)).call(this,e);if(t)return!a||"object"!=typeof a&&"function"!=typeof a?t:a;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t),n})()},{"gui/inputs/service":27}],14:[function(e,t,a){e=(e=>{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t})(e("components/InputInteger.vue"));e=Vue.extend(e);t.exports=e},{"components/InputInteger.vue":78}],15:[function(e,t,a){var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=function(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e};function i(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=e("services/gui"),s=(o=o)&&o.__esModule?o:{default:o};var l=e("gui/inputs/service");t.exports=(()=>{var e=i,t=l;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);function i(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=this,n=i;if(a instanceof n)return(t=((e,t)=>{if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")})(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e))).coordinatebutton,t.mapService=s.default.getService("map"),t.mapEpsg=t.mapService.getCrs(),t.mapControlToggleEventHandler=function(e){e.target.isToggled()&&e.target.isClickMap()&&t.coordinatebutton.active&&t.toggleGetCoordinate()},t.map=t.mapService.getMap(),t.outputEpsg=t.state.epsg||t.mapEpsg,t.eventMapKey,t;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t),r(i,[{key:"setCoordinateButtonReactiveObject",value:function(e){this.coordinatebutton=e}},{key:"validate",value:function(){this.state.values.lon<-180?this.state.values.lon=-180:180<this.state.values.lon&&(this.state.values.lon=180),this.state.values.lat<-90?this.state.values.lon=-90:90<this.state.values.lat&&(this.state.values.lon=90),this.state.validate.valid=!Number.isNaN(+this.state.values.lon)}},{key:"toggleGetCoordinate",value:function(){this.coordinatebutton.active=!this.coordinatebutton.active,this.coordinatebutton.active?this.startToGetCoordinates():this.stopToGetCoordinates()}},{key:"startToGetCoordinates",value:function(){var a=this;this.mapService.deactiveMapControls(),this.mapService.on("mapcontrol:toggled",this.mapControlToggleEventHandler),this.eventMapKey=this.map.on("click",function(e){e.originalEvent.stopPropagation(),e.preventDefault();var e=a.mapEpsg!==a.outputEpsg?ol.proj.transform(e.coordinate,a.mapEpsg,a.outputEpsg):e.coordinate,e=(a.state.value=[e],n(e,2)),t=e[0],e=e[1];a.state.values.lon=t,a.state.values.lat=e})}},{key:"stopToGetCoordinates",value:function(){ol.Observable.unByKey(this.eventMapKey),this.mapService.off("mapcontrol:toggled",this.mapControlToggleEventHandler)}},{key:"clear",value:function(){this.stopToGetCoordinates()}}]),i})()},{"gui/inputs/service":27,"services/gui":188}],16:[function(e,t,a){e=(e=>{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t})(e("components/InputLonLat.vue"));e=Vue.extend(e);t.exports=e},{"components/InputLonLat.vue":79}],17:[function(e,t,a){var i=e("gui/inputs/service");t.exports=(()=>{var e=n,t=i;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,a=n;if(!(t instanceof a))throw new TypeError("Cannot call a class as a function");t=this,a=(n.__proto__||Object.getPrototypeOf(n)).call(this,e);if(t)return!a||"object"!=typeof a&&"function"!=typeof a?t:a;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t),n})()},{"gui/inputs/service":27}],18:[function(e,t,a){e=(e=>{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t})(e("components/InputMedia.vue"));e=Vue.extend(e);t.exports=e},{"components/InputMedia.vue":80}],19:[function(e,t,a){var n=function(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e};function i(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=u(e("services/gui")),l=u(e("services/data")),r=u(e("map/interactions/pickfeatureinteraction")),o=u(e("map/interactions/pickcoordinatesinteraction"));function u(e){return e&&e.__esModule?e:{default:e}}function c(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,a=c;if(!(t instanceof a))throw new TypeError("Cannot call a class as a function");this.pick_type=e.pick_type||"wms",this.ispicked=!1,this.fields=e.fields||[e.value],this.layerId=e.layer_id,this.mapService=s.default.getService("map"),this.interaction="map"===this.pick_type?new r.default({layers:[this.mapService.getLayerById(this.layerId)]}):new o.default}t.exports=(n(c,[{key:"isPicked",value:function(){return this.ispicked}},{key:"escKeyUpHandler",value:function(e){var t=e.keyCode,e=e.data.owner;27===t&&e.unpick()}},{key:"unbindEscKeyUp",value:function(){$(document).unbind("keyup",this.escKeyUpHandler)}},{key:"bindEscKeyUp",value:function(){$(document).on("keyup",{owner:this},this.escKeyUpHandler)}},{key:"pick",value:function(){var o=this;return new Promise(function(a,n){o.bindEscKeyUp();function i(e){var t;e?(t=e.getProperties(),o.fields.filter(function(e){return e}).forEach(function(e){return r[e]=t[e]}),a(r)):n(),o.ispicked=!1,o.unpick()}var r={};o.ispicked=!0;s.default.setModal(!1),o.mapService.addInteraction(o.interaction),o.interaction.once("picked",function(e){var t;"map"===o.pick_type?(t=e.feature,i(t)):"wms"===o.pick_type&&(t=s.default.getService("map").getProjectLayer(o.layerId))&&l.default.getQueryLayersPromisesByCoordinates([t],{map:o.mapService.getMap(),feature_count:1,coordinates:e.coordinate}).then(function(e){e=e[0].data,e=void 0===e?[]:e,e=e.length&&e[0].features[0]||null;i(e)}).fail(function(e){})})})}},{key:"unpick",value:function(){this.mapService.removeInteraction(this.interaction),s.default.setModal(!0),this.unbindEscKeyUp(),this.ispicked=!1}},{key:"clear",value:function(){this.isPicked()&&this.unpick(),this.mapService=this.interaction=this.field=null}}]),c)},{"map/interactions/pickcoordinatesinteraction":164,"map/interactions/pickfeatureinteraction":165,"services/data":187,"services/gui":188}],20:[function(e,t,a){e=(e=>{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t})(e("components/InputPickLayer.vue"));e=Vue.extend(e);t.exports=e},{"components/InputPickLayer.vue":81}],21:[function(e,t,a){var i=e("gui/inputs/service");t.exports=(()=>{var e=n,t=i;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,a=n;if(!(t instanceof a))throw new TypeError("Cannot call a class as a function");t=this,a=(n.__proto__||Object.getPrototypeOf(n)).call(this,e);if(t)return!a||"object"!=typeof a&&"function"!=typeof a?t:a;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t),n})()},{"gui/inputs/service":27}],22:[function(e,t,a){e=(e=>{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t})(e("components/InputRadio.vue"));e=Vue.extend(e);t.exports=e},{"components/InputRadio.vue":82}],23:[function(e,t,a){var n=function(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e};function i(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=e("gui/inputs/service");t.exports=(()=>{var e=r,t=o;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);function r(){var t,a,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=this,i=r;if(n instanceof i)return n=e.state.input.options.values[0],t=n.min,e.state.info="[MIN: "+t+" - MAX: "+(a=n.max)+"]",(i=((e,t)=>{if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")})(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,e))).setValidator({validate:function(e){return+t<=(e=+e)&&e<=+a}}),i;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t),n(r,[{key:"isValueInRange",value:function(e,t,a){return e<=a&&t<=e}}]),r})()},{"gui/inputs/service":27}],24:[function(e,t,a){e=(e=>{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t})(e("components/InputRange.vue"));e=Vue.extend(e);t.exports=e},{"components/InputRange.vue":83}],25:[function(e,t,a){var o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},i=function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e};function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=e("utils/getCatalogLayerById");var s=e("gui/inputs/service");t.exports=(()=>{var e=n,t=s;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,a=n;if(t instanceof a)return(t=((e,t)=>{if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")})(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e))).layer=null,t;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t),i(n,[{key:"_getLayerById",value:function(e){return(0,r.getCatalogLayerById)(e)}},{key:"addValue",value:function(e){this.state.input.options.values.push(e)}},{key:"getKeyByValue",value:function(){var n=this,e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).search,t=this.state.input.options,i=t.value,r=t.key;return new Promise(function(a,t){n.getData({key:i,value:r,search:e}).then(function(e){var e=o(e,1)[0],t=e.$value;n.addValue({key:t,value:e.text}),a(n.state.input.options.values)}).catch(function(e){t(e)})})}},{key:"getData",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=t.layer_id,n=void 0===a?this.state.input.options.layer_id:a,a=t.key,i=void 0===a?this.state.input.options.key:a,a=t.value,r=void 0===a?this.state.input.options.value:a,o=(i+"|"+t.search).trim();return new Promise(function(t,a){e._layer||(e._layer=e._getLayerById(n)),e._layer.getDataTable({suggest:o,ordering:i}).then(function(e){e=e.features.map(function(e){return{text:e.properties[i],id:e.properties[r],$value:e.properties[r]}});t(e)}).fail(function(e){a(e)})})}}]),n})()},{"gui/inputs/service":27,"utils/getCatalogLayerById":218}],26:[function(e,t,a){e=(e=>{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t})(e("components/InputSelect.vue"));e=Vue.extend(e);t.exports=e},{"components/InputSelect.vue":84}],27:[function(e,t,a){var n=function(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e};function i(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=e("utils/toRawType");var o=e("g3w-i18n").t,s={validators:{float:function(){this.options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},this.validate=function(e){return!Number.isNaN(Number(+e))}},bigint:function(){this.options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},this.validate=function(e){return e=+e,!Number.isNaN(e)&&e<=Number.MAX_SAFE_INTEGER}},integer:function(){this.options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},this.validate=function(e){e=+e;return!Number.isNaN(e)&&Number.isSafeInteger(e)&&e<=2147483647}},checkbox:function(){this.options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},this.validate=function(e){return(this.options.values||[]).includes(e)}},datetimepicker:function(){this.options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},this.validate=function(e,t){return moment(e,t.fielddatetimeformat,!0).isValid()}},char:function(e){this.options=e,this.validate=function(e){return e&&1===(""+e).length}},varchar:function(){this.options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},this.validate=function(){return!0}},text:function(){this.options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},this.validate=function(){return!0}},string:function(){this.options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},this.validate=function(){return!0}},radio:function(){this.options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},this.validate=function(){return!0}},default:function(){this.options=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},this.validate=function(){return!0}},range:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.min,a=e.max;this.validate=function(e){return t<=(e=+e)&&e<=a}}},get:function(e){return new(this.validators[e]||this.validators.default)(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{})}};function l(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,a=l;if(!(t instanceof a))throw new TypeError("Cannot call a class as a function");this.state=e.state||{},this.setValue(this.state.value),this.setEmpty(this.state.value);t=this.state.type,a=e.validatorOptions||this.state.input.options||{};this._validator=s.get(t,a),this.setErrorMessage()}t.exports=(n(l,[{key:"getState",value:function(){return this.state}},{key:"getValue",value:function(){return this.state.value}},{key:"setValue",value:function(e){var t,a;[null,void 0].includes(e)&&(t=(e=this.state.input.options).default,Array.isArray(e)&&(e[0].default?t=e[0].default:Array.isArray(e.values)&&0<e.values.length&&(t=e.values[0]&&(e.values[0].value||e.values[0]))),(a=this.state.get_default_value&&null!=t)&&void 0===e.default_expression&&(this.state.value=t),this.state.value_from_default_value=a)}},{key:"addValueToValues",value:function(e){this.state.input.options.values.unshift(e)}},{key:"_getValidatorType",value:function(){return this.state.type}},{key:"setState",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.state="Object"===(0,r.toRawType)(e)?e:{}}},{key:"getValidator",value:function(){return this._validator}},{key:"setValidator",value:function(e){this._validator=e}},{key:"setEmpty",value:function(){this.state.validate.empty=null===this.state.value||!(Array.isArray(this.state.value)&&0<this.state.value.length||!_.isEmpty((""+this.state.value).trim()))}},{key:"validate",value:function(){return this.state.validate.empty?(this.state.value=null,this.state.validate.valid=!this.state.validate.required):(["integer","float","bigint"].includes(this.state.input.type)&&(+this.state.value<0?(this.state.value=null,this.state.validate.empty=!0,this.state.validate.valid=!this.state.validate.required):this.state.validate.valid=this._validator.validate(this.state.value)),this.state.validate.unique&&this.state.validate.exclude_values&&this.state.validate.exclude_values.size?this.state.validate.valid=!this.state.validate.exclude_values.has(""+this.state.value):this.state.validate.valid=this._validator.validate(this.state.value)),this.state.validate.valid}},{key:"setErrorMessage",value:function(){var e;this.state.validate.error?this.state.validate.message=o(this.state.validate.error):(e=void 0,this.state.validate.mutually&&!this.state.validate.mutually_valid?this.state.validate.message=o("sdk.form.inputs.input_validation_mutually_exclusive")+" ( "+this.state.validate.mutually.join(",")+" )":this.state.validate.max_field?this.state.validate.message=o("sdk.form.inputs.input_validation_max_field")+" ("+this.state.validate.max_field+")":this.state.validate.min_field?this.state.validate.message=o("sdk.form.inputs.input_validation_min_field")+" ("+this.state.validate.min_field+")":("unique"===this.state.input.type||this.state.validate.unique)&&this.state.validate.exclude_values&&this.state.validate.exclude_values.size?this.state.validate.message=""+o("sdk.form.inputs.input_validation_exclude_values"):this.state.validate.required?(e=o("sdk.form.inputs.input_validation_error")+" ( "+o("sdk.form.inputs."+this.state.type)+" )",this.state.info&&(e=e+"\n                 <div>\n                  <b>"+this.state.info+"</b>\n                 </div>         \n      "),this.state.validate.message=this.state.info||e):this.state.validate.message=this.state.info)}},{key:"setUpdate",value:function(){var e=this.state,t=e.value,e=e._value;"media"===this.state.input.type&&"Object"!==(0,r.toRawType)(t)&&"Object"!==(0,r.toRawType)(e)?this.state.update=t.value!=e.value:"datetimepicker"===this.state.input.type?this.state.update=(null!==t?t.toUpperCase():t)!=(e&&e.toUpperCase()):this.state.update=t!=e}}]),l)},{"g3w-i18n":143,"utils/toRawType":257}],28:[function(e,t,a){e={text:e("./service"),textarea:e("./service"),texthtml:e("./service"),integer:e("./integer/service"),string:e("./service"),float:e("./float/service"),radio:e("./radio/service"),check:e("./checkbox/service"),range:e("./range/service"),datetimepicker:e("./datetimepicker/service"),unique:e("./unique/service"),select:e("./select/service"),media:e("./media/service"),select_autocomplete:e("./select/service"),picklayer:e("./service"),color:e("./service"),slider:e("./sliderrange/service"),lonlat:e("./lonlat/service")};t.exports=e},{"./checkbox/service":5,"./datetimepicker/service":8,"./float/service":10,"./integer/service":13,"./lonlat/service":15,"./media/service":17,"./radio/service":21,"./range/service":23,"./select/service":25,"./service":27,"./sliderrange/service":29,"./unique/service":34}],29:[function(e,t,a){var i=function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e};function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=e("gui/inputs/service"),e=(()=>{var e=n,t=r;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);function n(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=this,a=n;if(e instanceof a)return e=t.state,t.state.info="[MIN: "+e.input.options.min+" - MAX: "+e.input.options.max+"]",(a=((e,t)=>{if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")})(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,t))).setValidator({validate:function(e){return(e=+e)>=+t.state.input.options.min&&e<=+t.state.input.options.max}}),a;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t),i(n,[{key:"validate",value:function(){this.state.value=+this.state.value,this.state.validate.valid=this.state.value>=this.state.input.options.min||this.state.value<=this.state.input.options.max}},{key:"changeInfoMessage",value:function(){this.state.info="[MIN: "+this.state.input.options.min+" - MAX: "+this.state.input.options.max+"]"}}]),n})();t.exports=e},{"gui/inputs/service":27}],30:[function(e,t,a){e=(e=>{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t})(e("components/InputSliderRange.vue"));e=Vue.extend(e);t.exports=e},{"components/InputSliderRange.vue":85}],31:[function(e,t,a){e=(e=>{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t})(e("components/InputText.vue"));e=Vue.extend(e);t.exports=e},{"components/InputText.vue":86}],32:[function(e,t,a){e=(e=>{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t})(e("components/InputTextArea.vue"));e=Vue.extend(e);t.exports=e},{"components/InputTextArea.vue":87}],33:[function(e,t,a){e=(e=>{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t})(e("components/InputTextHtml.vue"));e=Vue.extend(e);t.exports=e},{"components/InputTextHtml.vue":88}],34:[function(e,t,a){var i=e("gui/inputs/service");t.exports=(()=>{var e=n,t=i;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,a=n;if(!(t instanceof a))throw new TypeError("Cannot call a class as a function");t=this,a=(n.__proto__||Object.getPrototypeOf(n)).call(this,e);if(t)return!a||"object"!=typeof a&&"function"!=typeof a?t:a;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t),n})()},{"gui/inputs/service":27}],35:[function(e,t,a){e=(e=>{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t})(e("components/InputUnique.vue"));e=Vue.extend(e);t.exports=e},{"components/InputUnique.vue":89}],36:[function(e,t,a){var s,n,l,u,i,r,c,o,d,p,f,g,h,y,m,v,_,b,w;e("vueify/lib/insert-css").insert("@keyframes sk-bounce{0%,to{transform:scale(0)}50%{transform:scale(1)}}#startingspinner{position:fixed;z-index:100000;height:10em;width:10em;overflow:show;margin:auto;inset:0}#startingspinner .double-bounce1,#startingspinner .double-bounce2{width:100%;height:100%;border-radius:50%;background-color:var(--skin-color);opacity:.6;position:absolute;top:0;left:0;animation:sk-bounce 2s infinite ease-in-out}#startingspinner .double-bounce2{animation-delay:-1s}.g3w-modal-project-message.Info .modal-header{background-color:#0073b7}.g3w-modal-project-message.Warning .modal-header{background-color:#e99611}.g3w-modal-project-message.Error .modal-header{background-color:#dd4b39}.g3w-modal-project-message.Critical .modal-header{background-color:#605ca8}.g3w-modal-project-message h4.modal-title{color:#fff!important}.g3w-languages .select2-container--default .select2-selection--single{background:none;border:none}.g3w-languages .select2-container--default .select2-selection--single .select2-selection__arrow b{border-color:#fff transparent transparent}.g3w-languages .select2-container--default.select2-container--open .select2-selection--single .select2-selection__arrow b{border-color:transparent transparent #fff}.g3w-languages .select2-container--default .select2-selection--single .select2-selection__rendered{color:#fff!important}@media (min-width:768px){.g3w-languages .select2-container{right:0;left:auto!important}}\n#g3w-small-screen-hamburger-sidebar[data-v-6659a6eb]{display:none}.logo-wrapper[data-v-6659a6eb]{display:flex;max-height:50px;height:50px;font-weight:700;align-items:center;color:#fff}.logo-wrapper a.project_logo_link[data-v-6659a6eb]{height:46px;padding:2px}.logo-wrapper a.project_logo_link img[data-v-6659a6eb]{height:100%}.project_title_content[data-v-6659a6eb]{display:flex;flex-direction:column;justify-content:center;height:100%}.project_title_content>div[data-v-6659a6eb]{white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.project_title_content .main_title[data-v-6659a6eb]{font-size:1.6em}.project_title_content .sub_title[data-v-6659a6eb]{font-size:1.3em}@media (max-width:767px){.logo-wrapper[data-v-6659a6eb]{padding-left:5px}}.logo-wrapper.mobile[data-v-6659a6eb]{padding:5px}.logo-wrapper.mobile img[data-v-6659a6eb]{height:23px;max-width:150px!important;padding-left:0;margin-right:5px}.logo-wrapper.mobile .main_title[data-v-6659a6eb]{font-size:1.1em}.logo-wrapper.mobile .sub_title[data-v-6659a6eb]{font-size:1em}.project_title_content.mobile[data-v-6659a6eb]{margin-top:2px}.project_title_content.mobile .sub_title[data-v-6659a6eb]{height:auto}.credit-title-logo[data-v-6659a6eb]{font-weight:700;font-size:1.2em;margin-bottom:15px}.g3w-credits-block[data-v-6659a6eb]{text-align:center!important;margin-bottom:20px}.g3w-suite-logo[data-v-6659a6eb]{width:50%!important}.customcredits[data-v-6659a6eb]{margin-bottom:10px;margin-top:5px}#address-credits span[data-v-6659a6eb]{padding-left:3px}#g3w-sidebarpanel-header-placeholder[data-v-6659a6eb]{overflow:hidden;line-height:14px;font-size:1.5em;min-height:35px;border-bottom:1px solid #fff;margin-bottom:5px}#disable-sidebar[data-v-6659a6eb]{display:none;position:absolute;background-color:rgba(0,0,0,.3);height:100%;width:100%;z-index:10}.content_breadcrumb[data-v-6659a6eb]{font-size:1.2em;padding:0 3px;border-radius:3px}.close-panel-block[data-v-6659a6eb]{overflow:hidden;margin-top:2px;margin-bottom:2px;font-size:1.4em}.g3w_contents_back[data-v-6659a6eb]{font-size:.8em}.g3w_contents_back [data-v-6659a6eb]:is(.backto,.back){display:inline-block;font-weight:700}.g3w_contents_back .backto[data-v-6659a6eb]{margin-top:5px;cursor:pointer}.user-header[data-v-6659a6eb]{background-color:var(--skin-color);height:175px;padding:10px;text-align:center}.user-header>p[data-v-6659a6eb]{z-index:5;color:#fff;color:hsla(0,0%,100%,.8);font-size:17px;margin-top:10px}.user-footer[data-v-6659a6eb]{background-color:#f9f9f9;padding:10px;display:flex;justify-content:space-between}.user-footer .btn-default[data-v-6659a6eb]{color:#666}@media (max-width:767px){#g3w-small-screen-hamburger-sidebar[data-v-6659a6eb]{display:block}.user-footer .btn-default[data-v-6659a6eb]:hover{background-color:#f9f9f9}.user-header[data-v-6659a6eb]{display:none}}");function x(e){return e&&e.__esModule?e:{default:e}}function k(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),s=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=x(e("vue-cookie-law")),l=e("g3w-constants"),u=x(e("store/application")),i=x(e("g3w-panel")),r=x(e("g3w-component")),c=x(e("services/gui")),o=e("mixins"),d=x(e("components/HeaderItem.vue")),p=x(e("components/UserMessage.vue")),f=x(e("components/CatalogContextMenu.vue")),g=x(e("utils/getUniqueDomId")),h=e("utils/XHR"),y=e("utils/promisify"),w=e("g3w-i18n").t,a.default={name:"app",mixins:[o.resizeMixin],data:function(){return{customcredits:!1,current_custom_modal_content:null,language:null,cookie_law_buttonText:w("cookie_law.buttonText"),app:u.default,state:u.default.viewport,updatePreviousTitle:!1,header:w("main navigation")}},components:{HeaderItem:d.default,CookieLaw:n.default,userMessage:p.default,CatalogContextMenu:f.default},computed:{languages:function(){var e;return 1<(e=Array.isArray(this.appconfig.i18n)&&this.appconfig.i18n||[]).length&&e},dropdownParent:function(){return 768<=window.innerWidth},appconfig:function(){return window.initConfig},isIframe:function(){return window.top!==window.self},urls:function(){return this.appconfig.urls},powered_by:function(){return this.appconfig.powered_by},logo_url:function(){return u.default.project.state.thumbnail||""+this.appconfig.mediaurl+this.appconfig.logo_img},project_title:function(){return u.default.project.getState().name},user:function(){return this.appconfig.user&&this.appconfig.user.username?this.appconfig.user:null},login_url:function(){return this.appconfig.user.login_url},hasRelatedMaps:function(){return 1<this.appconfig.macrogroups.length+this.appconfig.groups.length+this.appconfig.projects.length},main_title:function(){var e=this.appconfig.main_map_title,t=this.appconfig.title||this.appconfig.slug;return e?e+" - "+t:t},breadcrumb:function(){return this.state.content.contentsdata.filter(function(e){return e.options.crumb}).map(function(e){return e.options.crumb})},showresize:function(){var e=u.default.gui.layout[u.default.gui.layout.__current].rightpanel["h"===this.state.split?"width":"height"];return this.state.resized.start&&0<this.state.secondaryPerc&&this.state.secondaryPerc<100&&e<100&&0<e},showresizeicon:function(){return 100!==this.state.secondaryPerc},usermessage:function(){return this.state.usermessage},showtitle:function(){if(0<this.state.content.contentsdata.length){var e=this.state.content.contentsdata[this.state.content.contentsdata.length-1].options;if(!0===e.showtitle||!1===e.showtitle)return e.showtitle}return!0},styles:function(){return{map:{width:this.state.map.sizes.width+"px",height:this.state.map.sizes.height+"px"},content:{width:this.state.content.sizes.width+"px",height:this.state.content.sizes.height+"px",zIndex:3,minHeight:"v"===this.state.split?l.VIEWPORT.resize.content.min+"px":null,paddingTop:"8px",paddingBottom:"8px"}}},contentTitle:function(){var e;if(this.state.content.contentsdata.length)return{title:(e=this.state.content.contentsdata[this.state.content.contentsdata.length-1].options).title,post_title:e.post_title,text:void 0!==(e=e.text)&&e}},backOrBackTo:function(){return!!(1<this.state.content.contentsdata.length&&this.state.content.showgoback)&&(this.state.content.contentsdata[this.state.content.contentsdata.length-2].options.title?"backto":"back")},previousTitle:function(){var e=this,t=1<this.state.content.contentsdata.length&&this.state.content.showgoback?this.state.content.contentsdata[this.state.content.contentsdata.length-2].options.title:null;return this.updatePreviousTitle=!0,this.$nextTick(function(){return e.updatePreviousTitle=!1}),t},title:function(){return u.default.sidebar.title},disabled:function(){return u.default.gui.sidebar.disabled},panels:function(){return u.default.sidebar.contentsdata},showmainpanel:function(){return 0<u.default.sidebar.components.length&&!this.panels.length},componentname:function(){return u.default.sidebar.components.length?u.default.sidebar.components.slice(-1)[0].getTitle():""},panelname:function(){return this.panels.length?this.panels.slice(-1)[0].content.getTitle():""}},methods:{templateResultLanguages:function(e){return e.id?$('\n        <div style="font-weight: bold; display:flex; align-items: center; justify-content: space-around;">\n          <img src="'+this.urls.staticurl+"img/flags/"+e.element.value.toLowerCase()+'.png" />\n          <span style="margin-left: 5px;">'+e.text+"</span> \n        </span>"):e.text},resize:(b=k(function*(){var e;this.isIframe||(yield this.$nextTick(),e=0<this.$refs.navbar_toggle.offsetWidth?this.$refs.navbar.offsetWidth-this.$refs.navbar_toggle.offsetWidth:this.$refs.mainnavbar.offsetWidth-this.$refs["app-navbar-nav"].offsetWidth,this.$refs.main_title_project_title.style.maxWidth=e-this.logoWidth-15+"px")}),function(){return b.apply(this,arguments)}),showCustomModalContent:function(t){this.current_custom_modal_content=this.custom_modals.find(function(e){return e.id===t}).content},getLogoLink:function(){return this.appconfig.logo_link||null},initDialogMessages:(_=k(function*(){var r=u.default.project.state.messages;if(r)for(var o=u.default.project.getId(),e=function*(e){var t=r.items[e],e=window.localStorage.getItem(l.LOCAL_ITEM_IDS.MESSAGES.id),a=(e?JSON.parse(e):void 0)||l.LOCAL_ITEM_IDS.MESSAGES.value;if(void 0===a[o]&&(a[o]=[]),void 0!==a[o].find(function(e){return e===t.id}))return"continue";var n=new(Vue.extend({data:function(){return{id:(0,g.default)(),checked:!1}},template:'\n            <div style="display: flex; margin-top: 10px;">\n              <input :id="id"\n                v-model="checked"\n                class="magic-checkbox"\n                type="checkbox"/>\n              <label :for="id" v-t="\'dont_show_again\'"/>\n            </div>\n          '})),i=document.createElement("div");i.append.apply(i,(e=>{if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)})((new DOMParser).parseFromString(t.body,"text/html").body.childNodes)),i.append(n.$mount().$el),yield new Promise(function(e){c.default.showModalDialog({title:t.title,message:i,size:"large",closeButton:!1,className:"g3w-modal-project-message "+Object.entries(r.levels).find(function(e){e=s(e,2);e[0];return e[1]===t.level})[0],buttons:{close:{label:w("close"),className:"btn-secondary",callback:function(){try{n.checked&&(a[o].push(t.id),window.localStorage.setItem(l.LOCAL_ITEM_IDS.MESSAGES.id,JSON.stringify(a)))}catch(e){}e()}}}})})},t=0;t<r.items.length;t++)yield*e(t)}),function(){return _.apply(this,arguments)}),openChangeMapMenu:function(){c.default.getComponent("contents").getComponentById("changemapmenu")?c.default.closeContent():(this.isMobile()&&(c.default.hideSidebar(),$("#main-navbar.navbar-collapse").removeClass("in")),c.default.closeSideBar(),c.default.setContent({content:new r.default({id:"changemapmenu",vueComponentObject:e("components/ChangeMapMenu.vue")}),title:"",perc:100}))},isNotLastCrumb:function(e){return e<this.breadcrumb.length-1},closeContent:function(){c.default.closeContent()},gotoPreviousContent:function(){c.default.popContent()},closeUserMessage:function(){c.default.closeUserMessage()},moveFnc:function(e){e.preventDefault();var t="h"===this.state.split?"width":"height",a="width"==t?$(".sidebar-collapse").length?0:u.default.viewport.SIDEBARWIDTH:$("#main-navbar").height(),n=$(this.$el)[t](),t=("width"==t?e.pageX+2:e.pageY+2)-a,e=l.VIEWPORT.resize,a=e.content,e=e.map;t>n-a.min?t=n-a.min:t<e.min&&(t=e.min),u.default.viewport.resized[this.state.split]=!0,u.default.gui.layout[u.default.gui.layout.__current].rightpanel["h"===this.state.split?"width":"height"]=100-Math.round(t/n*100),c.default._layout("resize")},closePanel:function(){c.default.closePanel()},closeAllPanels:(v=k(function*(){u.default.sidebar.title=null;var t,e=u.default.sidebar.contentsdata;e.length&&(yield Promise.allSettled(e.map((t=k(function*(e){e.content instanceof r.default||e.content instanceof i.default?yield(0,y.promisify)(e.content.unmount()):$(u.default.sidebar.parent).empty()}),function(e){return t.apply(this,arguments)}))),e.splice(0,e.length))}),function(){return v.apply(this,arguments)}),toggleSidebar:function(){c.default.toggleSidebar()},toggleSidebarItem:function(e){var t=document.body.classList.contains("sidebar-mini"),a=document.body.classList.contains("sidebar-collapse"),n=(t&&a&&c.default.showSidebar(),e.target.closest(".sidebaritem")),t=u.default.sidebar.components.find(function(e){return e.id===n.id}),i=t&&t.getOpen(),r=n.querySelector(".treeview-menu");!t||i&&a||r&&r.contains(e.target)||(!t.collapsible&&window.innerWidth<=767&&c.default.toggleSidebar(),t.click({open:!i}))},setImgOffset:function(){this.isIframe||(this.logoWidth=this.$refs.img_logo.offsetWidth+15,this.resize())}},watch:{language:function(e,t){t&&(i18next.changeLanguage(e),u.default.lng=e,u.default.language=e,(t=window.location.pathname.split("/"))[1]=e,history.replaceState(null,null,t.join("/")),this.cookie_law_buttonText=w("cookie_law.buttonText"))}},beforeCreate:function(){this.delayType="debounce",this.delayTime=0},created:function(){var a=this;this.language=this.appconfig.user.i18n,this.custom_modals=[],this.custom_headers={0:[],1:[],2:[],3:[],4:[]},this.customlinks=Array.isArray(this.appconfig.header_custom_links)?this.appconfig.header_custom_links.filter(function(e){var t;return null!==e!==null&&(t=e.id=(0,g.default)(),"modal"===e.type&&a.custom_modals.push({id:t,content:e.content}),t=4<(t=+(e.position||0))?4:t<0||Number.isNaN(t)?0:t,a.custom_headers[t].push(e),!0)}):[],this.appconfig.credits&&h.XHR.get({url:this.appconfig.credits}).then(function(e){return a.customcredits="None"!==e&&e}).catch(function(e){})},mounted:(m=k(function*(){this.initDialogMessages(),this.logoWidth=0,yield this.$nextTick(),this.rightNavbarWidth=Array.from(this.isIframe?[]:this.$refs.mainnavbar.getElementsByTagName("ul")).reduce(function(e,t){return e+t.offsetWidth},15),this.language=this.appconfig.user.i18n,yield this.$nextTick(),$("#startingspinner").remove();function e(){$(".main-sidebar").css("height",$(window).height()-$(".navbar-header").height()),$(".g3w-sidebarpanel").css("height",$(window).height()-$("#main-navbar").height())}e(),$(window,".wrapper").resize(e),this.iframe=u.default.iframe,this.iframe||document.body.classList.add("sidebar-mini"),document.body.classList.toggle("is-mobile",this.isMobile()),document.body.classList.toggle("is-iframe",this.iframe),yield this.$nextTick(),this.state.resized.start=!0}),function(){return m.apply(this,arguments)})},t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var a=this,e=a.$createElement,n=a._self._c||e;return n("div",{directives:[{name:"disabled",rawName:"v-disabled",value:a.app.gui.app.disabled,expression:"app.gui.app.disabled"}],staticClass:"wrapper",attrs:{id:"app"}},[n("cookie-law",{attrs:{theme:"dark-lime",buttonText:a.cookie_law_buttonText}},[n("div",{directives:[{name:"t",rawName:"v-t",value:"cookie_law.message",expression:"'cookie_law.message'"}],attrs:{slot:"message"},slot:"message"})]),a._v(" "),a.isIframe?a._e():n("header",{staticClass:"main-header"},[n("nav",{ref:"navbar",staticClass:"navbar navbar-inverse navbar-fixed-top",attrs:{role:"navigation"}},[n("div",{staticClass:"container-fluid"},[n("div",{staticClass:"navbar-header"},[n("button",{ref:"navbar_toggle",staticClass:"navbar-toggle",attrs:{type:"button","data-toggle":"collapse","data-target":"#main-navbar"}},[n("i",{class:a.g3wtemplate.getFontClass("ellips-v"),staticStyle:{"font-size":"1.3em"}})]),a._v(" "),n("a",{staticClass:"sidebar-toggle",attrs:{id:"g3w-small-screen-hamburger-sidebar",href:"#",role:"button"},on:{click:function(e){return e.preventDefault(),a.toggleSidebar(e)}}},[n("i",{class:a.g3wtemplate.getFontClass("bars"),staticStyle:{"font-size":"1.3em"}})]),a._v(" "),n("div",{staticClass:"logo-wrapper",class:{mobile:a.isMobile()}},[a.logo_url?n("a",{staticClass:"project_logo_link",attrs:{href:a.getLogoLink()||"#",target:a.getLogoLink()?"_blank":""}},[n("img",{ref:"img_logo",staticClass:"img-responsive",staticStyle:{"max-width":"250px"},attrs:{alt:"",src:a.logo_url},on:{load:a.setImgOffset}})]):a._e(),a._v(" "),n("div",{ref:"main_title_project_title",staticClass:"project_title_content",class:{mobile:a.isMobile()}},[n("div",{staticClass:"main_title"},[a._v(a._s(a.main_title))]),a._v(" "),n("div",{staticClass:"sub_title"},[a._v(a._s(a.project_title))])])])]),a._v(" "),n("div",{ref:"mainnavbar",staticClass:"collapse navbar-collapse",staticStyle:{"text-align":"center",overflow:"hidden",margin:"0 0"},attrs:{id:"main-navbar"}},[n("ul",{staticClass:"nav navbar-nav navbar-right"},a._l(a.app.navbaritems,function(e){return n(e,{key:e.id,tag:"li"})}),1),a._v(" "),n("ul",{ref:"app-navbar-nav",staticClass:"nav navbar-nav navbar-right app-navbar-nav"},[a.user?a._e():n("li",{staticClass:"dropdown user user-menu"},[n("a",{attrs:{href:a.login_url}},[n("i",{class:a.g3wtemplate.getFontClass("sign-in"),attrs:{"aria-hidden":"true"}}),a._v(" "),n("span",{directives:[{name:"t",rawName:"v-t",value:"sign_in",expression:"'sign_in'"}]})])]),a._v(" "),a._l(a.custom_headers[0],function(e){return n("header-item",{key:e.id,attrs:{state:e},on:{"show-custom-modal-content":a.showCustomModalContent}})}),a._v(" "),a.hasRelatedMaps?n("li",{staticClass:"dropdown user",attrs:{id:"changemaps"}},[n("a",{staticClass:"dropdown-toggle",attrs:{href:"#","data-toggle":"dropdown"},on:{click:function(e){return e.stopPropagation(),a.openChangeMapMenu(e)}}},[n("i",{class:a.g3wtemplate.getFontClass("change-map"),attrs:{"aria-hidden":"true"}}),a._v(" "),n("span",{directives:[{name:"t",rawName:"v-t",value:"changemap",expression:"'changemap'"}]})])]):a._e(),a._v(" "),a._l(a.custom_headers[1],function(e){return n("header-item",{key:e.id,attrs:{state:e},on:{"show-custom-modal-content":a.showCustomModalContent}})}),a._v(" "),a.user?n("li",{staticClass:"dropdown user user-menu"},[n("a",{staticClass:"dropdown-toggle",attrs:{href:"#","data-toggle":"dropdown"}},[n("i",{class:a.g3wtemplate.getFontClass("user")}),a._v(" "),n("span",{staticClass:"hidden-xs"},[a._v(a._s(a.user.username))])]),a._v(" "),n("ul",{staticClass:"dropdown-menu"},[n("li",{staticClass:"user-header"},[n("p",[a._v("\n                    "+a._s(a.user.first_name)+" "+a._s(a.user.last_name)+"\n                  ")])]),a._v(" "),n("li",{staticClass:"user-footer"},[a.user.admin_url?n("a",{staticClass:"btn btn-default btn-flat skin-color",attrs:{href:a.user.admin_url}},[n("i",{class:a.g3wtemplate.getFontClass("folder")}),a._v(" "),n("b",[a._v("Admin")])]):a._e(),a._v(" "),n("a",{staticClass:"btn btn-default btn-flat skin-color",attrs:{href:a.user.logout_url}},[n("i",{class:a.g3wtemplate.getFontClass("sign-out"),staticStyle:{"margin-right":"2px"}}),a._v(" "),n("b",{directives:[{name:"t",rawName:"v-t",value:"logout",expression:"'logout'"}]})])])])]):a._e(),a._v(" "),a._l(a.custom_headers[2],function(e){return n("header-item",{key:e.id,attrs:{state:e},on:{"show-custom-modal-content":a.showCustomModalContent}})}),a._v(" "),a._m(0),a._v(" "),a._l(a.custom_headers[3],function(e){return n("header-item",{key:e.id,attrs:{state:e},on:{"show-custom-modal-content":a.showCustomModalContent}})}),a._v(" "),a.urls.frontendurl?n("li",{staticClass:"dropdown"},[n("a",{attrs:{href:a.urls.frontendurl}},[n("span",[n("i",{class:a.g3wtemplate.getFontClass("home")}),a._v(" Home\n                ")])])]):a._e(),a._v(" "),a.languages?n("li",{staticClass:"g3w-languages"},[n("select",{directives:[{name:"select2",rawName:"v-select2",value:"language",expression:"'language'"},{name:"model",rawName:"v-model",value:a.language,expression:"language"}],staticClass:"form-control",staticStyle:{cursor:"pointer",width:"130px"},attrs:{templateSelection:a.templateResultLanguages,templateResult:a.templateResultLanguages,dropdownAutoWidth:!0,dropdownParent:a.dropdownParent},on:{change:function(e){var t=Array.prototype.filter.call(e.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});a.language=e.target.multiple?t:t[0]}}},a._l(a.languages,function(e){return n("option",{key:e[0],domProps:{value:e[0],selected:e[0]===a.language&&"selected"}},[a._v("\n                  "+a._s(e[1])+"\n                ")])}),0)]):a._e(),a._v(" "),a._l(a.custom_headers[4],function(e){return n("header-item",{key:e.id,attrs:{state:e},on:{"show-custom-modal-content":a.showCustomModalContent}})})],2)])])])]),a._v(" "),n("aside",[n("div",{staticClass:"main-sidebar",class:{iframe:a.iframe,"g3w-disabled":a.disabled}},[n("div",{attrs:{id:"disable-sidebar"}}),a._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:0<a.panels.length,expression:"panels.length > 0"}],staticClass:"g3w-sidebarpanel"},[n("div",{attrs:{id:"g3w-sidebarpanel-header-placeholder"}},[n("div",{staticStyle:{display:"flex"},style:{justifyContent:a.app.sidebar.title?"space-between":"flex-end"}},[a.title?n("h4",{directives:[{name:"t",rawName:"v-t",value:a.title,expression:"title"}],staticStyle:{display:"inline-block","font-weight":"bold"}}):a._e(),a._v(" "),n("div",[1<a.panels.length?n("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip.create",value:"back",expression:"'back'",modifiers:{create:!0}}],staticClass:"skin-tooltip-left g3w-span-button close-pane-button fa-stack",attrs:{"data-placement":"left","data-toggle":"tooltip","data-container":"body"},on:{click:a.closePanel}},[n("i",{staticClass:"fa-stack-1x panel-button",class:a.g3wtemplate.getFontClass("circle")}),a._v(" "),n("i",{staticClass:"fa-stack-1x panel-icon",class:a.g3wtemplate.getFontClass("arrow-left")})]):a._e(),a._v(" "),n("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip.create",value:"close",expression:"'close'",modifiers:{create:!0}}],staticClass:"skin-tooltip-left g3w-span-button close-pane-button fa-stack",attrs:{"data-placement":"left","data-toggle":"tooltip","data-container":"body"},on:{click:a.closeAllPanels}},[n("i",{staticClass:"fa-stack-1x panel-button",class:a.g3wtemplate.getFontClass("circle")}),a._v(" "),n("i",{staticClass:"fa-stack-1x panel-icon",class:a.g3wtemplate.getFontClass("close")})])])])]),a._v(" "),n("div",{staticClass:"g3w-sidebarpanel-placeholder",attrs:{id:"g3w-sidebarpanel-placeholder"}})]),a._v(" "),n("ul",{directives:[{name:"show",rawName:"v-show",value:a.showmainpanel,expression:"showmainpanel"}],staticClass:"sidebar-menu",class:{"g3w-disabled":a.disabled},attrs:{id:"g3w-sidebarcomponents"},on:{click:a.toggleSidebarItem}})]),a._v(" "),n("a",{staticClass:"sidebar-aside-toggle",class:{"g3w-disabled":a.disabled,iframe:a.iframe},style:{zIndex:4},attrs:{href:"#",role:"button"},on:{click:function(e){return e.preventDefault(),a.toggleSidebar(e)}}},[n("i",{class:a.g3wtemplate.getFontClass("bars")})])]),a._v(" "),n("div",{staticClass:"content-wrapper",style:{paddingTop:a.isIframe?0:null}},[n("transition",{attrs:{name:"fade",duration:{enter:500,leave:500}}},[a.usermessage.show?n("user-message",{attrs:{title:a.usermessage.title,subtitle:a.usermessage.subtitle,id:a.usermessage.id,message:a.usermessage.message,draggable:a.usermessage.draggable,closable:a.usermessage.closable,duration:a.usermessage.duration,position:a.usermessage.position,autoclose:a.usermessage.autoclose,textMessage:a.usermessage.textMessage,size:a.usermessage.size,type:a.usermessage.type,"icon-class":a.usermessage.iconClass},on:{"close-usermessage":a.closeUserMessage}},[a.usermessage.hooks.header?n("template",{slot:"header"},[n(a.usermessage.hooks.header,{tag:"component"})],1):a._e(),a._v(" "),a.usermessage.hooks.body?n("template",{slot:"body"},[n(a.usermessage.hooks.body,{tag:"component"})],1):a._e(),a._v(" "),a.usermessage.hooks.footer?n("template",{slot:"footer"},[n(a.usermessage.hooks.footer,{tag:"component"})],1):a._e()],2):a._e()],1),a._v(" "),n("div",{staticClass:"g3w-view map",class:"split-"+a.state.split,style:a.styles.map,attrs:{id:"g3w-view-map"}},[n("g3w-resize",{class:"split-"+a.state.split,style:{backgroundColor:"transparent"},attrs:{id:"resize-map-and-content",show:a.showresize,moveFnc:a.moveFnc,orientation:a.state.split}}),a._v(" "),n("div",{attrs:{id:"application-notifications"}},[n("div",{class:{"g3w-hide":a.app.online},staticStyle:{color:"#999"},attrs:{id:"offline_notification"}},[n("i",{class:a.g3wtemplate.getFontClass("wifi")}),a._v(" "),n("div",{staticStyle:{"font-weight":"bold","font-size":"0.4em"}},[a._v("offline")])]),a._v(" "),n("div",{directives:[{name:"download",rawName:"v-download.show",modifiers:{show:!0}}],staticClass:"skin-color",attrs:{id:"download_notification",title:"DOWNLOAD"}},[n("bar-loader",{attrs:{loading:!0}}),a._v(" "),n("i",{class:a.g3wtemplate.getFontClass("download"),staticStyle:{padding:"3px"}})],1),a._v(" "),n("div",{class:{"g3w-hide":0===a.app.plugins.length},staticStyle:{color:"#994b10"},attrs:{id:"plugins_notification"}},[n("bar-loader",{attrs:{loading:!0}}),a._v(" "),n("i",{class:a.g3wtemplate.getFontClass("plugin")})],1)])],1),a._v(" "),n("div",{directives:[{name:"disabled",rawName:"v-disabled",value:a.state.content.disabled,expression:"state.content.disabled"}],staticClass:"g3w-view content",class:"split-"+a.state.split,style:a.styles.content,attrs:{id:"g3w-view-content"}},[1<a.breadcrumb.length?n("section",{ref:a.breadcrumb,staticClass:"content_breadcrumb"},a._l(a.breadcrumb,function(e,t){return n("span",{key:e.title},[n("span",{directives:[{name:"t",rawName:"v-t",value:e.text?null:e.title,expression:"crumb.text ? null : crumb.title"}],staticClass:"skin-color-dark",style:{fontWeight:a.isNotLastCrumb(t)?"bold":"normal"}},[e.text?n("span",[a._v(" "+a._s(e.title)+" ")]):a._e()]),a._v(" "),a.isNotLastCrumb(t)?n("span",{staticStyle:{"font-weight":"bold",margin:"3px 0"}},[a._v("/")]):a._e()])}),0):a._e(),a._v(" "),a.showtitle&&a.contentTitle||a.previousTitle||a.state.content.closable&&a.state.content.aside?n("div",{staticClass:"close-panel-block",staticStyle:{display:"flex","justify-content":"space-between"}},[a.previousTitle?n("div",{staticClass:"g3w_contents_back g3w-long-text"},["back"===a.backOrBackTo?n("div",{class:a.backOrBackTo},[n("span",{staticClass:"action-button",class:a.g3wtemplate.getFontClass("back")}),a._v(" "),n("span",{directives:[{name:"t",rawName:"v-t",value:"back",expression:"'back'"}]})]):n("div",{class:a.backOrBackTo,on:{click:function(e){return e.stopPropagation(),a.gotoPreviousContent()}}},[n("span",{staticClass:"action-button",class:a.g3wtemplate.getFontClass("back")}),a._v(" "),n("span",{directives:[{name:"t",rawName:"v-t",value:"backto",expression:"'backto'"}]}),a._v(" "),a.updatePreviousTitle?a._e():n("span",{directives:[{name:"t",rawName:"v-t",value:a.previousTitle,expression:"previousTitle"}]})])]):a._e(),a._v(" "),!a.previousTitle&&a.showtitle&&a.contentTitle?n("div",{staticClass:"panel-title",class:{mobile:a.isMobile()},style:[a.state.content.style.title]},[n("span",{attrs:{id:"contenttitle"}},[n("span",{directives:[{name:"t",rawName:"v-t",value:a.contentTitle.text?null:a.contentTitle.title,expression:"contentTitle.text ? null : contentTitle.title"}]},[a.contentTitle.text?n("span",[a._v(a._s(a.contentTitle.title))]):a._e()]),a._v(" "),n("span",{directives:[{name:"t",rawName:"v-t",value:a.contentTitle.post_title,expression:"contentTitle.post_title"}]})])]):a._e(),a._v(" "),n("div",{staticClass:"g3-content-header-action-tools",staticStyle:{display:"flex","align-items":"center"}},[a._l(a.state.content.headertools,function(e){return n(e,{tag:"component"})}),a._v(" "),a.showresizeicon?n("resize-icon",{staticStyle:{"font-size":"1em",padding:"0","align-self":"center","margin-left":"auto"},style:{marginRight:a.state.content.closable?"5px":"0px"},attrs:{type:a.state.split}}):a._e(),a._v(" "),a.state.content.closable&&a.state.content.aside?n("span",{staticClass:"action-button",class:{mobile:a.isMobile()},staticStyle:{display:"flex","justify-content":"center"},on:{click:a.closeContent}},[n("i",{staticClass:"skin-color-dark",class:a.g3wtemplate.getFontClass("close")})]):a._e()],2)]):a._e(),a._v(" "),n("bar-loader",{attrs:{loading:a.state.content.loading}})],1)],1),a._v(" "),n("catalog-context-menu"),a._v(" "),n("div",{staticClass:"modal fade modal-fullscreen force-fullscreen",attrs:{id:"full-screen-modal",tabindex:"-1",role:"dialog","data-backdrop":"static","data-keyboard":"false","aria-labelledby":"full-screen-modal","aria-hidden":"true"}}),a._v(" "),n("div",{staticClass:"modal fade",attrs:{id:"credits"}},[n("div",{staticClass:"modal-dialog",attrs:{role:"document"}},[n("div",{staticClass:"modal-content"},[n("div",{staticClass:"modal-header"},[a._m(1),a._v(" "),n("div",{staticStyle:{display:"flex","flex-direction":"column","justify-content":"space-around","justify-items":"center","align-items":"center"}},[a.customcredits?n("div",{staticClass:"customcredits",domProps:{innerHTML:a._s(a.customcredits)}}):a._e(),a._v(" "),a.powered_by?n("div",[n("div",{staticClass:"g3w-credits-block"},[n("div",{directives:[{name:"t",rawName:"v-t",value:"credits.g3wSuiteFramework",expression:"'credits.g3wSuiteFramework'"}],staticClass:"credit-title-logo",staticStyle:{"background-color":"#95ad36",padding:"5px","border-radius":"3px",color:"#ffffff"}}),a._v(" "),n("a",{attrs:{target:"_blank",href:"https://g3wsuite.it/"}},[n("img",{staticClass:"g3w-suite-logo",attrs:{src:a.urls.clienturl+"images/g3wsuite_logo.png",alt:""}})]),a._v(" "),n("div",{directives:[{name:"t",rawName:"v-t",value:"credits.g3wSuiteDescription",expression:"'credits.g3wSuiteDescription'"}],staticStyle:{"margin-top":"10px"}})]),a._v(" "),n("div",{directives:[{name:"t",rawName:"v-t:pre",value:"credits.productOf",expression:"'credits.productOf'",arg:"pre"}],staticClass:"credit-title-logo g3w-credits-block",staticStyle:{"font-size":"1em",display:"flex","justify-content":"center"}},[n("a",{staticStyle:{"text-align":"center!important"},attrs:{href:"http://www.gis3w.it",target:"_blank"}},[n("img",{staticClass:"img-responsive center-block",staticStyle:{"margin-left":"5px"},attrs:{width:"60",src:a.urls.clienturl+"images/logo_gis3w_156_85.png",alt:""}})])]),a._v(" "),n("address",{staticStyle:{"line-height":"1.3","text-align":"center","margin-top":"5px",display:"flex","justify-content":"center"},attrs:{id:"address-credits"}},[n("span",{staticStyle:{padding:"2px"}},[n("span",{class:a.g3wtemplate.getFontClass("marker"),staticStyle:{color:"#95ad36","font-weight":"bold"},attrs:{"aria-hidden":"true"}}),a._v(" Montecatini Terme - Italy\n                ")]),a._v(" "),n("span",{staticStyle:{padding:"2px"}},[n("span",{class:a.g3wtemplate.getFontClass("mobile"),staticStyle:{color:"#95ad36"},attrs:{"aria-hidden":"true"}}),a._v("  +39 393 8534336\n                ")]),a._v(" "),n("span",{staticStyle:{padding:"2px"}},[n("span",{class:a.g3wtemplate.getFontClass("mail"),staticStyle:{color:"#95ad36"},attrs:{"aria-hidden":"true"}}),a._v(" "),n("a",{staticStyle:{color:"#000000"},attrs:{href:"mailto:info@gis3w.it"}},[a._v(" info@gis3w.it")])])])]):a._e()])])])])]),a._v(" "),n("div",{staticClass:"modal fade",attrs:{id:"custom_modal"}},[n("div",{staticClass:"modal-dialog",attrs:{role:"document"}},[n("div",{staticClass:"modal-content",domProps:{innerHTML:a._s(a.current_custom_modal_content)}})])])],1)},a.staticRenderFns=[function(){var e=this.$createElement,e=this._self._c||e;return e("li",{staticClass:"dropdown user user-menu"},[e("a",{staticClass:"dropdown-toggle",attrs:{href:"#","data-toggle":"modal","data-target":"#credits"}},[e("span",[this._v("Credits")])])])},function(){var e=this.$createElement,e=this._self._c||e;return e("button",{staticClass:"close",staticStyle:{color:"#ffffff","font-weight":"bold",opacity:"1",position:"absolute",right:"25px",top:"20px"},attrs:{type:"button","data-dismiss":"modal","aria-label":"Close"}},[e("span",{attrs:{"aria-hidden":"true"}},[this._v("×")])])}],a._scopeId="data-v-6659a6eb"},{"components/CatalogContextMenu.vue":39,"components/ChangeMapMenu.vue":42,"components/HeaderItem.vue":70,"components/UserMessage.vue":122,"g3w-component":139,"g3w-constants":140,"g3w-i18n":143,"g3w-panel":145,mixins:180,"services/gui":188,"store/application":193,"utils/XHR":196,"utils/getUniqueDomId":232,"utils/promisify":247,"vue-cookie-law":"vue-cookie-law","vueify/lib/insert-css":2}],37:[function(e,t,a){var n,i,r,o,s,l,u,c,d,p,f,g,h;e("vueify/lib/insert-css").insert(".tabbable-line>.nav-tabs>li.active{border-bottom:4px solid var(--skin-color)}.catalog #legend div.selected,.catalog .tree-item.selected{background-color:var(--skin-color)}.catalog-context-menu li.title{border-bottom-color:var(--skin-color)!important}.skin-blue .tabbable-line>.nav-tabs>li:is(.open,:hover){border-bottom:4px solid #6abbea}.skin-blue .tabbable-line.tabs-below>.nav-tabs>li:hover{border-top:4px solid #6abbea}.skin-blue .tabbable-line.tabs-below>.nav-tabs>li.active{border-top:4px solid #f3565d}.skin-green .tabbable-line>.nav-tabs>li:is(.open,:hover){border-bottom:4px solid #00ff8e}.skin-green .tabbable-line.tabs-below>.nav-tabs>li:hover{border-top:4px solid #00ff8e}.skin-green .tabbable-line.tabs-below>.nav-tabs>li.active{border-top:4px solid #f3565d}.skin-purple .tabbable-line>.nav-tabs>li:is(.open,:hover){border-bottom:4px solid #a19dff}.skin-purple .tabbable-line.tabs-below>.nav-tabs>li:hover{border-top:4px solid #a19dff}.skin-purple .tabbable-line.tabs-below>.nav-tabs>li.active{border-top:4px solid #f3565d}.skin-red .tabbable-line>.nav-tabs>li:is(.open,:hover){border-bottom:4px solid #ff5542}.skin-red .tabbable-line.tabs-below>.nav-tabs>li.active,.skin-red .tabbable-line.tabs-below>.nav-tabs>li:hover{border-top:4px solid #ff5542}.skin-yellow .tabbable-line>.nav-tabs>li:is(.open,:hover){border-bottom:4px solid #ffde0d}.skin-yellow .tabbable-line.tabs-below>.nav-tabs>li:hover{border-top:4px solid #ffde0d}.skin-yellow .tabbable-line.tabs-below>.nav-tabs>li.active{border-top:4px solid #ffdf12}.tabbable-panel{padding:10px}.tabbable-line>.nav-tabs{border:none;margin:0}.tabbable-line .nav-tabs ul li{color:#fff}.tabbable-line>.nav-tabs>li{margin-right:2px;border-bottom:4px solid #21292d}.tabbable-line>.nav-tabs>li>a{border:0;margin-right:0;color:#fff}.tabbable-line>.nav-tabs>li>a>i{color:#a6a6a6}.tabbable-line>.nav-tabs>li:is(.open,:hover)>a{border:0;background:none!important}.tabbable-line>.nav-tabs>li:is(.open,:hover)>a>i{color:#a6a6a6}.tabbable-line>.nav-tabs>li:is(.open,:hover) .dropdown-menu{margin-top:0}.tabbable-line>.nav-tabs>li.active{position:relative;font-weight:700}.tabbable-line>.nav-tabs>li.active>a{border:0;color:#fff;background-color:#2c3b41}.tabbable-line>.nav-tabs>li.active>a>i{color:#fff}.tabbable-line>.tab-content.catalog-tab-content{margin-top:-3px;border:0;color:#fff;padding:5px 0 0}.portlet .tabbable-line>.tab-content{padding-bottom:0}.tabbable-line.tabs-below>.nav-tabs>li{border-top:4px solid transparent}.tabbable-line.tabs-below>.nav-tabs>li>a{margin-top:0}.tabbable-line.tabs-below>.nav-tabs>li:hover{border-bottom:0;color:#fff}.tabbable-line.tabs-below>.nav-tabs>li.active{margin-bottom:-2px;border-bottom:0}.tabbable-line.tabs-below>.tab-content{margin-top:-10px;border-top:0;border-bottom:1px solid #eee;padding-bottom:15px}.nav-tabs>li.active>a,.nav-tabs>li.active>a:is(:focus,:hover){color:#fff}.catalog>.title{padding:10px;font-weight:700}.catalog ul{line-height:1.5em;list-style-type:none}.catalog .list-group-item{color:#fff;background-color:#2c3b41}.catalog #legend div.selected ul.layer-categories,.catalog .tree-item.selected ul.layer-categories{background-color:#222d32}.catalog #legend div div.tree-node-title,.catalog .tree-item div.tree-node-title{padding-left:3px;cursor:pointer;width:80%;display:inline-flex;justify-content:space-between}.catalog #legend div div.tree-node-title.disabled,.catalog .tree-item div.tree-node-title.disabled{color:#999}.catalog #legend div div.tree-node-title .selection-filter-icon,.catalog .tree-item div.tree-node-title .selection-filter-icon{box-shadow:0 2px 5px rgba(0,0,0,.3);padding:5px;border-radius:3px;margin:0 3px;font-weight:700;color:#fff!important}.catalog #legend div div.tree-node-title .selection-filter-icon.active,.catalog .tree-item div.tree-node-title .selection-filter-icon.active{box-shadow:none;background-color:#384247}.catalog .tree-item{cursor:pointer;margin-bottom:3px}.catalog .tree-item.disabled>span{color:#999}.catalog .root{padding:2px 1px 1px 5px}.catalog .root .tree-item.group{padding-left:1px}.catalog .root.fa-chevron-right{padding-right:5px;padding-left:0}.catalog .root-categories.fa-chevron-right{padding-right:7px}.catalog .root-categories.fa-chevron-down{padding-right:3px}.bold{font-weight:700;color:#fff}.highlightlayer{border-bottom:2px dashed;border-color:#ffb516}.catalog{padding:3px}.catalog .tree-root{padding-left:0}.catalog .tree-root li>.root{padding-left:5px}.catalog .tree-root li.tree-item ul.tree-content-items.root{padding-left:18px}.catalog .tree-root li.tree-item ul.tree-content-items.root>.tree-item.group{padding-left:1px!important}.catalog .tree-root li.tree-item ul.tree-content-items{padding-left:17px;padding-top:2px}.g3w-lendplace-toc{padding-left:23px}.g3w-lendplace-toc.group{padding-left:17px}.g3w-lendplace-toc.root{padding-left:18px}.g3w-lendplace-toc.root>li.itemmarginbottom{margin-left:-13px}.g3w-lendplace-toc.root>li.itemmarginbottom div.layer-legend{padding-left:56px}.g3w-lendplace-toc.root>li.itemmarginbottom>span.child{padding-left:18px!important}.catalog .tree-root span.root.collapse-expande-collapse-icon{width:19px}.catalog .tree-root span.root.collapse-expande-collapse-icon.project-root{width:17px}.catalog .tree-root span.collapse-expande-collapse-icon{width:10px}.catalog span.legend-collapse-expande-collapse-icon{font-size:1.2em}.catalog .child-categories{padding:5px 3px 1px 12px}.catalog .layer-legend{padding:3px 0 0 35px;background-color:#222d32}.catalog .catalalog-nav-tabs{display:flex;flex:1 1 0}.catalog .catalalog-nav-tabs>li{font-size:1em;white-space:normal;display:flex;flex:1 1 0;align-items:stretch}.catalog .catalalog-nav-tabs>li a{padding:10px 0;text-align:center;height:100%;width:100%}.catalog .tree{color:#fff}.catalog .tree.disabled{color:#999;cursor:not-allowed}.catalog .g3w-external_wms_layers-group{padding:5px}.catalog .baselayers .radio{margin:0}#baselayers-content{display:grid;justify-content:center;grid-gap:5px;padding:0;margin:5px}#baselayers-content.mobile{grid-template-columns:repeat(auto-fill,minmax(80px,110px))}#baselayers-content .baseselayer-text{white-space:pre-line;font-weight:700}#baselayers-content .baselayer{cursor:pointer}#baselayers-content .baselayer .baselayer-name{font-weight:700;white-space:pre-line;text-align:center}#catalog #layers ul.g3w-external_layers-group{padding-left:0!important}#catalog #layers ul.g3w-external_layers-group li{padding-left:2px!important}#catalog #layers .sidebar-menu>li>a{border:0}#catalog>a{display:none!important}\n#legend .divider[data-v-f931b03a]{display:block;position:relative;padding:0;margin:8px auto;height:0;width:100%;max-height:0;font-size:1px;line-height:0;clear:both;border:none}.legend-item[data-v-f931b03a]{width:100%;position:relative}.g3w-catalog-layers-group>div[data-v-f931b03a]{border:1px solid #ffffff33;margin:5px}.g3w-catalog-layers-group>div>h4[data-v-f931b03a]{margin:5px;font-weight:700}");function y(e){return e&&e.__esModule?e:{default:e}}function m(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}function v(e,t){return t||0===t?""+e+t:null}Object.defineProperty(a,"__esModule",{value:!0}),c=e("g3w-eventbus"),d=y(e("store/application")),p=y(e("services/gui")),f=e("utils/XHR"),g=e("utils/getCatalogLayerById"),h=y(e("components/CatalogChangeMapThemes.vue")),e=y(e("components/CatalogTristateTree.vue")),a.default={name:"catalog",data:function(){return{state:this.$options.service.state||{},showlegend:!1,currentBaseLayer:null,activeTab:"layers",loading:!1}},components:{CatalogChangeMapThemes:h.default,CatalogTristateTree:e.default},computed:{project:function(){return d.default.project},title:function(){return this.project.state.name},baselayers:function(){return this.project.state.baselayers},hasBaseLayers:function(){return 0<this.project.state.baselayers.length},hasLayers:function(){return 0<this.state.external.vector.length||0<this.state.layerstrees.reduce(function(e,t){return t.tree.length+e},0)||0<this.state.layersgroups.length}},methods:{onLegendError:function(e){e.error=!0,e.loading=!1},onLegendLoad:function(e){e.loading=!1},getLegendSrc:function(){var n=this,i=0<arguments.length&&void 0!==arguments[0]&&arguments[0];"tab"===this.state.legend.place&&this.state.layerstrees.forEach(function(e){var t,a=n._traverseVisibleLayers(e.tree);n.showlegend=n.showlegend||0<a.length,e.tree.forEach((t=m(function*(e){try{i&&(e.legendurls&&0===e.legendurls.length||a.some(function(e){return e.legend.change})||d.default.project.state.context_base_legend)&&a.filter(function(e){return e.legend.change}).forEach(function(e){return e.legend.change=!1}),e.legendurls=yield n._getLegendSrc(a)}catch(e){}}),function(e){return t.apply(this,arguments)}))})},_traverseVisibleLayers:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],a=!0,n=!1,i=void 0;try{for(var r,o=e[Symbol.iterator]();!(a=(r=o.next()).done);a=!0){var s=r.value;null!=s.id&&s.visible&&s.geolayer&&!s.exclude_from_legend&&t.push(s),null!=s.nodes&&(t=t.concat(this._traverseVisibleLayers(s.nodes,t)))}}catch(e){n=!0,i=e}finally{try{!a&&o.return&&o.return()}finally{if(n)throw i}}return t},_getLegendSrc:(u=m(function*(e){var i,r=this,o=[],e=e.filter(function(e){return e.geolayer}),s={GET:{},POST:{}};for(i in e.forEach(function(e){var t=s[e.source&&e.source.url||e.external?"GET":e.ows_method],a=(0,g.getCatalogLayerById)(e.id),n=a?a.getLegendUrl(r.state.legend.config,{all:!d.default.project.state.context_base_legend,format:"image/png",categories:e.categories}):void 0;void 0!==a&&(e.source&&e.source.url?t[n]=[]:(t[a=n.split("LAYER=")[0].split("LEGEND_ON=")[0].split("LEGEND_OFF=")[0]]||(t[a]=[]),t[a].unshift({layerName:n.split("LAYER=")[1],style:(Array.isArray(e.styles)&&e.styles.find(function(e){return e.current})||{name:!1}).name,legend_on:(n.split("LAYER=")[0].split("LEGEND_ON=")[1]||"").replace("&",""),legend_off:(n.split("LAYER=")[0].split("LEGEND_ON=")[0].split("LEGEND_OFF=")[1]||"").replace("&","")})))}),s)for(var t in s[i])yield*function*(e){var t={loading:!0,url:null,error:!1},a=(o.push(t),{LAYERS:[],STYLES:[],LEGEND_ON:[],LEGEND_OFF:[]}),n=((s[i][e]||[]).reduce(function(e,t){return a.LAYERS.push(t.layerName),a.STYLES.push(t.style),t.legend_on&&a.LEGEND_ON.push(t.legend_on),t.legend_off&&a.LEGEND_OFF.push(t.legend_off),a},a),[v("LAYERS=",a.LAYERS.join(",")),v("STYLES=",a.STYLES.join(",")),v("LEGEND_ON=",a.LEGEND_ON.join(",")),v("LEGEND_OFF=",a.LEGEND_OFF.join(",")),v("filtertoken=",d.default.tokens.filtertoken)].filter(function(e){return e}).join("&"));try{t.url="GET"===i?e+(s[i][e].length?n:""):URL.createObjectURL(yield(yield fetch(e.split("?")[0],{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:e.split("?")[1].split("&").filter(function(e){return e.split("=")[0]}).map(function(e){return e.split("=")[0]+"="+encodeURIComponent(e.split("=")[1])}).join("&")+"&"+n})).blob())}catch(e){}t.loading=!1}(t);return o}),function(e){return u.apply(this,arguments)}),getMapThemeFromThemeName:(l=m(function*(t){var e=d.default.project,a=Object.values(e.state.map_themes).flat().find(function(e){return t===e.theme});if(a&&void 0===a.layerstree)try{var n=yield f.XHR.get({url:""+e.urls.map_themes+t+"/"});n.result&&(a.layerstree=n.data)}catch(e){}return a}),function(e){return l.apply(this,arguments)}),setLayersTreePropertiesFromMapTheme:(s=m(function*(e){var t=e.map_theme,r=d.default.project,e=void 0!==(e=e.layerstree)?e:r.state.layerstree,o=yield this.getMapThemeFromThemeName(t),s={layers:{}},l=[],u=[];return function t(e,a,i){e.forEach(function(n,e){n.nodes?(u.push({node:n,group:a[e]}),t(n.nodes,a[e].nodes,i&&n.checked)):(n.style=o.styles[n.id],a[e].checked!==n.visible&&(s.layers[n.id]={visibility:!0,style:!1}),a[e].checked=n.visible,n.style&&(e=new Promise(function(t){function e(e){void 0===s.layers[e.id]&&(s.layers[e.id]={visibility:!1,style:!1}),s.layers[e.id].style=r.getLayerById(e.id).setCurrentStyle(e.style),t()}var a;r.getLayersStore()?e(n):(a=n,setTimeout(function(){return e(a)}))}),l.push(e)))})}(o.layerstree,e),yield Promise.allSettled(l),u.forEach(function(e){var t=e.group,e=e.node,a=e.checked,e=e.expanded;t.checked=a,t.expanded=e}),s}),function(e){return s.apply(this,arguments)}),changeMapTheme:(o=m(function*(e){p.default.closeContent(),this.state.layerstrees[0].checked=!0;var t=(yield this.setLayersTreePropertiesFromMapTheme({map_theme:e,rootNode:this.state.layerstrees[0],layerstree:this.state.layerstrees[0].tree[0].nodes})).layers,a=Object.keys(t).filter(function(e){return t[e].style}),n=(yield this.getMapThemeFromThemeName(e)).styles;a.forEach(function(e){t[e].visible||((e=(0,g.getCatalogLayerById)(e)).clearCategories(),e.change())}),a.forEach(function(e){return c.VM.$emit("layer-change-style",{layerId:e,style:n[e]})})}),function(e){return o.apply(this,arguments)}),onTabClick:function(e){e.target.attributes["aria-controls"]&&(this.activeTab=e.target.attributes["aria-controls"].value)},setBaseLayer:function(e){this.currentBaseLayer=e,this.project.setBaseLayer(e),d.default.baseLayerId=e},getSrcBaseLayerImage:function(e){var t="nobaselayer.png";switch(e&&e.servertype||e){case"OSM":t="osm.png";break;case"Bing":t="bing"+e.source.subtype+".png";break;case"TMS":case"WMTS":t=e.icon||t}return(e||{}).icon?t:p.default.getResourcesUrl()+"images/"+t},onUnSelectionLayer:function(e,t){var a,n;t&&(a=p.default.getService("queryresults"),n=t.external&&a.getActionLayerById({layer:t,id:"selection"}),!t.external&&e&&d.default.catalog[e].getLayerById(t.id).clearSelectionFids(),t.external)&&(t.selection.active=!1,t.selection.features.forEach(function(e,t){e.selection.selected&&(e.selection.selected=!1,n&&(n.state.toggled[t]=!1),p.default.getService("map").setSelectionFeatures("remove",{feature:e}))}))},onActiveFilterTokenLayer:(r=m(function*(e,t){t.filter.active=yield d.default.catalog[e].getLayerById(t.id).toggleFilterToken()}),function(e,t){return r.apply(this,arguments)}),onTreeNodeVisible:function(e){p.default.getService("map").emit("cataloglayervisible",e)},onTreeNodeSelected:function(e){p.default.getService("map").selectLayer(e.id)}},watch:{"state.external.wms":function(e,t){t&&0===e.length&&(this.activeTab=this.project.state.catalog_tab||"layers")},project:{handler:(i=m(function*(e){var t=this,a=e.state.catalog_tab||"layers";this.loading="baselayers"===a,yield this.$nextTick(),setTimeout(function(){t.loading=!1,t.activeTab=a},"baselayers"===a?500:0)}),function(e){return i.apply(this,arguments)}),immediate:!1},activeTab:function(e){"legend"===e&&this.getLegendSrc(!0)}},created:function(){c.VM.$on("unselectionlayer",this.onUnSelectionLayer),c.VM.$on("activefiltertokenlayer",this.onActiveFilterTokenLayer),c.VM.$on("treenodevisible",this.onTreeNodeVisible),c.VM.$on("treenodeselected",this.onTreeNodeSelected),c.VM.$on("layer-change-style",this.getLegendSrc)},beforeMount:function(){this.currentBaseLayer=this.project.state.initbaselayer},mounted:(n=m(function*(){var e=this;yield this.$nextTick(),d.default.project.state.context_base_legend?p.default.getService("map").on("change-map-legend-params",function(){e.getLegendSrc()}):this.getLegendSrc()}),function(){return n.apply(this,arguments)})},t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var a=this,e=a.$createElement,n=a._self._c||e;return n("div",{staticClass:"tabbable-panel catalog"},[n("div",{staticClass:"tabbable-line"},[n("ul",{staticClass:"nav nav-tabs catalalog-nav-tabs",attrs:{role:"tablist"},on:{"!click":function(e){return a.onTabClick(e)}}},[a.hasLayers?n("li",{class:{active:"layers"===a.activeTab},attrs:{role:"presentation"}},[n("a",{directives:[{name:"t",rawName:"v-t",value:"data",expression:"'data'"}],attrs:{href:"#layers","aria-controls":"layers",role:"tab","data-toggle":"tab","data-i18n":"tree"}})]):a._e(),a._v(" "),a.state.external.wms.length?n("li",{class:{active:"externalwms"===a.activeTab},attrs:{role:"presentation"}},[n("a",{directives:[{name:"t",rawName:"v-t",value:"externalwms",expression:"'externalwms'"}],attrs:{href:"#externalwms","aria-controls":"externalwms",role:"tab","data-toggle":"tab","data-i18n":"externalwms"}})]):a._e(),a._v(" "),a.hasBaseLayers?n("li",{class:{active:"baselayers"===a.activeTab},attrs:{role:"presentation"}},[n("a",{directives:[{name:"t",rawName:"v-t",value:"baselayers",expression:"'baselayers'"}],attrs:{href:"#baselayers","aria-controls":"baselayers",role:"tab","data-toggle":"tab","data-i18n":"baselayers"}})]):a._e(),a._v(" "),"tab"===a.state.legend.place&&a.showlegend?n("li",{class:{active:"legend"===a.activeTab},attrs:{role:"presentation"}},[n("a",{directives:[{name:"t",rawName:"v-t",value:"legend",expression:"'legend'"}],attrs:{href:"#legend","aria-controls":"legend",role:"tab","data-toggle":"tab","data-i18n":"legend"}})]):a._e()]),a._v(" "),n("div",{staticClass:"tab-content catalog-tab-content"},[n("bar-loader",{attrs:{loading:a.loading}}),a._v(" "),n("div",{staticClass:"tab-pane",class:{active:"layers"===a.activeTab},attrs:{id:"layers",role:"tabpanel"}},[n("helpdiv",{attrs:{message:"catalog_items.helptext"}}),a._v(" "),n("div",{staticStyle:{margin:"2px"},attrs:{id:"g3w-catalog-toc-layers-toolbar"}},[n("catalog-change-map-themes",{key:a.project.state.gid,attrs:{map_themes:a.project.state.map_themes,layerstrees:a.state.layerstrees},on:{"change-map-theme":a.changeMapTheme}})],1),a._v(" "),a._l(a.state.layerstrees,function(t){return n("ul",{key:t.storeid,staticClass:"tree-root root project-root"},a._l(t.tree,function(e){return n("catalog-tristate-tree",{key:e.id,staticClass:"item",attrs:{highlightlayers:a.state.highlightlayers,layerstree:e,parentFolder:!1,root:!0,legendplace:a.state.legend.place,parent_mutually_exclusive:!1,storeid:t.storeid}})}),1)}),a._v(" "),a.state.external.vector.length?n("ul",{staticClass:"g3w-external_layers-group"},a._l(a.state.external.vector,function(e){return n("catalog-tristate-tree",{key:e.id,staticClass:"item",attrs:{externallayers:a.state.external.vector,layerstree:e}})}),1):a._e(),a._v(" "),a._l(a.state.layersgroups,function(e){return n("ul",{staticClass:"g3w-catalog-layers-group"},[n("div",[n("h4",[a._v(a._s(e.title))]),a._v(" "),a._l(e.nodes,function(e){return n("catalog-tristate-tree",{staticClass:"item",attrs:{layerstree:e}})})],2)])})],2),a._v(" "),a.state.external.wms.length?n("div",{staticClass:"tab-pane",class:{active:"externalwms"===a.activeTab},attrs:{id:"externalwms",role:"tabpanel"}},[n("ul",{staticClass:"g3w-external_wms_layers-group"},a._l(a.state.external.wms,function(e){return n("catalog-tristate-tree",{key:e.id,staticClass:"item",attrs:{externallayers:a.state.external.wms,layerstree:e}})}),1)]):a._e(),a._v(" "),a.hasBaseLayers?n("div",{staticClass:"tab-pane baselayers",class:{active:"baselayers"===a.activeTab||!a.hasLayers},attrs:{id:"baselayers",role:"tabpanel"}},[n("ul",{class:{mobile:a.isMobile()},style:{gridTemplateColumns:"repeat(auto-fill, minmax("+(4<a.baselayers.length?80:120)+"px, 1fr))"},attrs:{id:"baselayers-content"}},[a._l(a.baselayers,function(t){return t.fixed?a._e():n("li",{key:t.title},[n("img",{staticClass:"img-responsive img-thumbnail baselayer",style:{opacity:a.currentBaseLayer===t.id?1:.5,height:4<a.baselayers.length?"108px":null},attrs:{src:a.getSrcBaseLayerImage(t)},on:{click:function(e){return e.stopPropagation(),a.setBaseLayer(t.id)}}}),a._v(" "),n("div",{staticClass:"baseselayer-text text-center g3w-long-text"},[a._v(a._s(t.title))])])}),a._v(" "),n("li",{on:{click:function(e){return e.stopPropagation(),a.setBaseLayer(null)}}},[n("img",{staticClass:"img-responsive img-thumbnail baselayer",style:{opacity:null===a.currentBaseLayer?1:.5},attrs:{src:a.getSrcBaseLayerImage(null)}}),a._v(" "),n("div",{directives:[{name:"t",rawName:"v-t",value:"nobaselayer",expression:"'nobaselayer'"}],staticClass:"baseselayer-text text-center g3w-long-text"})])],2)]):a._e(),a._v(" "),a._l(a.state.layerstrees,function(e){return"tab"===a.state.legend.place?n("div",{key:e.id,staticClass:"tab-pane",class:{active:"legend"===a.activeTab},attrs:{role:"tabpanel",id:"legend"}},a._l(e.tree,function(e){return n("div",{staticClass:"legend-item"},a._l(e.legendurls,function(t){return n("figure",[n("bar-loader",{attrs:{loading:t.loading}}),a._v(" "),n("img",{directives:[{name:"show",rawName:"v-show",value:!t.loading&&!t.error,expression:"!url.loading && !url.error"}],attrs:{src:t.url,alt:""},on:{error:function(e){return a.onLegendError(t)},load:function(e){return a.onLegendLoad(t)}}}),a._v(" "),n("divider")],1)}),0)}),0):a._e()})],2)])])},a.staticRenderFns=[],a._scopeId="data-v-f931b03a"},{"components/CatalogChangeMapThemes.vue":38,"components/CatalogTristateTree.vue":41,"g3w-eventbus":141,"services/gui":188,"store/application":193,"utils/XHR":196,"utils/getCatalogLayerById":218,"vueify/lib/insert-css":2}],38:[function(e,t,a){var n,i,r,o,s,l,u,c,d;e("vueify/lib/insert-css").insert("#g3w-catalog-toc-views[data-v-06d0cd43]{margin-bottom:5px;border-bottom:2px solid}.g3w-map-theme-anchor[data-v-06d0cd43]{padding:0;margin-bottom:5px}.g3w-map-theme-anchor>section[data-v-06d0cd43]{display:flex;flex-wrap:wrap;align-items:center;padding:5px}.add-map-theme[data-v-06d0cd43]{border-top:2px solid;margin:5px 0}.add-map-theme-input[data-v-06d0cd43]{width:100%}#g3w-catalog-views[data-v-06d0cd43]{display:none;padding:0}#g3w-catalog-views.menu-open[data-v-06d0cd43]{display:block}.current_map_theme[data-v-06d0cd43]{overflow:hidden;white-space:normal;text-overflow:ellipsis}.choose_map_theme[data-v-06d0cd43]{color:#ccc!important;font-weight:700}.project_map_theme[data-v-06d0cd43]{font-weight:700;padding:3px;border-bottom:1px solid #fff}.user_map_theme[data-v-06d0cd43]{font-weight:700;padding:5px 3px;display:flex;justify-content:space-between;align-self:baseline;border-bottom:1px solid #fff}");function p(e){return e&&e.__esModule?e:{default:e}}function f(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),n=p(e("./InputText.vue")),i=p(e("services/gui")),r=p(e("store/application")),o=e("utils/XHR"),c=e("g3w-i18n").t,d={node:["id","name","visible","expanded"],group:["name","checked","expanded","mutually-exclusive"]},a.default={name:"changemapthemes",components:{InputText:n.default},props:{map_themes:{type:Object,default:{project:[],custom:[]}},layerstrees:{type:Array}},data:function(){var e=Object.values(this.map_themes).flat().find(function(e){return e.default});return{active_theme:e&&e.theme||null,collapsed:"collapsed"===r.default.project.state.toc_themes_init_status,custom_theme:{name:"add-user-theme",label:"sdk.catalog.choose_map_theme_input_label",i18nLabel:!0,value:null,editable:!0,type:"varchar",input:{type:"text",options:{}},visible:!0,validate:{valid:!1,required:!0,error:"sdk.catalog.invalid_map_theme_name"}},show_form:!1}},methods:{toggle:function(){this.show_form||(document.getElementById("g3w-catalog-views").classList.toggle("menu-open"),this.collapsed=!this.collapsed)},_getMapThemeParams:function(){function i(e,a){return d[e].reduce(function(e,t){return e[t]=a[t],e},{})}var r={layerstree:[],styles:{}};return function a(e,n){e.forEach(function(e){var t;void 0!==e.id&&(r.styles[e.id]=e.styles.find(function(e){return e.current}).name,n.push(i("node",e))),Array.isArray(e.nodes)&&((t=i("group",e)).nodes=[],n.push(t),a(e.nodes,t.nodes))})}(this.layerstrees[0].tree[0].nodes,r.layerstree),r},saveTheme:(u=f(function*(){var e=this.custom_theme.value;if(e)try{var t=this._getMapThemeParams();(yield o.XHR.post({url:""+r.default.project.urls.map_themes+encodeURIComponent(e)+"/",contentType:"application/json",data:JSON.stringify(t)})).result&&(this.map_themes.custom.push({theme:this.custom_theme.value,styles:t.styles}),i.default.showUserMessage({type:"success",message:"sdk.catalog.saved_map_theme",autoclose:!0}),this.show_form=!1,this.active_theme=this.custom_theme.value,yield this.$nextTick(),this.custom_theme.value=null)}catch(e){}}),function(){return u.apply(this,arguments)}),updateTheme:(l=f(function*(t){if(t)try{var e=this._getMapThemeParams(),a=(yield o.XHR.post({url:""+r.default.project.urls.map_themes+encodeURIComponent(t)+"/",contentType:"application/json",data:JSON.stringify(e)}),this.map_themes.custom.find(function(e){return t===e.theme}));a.styles=e.styles,a.layerstree=e.layerstree,i.default.showUserMessage({type:"success",message:"sdk.catalog.updated_map_theme",autoclose:!0})}catch(e){}}),function(e){return l.apply(this,arguments)}),deleteTheme:function(t){var a,n=this;i.default.dialog.confirm(c("sdk.catalog.question_delete_map_theme"),(a=f(function*(e){if(e&&t)try{(yield o.XHR.delete({url:""+r.default.project.urls.map_themes+encodeURIComponent(t)+"/"})).result&&(n.map_themes.custom=n.map_themes.custom.filter(function(e){return e.theme!==t}),i.default.showUserMessage({type:"success",message:"sdk.catalog.delete_map_theme",autoclose:!0}),t===n.active_theme)&&(n.active_theme=null)}catch(e){}}),function(e){return a.apply(this,arguments)}))}},watch:{active_theme:{immediate:!1,handler:function(e){null!==e&&e!==this.custom_theme.value&&this.$emit("change-map-theme",e)}},"custom_theme.value":function(t){var e=this;setTimeout(function(){e.custom_theme.validate.valid=!!t&&!e.map_themes.custom.find(function(e){return e.theme===t.trim()})},200)},show_form:(s=f(function*(e){this.custom_theme.value=null,e&&(yield this.$nextTick(),Array.from(this.$refs.add_map_theme_input.$el.children).forEach(function(e){return e.classList.remove("col-sm-12")}))}),function(e){return s.apply(this,arguments)})},created:function(){this.logged=void 0!==r.default.user.id}},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var a=this,e=a.$createElement,n=a._self._c||e;return n("ul",{staticClass:"sidebar-menu"},[n("li",{staticClass:"treeview sidebaritem skin-border-color",attrs:{id:"g3w-catalog-toc-views"}},[n("a",{staticClass:"g3w-map-theme-anchor",attrs:{href:"#"}},[n("section",{on:{click:function(e){return e.stopPropagation(),a.toggle(e)}}},[n("i",{class:a.g3wtemplate.getFontClass(a.collapsed?"caret-down":"caret-up"),staticStyle:{padding:"3px"}}),a._v(" "),n("i",{class:a.g3wtemplate.getFontClass(a.collapsed?"eye-close":"eye"),staticStyle:{padding:"0 0 0 4px"}}),a._v(" "),a.active_theme?n("span",{staticClass:"current_map_theme treeview-label g3w-long-text"},[n("span",{directives:[{name:"t",rawName:"v-t:pre",value:"sdk.catalog.current_map_theme_prefix",expression:"'sdk.catalog.current_map_theme_prefix'",arg:"pre"}],staticStyle:{color:"#ccc !important"}},[a._v(":")]),a._v(" "),n("span",{staticClass:"skin-color",staticStyle:{"font-size":"1.1em"}},[a._v(a._s(a.active_theme))])]):n("div",{directives:[{name:"t",rawName:"v-t",value:"sdk.catalog.choose_map_theme",expression:"'sdk.catalog.choose_map_theme'"}],staticClass:"choose_map_theme treeview-label"})])]),a._v(" "),a.show_form?n("div",{staticClass:"add-map-theme skin-border-color"},[n("div",{staticStyle:{display:"flex","justify-content":"end","padding-top":"5px"}},[n("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:left.create",value:"close",expression:"'close'",arg:"left",modifiers:{create:!0}}],staticClass:"sidebar-button sidebar-button-icon",class:a.g3wtemplate.getFontClass("close"),staticStyle:{padding:"2px",margin:"2px"},on:{click:function(e){e.stopPropagation(),a.show_form=!1}}})]),a._v(" "),n("div",{staticClass:"container add-map-theme-input"},[n("input-text",{ref:"add_map_theme_input",attrs:{state:a.custom_theme}})],1),a._v(" "),n("div",{staticStyle:{"margin-top":"5px"}},[n("button",{directives:[{name:"t",rawName:"v-t",value:"add",expression:"'add'"},{name:"disabled",rawName:"v-disabled",value:!a.custom_theme.validate.valid,expression:"!custom_theme.validate.valid"}],staticClass:"sidebar-button-run btn btn-block",on:{click:function(e){return e.stopPropagation(),a.saveTheme(e)}}})])]):n("ul",{class:{"menu-open":!a.collapsed},attrs:{id:"g3w-catalog-views"}},[0<(a.map_themes.project||[]).length?n("li",{attrs:{id:"g3w-catalog-views-project"}},[n("ul",{staticStyle:{padding:"0"}},[n("li",[n("div",{directives:[{name:"t",rawName:"v-t",value:"sdk.catalog.project_map_theme",expression:"'sdk.catalog.project_map_theme'"}],staticClass:"project_map_theme"})]),a._v(" "),n("li",{staticStyle:{padding:"5px 5px 5px 17px"}},a._l(a.map_themes.project,function(t,e){return n("div",{key:t.theme},[n("input",{directives:[{name:"model",rawName:"v-model",value:a.active_theme,expression:"active_theme"}],staticClass:"magic-radio",attrs:{type:"radio",name:"radio",id:"g3w-map_theme-"+e},domProps:{value:t.theme,checked:t.default,checked:a._q(a.active_theme,t.theme)},on:{change:function(e){a.active_theme=t.theme}}}),a._v(" "),n("label",{staticStyle:{display:"flex","justify-content":"space-between"},attrs:{for:"g3w-map_theme-"+e}},[n("span",{staticClass:"g3w-long-text"},[a._v(a._s(t.theme))])])])}),0)])]):a._e(),a._v(" "),a.logged?n("li",{attrs:{id:"g3w-catalog-views-user"}},[n("ul",{staticStyle:{padding:"0"}},[n("li",[n("div",{staticClass:"user_map_theme"},[n("span",{directives:[{name:"t",rawName:"v-t",value:"sdk.catalog.user_map_theme",expression:"'sdk.catalog.user_map_theme'"}]}),a._v(" "),n("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:left.create",value:"add",expression:"'add'",arg:"left",modifiers:{create:!0}}],staticClass:"action sidebar-button sidebar-button-icon",class:a.g3wtemplate.getFontClass("plus"),staticStyle:{"margin-left":"auto",padding:"5px"},on:{click:function(e){e.stopPropagation(),a.show_form=!a.show_form}}})])]),a._v(" "),n("li",{staticStyle:{padding:"5px 5px 5px 17px"}},a._l(a.map_themes.custom,function(t,e){return n("div",{key:t.theme,staticStyle:{display:"flex","justify-content":"space-between"}},[n("span",[n("input",{directives:[{name:"model",rawName:"v-model",value:a.active_theme,expression:"active_theme"}],staticClass:"magic-radio",attrs:{type:"radio",name:"radio",id:"g3w-map_theme-"+e+"-user"},domProps:{value:t.theme,checked:t.default,checked:a._q(a.active_theme,t.theme)},on:{change:function(e){a.active_theme=t.theme}}}),a._v(" "),n("label",{attrs:{for:"g3w-map_theme-"+e+"-user"}},[n("span",{staticClass:"g3w-long-text"},[a._v(a._s(t.theme))])])]),a._v(" "),n("span",{staticClass:"g3w-custom-map-theme-tools"},[n("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:top.create",value:"update",expression:"'update'",arg:"top",modifiers:{create:!0}},{name:"disabled",rawName:"v-disabled",value:a.active_theme!==t.theme,expression:"active_theme !== map_theme.theme"}],staticClass:"action sidebar-button sidebar-button-icon",staticStyle:{padding:"5px"},on:{click:function(e){return e.stopPropagation(),a.updateTheme(t.theme)}}},[n("i",{staticClass:"skin-color",class:a.g3wtemplate.getFontClass("save")})]),a._v(" "),n("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:top.create",value:"cancel",expression:"'cancel'",arg:"top",modifiers:{create:!0}}],staticClass:"action sidebar-button sidebar-button-icon",staticStyle:{padding:"5px"},on:{click:function(e){return e.stopPropagation(),a.deleteTheme(t.theme)}}},[n("i",{class:a.g3wtemplate.getFontClass("trash"),staticStyle:{color:"red"}})])])])}),0)])]):a._e()])])])},e.staticRenderFns=[],e._scopeId="data-v-06d0cd43"},{"./InputText.vue":86,"g3w-i18n":143,"services/gui":188,"store/application":193,"utils/XHR":196,"vueify/lib/insert-css":2}],39:[function(e,t,a){var n,i,r,o,s,l,u,c,d,p,f,g,h,y,m,v,_,b,w;e("vueify/lib/insert-css").insert(".catalog-context-menu{background:#fafafa;border:1px solid #bdbdbd;border-radius:3px;display:block;list-style:none;margin:0;padding:0;position:fixed;min-width:150px;z-index:999999;color:#000;outline:none}.catalog-context-menu li{border-bottom:1px solid #e0e0e0;margin:0;padding:5px 15px}.catalog-context-menu li span.menu-icon{padding-right:3px;margin-right:3px}.catalog-context-menu li .wms-url-tooltip{color:#000;opacity:1}.catalog-context-menu li .wms-url-tooltip:hover{color:#fff!important;transform:scale(1.1)}.catalog-context-menu li.title{background:transparent;font-size:1.1em;font-weight:700;border-bottom-width:3px!important}.catalog-context-menu li.title:hover{cursor:default!important;background:transparent!important;color:#000}.catalog-context-menu li:last-child{border-bottom:none}.catalog-context-menu li:hover{color:#fafafa;cursor:pointer}.catalog-context-menu li .layer-menu-metadata-info{padding:5px;max-width:200px;white-space:normal;overflow-y:auto;max-height:150px}.catalog-context-menu .wms-url-tooltip .tooltip-inner{min-width:200px}.catalog-context-menu .tooltip-inner{word-break:break-all;font-weight:700}.catalog-context-menu .item-text{margin-left:3px}.catalog-context-menu li .item-text{font-weight:700}.catalog-context-menu li,.catalog-context-menu ul{list-style-type:none}#project-context-menu{background:#fafafa;border:1px solid #bdbdbd;border-radius:3px;display:block;list-style:none;margin:0;padding:0;position:fixed;min-width:150px;z-index:999999;color:#000;outline:none}");function x(e){return e&&e.__esModule?e:{default:e}}function k(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},i=e("vue-color"),r=x(e("components/LayerOpacityPicker.vue")),o=e("g3w-eventbus"),s=x(e("store/application")),l=x(e("services/gui")),u=e("utils/downloadFile"),c=e("utils/getCatalogLayerById"),_=e("g3w-i18n").t,b=e("shp-write"),w=15,a.default={name:"catalog-context-menu",props:{external:{type:Object}},data:function(){return{menu:{title:s.default.project.getName(),show:!1,top:0,left:0,layers:{show:!1,top:0,left:0}},layerMenu:{show:!1,top:0,left:0,tooltip:!1,name:"",layer:null,loading:{shp:!1,csv:!1,gpx:!1,gpkg:!1,xls:!1},colorMenu:{show:!1,top:0,left:0,color:null},stylesMenu:{show:!1,top:0,left:0,style:null,default:null},filtersMenu:{show:!1,top:0,left:0,style:null,default:null},metadatainfoMenu:{show:!1,top:0,left:0}}}},computed:{edit_url:function(){return s.default.project.getState().edit_url},layers_url:function(){return s.default.project.getState().layers_url}},components:{"chrome-picker":i.Chrome,"layer-opacity-picker":r.default},methods:{__hideMenu:function(){this.menu.show=!1},showAdminLayers:function(){},onShowProjectContextMenu:(v=k(function*(e){this.__hideMenu(),yield this.$nextTick(),this.menu.left=e.x,this.menu.show=!0,yield this.$nextTick(),this.menu.top=$(e.target).offset().top-$(this.$refs["project-context-menu"]).height()+$(e.target).height()/2}),function(e){return v.apply(this,arguments)}),addLayerMenuItem:function(){this.layerMenu=n({},this.layerMenu,0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})},_hideMenu:function(){this.layerMenu.show=!1,this.layerMenu.styles=!1,this.layerMenu.loading.shp=!1,this.layerMenu.loading.csv=!1,this.layerMenu.loading.gpx=!1,this.layerMenu.loading.gpkg=!1,this.layerMenu.loading.xls=!1,this.layerMenu.loading.geotiff=!1,this.layerMenu.loading.unknow=!1},closeLayerMenu:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this._hideMenu(),this.showColorMenu(!1),e.show=!1},onbeforeDestroyChangeColor:function(){this.$refs.color_picker.$off()},onChangeColor:function(e){var t=l.default.getService("map"),t=(this.layerMenu.layer.color=e,t.getLayerByName(this.layerMenu.name)),a=t.getStyle();a._g3w_options.color=e,t.setStyle(a)},canShowWmsUrl:function(e){e=(0,c.getCatalogLayerById)(e);return!!e&&!(e.isType("table")||!e.getFullWmsUrl())},canShowWfsUrl:function(e){e=(0,c.getCatalogLayerById)(e);return e&&!e.isType("table")&&e.isWfsActive()},canDownloadXls:function(e){e=(0,c.getCatalogLayerById)(e);return!!e&&e.isXlsDownlodable()},canDownloadGpx:function(e){e=(0,c.getCatalogLayerById)(e);return!!e&&e.isGpxDownlodable()},canDownloadGpkg:function(e){e=(0,c.getCatalogLayerById)(e);return!!e&&e.isGpkgDownlodable()},canDownloadCsv:function(e){e=(0,c.getCatalogLayerById)(e);return!!e&&e.isCsvDownlodable()},canDownloadGeoTIFF:function(e){e=(0,c.getCatalogLayerById)(e);return!!e&&e.isGeoTIFFDownlodable()},canDownloadShp:function(e){e=(0,c.getCatalogLayerById)(e);return!!e&&e.isShpDownlodable()},getWmsUrl:function(e){return(0,c.getCatalogLayerById)(e).getCatalogWmsUrl()},getWfsUrl:function(e){return(0,c.getCatalogLayerById)(e).getCatalogWfsUrl()},getWfs3Url:function(e){return(0,c.getCatalogLayerById)(e).getCatalogWfs3Url()},copyUrl:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=t.evt,t=this["get"+t.type+"Url"](t.layerId),n=document.createElement("a"),t=(n.href=t,document.createElement("input"));t.value=n.href,document.body.appendChild(t),t.select(),document.execCommand("copy"),$(a.target).attr("data-original-title",_("sdk.catalog.menu.wms.copied")).tooltip("show"),$(a.target).attr("title",this.copywmsurltooltip).tooltip("fixTitle"),document.body.removeChild(t),n=null,setTimeout(function(){$('[data-toggle="tooltip"]').tooltip("destroy"),e._hideMenu()},600)},downloadGeoTIFF:function(e){var t=this,a=1<arguments.length&&void 0!==arguments[1]&&arguments[1];s.default.download=!0,this.layerMenu.loading.geotiff=!0,(0,c.getCatalogLayerById)(e).getGeoTIFF({data:a?{map_extent:l.default.getService("map").getMapExtent().toString()}:void 0}).catch(function(e){return l.default.notify.error(_("info.server_error"))}).finally(function(){t.layerMenu.loading.geotiff=!1,s.default.download=!1,t._hideMenu()})},downloadShp:function(e){var t=this;s.default.download=!0,this.layerMenu.loading.shp=!0,(0,c.getCatalogLayerById)(e).getShp().catch(function(e){return l.default.notify.error(_("info.server_error"))}).finally(function(){t.layerMenu.loading.shp=!1,s.default.download=!1,t._hideMenu()})},downloadCsv:function(e){var t=this;s.default.download=!0,this.layerMenu.loading.csv=!0,(0,c.getCatalogLayerById)(e).getCsv().catch(function(e){return l.default.notify.error(_("info.server_error"))}).finally(function(){t.layerMenu.loading.csv=!1,s.default.download=!1,t._hideMenu()})},downloadXls:function(e){var t=this;s.default.download=!0,this.layerMenu.loading.xls=!0,(0,c.getCatalogLayerById)(e).getXls().catch(function(e){return l.default.notify.error(_("info.server_error"))}).finally(function(){t.layerMenu.loading.xls=!1,s.default.download=!1,t._hideMenu()})},downloadGpx:function(e){var t=this;s.default.download=!0,this.layerMenu.loading.gpx=!0,(0,c.getCatalogLayerById)(e).getGpx().catch(function(e){return l.default.notify.error(_("info.server_error"))}).finally(function(){t.layerMenu.loading.gpx=!1,s.default.download=!1,t._hideMenu()})},downloadGpkg:function(e){var t=this;s.default.download=!0,this.layerMenu.loading.gpkg=!0,(0,c.getCatalogLayerById)(e).getGpkg().catch(function(e){return l.default.notify.error(_("info.server_error"))}).finally(function(){t.layerMenu.loading.gpkg=!1,s.default.download=!1,t._hideMenu()})},changeLayerMapPosition:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.position,e=e.layer;if(e.position!==t){var t=void 0===(e.position=t)?"top":t,a=l.default.getService("map"),n=a.getLayerById(e.id);switch(t){case"top":n.setZIndex(a.layersCount);break;case"bottom":n.setZIndex(0)}a.emit("change-layer-position-map",{id:e.id,position:t}),this._hideMenu()}},setWMSOpacity:function(e){var t=e.id,t=void 0===t?this.layerMenu.layer.id:t,e=e.value,t=void 0!==t?t:this.layerMenu.layer.id,a=(this.layerMenu.layer.opacity=e=void 0!==e?e:1,l.default.getService("map")),n=a.getLayerById(t);n&&(n.setOpacity(e),a.emit("change-layer-opacity",{id:t,opacity:e}))},zoomToLayer:function(e){try{l.default.getService("map").goToBBox([e.bbox.minx,e.bbox.miny,e.bbox.maxx,e.bbox.maxy],e.epsg)}catch(e){l.default.showUserMessage({type:"alert",message:""+e.message,textMessage:!0})}this._hideMenu()},canZoom:function(e){return e.bbox&&[e.bbox.minx,e.bbox.miny,e.bbox.maxx,e.bbox.maxy].find(function(e){return 0<e})},getGeometryType:function(t){var e,a=void 0;return 1<arguments.length&&void 0!==arguments[1]&&arguments[1]?(e=l.default.getService("catalog").state.external.vector.find(function(e){return e.id===t}))&&(a=e.geometryType):a=(0,c.getCatalogLayerById)(t).config.geometrytype,a=a&&"NoGeometry"!==a?a:""},downloadExternal:function(e){this.layerMenu.loading.unknow=!0,(0,u.downloadFile)({url:e}),this.layerMenu.loading.unknow=!1},downloadExternalShapefile:(m=k(function*(t){var a="EPSG:4326",e=(this.layerMenu.loading.shp=!0,l.default.getService("map").getLayerByName(t.name).getSource().getFeatures()),n=(a!==t.crs&&(e=e.map(function(e){e=e.clone();return e.getGeometry().transform(t.crs,a),e})),t.name.split("."+t.type)[0]);b.download((new ol.format.GeoJSON).writeFeaturesObject(e,{featureProjection:a}),{folder:n,types:{point:n,mulipoint:n,polygon:n,multipolygon:n,line:n,polyline:n,multiline:n}}),yield this.$nextTick(),this.layerMenu.loading.shp=!1,this._hideMenu()}),function(e){return m.apply(this,arguments)}),showAttributeTable:function(e){(0,c.getCatalogLayerById)(e).openAttributeTable(),this._hideMenu()},setCurrentLayerStyle:function(a){var e,t,n=this,i=!1;this.layerMenu.layer.styles.forEach(function(e,t){t===a?(n.layerMenu.stylesMenu.style=e.name,i=!e.current,e.current=!0):e.current=!1}),i&&(e=this.layerMenu.layer.id,t=(0,c.getCatalogLayerById)(e))&&(o.VM.$emit("layer-change-style",{layerId:e,style:this.layerMenu.stylesMenu.style}),t.change()),this.closeLayerMenu(this.layerMenu.stylesMenu)},setCurrentLayerFilter:(y=k(function*(e){var t=null===this.layerMenu.layer.filter.current||this.layerMenu.layer.filter.current.fid!==e.fid,a=(0,c.getCatalogLayerById)(this.layerMenu.layer.id);t?yield a.applyFilter(e):yield a.deleteFilterToken(),a.change(),this.closeLayerMenu(this.layerMenu.filtersMenu)}),function(e){return y.apply(this,arguments)}),deleteFilter:(h=k(function*(e){var t=(0,c.getCatalogLayerById)(this.layerMenu.layer.id),a=e===this.layerMenu.layer.fid;t&&(yield t.deleteFilterToken(e),a&&t.change(),this.closeLayerMenu(this.layerMenu.filtersMenu))}),function(e){return h.apply(this,arguments)}),showSubMenuContext:(g=k(function*(e){var t,a,n,i=e.menu,r=e.bool,e=e.evt;"string"==typeof i&&(i=this.layerMenu[i]),r&&(t=$(e.target),i.top=t.offset().top,i.left=t.offset().left+t.width()+(t.outerWidth()-t.width())/2+w,t=$(this.$refs["layer-menu"]),a=(e=$(e.target)).children("ul").height(),n=t.height(),i.maxHeight=n<=a?n:null,i.overflowY=n<=a?"scroll":null,i.top=(n<=a?t:e).offset().top,i.left=this.isMobile()?0:e.offset().left+e.width()+(e.outerWidth()-e.width())/2+w,yield this.$nextTick()),i.show=r}),function(e){return g.apply(this,arguments)}),showStylesMenu:(f=k(function*(e,t){this.showSubMenuContext({bool:e,evt:t,menu:this.layerMenu.stylesMenu})}),function(e,t){return f.apply(this,arguments)}),showMetadataInfo:(p=k(function*(e,t){e&&(t=$(t.target),this.layerMenu.metadatainfoMenu.top=t.offset().top,this.layerMenu.metadatainfoMenu.left=t.offset().left+t.width()+(t.outerWidth()-t.width())/2+w,yield this.$nextTick()),this.layerMenu.metadatainfoMenu.show=e}),function(e,t){return p.apply(this,arguments)}),showColorMenu:function(e,t){var a;e&&(t=$(t.target),a=$(this.$refs["layer-menu"]),this.layerMenu.colorMenu.top=a.offset().top,this.layerMenu.colorMenu.left=t.offset().left+t.width()+(t.outerWidth()-t.width())/2-w),this.layerMenu.colorMenu.show=e},onShowLayerContextMenu:(d=k(function*(e,t){this._hideMenu(),yield this.$nextTick(),this.layerMenu.left=t.x,this.layerMenu.name=e.name,this.layerMenu.layer=e,this.layerMenu.show=!0,this.layerMenu.colorMenu.color=e.color,yield this.$nextTick(),this.layerMenu.top=$(t.target).offset().top-$(this.$refs["layer-menu"]).height()+$(t.target).height()/2,$('.catalog-menu-wms[data-toggle="tooltip"]').tooltip()}),function(e,t){return d.apply(this,arguments)}),canOpenAttributeTable:function(e){return e.openattributetable},isExternalLayer:function(e){return!e.projectLayer},getStyleName:function(e){return e.name+(e.name===this.layerMenu.layer.defaultstyle&&1<this.layerMenu.layer.styles.length?" ("+_("default")+")":"")},isExternalWMSLayer:function(e){return!e.projectLayer&&"wms"===e._type},isExternalVectorLayer:function(e){return!e.projectLayer&&"wms"!==e._type},canShowStylesMenu:function(e){return e.geolayer&&e.styles&&1<e.styles.length},canShowFiltersMenu:function(e){return e.filters&&0<e.filters.length},hasMetadataInfo:function(e){return e.metadata&&e.metadata.abstract},canShowOpacityPicker:function(e){return e.geolayer&&e.visible}},created:function(){o.VM.$on("show-project-context-menu",this.onShowProjectContextMenu),o.VM.$on("hide-project-context-menu",this.__hideMenu),o.VM.$on("show-layer-context-menu",this.onShowLayerContextMenu),o.VM.$on("hide-layer-context-menu",this._hideMenu)}},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var a=this,e=a.$createElement,n=a._self._c||e;return a.edit_url&&a.menu.show?n("ul",{directives:[{name:"click-outside",rawName:"v-click-outside",value:a.__hideMenu,expression:"__hideMenu"}],ref:"project-context-menu",staticClass:"catalog-context-menu",style:{top:a.menu.top+"px",left:a.menu.left+"px"},attrs:{id:"project-context-menu",tabindex:"-1"}},[n("li",{staticClass:"title"},[n("div",[a._v("G3W-ADMIN "+a._s(a.menu.title))])]),a._v(" "),n("li",[n("div",[n("span",{staticClass:"menu-icon skin-color-dark"},[n("svg",{staticStyle:{height:"14px","vertical-align":"-1.5px",fill:"currentColor"},attrs:{xmlns:"http://www.w3.org/2000/svg","xml:space":"preserve",viewBox:"0 0 32 32"}},[n("path",{attrs:{d:"m17.61 17.63 4.36-.02-4-3.98h-4.36v4l4 4.45z"}}),a._v(" "),n("path",{attrs:{d:"m31.61 27.22-7.62-7.6-4.38.01v4.33l7.24 7.67h4.76z"}}),a._v(" "),n("path",{attrs:{d:"M18 25.18c-.68.16-1.17.2-1.9.2a9.77 9.77 0 0 1-9.68-9.88c0-5.57 4.4-9.78 9.68-9.78s9.48 4.2 9.48 9.78c0 .91-.15 1.96-.36 2.8l4.88 4.65a15 15 0 0 0 1.95-7.48C32.05 6.87 25.19.44 16 .44 6.86.44 0 6.84 0 15.47c0 8.68 6.86 15.2 16 15.2 2.36 0 4.23-.3 6.2-1.1L18 25.18z"}})])]),a._v(" "),n("b",[n("a",{staticStyle:{color:"initial"},attrs:{href:a.edit_url,target:"_blank"},on:{click:function(e){return e.stopPropagation(),a.__hideMenu(e)}}},[a._v("Project settings")])])])])]):a.layerMenu.show?n("ul",{directives:[{name:"click-outside",rawName:"v-click-outside",value:a.closeLayerMenu,expression:"closeLayerMenu"}],ref:"layer-menu",staticClass:"catalog-context-menu",style:{top:a.layerMenu.top+"px",left:a.layerMenu.left+"px"},attrs:{id:"layer-context-menu",tabindex:"-1"}},[n("li",{staticClass:"title"},[n("div",[a._v(a._s(a.layerMenu.layer.title))]),a._v(" "),n("div",{staticStyle:{"font-weight":"normal","font-size":"0.8em"}},[a._v("\n      "+a._s(a.getGeometryType(a.layerMenu.layer.id,a.layerMenu.layer.external))+"\n    ")])]),a._v(" "),a.isExternalLayer(a.layerMenu.layer)?n("li",[n("div",{staticStyle:{display:"flex","justify-content":"space-between","align-items":"center"}},[n("layerspositions",{staticStyle:{display:"flex","flex-direction":"column","justify-content":"space-between"},attrs:{position:a.layerMenu.layer.position},on:{"layer-position-change":function(e){return a.changeLayerMapPosition({position:e,layer:a.layerMenu.layer})}}})],1)]):a._e(),a._v(" "),a.hasMetadataInfo(a.layerMenu.layer)?n("li",{on:{mouseleave:function(e){return e.target!==e.currentTarget?null:a.showMetadataInfo(!1)},mouseover:function(e){return e.target!==e.currentTarget?null:a.showMetadataInfo(!0,e)}}},[n("span",{staticClass:"menu-icon skin-color-dark",class:a.g3wtemplate.getFontClass("info")}),a._v(" "),n("span",{directives:[{name:"t",rawName:"v-t",value:"Metadata",expression:"'Metadata'"}],staticClass:"item-text"}),a._v(" "),n("div",{directives:[{name:"show",rawName:"v-show",value:a.layerMenu.metadatainfoMenu.show,expression:"layerMenu.metadatainfoMenu.show"}],staticStyle:{position:"fixed","background-color":"#FFFFFF",color:"#000000","padding-left":"0","border-radius":"0 3px 3px 0"},style:{top:a.layerMenu.metadatainfoMenu.top+"px",left:a.layerMenu.metadatainfoMenu.left+1+"px"}},[n("div",{staticClass:"layer-menu-metadata-info",staticStyle:{padding:"5px"},domProps:{innerHTML:a._s(a.layerMenu.layer.metadata.abstract)}})])]):a._e(),a._v(" "),a.canShowStylesMenu(a.layerMenu.layer)?n("li",{staticClass:"menu-icon",on:{mouseleave:function(e){return e.target!==e.currentTarget?null:a.showStylesMenu(!1,e)},mouseover:function(e){return e.target!==e.currentTarget?null:a.showStylesMenu(!0,e)}}},[n("span",{staticClass:"menu-icon skin-color-dark",class:a.g3wtemplate.getFontClass("palette")}),a._v(" "),n("span",{directives:[{name:"t",rawName:"v-t",value:"catalog_items.contextmenu.styles",expression:"'catalog_items.contextmenu.styles'"}],staticClass:"item-text"}),a._v(" "),n("span",{staticClass:"menu-icon",class:a.g3wtemplate.getFontClass("arrow-right"),staticStyle:{position:"absolute",right:"0","margin-top":"3px"}}),a._v(" "),n("ul",{directives:[{name:"show",rawName:"v-show",value:a.layerMenu.stylesMenu.show,expression:"layerMenu.stylesMenu.show"}],staticStyle:{position:"fixed","padding-left":"0","background-color":"#FFFFFF",color:"#000000"},style:{top:a.layerMenu.stylesMenu.top+"px",left:a.layerMenu.stylesMenu.left+"px",maxHeight:a.layerMenu.stylesMenu.maxHeight+"px",overflowY:a.layerMenu.stylesMenu.overflowY}},a._l(a.layerMenu.layer.styles,function(e,t){return n("li",{key:e.name,on:{click:function(e){return e.stopPropagation(),a.setCurrentLayerStyle(t)}}},[e.current?n("span",{class:a.g3wtemplate.getFontClass("circle"),staticStyle:{"font-size":"0.8em"}}):a._e(),a._v(" "),n("span",[a._v(a._s(a.getStyleName(e)))])])}),0)]):a._e(),a._v(" "),a.canShowOpacityPicker(a.layerMenu.layer)?n("li",{staticClass:"menu-icon",staticStyle:{"padding-right":"0"}},[n("layer-opacity-picker",{attrs:{layer:a.layerMenu.layer},on:{"init-menu-item":a.addLayerMenuItem,"show-menu-item":a.showSubMenuContext}})],1):a._e(),a._v(" "),a.canZoom(a.layerMenu.layer)?n("li",{on:{click:function(e){return e.preventDefault(),e.stopPropagation(),a.zoomToLayer(a.layerMenu.layer)}}},[n("span",{staticClass:"menu-icon skin-color-dark",class:a.g3wtemplate.getFontClass("search")}),a._v(" "),n("span",{directives:[{name:"t",rawName:"v-t",value:"catalog_items.contextmenu.zoomtolayer",expression:"'catalog_items.contextmenu.zoomtolayer'"}],staticClass:"item-text"})]):a._e(),a._v(" "),a.canOpenAttributeTable(a.layerMenu.layer)?n("li",{on:{click:function(e){return e.preventDefault(),e.stopPropagation(),a.showAttributeTable(a.layerMenu.layer.id)}}},[n("span",{staticClass:"menu-icon skin-color-dark",class:a.g3wtemplate.getFontClass("list")}),a._v(" "),n("span",{directives:[{name:"t",rawName:"v-t",value:"catalog_items.contextmenu.open_attribute_table",expression:"'catalog_items.contextmenu.open_attribute_table'"}],staticClass:"item-text"})]):a._e(),a._v(" "),a.isExternalVectorLayer(a.layerMenu.layer)?n("li",{on:{click:function(e){e.preventDefault(),e.stopPropagation()},mouseleave:function(e){return e.target!==e.currentTarget?null:a.showColorMenu(!1,e)},mouseover:function(e){return e.target!==e.currentTarget?null:a.showColorMenu(!0,e)}}},[n("span",{directives:[{name:"t",rawName:"v-t",value:"catalog_items.contextmenu.vector_color_menu",expression:"'catalog_items.contextmenu.vector_color_menu'"}],staticClass:"item-text"}),a._v(" "),n("span",{staticClass:"menu-icon skin-color-dark",class:a.g3wtemplate.getFontClass("arrow-right"),staticStyle:{position:"absolute",right:"0","margin-top":"3px"}}),a._v(" "),a.layerMenu.colorMenu.show?n("ul",{staticStyle:{position:"fixed"},style:{top:a.layerMenu.colorMenu.top+"px",left:a.layerMenu.colorMenu.left+"px"}},[n("li",{staticStyle:{padding:"0"}},[n("chrome-picker",{ref:"color_picker",staticStyle:{width:"100%"},on:{click:function(e){e.preventDefault(),e.stopPropagation()},"hook:beforeDestroy":a.onbeforeDestroyChangeColor,input:a.onChangeColor},model:{value:a.layerMenu.colorMenu.color,callback:function(e){a.$set(a.layerMenu.colorMenu,"color",e)},expression:"layerMenu.colorMenu.color"}})],1)]):a._e()]):a._e(),a._v(" "),a.isExternalVectorLayer(a.layerMenu.layer)&&a.layerMenu.layer.downloadUrl?n("li",{directives:[{name:"download",rawName:"v-download"}],on:{click:function(e){e.preventDefault(),e.stopPropagation()}}},[n("div",{on:{click:function(e){return e.preventDefault(),e.stopPropagation(),a.downloadExternal(a.layerMenu.layer.downloadUrl)}}},[n("bar-loader",{attrs:{loading:a.layerMenu.loading.unknow}}),a._v(" "),n("span",{staticClass:"menu-icon skin-color-dark",class:a.g3wtemplate.getFontClass("download")}),a._v(" "),n("span",{directives:[{name:"t",rawName:"v-t",value:"sdk.catalog.menu.download.unknow",expression:"'sdk.catalog.menu.download.unknow'"}],staticClass:"item-text"})],1)]):a._e(),a._v(" "),a.isExternalVectorLayer(a.layerMenu.layer)&&!a.layerMenu.layer.downloadUrl?n("li",{directives:[{name:"download",rawName:"v-download"}],on:{click:function(e){e.preventDefault(),e.stopPropagation()}}},[n("div",{on:{click:function(e){return e.preventDefault(),e.stopPropagation(),a.downloadExternalShapefile(a.layerMenu.layer)}}},[n("bar-loader",{attrs:{loading:a.layerMenu.loading.shp}}),a._v(" "),n("span",{staticClass:"menu-icon skin-color-dark",class:a.g3wtemplate.getFontClass("shapefile")}),a._v(" "),n("span",{directives:[{name:"t",rawName:"v-t",value:"sdk.catalog.menu.download.shp",expression:"'sdk.catalog.menu.download.shp'"}],staticClass:"item-text"})],1)]):a._e(),a._v(" "),a.isExternalWMSLayer(a.layerMenu.layer)?n("li",{on:{click:function(e){e.preventDefault(),e.stopPropagation()}}},[n("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[n("span",{directives:[{name:"t",rawName:"v-t",value:"sdk.catalog.menu.setwmsopacity",expression:"'sdk.catalog.menu.setwmsopacity'"}],staticClass:"item-text"}),a._v(" "),n("span",{staticStyle:{"font-weight":"bold","margin-left":"5px"}},[a._v(a._s(a.layerMenu.layer.opacity))])]),a._v(" "),n("range",{attrs:{value:a.layerMenu.layer.opacity,min:0,max:1,step:.1,sync:!0},on:{changed:a._hideMenu,"change-range":a.setWMSOpacity}})],1):a._e(),a._v(" "),a.canDownloadGeoTIFF(a.layerMenu.layer.id)?n("li",{directives:[{name:"download",rawName:"v-download"}]},[n("div",{on:{click:function(e){return e.preventDefault(),e.stopPropagation(),a.downloadGeoTIFF(a.layerMenu.layer.id)}}},[n("bar-loader",{attrs:{loading:a.layerMenu.loading.geotiff}}),a._v(" "),n("span",{staticClass:"menu-icon skin-color-dark",class:a.g3wtemplate.getFontClass("geotiff")}),a._v(" "),n("span",{directives:[{name:"t",rawName:"v-t",value:"sdk.catalog.menu.download.geotiff",expression:"'sdk.catalog.menu.download.geotiff'"}],staticClass:"item-text"})],1)]):a._e(),a._v(" "),a.canDownloadGeoTIFF(a.layerMenu.layer.id)?n("li",{directives:[{name:"download",rawName:"v-download"}]},[n("div",{staticStyle:{position:"relative"},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),a.downloadGeoTIFF(a.layerMenu.layer.id,!0)}}},[n("bar-loader",{attrs:{loading:a.layerMenu.loading.geotiff}}),a._v(" "),n("span",{staticClass:"menu-icon skin-color-dark",class:a.g3wtemplate.getFontClass("geotiff"),staticStyle:{color:"#777"}}),a._v(" "),n("span",{staticClass:"menu-icon skin-color-dark",class:a.g3wtemplate.getFontClass("crop"),staticStyle:{position:"absolute",left:"-7px",bottom:"8px","font-size":"1.2em"}}),a._v(" "),n("span",{directives:[{name:"t",rawName:"v-t",value:"sdk.catalog.menu.download.geotiff_map_extent",expression:"'sdk.catalog.menu.download.geotiff_map_extent'"}],staticClass:"item-text"})],1)]):a._e(),a._v(" "),a.canDownloadShp(a.layerMenu.layer.id)?n("li",{directives:[{name:"download",rawName:"v-download"}]},[n("div",{on:{click:function(e){return e.preventDefault(),e.stopPropagation(),a.downloadShp(a.layerMenu.layer.id)}}},[n("bar-loader",{attrs:{loading:a.layerMenu.loading.shp}}),a._v(" "),n("span",{staticClass:"menu-icon skin-color-dark",class:a.g3wtemplate.getFontClass("shapefile")}),a._v(" "),n("span",{directives:[{name:"t",rawName:"v-t",value:"sdk.catalog.menu.download.shp",expression:"'sdk.catalog.menu.download.shp'"}],staticClass:"item-text"})],1)]):a._e(),a._v(" "),a.canDownloadGpx(a.layerMenu.layer.id)?n("li",[n("div",{directives:[{name:"download",rawName:"v-download"}],on:{click:function(e){return e.preventDefault(),e.stopPropagation(),a.downloadGpx(a.layerMenu.layer.id)}}},[n("bar-loader",{attrs:{loading:a.layerMenu.loading.gpx}}),a._v(" "),n("span",{staticClass:"menu-icon skin-color-dark",class:a.g3wtemplate.getFontClass("gpx")}),a._v(" "),n("span",{directives:[{name:"t",rawName:"v-t",value:"sdk.catalog.menu.download.gpx",expression:"'sdk.catalog.menu.download.gpx'"}],staticClass:"item-text"})],1)]):a._e(),a._v(" "),a.canDownloadGpkg(a.layerMenu.layer.id)?n("li",[n("div",{directives:[{name:"download",rawName:"v-download"}],on:{click:function(e){return e.preventDefault(),e.stopPropagation(),a.downloadGpkg(a.layerMenu.layer.id)}}},[n("bar-loader",{attrs:{loading:a.layerMenu.loading.gpkg}}),a._v(" "),n("span",{staticClass:"menu-icon skin-color-dark",class:a.g3wtemplate.getFontClass("gpkg")}),a._v(" "),n("span",{directives:[{name:"t",rawName:"v-t",value:"sdk.catalog.menu.download.gpkg",expression:"'sdk.catalog.menu.download.gpkg'"}],staticClass:"item-text"})],1)]):a._e(),a._v(" "),a.canDownloadCsv(a.layerMenu.layer.id)?n("li",[n("div",{directives:[{name:"download",rawName:"v-download"}],on:{click:function(e){return e.preventDefault(),e.stopPropagation(),a.downloadCsv(a.layerMenu.layer.id)}}},[n("bar-loader",{attrs:{loading:a.layerMenu.loading.csv}}),a._v(" "),n("span",{staticClass:"menu-icon skin-color-dark",class:a.g3wtemplate.getFontClass("csv")}),a._v(" "),n("span",{directives:[{name:"t",rawName:"v-t",value:"sdk.catalog.menu.download.csv",expression:"'sdk.catalog.menu.download.csv'"}],staticClass:"item-text"})],1)]):a._e(),a._v(" "),a.canDownloadXls(a.layerMenu.layer.id)?n("li",{directives:[{name:"download",rawName:"v-download"}]},[n("div",{on:{click:function(e){return e.preventDefault(),e.stopPropagation(),a.downloadXls(a.layerMenu.layer.id)}}},[n("bar-loader",{attrs:{loading:a.layerMenu.loading.xls}}),a._v(" "),n("span",{staticClass:"menu-icon skin-color-dark",class:a.g3wtemplate.getFontClass("xls")}),a._v(" "),n("span",{directives:[{name:"t",rawName:"v-t",value:"sdk.catalog.menu.download.xls",expression:"'sdk.catalog.menu.download.xls'"}],staticClass:"item-text"})],1)]):a._e(),a._v(" "),a.canShowFiltersMenu(a.layerMenu.layer)?n("li",{staticClass:"menu-icon",on:{mouseleave:function(e){return e.target!==e.currentTarget?null:a.showSubMenuContext({menu:"filtersMenu",bool:!1,evt:e})},mouseover:function(e){return e.target!==e.currentTarget?null:a.showSubMenuContext({menu:"filtersMenu",bool:!0,evt:e})}}},[n("span",{staticClass:"menu-icon skin-color-dark",class:a.g3wtemplate.getFontClass("filter")}),a._v(" "),n("span",{directives:[{name:"t",rawName:"v-t",value:"catalog_items.contextmenu.filters",expression:"'catalog_items.contextmenu.filters'"}],staticClass:"item-text"}),a._v(" "),n("span",{staticClass:"menu-icon",class:a.g3wtemplate.getFontClass("arrow-right"),staticStyle:{position:"absolute",right:"0","margin-top":"3px"}}),a._v(" "),n("ul",{directives:[{name:"show",rawName:"v-show",value:a.layerMenu.filtersMenu.show,expression:"layerMenu.filtersMenu.show"}],staticStyle:{position:"fixed","padding-left":"0","background-color":"#FFFFFF",color:"#000000"},style:{top:a.layerMenu.filtersMenu.top+"px",left:a.layerMenu.filtersMenu.left+"px",maxHeight:a.layerMenu.filtersMenu.maxHeight+"px",overflowY:a.layerMenu.filtersMenu.overflowY}},a._l(a.layerMenu.layer.filters,function(t){return n("li",{key:t.fid,staticStyle:{display:"flex","justify-content":"space-between","align-items":"baseline"},on:{click:function(e){return e.stopPropagation(),a.setCurrentLayerFilter(t)}}},[a.layerMenu.layer.filter.current&&a.layerMenu.layer.filter.current.fid===t.fid?n("span",{class:a.g3wtemplate.getFontClass("circle"),staticStyle:{"font-size":"0.5em","margin-right":"3px","justify-self":"flex-start"}}):a._e(),a._v(" "),n("span",{staticStyle:{"margin-right":"5px"}},[a._v(a._s(t.name))]),a._v(" "),n("span",{staticClass:"skin-border-color",class:a.g3wtemplate.getFontClass("trash"),staticStyle:{color:"red",right:"0","padding-left":"10px","border-left":"2px solid"},on:{click:function(e){return e.stopPropagation(),a.deleteFilter(t.fid)}}})])}),0)]):a._e(),a._v(" "),a.canShowWmsUrl(a.layerMenu.layer.id)?n("li",[n("div",{staticStyle:{display:"flex","max-width":"300px","align-items":"center"},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),a.copyUrl({evt:e,layerId:a.layerMenu.layer.id,type:"Wms"})}}},[n("span",{staticClass:"menu-icon skin-color-dark",class:a.g3wtemplate.getFontClass("map")}),a._v(" "),n("div",{staticStyle:{display:"inline-flex","justify-content":"space-between",width:"100%","align-items":"baseline"}},[n("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip",value:"sdk.catalog.menu.wms.copy",expression:"'sdk.catalog.menu.wms.copy'"}],staticClass:"item-text catalog-menu-wms skin-tooltip-top",attrs:{"data-toggle":"tooltip","data-container":"body"}},[a._v("WMS URL")]),a._v(" "),n("span",{staticClass:"bold catalog-menu-wms wms-url-tooltip skin-tooltip-top skin-color-dark",class:a.g3wtemplate.getFontClass("eye"),attrs:{"data-placement":"top","data-toggle":"tooltip","data-container":"body",title:a.getWmsUrl(a.layerMenu.layer.id)}})])])]):a._e(),a._v(" "),a.canShowWfsUrl(a.layerMenu.layer.id)?n("li",[n("div",{staticStyle:{display:"flex","max-width":"300px","align-items":"center"},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),a.copyUrl({evt:e,layerId:a.layerMenu.layer.id,type:"Wfs"})}}},[n("span",{staticClass:"menu-icon skin-color-dark",class:a.g3wtemplate.getFontClass("map")}),a._v(" "),n("div",{staticStyle:{display:"inline-flex","justify-content":"space-between",width:"100%","align-items":"baseline"}},[n("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip",value:"sdk.catalog.menu.wms.copy",expression:"'sdk.catalog.menu.wms.copy'"}],staticClass:"item-text catalog-menu-wms skin-tooltip-top",attrs:{"data-toggle":"tooltip","data-container":"body"}},[a._v("WFS URL")]),a._v(" "),n("span",{staticClass:"bold catalog-menu-wms wms-url-tooltip skin-tooltip-top skin-color-dark",class:a.g3wtemplate.getFontClass("eye"),attrs:{"data-placement":"top","data-toggle":"tooltip","data-container":"body",title:a.getWfsUrl(a.layerMenu.layer.id)}})])])]):a._e(),a._v(" "),a.canShowWfsUrl(a.layerMenu.layer.id)?n("li",[n("div",{staticStyle:{display:"flex","max-width":"300px","align-items":"center"},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),a.copyUrl({evt:e,layerId:a.layerMenu.layer.id,type:"Wfs3"})}}},[n("span",{staticClass:"menu-icon skin-color-dark",class:a.g3wtemplate.getFontClass("map")}),a._v(" "),n("div",{staticStyle:{display:"inline-flex","justify-content":"space-between",width:"100%","align-items":"baseline"}},[n("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip",value:"sdk.catalog.menu.wms.copy",expression:"'sdk.catalog.menu.wms.copy'"}],staticClass:"item-text catalog-menu-wms skin-tooltip-top",attrs:{"data-toggle":"tooltip","data-container":"body"}},[a._v("WFS 3 URL")]),a._v(" "),n("span",{staticClass:"bold catalog-menu-wms wms-url-tooltip skin-tooltip-top skin-color-dark",class:a.g3wtemplate.getFontClass("eye"),attrs:{"data-placement":"top","data-toggle":"tooltip","data-container":"body",title:a.getWfs3Url(a.layerMenu.layer.id)}})])])]):a._e(),a._v(" "),a.layers_url?n("li",[n("div",[n("span",{staticClass:"menu-icon skin-color-dark"},[n("svg",{staticStyle:{height:"14px","vertical-align":"-1.5px",fill:"currentColor"},attrs:{xmlns:"http://www.w3.org/2000/svg","xml:space":"preserve",viewBox:"0 0 32 32"}},[n("path",{attrs:{d:"m17.61 17.63 4.36-.02-4-3.98h-4.36v4l4 4.45z"}}),a._v(" "),n("path",{attrs:{d:"m31.61 27.22-7.62-7.6-4.38.01v4.33l7.24 7.67h4.76z"}}),a._v(" "),n("path",{attrs:{d:"M18 25.18c-.68.16-1.17.2-1.9.2a9.77 9.77 0 0 1-9.68-9.88c0-5.57 4.4-9.78 9.68-9.78s9.48 4.2 9.48 9.78c0 .91-.15 1.96-.36 2.8l4.88 4.65a15 15 0 0 0 1.95-7.48C32.05 6.87 25.19.44 16 .44 6.86.44 0 6.84 0 15.47c0 8.68 6.86 15.2 16 15.2 2.36 0 4.23-.3 6.2-1.1L18 25.18z"}})])]),a._v(" "),n("b",[n("a",{staticStyle:{color:"initial"},attrs:{href:a.layers_url,target:"_blank"}},[a._v("Layers settings")])])])]):a._e()]):a._e()},e.staticRenderFns=[]},{"components/LayerOpacityPicker.vue":90,"g3w-eventbus":141,"g3w-i18n":143,"services/gui":188,"shp-write":"shp-write","store/application":193,"utils/downloadFile":215,"utils/getCatalogLayerById":218,"vue-color":"vue-color","vueify/lib/insert-css":2}],40:[function(e,t,a){var n,i,r,o,s,l,u,c,d,p,f,g;e("vueify/lib/insert-css").insert(".layer-legend[data-v-fc3d03ea]{padding-left:36px}");function h(e){return e&&e.__esModule?e:{default:e}}function y(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),c=h(e("services/gui")),d=e("g3w-eventbus"),p=h(e("store/application")),f=h(e("mixins/click")),g=e("utils/getCatalogLayerById"),a.default={name:"catalog-layer-legend",props:{legendplace:{type:String},layer:{type:Object}},data:function(){return{loading:!1,categories:[],currentstyle:this.layer.styles.find(function(e){return!0===e.current}).name}},mixins:[f.default],computed:{showfeaturecount:function(){return void 0!==this.layer.featurecount},externallegend:function(){return"wms"===this.layer.source.type},legend:function(){return this.layer.legend},show:function(){return this.layer.expanded&&this.layer.visible&&("toc"===this.legendplace||"tab"===this.legendplace&&this.layer.categories)}},methods:{onCategoryClick:function(){this.handleClick({1:function(){},2:function(){}},this)},showCategoryMenu:function(){this.$emit("showmenucategory")},getWmsSourceLayerLegendUrl:function(){return this.getProjectLayer().getLegendUrl({width:16,height:16})},getProjectLayer:function(){return(0,g.getCatalogLayerById)(this.layer.id)},isDisabled:function(e){return this.categories[e].disabled},showHideLayerCategory:function(e){this.categories[e].checked=!this.categories[e].checked,this.getProjectLayer().change(),"tab"===this.legendplace?this.layer.legend.change=!0:this.categories[e].checked&&this.mapReady&&this.setLayerCategories(!1)},setError:function(){this.legend.error=!0,this.legend.loading=!1},urlLoaded:(u=y(function*(){this.legend.loading=!1}),function(){return u.apply(this,arguments)}),onChangeLayerLegendStyle:(l=y(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(this.loading=!0,!this.externallegend){try{void 0!==e.style&&e.layerId===this.layer.id&&(yield this.setLayerCategories(!0),yield this.getProjectLayer().getStyleFeatureCount(e.style),this.currentstyle=e.style,this.dynamic)&&(yield this.setLayerCategories(!1))}catch(e){}this.loading=!1}}),function(){return l.apply(this,arguments)}),setLayerCategories:(s=y(function*(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];try{var t,a,n=this.getProjectLayer(),i=n.getCategories();e&&i?this.categories=i:(a=void 0===(t=(yield n.getLegendGraphic({all:e})).nodes)?[]:t,e?this._setAllLayerCategories(a):this._updateLayerCategories(a,i))}catch(e){this.setError()}}),function(){return s.apply(this,arguments)}),_setAllLayerCategories:function(e){var t=this.getProjectLayer(),n=[];e.forEach(function(e){var t=e.icon,a=e.symbols,a=void 0===a?[]:a;t?n.push({icon:t,title:e.title,ruleKey:e.ruleKey,checked:e.checked,disabled:!1}):a.forEach(function(e){e._checked=e.checked,e.disabled=!1,n.push(e)})}),t.setCategories(n),this.categories=n},_updateLayerCategories:function(e,i){this.getProjectLayer().setCategories(i),this.categories=i,e.length?e.forEach(function(e){var t=e.icon,a=e.symbols,n=t?[{icon:t,title:e.title}]:void 0===a?[]:a;i.forEach(function(t){var e=n.find(function(e){return e.icon===t.icon&&e.title===t.title}),a=void 0===t.checked||t.checked;t.disabled=a&&void 0===e})}):i.forEach(function(e){return e.disabled=void 0===e.checked||e.checked})},onChangeMapLegendParams:(o=y(function*(){this.mapReady=!0,this.layer.visible&&!1===this.externallegend&&("toc"===this.legendplace||this.layer.categories)&&this.setLayerCategories(!1)}),function(){return o.apply(this,arguments)}),runInitLayerVisibleAction:(r=y(function*(){yield this.setLayerCategories(!0),this.dynamic&&(yield this.setLayerCategories(!1),c.default.getService("map").on("change-map-legend-params",this.onChangeMapLegendParams)),this.initialize=!0}),function(){return r.apply(this,arguments)})},watch:{"layer.visible":(i=y(function*(e){e=e&&!1===this.externallegend;e&&!1===this.initialize&&(yield this.runInitLayerVisibleAction()),e&&!1!==this.initialize&&(yield this.setLayerCategories(!this.dynamic))}),function(e){return i.apply(this,arguments)})},created:(n=y(function*(){this.initialize=!1,this.dynamic=p.default.project.state.context_base_legend,this.mapReady=!1,d.VM.$on("layer-change-style",this.onChangeLayerLegendStyle),!1===this.externallegend&&!0===this.layer.visible&&(yield this.runInitLayerVisibleAction())}),function(){return n.apply(this,arguments)}),beforeDestroy:function(){d.VM.$off("layer-change-style",this.onChangeLayerLegendStyle)}},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var a=this,e=a.$createElement,n=a._self._c||e;return a.show?n("div",{staticClass:"layer-legend",on:{click:function(e){e.stopPropagation(),e.preventDefault()}}},[a.legend?n("bar-loader",{attrs:{loading:a.legend.loading}}):a._e(),a._v(" "),a.externallegend?n("figure",[n("img",{attrs:{src:a.getWmsSourceLayerLegendUrl()}})]):n("figure",{directives:[{name:"disabled",rawName:"v-disabled",value:a.loading,expression:"loading"}]},[n("bar-loader",{attrs:{loading:a.loading}}),a._v(" "),a._l(a.categories,function(e,t){return n("div",{directives:[{name:"disabled",rawName:"v-disabled",value:e.disabled,expression:"category.disabled"}],staticStyle:{display:"flex","align-items":"center",width:"100%"},on:{contextmenu:function(e){return e.preventDefault(),e.stopPropagation(),a.showCategoryMenu(e)}}},[e.ruleKey?n("span",{class:a.g3wtemplate.getFontClass(e.checked?"check":"uncheck"),staticStyle:{"padding-right":"3px"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),a.showHideLayerCategory(t)}}}):a._e(),a._v(" "),"toc"===a.legendplace?n("img",{attrs:{src:e.icon&&"data:image/png;base64,"+e.icon},on:{error:function(e){return a.setError()},load:function(e){return a.urlLoaded()}}}):a._e(),a._v(" "),"tab"===a.legendplace&&e.ruleKey||"toc"===a.legendplace?n("span",{staticClass:"g3w-long-text",staticStyle:{"padding-left":"3px"},on:{click:function(e){return e.stopPropagation(),a.onCategoryClick(e)}}},[n("span",[a._v(a._s(e.title))]),a._v(" "),a.showfeaturecount&&void 0!==e.ruleKey?n("span",{staticStyle:{"font-weight":"bold"}},[a._v("\n          ["+a._s(a.layer.stylesfeaturecount[a.currentstyle][e.ruleKey])+"]\n        ")]):a._e()]):a._e()])})],2)],1):a._e()},e.staticRenderFns=[],e._scopeId="data-v-fc3d03ea"},{"g3w-eventbus":141,"mixins/click":176,"services/gui":188,"store/application":193,"utils/getCatalogLayerById":218,"vueify/lib/insert-css":2}],41:[function(e,t,a){function n(e){return e&&e.__esModule?e:{default:e}}function i(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}function r(t){t.nodes.forEach(function(e){void 0===e.id?r({nodes:e.nodes,visible:t.visible&&e.checked}):e.parentGroup.checked&&e.checked&&(0,f.getCatalogLayerById)(e.id).setVisible(t.visible)})}Object.defineProperty(a,"__esModule",{value:!0}),s=e("g3w-eventbus"),l=n(e("store/application")),u=n(e("services/gui")),c=n(e("mixins/click")),d=n(e("components/CatalogLayerLegend.vue")),p=e("utils/downloadFile"),f=e("utils/getCatalogLayerById"),a.default={name:"catalog-tristate-tree",props:["layerstree","storeid","legend","legendplace","highlightlayers","parent_mutually_exclusive","parentFolder","externallayers","root","parent"],components:{CatalogLayerLegend:d.default},mixins:[c.default],data:function(){return{expanded:this.layerstree.expanded,isGroupChecked:!0,controltoggled:!1,n_childs:null,filtered:!1,logged:void 0!==l.default.user.id}},computed:{showfeaturecount:function(){return void 0!==this.layerstree.featurecount},showLegendLayer:function(){return!this.layerstree.exclude_from_legend},showLayerTocLegend:function(){return!this.isGroup&&this.showLegendLayer&&this.layerstree.geolayer},isGroup:function(){return!!this.layerstree.nodes},legendlayerposition:function(){return this.showLegendLayer&&this.layerstree.legend?this.legendplace:"tab"},showscalevisibilityclass:function(){return!this.isGroup&&this.layerstree.scalebasedvisibility},showScaleVisibilityToolip:function(){return this.showscalevisibilityclass&&this.layerstree.disabled&&this.layerstree.checked},isTable:function(){return!this.isGroup&&!this.layerstree.geolayer&&!this.layerstree.external},isHidden:function(){return this.layerstree.hidden&&!0===this.layerstree.hidden},selected:function(){this.layerstree.selected=(!this.layerstree.disabled||!this.layerstree.selected)&&this.layerstree.selected},isHighLight:function(){return this.highlightlayers&&!this.isGroup&&(0,f.getCatalogLayerById)(this.layerstree.id).getTocHighlightable()&&this.layerstree.visible||this.layerstree.external&&this.layerstree.visible&&this.layerstree._type&&!0===this.layerstree.tochighlightable},isInGrey:function(){return!this.isGroup&&!this.isTable&&!this.layerstree.external&&(!this.layerstree.visible||this.layerstree.disabled)},getFeatureCount:function(){return Object.values(this.layerstree.featurecount).reduce(function(e,t){return e+ +t},0)}},watch:{"layerstree.checked":function(){this.isGroup?this.handleGroupChecked(this.layerstree):this.handleLayerChecked(this.layerstree)}},methods:{removeCurrentFilter:function(){return(0,f.getCatalogLayerById)(this.layerstree.id).deleteFilterToken()},handleGroupChecked:function(t){u.default.getService("map");if(t.checked)for(var a=!t.parentGroup||t.parentGroup.checked,e=t.parentGroup&&t.parentGroup.mutually_exclusive,n=(e||r({nodes:t.nodes,visible:a}),e&&t.parentGroup.nodes.forEach(function(e){e.checked=e.groupId===t.groupId,e.checked&&r({nodes:e.nodes,visible:a})}),t.parentGroup);n;)n.checked=n.root||n.checked,n=n.parentGroup;else t.nodes.forEach(function(e){void 0===e.id?r({nodes:e.nodes,visible:!1}):e.checked&&(0,f.getCatalogLayerById)(e.id).setVisible(!1)})},handleLayerChecked:function(t){var e=u.default.getService("map");if(t.projectLayer){for(var a=(0,f.getCatalogLayerById)(t.id),n=t.checked,i=(a.setVisible(!!n&&!t.disabled),n&&t.parentGroup.mutually_exclusive&&t.parentGroup.nodes.forEach(function(e){return e.checked=e.id===t.id}),t.parentGroup);n&&i;)i.checked=!0,i=i.parentGroup;s.VM.$emit("treenodevisible",a)}else t.visible=t.checked,t.setVisible(t.checked),e.emit("change-layer-visibility",{id:t.id,visible:t.checked})},saveFilter:function(e){(0,f.getCatalogLayerById)(e.id).saveFilter()},toggleFilterLayer:function(){s.VM.$emit("activefiltertokenlayer",this.storeid,this.layerstree)},clearSelection:function(){s.VM.$emit("unselectionlayer",this.storeid,this.layerstree)},toggle:function(){this.layerstree.checked=!this.layerstree.checked},expandCollapse:function(){this.layerstree.expanded=!this.layerstree.expanded},select:function(){void 0!==this.layerstree.selected&&(!this.isGroup&&!this.isTable||this.layerstree.external&&!1===this.layerstree.projectLayer)&&s.VM.$emit("treenodeselected",this.layerstree)},maybeZoomToLayer:function(e){this.canZoom(this.layerstree)&&u.default.getService("map").goToBBox([e.bbox.minx,e.bbox.miny,e.bbox.maxx,e.bbox.maxy],e.epsg)},canZoom:function(e){return e.bbox&&[e.bbox.minx,e.bbox.miny,e.bbox.maxx,e.bbox.maxy].find(function(e){return 0<e})},onTreeItemClick:function(){var e=this;this.handleClick({1:function(){return!e.isTable&&!e.isGroup&&e.select()},2:function(){return!e.isTable&&e.maybeZoomToLayer(e.layerstree)}},this)},triClass:function(){return this.g3wtemplate.getFontClass(this.layerstree.checked?"check":"uncheck")},downloadExternalLayer:function(e){e.file?(0,p.downloadFile)(e.file):e.url},removeExternalLayer:function(e){u.default.getService("map").removeExternalLayer(e)},showContextMenu:function(e){!this.isGroup&&(this.layerstree.openattributetable||this.layerstree.downloadable||this.layerstree.geolayer||this.layerstree.external)?(s.VM.$emit("hide-project-context-menu"),s.VM.$emit("show-layer-context-menu",this.layerstree,e)):this.isGroup&&!0===this.layerstree.root&&(s.VM.$emit("hide-layer-context-menu"),s.VM.$emit("show-project-context-menu",e))}},created:function(){this.isGroup&&!this.layerstree.checked&&this.handleGroupChecked(this.layerstree),this.isGroup&&!this.root&&this.parent_mutually_exclusive&&!this.layerstree.mutually_exclusive&&this.layerstree.nodes.forEach(function(e){e.id&&(e.uncheckable=!0)})},mounted:(o=i(function*(){yield this.$nextTick(),$("span.scalevisibility").tooltip()}),function(){return o.apply(this,arguments)})},t.exports.__esModule&&(t.exports=t.exports.default);var o,s,l,u,c,d,p,f,e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.isGroup||!t.layerstree.projectLayer||t.layerstree.toc?a("li",{staticClass:"tree-item",class:{selected:(!t.isGroup||!t.isTable)&&t.layerstree.selected,itemmarginbottom:!t.isGroup,disabled:t.isInGrey,group:t.isGroup},style:{marginLeft:t.isGroup?"0":"5px"},on:{contextmenu:function(e){return e.preventDefault(),e.stopPropagation(),t.showContextMenu(e)},click:function(e){return e.stopPropagation(),t.onTreeItemClick(e)}}},[t.isGroup?a("span",{staticClass:"root collapse-expande-collapse-icon",class:[{bold:t.isGroup},t.g3wtemplate.getFontClass(t.layerstree.expanded?"caret-down":"caret-right")],staticStyle:{"padding-right":"2px"},on:{click:function(e){return e.stopPropagation(),t.expandCollapse(e)}}}):t._e(),t._v(" "),t.isGroup?a("span",{class:[t.triClass()],staticStyle:{color:"#ffffff"},on:{click:function(e){return e.stopPropagation(),t.toggle()}}}):t.isTable?a("span",{directives:[{name:"show",rawName:"v-show",value:!t.layerstree.hidden,expression:"!layerstree.hidden"}],class:[t.parentFolder?"child":"root",t.g3wtemplate.getFontClass("table")],staticStyle:{"padding-left":"18px"}}):[t.layerstree.external&&t.layerstree.removable?a("span",{class:t.g3wtemplate.getFontClass("trash"),staticStyle:{color:"red","padding-left":"1px"},on:{click:function(e){return e.stopPropagation(),t.removeExternalLayer(t.layerstree.name,t.layerstree._type)}}}):t._e(),t._v(" "),t.layerstree.external&&t.layerstree.download?a("span",{class:t.g3wtemplate.getFontClass("download"),staticStyle:{color:"#ffffff","margin-left":"5px"},on:{click:function(e){return t.downloadExternalLayer(t.layerstree.download)}}}):t._e(),t._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:!t.layerstree.hidden,expression:"!layerstree.hidden"}],staticClass:"checkbox-layer",class:t.parentFolder?"child":"root"},["toc"===t.legendlayerposition||!t.isGroup&&t.layerstree.categories?a("span",{staticClass:"collapse-expande-collapse-icon",class:t.g3wtemplate.getFontClass(t.layerstree.visible&&t.layerstree.expanded?"caret-down":"caret-right"),on:{click:function(e){return e.target!==e.currentTarget?null:(e.stopPropagation(),t.expandCollapse(e))}}}):t._e(),t._v(" "),a("span",{class:[t.g3wtemplate.getFontClass(t.layerstree.checked?"check":"uncheck"),{"toc-added-external-layer":!t.layerstree.legend&&t.layerstree.external}],style:{paddingLeft:"toc"===t.legendlayerposition||!t.isGroup&&t.layerstree.categories?"5px":!t.layerstree.legend&&t.layerstree.external?"1px":"18px"},on:{click:function(e){return e.stopPropagation(),t.toggle()}}})])],t._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!t.layerstree.hidden||t.isGroup,expression:"!layerstree.hidden || isGroup"}],staticClass:"tree-node-title",class:{disabled:!t.layerstree.external&&(t.layerstree.disabled||t.layerstree.id&&!t.layerstree.visible),bold:t.isGroup}},[a("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip.text",value:t.showScaleVisibilityToolip?"minscale:"+t.layerstree.minscale+" - maxscale:"+t.layerstree.maxscale:"",expression:"showScaleVisibilityToolip ? `minscale:${layerstree.minscale} - maxscale:${layerstree.maxscale}` : ''",modifiers:{text:!0}}],staticClass:"skin-tooltip-top g3w-long-text",class:{highlightlayer:t.isHighLight,scalevisibility:t.showscalevisibilityclass},attrs:{"data-placement":"top","current-tooltip":t.showScaleVisibilityToolip?"minscale:"+t.layerstree.minscale+" - maxscale: "+t.layerstree.maxscale:""}},[t.isGroup||t.layerstree.external||null===t.layerstree.filter.current?t._e():a("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:top.create.text",value:t.layerstree.filter.current.name,expression:"layerstree.filter.current.name",arg:"top",modifiers:{create:!0,text:!0}}],staticStyle:{cursor:"pointer"},attrs:{"current-tooltip":t.layerstree.filter.current.name},on:{click:function(e){return e.stopPropagation(),t.removeCurrentFilter(e)}}},[a("span",{class:t.g3wtemplate.getFontClass("filter"),staticStyle:{color:"red"}})]),t._v(" "),a("span",[t._v(t._s(t.layerstree.title))]),t._v(" "),!t.isGroup&&t.showfeaturecount?a("span",{staticStyle:{"font-weight":"bold"}},[t._v("\n        ["+t._s(t.getFeatureCount)+"]\n      ")]):t._e()]),t._v(" "),!t.isGroup&&t.layerstree.selection?a("div",[t.layerstree.selection.active?a("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip.create",value:"layer_selection_filter.tools.clear",expression:"'layer_selection_filter.tools.clear'",modifiers:{create:!0}}],staticClass:"action-button skin-tooltip-left selection-filter-icon",class:t.g3wtemplate.getFontClass("clear"),attrs:{"data-placement":"left","data-toggle":"tooltip","data-container":"body"},on:{click:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"caputure",void 0,e.key,void 0)?null:(e.preventDefault(),e.stopPropagation(),t.clearSelection(e))}}}):t._e(),t._v(" "),t.layerstree.external||!t.layerstree.selection.active&&!t.layerstree.filter.active?t._e():a("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip.create",value:"layer_selection_filter.tools.filter",expression:"'layer_selection_filter.tools.filter'",modifiers:{create:!0}}],staticClass:"action-button skin-tooltip-left selection-filter-icon",class:[t.g3wtemplate.getFontClass("filter"),t.layerstree.filter.active?"active":""],attrs:{"data-placement":"left","data-toggle":"tooltip","data-container":"body"},on:{click:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"caputure",void 0,e.key,void 0)?null:(e.preventDefault(),e.stopPropagation(),t.toggleFilterLayer(e))}}}),t._v(" "),t.logged&&!t.layerstree.external&&t.layerstree.selection.active&&t.layerstree.filter.active?a("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip.create",value:"layer_selection_filter.tools.savefilter",expression:"'layer_selection_filter.tools.savefilter'",modifiers:{create:!0}}],staticClass:"action-button skin-tooltip-left selection-filter-icon",class:t.g3wtemplate.getFontClass("save"),attrs:{"data-placement":"left","data-toggle":"tooltip"},on:{click:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"caputure",void 0,e.key,void 0)?null:(e.preventDefault(),e.stopPropagation(),t.saveFilter(t.layerstree))}}}):t._e()]):t._e()]),t._v(" "),t.showLayerTocLegend?a("catalog-layer-legend",{attrs:{legendplace:t.legendplace,layer:t.layerstree}}):t._e(),t._v(" "),t.isGroup?a("ul",{directives:[{name:"show",rawName:"v-show",value:t.layerstree.expanded,expression:"layerstree.expanded"}],staticClass:"tree-content-items group",class:["g3w-lendplace-"+t.legendplace]},t._l(t.layerstree.nodes,function(e){return a("span",{key:e.id||e.groupId},[a("catalog-tristate-tree",{attrs:{root:!1,legendConfig:t.legend,legendplace:t.legendplace,highlightlayers:t.highlightlayers,parentFolder:t.isGroup,layerstree:e,storeid:t.storeid,parent:t.layerstree,parent_mutually_exclusive:!!t.layerstree.mutually_exclusive}})],1)}),0):t._e()],2):t._e()},e.staticRenderFns=[]},{"components/CatalogLayerLegend.vue":40,"g3w-eventbus":141,"mixins/click":176,"services/gui":188,"store/application":193,"utils/downloadFile":215,"utils/getCatalogLayerById":218}],42:[function(e,t,a){var n,i,r,o,s,l,u,c,d,p,f,g,h,y,m,v,_,b;e("vueify/lib/insert-css").insert("#g3w-change-map-menu[data-v-9eb2df56]{width:100%;position:relative}.g3w-change-map-menu-container[data-v-9eb2df56]{height:100%;display:grid;grid-template-columns:repeat(auto-fill,minmax(30%,1fr));grid-gap:1em;overflow-y:auto}.menu-item[data-v-9eb2df56]{margin-bottom:20px;margin-top:20px}.menu-item-image[data-v-9eb2df56]{cursor:pointer;position:relative;overflow:hidden;padding-bottom:50%;opacity:.7}.menu-item-image[data-v-9eb2df56]:hover{opacity:1}.menu-item-image img[data-v-9eb2df56]{position:absolute;top:0;bottom:0;left:0;right:0;margin:auto}.menu-item-content[data-v-9eb2df56]{padding:15px;background:hsla(0,0%,100%,.3)}.menu-item-text[data-v-9eb2df56]{position:relative;overflow:hidden;height:100%;text-align:justify}.menu-item-title[data-v-9eb2df56]{text-align:center;font-weight:700;background:hsla(0,0%,100%,.5);padding:5px}");function w(e){return e&&e.__esModule?e:{default:e}}function x(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function k(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=k(function*(e){return o[e]=o[e]||(yield c.XHR.get({url:encodeURI("/"+l.default.user.i18n+"/about/api/group/"+e+"/")})),o[e]}),o=function(e){return n.apply(this,arguments)},i=k(function*(e){return s[e]=s[e]||(yield c.XHR.get({url:encodeURI("/"+l.default.user.i18n+"/about/api/group/"+e+"/projects/")})),s[e]}),s=function(e){return i.apply(this,arguments)},l=w(e("store/application")),u=w(e("store/projections")),c=e("utils/XHR"),d=e("utils/getListableProjects"),p=w(e("services/gui")),b="images/logo_gis3w_156_85.png",a.default={name:"change-map-menu",data:function(){return{state:null,loading:!1,current:"projects",items:[],parent:null,steps:[],curr_group:null}},methods:{back:(_=k(function*(){var e=this.steps.pop(),t=0<this.steps.length,a=t&&this.steps[this.steps.length-1];return t&&void 0!==a.macrogroup_id||!t&&void 0===e&&Array.isArray(this.parent.macrogroup_id)&&0<this.parent.macrogroup_id.length?(e=(t?a:this.parent).macrogroup_id,this.showMacroGroups(e,!t)):t&&void 0===a.macrogroup_id?this.showGroups(a,!1):t?void 0:this.showRoot()}),function(){return _.apply(this,arguments)}),showMacroGroups:(v=k(function*(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];if(1===t.length)return this.parent=this.macrogroups.find(function(e){return e.id===t[0]}),yield this.showGroups(this.parent);this.items=this.macrogroups.filter(function(e){return t.includes(e.id)}),this.current="macrogroups",this.parent={macrogroup_id:t,title:null,name:null},e&&this.steps.push(this.parent)}),function(){return v.apply(this,arguments)}),showGroups:(m=k(function*(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];try{this.loading=!0,this.parent=e,this.items=yield o(e.id),this.current="groups"}catch(e){this.items=[]}finally{t&&this.steps.push(this.parent),this.loading=!1}}),function(e){return m.apply(this,arguments)}),showProjects:(y=k(function*(e){var t=this;try{this.loading=!0,this.parent=e,this.items=this.parent.id===this.curr_group?(0,d.getListableProjects)():yield s(e.id,function(e){return t.setItemImageSrc({item:e,type:"project"})}),this.current="projects"}catch(e){this.items=[]}finally{this.steps.push(this.parent),this.loading=!1}}),function(e){return y.apply(this,arguments)}),showRoot:function(){this.current="root",this.items=[].concat(x(this.macrogroups),x(this.groups)),this.steps=[]},changeMapProject:(h=k(function*(t){var a=void 0,n=window.initConfig.urls.baseurl,e=this.parent.srid?"EPSG:"+this.parent.srid:this.parent.crs.epsg;yield u.default.registerProjection(e);try{new URL(n),a=""+n+(t.url||t.map_url.replace(/^\//,""))}catch(e){a=""+location.origin+n+(t.url||t.map_url.replace(/^\//,""))}a=p.default.getService("map").addMapExtentUrlParameterToUrl(a,e),history.replaceState(null,null,a),location.replace(a)}),function(e){return h.apply(this,arguments)}),trigger:(g=k(function*(e){switch(this.current){case"root":return void 0===e.srid?this.showGroups(e):this.showProjects(e);case"macrogroups":return this.showGroups(e);case"groups":return yield this.showProjects(e);case"projects":return yield this.changeMapProject(e)}}),function(e){return g.apply(this,arguments)}),setItemImageSrc:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.item;switch(e.type){case"project":t.thumbnail=this._setSrc(t.thumbnail);break;case"group":t.header_logo_img=this._setSrc(t.header_logo_img);break;case"macrogroup":t.logo_img=this._setSrc(t.logo_img);break;case"net_error":t.thumbnail||t.logo_img?t.thumbnail=window.initConfig.urls.clienturl+b:t.header_logo_img&&(t.header_logo_img=window.initConfig.urls.clienturl+b)}},_setSrc:function(e){var t=this.$options.host||"",a=window.initConfig.mediaurl,n=window.initConfig.urls.clienturl,i=e&&e.includes(a),r=e&&!e.includes("static")&&!e.includes("media");return""+t+(e?i?e:r?""+a+e:n+b:n+b)}},created:(f=k(function*(){var a=this,e=window.initConfig;this.items=(0,d.getListableProjects)(),this.parent=window.initConfig,this.curr_group=this.parent.id,this.macrogroups=e.macrogroups,this.groups=e.groups,Object.entries({project:this.items,magrocroup:this.macrogroups,group:this.groups}).forEach(function(e){var e=r(e,2),t=e[0];return e[1].forEach(function(e){return a.setItemImageSrc({item:e,type:t})})})}),function(){return f.apply(this,arguments)})},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var a=this,e=a.$createElement,n=a._self._c||e;return n("div",{attrs:{id:"g3w-change-map-menu"}},["root"!==this.current?[n("div",{staticClass:"skin-background-color",staticStyle:{display:"flex","align-items":"center",color:"#ffffff"}},[n("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:bottom.create",value:"change_session",expression:"'change_session'",arg:"bottom",modifiers:{create:!0}},{name:"disabled",rawName:"v-disabled",value:a.loading,expression:"loading"}],staticStyle:{"font-size":"2em",margin:"5px",cursor:"pointer",padding:"3px",border:"2px solid #ffffff","border-radius":"3px"},on:{click:function(e){return e.stopPropagation(),a.back(e)}}},[n("i",{class:a.g3wtemplate.getFontClass("reply"),staticStyle:{color:"#FFFFFF"}})]),a._v(" "),a.parent?n("div",{staticStyle:{margin:"auto"}},[n("h3",{staticStyle:{"font-weight":"bold"}},[a._v("\n          "+a._s(a.parent.title||a.parent.name)+"\n        ")])]):a._e()])]:a._e(),a._v(" "),a.items.length?n("div",{staticClass:"g3w-change-map-menu-container"},a._l(a.items,function(t){return n("div",{key:t.name,staticClass:"menu-item"},[n("div",{staticClass:"menu-item-image",on:{click:function(e){return e.stopPropagation(),a.trigger(t)}}},[n("img",{staticClass:"img-responsive",attrs:{src:t.thumbnail||t.header_logo_img||t.logo_img,alt:"logo"},on:{error:function(e){return a.setItemImageSrc({item:t,type:"net_error"})}}})]),a._v(" "),n("div",{staticClass:"menu-item-content"},[n("div",{staticClass:"menu-item-text"},[n("h4",{staticClass:"menu-item-title"},[a._v(a._s(t.title))]),a._v(" "),n("div",{domProps:{innerHTML:a._s(t.description)}})])])])}),0):[n("h3",{directives:[{name:"t",rawName:"v-t",value:" no_other_"+a.current,expression:"` no_other_${current}`"}],staticStyle:{"font-weight":"bold"}})]],2)},e.staticRenderFns=[],e._scopeId="data-v-9eb2df56"},{"services/gui":188,"store/application":193,"store/projections":195,"utils/XHR":196,"utils/getListableProjects":224,"vueify/lib/insert-css":2}],43:[function(e,t,a){e("vueify/lib/insert-css").insert(".field[data-v-6783d4c4]{background-color:transparent!important;padding-top:3px;padding-bottom:3px;display:flex;align-items:center}.value[data-v-6783d4c4]{position:relative}.field div[data-v-6783d4c4]{padding-left:3px;padding-right:3px}.field_value[data-v-6783d4c4]{padding-left:0!important}");Object.defineProperty(a,"__esModule",{value:!0}),a.default={name:"field",props:["state"]},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var e=this,t=e.$createElement,t=e._self._c||t;return t("div",{staticClass:"field"},[e.state.label?t("div",{staticClass:"col-sm-6  field_label"},[e._t("label",[e._v(e._s(e.state.label))])],2):e._e(),e._v(" "),t("div",{staticClass:"field_value",class:[e.state.label?"col-sm-6":null]},[e._t("field",[t("span",{staticStyle:{"word-wrap":"break-word"},domProps:{innerHTML:e._s(e.state.value)}})])],2)])},e.staticRenderFns=[],e._scopeId="data-v-6783d4c4"},{"vueify/lib/insert-css":2}],44:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},i=e("gui/fields/fieldsservice"),e=e("gui/fields/fields"),a.default={name:"g3w-field",props:{state:{required:!0},feature:{type:Object}},components:n({},e),created:function(){this.type=i.getType(this.state)}},t.exports.__esModule&&(t.exports=t.exports.default);var n,i,a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var e=this,t=e.$createElement;return(e._self._c||t)(e.type,{tag:"component",attrs:{feature:e.feature,state:e.state}})},a.staticRenderFns=[]},{"gui/fields/fields":3,"gui/fields/fieldsservice":4}],45:[function(e,t,a){e("vueify/lib/insert-css").insert(".show-hide-geo[data-v-3362679d]{color:#3c8dbc;cursor:pointer;font-size:1.2em}");Object.defineProperty(a,"__esModule",{value:!0}),e=e("mixins"),a.default={name:"g3w-geospatial",props:{data:{}},mixins:[e.geoMixin],data:function(){return{layerId:"table_layer_"+Date.now(),visible:!1,id:"geo_table_"+Date.now()}}},t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("div",{staticClass:"geo-content"},[e("span",{staticClass:"show-hide-geo",class:[t.visible?t.g3wtemplate.font["eye-close"]:t.g3wtemplate.font.eye],on:{click:function(e){return e.stopPropagation(),t.showLayer()}}})])},a.staticRenderFns=[],a._scopeId="data-v-3362679d"},{mixins:180,"vueify/lib/insert-css":2}],46:[function(e,t,a){e("vueify/lib/insert-css").insert(".img-responsive[data-v-70d2a0b2]{cursor:pointer}");Object.defineProperty(a,"__esModule",{value:!0}),n=(n=n=e("components/Field.vue"))&&n.__esModule?n:{default:n},i=e("utils/toRawType"),a.default={name:"field-image",props:["state"],data:function(){return{galleryId:"gallery_"+Date.now(),active:null,value:(void 0!==this.state.value.mime_type?this.state.value:this.state).value}},components:{Field:n.default},computed:{values:function(){return Array.isArray(this.value)?this.value:[this.value]}},methods:{getSrc:function(e){return"Object"===(0,i.toRawType)(e)?e.photo:e},showGallery:function(e){this.active=e,"Object"===(0,i.toRawType)(this.value)&&(this.value.active=!0),$("#"+this.galleryId).modal("show")},getGalleryImages:function(){var t=this;return this.values.map(function(e){return{src:t.getSrc(e)}})}}},t.exports.__esModule&&(t.exports=t.exports.default);var n,i,e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var a=this,e=a.$createElement,n=a._self._c||e;return n("field",{attrs:{state:a.state}},[n("div",{staticStyle:{"text-align":"left"},attrs:{slot:"field"},slot:"field"},[a._l(a.values,function(e,t){return n("img",{staticClass:"img-responsive",staticStyle:{"max-height":"50px"},attrs:{alt:"",src:a.getSrc(e)},on:{click:function(e){return e.stopPropagation(),a.showGallery(t)}}})}),a._v(" "),n("g3w-images-gallery",{attrs:{id:a.galleryId,active:a.active,images:a.getGalleryImages()}})],2)])},e.staticRenderFns=[],e._scopeId="data-v-70d2a0b2"},{"components/Field.vue":43,"utils/toRawType":257,"vueify/lib/insert-css":2}],47:[function(e,t,a){e("vueify/lib/insert-css").insert(".field_link[data-v-156f65de]{max-width:100%}");Object.defineProperty(a,"__esModule",{value:!0}),n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e=(e=e=e("components/Field.vue"))&&e.__esModule?e:{default:e},a.default={name:"field-link",props:["state"],data:function(){return{value:null}},components:{Field:e.default},methods:{openLink:function(e){window.open(e,"_blank")}},created:function(){this.value=(this.state.value&&"object"===n(this.state.value)?this.state.value:this.state).value}},t.exports.__esModule&&(t.exports=t.exports.default);var n,a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("field",{attrs:{state:t.state}},[e("button",{directives:[{name:"t",rawName:"v-t",value:"info.link_button",expression:"'info.link_button'"}],staticClass:"btn skin-button field_link",attrs:{slot:"field",title:t.value},on:{click:function(e){return e.stopPropagation(),t.openLink(t.value)}},slot:"field"})])},a.staticRenderFns=[],a._scopeId="data-v-156f65de"},{"components/Field.vue":43,"vueify/lib/insert-css":2}],48:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),e=e("mixins"),a.default={name:"g3w-media",mixins:[e.mediaMixin],props:["state"],computed:{type:function(){return this.getMediaType(this.state.mime_type).type},value:function(){return this.state.value}}},t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var e=this,t=e.$createElement,t=e._self._c||t;return e.value?t("div",{staticClass:"preview"},[t("a",{attrs:{href:e.value,target:"_blank"}},[t("div",{staticClass:"previewtype",class:e.type},[t("i",{staticClass:"fa-2x",class:e.g3wtemplate.font[e.type]})])]),e._v(" "),t("div",{staticClass:"filename"},[e._v(e._s(e.filename))]),e._v(" "),e._t("default")],2):e._e()},a.staticRenderFns=[],a._scopeId="data-v-7b8309b0"},{mixins:180}],49:[function(e,t,a){e("vueify/lib/insert-css").insert(".field_text_table[data-v-db21acde]{background-color:transparent!important}.field_text_table .field_label[data-v-db21acde]{font-weight:700}");Object.defineProperty(a,"__esModule",{value:!0}),e=(e=e=e("components/Field.vue"))&&e.__esModule?e:{default:e},a.default={name:"field-text",props:["state"],components:{Field:e.default},created:function(){}},t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var e=this.$createElement;return(this._self._c||e)("field",{attrs:{state:this.state}})},a.staticRenderFns=[],a._scopeId="data-v-db21acde"},{"components/Field.vue":43,"vueify/lib/insert-css":2}],50:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),e=(e=e=e("components/Field.vue"))&&e.__esModule?e:{default:e},a.default={name:"vuefield",props:{feature:{type:Object},state:{type:Object,default:{value:null,vueoptions:{component:{}}}}},components:{Field:e.default}},t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var e=this,t=e.$createElement,t=e._self._c||t;return t("field",{attrs:{state:e.state}},[t("div",{attrs:{slot:"field"},slot:"field"},[t(e.state.vueoptions.component,{tag:"component",attrs:{feature:e.feature,value:e.state.value}})],1)])},a.staticRenderFns=[]},{"components/Field.vue":43}],51:[function(e,t,a){function n(e){return e&&e.__esModule?e:{default:e}}function i(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),o=n(e("components/FormHeader.vue")),e=n(e("components/FormFooter.vue")),a.default={name:"g3w-form",data:function(){return{state:{},switchcomponent:!1,body:{components:{before:[],after:[]}}}},components:{g3wformheader:o.default,G3wFormFooter:e.default},transitions:{addremovetransition:"showhide"},methods:{isRootComponent:function(e){return this.$options.service.isRootComponent(e)},backToRoot:function(){this.$options.service.setRootComponent()},handleRelation:function(e){this.$options.service.handleRelation(e)},disableComponent:function(e){var t=e.id,e=e.disabled;this.$options.service.disableComponent({id:t,disabled:void 0!==e&&e})},resizeForm:function(e){this.$options.service.setCurrentFormPercentage(e)},switchComponent:function(e){this.switchcomponent=!0,this.$options.service.setCurrentComponentById(e)},changeInput:function(e){return this.$options.service.changeInput(e)},addToValidate:function(e){this.$options.service.addToValidate(e)},removeToValidate:function(e){this.$options.service.removeToValidate(e)},reloadLayout:function(){var e,t,a=$(this.$el).height();a&&(t=$(this.$refs.g3w_form_footer.$el),e=$(this.$refs.g3wform_body),t=t.height()?t.height()+50:50,a=a-($(this.$refs.g3wformheader.$el).height()+t),e.height(a))}},updated:(r=i(function*(){var e=this;yield this.$nextTick(),this.switchcomponent&&setTimeout(function(){return e.switchcomponent=!1},0)}),function(){return r.apply(this,arguments)}),created:function(){var a=this;this.$options.service.getEventBus().$on("set-main-component",function(){a.switchComponent(0)}),this.$options.service.getEventBus().$on("component-validation",function(e){var t=e.id;a.$options.service.setValidComponent({id:t,valid:e.valid})}),this.$options.service.getEventBus().$on("addtovalidate",this.addToValidate),this.$options.service.getEventBus().$on("disable-component",this.disableComponent)},mounted:function(){this.$options.service.isValid(),this.$options.service.setReady(!0)},beforeDestroy:function(){this.$options.service.clearAll()}},t.exports.__esModule&&(t.exports=t.exports.default);var r,o,a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"g3wform_content",staticStyle:{position:"relative"}},[a("bar-loader",{attrs:{loading:t.state.loading}}),t._v(" "),a("g3wformheader",{ref:"g3wformheader",attrs:{currentid:t.state.currentheaderid,headers:t.state.headers,update:t.state.update,valid:t.state.valid},on:{"resize-form":t.resizeForm,clickheader:t.switchComponent}}),t._v(" "),a("div",{ref:"g3wform_body",staticClass:"g3wform_body"},[t._l(t.body.components.before,function(e){return a(e,{tag:"component",attrs:{fields:t.state.fields}})}),t._v(" "),a("keep-alive",[a(t.state.component,{tag:"component",attrs:{handleRelation:t.handleRelation,state:t.state},on:{"hook:activated":t.reloadLayout,addtovalidate:t.addToValidate,removetovalidate:t.removeToValidate,changeinput:t.changeInput}})],1),t._v(" "),t._l(t.body.components.after,function(e){return a(e,{tag:"component",attrs:{fields:t.state.fields}})})],2),t._v(" "),a("g3w-form-footer",{ref:"g3w_form_footer",attrs:{isRootComponent:t.isRootComponent,backToRoot:t.backToRoot,state:t.state}})],1)},a.staticRenderFns=[]},{"components/FormFooter.vue":53,"components/FormHeader.vue":54}],52:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),e=(e=e=e("components/InputG3WFormInputs.vue"))&&e.__esModule?e:{default:e},a.default=Vue.extend({name:"form-body",props:["state","handleRelation"],data:function(){return{show:!0}},components:{G3wFormInputs:e.default},methods:{addToValidate:function(e){this.$emit("addtovalidate",e)},removeToValidate:function(e){this.$emit("removetovalidate",e)},changeInput:function(e){this.$emit("changeinput",e)}},computed:{hasFormStructure:function(){return!!this.state.formstructure}}}),t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var e=this,t=e.$createElement,t=e._self._c||t;return t("div",[t("form",{staticClass:"form-horizontal g3w-form"},[t("div",{staticClass:"box-primary"},[t("div",{staticClass:"box-body"},[e.hasFormStructure?[t("tabs",{attrs:{layerid:e.state.layerid,feature:e.state.feature,handleRelation:e.handleRelation,contenttype:"editing",addToValidate:e.addToValidate,changeInput:e.changeInput,removeToValidate:e.removeToValidate,tabs:e.state.formstructure,fields:e.state.fields}})]:[t("g3w-form-inputs",{attrs:{state:e.state,addToValidate:e.addToValidate,removeToValidate:e.removeToValidate,changeInput:e.changeInput},on:{changeinput:e.changeInput,addinput:e.addToValidate,removeinput:e.removeToValidate}})]],2)])])])},a.staticRenderFns=[]},{"components/InputG3WFormInputs.vue":77}],53:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},a.default=Vue.extend({name:"form-footer",props:{state:{type:Object},backToRoot:{type:Function,default:function(){}},isRootComponent:{type:Function}},data:function(){return this.originalbuttons=this.state.buttons.map(function(e){return i({},e)}),{id:"footer",active:!0,show:!0}},computed:{enableSave:function(){return this.state.valid&&this.state.update}},methods:{exec:function(e){e instanceof Function?e(this.state.fields):function(){this.state.fields}()},btnEnabled:function(e){var t=e.enabled,e=e.type;return(void 0===t||t)&&("save"!==e||"save"===e&&this.enableSave)},isValid:function(){return this.state.valid}},watch:{"state.component":function(e){this.show=this.isRootComponent(e)},"state.update":{immediate:!0,handler:function(a){var n=this;this.state.buttons.find(function(e,t){e.eventButtons&&e.eventButtons.update&&(e.eventButtons.update[a]?n.state.buttons.splice(t,1,i({},e,e.eventButtons.update[a])):n.state.buttons.splice(t,1,n.originalbuttons[t]))})}}},activated:function(){this.active=!0},deactivated:function(){this.active=!1}}),t.exports.__esModule&&(t.exports=t.exports.default);var i,a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var a=this,e=a.$createElement,n=a._self._c||e;return n("div",{staticClass:"form-group g3wform_footer"},[a.show?[a._t("default",[n("div",{staticStyle:{margin:"3px","font-weight":"bold"}},[a._v("\n        * "),n("span",{directives:[{name:"t",rawName:"v-t",value:"sdk.form.footer.required_fields",expression:"'sdk.form.footer.required_fields'"}]}),a._v(" "),a.state.footer.message?n("div",{style:[a.state.footer.style]},[a._v("\n          "+a._s(a.state.footer.message)+"\n        ")]):a._e()]),a._v(" "),a._l(a.state.buttons,function(t){return n("button",{directives:[{name:"disabled",rawName:"v-disabled",value:!a.btnEnabled(t),expression:"!btnEnabled(button)"},{name:"t",rawName:"v-t",value:t.title,expression:"button.title"}],key:t.id,staticClass:"btn ",class:[t.class],attrs:{update:a.state.update,valid:a.state.valid},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),a.exec(t.cbk)}}})})])]:[n("button",{directives:[{name:"t",rawName:"v-t",value:"back",expression:"'back'"}],staticClass:"btn skin-button",on:{click:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"prevet",void 0,e.key,void 0)?null:(e.stopPropagation(),a.backToRoot(e))}}})]],2)},a.staticRenderFns=[]},{}],54:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=Vue.extend({name:"form-header",props:{headers:{type:Array,default:[]},currentid:{type:String},update:{type:Boolean},valid:{type:Boolean}},methods:{click:function(e){e!==this.currentid&&1<this.headers.length&&this.$emit("clickheader",e)},resizeForm:function(e){this.$emit("resize-form",e)}}}),t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var a=this,e=a.$createElement,n=a._self._c||e;return n("div",{staticClass:"g3wform_header box-header with-border",staticStyle:{display:"flex","flex-direction":"column"}},[n("section",{staticClass:"g3wform_header_content"},a._l(a.headers,function(t){return n("span",{key:t.id,staticClass:"title",class:[{item_selected:a.currentid===t.id&&1<a.headers.length},[1<a.headers.length?"tabs":"one"]],staticStyle:{display:"flex","justify-content":"space-between","align-items":"center"},style:{fontSize:a.isMobile()&&"1em !important"},on:{click:function(e){return e.stopPropagation(),a.click(t.id)}}},[t.icon?n("span",{staticStyle:{"margin-right":"5px"}},[n("i",{class:t.icon})]):a._e(),a._v(" "),n("span",{directives:[{name:"t",rawName:"v-t:pre",value:t.title,expression:"header.title",arg:"pre"}],staticClass:"g3w-long-text"},[a._v(a._s(t.name))]),a._v(" "),n(t.component,{tag:"component",attrs:{valid:a.valid,update:a.update}})],1)}),0)])},a.staticRenderFns=[]},{}],55:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default={name:"bar-loader",props:{loading:{type:Boolean|String,default:!1},color:{type:String,default:"#FFFFFF"}}},t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var e=this,t=e.$createElement,t=e._self._c||t;return e.loading?t("div",{staticClass:"bar-loader",staticStyle:{border:"0"},style:{backgroundColor:e.color}}):e._e()},a.staticRenderFns=[]},{}],56:[function(e,t,a){function n(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),u=e("store/application"),s=(u=u)&&u.__esModule?u:{default:u},l=e("utils/getUniqueDomId"),a.default={name:"datetime",props:{type:{type:String,default:"date"},format:{type:String,default:"YYYY-MM-DD"},minDate:{default:!1},maxDate:{default:!1},enabledDates:{default:!1},value:{},label:{default:"Date"}},data:function(){return{datetimevalue:this.value}},methods:{changeInput:function(e){},change:function(e){e=moment(e).format(this.format);this.$emit("change",e)}},mounted:(o=n(function*(){var t=this;yield this.$nextTick(),this.datetimeinputelement=$(this.$refs.iddatetimepicker),this.datetimeinputelement.datetimepicker({minDate:this.minDate,maxDate:this.maxDate,defaultDate:this.datetimevalue,useCurrent:!1,allowInputToggle:!0,enabledDates:this.enabledDates,showClose:!0,format:this.format,locale:s.default.language,toolbarPlacement:"top",widgetPositioning:{horizontal:"right"}}),this.datetimeinputelement.on("dp.change",function(e){e=e.date;t.change(e)}),this.datetimeinputelement.on("dp.hide",function(e){}),s.default.ismobile&&setTimeout(function(){return datetimeinputelement.blur()})}),function(){return o.apply(this,arguments)}),watch:{value:function(e){this.datetimevalue=e,this.datetimeinputelement.data("DateTimePicker").date(e)},minDate:(r=n(function*(e){this.datetimeinputelement.data("DateTimePicker").minDate(e)}),function(e){return r.apply(this,arguments)}),maxDate:(i=n(function*(e){this.datetimeinputelement.data("DateTimePicker").maxDate(e)}),function(e){return i.apply(this,arguments)}),enabledDates:function(e){this.datetimeinputelement.data("DateTimePicker").enabledDates(e)}},created:function(){this.id=(0,l.getUniqueDomId)()}},t.exports.__esModule&&(t.exports=t.exports.default);var i,r,o,s,l,u="function"==typeof t.exports?t.exports.options:t.exports;u.render=function(){var e=this,t=e.$createElement,t=e._self._c||t;return t("div",{ref:"datimecontainer"},[t("label",{directives:[{name:"t",rawName:"v-t",value:e.label,expression:"label"}],staticStyle:{display:"block"},attrs:{for:e.id}}),e._v(" "),t("div",{staticClass:"form-group"},[t("div",{ref:"iddatetimepicker",staticClass:"input-group date"},[t("input",{ref:"idinputdatetimepiker",staticClass:"form-control",attrs:{id:e.id,type:"text"},on:{change:e.changeInput}}),e._v(" "),t("span",{staticClass:"input-group-addon caret"},[t("span",{staticClass:"datetimeinput",class:e.g3wtemplate.getFontClass("time"===e.type?"time":"calendar")})])])])])},u.staticRenderFns=[],u._scopeId="data-v-e7683bf8"},{"store/application":193,"utils/getUniqueDomId":232}],57:[function(e,t,a){e("vueify/lib/insert-css").insert(".divider[data-v-6409ddc0]{display:block;position:relative;padding:0;margin-bottom:5px;height:0;width:100%;max-height:0;font-size:1px;line-height:0;clear:both;border:none;border-bottom:2px solid #eee}");Object.defineProperty(a,"__esModule",{value:!0}),a.default={name:"divider"},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var e=this.$createElement;return(this._self._c||e)("span",{staticClass:"divider"})},e.staticRenderFns=[],e._scopeId="data-v-6409ddc0"},{"vueify/lib/insert-css":2}],58:[function(e,t,a){e("vueify/lib/insert-css").insert('.modal-content[data-v-38db7d79]{background:hsla(0,0%,100%,.6);border-radius:3px}.modal-dialog[data-v-38db7d79]{display:inline-block;text-align:left;vertical-align:middle}.modal[data-v-38db7d79]{text-align:center;padding:0!important}.modal[data-v-38db7d79]:before{content:"";display:inline-block;height:100%;vertical-align:middle;margin-right:-4px}.carousel .carousel-control span[data-v-38db7d79]{color:#3c8dbc}');Object.defineProperty(a,"__esModule",{value:!0}),a.default={name:"g3w-images-gallery",props:{images:{type:Array,default:[]},id:{type:String,default:"gallery"},active:{type:Number}},data:function(){return{carouselId:"carousel_"+Date.now()}},methods:{isActive:function(e){return e===this.active},isRelativePath:function(e){return e.startsWith("/")||e.startsWith("http")?e:""+window.initConfig.mediaurl+e}}},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var a=this,e=a.$createElement,n=a._self._c||e;return n("div",{staticClass:"modal fade modal-fullscreen force-fullscreen",attrs:{id:a.id,tabindex:"-1",role:"dialog","aria-labelledby":"","aria-hidden":"true"}},[n("div",{staticClass:"modal-dialog"},[n("div",{staticClass:"modal-content"},[n("div",{staticClass:"modal-body"},[n("div",{staticClass:"carousel slide",attrs:{id:a.carouselId,"data-interval":"false"}},[n("div",{staticClass:"carousel-inner"},a._l(a.images,function(e,t){return n("div",{staticClass:"item",class:a.active==t?"active":""},[n("img",{staticStyle:{margin:"auto"},attrs:{src:a.isRelativePath(e.src)}})])}),0),a._v(" "),1<a.images.length?n("a",{staticClass:"left carousel-control",attrs:{href:"#"+a.carouselId,role:"button","data-slide":"prev"}},[n("span",{class:a.g3wtemplate.getFontClass("arrow-left")})]):a._e(),a._v(" "),1<a.images.length?n("a",{staticClass:"right carousel-control",attrs:{href:"#"+a.carouselId,role:"button","data-slide":"next"}},[n("span",{class:a.g3wtemplate.getFontClass("arrow-left")})]):a._e()])])])])])},e.staticRenderFns=[],e._scopeId="data-v-38db7d79"},{"vueify/lib/insert-css":2}],59:[function(e,t,a){e("vueify/lib/insert-css").insert(".show-hide-geo[data-v-ea8dc510]{color:#3c8dbc;cursor:pointer;font-size:1.2em}");Object.defineProperty(a,"__esModule",{value:!0}),e=e("mixins"),a.default={name:"g3w-geospatial",props:{data:{}},mixins:[e.geoMixin],data:function(){return{layerId:"table_layer_"+Date.now(),visible:!1,id:"geo_table_"+Date.now()}}},t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("div",{staticClass:"geo-content"},[e("span",{staticClass:"show-hide-geo",class:t.g3wtemplate.getFontClass(t.visible?"eye-close":"eye"),on:{click:function(e){return e.stopPropagation(),t.showLayer(e)}}})])},a.staticRenderFns=[],a._scopeId="data-v-ea8dc510"},{mixins:180,"vueify/lib/insert-css":2}],60:[function(e,t,a){e("vueify/lib/insert-css").insert(".help_div_container[data-v-5d3720b7]{color:#fff;text-align:justify;position:relative;border-radius:3px;margin:5px 2px;white-space:pre-line;background-color:#384246!important}.help_icon[data-v-5d3720b7]{text-align:center;font-size:.7em;margin-top:-4px;margin-left:-4px;background-color:#222d32;font-weight:700;color:#fff;position:absolute;top:0;left:0;width:15px;height:15px;border:1px solid #fff;border-radius:50%}.g3w-help-message-content[data-v-5d3720b7]{max-height:200px;padding:10px;overflow-y:auto}");Object.defineProperty(a,"__esModule",{value:!0}),a.default={name:"helpdiv",props:{message:{type:String,required:!0},type:{type:String,default:"info"}}},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var e=this,t=e.$createElement,t=e._self._c||t;return t("div",{staticClass:"help_div_container"},[t("span",{staticClass:"help_icon"},[e._v("i")]),e._v(" "),t("div",{directives:[{name:"t",rawName:"v-t",value:e.message,expression:"message"}],staticClass:"g3w-help-message-content"})])},e.staticRenderFns=[],e._scopeId="data-v-5d3720b7"},{"vueify/lib/insert-css":2}],61:[function(e,t,a){e("vueify/lib/insert-css").insert(".img-responsive[data-v-b7d14a7c]{cursor:pointer}.g3w-image[data-v-b7d14a7c]{padding-left:0!important;min-width:100px;max-width:100%;cursor:pointer}");Object.defineProperty(a,"__esModule",{value:!0}),n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e=(e=e=e("components/GlobalGallery.vue"))&&e.__esModule?e:{default:e},a.default={name:"g3w-image",props:{value:{}},data:function(){return{galleryId:"gallery_"+Date.now(),active:null}},components:{"g3w-images-gallery":e.default},computed:{values:function(){return Array.isArray(this.value)?this.value:[this.value]}},methods:{getSrc:function(e){return"object"===(void 0===e?"undefined":n(e))?e.photo:e},showGallery:function(e){this.active=e,"object"===n(this.value)&&(this.value.active=!0),$("#"+this.galleryId).modal("show")},getGalleryImages:function(){var t=this;return this.values.map(function(e){return{src:t.getSrc(e)}})}}},t.exports.__esModule&&(t.exports=t.exports.default);var n,a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var a=this,e=a.$createElement,n=a._self._c||e;return n("div",{staticClass:"container-fluid"},[n("div",{staticClass:"row"},a._l(a.values,function(e,t){return n("div",{staticClass:"g3w-image col-md-6 col-sm-12"},[n("img",{staticClass:"img-thumbnail",attrs:{src:a.getSrc(e)},on:{click:function(e){return e.stopPropagation(),a.showGallery(t)}}})])}),0),a._v(" "),n("g3w-images-gallery",{attrs:{id:a.galleryId,active:a.active,images:a.getGalleryImages()}})],1)},a.staticRenderFns=[],a._scopeId="data-v-b7d14a7c"},{"components/GlobalGallery.vue":58,"vueify/lib/insert-css":2}],62:[function(e,t,a){e("vueify/lib/insert-css").insert(".g3w-layer-positions[data-v-026784c2]{display:flex;flex-direction:column;margin:5px 0}.g3w-layer-positions-info-message[data-v-026784c2]{margin-bottom:5px;font-weight:700}.g3w-layer-positions-checkboxes[data-v-026784c2]{display:flex;justify-content:space-between}");Object.defineProperty(a,"__esModule",{value:!0}),n=e("utils/getUniqueDomId"),a.default={name:"layerspositions",props:{position:{type:String,default:"top"}},data:function(){return{layerpositions:["top","bottom"]}},methods:{change:function(e){this.$emit("layer-position-change",e.target.value)}},created:function(){var t=this;this.ids={layerpositions:(0,n.getUniqueDomId)()},this.layerpositions.forEach(function(e){return t.ids[e]=(0,n.getUniqueDomId)()})}},t.exports.__esModule&&(t.exports=t.exports.default);var n,e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"g3w-layer-positions",attrs:{id:t.ids.layerpositions}},[a("div",{directives:[{name:"t",rawName:"v-t",value:"layer_position.message",expression:"`layer_position.message`"}],staticClass:"g3w-layer-positions-info-message"}),t._v(" "),a("div",{staticClass:"g3w-layer-positions-checkboxes"},t._l(t.layerpositions,function(e){return a("div",{key:e,staticStyle:{margin:"0 5px"}},[a("input",{staticClass:"form-control magic-radio",attrs:{type:"radio",id:t.ids[e]},domProps:{value:e,checked:t.position===e},on:{change:t.change}}),t._v(" "),a("label",{directives:[{name:"t",rawName:"v-t",value:"layer_position."+e,expression:"`layer_position.${layerposition}`"}],attrs:{for:t.ids[e]}})])}),0)])},e.staticRenderFns=[],e._scopeId="data-v-026784c2"},{"utils/getUniqueDomId":232,"vueify/lib/insert-css":2}],63:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default={name:"progressbar",props:["progress"]},t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var e=this,t=e.$createElement,t=e._self._c||t;return null!=e.progress?t("div",{staticStyle:{margin:"5px 0 5px 0",width:"100%",backgroundColor:"#FFFFFF",border:"0",borderRadius:"3px"}},[t("div",{staticClass:"skin-background-color",staticStyle:{display:"flex",justifyContent:"center",fontWeight:"bold"},style:{width:e.progress<10?10:e.progress}},[t("span",[e._v(e._s(e.progress))])])]):e._e()},a.staticRenderFns=[]},{}],64:[function(e,t,a){var n,i;e("vueify/lib/insert-css").insert(".min-max-label[data-v-a8bbacb8]{align-self:end;font-weight:700}");function r(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),i=e("utils/debounce"),a.default={name:"range",props:{id:{default:void 0},label:{type:String,default:""},min:{type:Number,default:0},max:{type:Number,default:10},step:{type:Number,default:1},labelValue:{},value:{default:0},sync:{type:Boolean,default:!1},showValue:{type:Boolean,default:!1},unit:{type:String,default:""}},data:function(){return{state:{value:this.value}}},methods:{changeBackGround:function(e){this.$refs["range-input"].style.backgroundSize=(e?100*(e-this.min)/(this.max-this.min):0)+"% 100%"},setValue:function(e){this.changedValue(e)},change:function(e){this.changedValue(+e.target.value)},emitChangeValue:function(e){this.state.value=e,this.$emit("change-range",{id:this.id,value:e})}},watch:{value:function(e){this.state.value=e},"state.value":function(e){this.changeBackGround(e),this.sync&&this.emitChangeValue(e)}},created:function(){var t=this;this.changedValue=this.sync?function(){return t.$emit("changed")}:(0,i.debounce)(function(e){t.emitChangeValue(e)})},mounted:(n=r(function*(){yield this.$nextTick(),this.changeBackGround(this.value)}),function(){return n.apply(this,arguments)})},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("div",[e("section",{staticStyle:{display:"flex","justify-content":"space-between","font-weight":"bold"}},[e("section",{staticStyle:{"align-self":"flex-end"}},[e("span",{staticClass:"min-max-label"},[t._v(t._s(t.min))]),t._v(" "),e("span",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(t.unit))])]),t._v(" "),e("div",{staticStyle:{display:"flex","flex-direction":"column",margin:"0 3px"}},[e("label",{directives:[{name:"t",rawName:"v-t",value:t.label,expression:"label"}],staticClass:"skin-color",staticStyle:{display:"block"},attrs:{for:t.id}}),t._v(" "),e("input",{directives:[{name:"model",rawName:"v-model",value:t.state.value,expression:"state.value"}],ref:"range-input",attrs:{type:"range",id:t.id,min:t.min,max:t.max,step:t.step},domProps:{value:t.state.value},on:{change:t.change,__r:function(e){return t.$set(t.state,"value",e.target.value)}}})]),t._v(" "),e("section",{staticStyle:{"align-self":"flex-end"}},[e("span",{staticClass:"min-max-label"},[t._v(t._s(t.max))]),t._v(" "),e("span",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(t.unit))])])]),t._v(" "),t.showValue?[e("span",[t._v(t._s(t.state.value))]),t._v(" "),e("span",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(t.unit))])]:t._e()],2)},e.staticRenderFns=[],e._scopeId="data-v-a8bbacb8"},{"utils/debounce":213,"vueify/lib/insert-css":2}],65:[function(e,t,a){function n(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),e=e("services/gui"),o=(e=e)&&e.__esModule?e:{default:e},a.default={name:"g3w-resize",props:{show:{type:Boolean,required:!0,default:!0},orientation:{type:String,default:"h"},where:{type:String,default:"document"},moveFnc:{type:Function,default:function(e){}}},computed:{style:function(){return{minWidth:"5px",backgroundColor:"#dddddd",cursor:"v"===this.orientation?"ns-resize":"col-resize"}}},methods:{wrapMoveFnc:function(e){this.moveFnc(e)},start:function(){this.domElementMoveListen.addEventListener("mousemove",this.wrapMoveFnc),this.domElementMoveListen.addEventListener("mouseup",this.stop,{once:!0})},stop:(r=n(function*(){this.domElementMoveListen.removeEventListener("mousemove",this.wrapMoveFnc),yield this.$nextTick(),o.default.emit("resize")}),function(){return r.apply(this,arguments)})},mounted:(i=n(function*(){this.domElementMoveListen="content"===this.where?document.getElementById("g3w-view-content"):document}),function(){return i.apply(this,arguments)}),destroyed:function(){this.domElementMoveListen=null}},t.exports.__esModule&&(t.exports=t.exports.default);var i,r,o,e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var t=this,e=t.$createElement;return(t._self._c||e)("div",{directives:[{name:"show",rawName:"v-show",value:t.show,expression:"show"}],style:t.style,attrs:{id:t.$attrs.id},on:{mousedown:function(e){return e.stopPropagation(),t.start(e)}}})},e.staticRenderFns=[]},{"services/gui":188}],66:[function(e,t,a){function n(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),e=e("services/gui"),r=(e=e)&&e.__esModule?e:{default:e},a.default={name:"resize-icon",props:{type:{type:String,default:"h"}},data:function(){return{show:void 0!==this.type}},watch:{type:(i=n(function*(){this.show=!1,yield this.$nextTick(),this.show=!0}),function(){return i.apply(this,arguments)})},methods:{toggleFull:function(){r.default.toggleFullViewContent(),r.default.emit("resize")},resetToDefault:function(){r.default.resetToDefaultContentPercentage(),r.default.emit("resize")}}},t.exports.__esModule&&(t.exports=t.exports.default);var i,r,e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var e=this,t=e.$createElement,t=e._self._c||t;return t("div",{staticStyle:{display:"flex","justify-content":"space-between"}},[e.show?t("i",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:bottom.create",value:"enlange_reduce",expression:"'enlange_reduce'",arg:"bottom",modifiers:{create:!0}}],staticClass:"action-button skin-color-dark",class:e.g3wtemplate.getFontClass("resize-"+this.type),staticStyle:{cursor:"pointer","margin-right":"3px"},on:{click:e.toggleFull}}):e._e(),e._v(" "),t("i",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:left.create",value:"reset_default",expression:"'reset_default'",arg:"left",modifiers:{create:!0}}],staticClass:"action-button skin-color-dark",class:e.g3wtemplate.getFontClass("resize-default"),staticStyle:{cursor:"pointer"},on:{click:e.resetToDefault}})])},e.staticRenderFns=[]},{"services/gui":188}],67:[function(e,t,a){e("vueify/lib/insert-css").insert(".br[data-v-8413fc94]{border-radius:8px}.card[data-v-8413fc94]{width:80%;padding:10px 20px;margin:50px auto}.item[data-v-8413fc94]{height:15px;background:#ccc;margin-top:15px}.item-light[data-v-8413fc94]{background:#ddd}.text80[data-v-8413fc94]{width:80%}.chart-wrapper[data-v-8413fc94]{height:50px;display:flex;align-items:baseline;margin-bottom:20px}.chart-item[data-v-8413fc94]{height:100%;width:15px;background:#ccc;margin-right:10px}.chart-item-80[data-v-8413fc94]{height:80%}");Object.defineProperty(a,"__esModule",{value:!0}),a.default={name:"skeleton"},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var e=this.$createElement;this._self._c;return this._m(0)},e.staticRenderFns=[function(){var e=this,t=e.$createElement,t=e._self._c||t;return t("div",{staticClass:"card br"},[t("div",{staticClass:"chart-wrapper"},[t("div",{staticClass:"chart-item br"}),e._v(" "),t("div",{staticClass:"chart-item chart-item-80 item-light br"}),e._v(" "),t("div",{staticClass:"chart-item br"}),e._v(" "),t("div",{staticClass:"chart-item br chart-item-80"})]),e._v(" "),t("div",{staticClass:"item br text80"}),e._v(" "),t("div",{staticClass:"item item-light br"}),e._v(" "),t("div",{staticClass:"item br"}),e._v(" "),t("div",{staticClass:"item item-light br text80"})])}],e._scopeId="data-v-8413fc94"},{"vueify/lib/insert-css":2}],68:[function(e,t,a){var n,i,r,o,s,l,u,c;e("vueify/lib/insert-css").insert('.formquerytabs[data-v-2cbd8ce7]{overflow:hidden!important;display:flex;flex-wrap:wrap}.formquerytabs>li[data-v-2cbd8ce7]{flex:1;display:flex}.formquerytabs>li>a[data-v-2cbd8ce7]{font-weight:700;flex:1}.nav-tabs>li>a.mobile[data-v-2cbd8ce7]{padding:5px 10px}.tab_a[data-v-2cbd8ce7]{padding:5px;margin-right:0!important;border-bottom:0;margin-bottom:3px;border-radius:3px 3px 0 0}.formquerytabs li a.tab_a.group-title[data-v-2cbd8ce7]{color:inherit!important;font-weight:500;font-size:1em!important;padding:.25em;cursor:pointer}.tabs-wrapper>.formquerytabs li a.tab_a.group-title[data-v-2cbd8ce7]:before{content:"▾"}.tabs-wrapper.collapsed>.formquerytabs li a.tab_a.group-title[data-v-2cbd8ce7]:before{content:"▸"}.tabs-wrapper.collapsed>.formquerytabs+.tab-content[data-v-2cbd8ce7]{display:none}');function d(e){return e&&e.__esModule?e:{default:e}}function p(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),r=d(e("services/data")),o=d(e("components/GlobalTabsNode.vue")),s=d(e("services/gui")),l=e("utils/getFormDataExpressionRequestFromFeature"),u=e("utils/convertFeatureToGEOJSON"),c=e("utils/getUniqueDomId"),e=e("utils/noop"),a.default={name:"tabs",props:{group:{type:Boolean,default:!1},contenttype:{default:"query"},layerid:{required:!0},tabs:{required:!0},feature:{required:!0},fields:{required:!0},addToValidate:{type:Function,default:e.noop},removeToValidate:{type:Function,default:e.noop},changeInput:{type:Function,default:e.noop},showRelationByField:{type:Boolean,default:!0},handleRelation:{type:Function,default:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.relation,a=e.layerId,e=e.feature;return s.default.getService("queryresults").showRelation({relation:t,layerId:a,feature:e})}}},data:function(){return{ids:[]}},computed:{required_fields:function(){return"editing"===this.contenttype&&this.fields.filter(function(e){return e.validate.required}).map(function(e){return e.name})},show:function(){return this.tabs.reduce(function(e,t){return e||void 0===t.visible||!!t.visible},!1)}},methods:{setVisibility:(i=p(function*(e){e.visible=yield r.default.getData("expression:expression_eval",{inputs:{qgs_layer_id:this.layerid,form_data:("editing"===this.contenttype?u.convertFeatureToGEOJSON:l.getFormDataExpressionRequestFromFeature)(this.feature||{}),expression:e.visibility_expression.expression,formatter:"query"===this.contenttype?1:0},outputs:!1})}),function(e){return i.apply(this,arguments)}),setEditingRequireTab:function(e){var t=this;return void 0===e.nodes?this.required_fields.includes(e.field_name):!!e.nodes.find(function(e){return t.setEditingRequireTab(e)})},getField:function(t){return this.fields.find(function(e){return t===e.name})},toggleGroup:function(e){e.target.closest(".tabs-wrapper").classList.toggle("collapsed")}},components:{Node:o.default},created:(n=p(function*(){var a,t,n=this;this.unwatch=[],this.tabs.forEach((a=p(function*(a,e){a.visibility_expression&&(void 0===a.visible&&n.$set(a,"visible",0),yield n.setVisibility(a)),"editing"===n.contenttype&&(void 0===a.required&&(a.required=n.setEditingRequireTab(a)),a.visibility_expression)&&a.visibility_expression.referenced_columns.forEach(function(t){var e=n.fields.find(function(e){return t===e.name});n.unwatch.push(n.$watch(function(){return e.value},p(function*(){yield n.setVisibility(a)})))}),n.ids.push("tab_"+(0,c.getUniqueDomId)())}),function(e,t){return a.apply(this,arguments)})),this.root_tabs=[],this.group?this.root_tabs=[this.tabs]:(t=[],this.tabs.forEach(function(e){e.nodes?t.push(e):(t.length&&(n.root_tabs.push([].concat(t)),t.splice(0)),n.root_tabs.push({nodes:[e]}))}),t.length&&this.root_tabs.push(t))}),function(){return n.apply(this,arguments)}),beforeDestroy:function(){this.unwatch.forEach(function(e){return e()}),this.unwatch=null}},t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var a=this,e=a.$createElement,n=a._self._c||e;return a.show?n("div",{staticClass:"tabs-wrapper"},[a._l(a.root_tabs,function(e){return[Array.isArray(e)?[n("ul",{staticClass:"formquerytabs nav nav-tabs"},[a._l(e,function(e,t){return[void 0===e.visible||e.visible?n("li",{class:{active:0===t}},[n("a",{staticClass:"tab_a",class:{mobile:a.isMobile(),"group-title":a.group},style:{fontSize:a.isMobile()?"1.0em":(a.group?"1.1":"1.2")+"em"},attrs:{"data-toggle":"tab",href:"#"+a.ids[t]},on:{click:function(e){a.group&&a.toggleGroup(e)}}},[a._v("\n               "+a._s(e.name)+" "),"editing"===a.contenttype&&e.required?n("span",{staticStyle:{"padding-left":"3px","font-size":"1.1em"}},[a._v("*")]):a._e()])]):a._e()]})],2),a._v(" "),n("div",{staticClass:"tab-content",class:{editing:"editing"===a.contenttype}},[a._l(e,function(e,t){return[void 0===e.visible||e.visible?n("div",{staticClass:"tab-pane fade",class:{"in active":0===t},attrs:{id:a.ids[t]}},[n("node",{attrs:{showRelationByField:a.showRelationByField,handleRelation:a.handleRelation,feature:a.feature,layerid:a.layerid,contenttype:a.contenttype,addToValidate:a.addToValidate,removeToValidate:a.removeToValidate,changeInput:a.changeInput,fields:a.fields,showTitle:!1,node:e}})],1):a._e()]})],2)]:n("node",{attrs:{showRelationByField:a.showRelationByField,handleRelation:a.handleRelation,feature:a.feature,layerid:a.layerid,contenttype:a.contenttype,addToValidate:a.addToValidate,removeToValidate:a.removeToValidate,changeInput:a.changeInput,fields:a.fields,showTitle:!1,node:e}})]})],2):a._e()},a.staticRenderFns=[],a._scopeId="data-v-2cbd8ce7"},{"components/GlobalTabsNode.vue":69,"services/data":187,"services/gui":188,"utils/convertFeatureToGEOJSON":201,"utils/getFormDataExpressionRequestFromFeature":223,"utils/getUniqueDomId":232,"utils/noop":242,"vueify/lib/insert-css":2}],69:[function(e,t,a){var n,i,r;e("vueify/lib/insert-css").insert(".tab-node[data-v-9685e2ee]{min-width:0;overflow:hidden}.title[data-v-9685e2ee]{font-weight:700;width:100%;color:#fff;padding:3px;margin-top:5px;margin-bottom:5px;border-radius:2px}.node-row[data-v-9685e2ee]{margin-bottom:0;column-gap:2px;margin-top:0;display:grid;grid-auto-columns:minmax(0,1fr);grid-auto-flow:column}.row.mobile[data-v-9685e2ee]{margin-bottom:0!important}");function o(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(a,"__esModule",{value:!0}),n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},i=o(e("components/InputG3W.vue")),r=o(e("store/application")),e=e("gui/fields/fields"),a.default={name:"node",props:["contenttype","node","fields","showTitle","addToValidate","removeToValidate","changeInput","layerid","feature","showRelationByField","handleRelation"],components:n({G3wInput:i.default},e),data:function(){return{context:this.contenttype,editing_required:!1}},computed:{filterNodes:function(){var e=this;return this.node.nodes&&this.node.nodes.filter(function(t){return"group"===e.getNodeType(t)||(!t.nodes&&t.name&&"group"!=e.getNodeType(t)?t.relation=!0:!!e.fields.find(function(e){return(t.field_name&&t.field_name.replace(/ /g,"_"))===e.name||t.relation}))})||[]},nodesLength:function(){return this.filterNodes.length},rows:function(){var e=1;return 0===this.nodesLength?e=0:this.columnNumber<=this.nodesLength&&(e=Math.floor(this.nodesLength/this.columnNumber)+this.nodesLength%this.columnNumber),e},columnNumber:function(){var e=parseInt(this.node.columncount)?parseInt(this.node.columncount):1;return e>this.nodesLength?this.nodesLength:e},showGroupTile:function(){return this.showTitle&&this.node.showlabel&&this.node.groupbox}},methods:{loadingRelation:function(e){return(r.default.project.getLayerById(this.layerid).getRelationById(e.name)||{state:{loading:!1}}).state},isRelationDisabled:function(e){return void 0===this.getRelationName(e.name)||"editing"===this.contenttype&&this.isRelationChildLayerNotEditable(e)},getRelationName:function(e){return(r.default.project.getRelationById(e)||{}).name},isRelationChildLayerNotEditable:function(e){e=r.default.project.getRelationById(e.name).referencingLayer;return!r.default.project.getLayerById(e).isEditable()},getNodes:function(e){e=(e-1)*this.columnNumber;return this.filterNodes.slice(e,this.columnNumber+e)},getNode:function(e,t){return this.getNodes(e)[t-1]},getField:function(t){return t.relation?t:this.fields.find(function(e){return(t.field_name&&t.field_name.replace(/ /g,"_"))===e.name})},getNodeType:function(e){var t=e.groupbox||e.nodes?"group":e.relation?"relation":"field";return"field"==t&&[void 0,""].includes(e.alias)&&(e.alias=e.field_name),t},getComponent:function(e){if(!e.relation)return e.query?e.input.type:"g3w-input"}}},t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var n=this,e=n.$createElement,i=n._self._c||e;return i("div",{staticClass:"tab-node group"},[n.showGroupTile?i("h5",{staticClass:"title group-title",class:{mobile:n.isMobile()},style:{fontSize:n.isMobile()?"1em":"1.1em"}},[n._v(n._s(n.node.name)+"\n  ")]):n._e(),n._v(" "),n._l(n.rows,function(a){return i("div",{staticClass:"node-row",class:{mobile:n.isMobile()}},[n._l(n.columnNumber,function(t){return[n.getNode(a,t)?["field"===n.getNodeType(n.getNode(a,t))?i(n.getComponent(n.getField(n.getNode(a,t))),{tag:"component",staticStyle:{padding:"5px 3px 5px 3px"},attrs:{state:n.getField(n.getNode(a,t)),changeInput:n.changeInput,addToValidate:n.addToValidate,removeToValidate:n.removeToValidate,feature:n.feature},on:{changeinput:n.changeInput,addinput:n.addToValidate,removeinput:n.removeToValidate}}):["group"===n.getNodeType(n.getNode(a,t))?i("tabs",n._b({staticClass:"sub-group",staticStyle:{width:"100% !important"},attrs:{group:!0,tabs:[n.getNode(a,t)]}},"tabs",n.$props,!1)):[n.showRelationByField?i("div",{directives:[{name:"disabled",rawName:"v-disabled",value:n.isRelationDisabled(n.getNode(a,t))||n.loadingRelation(n.getNode(a,t)).loading,expression:"isRelationDisabled(getNode(row, column)) || loadingRelation(getNode(row, column)).loading"}],style:{cursor:n.showRelationByField&&"pointer"},on:{click:function(e){e.stopPropagation(),n.handleRelation({relation:n.getNode(a,t),feature:n.feature,layerId:n.layerid})}}},[i("bar-loader",{attrs:{loading:n.loadingRelation(n.getNode(a,t)).loading}}),n._v(" "),i("div",{staticStyle:{display:"flex","align-items":"center"}},[i("div",{staticClass:"query_relation_field"},[i("i",{class:n.g3wtemplate.font["query"===n.context?"relation":"pencil"]})]),n._v(" "),i("span",{staticClass:"query_relation_field_message g3w-long-text"},[i("span",{staticStyle:{"text-transform":"uppercase"}},[n._v(" "+n._s(n.getRelationName(n.getNode(a,t).name)))])])])],1):n._e()]]]:n._e()]})],2)})],2)},a.staticRenderFns=[],a._scopeId="data-v-9685e2ee"},{"components/InputG3W.vue":76,"gui/fields/fields":3,"store/application":193,"vueify/lib/insert-css":2}],70:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default={name:"header-item",props:["state"],methods:{showCustomModal:function(e){this.$emit("show-custom-modal-content",e)}},created:function(){this.state.type=this.state.type||"link"}},t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("li",{staticClass:"customheaderlink dropdown user user-menu",attrs:{title:t.state.title}},["link"===t.state.type?e("a",{staticClass:"dropdown-toggle",class:{imagelink:!!t.state.img},attrs:{href:t.state.url,target:t.state.target}},[t.state.img?e("img",{staticStyle:{"max-height":"20px"},attrs:{src:t.state.img}}):e("span",[t.state.i18n?e("span",{directives:[{name:"t",rawName:"v-t",value:t.state.title,expression:"state.title"}]}):e("span",[t._v(t._s(t.state.title))])])]):"modal"===t.state.type?e("a",{staticClass:"dropdown-toggle",staticStyle:{cursor:"pointer"},attrs:{"data-toggle":"modal","data-target":"#custom_modal"},on:{click:function(e){return e.stopPropagation(),t.showCustomModal(t.state.id)}}},[e("span",[t._v(t._s(t.state.title))])]):t._e()])},a.staticRenderFns=[]},{}],71:[function(e,t,a){e("vueify/lib/insert-css").insert(".control-label[data-v-cb533ff6]{text-align:left!important;padding-top:0!important;margin-bottom:3px}");Object.defineProperty(a,"__esModule",{value:!0}),n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},e=e("mixins"),a.default=n({name:"InputBase",props:["state"]},e.baseInputMixin),t.exports.__esModule&&(t.exports=t.exports.default);var n,a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var t=this,e=t.$createElement,e=t._self._c||e;return t.state.visible?e("div",{staticClass:"form-group"},[t._t("label",[e("label",{directives:[{name:"disabled",rawName:"v-disabled",value:!t.editable,expression:"!editable"}],staticClass:"col-sm-12 control-label",attrs:{for:t.state.name}},[t.state.i18nLabel?e("span",{directives:[{name:"t",rawName:"v-t",value:t.state.label,expression:"state.label"}]}):e("span",[t._v(t._s(t.state.label))]),t._v(" "),t.state.validate&&t.state.validate.required?e("span",[t._v("*")]):t._e(),t._v(" "),t.showhelpicon?e("i",{staticClass:"skin-color",class:t.g3wtemplate.font.info,staticStyle:{"margin-left":"3px",cursor:"pointer"},on:{click:function(e){return e.stopPropagation(),t.showHideHelp(e)}}}):t._e(),t._v(" "),t._t("label-action")],2)]),t._v(" "),t.state.relationField?e("div",{staticStyle:{color:"var(--skin-warning)",padding:"3px 0 3px 15px"}},[e("span",{class:t.g3wtemplate.getFontClass("warning")}),t._v(" "),e("span",{directives:[{name:"t",rawName:"v-t",value:"sdk.relations.field",expression:"'sdk.relations.field'"}]})]):t._e(),t._v(" "),e("div",{staticClass:"col-sm-12"},[t._t("loading",["loading"===t.loadingState?e("div",{staticStyle:{position:"relative",width:"100%"},attrs:{slot:"loading"},slot:"loading"},[e("bar-loader",{attrs:{loading:!0}})],1):t._e()]),t._v(" "),t._t("body"),t._v(" "),t._t("message",[t.notvalid?e("p",{staticClass:"g3w-long-text error-input-message",staticStyle:{margin:"0"},domProps:{innerHTML:t._s(t.state.validate.message)}}):t.state.info?e("p",{staticStyle:{margin:"0"},domProps:{innerHTML:t._s(t.state.info)}}):t._e()]),t._v(" "),t.state.help&&this.state.help.visible?e("div",{staticClass:"g3w_input_help skin-background-color extralighten",domProps:{innerHTML:t._s(t.state.help.message)}}):t._e()],2)],2):t._e()},a.staticRenderFns=[],a._scopeId="data-v-cb533ff6"},{mixins:180,"vueify/lib/insert-css":2}],72:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),n=e("mixins"),i=e("utils/getUniqueDomId"),e=e("gui/inputs/input"),a.default={name:"input-checkbox",mixins:[e,n.widgetMixins],data:function(){return{value:null,label:null,id:(0,i.getUniqueDomId)()}},methods:{setLabel:function(){this.label=this.service.convertCheckedToValue(this.value)},setValue:function(){this.value=this.service.convertValueToChecked()},changeCheckBox:function(){this.setLabel(),this.widgetChanged()},stateValueChanged:function(){this.setValue(),this.setLabel()}},mounted:function(){this.stateValueChanged()}},t.exports.__esModule&&(t.exports=t.exports.default);var n,i,a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var i=this,e=i.$createElement,e=i._self._c||e;return e("baseinput",{attrs:{state:i.state}},[e("div",{directives:[{name:"disabled",rawName:"v-disabled",value:!i.editable,expression:"!editable"}],staticStyle:{height:"20px","margin-top":"8px"},attrs:{slot:"body"},slot:"body"},[e("input",{directives:[{name:"model",rawName:"v-model",value:i.value,expression:"value"}],staticClass:"magic-checkbox",class:{"input-error-validation":i.notvalid},staticStyle:{width:"100%"},attrs:{tabIndex:i.tabIndex,type:"checkbox",id:i.id},domProps:{checked:Array.isArray(i.value)?-1<i._i(i.value,null):i.value},on:{change:[function(e){var t,a=i.value,e=e.target,n=!!e.checked;Array.isArray(a)?(t=i._i(a,null),e.checked?t<0&&(i.value=a.concat([null])):-1<t&&(i.value=a.slice(0,t).concat(a.slice(t+1)))):i.value=n},i.changeCheckBox]}}),i._v(" "),e("label",{attrs:{for:i.id}},[i._v(i._s(i.label))])])])},a.staticRenderFns=[]},{"gui/inputs/input":12,mixins:180,"utils/getUniqueDomId":232}],73:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),e=e("gui/inputs/input"),a.default={name:"input-color",mixins:[e]},t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("baseinput",{attrs:{state:t.state}},[e("input",{directives:[{name:"disabled",rawName:"v-disabled",value:!t.editable,expression:"!editable"},{name:"model",rawName:"v-model",value:t.state.value,expression:"state.value"}],staticClass:"form-control",class:{"input-error-validation":t.notvalid},staticStyle:{cursor:"pointer"},attrs:{slot:"body",placeholder:t.state.default,type:"color",tabIndex:t.tabIndex,field:t.state.name,id:t.state.name},domProps:{value:t.state.value},on:{change:t.change,input:function(e){e.target.composing||t.$set(t.state,"value",e.target.value)}},slot:"body"})])},a.staticRenderFns=[]},{"gui/inputs/input":12}],74:[function(e,t,a){function n(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),i=e("store/application"),u=(i=i)&&i.__esModule?i:{default:i},i=e("mixins"),r=e("utils/getUniqueDomId"),e=e("gui/inputs/input"),a.default={name:"input-datetime-picker",mixins:[e,i.resizeMixin],data:function(){var e=(0,r.getUniqueDomId)();return{widget_container:{top:0,left:0},iddatetimepicker:"datetimepicker_"+e,idinputdatetimepiker:"inputdatetimepicker_"+e}},methods:{resize:function(){var e=$("#"+this.iddatetimepicker);e&&e.data("DateTimePicker")&&e.data("DateTimePicker").hide()},timeOnly:function(){return!this.state.input.options.formats[0].date},onDatePickerChange:function(){var e=$("#"+this.idinputdatetimepiker).val();this.state.value=_.isEmpty(e.trim())?null:moment(e,this.datetimedisplayformat).format(this.datetimefieldformat),this.change()},onDatePickerShow:function(e){var a=this;this.widget_container.top=0,this.widget_container.left=0,setTimeout(function(){var e=a.$refs.datetimepicker_body.getBoundingClientRect(),t=a.$refs.datimewidget_container.querySelector(".bootstrap-datetimepicker-widget").getBoundingClientRect();a.widget_container.top=e.top+(e.top<t.height?e.height+Math.abs(e.top-t.height)+20:0),a.widget_container.left=e.left-Math.max(e.width,t.width),a.$emit("datetimepickershow")})},onDatePickerHide:function(e){this.$emit("datetimepickershow")}},watch:{"state.value":(s=n(function*(e){e!==$("#"+this.idinputdatetimepiker).val()&&(e=null!==e?moment(e,this.datetimefieldformat).format(this.datetimedisplayformat):e,yield this.$nextTick(),$("#"+this.idinputdatetimepiker).val(e))}),function(e){return s.apply(this,arguments)})},mounted:(o=n(function*(){var e=this,t=this.state.input.options,a=t.formats,t=t.layout,t=void 0===t?{vertical:"top",horizontal:"left"}:t,a=(void 0===a?[]:a)[0],n=a.minDate,i=a.maxDate,r=a.fieldformat,o=a.enabledDates,s=a.disabledDates,l=a.displayformat,a=a.useCurrent,l=(yield this.$nextTick(),this.datetimedisplayformat=this.service.convertQGISDateTimeFormatToMoment(l),this.datetimefieldformat=this.service.convertQGISDateTimeFormatToMoment(r),this.service.setValidatorOptions({fielddatetimeformat:this.datetimefieldformat}),moment(this.state.value,this.datetimefieldformat,!0).isValid()?moment(this.state.value,this.datetimefieldformat).toDate():null);$("#"+this.iddatetimepicker).datetimepicker({defaultDate:l,format:this.datetimedisplayformat,ignoreReadonly:!0,allowInputToggle:!0,enabledDates:o,disabledDates:s,useCurrent:a,toolbarPlacement:"top",minDate:n,maxDate:i,widgetParent:$(this.$refs.datimewidget_container),widgetPositioning:{vertical:t.vertical||"top",horizontal:t.horizontal||"left"},showClose:!0,locale:this.service.getLocale()}),$("#"+this.iddatetimepicker).on("dp.change",this.onDatePickerChange),$("#"+this.iddatetimepicker).on("dp.show",this.onDatePickerShow),$("#"+this.iddatetimepicker).on("dp.hide",this.onDatePickerHide),u.default.ismobile&&setTimeout(function(){$("#"+e.idinputdatetimepiker).blur()})}),function(){return o.apply(this,arguments)})},t.exports.__esModule&&(t.exports=t.exports.default);var i,u,r,o,s,a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var e=this,t=e.$createElement,t=e._self._c||t;return t("baseinput",{attrs:{state:e.state}},[t("div",{ref:"datetimepicker_body",attrs:{slot:"body"},slot:"body"},[t("div",{ref:"datimewidget_container",style:{top:e.widget_container.top+"px",left:e.widget_container.left+"px",position:"fixed",zIndex:1e4}}),e._v(" "),t("div",{directives:[{name:"disabled",rawName:"v-disabled",value:!e.editable,expression:"!editable"}],staticClass:"input-group date",attrs:{id:e.iddatetimepicker}},[t("input",{staticClass:"form-control",class:{"input-error-validation":e.notvalid},attrs:{type:"text",id:e.idinputdatetimepiker,tabIndex:e.tabIndex,readonly:!e.editable||e.isMobile()?"readonly":null}}),e._v(" "),t("span",{staticClass:"input-group-addon caret"},[t("span",{class:[e.g3wtemplate.getFontClass(e.timeOnly()?"time":"calendar")]})])])])])},a.staticRenderFns=[]},{"gui/inputs/input":12,mixins:180,"store/application":193,"utils/getUniqueDomId":232}],75:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),e=e("gui/inputs/input"),a.default={name:"input-float",mixins:[e]},t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("baseinput",{attrs:{state:t.state}},[e("input",{directives:[{name:"disabled",rawName:"v-disabled",value:!t.editable,expression:"!editable"},{name:"model",rawName:"v-model",value:t.state.value,expression:"state.value"}],staticClass:"form-control",class:{"input-error-validation":t.notvalid},staticStyle:{width:"100%"},attrs:{slot:"body",tabIndex:t.tabIndex,type:"number",step:t.state.step||1,placeholder:t.state.default},domProps:{value:t.state.value},on:{change:t.change,input:[function(e){e.target.composing||t.$set(t.state,"value",e.target.value)},t.change]},slot:"body"})])},a.staticRenderFns=[]},{"gui/inputs/input":12}],76:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},e={text_input:e("gui/inputs/text/vue/text"),texthtml_input:e("gui/inputs/texthtml/vue/texthtml"),textarea_input:e("gui/inputs/textarea/vue/textarea"),integer_input:e("gui/inputs/integer/vue/integer"),string_input:e("gui/inputs/text/vue/text"),float_input:e("gui/inputs/float/vue/float"),radio_input:e("gui/inputs/radio/vue/radio"),check_input:e("gui/inputs/checkbox/vue/checkbox"),range_input:e("gui/inputs/range/vue/range"),datetimepicker_input:e("gui/inputs/datetimepicker/vue/datetimepicker"),unique_input:e("gui/inputs/unique/vue/unique"),select_input:e("gui/inputs/select/vue/select"),media_input:e("gui/inputs/media/vue/media"),select_autocomplete_input:e("gui/inputs/select/vue/select"),picklayer_input:e("gui/inputs/picklayer/vue/picklayer"),color_input:e("gui/inputs/color/vue/color"),slider_input:e("gui/inputs/sliderrange/vue/sliderrange"),lonlat_input:e("gui/inputs/lonlat/vue/lonlat")},a.default={name:"g3w-input",props:{state:{required:!0},addToValidate:{type:Function,required:!0},removeToValidate:{type:Function,required:!0},changeInput:{type:Function,required:!0}},components:n({},e),computed:{type:function(){if("child"!==this.state.type)return this.state.input.type?this.state.input.type+"_input":this.state.type+"_input"}},created:function(){"child"===this.state.type||this.state.input.options||(this.state.input.options={})}},t.exports.__esModule&&(t.exports=t.exports.default);var n,a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.state.visible?a("div",["child"!==t.state.type?a("div",[a(t.type,{tag:"component",attrs:{changeInput:t.changeInput,addToValidate:t.addToValidate,removeToValidate:t.removeToValidate,state:t.state},on:{changeinput:t.changeInput,addinput:t.addToValidate,removeinput:t.removeToValidate}}),t._v(" "),a("divider")],1):a("div",{staticClass:"skin-border-color field-child",staticStyle:{"border-top":"2px solid"}},[a("h4",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(t.state.label))]),t._v(" "),a("div",[t._v(" "+t._s(t.state.description)+" ")]),t._v(" "),t._l(t.state.fields,function(e){return a("g3w-input",{key:e.name,attrs:{state:e,changeInput:t.changeInput,addToValidate:t.addToValidate,removeToValidate:t.removeToValidate},on:{changeinput:t.changeInput,addinput:t.addToValidate,removeinput:t.removeToValidate}})})],2)]):t._e()},a.staticRenderFns=[]},{"gui/inputs/checkbox/vue/checkbox":6,"gui/inputs/color/vue/color":7,"gui/inputs/datetimepicker/vue/datetimepicker":9,"gui/inputs/float/vue/float":11,"gui/inputs/integer/vue/integer":14,"gui/inputs/lonlat/vue/lonlat":16,"gui/inputs/media/vue/media":18,"gui/inputs/picklayer/vue/picklayer":20,"gui/inputs/radio/vue/radio":22,"gui/inputs/range/vue/range":24,"gui/inputs/select/vue/select":26,"gui/inputs/sliderrange/vue/sliderrange":30,"gui/inputs/text/vue/text":31,"gui/inputs/textarea/vue/textarea":32,"gui/inputs/texthtml/vue/texthtml":33,"gui/inputs/unique/vue/unique":35}],77:[function(e,t,a){e("vueify/lib/insert-css").insert("#g3w-for-inputs-required-inputs-message[data-v-06573254]{margin-bottom:5px;font-weight:700;text-align:center;display:flex;align-items:center;justify-content:center}.box-body[data-v-06573254]{padding:5px}");Object.defineProperty(a,"__esModule",{value:!0}),e=(e=e=e("components/InputG3W.vue"))&&e.__esModule?e:{default:e},a.default={name:"g3w-form-inputs",props:{state:{type:Object,default:{fields:[]}},addToValidate:{type:Function},changeInput:{type:Function},show_required_field_message:{type:Boolean,default:!1},removeToValidate:{type:Function}},components:{G3wInput:e.default}},t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("form",{staticClass:"form-horizontal g3w-form"},[a("div",{staticClass:"box-primary"},[a("div",{staticClass:"box-body"},[t._l(t.state.fields,function(e){return[a("g3w-input",{attrs:{state:e,removeToValidate:t.removeToValidate,addToValidate:t.addToValidate,changeInput:t.changeInput},on:{addToValidate:t.addToValidate,changeInput:t.changeInput}})]})],2),t._v(" "),t.show_required_field_message?a("div",{attrs:{id:"g3w-for-inputs-required-inputs-message"}},[a("span",{staticClass:"hide-cursor-caret-color"},[t._v("*")]),t._v(" "),a("span",{directives:[{name:"t",rawName:"v-t",value:"sdk.form.footer.required_fields",expression:"'sdk.form.footer.required_fields'"}],staticClass:"hide-cursor-caret-color"})]):t._e()])])},a.staticRenderFns=[],a._scopeId="data-v-06573254"},{"components/InputG3W.vue":76,"vueify/lib/insert-css":2}],78:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),e=e("gui/inputs/input"),a.default={name:"input-integer",mixins:[e]},t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("baseinput",{attrs:{state:t.state}},[e("input",{directives:[{name:"disabled",rawName:"v-disabled",value:!t.editable,expression:"!editable"},{name:"model",rawName:"v-model",value:t.state.value,expression:"state.value"}],staticClass:"form-control",class:{"input-error-validation":t.notvalid},staticStyle:{width:"100%"},attrs:{slot:"body",placeholder:t.state.default,tabIndex:t.tabIndex,type:"number"},domProps:{value:t.state.value},on:{change:t.change,input:[function(e){e.target.composing||t.$set(t.state,"value",e.target.value)},t.change]},slot:"body"})])},a.staticRenderFns=[]},{"gui/inputs/input":12}],79:[function(e,t,a){function n(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),i=e("utils/getUniqueDomId"),e=e("gui/inputs/input"),a.default={name:"input-lonlat",mixins:[e],data:function(){return{lonId:(0,i.getUniqueDomId)(),latId:(0,i.getUniqueDomId)(),coordinatebutton:{active:!1}}},computed:{getCoordinateActive:function(){return this.service.state.getCoordinateActive}},methods:{toggleGetCoordinate:function(){this.service.toggleGetCoordinate()},changeLonLat:function(){this.change(),this.setValue()},setValue:function(){this.state.value=[[+this.state.values.lon,+this.state.values.lat]]}},created:function(){this.state.values=this.state.values||{lon:0,lat:0},this.setValue(),this.service.setCoordinateButtonReactiveObject(this.coordinatebutton)},mounted:(r=n(function*(){yield this.$nextTick(),$(this.$refs["g3w-input-lat-lon"]).tooltip({trigger:"hover"})}),function(){return r.apply(this,arguments)}),destroyed:function(){this.service.clear()}},t.exports.__esModule&&(t.exports=t.exports.default);var i,r,a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("div",{staticStyle:{position:"relative"}},[e("div",{staticStyle:{display:"flex","justify-content":"flex-end",height:"35px","margin-right":"12px","margin-bottom":"5px"}},[e("button",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip",value:"sdk.form.inputs.tooltips.lonlat",expression:"'sdk.form.inputs.tooltips.lonlat'"}],ref:"g3w-input-lat-lon",staticClass:"action skin-tooltip-left skin-color skin-border-color",class:t.g3wtemplate.font.crosshairs,staticStyle:{"border-radius":"5px","font-weight":"bold","font-size":"20px",cursor:"pointer"},style:{border:t.coordinatebutton.active?"2px solid":0},attrs:{"data-placement":"left","data-container":"body","data-toggle":"tooltip"},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),t.toggleGetCoordinate(e)}}})]),t._v(" "),e("baseinput",{attrs:{state:t.state}},[e("label",{staticClass:"col-sm-4 control-label",attrs:{slot:"label",for:t.lonId},slot:"label"},[t._v(t._s(t.state.labels.lon)+"\n      "),t.state.validate&&t.state.validate.required?e("span",[t._v("*")]):t._e()]),t._v(" "),e("div",{attrs:{slot:"body"},slot:"body"},[e("input",{directives:[{name:"disabled",rawName:"v-disabled",value:!t.editable,expression:"!editable"},{name:"model",rawName:"v-model",value:t.state.values.lon,expression:"state.values.lon"}],staticClass:"form-control",class:{"input-error-validation":t.notvalid},staticStyle:{width:"100%","margin-bottom":"5px"},attrs:{id:t.lonId,tabIndex:t.tabIndex,type:"number",min:"-180",max:"180",placeholder:"Lon"},domProps:{value:t.state.values.lon},on:{change:t.changeLonLat,input:function(e){e.target.composing||t.$set(t.state.values,"lon",e.target.value)}}})])]),t._v(" "),e("baseinput",{attrs:{state:t.state}},[e("label",{staticClass:"col-sm-4 control-label",attrs:{slot:"label",for:t.latId},slot:"label"},[t._v(t._s(t.state.labels.lat)+"\n      "),t.state.validate&&t.state.validate.required?e("span",[t._v("*")]):t._e()]),t._v(" "),e("div",{attrs:{slot:"body"},slot:"body"},[e("input",{directives:[{name:"disabled",rawName:"v-disabled",value:!t.editable,expression:"!editable"},{name:"model",rawName:"v-model",value:t.state.values.lat,expression:"state.values.lat"}],staticClass:"form-control",class:{"input-error-validation":t.notvalid},staticStyle:{width:"100%","margin-bottom":"5px"},attrs:{id:t.latId,tabIndex:t.tabIndex,type:"number",min:"-90",max:"90",placeholder:"Lon"},domProps:{value:t.state.values.lat},on:{change:t.changeLonLat,input:function(e){e.target.composing||t.$set(t.state.values,"lat",e.target.value)}}})])])],1)},a.staticRenderFns=[]},{"gui/inputs/input":12,"utils/getUniqueDomId":232}],80:[function(e,t,a){function n(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),i=e("services/gui"),r=(i=i)&&i.__esModule?i:{default:i},o=e("utils/getUniqueDomId"),i=e("gui/inputs/input"),l=e("g3w-i18n").t,e=e("gui/fields/fields").media_field,a.default={name:"input-media",mixins:[i],components:{"g3w-media":e},data:function(){return{data:{value:null,mime_type:null},mediaid:"media_"+(0,o.getUniqueDomId)(),loading:!1}},methods:{onClick:function(){document.getElementById(this.mediaid).click()},clearMedia:function(){this.data.value=this.data.mime_type=this.state.value=null,this.change()}},created:function(){this.state.value&&(this.data.value=this.state.value.value,this.data.mime_type=this.state.value.mime_type)},mounted:(s=n(function*(){var a=this,n=this.state.name,e={name:n,csrfmiddlewaretoken:this.$cookie.get("csrftoken")};yield this.$nextTick(),$("#"+this.mediaid).fileupload({dataType:"json",formData:e,start:function(){return a.loading=!0},done:function(e,t){t=t.result[n];t&&(a.data.value=t.value,a.data.mime_type=t.mime_type,a.state.value=a.data,a.change())},fail:function(e){r.default.notify.error(l("info.server_error"))},always:function(){return a.loading=!1}})}),function(){return s.apply(this,arguments)}),beforeDestroy:function(){$("#"+this.mediaid).fileupload("destroy")}},t.exports.__esModule&&(t.exports=t.exports.default);var i,r,o,s,l,a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("baseinput",{attrs:{state:t.state}},[e("div",{directives:[{name:"disabled",rawName:"v-disabled",value:!t.editable,expression:"!editable"}],attrs:{slot:"body"},slot:"body"},[e("div",{staticClass:"g3w_input_button skin-border-color",staticStyle:{"border-style":"solid","border-width":"2px",width:"100%",cursor:"pointer","text-align":"center"},on:{click:t.onClick}},[e("i",{staticClass:"fa-2x skin-color",class:t.g3wtemplate.getFontClass("file-upload"),staticStyle:{padding:"5px"}},[e("input",{class:{"input-error-validation":t.notvalid},staticStyle:{display:"none"},attrs:{id:t.mediaid,name:t.state.name,tabIndex:t.tabIndex,"data-url":t.state.input.options.uploadurl,type:"file"}})])]),t._v(" "),e("bar-loader",{attrs:{loading:t.loading}}),t._v(" "),e("g3w-media",{attrs:{state:t.data}},[e("div",{staticClass:"clearmedia",on:{click:function(e){return e.stopPropagation(),t.clearMedia()}}},[e("i",{staticClass:"g3w-icon",class:t.g3wtemplate.font["trash-o"]})])])],1)])},a.staticRenderFns=[]},{"g3w-i18n":143,"gui/fields/fields":3,"gui/inputs/input":12,"services/gui":188,"utils/getUniqueDomId":232}],81:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),n=e("gui/inputs/input"),i=e("gui/inputs/picklayer/service"),a.default={name:"input-picklayer",mixins:[n],methods:{pickLayer:function(){var t=this;this.pickservice.pick().then(function(e){return t.state.value=e}).catch(function(){})},unpick:function(){var e=this;setTimeout(function(){return!e.pickservice.isPicked()&&e.pickservice.unpick()},200)}},created:function(){this.pickservice=new i(this.state.input.options)},beforeDestroy:function(){this.pickservice.clear(),this.pickservice=null}},t.exports.__esModule&&(t.exports=t.exports.default);var n,i,e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("baseinput",{attrs:{state:t.state}},[e("div",{attrs:{slot:"body"},slot:"body"},[e("span",{staticClass:"skin-color",class:t.g3wtemplate.font.crosshairs,staticStyle:{left:"0",top:"7px",position:"absolute"}}),t._v(" "),e("input",{directives:[{name:"disabled",rawName:"v-disabled",value:!t.editable,expression:"!editable"},{name:"model",rawName:"v-model",value:t.state.value,expression:"state.value"}],staticClass:"form-control",class:{"input-error-validation":t.notvalid},staticStyle:{width:"100%"},style:{cursor:t.editable?"pointer":null},attrs:{readonly:"readonly",tabIndex:t.tabIndex},domProps:{value:t.state.value},on:{input:[function(e){e.target.composing||t.$set(t.state,"value",e.target.value)},t.change],click:t.pickLayer,blur:t.unpick}})])])},e.staticRenderFns=[]},{"gui/inputs/input":12,"gui/inputs/picklayer/service":19}],82:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),n=e("utils/getUniqueDomId"),e=e("gui/inputs/input"),a.default={name:"input-radio",mixins:[e],data:function(){return{ids:[(0,n.getUniqueDomId)(),(0,n.getUniqueDomId)()],name:"name_"+(0,n.getUniqueDomId)(),radio_value:this.state.value}},watch:{radio_value:function(){this.state.value=this.radio_value,this.change()}}},t.exports.__esModule&&(t.exports=t.exports.default);var n,a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var a=this,e=a.$createElement,n=a._self._c||e;return n("baseinput",{attrs:{state:a.state}},[n("div",{attrs:{slot:"body"},slot:"body"},a._l(a.state.input.options.values,function(t,e){return n("span",{key:t.key},[n("input",{directives:[{name:"disabled",rawName:"v-disabled",value:!a.editable,expression:"!editable"},{name:"model",rawName:"v-model",value:a.radio_value,expression:"radio_value"}],staticClass:"magic-radio",class:{"input-error-validation":a.notvalid},staticStyle:{width:"100%"},attrs:{id:a.ids[e],name:a.name,tabIndex:a.tabIndex,type:"radio"},domProps:{value:t.value,checked:a._q(a.radio_value,t.value)},on:{change:function(e){a.radio_value=t.value}}}),a._v(" "),n("label",{attrs:{for:a.ids[e]}},[a._v(a._s(t.key))])])}),0)])},a.staticRenderFns=[]},{"gui/inputs/input":12,"utils/getUniqueDomId":232}],83:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),e=e("gui/inputs/input"),a.default={name:"input-range",mixins:[e],data:function(){var e=this.state.input.options.values[0];return{min:e.min,max:e.max,step:e.Step}},methods:{checkValue:function(){var e=null===this.state.value||_.isEmpty((""+this.state.value).trim());e&&!this.state.validate.required&&(this.state.value=this.state.input.options.values[0].default),this.state.validate.valid=!this.state.validate.required,e||(this.state.validate.valid=this.service.getValidator().validate(this.state.value)),this.change()}}},t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("baseinput",{attrs:{state:t.state}},[e("input",{directives:[{name:"disabled",rawName:"v-disabled",value:!t.editable,expression:"!editable"},{name:"model",rawName:"v-model",value:t.state.value,expression:"state.value"}],staticClass:"form-control",class:{"input-error-validation":t.notvalid},staticStyle:{width:"100%","padding-right":"5px"},attrs:{slot:"body",tabIndex:t.tabIndex,type:"number",step:t.step},domProps:{value:t.state.value},on:{keydown:[function(e){if(!e.type.indexOf("key")&&69!==e.keyCode)return null;e.preventDefault()},function(e){if(!e.type.indexOf("key")&&13!==e.keyCode)return null;e.stopPropagation()}],change:t.checkValue,blur:t.checkValue,input:function(e){e.target.composing||t.$set(t.state,"value",e.target.value)}},slot:"body"})])},a.staticRenderFns=[]},{"gui/inputs/input":12}],84:[function(e,t,a){var v,_,b,n,w,x,i,r,o,s,k,S,E;e("vueify/lib/insert-css").insert(".g3w-input-pick-layer[data-v-6b3d29b0]{cursor:pointer;position:relative;top:2px;font-size:1.2em}");function l(e){return e&&e.__esModule?e:{default:e}}function L(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),v=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},_=l(e("services/gui")),b=l(e("store/application")),n=e("mixins"),w=e("utils/createSingleFieldParameter"),x=e("utils/getCatalogLayerById"),k=e("gui/inputs/picklayer/service"),S=e("map/layers/layer").Layer,e=e("gui/inputs/input"),E=null,a.default={name:"input-select",mixins:[e,n.selectMixin,n.select2Mixin],data:function(){return{showPickLayer:!1,picked:!1,filterFields:[],isFilterFieldsReady:!1}},computed:{showNullOption:function(){return[void 0,!0].includes(this.state.nullOption)},select2NullValue:function(){return this.showNullOption&&E}},methods:{pickLayerValue:(s=L(function*(){try{var e,t;this.picked?this.pickLayerInputService.unpick():(this.picked=!0,e=yield this.pickLayerInputService.pick(),this.autocomplete&&(this.state.input.options.values.splice(0,this.state.input.options.values.length,{key:e[this.state.input.options.key],value:e[this.state.input.options.value]}),yield this.$nextTick()),t=e[this.state.input.options.value],this.select2.val(t).trigger("change"),yield this.changeSelect(t),_.default.showUserMessage({type:"success",autoclose:!0})),this.picked=!1}catch(e){_.default.showUserMessage({type:"warning",message:"sdk.form.inputs.messages.errors.picklayer",autoclose:!0}),this.picked=!1}}),function(){return s.apply(this,arguments)}),setAndListenSelect2Change:function(){var t=this;this.select2.on("select2:select",function(e){e=e.params.data.$value||e.params.data.id,e=t.showNullOption&&e===E?null:e.toString();t.changeSelect(e)})}},watch:{"state.input.options.values":(o=L(function*(e){var t,a=this;yield this.$nextTick(),this.autocomplete||(t=void 0,e=(t=0===e.length||void 0===(e=e.find(function(e){return e.value==a.state.value}))?E:e.value)!=this.state.value,this.state.value=t,this.setValue(),e&&this.change())}),function(e){return o.apply(this,arguments)})},created:(r=L(function*(){var s=this,e=(this.unwatch,this.filterFieldsUnwatches,this.state.input.options),t=e.filter_fields,n=void 0===t?[]:t,t=e.relation_reference,a=e.relation_id,e=e.chain_filters,l=void 0!==e&&e;if(void 0!==t&&t&&Array.isArray(n)&&0<n.length){this.setLoading(!0),this.isFilterFieldsReady=!1;var e=b.default.project.getRelationById(a),t=e.referencedLayer,a=e.fieldRef,u=a.referencingField,c=a.referencedField,d=(0,x.getCatalogLayerById)(e.referencingLayer),p=(0,x.getCatalogLayerById)(t),i=p.getFields();if(null!==this.state.value)try{var r=(yield p.getFilterData({formatter:0,field:(0,w.createSingleFieldParameter)({field:c[0],value:this.state.value})})).data,o=void 0===r?[]:r;this.state.input.options.values=((yield d.getFilterData({fformatter:u[0],order:u[0],ffield:n.map(function(t,e){var a=void 0===o[0].features[0].get(t)?""+E:o[0].features[0].get(t);return s.filterFields.push({id:t,values:[{key:"["+i.find(function(e){return e.name===t}).label+"]",value:""+E}],value:a,disabled:l&&0<e&&""+E===s.filterFields[n[e-1]]}),(0,w.createSingleFieldParameter)({field:t,value:a})}).join("|AND,")})).data||[]).map(function(e){var e=v(e,2),t=e[0];return{key:e[1],value:t}}),l?((yield p.getFilterData({unique:n[0],ordering:n[0],formatter:0})).forEach(function(e){return s.filterFields[0].values.push({key:e,value:e})}),(yield Promise.allSettled(n.slice(1).map(function(e,t){return p.getFilterData({unique:n[t+1],ordering:n[t+1],formatter:0,field:s.filterFields.slice(0,t+1).filter(function(e){return"null"!==e.value}).map(function(e){return(0,w.createSingleFieldParameter)({field:e.id,value:e.value})}).join("|AND,")})}))).forEach(function(e,t){"fulfilled"===e.status&&e.value.forEach(function(e){return s.filterFields[t+1].values.push({key:e,value:e})})})):(yield Promise.allSettled(n.map(function(e){return p.getFilterData({unique:e,ordering:e,formatter:0})}))).forEach(function(e,t){"fulfilled"===e.status&&e.value.forEach(function(e){return s.filterFields[t].values.push({key:e,value:e})})})}catch(e){}else(yield Promise.allSettled(n.map(function(t,e){return s.filterFields.push({id:t,values:[{key:"["+i.find(function(e){return e.name===t}).label+"]",value:""+E}],value:""+E,disabled:l&&0<e}),p.getFilterData({unique:t,formatter:0,ordering:t})}))).forEach(function(e,t){"fulfilled"===e.status&&e.value.forEach(function(e){return s.filterFields[t].values.push({key:e,value:e})})});this.filterFieldsUnwatches=this.filterFields.map(function(e,o){return s.$watch(function(){return e.value},(t=L(function*(e){if(s.setLoading(!0),l){for(var t=o+1;t<s.filterFields.length;t++)s.filterFields[t].value=""+E,s.filterFields[t].values=[s.filterFields[t].values[0]],s.filterFields[t].disabled=""+E===e;try{var a,n=s.filterFields.slice(0,o+1).filter(function(e){return""+E!==e.value}).map(function(e){return(0,w.createSingleFieldParameter)({field:e.id,value:e.value})}).join("|AND,"),i=(yield p.getFilterData({field:n})).data,r=void 0===i?[]:i;r[0]&&r[0].features&&(a=[],r[0].features.forEach(function(e){a.push(e.get(c)),o<s.filterFields.length-1&&(e=e.get(s.filterFields[o+1].id),s.filterFields[o+1].values.push({key:e,value:e}))}))}catch(e){}}s.state.input.options.values=((yield d.getFilterData({fformatter:u[0],ordering:u[0],ffield:s.filterFields.filter(function(e){return""+E!==e.value}).map(function(e){return(0,w.createSingleFieldParameter)({field:e.id,value:e.value})}).join("|AND,")})).data||[]).map(function(e){var e=v(e,2),t=e[0];return{key:e[1],value:t}}),0<s.state.input.options.values.length&&(s.state.value=s.state.input.options.values[0].value,s.select2.val(s.state.value).trigger("change"),yield s.changeSelect(s.state.value)),s.setLoading(!1)}),function(e){return t.apply(this,arguments)}));var t}),this.setLoading(!1),this.isFilterFieldsReady=!0}if("select_autocomplete"===this.state.input.type){a=this.state.input.options.layer_id;try{var f,g,h,y,m=_.default.getService("map").getProjectLayer(a).getEditingLayer()||(0,x.getCatalogLayerById)(a);this.showPickLayer=m&&S.LayerTypes.TABLE!==m.getType(),this.showPickLayer&&(g=(f=this.state.input.options).key,h=f.value,y=f.layer_id,this.pickLayerInputService=new k({layer_id:y,fields:[h,g],pick_type:m.isStarted&&m.isStarted()?"map":null}))}catch(e){}}}),function(){return r.apply(this,arguments)}),mounted:(i=L(function*(){var n=this,e=(yield this.$nextTick(),$(this.$refs.select)),t=this.getLanguage(),a=void 0===this.state.dropdownParent&&$("#g3w-view-content");this.autocomplete?(this.select2=e.select2({minimumInputLength:1,dropdownParent:a,allowClear:this.showNullOption,placeholder:"",language:t,ajax:{delay:250,transport:function(e,t,a){e=e.data.term;$(".select2-results__option.loading-results").siblings().hide(),n.resetValues(),n.service.getData({search:e}).then(function(e){return t(e)}).catch(function(e){return a(e)})},processResults:function(e,t){return t.page=t.page||1,{results:e,pagination:{more:!1}}}}}),this.state.value&&(this.state.input.options.values.splice(0),yield this.service.getKeyByValue({search:this.state.value})),this.showNullOption&&this.select2.on("select2:unselect",function(){n.changeSelect(null)})):this.select2=e.select2({language:t,dropdownParent:a,minimumResultsForSearch:this.isMobile()?-1:null}),this.setAndListenSelect2Change(),this.setValue()}),function(){return i.apply(this,arguments)}),beforeDestroy:function(){this.pickLayerInputService&&(this.pickLayerInputService.clear(),this.pickLayerInputService=null),this.unwatch&&(this.unwatch(),this.unwatch=null),this.filterFieldsUnwatches&&(this.filterFieldsUnwatches.forEach(function(e){return e()}),this.filterFieldsUnwatches=null)}},t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var a=this,e=a.$createElement,n=a._self._c||e;return n("baseinput",{attrs:{state:a.state}},[a.showPickLayer?n("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:top.create",value:"sdk.form.inputs.tooltips.picklayer",expression:"'sdk.form.inputs.tooltips.picklayer'",arg:"top",modifiers:{create:!0}},{name:"disabled",rawName:"v-disabled",value:a.disabled,expression:"disabled"}],staticClass:"g3w-input-pick-layer skin-color",attrs:{slot:"label-action"},on:{click:function(e){return e.stopPropagation(),a.pickLayerValue(e)}},slot:"label-action"},[n("i",{class:a.g3wtemplate.font.crosshairs})]):a._e(),a._v(" "),n("div",{directives:[{name:"disabled",rawName:"v-disabled",value:a.disabled,expression:"disabled"}],attrs:{slot:"body",tabIndex:a.tabIndex},slot:"body"},[0<a.filterFields.length&&a.isFilterFieldsReady?n("div",{staticClass:"g3w-relation-reference-fields-content"},[a._l(a.filterFields,function(e,t){return[n("select",{directives:[{name:"select2",rawName:"v-select2",value:"filterFields",expression:"'filterFields'"}],ref:"filterField_"+e.id,refInFor:!0,staticClass:"form-control",staticStyle:{width:"100%"},attrs:{select2_value:e.value,indexItem:t,id:e.id,disabled:e.disabled}},a._l(e.values,function(e){var t=e.key;return n("option",{domProps:{value:a.getValue(e.value)}},[a._v("\n            "+a._s(t)+"\n          ")])}),0)]}),a._v(" "),n("divider")],2):a._e(),a._v(" "),n("select",{ref:"select",staticClass:"form-control",staticStyle:{width:"100%"}},[a.showNullOption?n("option",{domProps:{value:a.select2NullValue}}):a._e(),a._v(" "),a._l(a.state.input.options.values,function(e){var t=e.key,e=e.value;return n("option",{key:a.getValue(e),domProps:{value:a.getValue(e)}},[a._v("\n          "+a._s(t)+"\n      ")])})],2)]),a._v(" "),"error"===a.loadingState?n("p",{directives:[{name:"t",rawName:"v-t",value:"server_error",expression:"'server_error'"}],staticClass:"error-input-message",attrs:{slot:"message"},slot:"message"}):a._e()])},a.staticRenderFns=[],a._scopeId="data-v-6b3d29b0"},{"gui/inputs/input":12,"gui/inputs/picklayer/service":19,"map/layers/layer":170,mixins:180,"services/gui":188,"store/application":193,"utils/createSingleFieldParameter":211,"utils/getCatalogLayerById":218,"vueify/lib/insert-css":2}],85:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),e=e("gui/inputs/input"),a.default={name:"input-slider-range",mixins:[e],watch:{"state.input.options.min":function(){this.service.changeInfoMessage()},"state.input.options.max":function(){this.service.changeInfoMessage()}}},t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("baseinput",{attrs:{state:t.state}},[e("div",{attrs:{slot:"body"},slot:"body"},[e("span",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(t.state.value))]),t._v(" "),e("input",{directives:[{name:"disabled",rawName:"v-disabled",value:!t.editable,expression:"!editable"},{name:"model",rawName:"v-model",value:t.state.value,expression:"state.value"}],class:{"input-error-validation":t.notvalid},staticStyle:{width:"100%","padding-right":"5px"},attrs:{slot:"body",tabIndex:t.tabIndex,min:t.state.input.options.min,max:t.state.input.options.max,type:"range",step:t.state.input.options.step},domProps:{value:t.state.value},on:{change:t.change,__r:function(e){return t.$set(t.state,"value",e.target.value)}},slot:"body"})])])},a.staticRenderFns=[]},{"gui/inputs/input":12}],86:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),e=e("gui/inputs/input"),a.default={name:"input-text",mixins:[e]},t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("baseinput",{attrs:{state:t.state}},[e("input",{directives:[{name:"disabled",rawName:"v-disabled",value:!t.editable,expression:"!editable"},{name:"model",rawName:"v-model",value:t.state.value,expression:"state.value"}],staticClass:"form-control",class:{"input-error-validation":t.notvalid},attrs:{slot:"body",placeholder:t.state.default,tabIndex:t.tabIndex,field:t.state.name,id:t.state.name},domProps:{value:t.state.value},on:{keyup:function(e){t.isMobile()?t.mobileChange(e):t.change()},input:function(e){e.target.composing||t.$set(t.state,"value",e.target.value)}},slot:"body"})])},a.staticRenderFns=[]},{"gui/inputs/input":12}],87:[function(e,t,a){e("vueify/lib/insert-css").insert("textarea[data-v-3ac5abe4]{resize:none;border:1px solid #ccc}");Object.defineProperty(a,"__esModule",{value:!0}),e=e("gui/inputs/input"),a.default={name:"input-textarea",mixins:[e]},t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("baseinput",{attrs:{state:t.state}},[e("textarea",{directives:[{name:"disabled",rawName:"v-disabled",value:!t.editable,expression:"!editable"},{name:"model",rawName:"v-model",value:t.state.value,expression:"state.value"}],class:{"input-error-validation":t.notvalid},staticStyle:{"max-width":"100%","min-width":"100%"},attrs:{slot:"body",placeholder:t.state.default,rows:"3",tabIndex:t.tabIndex},domProps:{value:t.state.value},on:{keydown:function(e){e.stopPropagation()},input:[function(e){e.target.composing||t.$set(t.state,"value",e.target.value)},t.change],change:t.change},slot:"body"})])},a.staticRenderFns=[],a._scopeId="data-v-3ac5abe4"},{"gui/inputs/input":12,"vueify/lib/insert-css":2}],88:[function(e,t,a){var n;e("vueify/lib/insert-css").insert('button.ql-html{width:40px!important}button.ql-html:after{content:"html"}');function i(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),e=e("gui/inputs/input"),a.default={name:"input-html",mixins:[e],methods:{setupTableCustomTools:function(){var e=this.$el.querySelector(".ql-column-left"),e=(e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-left-square" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/><path d="M10.205 12.456A.5.5 0 0 0 10.5 12V4a.5.5 0 0 0-.832-.374l-4.5 4a.5.5 0 0 0 0 .748l4.5 4a.5.5 0 0 0 .537.082z"/></svg>',e.title="Add column left",this.$el.querySelector(".ql-column-right")),e=(e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-right-square" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/><path d="M5.795 12.456A.5.5 0 0 1 5.5 12V4a.5.5 0 0 1 .832-.374l4.5 4a.5.5 0 0 1 0 .748l-4.5 4a.5.5 0 0 1-.537.082z"/></svg>',e.title="Add column right",this.$el.querySelector(".ql-column-remove")),e=(e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-x-square" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/><path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/></svg>',e.title="Remove column",this.$el.querySelector(".ql-row-above")),e=(e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-up-square" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/><path d="M3.544 10.705A.5.5 0 0 0 4 11h8a.5.5 0 0 0 .374-.832l-4-4.5a.5.5 0 0 0-.748 0l-4 4.5a.5.5 0 0 0-.082.537z"/></svg>',e.title="Add row above",this.$el.querySelector(".ql-row-below")),e=(e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-caret-down-square" viewBox="0 0 16 16"><path d="M3.626 6.832A.5.5 0 0 1 4 6h8a.5.5 0 0 1 .374.832l-4 4.5a.5.5 0 0 1-.748 0l-4-4.5z"/><path d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm15 0a1 1 0 0 0-1-1H2a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2z"/></svg>',e.title="Add row below",this.$el.querySelector(".ql-row-remove"));e.innerHTML='<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-dash-square" viewBox="0 0 16 16"><path d="M14 1a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H2a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1h12zM2 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H2z"/><path d="M4 8a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7A.5.5 0 0 1 4 8z"/></svg>',e.title="Remove row"}},created:function(){this.edit_state={edit:!1,show_html:!1},this.state.edit_states||(this.state.edit_states=[]),this.state.edit_states.push(this.edit_state)},mounted:(n=i(function*(){var p=this;yield this.$nextTick(),this.quill=new Quill(this.$refs.quill_editor,{modules:{table:!0,toolbar:{container:[[{header:[1,2,3,4,5,6,!1]}],[{align:""},{align:"center"},{align:"right"},{align:"justify"}],[{color:[]},{background:[]}],["bold","italic","underline",{list:"ordered"},{list:"bullet"},"link","clean","html"],["table","column-left","column-right","column-remove","row-above","row-below","row-remove"]],handlers:{html:function(){p.edit_state.show_html=!p.edit_state.show_html,p.edit_state.show_html?p.quill.container.firstChild.innerText=p.quill.container.firstChild.innerHTML:p.quill.container.firstChild.innerHTML=p.quill.container.firstChild.innerText;var e=!0,t=!1,a=void 0;try{for(var n,i=p.$el.querySelectorAll(".ql-formats")[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var r=n.value,o=!0,s=!1,l=void 0;try{for(var u,c=r.children[Symbol.iterator]();!(o=(u=c.next()).done);o=!0){var d=u.value;d.classList.contains("ql-html")?d.classList.toggle("skin-color"):d.classList.toggle("g3w-disabled")}}catch(e){s=!0,l=e}finally{try{!o&&c.return&&c.return()}finally{if(s)throw l}}}}catch(e){t=!0,a=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw a}}},"column-left":function(){return p.table.insertColumnLeft()},"column-right":function(){return p.table.insertColumnRight()},"column-remove":function(){return p.table.deleteColumn()},"row-above":function(){return p.table.insertRowAbove()},"row-below":function(){return p.table.insertRowBelow()},"row-remove":function(){return p.table.deleteRow()}}}},theme:"snow"}),this.quill.container.firstChild.innerHTML=this.state.value,this.table=this.quill.getModule("table"),this.setupTableCustomTools(),this.handler=function(){p.state.value=p.edit_state.show_html?p.quill.container.firstChild.innerText:p.quill.container.firstChild.innerHTML,p.edit_state.edit=!0,p.change(),setTimeout(function(){return p.edit_state.edit=!1})},this.quill.on("text-change",this.handler)}),function(){return n.apply(this,arguments)}),watch:{"state.value":function(e){this.edit_state.edit||(this.edit_state.show_html?this.quill.container.firstChild.innerText=e:this.quill.container.firstChild.innerHTML=e)}},beforeDestroy:function(){this.quill.off("text-change",this.handler),this.handler=null,this.quill=null,this.edit_state.edit=!1,this.edit_state.show_html=!1}},t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var e=this,t=e.$createElement,t=e._self._c||t;return t("baseinput",{directives:[{name:"disabled",rawName:"v-disabled",value:!e.editable,expression:"!editable"}],attrs:{state:e.state}},[t("div",{ref:"quill_editor",staticClass:"form-control",style:{border:e.novalid?"1px solid reed":"1px solid #ccc"},attrs:{slot:"body"},on:{keydown:function(e){e.stopPropagation()}},slot:"body"})])},a.staticRenderFns=[]},{"gui/inputs/input":12,"vueify/lib/insert-css":2}],89:[function(e,t,a){function n(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),i=e("mixins"),r=e("utils/getUniqueDomId"),e=e("gui/inputs/input"),a.default={name:"input-unique",mixins:[e,i.selectMixin],data:function(){return{id:"unique_"+(0,r.getUniqueDomId)()}},mounted:(o=n(function*(){var t,a=this;yield this.$nextTick(),this.select2=$("#"+this.id).select2({dropdownParent:$("#g3w-view-content"),tags:this.state.input.options.editable,language:this.getLanguage()}),null!==this.state.value&&this.select2.val(this.state.value).trigger("change"),this.select2.on("select2:select",(t=n(function*(e){e=e.params.data.$value||e.params.data.id;a.state.value="null"===e?null:["integer","float","bigint"].includes(a.state.type)?Number(e):e,a.changeSelect(a.state.value),yield a.$nextTick()}),function(e){return t.apply(this,arguments)}))}),function(){return o.apply(this,arguments)})},t.exports.__esModule&&(t.exports=t.exports.default);var i,r,o,a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("baseinput",{directives:[{name:"disabled",rawName:"v-disabled",value:!t.editable,expression:"!editable"}],attrs:{state:t.state}},[a("select",{staticClass:"form-control",staticStyle:{width:"100%"},attrs:{slot:"body",id:t.id,tabIndex:t.tabIndex},slot:"body"},[a("option",{attrs:{value:"null"}}),t._v(" "),t._l(t.state.input.options.values,function(e){return a("option",{key:e,domProps:{value:t.getValue(e)}},[t._v(t._s(t.getValue(e)))])})],2)])},a.staticRenderFns=[]},{"gui/inputs/input":12,mixins:180,"utils/getUniqueDomId":232}],90:[function(e,t,a){var n,i,r;e("vueify/lib/insert-css").insert("li .item-text[data-v-41231f64]{font-weight:700}");function o(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),i=e("g3w-eventbus"),r=e("utils/getCatalogLayerById"),a.default={name:"Layeropacitypicker",props:{layer:{type:Object,required:!0}},data:function(){return{menu:{show:!1,top:0,left:0,overflowY:"none",style:null,default:null}}},methods:{setLayerOpacity:function(e){var t=e.id,t=void 0===t?this.layer.id:t,e=e.value;this.layer.opacity!=e&&(this.layer.opacity=e,e=(0,r.getCatalogLayerById)(t))&&(i.VM.$emit("layer-change-opacity",{layerId:t}),e.change())},showLayerOpacityMenu:(n=o(function*(e,t){this.$emit("show-menu-item",{menu:this.menu,bool:e,evt:t})}),function(e,t){return n.apply(this,arguments)})},created:function(){this.$emit("init-menu-item",{layerOpacity:this.menu})}},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("div",{on:{mouseleave:function(e){return e.target!==e.currentTarget?null:t.showLayerOpacityMenu(!1,e)},mouseover:function(e){return e.target!==e.currentTarget?null:t.showLayerOpacityMenu(!0,e)}}},[e("span",{staticClass:"menu-icon skin-color-dark",class:t.g3wtemplate.getFontClass("slider")}),t._v(" "),e("span",{directives:[{name:"t",rawName:"v-t",value:"catalog_items.contextmenu.layer_opacity",expression:"'catalog_items.contextmenu.layer_opacity'"}],staticClass:"item-text"}),t._v(" "),e("span",{staticClass:"menu-icon",class:t.g3wtemplate.getFontClass("arrow-right"),staticStyle:{position:"absolute",right:"0","margin-top":"3px"}}),t._v(" "),e("ul",{directives:[{name:"show",rawName:"v-show",value:t.layer&&t.menu.show,expression:"layer && menu.show"}],style:{top:t.menu.top+"px",left:t.menu.left-15+"px",maxHeight:t.menu.maxHeight+"px",overflowY:t.menu.overflowY,paddingLeft:0,position:"fixed",backgroundColor:"#FFF",color:"#000"}},[e("li",[e("range",{attrs:{value:t.layer.opacity,min:0,max:100,step:1,sync:!1,showValue:!0,unit:"%"},on:{"change-range":t.setLayerOpacity}})],1)])])},e.staticRenderFns=[],e._scopeId="data-v-41231f64"},{"g3w-eventbus":141,"utils/getCatalogLayerById":218,"vueify/lib/insert-css":2}],91:[function(e,t,a){var n,i;e("vueify/lib/insert-css").insert("#marker[data-v-70e886b4]{width:15px;height:15px;border:2px solid #ff0;border-radius:10px;background-color:#ff0;opacity:.8}.g3w-map-controls-left-bottom[data-v-70e886b4]{position:absolute;bottom:75px;left:10px;z-index:1}#g3w-map-info[data-v-70e886b4]{position:absolute;top:60px;left:5px;font-weight:700;z-index:100;background:hsla(0,0%,100%,.6);padding:5px;border-radius:3px}#g3w-maps[data-v-70e886b4]{position:relative;width:100%;height:100%}.g3w-map[data-v-70e886b4]{position:absolute;width:100%;height:100%}.g3w-map.show[data-v-70e886b4]{display:block}.g3w-map.hide[data-v-70e886b4]{display:none}");function r(e){return e&&e.__esModule?e:{default:e}}function o(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),i=r(e("components/MapAddLayer.vue")),e=r(e("components/MapFooter.vue")),a.default={name:"g3w-map",data:function(){var e=this.$options.service;return{target:this.$options.service.target,maps_container:this.$options.service.maps_container,hidemaps:e.state.hidemaps,map_info:e.state.map_info,service:e}},components:{addlayer:i.default,MapFooter:e.default},computed:{mapcontrolsalignement:function(){return this.service.state.mapcontrolsalignement},disableMapControls:function(){return this.service.state.mapControl.disabled}},methods:{showHideControls:function(){this.service.getMapControls().forEach(function(e){return"scaleline"!==e.type&&e.control.showHide()})}},mounted:(n=o(function*(){var i=this;this.crs=this.service.getCrs(),yield this.$nextTick(),this.service.setMapControlsContainer($(this.$refs["g3w-map-controls"])),this.service.onafter("addHideMap",o(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.ratio,a=e.layers,a=void 0===a?[]:a,n=e.mainview,n=void 0!==n&&n,e=e.switchable,e=void 0!==e&&e;yield i.$nextTick(),i.service._addHideMap({ratio:t,layers:a,mainview:n,switchable:e})}))}),function(){return n.apply(this,arguments)}),destroyed:function(){this.service.clear()}},t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{attrs:{id:e.maps_container}},[e._l(e.hidemaps,function(e){return a("div",{key:e.id,staticClass:"g3w-map hidemap",attrs:{id:e.id}})}),e._v(" "),a("div",{staticClass:"g3w-map",attrs:{id:e.target}},[a("div",{directives:[{name:"disabled",rawName:"v-disabled",value:e.disableMapControls,expression:"disableMapControls"}],ref:"g3w-map-controls",staticClass:"g3w-map-controls",class:e.mapcontrolsalignement,staticStyle:{display:"flex"}}),e._v(" "),e.map_info.info?a("div",{ref:"g3w-map-info",style:e.map_info.style,attrs:{id:"g3w-map-info"}},[e._v("\n      "+e._s(e.map_info.info)+"\n    ")]):e._e(),e._v(" "),e._m(0),e._v(" "),a("addlayer",{attrs:{service:e.service}}),e._v(" "),a("div",{staticClass:"g3w-map-controls-left-bottom"})],1),e._v(" "),a("map-footer",{attrs:{service:e.service}})],2)},a.staticRenderFns=[function(){var e=this.$createElement,e=this._self._c||e;return e("div",{staticStyle:{display:"none"}},[e("div",{attrs:{id:"marker"}})])}],a._scopeId="data-v-70e886b4"},{"components/MapAddLayer.vue":92,"components/MapFooter.vue":95,"vueify/lib/insert-css":2}],92:[function(e,t,a){var n,i,r,l,o,s,u,c,d;e("vueify/lib/insert-css").insert("#addcustomlayer[data-v-2e549814]{margin:10px 0;position:relative;border:2px dashed #97a1a8}#addcustomlayer h4[data-v-2e549814],#addcustomlayer p[data-v-2e549814]{text-align:center;line-height:30px;color:#97a1a8;font-family:Arial}#addcustomlayer div[data-v-2e549814]{text-align:center;line-height:30px;color:#97a1a8}#addcustomlayer input[data-v-2e549814]{position:absolute;margin:0;padding:0;width:100%;height:100%;outline:none;opacity:0;cursor:pointer}");function p(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),n=e("vue-color"),i=e("g3w-constants"),f=e("store/projections"),r=(f=f)&&f.__esModule?f:{default:f},l=e("utils/createVectorLayerFromFile"),c=["zip","geojson","GEOJSON","kml","kmz","KMZ","KML","json","gpx","gml","csv"],d=[",",";"],n.Chrome.mounted=p(function*(){yield this.$nextTick(),$(".vue-color__chrome__toggle-btn").remove(),$(".vue-color__editable-input__label").remove(),$(".vue-color__chrome__saturation-wrap").css("padding-bottom","100px"),$(".vue-color__chrome").css({"box-shadow":"0 0 0 0",border:"1px solid #97A1A8"})}),a.default={name:"map-add-layer",props:["service"],data:function(){return i.EPSG.includes(this.service.getCrs())||i.EPSG.unshift(this.service.getCrs()),{vectorLayer:null,options:i.EPSG,error_message:"",position:"top",persistent:!1,loading:!1,fields:[],field:null,accepted_extension:c.map(function(e){return"."+e}).join(","),csv:{valid:!1,loading:!1,headers:[],x:null,y:null,separators:d,separator:d[0]},layer:{name:null,type:null,crs:null,mapCrs:null,color:{hex:"#194d33",rgba:{r:25,g:77,b:51,a:1},a:1},data:null,visible:!0,title:null,id:null,external:!0}}},components:{"chrome-picker":n.Chrome},computed:{csv_extension:function(){return"csv"===this.layer.type},add:function(){return this.layer.data||this.csv.valid}},methods:{onChangeColor:function(e){this.layer.color=e},onChangeFile:(u=p(function*(t){var o=this,a=new FileReader,e=t.target.files[0].name,n=e.split(".").at(-1).toLowerCase(),s=$(this.$refs.input_file);if(c.includes(n)){if(this.error_message="",this.layer.mapCrs=this.service.getEpsg(),this.layer.name=e,this.layer.title=e,this.layer.id=e,this.layer.type=n,this.layer.data=yield new Promise(function(r){var e;if(["zip","kmz"].includes(o.layer.type))return o.layer.crs="EPSG:4326",e=t.target.files[0],s.val(null),r(e);a.onload=function(e){var n,i,t;if("csv"===o.layer.type)return s.val(null),a=e.target.result.split(/\r\n|\n/).filter(function(e){return e}),a=a,a=Array.isArray(a)?a:Array.from(a),n=a[0],i=a.slice(1),t=function(e){o.csv.loading=!0;var t=n.split(e),a=t.length;return o.csv.headers=1<a?t:[],o.csv.fields=1<a?t:[],o.csv.x=1<a?t[0]:o.csv.x,o.csv.y=1<a?t[1]:o.csv.y,o.vectorLayer=1<a?o.vectorLayer:null,o.csv.valid=1<a,a<=1&&o.fields.splice(0),o.csv.loading=!1,1<a?{headers:t,separator:e,x:o.csv.x,y:o.csv.y,values:i}:null},o.$watch("csv.separator",function(e){return o.layer.data=t(e)}),r(t(o.csv.separator));var a=e.target.result;s.val(null),r(a)},a.readAsText(t.target.files[0])}),"csv"!==this.layer.type){(this.fields||[]).splice(0);try{this.vectorLayer=yield(0,l.createVectorLayerFromFile)(this.layer),yield this.$nextTick()}catch(e){this.error_message="sdk.errors.add_external_layer"}this.vectorLayer&&(this.fields=this.vectorLayer.get("_fields"))}}else this.error_message="sdk.errors.unsupported_format"}),function(e){return u.apply(this,arguments)}),addLayer:(s=p(function*(){if(this.layer.data||this.csv.valid){try{yield r.default.registerProjection(this.layer.crs)}catch(e){return void(this.error_message="sdk.errors."+e)}this.loading=!0;try{this.vectorLayer=yield(0,l.createVectorLayerFromFile)(this.layer),yield this.service.addExternalLayer(this.vectorLayer,{crs:this.layer.crs,type:this.layer.type,position:this.position,color:this.layer.color,field:this.field,persistent:!!this.persistent}),$(this.$refs.modal_addlayer).modal("hide"),this.clear()}catch(e){this.error_message="sdk.errors.add_external_layer"}this.loading=!1}}),function(){return s.apply(this,arguments)}),clear:function(){this.error_message="",this.loading=!1,this.layer.name=null,this.layer.title=null,this.layer.id=null,this.layer.type=null,this.layer.crs=this.service.getCrs(),this.layer.color={hex:"#194d33",rgba:{r:25,g:77,b:51,a:1},a:1},this.layer.data=null,this.vectorLayer=null,this.fields=[],this.field=null,this.csv.valid=!1}},watch:{"csv.x":function(e){[void 0,null].includes(e)||(this.layer.data.x=e)},"csv.y":function(e){[void 0,null].includes(e)||(this.layer.data.y=e)}},created:function(){var e=this;this.layer.crs=this.service.getCrs(),this.service.on("addexternallayer",function(){return e.modal.modal("show")})},mounted:(o=p(function*(){var e=this;yield this.$nextTick(),this.modal=$("#modal-addlayer").modal("hide"),this.modal.on("hide.bs.modal",function(){return e.clear()})}),function(){return o.apply(this,arguments)}),beforeDestroy:function(){this.clear(),this.modal.modal("hide"),this.modal.remove()}},t.exports.__esModule&&(t.exports=t.exports.default);var f="function"==typeof t.exports?t.exports.options:t.exports;f.render=function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{ref:"modal_addlayer",staticClass:"modal fade",attrs:{id:"modal-addlayer",role:"dialog"}},[t("div",{staticClass:"modal-dialog"},[t("div",{staticClass:"modal-content"},[t("div",{staticClass:"modal-header"},[t("button",{staticClass:"close",attrs:{type:"button","data-dismiss":"modal"}},[a._v("×")]),a._v(" "),t("h4",{directives:[{name:"t",rawName:"v-t",value:"mapcontrols.add_layer_control.header",expression:"'mapcontrols.add_layer_control.header'"}],staticClass:"modal-title",staticStyle:{"font-weight":"bold"}})]),a._v(" "),t("div",{staticClass:"modal-body"},[t("div",{directives:[{name:"disabled",rawName:"v-disabled",value:["kmz","zip"].includes(a.layer.type),expression:"['kmz', 'zip'].includes(layer.type)"}],staticClass:"form-group"},[t("label",{directives:[{name:"t",rawName:"v-t",value:"mapcontrols.add_layer_control.select_projection",expression:"'mapcontrols.add_layer_control.select_projection'"}],attrs:{for:"projection-layer"}}),a._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:a.layer.crs,expression:"layer.crs"}],staticClass:"form-control",attrs:{id:"projection-layer"},on:{change:function(e){var t=Array.prototype.filter.call(e.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});a.$set(a.layer,"crs",e.target.multiple?t:t[0])}}},a._l(a.options,function(e){return t("option",{domProps:{value:e}},[a._v(a._s(e))])}),0)]),a._v(" "),t("div",{staticClass:"form-group"},[t("label",{directives:[{name:"t",rawName:"v-t",value:"layer_position.message",expression:"'layer_position.message'"}],attrs:{for:"position-layer"}}),a._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:a.position,expression:"position"}],staticClass:"form-control",staticStyle:{"text-transform":"lowercase"},attrs:{id:"position-layer"},on:{change:function(e){var t=Array.prototype.filter.call(e.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});a.position=e.target.multiple?t:t[0]}}},[t("option",{directives:[{name:"t",rawName:"v-t",value:"layer_position.top",expression:"'layer_position.top'"}],domProps:{value:"top"}}),a._v(" "),t("option",{directives:[{name:"t",rawName:"v-t",value:"layer_position.bottom",expression:"'layer_position.bottom'"}],domProps:{value:"bottom"}})])]),a._v(" "),t("div",{staticClass:"form-group"},[t("label",{directives:[{name:"t",rawName:"v-t",value:"mapcontrols.add_layer_control.persistent_data",expression:"'mapcontrols.add_layer_control.persistent_data'"}],attrs:{for:"persistent-layer"}}),a._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:a.persistent,expression:"persistent"}],staticClass:"form-control",attrs:{id:"persistent-layer"},on:{change:function(e){var t=Array.prototype.filter.call(e.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});a.persistent=e.target.multiple?t:t[0]}}},[t("option",{directives:[{name:"t",rawName:"v-t",value:"no",expression:"'no'"}],domProps:{value:!1}}),a._v(" "),t("option",{directives:[{name:"t",rawName:"v-t",value:"yes",expression:"'yes'"}],domProps:{value:!0}})]),a._v(" "),t("small",{directives:[{name:"t",rawName:"v-t",value:"mapcontrols.add_layer_control.persistent_help",expression:"'mapcontrols.add_layer_control.persistent_help'"}]})]),a._v(" "),t("p",{directives:[{name:"t",rawName:"v-t",value:"mapcontrols.add_layer_control.select_color",expression:"'mapcontrols.add_layer_control.select_color'"}],staticStyle:{"font-weight":"700"}}),a._v(" "),t("chrome-picker",{staticStyle:{width:"100%",margin:"auto"},on:{input:a.onChangeColor},model:{value:a.layer.color,callback:function(e){a.$set(a.layer,"color",e)},expression:"layer.color"}}),a._v(" "),t("bar-loader",{attrs:{loading:a.loading}}),a._v(" "),t("form",{attrs:{id:"addcustomlayer"}},[t("input",{ref:"input_file",attrs:{type:"file",title:" ",accept:a.accepted_extension},on:{change:function(e){return a.onChangeFile(e)}}}),a._v(" "),t("h4",{directives:[{name:"t",rawName:"v-t",value:"mapcontrols.add_layer_control.drag_layer",expression:"'mapcontrols.add_layer_control.drag_layer'"}]}),a._v(" "),a.layer.name?t("h4",{staticClass:"skin-color",staticStyle:{"font-weight":"bold"}},[a._v(a._s(a.layer.name))]):a._e(),a._v(" "),t("div",[t("i",{staticClass:"fa-5x",class:a.g3wtemplate.getFontClass("cloud-upload"),attrs:{"aria-hidden":"true"}})]),a._v(" "),t("p",{staticStyle:{"font-weight":"bold"}},[a._v("[.gml, .geojson, .kml, .kmz ,.gpx, .csv, .zip(shapefile)]")])]),a._v(" "),a.csv_extension?t("div",{staticStyle:{padding:"15px",border:"1px solid grey","border-radius":"3px"}},[t("bar-loader",{attrs:{loading:a.csv.loading}}),a._v(" "),t("div",{staticClass:"select_field"},[t("label",{directives:[{name:"t",rawName:"v-t",value:"mapcontrols.add_layer_control.select_csv_separator",expression:"'mapcontrols.add_layer_control.select_csv_separator'"}],attrs:{for:"g3w-select-field-layer"}}),a._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:a.csv.separator,expression:"csv.separator"}],staticClass:"form-control",attrs:{id:"g3w-select-separator"},on:{change:function(e){var t=Array.prototype.filter.call(e.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});a.$set(a.csv,"separator",e.target.multiple?t:t[0])}}},a._l(a.csv.separators,function(e){return t("option",{key:e,domProps:{value:e}},[a._v(a._s(e))])}),0),a._v(" "),t("div",{staticClass:"select_field",class:{"g3w-disabled":!a.csv.headers||0===a.csv.headers.length}},[t("label",{directives:[{name:"t",rawName:"v-t",value:"mapcontrols.add_layer_control.select_csv_x_field",expression:"'mapcontrols.add_layer_control.select_csv_x_field'"}],attrs:{for:"g3w-select-x-field"}}),a._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:a.csv.x,expression:"csv.x"}],staticClass:"form-control",attrs:{id:"g3w-select-x-field"},on:{change:function(e){var t=Array.prototype.filter.call(e.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});a.$set(a.csv,"x",e.target.multiple?t:t[0])}}},a._l(a.csv.headers,function(e){return t("option",{key:e,domProps:{value:e}},[a._v(a._s(e))])}),0)]),a._v(" "),t("div",{staticClass:"select_field",class:{"g3w-disabled":!a.csv.headers||0===a.csv.headers.length}},[t("label",{directives:[{name:"t",rawName:"v-t",value:"mapcontrols.add_layer_control.select_csv_y_field",expression:"'mapcontrols.add_layer_control.select_csv_y_field'"}],attrs:{for:"g3w-select-y-field"}}),a._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:a.csv.y,expression:"csv.y"}],staticClass:"form-control",attrs:{id:"g3w-select-y-field"},on:{change:function(e){var t=Array.prototype.filter.call(e.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});a.$set(a.csv,"y",e.target.multiple?t:t[0])}}},a._l(a.csv.headers,function(e){return t("option",{key:e,domProps:{value:e}},[a._v(a._s(e))])}),0)])])],1):a._e(),a._v(" "),t("div",{staticClass:"select_field",class:{"g3w-disabled":!a.fields||0===a.fields.length}},[t("label",{directives:[{name:"t",rawName:"v-t",value:"mapcontrols.add_layer_control.select_field_to_show",expression:"'mapcontrols.add_layer_control.select_field_to_show'"}],attrs:{for:"g3w-select-field-layer"}}),a._v(" "),t("select",{directives:[{name:"model",rawName:"v-model",value:a.field,expression:"field"}],staticClass:"form-control",attrs:{id:"g3w-select-field-layer"},on:{change:function(e){var t=Array.prototype.filter.call(e.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});a.field=e.target.multiple?t:t[0]}}},[t("option",{domProps:{value:null}},[a._v("---")]),a._v(" "),a._l(a.fields,function(e){return t("option",{key:e,domProps:{value:e}},[a._v(a._s(e))])})],2)]),a._v(" "),a.error_message?t("div",{directives:[{name:"t",rawName:"v-t",value:a.error_message,expression:"error_message"}],staticStyle:{"font-weight":"bold","font-size":"1.2em","background-color":"orange",padding:"10px","text-align":"center"}}):a._e(),a._v(" "),t("div",{staticClass:"modal-footer"},[t("button",{directives:[{name:"t",rawName:"v-t",value:"add",expression:"'add'"}],staticClass:"btn btn-success pull-left",attrs:{type:"button",disabled:!a.add},on:{click:function(e){return e.stopPropagation(),a.addLayer(e)}}}),a._v(" "),t("button",{directives:[{name:"t",rawName:"v-t",value:"close",expression:"'close'"}],staticClass:"btn btn-default",attrs:{type:"button","data-dismiss":"modal"}})])],1)])])])},f.staticRenderFns=[],f._scopeId="data-v-2e549814"},{"g3w-constants":140,"store/projections":195,"utils/createVectorLayerFromFile":212,"vue-color":"vue-color","vueify/lib/insert-css":2}],93:[function(e,t,a){var u,c,d,p,s,r,f,g,h,o,n,l,y,m,i,v,_,b,w,x,k;e("vueify/lib/insert-css").insert('li[data-v-547bdae4]:not(.skin-background-color){display:flex;align-items:center;gap:10px}li.gcd-icon-poi .gcd-city[data-v-547bdae4],li.gcd-icon-poi .gcd-country[data-v-547bdae4],li.gcd-icon-poi .gcd-road[data-v-547bdae4],li.gcd-icon-road .gcd-icon[data-v-547bdae4],li.gcd-icon-road .gcd-name[data-v-547bdae4],li.gcd-icon-road .gcd-type[data-v-547bdae4]{display:none}#gcd-search[data-v-547bdae4]{z-index:1;width:2.5em;height:100%;border-radius:0;background-color:var(--skin-color,#fff)}#gcd-trash[data-v-547bdae4],#markers-visibility-layer[data-v-547bdae4],#show-markers-results[data-v-547bdae4]{z-index:1;border-radius:0!important;color:#fff;border-left:1px solid #fff}#gcd-trash[data-v-547bdae4]{color:red}#gcd-input-query[data-v-547bdae4]{font-weight:700}.gcd-txt-reset[data-v-547bdae4]:after{content:"\\d7";display:inline-block;font-weight:700;font-size:2em;cursor:pointer;color:var(--skin-color)}.gcd-txt-reset[data-v-547bdae4]{z-index:1;width:2.5em;height:100%;line-height:100%;border:none;background-color:transparent;display:inline-block;vertical-align:middle;outline:0;cursor:pointer}.gcd-txt-input[data-v-547bdae4]:focus{outline:none}.gcd-txt-input[data-v-547bdae4]{z-index:1;border:0;width:100%;height:100%;padding:5px;text-indent:6px;background-color:transparent;font-family:inherit;font-size:1em}.gcd-txt-control[data-v-547bdae4]{position:relative;display:flex;justify-content:flex-end;height:40px;background-color:#fff;overflow:hidden;border-radius:2px;width:100%;border:2px solid var(--skin-color)}@keyframes spin{0%{transform:rotate(0deg)}to{transform:rotate(1turn)}}.gcd-road[data-v-547bdae4]{font-size:.875em;font-weight:500}.gcd-city[data-v-547bdae4]{font-size:1em;font-weight:700}.gcd-country[data-v-547bdae4]{font-size:.75em}.gcd-spin[data-v-547bdae4]:after{animation:spin .7s linear infinite}.gcd-hidden[data-v-547bdae4]{display:none!important}li.skin-background-color[data-v-547bdae4]{position:sticky;top:0}li.selected[data-v-547bdae4]{background-color:#f7fabf!important}li.gcd-noresult[data-v-547bdae4]:hover{background-color:transparent!important}li.gcd-noresult[data-v-547bdae4]{font-weight:700;color:#384247;margin:10px;border-bottom:0!important}\n.ol-geocoder{box-sizing:border-box;position:absolute;max-width:300px;height:4.375em;top:7px;left:45px;width:50%;height:6px;font-size:1.1em}@media (max-width:767px){.ol-geocoder{left:10px}}.ol-geocoder>ul>li:hover{background-color:#eee}.ol-geocoder>ul>li{width:100%;overflow:hidden;padding:0;min-height:30px;padding-left:3px;border-bottom:2px solid var(--skin-color);min-height:20px;padding:10px}.ol-geocoder>ul{border-radius:3px!important;width:100%;max-height:200px;padding:0;margin-top:3px;background-color:#fff;border-top:none;overflow-x:hidden;overflow-y:auto;transition:max-height .3s ease-in;margin-bottom:0}.ol-geocoder>ul>li>a{display:block;text-decoration:none;padding:3px 5px;color:#000}.ol-geocoder>ul>li:last-child{border-bottom:0!important}');function S(e){return e&&e.__esModule?e:{default:e}}function E(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},c=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},d=S(e("services/gui")),p=S(e("store/application")),s=S(e("components/QueryResultsActionChooseLayer.vue")),r=S(e("store/plugins")),f=S(e("store/projections")),g=e("utils/getUniqueDomId"),h=e("utils/flattenObject"),o=e("utils/addZValueToOLFeatureGeometry"),n=e("utils/isPointGeometryType"),l=e("utils/convertSingleMultiGeometry"),y=e("utils/getCatalogLayerById"),m=e("utils/getCatalogLayers"),b=e("g3w-i18n").t,w=window.initConfig.mapcontrols.geocoding?window.initConfig.mapcontrols.geocoding.providers:{},Object.keys(w).forEach(function(e){var t=document.createElement("script");t.src=window.initConfig.staticurl+"client/geocoding-providers/"+e+".js",t.async=!0,document.head.appendChild(t)}),x=new ol.layer.Vector({id:"__g3w_marker",name:"Geocoding",source:new ol.source.Vector,style:function(e){return"__g3w_marker_coordinates"===e.getId()?new ol.style.Style({text:new ol.style.Text({offsetY:-15,text:"",font:'900 3em "Font Awesome 5 Free"',stroke:new ol.style.Stroke({color:"red",width:3}),fill:new ol.style.Fill({color:"rgba(255, 0,0, 0.7)"})})}):[new ol.style.Style({image:new ol.style.Icon({opacity:1,src:"/static/client/images/pushpin.svg",scale:.8})}),new ol.style.Style({image:new ol.style.RegularShape({stroke:new ol.style.Stroke({color:[0,0,0,0]}),points:4,radius:50,angle:Math.PI/4})})]}}),k=!1,a.default={data:function(){return{results:[],disabled:!1,results_panel_open:!1}},props:{providers:{type:Object,default:{}}},computed:{is_layer_visible:function(){return x.getVisible()},features:function(){return x.getSource().getFeatures()},has_providers:function(){return 0<Object.keys(this.providers).length},extent:function(){var e=d.default.getService("map"),t=e.getProject().state;return ol.proj.transformExtent(0<Object.keys(this.providers).filter(function(e){return"nominatim"!=e}).length?e.getMapExtent():t.initextent||t.extent,t.crs.epsg,"EPSG:4326")},placeholder:function(){return p.default.language&&b("mapcontrols.geocoding.placeholder")}},methods:{_hideMarker:function(){x.getSource().clear(),!1===this.is_layer_visible&&this.toggleLayerVisibility()},toggleLayerVisibility:function(){x.setVisible(!this.is_layer_visible)},clearResults:function(){this.results.splice(0),x.getSource().getFeatureById("__g3w_marker_coordinates")&&x.getSource().removeFeature(x.getSource().getFeatureById("__g3w_marker_coordinates"))},clearMarkers:function(){k=!0,this._hideMarker(),this.results.forEach(function(e){return e.__selected=!1});var t=d.default.getService("queryresults").getState().layers.find(function(e){return e.id===x.get("id")});t&&t.features.forEach(function(e){return d.default.getService("queryresults").removeFeatureLayerFromResult(t,e)}),k=!1},clear:function(){this.clearResults(),this.clearMarkers()},query:(_=E(function*(a){function e(e){return"number"==typeof e&&!Number.isNaN(e)}var n=this,t=d.default.getService("map"),i=null,r=!1,o=(a||"").split(","),o=c(o,3),s=o[0],l=o[1],o=o[2],o=o&&(yield f.default.registerProjection("EPSG:"+o.trim()));e(+s)&&e(+l)&&(i=[+s,+l]);try{o&&(i=ol.proj.transform(i,o.getCode(),"EPSG:4326"),r=!0)}catch(e){}if(i)return(s=x.getSource()).getFeatureById("__g3w_marker_coordinates")&&s.removeFeature(s.getFeatureById("__g3w_marker_coordinates")),(l=new ol.Feature({geometry:new ol.geom.Point(r?ol.proj.transform(i,"EPSG:4326",t.getEpsg()):i),lon:i[0],lat:i[1]})).setId("__g3w_marker_coordinates"),x.getSource().addFeature(l),t.zoomToGeometry(new ol.geom.Point(r?ol.proj.transform(i,"EPSG:4326",t.getEpsg()):i)),i;i||(this.clearResults(),this.$refs.reset.classList.add("gcd-spin"),(yield Promise.allSettled(Object.entries(this.providers).map(function(e){var e=c(e,2),t=e[0],e=e[1],e=void 0===e?{}:e;return w[t].fetch({url:e.url,icon:e.icon,query:a,lang:p.default.language||"it-IT",limit:5,extent:n.extent})}))).filter(function(e){return"fulfilled"===e.status}).forEach(function(t){n.results.push({__heading:!0,provider:t.value.provider,label:n.providers[t.value.provider].label||t.value.label}),t.value.results&&t.value.results.length?t.value.results.forEach(function(e){n.results.push((0,h.flattenObject)(u({},e,{provider:t.value.provider,__uid:(0,g.getUniqueDomId)(),__icon:n.providers[t.value.provider].icon||t.value.icon,__selected:!1})))}):n.results.push({__no_results:!(t.value.results&&t.value.results.length)})}),this.$refs.reset.classList.remove("gcd-spin"))}),function(e){return _.apply(this,arguments)}),onQuery:function(e){"Enter"!==e.key&&13!==e.which&&13!==e.keyCode||(e.preventDefault(),this.query(e.target.value.trim()))},onValue:function(e){this.$refs.reset.classList.toggle("gcd-hidden",0===e.target.value.trim().length)},onReset:function(){this.$refs.input.focus(),this.$refs.input.value="",this.$refs.reset.classList.add("gcd-hidden"),this.clearResults()},_removeItem:function(t){var e,a=(this.results||[]).find(function(e){return t===e.__uid});this.features.length&&(e=x.getSource()).removeFeature(e.getFeatureById(t)),a&&(a.__selected=!1),0===this.features.length&&this._hideMarker(),k||this.showMarkerResults(void 0,0===this.features.length)},onItemClick:function(e,t){if(t.lat&&t.lon){e.preventDefault();try{var a,n,i,r=x.getSource();r.getFeatureById(t.__uid)?this._removeItem(t.__uid):(a=t.__uid,n=((e,t)=>{var a,n={};for(a in e)0<=t.indexOf(a)||Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a]);return n})(t,["__uid","__icon","__selected"]),(i=new ol.Feature(u({geometry:new ol.geom.Point(ol.proj.transform([parseFloat(t.lon),parseFloat(t.lat)],"EPSG:4326",d.default.getService("map").getEpsg()))},n))).setId(a),r.addFeature(i),d.default.getService("map").zoomToFeatures([i]),t.__selected=!0,this.showMarkerResults([i]))}catch(e){}}},showMarkerResults:(v=E(function*(e){this.results_panel_open&&(1<arguments.length&&void 0!==arguments[1]&&arguments[1])?d.default.closeContent():(d.default.getCurrentContent()&&(yield d.default.closeContent()),d.default.showQueryResults("Geocoding",{data:[{layer:x,features:e||x.getSource().getFeatures()}]}),this.results_panel_open=!0)}),function(e){return v.apply(this,arguments)}),_editItem:(i=E(function*(e,n){var t=r.default.getPlugin("editing");if(t){this.disabled=!0;try{var a=(0,y.getCatalogLayerById)(e).getGeometryType(),i=(0,o.addZValueToOLFeatureGeometry)({geometryType:a,feature:new ol.Feature(u({},Object.entries(n.attributes).reduce(function(e,t){return u({},e,(e={},a=t[0].replace(n.attributes.provider+"_","").toLowerCase(),t=t[1],a in e?Object.defineProperty(e,a,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[a]=t,e));var a},{}),n.attributes,{geometry:(0,l.convertSingleMultiGeometry)(n.geometry,a)}))});yield t.getApi().addLayerFeature({layerId:e,feature:i})}catch(e){}this.disabled=!1}}),function(e,t){return i.apply(this,arguments)})},created:function(){var r=this,o=d.default.getService("queryresults"),e=d.default.getService("map");e.getMap().addLayer(x),e.on("set-layer-zindex",function(e){var t=e.layer,e=e.zindex;t.get("id")!==x.get("id")&&x.setZIndex(e+1)}),o.registerVectorLayer(x),d.default.on("closecontent",function(){r.results_panel_open=!1}),d.default.onafter("setContent",function(){r.results_panel_open&&(r.results_panel_open=!1)}),o.onafter("removeFeatureLayerFromResult",function(e,t){x.get("id")===e.id&&r._removeItem(t.id)}),o.onafter("addActionsForLayers",function(e,t){var i,t=t.find(function(e){return x.get("id")===e.id});!t||(i=(0,m.getCatalogLayers)({EDITABLE:!0,GEOLAYER:!0}).filter(function(e){return(0,n.isPointGeometryType)(e.getGeometryType())}).map(function(e){return{id:e.getId(),name:e.getName(),inediting:e.isInEditing()}})).find(function(e){return e.inediting})||o.addCurrentActionToolsLayer({id:s.default.name,layer:t,action:{id:"choose_layer",class:d.default.getFontClass("pencil"),state:Vue.observable({toggled:Array(t.features.length).fill(null)}),toggleable:!0,hint:"Choose a layer",cbk:function(e,t,a,n){1===i.length?r._editItem(i[0].id,t):(a.state.toggled[n]=!a.state.toggled[n],o.setCurrentActionLayerFeatureTool({layer:e,index:n,action:a,component:a.state.toggled[n]?s.default:null}))}},config:{layers:i,icon:"pencil",label:"mapcontrols.geocoding.choose_layer",nolayers:"mapcontrols.geocoding.nolayers",cbk:r._editItem}})})},destroyed:function(){d.default.getService("queryresults").unregisterVectorLayer(x)}},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var a=this,e=a.$createElement,n=a._self._c||e;return a.has_providers?n("div",{class:["ol-geocoder",{"g3w-disabled":a.disabled}]},[n("div",{staticClass:"gcd-txt-control"},[n("input",{ref:"input",staticClass:"gcd-txt-input",attrs:{type:"text",id:"gcd-input-query",autocomplete:"off",placeholder:a.placeholder},on:{keyup:a.onQuery,input:a.onValue}}),a._v(" "),n("button",{ref:"reset",staticClass:"gcd-txt-reset gcd-hidden",attrs:{type:"button",id:"gcd-input-reset",title:"Reset search"},on:{click:function(e){return e.stopPropagation(),a.onReset(e)}}}),a._v(" "),n("button",{staticClass:"btn",attrs:{type:"button",id:"gcd-search",title:"Submit search"},on:{click:function(e){return e.stopPropagation(),a.query(a.$refs.input.value)}}},[n("i",{class:a.g3wtemplate.getFontClass("search"),staticStyle:{color:"#fff"},attrs:{"aria-hidden":"true"}})]),a._v(" "),0<a.features.length?n("button",{staticClass:"btn skin-background-color",attrs:{type:"button",id:"gcd-trash",title:"Clear markers selection"},on:{click:function(e){return e.stopPropagation(),a.clearMarkers(e)}}},[n("i",{class:a.g3wtemplate.getFontClass("trash"),attrs:{"aria-hidden":"true"}})]):a._e(),a._v(" "),0<a.features.length?n("button",{staticClass:"btn skin-background-color",attrs:{type:"button",id:"markers-visibility-layer",title:"Toggle markers visibility"},on:{click:function(e){return e.stopPropagation(),a.toggleLayerVisibility(e)}}},[n("i",{class:a.g3wtemplate.getFontClass(a.is_layer_visible?"eye-close":"eye"),attrs:{"aria-hidden":"true"}})]):a._e(),a._v(" "),0<a.features.length?n("button",{staticClass:"btn skin-background-color",attrs:{type:"button",id:"show-markers-results",title:"Toggle sidebar panel"},on:{click:function(e){return e.stopPropagation(),a.showMarkerResults(void 0,!0)}}},[n("code",{style:{opacity:a.results_panel_open?.5:void 0}},[a._v("\n      "+a._s(99<a.features.length?"99+":a.features.length)+"\n    ")])]):a._e()]),a._v(" "),n("ul",{ref:"result",staticClass:"gcd-txt-result"},a._l(a.results,function(t,e){return n("li",{key:t.__uid,class:[t.provider,t.__icon?"gcd-icon-"+t.__icon:"",t.__heading?"skin-background-color":"",t.__no_results?"gcd-noresult":"",t.__selected?"selected":""],on:{click:function(e){return e.stopPropagation(),a.onItemClick(e,t)}}},[t.__heading?n("div",{staticStyle:{display:"flex","justify-content":"space-between",padding:"5px"}},[n("span",{staticStyle:{color:"#FFF","font-weight":"bold"}},[a._v(a._s(t.label))])]):t.__no_results?n("span",{directives:[{name:"t",rawName:"v-t",value:"mapcontrols.geocoding.noresults",expression:"'mapcontrols.geocoding.noresults'"}]}):[n("span",{class:a.g3wtemplate.getFontClass(t.__selected?"check":"uncheck"),staticStyle:{color:"#000",padding:"5px"}}),a._v(" "),"road"===t.__icon?n("i",{staticClass:"fa fa-road",staticStyle:{color:"black"},attrs:{"aria-hidden":"true"}}):"poi"===t.__icon?n("img",{staticClass:"gcd-icon",attrs:{src:"/static/client/images/pushpin.svg",width:"24",height:"24"}}):a._e(),a._v(" "),n("a",{attrs:{href:"",draggable:"false"}},[t.type?n("div",{staticClass:"gcd-type"},[a._v(a._s(t.type))]):a._e(),a._v(" "),t.name?n("div",{staticClass:"gcd-name"},[a._v(a._s(t.name))]):a._e(),a._v(" "),t.address_name?n("div",{staticClass:"gcd-road"},[a._v(a._s(t.address_name))]):a._e(),a._v(" "),t.address_road||t.address_building||t.address_house_number?n("div",{staticClass:"gcd-road"},[a._v(a._s(t.address_building)+" "+a._s(t.address_road)+" "+a._s(t.address_house_number))]):a._e(),a._v(" "),t.address_city||t.address_town||t.address_village?n("div",{staticClass:"gcd-city"},[a._v(a._s(t.address_postcode)+" "+a._s(t.address_city)+" "+a._s(t.address_town)+" "+a._s(t.address_village))]):a._e(),a._v(" "),t.address_state||t.address_country?n("div",{staticClass:"gcd-country"},[a._v(a._s(t.address_state)+" "+a._s(t.address_country))]):a._e()])]],2)}),0)]):a._e()},e.staticRenderFns=[],e._scopeId="data-v-547bdae4"},{"components/QueryResultsActionChooseLayer.vue":105,"g3w-i18n":143,"services/gui":188,"store/application":193,"store/plugins":194,"store/projections":195,"utils/addZValueToOLFeatureGeometry":197,"utils/convertSingleMultiGeometry":203,"utils/flattenObject":216,"utils/getCatalogLayerById":218,"utils/getCatalogLayers":219,"utils/getUniqueDomId":232,"utils/isPointGeometryType":240,"vueify/lib/insert-css":2}],94:[function(e,t,a){e("vueify/lib/insert-css").insert(".ol-zoom-history[data-v-5ba4faea]{display:flex!important;gap:5px}");Object.defineProperty(a,"__esModule",{value:!0}),r=e("services/gui"),n=(r=r)&&r.__esModule?r:{default:r},i=e("utils/debounce"),a.default={name:"MapControlZoomHistory",data:function(){return{history:{index:0,items:[]}}},methods:{last:function(){this.history.index--,this.setMapExtent()},next:function(){this.history.index++,this.setMapExtent()},setMapExtent:function(){n.default.getService("map").getMap().getView().fit(this.history.items[this.history.index])}},computed:{hasEmptyHistory:function(){return 0===this.history.index&&1===this.history.items.length||this.history.items.length-1===this.history.index}},created:function(){var t=this,a=n.default.getService("map").getMap(),e=a.getView();this.history.items.push(e.calculateExtent(a.getSize())),this.changeKeyEvent=e.on("change",(0,i.debounce)(function(e){t.history.index!==t.history.items.length-1&&t.history.items.splice(t.history.index-t.history.items.length+1),t.history.items.push(e.target.calculateExtent(a.getSize())),t.history.index++},600))},beforeDestroy:function(){ol.Observable.unByKey(this.changeKeyEvent)}},t.exports.__esModule&&(t.exports=t.exports.default);var n,i,r="function"==typeof t.exports?t.exports.options:t.exports;r.render=function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("div",{staticClass:"ol-zoom-history ol-unselectable ol-control"},[e("div",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:top.create",value:"sdk.mapcontrols.zoomhistory.zoom_last",expression:"'sdk.mapcontrols.zoomhistory.zoom_last'",arg:"top",modifiers:{create:!0}}]},[e("button",{directives:[{name:"disabled",rawName:"v-disabled",value:0===t.history.index,expression:"0 === history.index"}],attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.last(e)}}},[e("i",{class:t.g3wtemplate.getFontClass("reply")})])]),t._v(" "),e("div",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:top.create",value:"sdk.mapcontrols.zoomhistory.zoom_next",expression:"'sdk.mapcontrols.zoomhistory.zoom_next'",arg:"top",modifiers:{create:!0}}]},[e("button",{directives:[{name:"disabled",rawName:"v-disabled",value:t.hasEmptyHistory,expression:"hasEmptyHistory"}],attrs:{type:"button"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.next(e)}}},[e("i",{class:t.g3wtemplate.getFontClass("share")})])])])},r.staticRenderFns=[],r._scopeId="data-v-5ba4faea"},{"services/gui":188,"utils/debounce":213,"vueify/lib/insert-css":2}],95:[function(e,t,a){var n;e("vueify/lib/insert-css").insert("#map_footer[data-v-4a09c661]{position:absolute;bottom:0;height:30px;width:100%;display:flex;justify-content:space-between;background-color:hsla(0,0%,100%,.7)}");function i(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(a,"__esModule",{value:!0}),n=i(e("components/MapFooterRight.vue")),e=i(e("components/MapFooterLeft.vue")),a.default={name:"Mapfooter",props:{service:{type:Object}},components:{MapFooterRight:n.default,MapFooterLeft:e.default}},t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var e=this.$createElement,e=this._self._c||e;return e("div",{staticClass:"skin-border-color",attrs:{id:"map_footer"}},[e("map-footer-left"),this._v(" "),e("map-footer-right",{attrs:{service:this.service}})],1)},a.staticRenderFns=[],a._scopeId="data-v-4a09c661"},{"components/MapFooterLeft.vue":96,"components/MapFooterRight.vue":97,"vueify/lib/insert-css":2}],96:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default={name:"Mapfooter",computed:{version:function(){return"Powered by G3W-SUITE "+initConfig.version}}},t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var e=this.$createElement,e=this._self._c||e;return e("div",{staticStyle:{display:"flex"},attrs:{id:"map_footer_left"}},[e("a",{staticStyle:{"margin-left":"5px","align-self":"center"},attrs:{href:"https://g3wsuite.it/",target:"_blank",title:this.version}},[e("img",{attrs:{height:"15",src:"/static/client/images/g3wsuite_logo.png",alt:""}})])])},a.staticRenderFns=[]},{}],97:[function(e,t,a){var n,i,r;e("vueify/lib/insert-css").insert("#permalink[data-v-5a4def2a]{font-weight:700;font-size:1.2em;padding:5px;cursor:pointer;background-color:#eee}#switch-mouse-coordinate[data-v-5a4def2a]{display:flex;height:100%;margin-left:8px;align-items:center;cursor:pointer}#switch-mouse-coordinate span[data-v-5a4def2a]{padding:3px}#map_footer_right[data-v-5a4def2a]{flex-shrink:0}");function o(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),s=e("store/application"),i=(s=s)&&s.__esModule?s:{default:s},r=e("utils/copyUrl"),a.default={name:"map-footer-right",props:{service:{type:Object}},data:function(){return{mouse:{visible:!0,switch_icon:!1,epsg_4326:!1,tooltip:null},urlCopied:!1,mapunit:i.default.map.unit}},computed:{showmapunits:function(){return 1<this.service.state.mapunits.length}},methods:{createCopyMapExtentUrl:function(){var e=this,t=new URL(location.href);t.searchParams.set("map_extent",this.service.getMapExtent().toString()),(0,r.copyUrl)(t.toString()),this.urlCopied=!this.urlCopied,setTimeout(function(){return e.urlCopied=!1},5e3)},switchMapsCoordinateTo4326:function(){this.mouse.epsg_4326=!this.mouse.epsg_4326,this.service.getMapControlByType({type:"mouseposition"}).dispatchEvent({type:"change:epsg",epsg:this.mouse.epsg_4326?"EPSG:4326":this.service.getEpsg()})}},watch:{mapunit:function(e){i.default.map.unit=e,this.service.changeScaleLineUnit(e)}},mounted:(n=o(function*(){var e=this;this.service.once("ready",function(){e.service.getMapControlByType({type:"mouseposition"})?(e.mouse.switch_icon=e.service.getMapControlByType({type:"mouseposition"})&&"EPSG:4326"!==e.service.getEpsg(),e.mouse.tooltip="ESPG "+e.service.getCrs().split(":")[1]+" ↔ WGS84"):e.mouse.visible=!1})}),function(){return n.apply(this,arguments)})},t.exports.__esModule&&(t.exports=t.exports.default);var s="function"==typeof t.exports?t.exports.options:t.exports;s.render=function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticStyle:{display:"flex"},attrs:{id:"map_footer_right"}},[t("div",{attrs:{id:"scale-control"}}),a._v(" "),a.mouse.visible&&a.mouse.switch_icon&&!a.isMobile()?t("div",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:top.create",value:a.mouse.tooltip,expression:"mouse.tooltip",arg:"top",modifiers:{create:!0}}],attrs:{id:"switch-mouse-coordinate"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),a.switchMapsCoordinateTo4326(e)}}},[t("span",{staticClass:"skin-color-dark hide-cursor-caret-color",class:a.g3wtemplate.getFontClass("mouse")})]):a._e(),a._v(" "),t("div",{directives:[{name:"show",rawName:"v-show",value:a.mouse.visible,expression:"mouse.visible"}],attrs:{id:"mouse-position-control"}}),a._v(" "),a.showmapunits?t("div",{attrs:{id:"scale-line-units"}},[t("select",{directives:[{name:"model",rawName:"v-model",value:a.mapunit,expression:"mapunit"}],staticClass:"skin-color-dark",staticStyle:{padding:"5px 2px","font-weight":"bold",border:"0",cursor:"pointer"},on:{change:function(e){var t=Array.prototype.filter.call(e.target.options,function(e){return e.selected}).map(function(e){return"_value"in e?e._value:e.value});a.mapunit=e.target.multiple?t:t[0]}}},a._l(a.service.state.mapunits,function(e){return t("option",{directives:[{name:"t",rawName:"v-t",value:"sdk.mapcontrols.scaleline.units."+e,expression:"`sdk.mapcontrols.scaleline.units.${unit}`"}],staticStyle:{"font-weight":"bold"},domProps:{value:e,selected:a.mapunit===e}})}),0)]):a._e(),a._v(" "),t("div",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:top.create",value:"sdk.tooltips.copy_map_extent_url",expression:"'sdk.tooltips.copy_map_extent_url'",arg:"top",modifiers:{create:!0}}],staticClass:"skin-color-dark",class:((e={})[a.g3wtemplate.getFontClass("link")]=!a.urlCopied,e[a.g3wtemplate.getFontClass("success")]=a.urlCopied,e),attrs:{id:"permalink"},on:{click:function(e){return e.stopPropagation(),a.createCopyMapExtentUrl(e)}}})])},s.staticRenderFns=[],s._scopeId="data-v-5a4def2a"},{"store/application":193,"utils/copyUrl":205,"vueify/lib/insert-css":2}],98:[function(e,t,a){e("vueify/lib/insert-css").insert('.metadata-item-tab.general[data-v-0e556a34]{color:var(--skin-primary)}.metadata-item-tab.layers[data-v-0e556a34]{color:var(--skin-warning)}.metadata-item-tab.spatial[data-v-0e556a34]{color:var(--skin-success)}#project-catalog[data-v-0e556a34]{background:transparent}#project-catalog-container.mobile .metadata-nav-bar li a.metadata-item-tab[data-v-0e556a34]{display:flex;flex-direction:column;justify-content:space-around}.metadata-nav-bar[data-v-0e556a34]{display:flex;justify-content:space-between}.metadata-nav-bar li[data-v-0e556a34]{background-color:#e4e4e4;border-radius:3px;padding:0;width:100%;margin:1px}.metadata-nav-bar li.active[data-v-0e556a34]{background-color:#fff}.metadata-nav-bar li.active a.metadata-item-tab[data-v-0e556a34]{border-bottom-color:#222d32!important;border-bottom-width:4px;background-color:transparent!important;color:#2c3b41!important}.metadata-nav-bar li a.metadata-item-tab[data-v-0e556a34]{height:100%;margin:0;font-size:1.1em;border-top:0;border-right:0;border-left:0;border-bottom:4px solid #e2e2e2}.metadata-nav-bar li a[data-v-0e556a34]{text-align:center}.metadata-nav-bar li a i[data-v-0e556a34]{margin-right:5px}.metadata-item-tab[data-v-0e556a34]{margin-right:10px;border-radius:3px;margin-bottom:10px}.metadata-body[data-v-0e556a34]{background:#fff;margin-top:5px;border-radius:3px;box-shadow:0 1px 2px rgba(0,0,0,.1);overflow-y:auto;overflow-x:hidden;padding-left:0;padding-right:0}.tab-title[data-v-0e556a34]{position:absolute;bottom:10px;right:auto}.row-info[data-v-0e556a34]{margin:0!important;padding-top:10px;padding-bottom:10px;border-bottom:1px solid #eee}.row-info .label[data-v-0e556a34]{font-weight:700}.h_100[data-v-0e556a34]{height:100%}#project-catalog[data-v-0e556a34]{position:relative;overflow:auto}.nav-tabs[data-v-0e556a34]{border-bottom:0 none}.metadata-label[data-v-0e556a34]{font-weight:700;font-size:1.1em}.bbox-labels[data-v-0e556a34],.metadata-contact-label[data-v-0e556a34]{font-weight:700}.contact-icon[data-v-0e556a34]{margin-right:3px}.metadata-contact-row[data-v-0e556a34]{margin-bottom:5px}.layer_header[data-v-0e556a34]{padding:5px;margin-bottom:0;margin-top:0;cursor:pointer}.layer-name[data-v-0e556a34]{font-weight:700}.layer-header-icon[data-v-0e556a34]{margin-right:10px;color:#999}.layer_header span.open-close[data-v-0e556a34]{position:absolute;right:5px;color:#999}.layer-row[data-v-0e556a34]{padding:10px;border-bottom:1px solid #e2e2e2}.layer-nav-tabs[data-v-0e556a34]{border-bottom:0 solid #ddd}.layer-nav-tabs>li.active>a[data-v-0e556a34],.layer-nav-tabs>li.active>a[data-v-0e556a34]:focus,.layer-nav-tabs>li.active>a[data-v-0e556a34]:hover{border-width:0}.layer-nav-tabs>li>a[data-v-0e556a34]{border:none;color:#aeaeae}.layer-nav-tabs>li.active>a[data-v-0e556a34],.layer-nav-tabs>li>a[data-v-0e556a34]:hover{border:none;background:transparent}.layer-nav-tabs>li>a[data-v-0e556a34]:after{content:"";height:2px;position:absolute;width:100%;left:0;bottom:-1px;transition:all .25s ease 0s;transform:scale(0)}.layer-nav-tabs>li.active>a[data-v-0e556a34]:after,.layer-nav-tabs>li:hover>a[data-v-0e556a34]:after{transform:scale(1)}.layer-tab-content[data-v-0e556a34]{margin:10px;background-color:#eee;overflow:auto}.spatial-tab[data-v-0e556a34]{font-weight:700}.metadata-nav-tabs>li.active>a[data-v-0e556a34],.metadata-nav-tabs>li>a[data-v-0e556a34]:hover{color:var(--skin-color)!important}.metadata-nav-tabs>li>a[data-v-0e556a34]:after{background:var(--skin-color)}.metadata-nav-bar .action-button[data-v-0e556a34]:hover{background-color:transparent}');Object.defineProperty(a,"__esModule",{value:!0}),n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a.default={name:"project",methods:{showHideInfo:function(e){e=e.target.closest(".layer_header");e.querySelector(".open-close").classList.toggle("fa-plus"),e.querySelector(".open-close").classList.toggle("fa-minus")},sanitizeValue:function(e){return e=Array.isArray(e)||"object"===(void 0===e?"undefined":n(e))&&null!==e?Object.values(e).length?e:"":e}}},t.exports.__esModule&&(t.exports=t.exports.default);var n,e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var n=this,e=n.$createElement,i=n._self._c||e;return i("div",{attrs:{id:"project-catalog"}},[i("div",{class:n.isMobile()?"mobile":null,attrs:{id:"project-catalog-container"}},[i("ul",{staticClass:"nav nav-tabs metadata-nav-bar",attrs:{role:"tablist"}},n._l(["general","spatial","layers"],function(e){return i("li",{class:{active:"general"===e}},[i("a",{class:"metadata-item-tab "+e,attrs:{"data-toggle":"tab",href:"#metadata_"+e}},[i("i",{staticClass:"action-button",class:n.g3wtemplate.getFontClass({general:"info",spatial:"globe",layers:"bars"}[e]),attrs:{"aria-hidden":"true"}}),n._v(" "),i("b",{directives:[{name:"t",rawName:"v-t",value:"sdk.metadata.groups."+e+".title",expression:"'sdk.metadata.groups.'+ tab +'.title'"}]})])])}),0)]),n._v(" "),i("div",{staticClass:"col-sm-12 metadata-body tab-content"},[n._l(["general","spatial"],function(e){return i("div",{staticClass:"tab-pane fade",class:{in:"general"===e,active:"general"===e},attrs:{id:"metadata_"+e}},n._l(n.$options.state.groups[e],function(e,a){return i("div",{staticClass:"row row-info"},[i("div",{staticClass:"wrap-content-tab"},[i("div",{directives:[{name:"t",rawName:"v-t",value:e.label,expression:"data.label"}],staticClass:"col-sm-2 metadata-label"}),n._v(" "),"keywords"===a||"wms_url"===a?i("div",{staticClass:"col-sm-10 value"},[i("span",[n._v(n._s([].concat(e.value).join(", ")))])]):"abstract"===a||!Array.isArray(e.value)&&"object"!=typeof e.value?i("div",{staticClass:"col-sm-10 value"},[i("span",{domProps:{innerHTML:n._s(e.value)}})]):i("div",{staticClass:"col-sm-10 value"},"contactinformation"!==a?n._l(e.value,function(e,t){return i("div",["extent"===a?i("span",{staticClass:"bbox-labels"},[n._v(n._s(["MINX","MINY","MAXX","MAXY"][t]))]):n._e(),n._v(" "),i("span",[n._v(n._s(e))])])}):n._l(e.value,function(e,t){return i("div",[i("div",{staticClass:"row metadata-contact-row"},[i("div",{staticClass:"col-sm-2 metadata-contact-label"},[i("i",{staticClass:"contact-icon",class:n.g3wtemplate.getFontClass({contactelectronicmailaddress:"mail",personprimary:"user",contactvoicetelephone:"mobile"}[t]),attrs:{"aria-hidden":"true"}}),n._v(" "),i("span",{directives:[{name:"t",rawName:"v-t",value:"sdk.metadata.groups.general.fields.subfields.contactinformation."+t,expression:"`sdk.metadata.groups.general.fields.subfields.contactinformation.${info}`"}]})]),n._v(" "),"personprimary"===t?i("div",{staticClass:"col-sm-10"},n._l(e,function(e,t){return i("div",[i("span",{directives:[{name:"t",rawName:"v-t",value:"sdk.metadata.groups.general.fields.subfields.contactinformation."+t,expression:"`sdk.metadata.groups.general.fields.subfields.contactinformation.${key}`"}],staticClass:"metadata-contact-label"}),n._v(" "),i("span",[n._v(n._s(e))])])}),0):i("div",{staticClass:"col-sm-10"},"contactelectronicmailaddress"===t?[i("a",{attrs:{href:"mailto: "+n.sanitizeValue(e)}},[i("b",[n._v(n._s(n.sanitizeValue(e)))])])]:[n._v(n._s(n.sanitizeValue(e)))])])])}),0)])])}),0)}),n._v(" "),i("div",{staticClass:"tab-pane fade",attrs:{id:"metadata_layers"}},n._l(n.$options.state.groups.layers.layers.value,function(t){return i("div",{staticClass:"row-info"},[i("h4",{staticClass:"layer_header",attrs:{"data-toggle":"collapse","data-target":"#"+t.id},on:{click:n.showHideInfo}},[i("i",{class:"layer-header-icon action-button "+n.g3wtemplate.font["NoGeometry"===t.geometrytype?"table":"map"],attrs:{"aria-hidden":"true"}}),n._v(" "),i("span",{staticClass:"layer-name"},[n._v(n._s(t.name))]),n._v(" "),i("span",{staticClass:"action-button open-close",class:n.g3wtemplate.getFontClass("plus")})]),n._v(" "),i("div",{staticClass:"collapse",attrs:{id:t.id}},[i("ul",{staticClass:"metadata-nav-tabs nav nav-tabs layer-nav-tabs",attrs:{role:"tablist"}},[i("li",{staticClass:"active spatial-tab",attrs:{role:"presentation"}},[i("a",{directives:[{name:"t",rawName:"v-t",value:"sdk.metadata.groups.layers.groups.general",expression:"'sdk.metadata.groups.layers.groups.general'"}],attrs:{href:"#layer_general_"+t.id,"aria-controls":"general",role:"tab","data-toggle":"tab"}})]),n._v(" "),"NoGeometry"!==t.geometrytype?i("li",{staticClass:"spatial-tab",attrs:{role:"presentation"}},[i("a",{directives:[{name:"t",rawName:"v-t",value:"sdk.metadata.groups.layers.groups.spatial",expression:"'sdk.metadata.groups.layers.groups.spatial'"}],attrs:{href:"#layer_spatial_"+t.id,"aria-controls":"profile",role:"tab","data-toggle":"tab"}})]):n._e()]),n._v(" "),i("div",{staticClass:"tab-content layer-tab-content"},[i("div",{staticClass:"tab-pane active",attrs:{role:"tabpanel",id:"layer_general_"+t.id}},[i("div",{staticClass:"container-fluid"},[n._l(["metadata.title","name","source","metadata.abstract","metadata.keywords","metadata.metadataurl.onlineresource","metadata.dataurl.onlineresources","metadata.attributes"],function(e){return[void 0!==e.split(".").reduce(function(e,t){return e[t]},t)?i("div",{staticClass:"row layer-row"},[i("div",{directives:[{name:"t",rawName:"v-t",value:"sdk.metadata.groups.layers.fields.subfields."+e.replace("metadata.","").split(".")[0],expression:"'sdk.metadata.groups.layers.fields.subfields.' + attr.replace('metadata.', '').split('.')[0]"}],staticClass:"col-md-2 col-sm-12 metadata-label"}),n._v(" "),"metadata.title"===e?i("div",{staticClass:"col-md-10 col-sm-12 value"},[n._v(n._s(t.metadata.title))]):n._e(),n._v(" "),"name"===e?i("div",{staticClass:"col-md-10 col-sm-12 value"},[n._v(n._s(t.name))]):n._e(),n._v(" "),"source"===e?i("div",{staticClass:"col-md-10 col-sm-12 value"},[n._v(n._s(t.source.type))]):n._e(),n._v(" "),"metadata.abstract"===e?i("div",{staticClass:"col-md-10 col-sm-12 value",domProps:{innerHTML:n._s(t.metadata.abstract)}}):"metadata.keywords"===e?i("div",{staticClass:"col-md-10 col-sm-12 value"},[n._v(n._s(t.metadata.keywords.join(", ")))]):"metadata.metadataurl.onlineresource"===e?i("div",{staticClass:"col-md-10 col-sm-12 value"},[i("a",{attrs:{href:t.metadata.metadataurl.onlineresources}},[n._v(n._s(t.metadata.metadataurl.onlineresources))])]):"metadata.dataurl.onlineresources"===e?i("div",{staticClass:"col-md-10 col-sm-12 value"},[i("a",{attrs:{href:t.metadata.dataurl.onlineresources}},[n._v(n._s(t.metadata.dataurl.onlineresources))])]):"metadata.attributes"===e?i("div",{staticClass:"col-md-10 col-sm-12 value",staticStyle:{overflow:"auto"}},[i("table",{staticClass:"table table-striped",staticStyle:{"background-color":"#eee !important"}},[i("thead",[i("tr",n._l(t.metadata.attributes[0],function(e,t){return i("th",[n._v(n._s(t))])}),0)]),n._v(" "),i("tbody",n._l(t.metadata.attributes,function(e){return i("tr",n._l(e,function(e,t){return i("td",[n._v(n._s(e))])}),0)}),0)])]):n._e()]):n._e()]})],2)]),n._v(" "),i("div",{staticClass:"tab-pane",attrs:{role:"tabpanel",id:"layer_spatial_"+t.id}},[i("div",{staticClass:"container-fluid"},[n._l(["crs","geometrytype","bbox","metadata.crs"],function(e){return[void 0!==e.split(".").reduce(function(e,t){return e[t]},t)?i("div",{staticClass:"row layer-row"},["metadata.crs"===e?i("div",{staticClass:"col-md-2 col-sm-12 metadata-label"},[n._v("CRS")]):i("div",{directives:[{name:"t",rawName:"v-t",value:"sdk.metadata.groups.layers.fields.subfields."+e.replace("metadata.","").split(".")[0],expression:"'sdk.metadata.groups.layers.fields.subfields.' + attr.replace('metadata.', '').split('.')[0]"}],staticClass:"col-md-2 col-sm-12 metadata-label"}),n._v(" "),"crs"===e?i("div",{staticClass:"col-sm-10 value"},[n._v(n._s(t.crs.epsg))]):"geometrytype"===e?i("div",{staticClass:"col-sm-10 value"},[n._v(n._s(t.geometrytype))]):"bbox"===e?i("div",{staticClass:"col-sm-10 value"},n._l(t.bbox,function(e,t){return i("p",[i("span",{staticStyle:{"font-weight":"bold","margin-right":"5px"}},[n._v(n._s(t))]),n._v(" "),i("span",[n._v(n._s(e))])])}),0):"metadata.crs"===e?i("div",{staticClass:"col-sm-10 value"},n._l(t.metadata.crs,function(e){return i("div",[i("span",[n._v(n._s(e))])])}),0):n._e()]):n._e()]})],2)])])])])}),0)],2)])},e.staticRenderFns=[],e._scopeId="data-v-0e556a34"},{"vueify/lib/insert-css":2}],99:[function(e,t,a){var d,u,r,p,f,g,o,s,h,y,m,l,n,v,i,c,_,b,w,x,k;e("vueify/lib/insert-css").insert("#print .select2-container--open{width:100%}#print .select2-container--open input.select2-search__field{color:#555;width:100%}#print.treeview-menu .select2.select2-container{display:block}\n.print-labels-content[data-v-9e025612]{margin-top:5px;color:#fff}.print-labels-content>span.skin-color[data-v-9e025612]{font-weight:700;font-size:1.1em;display:block;border-bottom:2px solid #fff;margin-bottom:5px}.print-labels-content>.labels-input-content[data-v-9e025612]{max-height:120px;overflow-y:auto}label[data-v-9e025612]{color:#fff}.box-footer[data-v-9e025612]{background-color:transparent}#printbutton[data-v-9e025612]{width:100%;font-weight:700;background-color:var(--skin-color)}#fid-print-atals-instruction[data-v-9e025612]{margin-top:5px;color:#fff}#fids_intruction[data-v-9e025612]{white-space:pre-line}#fids_examples_values[data-v-9e025612]{margin-top:3px;font-weight:700}");function S(e){return e&&e.__esModule?e:{default:e}}function E(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function L(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},u=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=e("g3w-constants"),p=S(e("g3w-component")),f=S(e("store/application")),g=S(e("services/gui")),o=e("utils/getScaleFromResolution"),s=e("utils/getResolutionFromScale"),h=e("utils/downloadFile"),y=e("utils/printAtlas"),m=e("utils/promisify"),l=e("utils/getCatalogLayerById"),n=S(e("mixins/resize")),v=(e=>{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t})(e("components/PrintPage.vue")),k=e("g3w-i18n").t,a.default={name:"print",mixins:[n.default],data:function(){return this.init(),{state:this.state||{},disabled:!1,atlas_values:[]}},computed:{has_maps:function(){return 0<(this.state.maps||[]).length},has_autocomplete:function(){return!(!this.state.atlas||!this.state.atlas.field_name)},lang:function(){return f.default.language}},methods:{init:function(){this._init=void 0!==this._init&&this._init,this._moveKey=this._moveKey||null,this._page=this._page||null,this._resolutions=this._resolutions||{};var e=f.default.project.getPrint()||[],t=0<e.length,a=[{value:"png",label:"PNG"},{value:"jpg",label:"JPG"},{value:"svg",label:"SVG"},{value:"pdf",label:"PDF"},{value:"geopdf",label:"GEOPDF"}];this.state=Object.assign(this.state||{},{visible:t,print:e,loading:!1,downloading:!1,url:null,layers:!0,maps:t?e[0].maps:void 0,labels:t?e[0].labels:void 0,template:t?e[0].name:void 0,atlas:t?e[0].atlas:void 0,rotation:t?0:void 0,inner:[0,0,0,0],scales:[],scale:t?null:void 0,dpis:[150,300],dpi:150,formats:a,format:a[0].value}),this.print_extent=null},resize:function(){this.select2&&!f.default.ismobile&&this.select2.select2("close")},changeTemplate:(x=L(function*(){var e,t,a=this;this.state.template&&(yield this.$nextTick(),this.select2&&(this.select2.select2("destroy"),this.select2.off(),this.select2=null),this.disabled=!1,e=this.state.atlas||0===this.state.maps.length,t=this.state.print.find(function(e){return e.name===a.state.template}),Object.assign(this.state,{maps:t.maps,atlas:t.atlas,labels:t.labels}),this.atlas_values=[],this.state.atlas?(this._clearPrint(),this.initSelect2Field()):e?this.showPrintArea(!0):this._setPrintArea(),yield this.$nextTick())}),function(){return x.apply(this,arguments)}),changeScale:function(){try{var e;this.state.scale.includes(":")&&(e=Number(this.state.scale.split(":")[1].trim()),this.$refs.scales.children[this.$refs.scales.children.length-1].value=e,this.state.scale=e)}catch(e){this.state.scale=this.state.scales[0].value}(Number.isNaN(Number(this.state.scale))||this.state.scale>this.state.scales[0].value)&&(this.state.scale=this.state.scales[0].value),this.state.scale<0&&(this.state.scale=this.state.scales[this.state.scales.length-1].value),$(this.$refs.scales).val(this.state.scale).trigger("change"),this.state.scale&&this._setPrintArea()},changeDpi:function(){Number.isNaN(Number(this.state.dpi))&&(this.state.dpi=this.state.dpis[0],$(this.$refs.dpi).val(this.state.dpi).trigger("change"))},changeRotation:function(){this.state.rotation=0<=this.state.rotation?Math.min(this.state.rotation||0,360):Math.max(this.state.rotation||0,-360),g.default.getService("map").setInnerGreyCoverBBox({rotation:this.state.rotation})},isAxisOrientationInverted:function(){return"neu"===g.default.getService("map").getProjection().getAxisOrientation()},getOverviewExtent:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.xmin,a=e.xmax,n=e.ymin,e=e.ymax;return(this.isAxisOrientationInverted()?[n,t,e,a]:[t,n,a,e]).join()},getPrintExtent:function(){var e=g.default.getService("map").viewer.map;try{var t=e.getCoordinateFromPixel([this.state.inner[0],this.state.inner[1]]),a=u(t,2),n=a[0],i=a[1],r=e.getCoordinateFromPixel([this.state.inner[2],this.state.inner[3]]),o=u(r,2),s=o[0],l=o[1];this.print_extent=(this.isAxisOrientationInverted()?[i,n,l,s]:[n,i,s,l]).join()}catch(e){}return this.print_extent},print:(w=L(function*(){var a,e,t,n,i,r,o,s=this,l=!!this.state.atlas,u=void 0,c=void 0;this.state.loading=!0;try{g.default.disableSideBar(!0),this._page&&(yield(0,m.promisify)(g.default.closeContent())),l&&(f.default.download=!0,yield(0,h.downloadFile)({url:(yield(0,y.printAtlas)({template:this.state.template,field:this.state.atlas.field_name||"$id",values:this.atlas_values,download:!0})).url,filename:this.state.template,mime_type:"application/pdf"})),l||(this.state.url=null,this.state.layers=!0,this._page=new p.default({service:{state:this.state},vueComponentObject:v}),g.default.setContent({content:this._page,title:"print",perc:100}),a=this.state.maps.some(function(e){return void 0!==e.preset_theme}),t=(e=f.default.project.getLayersStore()).getLayers({PRINTABLE:{scale:this.state.scale},SERVERTYPE:"QGIS"}).reverse(),n=(t||[]).map(function(e){return e.getPrintLayerName()}).join(),i=e.getWmsUrl(),{pdf:"application/pdf",jpg:"image/jpeg",svg:"image/svg"}[this.state.format]||this.state.format,r=t.length&&new URLSearchParams(d({SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetPrint",TEMPLATE:this.state.template,DPI:this.state.dpi,STYLES:t.map(function(e){return e.getStyle()}).join(",")},a?{}:{LAYERS:n},{FORMAT:{png:"png",pdf:"application/pdf",geopdf:"application/pdf"}[this.state.format]||this.state.format},"geopdf"===this.state.format?{FORMAT_OPTIONS:"WRITE_GEO_PDF:TRUE"}:{},{CRS:e.getProjection().getCode(),filtertoken:f.default.tokens.filtertoken},this.state.maps.map(function(e){return{name:e.name,preset_theme:e.preset_theme,scale:(e.overview?e:s.state).scale,extent:e.overview?s.getOverviewExtent(e.extent):s.getPrintExtent()}}).reduce(function(e,t){return Object.assign(e,d((E(e={},t.name+":SCALE",t.scale),E(e,t.name+":EXTENT",t.extent),E(e,t.name+":ROTATION",s.state.rotation),e),a&&void 0===t.preset_theme?E({},t.name+":LAYERS",n):{}))},{}),(this.state.labels||[]).reduce(function(e,t){return Object.assign(e,E({},t.id,t.text))},{}))).toString(),c=yield"GET"===(o=t.length&&("geopdf"===this.state.format?"GET":f.default.project.state.ows_method))?Promise.resolve({ok:!0}):fetch(i,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:r}),this.state.url="GET"===o?i+"?"+r:URL.createObjectURL(yield c.blob()),this.state.layers=!!c.ok,this._page.getInternalComponent().$on("hook:mounted",function(){return s.state.loading=!1}),this._page.unmount=function(){g.default.getService("map").viewer.map.once("postrender",s._setPrintArea.bind(s));var e=p.default.prototype.unmount.call(s._page);return s._page=null,e})}catch(e){u=c&&!c.ok&&500===c.status?500===c.status?"Internal Server Error":"Request Failed":e,this.state.loading=!1,g.default.disableSideBar(!1)}this.state.loading=!1,f.default.download=!1,!l&&this.state.layers||g.default.disableSideBar(!1),u&&(g.default.notify.error(u||k("info.server_error")),g.default.closeContent())}),function(){return w.apply(this,arguments)}),showPrintArea:function(a){var n=this,e=!a;e&&this.select2&&this.select2.val(null).trigger("change"),e&&(this.atlas_values=[],this.print_extent=null),0!==this.state.print.length&&g.default.closeContent().then(function(t){setTimeout(function(){var e=t.getService();e.getMap().once("postrender",function(){if(!a)return n._clearPrint();n._moveKey=e.viewer.map.on("moveend",n._setPrintArea.bind(n)),n._initPrintConfig(),void 0===n.state.atlas&&n._setPrintArea()&&e.startDrawGreyCover()}),e.getMap().renderSync()})})},_setPrintArea:function(){var e,t,a,n;return this.has_maps?(n=(a=g.default.getService("map").viewer.map).getSize(),a=a.getView().getResolution(),t=(e=this.state.maps.find(function(e){return!e.overview})).h,e=e.w,a=a*("m"===g.default.getService("map").getMapUnits()?1:ol.proj.Units.METERS_PER_UNIT.degrees),e=e/1e3*parseFloat(this.state.scale)/a/2,t=t/1e3*parseFloat(this.state.scale)/a/2,a=n[0]/2,n=n[1]/2,this.state.inner=[a-e,n+t,a+e,n-t],g.default.getService("map").setInnerGreyCoverBBox({type:"pixel",inner:this.state.inner,rotation:this.state.rotation}),!0):(this._clearPrint(),!1)},_clearPrint:function(){ol.Observable.unByKey(this._moveKey),this._moveKey=null,g.default.getService("map").stopDrawGreyCover()},_setScales:function(e){var t=this,a=g.default.getService("map").getMapUnits(),n=(0,o.getScaleFromResolution)(e,a),e=r.PRINT_SCALES.sort(function(e,t){return t.value-e.value}),i=e.filter(function(e){return e.value<n}),e=e.findLast(function(e){return e.value>=n});this.state.scales=(e?[e]:[]).concat(i),this.state.scales.forEach(function(e){return t._resolutions[e.value]=(0,s.getResolutionFromScale)(e.value,a)})},_initPrintConfig:function(){var a=this,e=g.default.getService("map").viewer.map.getView(),n=(this._initialized||(this._setScales(e.getMaxResolution()),this._initialized=!0),e.getResolution());Object.entries(this._resolutions).find(function(e){var e=u(e,2),t=e[0];if(n<=e[1])return a.state.scale=t,!0})},reload:function(){var e,t=this,a=(this.state.print=f.default.project.state.print||[],0<this.state.print.length),n=this._initialized;this.state.template=a?this.state.print[0].name:this.state.template,a&&!n&&this.init(),a?(this._initPrintConfig(),(e=g.default.getService("map")).on("changeviewaftercurrentproject",function(){t.state.scales=r.PRINT_SCALES,t._setScales(e.viewer.map.getView().getMaxResolution())})):this._clearPrint()},initSelect2Field:function(){var n,i=this;this.select2=$("#print_atlas_autocomplete").select2({width:"100%",multiple:!0,dropdownParent:$(this.$refs.print_atlas),minimumInputLength:1,ajax:{delay:500,transport:(n=L(function*(e,t,a){try{t({results:(yield(0,l.getCatalogLayerById)(i.state.atlas.qgs_layer_id).getFilterData({suggest:i.state.atlas.field_name+"|"+e.data.q,unique:i.state.atlas.field_name})).map(function(e){return{id:e,text:e}})})}catch(e){a(e)}}),function(e,t,a){return n.apply(this,arguments)})},matcher:function(e,t){e=e.term&&e.term.toLowerCase();return""===(e||"").toString().trim()?t:t.text.toLowerCase().includes(e)&&void 0!==t.text?d({},t):null},language:{noResults:function(){return k("sdk.search.no_results")},errorLoading:function(){return k("sdk.search.error_loading")},searching:function(){return k("sdk.search.searching")},inputTooShort:function(e){return k("sdk.search.autocomplete.inputshort.pre")+" "+(e.minimum-e.input.length)+" "+k("sdk.search.autocomplete.inputshort.post")}}}),this.select2.on("select2:select",function(e){i.atlas_values.push(e.params.data.id)}),this.select2.on("select2:unselect",function(t){i.atlas_values=i.atlas_values.filter(function(e){return e!=t.params.data.id})})}},watch:{has_autocomplete:(b=L(function*(e){e&&(yield this.$nextTick(),this.initSelect2Field())}),function(e){return b.apply(this,arguments)}),atlas_values:{immediate:!0,handler:(_=L(function*(e){var r,o,t=this;!this._skip_atlas_check&&this.state.atlas&&(this.has_autocomplete?this.disabled=0===e.length:(r=function(e){return e&&Number.isInteger(+e)&&0<=+e&&+e<t.state.atlas.feature_count||null},o=new Set,(e=(e?e[0]:"")||"").split(",").filter(function(e){return e}).forEach(function(e){if(e.includes("-")||null===r(e)){var t=e.split("-"),n=t.filter(function(e){return null!==r(e)});if(n.length===t.length&&n.reduce(function(e,t,a){return e&&(0===a||n[a-1]<=t)},!0)){for(var a=1;a<n.length;a++)for(var i=n[a-1];i<n[a];i++)o.add(i+"");o.add(n[n.length-1])}}else o.add(e)}),this._skip_atlas_check=!0,this.atlas_values=Array.from(o),yield this.$nextTick(),this._skip_atlas_check=!1,this.disabled=""===e.trim()))}),function(e){return _.apply(this,arguments)})},"state.url":(c=L(function*(e){var t=this;if(e){var a=void 0;try{yield this.$nextTick();var a=setTimeout(function(){g.default.disableSideBar(!1),t.state.downloading=!1,g.default.showUserMessage({type:"alert",message:"timeout"})},r.TIMEOUT),n=yield fetch(e);if(!n.ok)throw n.statusText}catch(e){g.default.notify.error(e||k("info.server_error")),g.default.closeContent()}finally{clearTimeout(a),g.default.disableSideBar(!1),this.state.downloading=!1}}}),function(e){return c.apply(this,arguments)})},mounted:(i=L(function*(){yield this.$nextTick(),this.state.atlas&&this.initSelect2Field()}),function(){return i.apply(this,arguments)})},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var a=this,e=a.$createElement,n=a._self._c||e;return n("ul",{staticClass:"treeview-menu",attrs:{id:"print"}},[n("li",[a.state.print.length?n("form",{staticClass:"g3w-search-form form-horizonal"},[n("div",{staticClass:"box-body"},[n("transition",{attrs:{duration:500,name:"fade"}},[n("bar-loader",{attrs:{loading:a.state.loading}})],1),a._v(" "),n("helpdiv",{attrs:{message:"sdk.print.help"}}),a._v(" "),n("label",{directives:[{name:"t",rawName:"v-t",value:"sdk.print.template",expression:"'sdk.print.template'"}],attrs:{for:"templates"}}),a._v(" "),n("select",{directives:[{name:"select2",rawName:"v-select2",value:"state.template",expression:"'state.template'"}],staticClass:"form-control",style:{marginBottom:this.state.atlas&&"10px"},attrs:{id:"templates",select2_value:a.state.template},on:{change:a.changeTemplate}},a._l(a.state.print,function(e){return n("option",{domProps:{value:e.name}},[a._v(a._s(e.name))])}),0),a._v(" "),a.state.atlas?a._e():[n("label",{directives:[{name:"t",rawName:"v-t",value:"sdk.print.scale",expression:"'sdk.print.scale'"}],attrs:{for:"scale"}}),a._v(" "),n("select",{directives:[{name:"disabled",rawName:"v-disabled",value:!a.has_maps,expression:"!has_maps"},{name:"select2",rawName:"v-select2",value:"state.scale",expression:"'state.scale'"}],ref:"scales",staticClass:"form-control",attrs:{id:"scale",select2_value:a.state.scale,createTag:!0},on:{change:a.changeScale}},a._l(a.state.scales,function(e){return n("option",{domProps:{value:e.value}},[a._v(a._s(e.label))])}),0),a._v(" "),n("label",{attrs:{for:"dpi"}},[a._v("dpi")]),a._v(" "),n("select",{directives:[{name:"select2",rawName:"v-select2",value:"state.dpi",expression:"'state.dpi'"}],ref:"dpi",staticClass:"form-control",attrs:{id:"dpi",select2_value:a.state.dpi,createTag:!0},on:{change:a.changeDpi}},a._l(a.state.dpis,function(e){return n("option",[a._v(a._s(e))])}),0),a._v(" "),n("label",{directives:[{name:"t",rawName:"v-t",value:"sdk.print.rotation",expression:"'sdk.print.rotation'"}],attrs:{for:"rotation"}}),a._v(" "),n("input",{directives:[{name:"disabled",rawName:"v-disabled",value:!a.has_maps,expression:"!has_maps"},{name:"model",rawName:"v-model",value:a.state.rotation,expression:"state.rotation"}],staticClass:"form-control",attrs:{id:"rotation",min:"-360",max:"360",type:"number"},domProps:{value:a.state.rotation},on:{input:[function(e){e.target.composing||a.$set(a.state,"rotation",e.target.value)},a.changeRotation]}}),a._v(" "),n("label",{directives:[{name:"t",rawName:"v-t",value:"sdk.print.format",expression:"'sdk.print.format'"}],attrs:{for:"format"}}),a._v(" "),n("select",{directives:[{name:"select2",rawName:"v-select2",value:"state.format",expression:"'state.format'"}],staticClass:"form-control",attrs:{id:"format",select2_value:a.state.format}},a._l(a.state.formats,function(e){return n("option",{domProps:{value:e.value}},[a._v(a._s(e.label))])}),0)],a._v(" "),a.state.atlas?n("div",{ref:"print_atlas",staticClass:"form-group",staticStyle:{width:"100%"}},[a.has_autocomplete?[n("label",{attrs:{for:"print_atlas_autocomplete"}},[n("span",[a._v(a._s(a.state.atlas.field_name))])]),a._v(" "),n("select",{staticClass:"form-control",attrs:{id:"print_atlas_autocomplete",name:a.state.atlas.field_name}})]:[n("label",[n("span",[a._v("fids [max: "+a._s(a.state.atlas.feature_count-1)+"]")])]),a._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:a.atlas_values,expression:"atlas_values"}],staticClass:"form-control",domProps:{value:a.atlas_values},on:{keydown:function(e){if(!e.type.indexOf("key")&&a._k(e.keyCode,"space",32,e.key,[" ","Spacebar"]))return null;e.preventDefault()},input:function(e){e.target.composing||(a.atlas_values=e.target.value)}}}),a._v(" "),n("div",{attrs:{id:"fid-print-atals-instruction"}},[n("div",{directives:[{name:"t",rawName:"v-t",value:"sdk.print.fids_instruction",expression:"'sdk.print.fids_instruction'"}],attrs:{id:"fids_intruction"}}),a._v(" "),n("div",{directives:[{name:"t",rawName:"v-t",value:"sdk.print.fids_example",expression:"'sdk.print.fids_example'"}],attrs:{id:"fids_examples_values"}})])]],2):a._e(),a._v(" "),a.state.labels&&0<a.state.labels.length?n("div",{staticClass:"print-labels-content"},[n("span",{directives:[{name:"t",rawName:"v-t",value:"sdk.print.labels",expression:"'sdk.print.labels'"}],staticClass:"skin-color"}),a._v(" "),n("div",{staticClass:"labels-input-content"},a._l(a.state.labels,function(t){return n("span",{key:t.id},[n("label",{attrs:{for:"g3w_label_id_input_"+t.id}},[a._v(" "+a._s(t.id))]),a._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.text,expression:"label.text"}],staticClass:"form-control",attrs:{id:"g3w_label_id_input_"+t.id},domProps:{value:t.text},on:{input:function(e){e.target.composing||a.$set(t,"text",e.target.value)}}})])}),0)]):a._e()],2),a._v(" "),n("div",{staticClass:"box-footer"},[n("span",[n("button",{directives:[{name:"disabled",rawName:"v-disabled",value:a.disabled,expression:"disabled"},{name:"download",rawName:"v-download"},{name:"t",rawName:"v-t",value:"create_print",expression:"'create_print'"}],staticClass:"sidebar-button-run btn",attrs:{id:"printbutton"},on:{click:function(e){return e.stopPropagation(),e.preventDefault(),a.print(e)}}})])])]):a._e(),a._v(" "),n("div",{staticStyle:{padding:"1em","text-align":"center"}},[n("b",[n("a",{attrs:{href:"https://docs.qgis.org/3.34/"+a.lang+"/docs/training_manual/map_composer/map_composer.html",target:"_blank",title:"QGIS Docs"}},[n("i",{class:a.g3wtemplate.getFontClass("external-link")}),a._v(" Edit in QGIS\n      ")])])])])])},e.staticRenderFns=[],e._scopeId="data-v-9e025612"},{"components/PrintPage.vue":100,"g3w-component":139,"g3w-constants":140,"g3w-i18n":143,"mixins/resize":182,"services/gui":188,"store/application":193,"utils/downloadFile":215,"utils/getCatalogLayerById":218,"utils/getResolutionFromScale":230,"utils/getScaleFromResolution":231,"utils/printAtlas":246,"utils/promisify":247,"vueify/lib/insert-css":2}],100:[function(e,t,a){var n,i,r;e("vueify/lib/insert-css").insert("#print-output[data-v-184574a6]{height:100%;position:relative}#print-output>iframe[data-v-184574a6]{border:0;width:100%;height:100%}.g3w-print-image-output[data-v-184574a6]{display:flex;flex-direction:column;position:relative;height:100%}#g3w-print-header[data-v-184574a6]{display:flex;justify-content:flex-end;align-items:flex-end;margin-top:5px;margin-bottom:5px}#g3w-print-header button[data-v-184574a6]{font-weight:700}.g3w-print-url[data-v-184574a6]{height:100%;width:100%;position:relative;overflow-y:auto}.g3w-print-url>img[data-v-184574a6]{height:auto;max-width:100%}#print-output>h4[data-v-184574a6]{font-weight:700}");function o(e){return e&&e.__esModule?e:{default:e}}function s(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),i=o(e("store/application")),r=o(e("services/gui")),a.default={name:"print-page",data:function(){var e=this.$options.service.state||{};return{state:e,format:e.format,ready:!1}},methods:{downloadImage:(n=s(function*(){var e=this;try{r.default.disableSideBar(!0),this.state.downloading=!0,["jpg","png","svg"].includes(this.format)&&(yield this.imageToDataURL({src:this.state.url,type:"image/"+this.format}),setTimeout(function(){r.default.disableSideBar(!1),e.state.downloading=!1}))}catch(e){}}),function(){return n.apply(this,arguments)}),imageToDataURL:function(e){var n=e.src,t=e.type,i=void 0===t?"image/jpeg":t,t=e.callback,r=void 0===t?function(){}:t;return new Promise(function(a,e){var t=new Image;t.onload=function(){var e=document.createElement("canvas"),t=e.getContext("2d"),t=(e.height=this.naturalHeight,e.width=this.naturalWidth,t.drawImage(this,0,0),e.toDataURL(i));r(t),a(t)},t.onerror=e,t.src=n})}},watch:{ready:{handler:function(e){r.default.setLoadingContent(!e)},immediate:!0}},beforeDestroy:function(){this.state.url&&"POST"===i.default.project.state.ows_method&&window.URL.revokeObjectURL(this.state.url)}},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("div",{attrs:{id:"print-output"}},[e("transition",{attrs:{duration:500,name:"fade"}},[e("bar-loader",{attrs:{loading:t.state.loading&&t.state.layers}})],1),t._v(" "),t.state.layers?[["pdf","geopdf"].includes(t.format)?e("iframe",{ref:"out",attrs:{src:t.state.url},on:{load:function(e){t.ready=!0},error:function(e){t.ready=!0}}}):e("div",{staticClass:"g3w-print-image-output"},[e("div",{attrs:{id:"g3w-print-header"}},[e("div",{class:{"g3w-disabled":!(!t.state.downloading||!t.state.layers)}},[e("a",{attrs:{href:t.state.url,download:"download."+t.format}},[e("button",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip.create",value:"sdk.print.download_image",expression:"'sdk.print.download_image'",modifiers:{create:!0}}],staticClass:"btn skin-button skin-tooltip-left",class:t.g3wtemplate.getFontClass("download"),attrs:{"data-placement":"left","data-toggle":"tooltip","data-container":"body",role:"button"},on:{click:function(e){return e.stopPropagation(),t.downloadImage(e)}}})])])]),t._v(" "),t.state.url?e("div",{staticClass:"g3w-print-url"},[e("img",{ref:"out",attrs:{src:t.state.url},on:{load:function(e){t.ready=!0},error:function(e){t.ready=!0}}})]):t._e()])]:e("h4",{directives:[{name:"t",rawName:"v-t",value:"sdk.print.no_layers",expression:"'sdk.print.no_layers'"}]})],2)},e.staticRenderFns=[],e._scopeId="data-v-184574a6"},{"services/gui":188,"store/application":193,"vueify/lib/insert-css":2}],101:[function(e,t,a){e("vueify/lib/insert-css").insert(".project-menu[data-v-4c9dd89f]{cursor:pointer;margin-bottom:20px;margin-top:20px}.project-menu-item-image[data-v-4c9dd89f]{position:relative;overflow:hidden;padding-bottom:50%}.project-menu-item-image img[data-v-4c9dd89f]{position:absolute;top:0;bottom:0;left:0;right:0;margin:auto}.project-menu-item-content[data-v-4c9dd89f]{padding:15px;background:hsla(0,0%,100%,.3)}.project-menu-item-text[data-v-4c9dd89f]{position:relative;overflow:hidden;height:100%;text-align:justify}.project-menu-item-title[data-v-4c9dd89f]{text-align:center;font-weight:700;background:hsla(0,0%,100%,.5);padding:5px}#menu-projects[data-v-4c9dd89f]{width:100%;overflow-y:auto}#menu-projects .row-equal[data-v-4c9dd89f]{display:flex;flex-wrap:wrap}");Object.defineProperty(a,"__esModule",{value:!0}),o=e("services/gui"),n=(o=o)&&o.__esModule?o:{default:o},i=e("g3w-i18n").t,r="/static/client/images/FakeProjectThumb.png",a.default={name:"projects-menu",data:function(){return{state:null,loading:!1}},methods:{trigger:function(e){e.cbk?this._initCallback(e):e.href?window.open(e.href,"_blank"):e.route&&n.default.goto(e.route)},_initCallback:function(e){var t=this;this._toggleModal(!0),e.cbk.call(e,{gid:e.gid}).then(function(e){e.then(function(e){e&&(document.title=e.state.html_page_title)}).fail(function(){n.default.notify.error("<h4>"+i("error_map_loading")+"</h4><h5>"+i("check_internet_connection_or_server_admin")+"</h5>")}).always(function(){t._toggleModal(!1)})})},_toggleModal:function(e){n.default.showFullModal({show:e}),n.default.setLoadingContent(e)},logoSrc:function(e){var t=this.$options.host||"",a=e&&e.includes(window.initConfig.mediaurl),n=e&&!e.includes("static")&&!e.includes("media");return""+t+(e?a?e:n?""+window.initConfig.mediaurl+e:r:r)}}},t.exports.__esModule&&(t.exports=t.exports.default);var n,i,r,o="function"==typeof t.exports?t.exports.options:t.exports;o.render=function(){var a=this,e=a.$createElement,n=a._self._c||e;return n("div",{staticClass:"container",attrs:{id:"menu-projects"}},[n("div",{staticClass:"row row-equal"},[a._l(a.state.menuitems,function(t){return n("div",{key:t.title,staticClass:"col-xs-12 col-sm-4 project-menu",on:{click:function(e){return a.trigger(t)}}},[n("div",{staticClass:"project-menu-item-image"},[n("img",{staticClass:"img-responsive",attrs:{src:a.logoSrc(t.thumbnail)}})]),a._v(" "),n("div",{staticClass:"project-menu-item-content"},[n("div",{staticClass:"project-menu-item-text"},[n("h4",{staticClass:"project-menu-item-title"},[a._v(a._s(t.title))]),a._v(" "),n("div",{domProps:{innerHTML:a._s(t.description)}})])])])}),a._v(" "),a.state.menuitems.length?a._e():n("div",{staticStyle:{"margin-left":"15px"}},[n("h2",{directives:[{name:"t",rawName:"v-t",value:"no_other_projects",expression:"'no_other_projects'"}]})])],2)])},o.staticRenderFns=[],o._scopeId="data-v-4c9dd89f"},{"g3w-i18n":143,"services/gui":188,"vueify/lib/insert-css":2}],102:[function(e,t,a){var i,c,n,d,p,r,o,f,s,l,u,g,h;e("vueify/lib/insert-css").insert("#query_builder[data-v-81e8d74e]{font-family:monospace;margin-bottom:0;height:100%;display:flex;flex-wrap:nowrap;flex-direction:column}#query_builder .select2.select2-container[data-v-81e8d74e]{font-weight:700}.querybuilder-title[data-v-81e8d74e]{color:#fff;font-weight:700}select[data-v-81e8d74e]{background-color:#fff;color:#000;border:none}option[data-v-81e8d74e]{padding:8px;cursor:pointer}option[data-v-81e8d74e]:checked{background:var(--skin-color) linear-gradient(0deg,var(--skin-color),var(--skin-color));color:#fff}option[data-v-81e8d74e]:nth-of-type(odd){background-color:#f9f9f9}.query_builder_button[data-v-81e8d74e]{margin:1px;flex-basis:78px;flex-grow:1;color:#000}.content-wrap[data-v-81e8d74e]{display:flex;flex-wrap:wrap}.content-end[data-v-81e8d74e]{display:flex;flex-wrap:wrap;justify-content:flex-end;margin-top:5px}.margin-between-element[data-v-81e8d74e]{margin-bottom:5px}#query_builder_expression_content[data-v-81e8d74e]{width:100%;resize:none;height:100px;color:#000}");function y(e){return e&&e.__esModule?e:{default:e}}function m(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function v(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),i=e("g3w-constants"),c=y(e("store/application")),n=y(e("services/data")),d=y(e("services/gui")),p=e("utils/getUniqueDomId"),r=e("utils/createFilterFromString"),o=e("utils/XHR"),f=e("utils/getCatalogLayerById"),h=e("g3w-i18n").t,a.default={name:"query-builder",data:function(){return{edit:void 0!==this.$options.options,currentlayer:null,message:"",filter:void 0!==this.$options.options?this.$options.options.filter:"",loading:{test:!1,values:!1},values:[],manual:!0,manualvalue:null,select:{field:null,value:null}}},computed:{fields:function(){return this.currentlayer?this.currentlayer.fields:[]},disabled:function(){return!this.filter}},watch:{"select.field":function(){this.values=[],this.manual=!0}},methods:{addToExpression:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.value;switch(e.type){case"operator":t=" "+t+" ";break;case"field":t='"'+t+'"';break;case"value":t="'"+t+"'"}t&&(this.filter=""+this.filter+t)},all:(g=v(function*(){this.loading.values=!0;try{var e,t=this.currentlayer.id,a=this.select.field,n=c.default.querybuilder.cache;n[t]=n[t]||{},void 0!==n[t][a]?this.values=n[t][a]:((e=yield o.XHR.get({url:(0,f.getCatalogLayerById)(t).getUrl("data"),params:{ordering:a,formatter:1,fformatter:a}})).result&&(n[t][a]=n[t][a]||e.data),this.values=n[t][a]||[])}catch(e){}this.loading.values=!1,yield this.$nextTick(),this.manualvalue=null,this.manual=!1}),function(){return g.apply(this,arguments)}),reset:function(){this.filter="",this.message="",this.filterElement.previous=null,this.filterElement.current=null,this.filterElement.operator=null,this.select.field=null,this.$refs.search_fields&&(this.$refs.search_fields.selectedIndex=-1),this.$refs.search_values&&(this.$refs.search_values.selectedIndex=-1)},run:(u=v(function*(){try{this.loading.test=!0;var e=(0,f.getCatalogLayerById)(this.currentlayer.id),t=(yield n.default.getData("search:features",{inputs:{layer:e,filter:(0,r.createFilterFromString)({layer:e,filter:this.filter}),feature_count:100},outputs:!0})).data,a=t.length&&t[0].features.length;return this.message=void 0!==a?" "+a:"",t}catch(e){}finally{this.loading.test=!1}}),function(){return u.apply(this,arguments)}),save:(l=v(function*(){var e,t,a,n=this.projectId||c.default.project.getId(),i=this.edit&&this.$options.options.id,r=window.localStorage.getItem("QUERYBUILDERSEARCHES"),o=r?JSON.parse(r):void 0;try{var s,l={layerId:this.currentlayer.id,filter:this.filter,layerName:(0,f.getCatalogLayerById)(this.currentlayer.id).getName(),name:i?this.edit&&this.$options.options.name:yield new Promise(function(t,a){d.default.dialog.prompt(h("sdk.querybuilder.additem"),function(e){return e?t(e):a()})}),id:i||(0,p.getUniqueDomId)()};i?-1!==(s=o[n].findIndex(function(e){return e.id===l.id}))&&(o[n][s]=l):(d.default.getService("search").state.querybuildersearches.push(l),void 0===o?(a=[l],(t=n)in(e={})?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,o=e):o[n]=[].concat(m(o[n]||[]),[l]))}catch(e){return}var u=c.default.querybuilder.searches;try{window.localStorage.setItem("QUERYBUILDERSEARCHES",JSON.stringify(o))}catch(e){}setTimeout(function(){o[n].forEach(function(e){return u[n].push(e)})},0),u[n].splice(0),d.default.showUserMessage({type:"success",message:h("sdk.querybuilder.messages.changed"),autoclose:!0})}),function(){return l.apply(this,arguments)})},created:function(){var t=this,n=(this.filterElement={current:null,previous:null,operator:null},c.default.project);this.layers=n.getLayers().filter(function(e){return!e.baselayer&&Array.isArray(e.fields)}).map(function(t){var a=[];return n.state.relations.filter(function(e){return t.id===e.referencedLayer&&"ONE"===e.type}).forEach(function(t){var e=n.getLayerById(t.referencingLayer);t.customPrefix=void 0===t.customPrefix?e.getName()+"_":t.customPrefix,a=[].concat(m(a),m(e.getFields().map(function(e){return""+t.customPrefix+e.name})))}),{id:t.id,label:t.title,fields:t.fields.filter(function(e){return e.show}).map(function(e){return{label:e.label,name:e.name}}).filter(function(e){return!a.includes(e)})}}),this.operators=Object.values(i.FILTER_OPERATORS),this.currentlayer=this.edit?this.layers.find(function(e){return e.id===t.$options.options.layerId}):this.layers[0]},mounted:(s=v(function*(){var t=this;yield this.$nextTick(),this.select2=$("#query_builder_layers_select").select2({width:"100%"}),this.edit&&(this.select2.val(this.layers.indexOf(this.currentlayer)),this.select2.trigger("change")),this.select2.on("select2:select",function(e){t.currentlayer=t.layers[e.params.data.id],t.select.field=null,t.select.value=null,t.reset()})}),function(){return s.apply(this,arguments)}),beforeDestroy:function(){this.select2.select2("destroy"),this.select2=null}},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var a=this,e=a.$createElement,n=a._self._c||e;return n("div",{staticClass:"form-group",attrs:{id:"query_builder"}},[n("div",{staticClass:"margin-between-element",attrs:{id:"query_builder_layers"}},[n("label",{directives:[{name:"t",rawName:"v-t",value:"sdk.querybuilder.panel.expression",expression:"'sdk.querybuilder.panel.expression'"}],staticClass:"querybuilder-title"}),a._v(" "),n("a",{staticStyle:{float:"right"},attrs:{href:"https://g3w-suite.readthedocs.io/en/v3.7.x/g3wsuite_client.html#search-and-query-builder",target:"_blank",title:"Docs"}},[n("i",{class:a.g3wtemplate.getFontClass("external-link")})]),a._v(" "),n("select",{staticClass:"form-control",attrs:{id:"query_builder_layers_select"}},a._l(a.layers,function(e,t){return n("option",{key:e.label,staticClass:"bold",domProps:{value:t}},[a._v(a._s(e.label))])}),0)]),a._v(" "),n("textarea",{directives:[{name:"model",rawName:"v-model",value:a.filter,expression:"filter"}],attrs:{id:"query_builder_expression_content"},domProps:{value:a.filter},on:{input:function(e){e.target.composing||(a.filter=e.target.value)}}}),a._v(" "),n("bar-loader",{attrs:{loading:a.loading.test}}),a._v(" "),n("b",{directives:[{name:"show",rawName:"v-show",value:a.message,expression:"message"}],staticClass:"skin-color"},[n("span",{directives:[{name:"t",rawName:"v-t",value:"sdk.querybuilder.messages.number_of_features",expression:"'sdk.querybuilder.messages.number_of_features'"}]}),a._v(a._s(a.message))]),a._v(" "),n("div",{staticClass:"content-end"},[n("button",{directives:[{name:"t",rawName:"v-t",value:"sdk.querybuilder.panel.button.run",expression:"'sdk.querybuilder.panel.button.run'"}],staticClass:"query_builder_button btn btn-secondary bold",attrs:{disabled:a.disabled},on:{click:a.run}},[n("i",{class:a.g3wtemplate.getFontClass("run"),staticStyle:{color:"green"}})]),a._v(" "),n("button",{directives:[{name:"t",rawName:"v-t",value:"sdk.querybuilder.panel.button.clear",expression:"'sdk.querybuilder.panel.button.clear'"}],staticClass:"query_builder_button btn btn-secondary bold",on:{click:a.reset}},[n("i",{class:a.g3wtemplate.getFontClass("clear")})]),a._v(" "),n("button",{directives:[{name:"t",rawName:"v-t",value:"sdk.querybuilder.panel.button.save",expression:"'sdk.querybuilder.panel.button.save'"}],staticClass:"query_builder_button btn btn-secondary bold",attrs:{disabled:a.disabled},on:{click:a.save}},[n("i",{class:a.g3wtemplate.getFontClass("save")})])]),a._v(" "),n("hr"),a._v(" "),n("label",{directives:[{name:"t",rawName:"v-t",value:"sdk.querybuilder.panel.fields",expression:"'sdk.querybuilder.panel.fields'"}]}),a._v(" "),n("select",{ref:"search_fields",staticClass:"margin-between-element",attrs:{size:"4"}},[n("option",{attrs:{selected:"",hidden:""}}),a._v(" "),a._l(a.fields,function(t){return n("option",{key:t.name,on:{click:function(e){a.select.field=t.name,a.addToExpression({value:t.name,type:"field"})}}},[a._v(a._s(t.label))])})],2),a._v(" "),n("div",{staticClass:"content-wrap margin-between-element"},a._l(a.operators,function(t){return n("button",{key:t,staticClass:"query_builder_button btn btn-secondary bold",on:{click:function(e){return a.addToExpression({value:t,type:"operator"})}}},[a._v(a._s(t))])}),0),a._v(" "),n("bar-loader",{attrs:{loading:a.loading.values}}),a._v(" "),a.manual?a._e():n("select",{ref:"search_values",staticClass:"margin-between-element",attrs:{size:"4"}},[n("option",{attrs:{selected:"",hidden:""}}),a._v(" "),a._l(a.values,function(e){var t=e[0];return n("option",{key:t,on:{click:function(e){a.select.value=t,a.addToExpression({value:t,type:"value"})}}},[a._v(a._s(e[1]))])})],2),a._v(" "),null===a.select.field||a.values.length?a._e():n("button",{staticClass:"btn btn-secondary bold",class:{"skin-border-color":!a.manual},staticStyle:{color:"#000"},on:{click:a.all}},[n("i",{class:a.g3wtemplate.getFontClass("search")}),a._v(" "),n("span",{directives:[{name:"t",rawName:"v-t",value:"sdk.querybuilder.panel.button.all",expression:"'sdk.querybuilder.panel.button.all'"}]})])],1)},e.staticRenderFns=[],e._scopeId="data-v-81e8d74e"},{"g3w-constants":140,"g3w-i18n":143,"services/data":187,"services/gui":188,"store/application":193,"utils/XHR":196,"utils/createFilterFromString":207,"utils/getCatalogLayerById":218,"utils/getUniqueDomId":232,"vueify/lib/insert-css":2}],103:[function(e,t,a){var c,n,i,r,o,s,l,u,d,p,f,g,h,y;e("vueify/lib/insert-css").insert(".feature_attributes tr[data-v-09a18998]{line-height:1.8em}.featurebox-body+tr[data-v-09a18998]{border-top:2px groove #000}");function m(e){return e&&e.__esModule?e:{default:e}}function v(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},n=e("mixins"),i=m(e("components/QueryResultsTableAttributeFieldValue.vue")),r=m(e("components/QueryResultsActionInfoFormats.vue")),o=m(e("components/QueryResultsHeaderFeatureBody.vue")),s=m(e("components/QueryResultsHeaderFeatureActionsBody.vue")),l=e("utils/toRawType"),u=e("utils/throttle"),d=e("utils/getCatalogLayerById"),p=m(e("services/gui")),y=["varchar","integer","float","bigint","date"],a.default={name:"queryresults",data:function(){return{state:this.$options.service.state,headerExpandActionCellWidth:10,headerActionsCellWidth:10}},mixins:[n.fieldsMixin],components:{TableAttributeFieldValue:i.default,infoformats:r.default,"header-feature-body":o.default,HeaderFeatureActionsBody:s.default},computed:{onelayerresult:function(){return 1===this.state.layers.length},hasLayers:function(){return this.hasResults||!!this.state.components.length},hasResults:function(){return 0<this.state.layers.length},info:function(){if(this.state.query){var e=this.state.query,t="degrees"===p.default.getService("map").getMapUnits()?4:2;switch(e.type){case"coordinates":return{icon:"marker",message:"  "+e.coordinates[0].toFixed(t)+", "+e.coordinates[1].toFixed(t)};case"bbox":return{icon:"square",message:"  ["+e.bbox.map(function(e){return e.toFixed(t)}).join(" , ")+"]"};case"polygon":case"drawpolygon":return{icon:"draw",message:e.layerName?e.layerName+" "+(void 0!==e.fid?" - Feature Id: "+e.fid:""):" "};case"circle":return{icon:"empty-circle",message:" "}}}else this.state.search;return{icon:null,message:null}}},methods:{getLayerDownloads:function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).filter(function(e){return"pdf"!==e})},showLayer:function(e){return e.show&&(this.layerHasFeatures(e)||e.rawdata||Array.isArray(e.infoformats)&&0<e.infoformats.length)},getLayerCustomComponents:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"feature";return this.state.layerscustomcomponents[e]&&this.state.layerscustomcomponents[e][t]&&this.state.layerscustomcomponents[e][t][2<arguments.length&&void 0!==arguments[2]?arguments[2]:"after"]||[]},getLayerField:function(e){var t=e.layer,a=e.feature,n=e.fieldName,e=t.attributes.find(function(e){return n===e.name});return c({},e,{label:null,value:a.attributes[n]})},getQueryFields:function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var o,s=e.formStructure.fields[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value,u=c({},l);u.query=!0,u.value=t.attributes[l.name],u.input={type:""+this.getFieldType(u)},a.push(u)}}catch(e){i=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw r}}return a},getColSpan:function(e){return this.attributesSubsetLength(e)+ +!this.hasLayerOneFeature(e)},addLayerFeaturesToResults:function(e){this.$options.service.addLayerFeaturesToResultsAction(e)},printAtlas:function(e){this.$options.service.printAtlas(e)},showLayerDownloadFormats:function(e){this.$options.service.showLayerDownloadFormats(e)},saveLayerResult:function(e){this.$options.service.downloadFeatures(1<arguments.length&&void 0!==arguments[1]?arguments[1]:"csv",e,e.features)},hasLayerOneFeature:function(e){return 1===e.features.length},saveFilter:function(e){(0,d.getCatalogLayerById)(e.id).saveFilter()},addRemoveFilter:function(e){(0,d.getCatalogLayerById)(e.id).toggleFilterToken()},getContainerFromFeatureLayer:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layer;return $("#"+t.id+"_"+e.index+" > td")},hasOneLayerAndOneFeature:function(e){return this.hasLayerOneFeature(e)},hasFormStructure:function(e){return!!e.formStructure},layerHasFeatures:function(e){return Array.isArray(e.features)&&0<e.features.length},addToSelection:function(e){this.$options.service.addToSelection(e)},extractAttributesFromFirstTabOfFormStructureLayers:function(n){var i=this,r=new Set;return n.formStructure.structure.length&&n.formStructure.structure.forEach(function e(t){var a;t.nodes?t.nodes.forEach(e):(a=n.formStructure.fields.find(function(e){return t.field_name===e.name}))&&("ows"===i.state.type&&((a=c({},a)).name=a.name.replace(/ /g,"_")),r.add(a))}),Array.from(r)},attributesSubset:function(e){var e=this.hasFormStructure(e)?this.extractAttributesFromFirstTabOfFormStructureLayers(e):e.attributes,t=e.filter(function(e){return e.show&&y.includes(e.type)}),e=Math.min(3,e.length);return t.slice(0,e)},attributesSubsetLength:function(e){return this.attributesSubset(e).length},getLayerFormStructure:function(e){return e.formStructure.structure.map(function(e){return Vue.observable(structuredClone(e))})},getLayerFeatureBox:function(a,n,e){var i=this,t=this.getBoxId(a,n,e);return void 0===this.state.layersFeaturesBoxes[t]&&(this.state.layersFeaturesBoxes[t]=Vue.observable({collapsed:!0}),this.$watch(function(){return i.state.layersFeaturesBoxes[t].collapsed},function(e){var t=a.features.findIndex(function(e){return n.id===e.id}),t=i.getContainerFromFeatureLayer({layer:a,index:t});i.$options.service.openCloseFeatureResult({open:!e,layer:a,feature:n,container:t})}),this.state.layersFeaturesBoxes[t].collapsed=1<a.features.length),this.state.layersFeaturesBoxes[t]},collapsedFeatureBox:function(e,t,a){e=this.state.layersFeaturesBoxes[this.getBoxId(e,t,a)];return!e||e.collapsed},showFeatureInfo:function(e,t){t=this.state.layersFeaturesBoxes[t];this.$options.service.emit("show-query-feature-info",{layer:e,tabs:this.hasFormStructure(e),show:!!t&&!t.collapsed})},getBoxId:function(e,t,a){return this.$options.service.getBoxId(e,t,a)},toggleFeatureBox:(h=v(function*(e,t,a){t=this.getBoxId(e,t,a);this.state.layersFeaturesBoxes[t].collapsed=!this.state.layersFeaturesBoxes[t].collapsed,yield this.$nextTick(),this.showFeatureInfo(e,t)}),function(e,t,a){return h.apply(this,arguments)}),toggleFeatureBoxAndZoom:function(e,t,a){this.hasLayerOneFeature(e)||this.toggleFeatureBox(e,t,a)},trigger:(g=v(function*(e,t,a,n){e.opened&&"none"===$("#"+t.id+"_"+n).css("display")&&(this.toggleFeatureBox(t,a),yield this.$nextTick()),yield this.$options.service.trigger(e.id,t,a,n,this.getContainerFromFeatureLayer({layer:t,index:n}))}),function(e,t,a,n){return g.apply(this,arguments)}),openLink:function(e){window.open(e,"_blank")},isJSON:function(e){return!this.isVue(e)&&this.isSimple(e)&&"Object"===(0,l.toRawType)(e.value)},openAttributeTable:function(e){(0,d.getCatalogLayerById)(e.id).openAttributeTable({perc:100})},highLightLayerFeatures:function(e){e.hasgeometry&&this.$options.service.highLightLayerFeatures(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{highlight:!0})},collapseSidebar:function(e){var e=e.target.closest(".box"),t=e.classList.contains("collapsed-box");e.classList.toggle("collapsed-box"),e.querySelector(".btn-collapser").classList.toggle("fa-plus",!t),e.querySelector(".btn-collapser").classList.add("fa-minus",t)}},watch:{"state.layers":(f=v(function*(){var e,t,r=this,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];a.forEach(function(i){i.attributes.length<=3&&!i.hasImageField&&(i.expandable=!1),i.features.forEach(function(n){r.getLayerFeatureBox(i,n),n.attributes.relations&&n.attributes.relations.forEach(function(a){a.elements.forEach(function(e,t){return r.state.layersFeaturesBoxes[i.id+"_"+n.id+"_"+a.name+t]={collapsed:!0}})})})}),this.onelayerresult&&this.hasLayerOneFeature(a[0])&&(a=(e=a[0]).features[0],t=this.getBoxId(e,a),this.$options.service.onceafter("postRender",function(){r.showFeatureInfo(e,t)})),requestAnimationFrame(function(){return r.$options.service.postRender(r.$el)}),yield this.$nextTick()}),function(){return f.apply(this,arguments)}),onelayerresult:function(e){e&&p.default.getService("map").highlightFeatures(this.state.layers[0].features,{duration:1/0})}},created:function(){var t=this;this.zoomToLayerFeaturesExtent=(0,u.throttle)(function(e){t.$options.service.zoomToLayerFeaturesExtent(e)})},beforeDestroy:function(){this.state.zoomToResult=!0},destroyed:function(){this.$options.service.clear()}},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var r=this,e=r.$createElement,o=r._self._c||e;return o("div",{staticClass:"queryresults-wrapper",attrs:{id:"search-results"}},[r.info.message?o("div",{staticClass:"skin-color",staticStyle:{"font-weight":"bold","margin-bottom":"3px","font-size":"1.1em"}},[r.info.icon?o("span",{class:r.g3wtemplate.getFontClass(r.info.icon)}):r._e(),r._v(" "),o("span",[r._v(" "+r._s(r.info.message)+" ")])]):r._e(),r._v(" "),o("div",{staticClass:"queryresults-container"},[r.state.layers.length?[r.hasLayers?o("ul",{staticClass:"queryresults",staticStyle:{position:"relative"},attrs:{id:"queryresults"}},[r._l(r.state.layers,function(n){return o("li",{directives:[{name:"show",rawName:"v-show",value:r.showLayer(n),expression:"showLayer(layer)"}]},[o("bar-loader",{attrs:{loading:n.loading}}),r._v(" "),o("div",{staticClass:"box box-primary"},[o("div",{staticClass:"box-header with-border",class:{mobile:r.isMobile()},on:{mouseover:function(e){return r.highLightLayerFeatures(n,{highlight:!0,duration:1/0})},mouseout:function(e){return r.highLightLayerFeatures(n,{highlight:!1})},click:r.collapseSidebar}},[o("div",{staticClass:"box-title query-layer-title",style:{fontSize:r.isMobile()&&"1em !important"}},[n.external?r._e():o("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:left.create",value:"catalog_items.contextmenu.open_attribute_table",expression:"'catalog_items.contextmenu.open_attribute_table'",arg:"left",modifiers:{create:!0}}],staticClass:"action-button",on:{click:function(e){return e.stopPropagation(),r.openAttributeTable(n)}}},[o("span",{staticClass:"action-button-icon",class:r.g3wtemplate.getFontClass("list")})]),r._v("\n                "+r._s(n.title)+"\n                "),o("span",{directives:[{name:"show",rawName:"v-show",value:!n.rawdata,expression:"!layer.rawdata"}],staticClass:"query-layer-feature-count"},[r._v("("+r._s(n.features.length)+")")])]),r._v(" "),o("div",{staticClass:"box-features-action",on:{click:function(e){e.stopPropagation()}}},[o("infoformats",{attrs:{layer:n}}),r._v(" "),1<n.features.length?[n.hasgeometry?o("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:left.create",value:"sdk.mapcontrols.query.actions.zoom_to_features_extent.hint",expression:"'sdk.mapcontrols.query.actions.zoom_to_features_extent.hint'",arg:"left",modifiers:{create:!0}}],staticClass:"action-button",on:{click:function(e){return e.stopPropagation(),r.zoomToLayerFeaturesExtent(n)}}},[o("span",{staticClass:"action-button-icon",class:r.g3wtemplate.getFontClass("marker")})]):r._e(),r._v(" "),n.atlas.length?o("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:left.create",value:"sdk.mapcontrols.query.actions.atlas.hint",expression:"'sdk.mapcontrols.query.actions.atlas.hint'",arg:"left",modifiers:{create:!0}},{name:"download",rawName:"v-download"}],staticClass:"action-button",on:{click:function(e){return e.stopPropagation(),r.printAtlas(n)}}},[o("span",{staticClass:"action-button-icon",class:r.g3wtemplate.getFontClass("print")})]):r._e(),r._v(" "),1===r.getLayerDownloads(n.downloads).length?[o("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:left.create",value:"sdk.mapcontrols.query.actions.download_features_"+n.downloads[0]+".hint",expression:"`sdk.mapcontrols.query.actions.download_features_${layer.downloads[0]}.hint`",arg:"left",modifiers:{create:!0}},{name:"download",rawName:"v-download"}],staticClass:"action-button",class:{toggled:n.downloadformats.active}},[o("span",{staticClass:"action-button-icon",class:r.g3wtemplate.getFontClass("download"),on:{click:function(e){e.stopPropagation(),r.saveLayerResult(n,r.getLayerDownloads(n.downloads)[0])}}})])]:1<r.getLayerDownloads(n.downloads).length?[o("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:left.create",value:"Downloads",expression:"'Downloads'",arg:"left",modifiers:{create:!0}},{name:"download",rawName:"v-download"}],staticClass:"action-button",class:{toggled:n.downloadformats.active}},[o("span",{staticClass:"action-button-icon",class:r.g3wtemplate.getFontClass("download"),on:{click:function(e){return e.stopPropagation(),r.showLayerDownloadFormats(n)}}})])]:r._e()]:r._e(),r._v(" "),n.external||n.source&&"wms"!==n.source.type?o("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:left.create",value:"sdk.mapcontrols.query.actions.add_features_to_results.hint",expression:"'sdk.mapcontrols.query.actions.add_features_to_results.hint'",arg:"left",modifiers:{create:!0}}],staticClass:"action-button",class:{toggled:n.addfeaturesresults.active},on:{click:function(e){return e.stopPropagation(),r.addLayerFeaturesToResults(n)}}},[o("span",{staticClass:"action-button-icon",class:r.g3wtemplate.getFontClass("plus-square")})]):r._e(),r._v(" "),n.toc&&"__g3w_marker"!==n.id&&1<n.features.length&&(n.external||n.source&&"wms"!==n.source.type)?o("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:left.create",value:"sdk.mapcontrols.query.actions.add_selection.hint",expression:"'sdk.mapcontrols.query.actions.add_selection.hint'",arg:"left",modifiers:{create:!0}}],staticClass:"action-button skin-tooltip-left",class:{toggled:n.selection.active},on:{click:function(e){return e.stopPropagation(),r.addToSelection(n)}}},[o("span",{staticClass:"action-button-icon",class:r.g3wtemplate.getFontClass("success")})]):r._e(),r._v(" "),!n.external&&n.selection.active?[o("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:left.create",value:"layer_selection_filter.tools.filter",expression:"'layer_selection_filter.tools.filter'",arg:"left",modifiers:{create:!0}}],staticClass:"action-button skin-tooltip-left",class:{toggled:n.filter.active},on:{click:function(e){return e.stopPropagation(),r.addRemoveFilter(n)}}},[o("span",{staticClass:"action-button-icon",class:r.g3wtemplate.getFontClass("filter")})]),r._v(" "),r.state.logged&&n.filter.active&&(null===n.filter.current||n.selection.active)?o("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:left.create",value:"layer_selection_filter.tools.savefilter",expression:"'layer_selection_filter.tools.savefilter'",arg:"left",modifiers:{create:!0}}],staticClass:"action-button skin-tooltip-left",on:{click:function(e){return e.stopPropagation(),r.saveFilter(n)}}},[o("span",{staticClass:"action-button-icon",class:r.g3wtemplate.getFontClass("save")})]):r._e()]:r._e()],2),r._v(" "),o("button",{staticClass:"btn btn-box-tool",staticStyle:{"pointer-events":"none"}},[o("i",{staticClass:"btn-collapser skin-color",class:r.g3wtemplate.font.minus})])]),r._v(" "),r.state.layeractiontool[n.id].component?[o("div",{staticClass:"g3w-layer-action-tools with-border",class:{mobile:r.isMobile()},staticStyle:{padding:"5px"}},[o(r.state.layeractiontool[n.id].component,{tag:"component",attrs:{layer:n,config:r.state.layeractiontool[n.id].config}})],1)]:r._e(),r._v(" "),r._l(r.getLayerCustomComponents(n.id,"layer","before"),function(e){e=e.component;return o(e,{tag:"component",attrs:{layer:n}})}),r._v(" "),o("div",{staticClass:"box-body",class:{mobile:r.isMobile()}},[n.rawdata?[o("div",{staticClass:"queryresults-text-html",class:{text:"text/plain"===n.infoformat},domProps:{innerHTML:r._s(n.rawdata)}})]:r.hasFormStructure(n)?[o("table",{staticClass:"table",class:{mobile:r.isMobile()}},[o("tbody",[r._l(n.features,function(a,e){return a.show?[o("header-feature-actions-body",{attrs:{colspan:r.getColSpan(n),actions:r.state.layersactions[n.id],layer:n,feature:a,index:e,onelayerresult:r.onelayerresult,trigger:r.trigger,toggleFeatureBoxAndZoom:r.toggleFeatureBoxAndZoom,hasLayerOneFeature:r.hasLayerOneFeature,boxLayerFeature:r.getLayerFeatureBox(n,a),attributesSubset:r.attributesSubset,getLayerField:r.getLayerField}}),r._v(" "),o("tr",{staticClass:"g3w-feature-result-action-tools"},[r.state.currentactiontools[n.id][e]?[o("td",{attrs:{colspan:r.getColSpan(n)}},[o(r.state.currentactiontools[n.id][e],{tag:"component",attrs:{colspan:r.getColSpan(n),layer:n,feature:a,featureIndex:e,config:r.state.actiontools[r.state.currentactiontools[n.id][e].name][n.id]}})],1)]:r._e()],2),r._v(" "),r.hasLayerOneFeature(n)?r._e():o("tr",{staticStyle:{"font-weight":"bold","text-align":"center"}},[r._l(r.attributesSubset(n),function(e,t){return o("td",{staticClass:"centered"},[r._v("\n                            "+r._s(r.getLayerFeatureBox(n,a).collapsed?e.label:"")+"\n                          ")])}),r._v(" "),o("td",{staticClass:"collapsed",class:{noAttributes:0===r.attributesSubset(n).length},staticStyle:{"text-align":"end"},on:{click:function(e){return e.stopPropagation(),r.toggleFeatureBoxAndZoom(n,a)}}},[o("span",{staticClass:"fa link morelink skin-color",class:r.g3wtemplate.font[r.getLayerFeatureBox(n,a).collapsed?"plus":"minus"]})])],2),r._v(" "),!r.hasLayerOneFeature(n)&&r.getLayerFeatureBox(n,a).collapsed?o("header-feature-body",{attrs:{actions:r.state.layersactions[n.id],layer:n,feature:a,index:e,onelayerresult:r.onelayerresult,trigger:r.trigger,toggleFeatureBoxAndZoom:r.toggleFeatureBoxAndZoom,hasLayerOneFeature:r.hasLayerOneFeature,boxLayerFeature:r.getLayerFeatureBox(n,a),attributesSubset:r.attributesSubset,getLayerField:r.getLayerField}}):r._e(),r._v(" "),r._l(r.getLayerCustomComponents(n.id,"feature","before"),function(e){e=e.component;return o("tr",[o("td",{attrs:{colspan:r.getColSpan(n)}},[o(e,{tag:"component",attrs:{layer:n,feature:a}})],1)])}),r._v(" "),o("tr",{directives:[{name:"show",rawName:"v-show",value:!r.collapsedFeatureBox(n,a)||r.hasOneLayerAndOneFeature(n),expression:"!collapsedFeatureBox(layer,feature) || hasOneLayerAndOneFeature(layer)"}],staticClass:"featurebox-body",attrs:{id:n.id+"_"+e}},[o("td",{attrs:{colspan:r.getColSpan(n),"feature-html-content":n.id+"_"+e}},[o("tabs",{attrs:{fields:r.getQueryFields(n,a),layerid:n.id,feature:a,tabs:r.getLayerFormStructure(n)}})],1)]),r._v(" "),r._l(r.getLayerCustomComponents(n.id,"feature","after"),function(e){e=e.component;return o("tr",[o("td",{attrs:{colspan:r.getColSpan(n)}},[o(e,{tag:"component",attrs:{layer:n,feature:a}})],1)])})]:r._e()})],2)])]:[o("table",{staticClass:"table",class:{mobile:r.isMobile()}},r._l(n.features,function(a,e){return a.show?o("tbody",{key:a.id},[o("header-feature-actions-body",{attrs:{colspan:r.getColSpan(n),actions:r.state.layersactions[n.id],layer:n,feature:a,index:e,onelayerresult:r.onelayerresult,trigger:r.trigger,toggleFeatureBoxAndZoom:r.toggleFeatureBoxAndZoom,hasLayerOneFeature:r.hasLayerOneFeature,boxLayerFeature:r.getLayerFeatureBox(n,a),attributesSubset:r.attributesSubset,getLayerField:r.getLayerField}}),r._v(" "),o("tr",{staticClass:"g3w-feature-result-action-tools"},[r.state.currentactiontools[n.id][e]?[o("td",{attrs:{colspan:r.getColSpan(n)}},[o(r.state.currentactiontools[n.id][e],{tag:"component",attrs:{colspan:r.getColSpan(n),layer:n,feature:a,featureIndex:e,config:r.state.actiontools[r.state.currentactiontools[n.id][e].name][n.id]}})],1)]:r._e()],2),r._v(" "),r.hasLayerOneFeature(n)?r._e():o("tr",{staticStyle:{"font-weight":"bold","text-align":"center"}},[r._l(r.attributesSubset(n),function(e,t){return o("td",{staticClass:"centered"},[r._v("\n                        "+r._s(r.getLayerFeatureBox(n,a).collapsed?e.label:"")+"\n                      ")])}),r._v(" "),o("td",{staticClass:"collapsed",class:{noAttributes:0===r.attributesSubset(n).length},staticStyle:{"text-align":"end"},on:{click:function(e){return e.stopPropagation(),r.toggleFeatureBoxAndZoom(n,a)}}},[o("span",{staticClass:"fa link morelink skin-color",class:r.g3wtemplate.font[r.getLayerFeatureBox(n,a).collapsed?"plus":"minus"]})])],2),r._v(" "),!r.hasLayerOneFeature(n)&&r.getLayerFeatureBox(n,a).collapsed?o("header-feature-body",{attrs:{actions:r.state.layersactions[n.id],layer:n,feature:a,index:e,onelayerresult:r.onelayerresult,trigger:r.trigger,toggleFeatureBoxAndZoom:r.toggleFeatureBoxAndZoom,hasLayerOneFeature:r.hasLayerOneFeature,boxLayerFeature:r.getLayerFeatureBox(n,a),attributesSubset:r.attributesSubset,getLayerField:r.getLayerField}}):r._e(),r._v(" "),r._l(r.getLayerCustomComponents(n.id,"feature","before"),function(e){e=e.component;return o("tr",[o("td",{attrs:{colspan:r.getColSpan(n)}},[o(e,{tag:"component",staticClass:"box-body",attrs:{layer:n,feature:a}})],1)])}),r._v(" "),o("tr",{directives:[{name:"show",rawName:"v-show",value:!r.collapsedFeatureBox(n,a)||r.hasOneLayerAndOneFeature(n),expression:"!collapsedFeatureBox(layer,feature) || hasOneLayerAndOneFeature(layer)"}],staticClass:"featurebox-body",attrs:{id:n.id+"_"+e}},[o("td",{attrs:{colspan:r.getColSpan(n),"feature-html-content":n.id+"_"+e}},[o("table",{staticClass:"feature_attributes"},[r._l(n.attributes.filter(function(e){return e.show}),function(i){return[r.isJSON(r.getLayerField({layer:n,feature:a,fieldName:i.name}))?[r._l(r.getLayerField({layer:n,feature:a,fieldName:i.name}).value,function(a,n){var e;return r._l("object"==typeof a?a:((e={})[n]=a,e),function(e,t){return o("tr",{staticStyle:{"padding-top":"10px","padding-bottom":"10px"}},[o("td",{staticClass:"attr-label"},[r._v(r._s(i.label)+"."),"object"==typeof a?[r._v(r._s(n)+".")]:r._e(),r._v(r._s(t))],2),r._v(" "),o("td",{staticClass:"attr-value"},[r._v(r._s(e))])])})})]:o("tr",[o("td",{staticClass:"attr-label"},[r._v(r._s(i.label))]),r._v(" "),o("td",{staticClass:"attr-value",attrs:{attribute:i.name}},[o("table-attribute-field-value",{attrs:{feature:a,field:r.getLayerField({layer:n,feature:a,fieldName:i.name})}})],1)])]})],2)])]),r._v(" "),r._l(r.getLayerCustomComponents(n.id,"feature","after"),function(e){e=e.component;return o("tr",[o("td",{attrs:{colspan:"getColSpan(layer)"}},[o(e,{tag:"component",staticClass:"box-body",attrs:{layer:n,feature:a}})],1)])})],2):o("tbody")}),0)]],2),r._v(" "),r._l(r.getLayerCustomComponents(n.id,"layer","after"),function(e){e=e.component;return o("div",{staticClass:"box-body",class:{mobile:r.isMobile()}},[o(e,{tag:"component",attrs:{layer:n}})],1)})],2)],1)}),r._v(" "),r._l(r.state.components,function(e){return o("li",[o(e,{tag:"component",on:{showresults:function(e){return r.showResults()}}})],1)})],2):r._e()]:[r.state.changed?o("div",{staticClass:"query-results-not-found"},[o("h4",{directives:[{name:"t",rawName:"v-t",value:"info.no_results",expression:"'info.no_results'"}],staticClass:"skin-color",staticStyle:{"font-weight":"bold","text-align":"center"}})]):r._e()]],2)])},e.staticRenderFns=[],e._scopeId="data-v-09a18998"},{"components/QueryResultsActionInfoFormats.vue":107,"components/QueryResultsHeaderFeatureActionsBody.vue":110,"components/QueryResultsHeaderFeatureBody.vue":111,"components/QueryResultsTableAttributeFieldValue.vue":112,mixins:180,"services/gui":188,"utils/getCatalogLayerById":218,"utils/throttle":256,"utils/toRawType":257,"vueify/lib/insert-css":2}],104:[function(e,t,a){function n(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),s=e("g3w-i18n").t,a.default={name:"action",data:function(){return{show:!0}},props:{featureIndex:{type:Number},feature:{type:Object},layer:{type:Object},trigger:{type:Function},action:{type:Object,required:!0}},methods:{clickAction:(r=n(function*(e,t,a,n,i){var r,o;yield this.trigger(e,t,a,n),e.hint_change&&(r=$(i.target).parent(),o=r.attr("data-original-title"),r.attr("data-original-title",s(e.hint_change.hint)),r.tooltip("show"),setTimeout(function(){r.attr("data-original-title",o),r.tooltip("show")},e.hint_change.duration||600)),this.$emit("action-clicked",e)}),function(e,t,a,n,i){return r.apply(this,arguments)})},created:(i=n(function*(){var e;this.action.init&&this.action.init({layer:this.layer,feature:this.feature,index:this.featureIndex,action:this.action}),"function"==typeof this.action.condition&&(e=this.action.condition({layer:this.layer,feature:this.feature}),this.show=e instanceof Promise?yield e:e)}),function(){return i.apply(this,arguments)})},t.exports.__esModule&&(t.exports=t.exports.default);var i,r,s,e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var t=this,e=t.$createElement,e=t._self._c||e;return t.show?e("span",{directives:[{name:"download",rawName:"v-download",value:t.action.download,expression:"action.download"},{name:"t-tooltip",rawName:"v-t-tooltip:top.create",value:t.action.hint,expression:"action.hint",arg:"top",modifiers:{create:!0}}],staticClass:"action-button",class:{toggled:t.action.state&&t.action.state.toggled[t.featureIndex]},on:{contextmenu:function(e){e.preventDefault(),e.stopPropagation()},click:function(e){return e.stopPropagation(),t.clickAction(t.action,t.layer,t.feature,t.featureIndex,e)}}},[e("span",{class:"action-button-icon "+t.action.class,staticStyle:{padding:"2px"},style:t.action.style})]):t._e()},e.staticRenderFns=[]},{"g3w-i18n":143}],105:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default={name:"choose_layer",props:{featureIndex:{type:Number},feature:{type:Object},layer:{type:Object},config:{type:Object,default:{icon:"pencil",label:"Choose a Layer",nolayers:"No layers found",layers:[],cbk:function(){}}}},data:function(){return{layerId:null}},computed:{has_layers:function(){return this.config.layers&&0<this.config.layers.length}},created:function(){this.has_layers&&(this.layerId=this.config.layers[0].id)}},t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("section",{staticClass:"action-choose-layer"},[a("label",{directives:[{name:"t",rawName:"v-t",value:t.config.label,expression:"config.label"}]}),t._v(" "),a("div",{staticStyle:{width:"100%",display:"flex"},on:{click:function(e){e.preventDefault(),e.stopPropagation()}}},[a("select",{directives:[{name:"select2",rawName:"v-select2",value:"layerId",expression:"'layerId'"}],staticClass:"form-control",staticStyle:{"flex-grow":"1"},attrs:{search:!1,disabled:!t.has_layers}},[t._l(t.config.layers,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[a("b",[t._v(t._s(e.name))])])}),t._v(" "),t.has_layers?t._e():a("option",{directives:[{name:"t",rawName:"v-t",value:t.config.nolayers,expression:"config.nolayers"}]})],2),t._v(" "),t.has_layers?a("button",{staticClass:"btn skin-button",staticStyle:{"border-radius":"0 3px 3px 0"},on:{click:function(e){return e.stopPropagation(),t.config.cbk(t.layerId,t.feature)}}},[a("span",{class:t.g3wtemplate.getFontClass(t.config.icon)})]):t._e()])])},a.staticRenderFns=[]},{}],106:[function(e,t,a){function n(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),a.default={name:"downloadformats",data:function(){return{download_format:this.config.downloads[0].format}},props:{featureIndex:{type:Number},feature:{type:Object},layer:{type:Object},config:{type:Object,default:null}},methods:{download:(i=n(function*(){var t=this;try{var e=this.config.downloads.find(function(e){return e.format===t.download_format});yield e.cbk(this.layer,this.feature||this.layer.features,e,this.featureIndex,"pdf"===e.format?document.querySelector('[feature-html-content="'+this.layer.id+"_"+this.featureIndex+'"]').innerHTML:null)}catch(e){}}),function(){return i.apply(this,arguments)})}},t.exports.__esModule&&(t.exports=t.exports.default);var i,a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"g3w-download-formats-content",staticStyle:{width:"100%",display:"flex"},on:{click:function(e){e.preventDefault(),e.stopPropagation()}}},[a("select",{directives:[{name:"select2",rawName:"v-select2",value:"download_format",expression:"'download_format'"}],staticClass:"form-control",staticStyle:{"flex-grow":"1"},attrs:{search:!1}},t._l(t.config.downloads,function(e){return a("option",{directives:[{name:"download",rawName:"v-download"}],key:e.id,domProps:{value:e.format}},[a("span",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(e.format))])])}),0),t._v(" "),a("button",{directives:[{name:"download",rawName:"v-download"}],staticClass:"btn skin-button",staticStyle:{"border-radius":"0 3px 3px 0"},on:{click:function(e){return e.stopPropagation(),t.download(e)}}},[a("span",{class:t.g3wtemplate.getFontClass("download")})])])},a.staticRenderFns=[]},{}],107:[function(e,t,a){function n(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},d=e("services/gui"),s=(d=d)&&d.__esModule?d:{default:d},l=e("utils/parsers"),u=e("utils/getAlphanumericPropertiesFromFeature"),c=e("utils/getCatalogLayerById"),a.default={name:"Infoformats",props:{layer:{type:Object,required:!0}},data:function(){return{infoformat:this.layer.infoformat}},computed:{infoformats:function(){return this.layer.infoformats||[]},hasInfo:function(){return this.infoformats.length}},methods:{reloadLayerDataWithChangedContentType:(r=n(function*(e){this.layer.loading=!0,this.$el.disabled=!0;try{var t=yield this.projectLayer.changeProxyDataAndReloadFromServer("wms",{headers:{"Content-Type":e},params:{INFO_FORMAT:e}}),a=(this.layer.infoformat=e,this.projectLayer.setInfoFormat(this.layer.infoformat),l.ResponseParser.get(e)({layers:[this.projectLayer],response:t})),n=o(a,1)[0];n.features?this.__parsedata(n):this.__parserawdata(n)}catch(e){}this.layer.loading=!1,this.$el.disabled=!1}),function(e){return r.apply(this,arguments)}),__parsedata:function(e){var n=this,i=s.default.getService("queryresults");this.layer.rawdata=null,e.features.forEach(function(e){var e={properties:e instanceof ol.Feature?e.getProperties():e.properties,geometry:e instanceof ol.Feature?e.getGeometry():e.geometry,id:e instanceof ol.Feature?e.getId():e.id},t=e.id,a=e.geometry,e=e.properties;0===n.layer.attributes.length&&(n.layer.hasgeometry=!!a,i.setActionsForLayers([n.layer]),(0,u.getAlphanumericPropertiesFromFeature)(e).forEach(function(e){n.layer.attributes.push({name:e,label:e,show:!0})})),n.layer.features.push({id:t,attributes:e,geometry:a,show:!0})})},__parserawdata:(i=n(function*(e){this.layer.features.splice(0),yield this.$nextTick(),this.layer.rawdata=e.rawdata}),function(e){return i.apply(this,arguments)})},watch:{infoformat:function(e){this.reloadLayerDataWithChangedContentType(e)}},created:function(){this.projectLayer=(0,c.getCatalogLayerById)(this.layer.id)},beforeDestroy:function(){this.projectLayer&&this.projectLayer.clearProxyData("wms"),this.projectLayer=null}},t.exports.__esModule&&(t.exports=t.exports.default);var i,r,o,s,l,u,c,d="function"==typeof t.exports?t.exports.options:t.exports;d.render=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.hasInfo?a("select",{directives:[{name:"select2",rawName:"v-select2",value:"infoformat",expression:"'infoformat'"}],staticClass:"skin-color",attrs:{select2_value:t.infoformat,search:!1}},t._l(t.infoformats,function(e){return a("option",{key:e,domProps:{value:e}},[t._v("\n    "+t._s(e)+"\n  ")])}),0):t._e()},d.staticRenderFns=[]},{"services/gui":188,"utils/getAlphanumericPropertiesFromFeature":217,"utils/getCatalogLayerById":218,"utils/parsers":245}],108:[function(e,t,a){e("vueify/lib/insert-css").insert(".g3w-polygonattributes-types-title[data-v-7fd19c11]{font-weight:700;padding:3px;color:#fff;margin:0 0 5px}.g3w-polygonattributes-types-content[data-v-7fd19c11]{display:flex;justify-content:space-between;padding:3px;border-radius:3px;border:1px solid #f4f4f4}");Object.defineProperty(a,"__esModule",{value:!0}),r=e("store/application"),n=(r=r)&&r.__esModule?r:{default:r},i=e("g3w-i18n").t,a.default={name:"queryresults-querypolygonaddattributes",props:{layer:{type:Object},config:{type:Object,default:null}},data:function(){return{type:this.config.choices[0].type}},created:function(){var t=this;this.unwatch=this.$watch(function(){return n.default.language},function(){t.config.choices.forEach(function(e){return $(t.$refs[e.type]).text(i(e.label))}),$(t.$refs.g3w_select_feature_featurepolygon).select2().trigger("change")})},beforeDestroy:function(){this.unwatch&&this.unwatch(),this.unwatch=null}},t.exports.__esModule&&(t.exports=t.exports.default);var n,i,r="function"==typeof t.exports?t.exports.options:t.exports;r.render=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticStyle:{width:"100%"}},[a("h5",{directives:[{name:"t",rawName:"v-t",value:"sdk.mapcontrols.querybypolygon.download.title",expression:"'sdk.mapcontrols.querybypolygon.download.title'"}],staticClass:"skin-background-color g3w-polygonattributes-types-title"}),t._v(" "),a("div",{staticClass:"g3w-polygonattributes-types-content"},[a("select",{directives:[{name:"select2",rawName:"v-select2",value:"type",expression:"'type'"}],ref:"g3w_select_feature_featurepolygon",staticClass:"form-control",staticStyle:{width:"100%"},attrs:{search:!1}},t._l(t.config.choices,function(e){return a("option",{directives:[{name:"t",rawName:"v-t",value:e.label,expression:"choice.label"}],key:e.type,ref:e.type,refInFor:!0,domProps:{value:e.type}})}),0),t._v(" "),a("button",{staticClass:"btn skin-button",staticStyle:{"border-radius":"0 3px 3px 0"},on:{click:function(e){return e.stopPropagation(),t.config.download(t.type)}}},[a("span",{class:t.g3wtemplate.getFontClass("download")})])])])},r.staticRenderFns=[],r._scopeId="data-v-7fd19c11"},{"g3w-i18n":143,"store/application":193,"vueify/lib/insert-css":2}],109:[function(e,t,a){e("vueify/lib/insert-css").insert(".g3w-feature-actions[data-v-ec80a64e]{padding:3px;background-color:rgba(34,45,50,.1)!important}");Object.defineProperty(a,"__esModule",{value:!0}),e=(e=e=e("components/QueryResultsAction.vue"))&&e.__esModule?e:{default:e},a.default={name:"actions",props:{featureIndex:{type:Number},feature:{type:Object},layer:{type:Object},trigger:{type:Function},actions:{type:Array,default:[]},colspan:{type:Number}},components:{action:e.default}},t.exports.__esModule&&(t.exports=t.exports.default);a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var t=this,e=t.$createElement,a=t._self._c||e;return t.actions.length?a("td",{staticClass:"g3w-feature-actions",staticStyle:{padding:"3px"},attrs:{colspan:t.colspan}},t._l(t.actions,function(e){return a("action",t._b({key:e.id,attrs:{action:e}},"action",t.$props,!1))}),1):t._e()},a.staticRenderFns=[],a._scopeId="data-v-ec80a64e"},{"components/QueryResultsAction.vue":104,"vueify/lib/insert-css":2}],110:[function(e,t,a){e("vueify/lib/insert-css").insert(".noAttributes[data-v-164045ac]{display:flex;justify-content:flex-end}");Object.defineProperty(a,"__esModule",{value:!0}),n=(n=n=e("components/QueryResultsActions.vue"))&&n.__esModule?n:{default:n},e=e("mixins"),a.default={name:"headerfeaturebody",mixins:[e.fieldsMixin],props:{toggleFeatureBoxAndZoom:{type:Function},trigger:{type:Function},hasLayerOneFeature:{type:Function},boxLayerFeature:{type:Object},getLayerField:{type:Function},attributesSubset:{type:Function},layer:{type:Object},feature:{type:Object},index:{type:Number},actions:{type:Array},colspan:{type:Number}},components:{actions:n.default}},t.exports.__esModule&&(t.exports=t.exports.default);var n,a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("tr",{staticClass:"featurebox-header",on:{mouseover:function(e){return t.trigger({id:"highlightgeometry"},t.layer,t.feature,t.index)},mouseout:function(e){return t.trigger({id:"clearHighlightGeometry"},t.layer,t.feature,t.index)}}},[e("actions",{attrs:{colspan:t.colspan,layer:t.layer,featureIndex:t.index,trigger:t.trigger,feature:t.feature,actions:t.actions}})],1)},a.staticRenderFns=[],a._scopeId="data-v-164045ac"},{"components/QueryResultsActions.vue":109,mixins:180,"vueify/lib/insert-css":2}],111:[function(e,t,a){e("vueify/lib/insert-css").insert(".noAttributes[data-v-137530c7]{display:flex;justify-content:flex-end}");Object.defineProperty(a,"__esModule",{value:!0}),n=(n=n=e("components/QueryResultsActions.vue"))&&n.__esModule?n:{default:n},e=e("mixins"),a.default={name:"headerfeaturebody",mixins:[e.fieldsMixin],props:{toggleFeatureBoxAndZoom:{type:Function},trigger:{type:Function},hasLayerOneFeature:{type:Function},boxLayerFeature:{type:Object},getLayerField:{type:Function},attributesSubset:{type:Function},layer:{type:Object},feature:{type:Object}},components:{actions:n.default}},t.exports.__esModule&&(t.exports=t.exports.default);var n,a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("tr",[t._l(t.attributesSubset(t.layer),function(e){return a("td",{staticClass:"attribute"},[t.isLink(t.getLayerField({layer:t.layer,feature:t.feature,fieldName:e.name}))?a("span",{staticClass:"skin-color",class:t.g3wtemplate.getFontClass("link")}):t.isPhoto(t.getLayerField({layer:t.layer,feature:t.feature,fieldName:e.name}))||t.isImage(t.getLayerField({layer:t.layer,feature:t.feature,fieldName:e.name}))?a("span",{staticClass:"skin-color",class:t.g3wtemplate.getFontClass("image")}):a("span",[t._v(t._s(t.feature.attributes[e.name]))])])}),t._v(" "),t.hasLayerOneFeature(t.layer)?t._e():a("td")],2)},a.staticRenderFns=[],a._scopeId="data-v-137530c7"},{"components/QueryResultsActions.vue":109,mixins:180,"vueify/lib/insert-css":2}],112:[function(e,t,a){function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(a,"__esModule",{value:!0}),i=n(e("components/FieldLink.vue")),r=n(e("components/FieldVue.vue")),e=e("mixins"),a.default={name:"tableattributefieldvalue",props:{field:{type:Object},feature:{type:Object}},mixins:[e.fieldsMixin],components:{"g3w-link":i.default,"g3w-vue":r.default}},t.exports.__esModule&&(t.exports=t.exports.default);var i,r,a="function"==typeof t.exports?t.exports.options:t.exports;a.render=function(){var e=this,t=e.$createElement,t=e._self._c||t;return e.isVue(e.field)?t("g3w-vue",{attrs:{feature:e.feature,state:e.field}}):e.isSimple(e.field)?t("span",{domProps:{innerHTML:e._s(e.field.value)}}):e.isPhoto(e.field)||e.isImage(e.field)?t("g3w-image",{attrs:{value:e.field.value}}):e.isLink(e.field)?t("g3w-link",{attrs:{state:{value:e.field.value}}}):e._e()},a.staticRenderFns=[],a._scopeId="data-v-0a32e30e"},{"components/FieldLink.vue":47,"components/FieldVue.vue":50,mixins:180}],113:[function(e,t,a){var n,o,i,r,s,l,u,c,d,p,f,g,h,y,m,v;e("vueify/lib/insert-css").insert(".query-relation[data-v-20ddbb22]{margin-top:3px}.query-relation>.header[data-v-20ddbb22]{padding:3px;display:flex;justify-content:space-between;align-items:center;width:100%;margin:0!important}.query-relation>.header>.g3w-long-text[data-v-20ddbb22]{border-radius:3px;font-size:1.3em}.query-relation.mobile>.header>.g3w-long-text[data-v-20ddbb22]{font-size:1em}.relations-table-tools[data-v-20ddbb22]{font-size:1.1em;margin-bottom:3px}.relations-table-tools>.action-button[data-v-20ddbb22]{padding:5px}.relation-wrapper[data-v-20ddbb22]{display:flex;justify-content:space-between;margin-bottom:5px;margin-top:3px;height:95%}.back-button[data-v-20ddbb22]{font-size:.8em}.header-component[data-v-20ddbb22]{width:100%;display:flex;margin-left:auto;margin-bottom:5px;margin-right:4px}.table-tools[data-v-20ddbb22]{display:flex;justify-content:space-between}.relationtable .table-tools .action-button[data-v-20ddbb22]:hover{background-color:transparent}.relationtable.dataTable tbody tr.selected[data-v-20ddbb22]{background-color:#e4e4e4!important}.relationtable.dataTable tbody tr.selected .row-wrap-tabs .tabs-wrapper[data-v-20ddbb22]{background-color:#fff!important}#chart_content[data-v-20ddbb22]{padding-bottom:5px;margin-bottom:5px;margin-left:8px}.dataTables_scrollBody[data-v-20ddbb22]{font-weight:700;margin-top:10px;font-size:1.1em;display:flex;justify-content:space-between}\n.relation-wrapper .dataTables_length select{border:1px solid #ccc;background:#fff;height:27px}.relation-wrapper .paginate_button{background:transparent!important;color:currentColor!important;box-shadow:none!important}.relation-wrapper .paginate_button.disabled{opacity:.25!important}.relation-wrapper .dataTables_scroll{background:#fff}");function _(e){return e&&e.__esModule?e:{default:e}}function b(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),n=e("g3w-constants"),o=_(e("g3w-component")),i=_(e("components/FieldG3W.vue")),r=_(e("components/QueryResultsActionDownloadFormats.vue")),s=_(e("services/gui")),l=e("mixins"),u=e("g3w-eventbus"),c=e("utils/throttle"),d=e("utils/getCatalogLayerById"),v=void 0,a.default={name:"relation",props:{table:{},feature:{default:null},relation:{},previousview:{},showChartButton:{},cardinality:{}},inject:["relationnoback"],mixins:[l.fieldsMixin,l.resizeMixin],components:{Field:i.default},data:function(){return{fields:null,chart:!1,headercomponent:null,downloadButton:null,downloadLayer:{state:null,config:{downloads:[]}}}},computed:{showTools:function(){return[!!this.isEditable,!!this.table.formStructure,!!this.isGeoLayer].filter(Boolean).length},showrelationslist:function(){return"relations"===this.previousview&&!this.relationnoback},one:function(){return"ONE"===this.relation.type}},methods:{zoomToGeometry:function(e){e&&s.default.getService("map").zoomToGeometry(new ol.geom[e.type](e.coordinates),{highlight:!0})},createTable:(m=b(function*(){var t=this,a=(0,d.getCatalogLayerById)(this.table.layerId),e=(this.isEditable=a.isEditable()&&!a.isInEditing(),this.isGeoLayer=void 0!==this.table.features.find(function(e){return e.geometry}),a.getDownloadableFormats());0<e.length&&(this.downloadButton={toggled:!1,tooltip:1<e.length?"Downloads":"sdk.tooltips.download_"+e[0],handler:1<e.length?b(function*(){t.downloadButton.toggled=!t.downloadButton.toggled,t.downloadLayer.state=t.downloadLayer.state||a.state,t.downloadLayer.config.downloads=t.downloadLayer.config.downloads.length?t.downloadLayer.config.downloads:e.map(function(e){return{id:e,format:e,cbk:function(){t.saveRelation(a.getDownloadUrl(e)),t.headercomponent=null},download:!0}}),t.headercomponent=t.downloadButton.toggled?r.default:null}):function(){return t.saveRelation(a.getDownloadUrl(e[0]))}}),u.VM.$on("reload-relations",function(){t.reloadLayout()}),this.showChart=(0,c.throttle)(b(function*(){t.chart=!t.chart,yield t.$nextTick(),t.chartContainer=t.chartContainer||$("#chart_content"),t.$emit(t.chart?"show-chart":"hide-chart",t.chartContainer,{relations:[t.relation],fid:t.feature.attributes[n.G3W_FID]})})),yield this.$nextTick(),v=s.default.getSize({element:"sidebar",what:"width"}),this.relation.title=this.relation.name,this.one||(this.relationDataTable=$(this.$refs.relationtable).DataTable({autoWidth:!1,bLengthChange:!0,dom:"ltip",columnDefs:[this.showTools?{orderable:!1,targets:0,width:"1%"}:{orderable:!0,targets:0}],order:[this.showTools?1:0,"asc"],pageLength:10,responsive:!0,scrollResize:!0,scrollCollapse:!0,scrollX:!0}),this.tableHeaderHeight=$(".query-relation  div.dataTables_scrollHeadInner").height()),s.default.on("pop-content",function(){return setTimeout(function(){return t.resize()})}),this.resize()}),function(){return m.apply(this,arguments)}),resize:(y=b(function*(){this.$refs.query_relation&&"none"!==this.$refs.query_relation.parentNode.style.display&&($(this.$refs.query_relation).find("div.dataTables_scrollBody").height($(".content").height()-this.tableHeaderHeight-$(".content_breadcrumb").outerHeight()-$(".navbar-header").outerHeight()-$(".close-panel-block").outerHeight()-$(this.$refs["relation-header"]).outerHeight()-$(".dataTables_filter").last().outerHeight()-$(".dataTables_paginate.paging_simple_numbers").outerHeight()-$(".dataTables_scrollHead").last().outerHeight()),this.reloadLayout())}),function(){return y.apply(this,arguments)}),saveRelation:function(e){this.$emit("save-relation",e),this.downloadButton.toggled=!1},showFormStructureRow:(h=b(function*(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=t.layerid,n=t.feature,i=t.fields,r=t.tabs;s.default.showContent({content:new o.default({internalComponent:new(Vue.extend({data:function(){return{layerid:a,feature:n,fields:i,formStructure:r}},template:'\n              <div class="queryresults-wrapper">\n                <table ref="table" class="table">\n                  <tbody>\n                  <tr class="featurebox-body">\n                    <td>\n                      <tabs\n                        :layerid = "layerid"\n                        :feature = "feature"\n                        :fields  = "fields"\n                        :tabs    = "formStructure" />\n                    </td>\n                  </tr>\n                  </tbody>\n                </table>\n              </div>\n            ',mounted:(e=b(function*(){yield this.$nextTick(),this.$refs.table.click()}),function(){return e.apply(this,arguments)})}))}),push:!0,showgoback:!0,closable:!1})}),function(){return h.apply(this,arguments)}),editFeature:function(e){s.default.getService("queryresults").editFeature({layer:{id:this.table.layerId,attributes:this.table.fields},feature:this.table.features[e]})},getRowFields:function(a){var n=this;return this.table.fields.map(function(e,t){return e.value=a[t],e.query=!0,e.input={type:""+n.getFieldType(e)},e})},reloadLayout:function(){this.relationDataTable&&this.relationDataTable.columns.adjust()},back:function(){this.$parent.setRelationsList()},fieldIs:function(e,t){return this.getFieldType(t)===e},is:function(e,t){return this.fieldIs(e,t)},moveFnc:function(e){var t=$(".sidebar-collapse").length?0:v,e=e.pageX+2-t;this.$refs.tablecontent.style.width=e+"px",this.$refs.chartcontent.style.width=$(this.$refs.relationwrapper).width()-e-10+"px"}},watch:{table:{immediate:!0,handler:function(e){e&&e.rows.length&&this.createTable()}},chart:(g=b(function*(){yield this.$nextTick(),this.resize()}),function(){return g.apply(this,arguments)}),headercomponent:(f=b(function*(){yield this.$nextTick(),this.resize()}),function(){return f.apply(this,arguments)})},beforeCreate:function(){this.delayType="debounce"},beforeDestroy:(p=b(function*(){this.relationDataTable&&(this.relationDataTable.destroy(),this.relationDataTable=null,this.chartContainer&&this.$emit("hide-chart",this.chartContainer),this.chartContainer=null,this.tableHeaderHeight=null,s.default.off("pop-content",this.resize))}),function(){return p.apply(this,arguments)})},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var n=this,e=n.$createElement,i=n._self._c||e;return n.table?i("div",{ref:"query_relation",staticClass:"query-relation",class:n.isMobile()?"mobile":null},[i("div",{ref:"relation-header",staticClass:"header skin-background-color lighten"},[i("div",{staticClass:"g3w-long-text"},[n.showrelationslist?i("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:"sdk.relations.back_to_relations",expression:"'sdk.relations.back_to_relations'",arg:"right",modifiers:{create:!0}}],staticClass:"action-button-icon action-button back-button",class:n.g3wtemplate.getFontClass("exit"),on:{click:function(e){return e.stopPropagation(),n.back(e)}}}):n._e(),n._v(" "),i("b",{staticClass:"relation-tile skin-color"},[n._v(" "+n._s(n.relation.name)+" ")])]),n._v(" "),n.table.rows.length?i("div",{staticClass:"relations-table-tools"},[n.downloadButton?i("span",{directives:[{name:"download",rawName:"v-download"},{name:"t-tooltip",rawName:"v-t-tooltip:left.create",value:n.downloadButton.tooltip,expression:"downloadButton.tooltip",arg:"left",modifiers:{create:!0}}],staticClass:"action-button-icon action-button",class:[n.g3wtemplate.getFontClass("download"),{"toggled-white":n.downloadButton.toggled}],on:{click:function(e){return e.stopPropagation(),n.downloadButton.handler(e)}}}):n._e(),n._v(" "),n.showChartButton?i("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:bottom.create",value:"sdk.tooltips.show_chart",expression:"'sdk.tooltips.show_chart'",arg:"bottom",modifiers:{create:!0}}],staticClass:"action-button-icon action-button",class:[n.g3wtemplate.getFontClass("chart"),n.chart?"toggled-white":""],on:{click:function(e){return e.stopPropagation(),n.showChart(e)}}}):n._e()]):n._e()]),n._v(" "),n.table.rows.length?i("div",{ref:"relationwrapper",staticClass:"relation-wrapper"},[i("div",{ref:"tablecontent",style:{width:n.chart?"70%":"100%",marginRight:n.chart?"8px":"3px",position:"relative"},attrs:{id:"table_content"}},[n.headercomponent?i("div",{staticClass:"header-component"},[i(n.headercomponent,{tag:"component",attrs:{layer:n.downloadLayer.state,config:n.downloadLayer.config}})],1):n._e(),n._v(" "),i("table",{ref:"relationtable",staticClass:"hover relationtable table table-striped row-border"},[i("thead",[i("tr",{staticStyle:{height:"0! important"}},[n.showTools?i("th",{style:{minWidth:30*this.showTools+"px",padding:"0 !important"}}):n._e(),n._v(" "),n._l(n.table.columns,function(e){return i("th",[n._v(n._s(e))])})],2)]),n._v(" "),i("tbody",n._l(n.table.rows,function(t,a){return i("tr",{key:n.table.rows_fid[a],class:{selected:n.table.rowFormStructure===t}},[n.showTools?i("td",{staticClass:"table-tools"},[n.table.features[a].geometry?i("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:"sdk.tooltips.relations.zoomtogeometry",expression:"'sdk.tooltips.relations.zoomtogeometry'",arg:"right",modifiers:{create:!0}}],staticClass:"action-button row-form skin-color",class:n.g3wtemplate.getFontClass("marker"),on:{click:function(e){return e.stopPropagation(),n.zoomToGeometry(n.table.features[a].geometry)}}}):n._e(),n._v(" "),n.table.formStructure?i("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:"sdk.tooltips.relations.row_to_form",expression:"`sdk.tooltips.relations.row_to_form`",arg:"right",modifiers:{create:!0}}],staticClass:"action-button row-form skin-color",class:n.g3wtemplate.getFontClass("table"),on:{click:function(e){e.stopPropagation(),n.showFormStructureRow({layerid:n.table.layerId,feature:n.table.features[a],fields:n.getRowFields(t),tabs:n.table.formStructure})}}}):n._e(),n._v(" "),n.isEditable?i("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:"Edit",expression:"'Edit'",arg:"right",modifiers:{create:!0}}],staticClass:"action-button row-form skin-color",class:n.g3wtemplate.getFontClass("pencil"),on:{click:function(e){return e.stopPropagation(),n.editFeature(a)}}}):n._e()]):n._e(),n._v(" "),n._l(t,function(e){return i("td",[i("field",{attrs:{state:{value:e}}})],1)})],2)}),0)])]),n._v(" "),i("g3w-resize",{staticClass:"skin-border-color lighten",staticStyle:{"border-style":"solid","border-width":"0 1px 0 1px"},attrs:{show:n.chart,moveFnc:n.moveFnc,where:"content"}}),n._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:n.chart,expression:"chart"}],ref:"chartcontent",style:{width:n.chart?"30%":"0"},attrs:{id:"chart_content"}})],1):i("div",{staticClass:"dataTables_scrollBody"},[i("span",{directives:[{name:"t",rawName:"v-t",value:"sdk.relations.no_relations_found",expression:"'sdk.relations.no_relations_found'"}]})])]):n._e()},e.staticRenderFns=[],e._scopeId="data-v-20ddbb22"},{"components/FieldG3W.vue":44,"components/QueryResultsActionDownloadFormats.vue":106,"g3w-component":139,"g3w-constants":140,"g3w-eventbus":141,mixins:180,"services/gui":188,"utils/getCatalogLayerById":218,"utils/throttle":256,"vueify/lib/insert-css":2}],114:[function(e,t,a){var n,i,r;e("vueify/lib/insert-css").insert(".relation-grid-item[data-v-02f56b7e]{min-width:0;min-height:80px;border:2px solid;cursor:pointer;border-radius:4px;background-color:#fff;display:flex;align-items:center}.relation-grid-item[data-v-02f56b7e]:hover{background-color:transparent}.query-relations[data-v-02f56b7e]{overflow-y:auto}.query-relations>.header[data-v-02f56b7e]{margin-bottom:10px;border-radius:4px;padding:5px}.query-relations>.query-relations-content[data-v-02f56b7e]{display:grid;grid-template-columns:repeat(2,auto);grid-column-gap:5px;grid-row-gap:5px}.relation-grid-item>.g3w-long-text[data-v-02f56b7e]{font-weight:700;padding:5px}");function o(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},a.default={name:"relations",props:["relations","feature","loading"],methods:{showRelation:(i=o(function*(e){yield this.$parent.showRelation(e)}),function(e){return i.apply(this,arguments)}),featureInfo:function(){return Object.entries(this.feature.attributes).filter(function(e){e=r(e,2),e[0],e=e[1];return e&&"string"==typeof e&&!e.includes("/")}).map(function(e){e=r(e,2);return{key:e[0],value:e[1]}}).slice(0,3)}},mounted:(n=o(function*(){1===this.relations.length&&(this.relations[0].noback=!0,yield this.showRelation(this.relations[0]))}),function(){return n.apply(this,arguments)}),beforeDestroy:function(){1===this.relations.length&&delete this.relations[0].noback}},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var a=this,e=a.$createElement,n=a._self._c||e;return n("div",{staticClass:"query-relations"},[n("div",{staticClass:"header skin-background-color lighten"},[n("div",{staticClass:"skin-color-dark"},[n("span",{directives:[{name:"t",rawName:"v-t:pre",value:"sdk.relations.list_of_relations_feature",expression:"'sdk.relations.list_of_relations_feature'",arg:"pre"}],staticStyle:{"font-size":"1.1em"}}),a._v(" "),a._l(a.featureInfo(),function(e){return n("div",[a._v(" - "),n("b",[a._v(a._s(e.key))]),a._v(": "+a._s(e.value))])})],2)]),a._v(" "),n("div",{staticClass:"query-relations-content"},a._l(a.relations,function(t){return n("div",{staticClass:"skin-border-color relation-grid-item",on:{click:function(e){return e.stopPropagation(),a.showRelation(t)}}},[n("span",{staticClass:"skin-color g3w-long-text"},[a._v(a._s(t.name))])])}),0)])},e.staticRenderFns=[],e._scopeId="data-v-02f56b7e"},{"vueify/lib/insert-css":2}],115:[function(e,t,a){function n(e){return e&&e.__esModule?e:{default:e}}function i(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}function l(e,t){var e=(e=0<arguments.length&&void 0!==e?e:[])||[],t=s.default.project.getLayerById(t),a=Object.keys(e[0]?e[0].attributes:{}),n=t.getTableHeaders().filter(function(e){return a.includes(e.name)});return{columns:n.map(function(e){return e.label}),rows:e.map(function(t){return n.map(function(e){return t.attributes[e.name]})}),rows_fid:e.map(function(e){return e.attributes[r.G3W_FID]}),features:e,fields:n.length?n:null,formStructure:t.getLayerEditingFormStructure(),rowFormStructure:null,layerId:t.getId()}}Object.defineProperty(a,"__esModule",{value:!0}),r=e("g3w-constants"),o=e("g3w-eventbus"),s=n(e("store/application")),u=n(e("services/gui")),c=n(e("components/Relations.vue")),d=n(e("components/Relation.vue")),p=n(e("services/data")),f=e("utils/getAlphanumericPropertiesFromFeature"),g=e("utils/XHR"),h=e("utils/createSingleFieldParameter"),y=e("utils/createRelationsUrl"),m=e("utils/getCatalogLayerById"),x=void 0,a.default={name:"relation-page",data:function(){var e=this.$options,t=e.table,t=void 0===t?null:t,a=e.relation,a=void 0===a?null:a,n=e.relations,n=void 0===n?[]:n,i=e.nmRelation,r=e.feature,r=void 0===r?null:r,o=e.currentview,o=void 0===o?"relations":o,s=e.chartRelationIds,s=void 0===s?[]:s,e=e.layer;return{loading:!1,state:null,error:!1,table:t?l(t):null,previousview:o,showChartButton:!1,feature:r,currentview:o,relation:a,relations:n,nmRelation:i,chartRelationIds:s,layer:e}},provide:function(){return{relationnoback:1===this.$options.relations.length}},components:{relations:c.default,relation:d.default},methods:{saveRelations:(w=i(function*(e){s.default.download=!0;try{yield g.XHR.fileDownload({url:(0,y.createRelationsUrl)(Object.assign(x,{type:e})),httpMethod:"GET"})}catch(e){u.default.showUserMessage({type:"alert",message:e||"info.server_error",closable:!0})}s.default.download=!1}),function(e){return w.apply(this,arguments)}),reloadLayout:function(){o.VM.$emit("reload-relations")},showChart:function(e,t){u.default.getService("queryresults").showChart([this.relation.referencingLayer],e,t)},hideChart:function(e){u.default.getService("queryresults").hideChart(e)},getRelationsNM:(b=i(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.nmRelation,e=e.features,e=void 0===e?[]:e,a=t.referencedLayer,t=t.fieldRef,n=t.referencingField,t=t.referencedField,i=[];return i=e.length&&(e=e.map(function(e){return e.attributes[n]}),a=(yield p.default.getData("search:features",{inputs:{layer:(0,m.getCatalogLayerById)(a),filter:""+(0,h.createSingleFieldParameter)({field:t,value:e,logicop:"OR"}),formatter:1},outputs:null})).data)&&a[0]&&Array.isArray(a[0].features)?a[0].features.map(function(a){return{id:a.getId(),geometry:a.getGeometry(),attributes:(0,f.getAlphanumericPropertiesFromFeature)(a.getProperties()).reduce(function(e,t){return e[t]=a.get(t),e},{})}}):i}),function(){return b.apply(this,arguments)}),showRelation:(_=i(function*(e){u.default.setLoadingContent(!0),this.loading=!0;var t=(this.relation=e).referencingLayer;try{x={layer:this.$options.layer,fid:this.feature.attributes[r.G3W_FID],relation:e};var a=yield g.XHR.get({url:(0,y.createRelationsUrl)(x)}),n=a.result?(a.vector.data.features||[]).map(function(e){return e.properties[r.G3W_FID]=e.id,{geometry:e.geometry,attributes:e.properties,id:e.id}}):null;this.nmRelation&&(t=this.nmRelation.referencedLayer,n=yield this.getRelationsNM({nmRelation:this.nmRelation,features:n})),this.showChartButton=!!this.chartRelationIds.find(function(e){return t===e}),this.table=l(n,t),u.default.setCurrentContentOptions({title:e.name,crumb:{title:e.name}}),yield this.$nextTick(),this.previousview=this.currentview,this.currentview="relation"}catch(e){}u.default.setLoadingContent(!1),this.loading=!0}),function(e){return _.apply(this,arguments)}),setRelationsList:function(){this.previousview="relation",this.currentview="relations",u.default.setCurrentContentOptions({crumb:{title:"info.list_of_relations"}}),this.loading=!1}},beforeMount:function(){("relation"===this.currentview||1===this.relations.length&&"ONE"===this.relations[0].type)&&this.showRelation(this.relations[0])},mounted:(v=i(function*(){this.relations.sort(function(e,t){e=e.name,t=t.name;return e<t?-1:t<e?1:0}),yield this.$nextTick(),this.error&&requestAnimationFrame(function(){return u.default.popContent()}),this.error=!1}),function(){return v.apply(this,arguments)}),created:function(){this.$on("resize-component",this.reloadLayout)}},t.exports.__esModule&&(t.exports=t.exports.default);var r,o,s,u,c,d,p,f,g,h,y,m,v,_,b,w,x,e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var e=this,t=e.$createElement,t=e._self._c||t;return t("div",{staticClass:"query-relations-page"},[t(e.currentview,{ref:e.currentview,tag:"component",attrs:{loading:e.loading,previousview:e.previousview,showChartButton:e.showChartButton,relations:e.relations,relation:e.relation,nmRelation:e.nmRelation,feature:e.feature,table:e.table},on:{"save-relation":e.saveRelations,"show-chart":e.showChart,"hide-chart":e.hideChart}})],1)},e.staticRenderFns=[]},{"components/Relation.vue":113,"components/Relations.vue":114,"g3w-constants":140,"g3w-eventbus":141,"services/data":187,"services/gui":188,"store/application":193,"utils/XHR":196,"utils/createRelationsUrl":209,"utils/createSingleFieldParameter":211,"utils/getAlphanumericPropertiesFromFeature":217,"utils/getCatalogLayerById":218}],116:[function(e,t,a){var n,o,i,s,r,l,u,c,d,p,f,g;e("vueify/lib/insert-css").insert("li.menu-item[data-v-3edc3c4e]{padding-right:20px!important}li.menu-item span[data-v-3edc3c4e]{display:inline-flex;white-space:pre-wrap}.search-action[data-v-3edc3c4e]{text-shadow:0 2px 5px rgba(0,0,0,.3);padding:0 4px}#g3w-search li i[data-v-3edc3c4e]{width:20px}.search-tools[data-v-3edc3c4e]{display:flex;align-items:baseline}.search-tools>span[data-v-3edc3c4e]{white-space:pre-wrap}.search-tools>div[data-v-3edc3c4e]{margin-left:auto}");function h(e){return e&&e.__esModule?e:{default:e}}function y(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),n=h(e("g3w-panel")),o=h(e("store/application")),i=h(e("services/data")),s=h(e("services/gui")),r=e("utils/createFilterFromString"),l=e("utils/getCatalogLayerById"),u=h(e("components/Tool.vue")),c=(e=>{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t})(e("components/QueryBuilder.vue")),g=e("g3w-i18n").t,a.default={name:"search",data:function(){return{state:this.state||{}}},components:{"g3w-tool":u.default},computed:{show:function(){return 0<this.state.searches.length+this.state.tools.length+this.state.querybuildersearches.length}},methods:{showPanel:function(){this.$options.service.showPanel(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})},remove:(f=y(function*(t,e){try{yield new Promise(function(t,a){s.default.dialog.confirm(g("sdk.querybuilder.delete"),function(e){return(e?t:a)()})});var a=window.localStorage.getItem("QUERYBUILDERSEARCHES"),n=a?JSON.parse(a):void 0,i=o.default.project.getId(),r=(n&&n[i]||[]).filter(function(e){return e.id!==t.id});r.length?n[i]=r:delete n[i];try{Object.keys(n).length?window.localStorage.setItem("QUERYBUILDERSEARCHES",JSON.stringify(n)):window.localStorage.removeItem("QUERYBUILDERSEARCHES")}catch(e){}this.state.querybuildersearches.splice(e,1)}catch(e){}}),function(e,t){return f.apply(this,arguments)}),edit:function(e){e={id:e.id,name:e.name,layerId:e.layerId,filter:e.filter,title:g("sdk.querybuilder.title"),show:!0};e.internalPanel=new(Vue.extend(c))({options:e}),new n.default(e)},run:(p=y(function*(e){e.qbloading=!0;try{var t=(0,l.getCatalogLayerById)(e.layerId);yield i.default.getData("search:features",{inputs:{layer:t,filter:(0,r.createFilterFromString)({layer:t,filter:e.filter}),feature_count:100},outputs:!0})}catch(e){s.default.showUserMessage({type:"alert",message:"sdk.querybuilder.error_run",autoclose:!0})}e.qbloading=!1}),function(e){return p.apply(this,arguments)})},mounted:(d=y(function*(){yield this.$nextTick(),$(".search-action").tooltip()}),function(){return d.apply(this,arguments)})},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var n=this,e=n.$createElement,i=n._self._c||e;return n.show?i("ul",{staticClass:"treeview-menu g3w-search g3w-tools menu-items",attrs:{id:"g3w-search"}},[n._l(n.state.searches,function(t){return i("li",{staticClass:"menu-item",on:{click:function(e){return e.stopPropagation(),n.showPanel(t)}}},[i("i",{class:n.g3wtemplate.getFontClass("empty-circle")}),n._v(" "),i("span",[n._v(n._s(t.name))])])}),n._v(" "),n._l(n.state.tools,function(e){return i("li",[i("g3w-tool",{attrs:{tool:e}})],1)}),n._v(" "),n._l(n.state.querybuildersearches,function(t,a){return i("li",{key:t.id},[i("div",{staticStyle:{position:"relative"},on:{click:function(e){return n.edit(t)}}},[i("bar-loader",{attrs:{loading:t.qbloading}}),n._v(" "),i("div",{staticClass:"search-tools"},[i("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip",value:"sdk.querybuilder.search.delete",expression:"'sdk.querybuilder.search.delete'"}],staticClass:"search-action skin-tooltip-bottom",class:n.g3wtemplate.getFontClass("trash"),staticStyle:{color:"red","margin-right":"5px"},attrs:{"data-placement":"bottom","data-toggle":"tooltip","data-container":"body"},on:{click:function(e){return e.stopPropagation(),n.remove(t,a)}}}),n._v(" "),i("span",[n._v(n._s(t.name))]),n._v(" "),i("div",[i("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip",value:"sdk.querybuilder.search.run",expression:"'sdk.querybuilder.search.run'"}],staticClass:"search-action skin-tooltip-bottom",class:n.g3wtemplate.getFontClass("run"),staticStyle:{color:"green"},attrs:{"data-placement":"bottom","data-toggle":"tooltip","data-container":"body"},on:{click:function(e){return e.stopPropagation(),n.run(t)}}})])])],1)])})],2):n._e()},e.staticRenderFns=[],e._scopeId="data-v-3edc3c4e"},{"components/QueryBuilder.vue":102,"components/Tool.vue":121,"g3w-i18n":143,"g3w-panel":145,"services/data":187,"services/gui":188,"store/application":193,"utils/createFilterFromString":207,"utils/getCatalogLayerById":218,"vueify/lib/insert-css":2}],117:[function(e,t,a){var u,f,g,c,n,h,y,i,r,o,s,l,d,p,m;e("vueify/lib/insert-css").insert(".g3w-search-form label[data-v-51de5286]{color:#fff}.g3w-search-form .search-logicop[data-v-51de5286]{width:100%;position:relative;display:flex;justify-content:center;margin-bottom:15px;margin-top:30px;border-bottom:1px solid}.g3w-search-form .search-logicop h4[data-v-51de5286]{font-weight:700;position:absolute;padding:5px;top:-24px;background:#222d32}#dosearch[data-v-51de5286]{color:#fff;font-weight:700;margin-top:15px;background-color:var(--skin-color)}#dosearch[data-v-51de5286]:hover{color:#fff}.search-label[data-v-51de5286]{width:100%;display:flex;justify-content:space-between}");function v(e){return e&&e.__esModule?e:{default:e}}function _(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function b(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),u=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},f=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},g=e("g3w-constants"),c=v(e("store/application")),n=e("utils/convertQGISDateTimeFormatToMoment"),h=e("utils/createSingleFieldParameter"),y=e("utils/getDataForSearchInput"),i=v(e("mixins/resize")),p=e("g3w-i18n").t,m=[],a.default={mixins:[i.default],data:function(){return{state:this.$options.service.state,allvalue:g.SEARCH_ALLVALUE}},computed:{layers_url:function(){return c.default.project.getState().layers_url},is_staff:function(){return window.initConfig.user.is_staff}},methods:{resize:function(){m.forEach(function(e){return!c.default.ismobile&&e.select2("close")})},getLabelOperator:function(e){return"[ "+g.FILTER_EXPRESSION_OPERATORS[e]+" ]"},onFocus:(d=b(function*(e){var t;this.isMobile()&&(t=$(e.target).position().top-10,yield this.$nextTick(),setTimeout(function(){return $(".main-sidebar").scrollTop(t)},500))}),function(e){return d.apply(this,arguments)}),changeInput:(l=b(function*(o){function s(e){return[g.SEARCH_ALLVALUE,null,void 0].includes(e)||""===e.toString().trim()}function l(e){return"autocompletefield"===e.type}var t,u=this,c=o.attribute,e=this.state.forminputs.filter(function(e){return c===e.dependance}),d=this.state,p=o.value;try{this.state.searching=!0,void 0===(p="numberfield"===o.type?p||0===p?p:null:p)&&(p=g.SEARCH_ALLVALUE),["textfield","textField"].includes(o.type)||(p=p.trim()),o.value=p,yield Promise.allSettled(e.map((t=b(function*(t){var e=y.getDataForSearchInput.field({state:d,field:c,fields:[g.SEARCH_ALLVALUE,void 0].includes(p)?[]:[(0,h.createSingleFieldParameter)({field:c,value:p,operator:o.operator})]}),a=t.dvalues[e];if(t.value="selectfield"===t.type?g.SEARCH_ALLVALUE:null,t.values=Array.from(new Set([].concat(_(l(t)||s(p)?[]:[t.values[0]]),_(!l(t)&&s(p)?t._values:[]),_(a||[])))),t.disabled=!!s(p)&&t.dependance_strict,u.state.forminputs.find(function(e){return e.dependance===t.attribute})&&u.changeInput(t),!(l(t)||s(p)||a)){d.loading[t.attribute]=!0;try{var n,i,r=yield d.search_layers[0].getFilterData({fformatter:t.attribute,ordering:t.attribute,field:e});r.data=(r.data||[]).map(function(e){e=f(e,2),e[0],e=e[1];return{key:e,value:e}}),t.dependance_strict||"selectfield"!==t.type||(n=t._values).push.apply(n,_(t.values)),1===t.values.length&&(i=t.values).push.apply(i,_(r.data)),t.dvalues[e]=t.values.slice(1)}catch(e){}finally{t.disabled=!1,u.state.loading[t.attribute]=!1}}}),function(e){return t.apply(this,arguments)})))}catch(e){}finally{this.state.searching=!1}}),function(e){return l.apply(this,arguments)}),doSearch:function(e){e.preventDefault(),this.$options.service.run()},initDateTimeField:(s=b(function*(t){var a=this;"datetimefield"===t.type&&(yield this.$nextTick(),t.options.format.fieldformat=(0,n.convertQGISDateTimeFormatToMoment)(t.options.format.fieldformat),t.options.format.displayformat=(0,n.convertQGISDateTimeFormatToMoment)(t.options.format.displayformat),$(this.$refs["date_"+t.id]).datetimepicker({defaultDate:null,format:t.options.format.displayformat,ignoreReadonly:!0,allowInputToggle:!0,toolbarPlacement:"top",widgetPositioning:{vertical:"bottom",horizontal:"left"},showClose:!0,locale:c.default.language||"en"}),$(this.$refs["date_"+t.id]).on("dp.change",function(){var e=$("#"+t.id).val();t.value=e.trim()?moment(e,t.options.format.displayformat).format(t.options.format.fieldformat):null,a.changeInput(t)}),c.default.ismobile)&&setTimeout(function(){$("#"+t.id).blur()})}),function(e){return s.apply(this,arguments)}),initSelect2Field:(o=b(function*(n){var e,t,a,i,r,o,s,l=this;["selectfield","autocompletefield"].includes(n.type)&&(yield this.$nextTick(),e=n.options.numdigaut,a=(t="autocompletefield"===n.type)?{delay:500,transport:(i=b(function*(e,t,a){try{t({results:(yield(0,y.getDataForSearchInput)({state:l.state,field:n.attribute,suggest:n.attribute+"|"+e.data.q})).map(function(e){return{id:e.value,text:e.key}})})}catch(e){a(e)}}),function(e,t,a){return i.apply(this,arguments)})}:null,r=$("#"+n.id).select2({ajax:a,width:"100%",dropdownParent:$(".g3w-search-form:visible"),minimumInputLength:t?e&&!Number.isNaN(+e)&&0<+e&&+e||2:0,allowClear:t,placeholder:t?"":null,matcher:function(e,t){e=e.term&&e.term.toLowerCase();return""===(e||"").toString().trim()?t:t.text.toLowerCase().includes(e)&&void 0!==t.text?u({},t):null},language:{noResults:function(){return p("sdk.search.no_results")},errorLoading:function(){return p("sdk.search.error_loading")},searching:function(){return p("sdk.search.searching")},inputTooShort:function(e){return p("sdk.search.autocomplete.inputshort.pre")+" "+(e.minimum-e.input.length)+" "+p("sdk.search.autocomplete.inputshort.post")}}}),m.push(r),r.on("select2:select select2:unselecting",function(e){"select2:select"!==e.type&&!t||(n.value=e.params.data?""+e.params.data.id:g.SEARCH_ALLVALUE,l.changeInput(n))}),this.$watch(function(){return n.value},(o=b(function*(e,t){e!==t&&g.SEARCH_ALLVALUE===e&&r.val(e).trigger("change")}),function(e,t){return o.apply(this,arguments)})),s=this.$watch(function(){return c.default.language},function(){s(),l.clearSelect2(),l.initSelect2Field(n)}),r.val(n.value).trigger("change"))}),function(e){return o.apply(this,arguments)}),clearSelect2:function(){m.forEach(function(e){e.select2("destroy"),e.off()}),m.splice(0)}},mounted:(r=b(function*(){yield Promise.allSettled([this.$nextTick(),this.state.mounted]);var e=!0,t=!1,a=void 0;try{for(var n,i=this.state.forminputs[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var r=n.value;yield this.initSelect2Field(r),yield this.initDateTimeField(r)}}catch(e){t=!0,a=e}finally{try{!e&&i.return&&i.return()}finally{if(t)throw a}}}),function(){return r.apply(this,arguments)}),beforeDestroy:function(){this.clearSelect2()}},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var a=this,e=a.$createElement,n=a._self._c||e;return n("div",{directives:[{name:"disabled",rawName:"v-disabled",value:a.state.searching,expression:"state.searching"}],staticClass:"g3w-search-panel form-group"},[n("h4",[n("b",[a._v(a._s(a.state.title))])]),a._v(" "),a._t("tools"),a._v(" "),a._t("form",[n("form",{staticClass:" g3w-search-form"},[a._l(a.state.forminputs,function(t){return n("div",{key:t.id,staticClass:"form-group"},["numberfield"===t.type||"textfield"===t.type&&"Range"===t.widget_type?n("div",{staticClass:"numeric"},[n("label",{staticClass:"search-label",attrs:{for:t.id}},[n("span",[a._v(a._s(t.label||t.attribute))]),a._v(" "),n("span",{staticClass:"skin-color"},[a._v(a._s(a.getLabelOperator(t.operator)))])]),a._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.value,expression:"input.value"}],staticClass:"form-control",attrs:{type:"number",min:"0",id:t.id},domProps:{value:t.value},on:{change:function(e){return a.changeInput(t)},input:[function(e){e.target.composing||a.$set(t,"value",e.target.value)},function(e){return a.changeInput(t)}]}})]):["textfield","textField"].includes(t.type)?n("div",{staticClass:"form-item-search text"},[n("label",{staticClass:"search-label",attrs:{for:t.id}},[n("span",[a._v(a._s(t.label||t.attribute))]),a._v(" "),n("span",{staticClass:"skin-color"},[a._v(a._s(a.getLabelOperator(t.operator)))])]),a._v(" "),n("input",{directives:[{name:"model",rawName:"v-model",value:t.value,expression:"input.value"}],staticClass:"form-control",attrs:{type:"text",id:t.id},domProps:{value:t.value},on:{focus:a.onFocus,change:function(e){return a.changeInput(t)},input:function(e){e.target.composing||a.$set(t,"value",e.target.value)}}})]):["selectfield","autocompletefield"].includes(t.type)?n("div",{directives:[{name:"disabled",rawName:"v-disabled",value:a.state.loading[t.dependance]||t.loading||t.disabled,expression:"state.loading[input.dependance] || input.loading || input.disabled"}],staticClass:"text"},[n("label",{staticClass:"search-label",attrs:{for:t.id}},[n("span",[a._v(a._s(t.label||t.attribute))]),a._v(" "),n("span",{staticClass:"skin-color"},[a._v(a._s(a.getLabelOperator(t.operator)))])]),a._v(" "),t.dependance?n("bar-loader",{attrs:{loading:a.state.loading[t.dependance]||t.loading}}):a._e(),a._v(" "),n("select",{directives:[{name:"disabled",rawName:"v-disabled",value:t.disabled||t.loading,expression:"input.disabled || input.loading"}],staticClass:"form-control",attrs:{name:t.attribute,id:t.id}},a._l(t.values,function(e){return n("option",{key:e.value,domProps:{value:e.value}},[a.allvalue===e.value?n("span",{directives:[{name:"t",rawName:"v-t",value:"sdk.search.all",expression:"'sdk.search.all'"}]}):n("span",[a._v(a._s(e.key))])])}),0)],1):"datetimefield"===t.type?n("div",{directives:[{name:"disabled",rawName:"v-disabled",value:a.state.loading[t.dependance]||!1,expression:"state.loading[input.dependance] || false"}],staticClass:"text"},[n("label",{staticClass:"search-label",attrs:{for:t.id}},[n("span",[a._v(a._s(t.label||t.attribute))]),a._v(" "),n("span",{staticClass:"skin-color"},[a._v(a._s(a.getLabelOperator(t.operator)))])]),a._v(" "),n("div",{ref:"date_"+t.id,refInFor:!0,staticClass:"input-group date"},[n("input",{staticClass:"form-control",attrs:{id:t.id,type:"text"}}),a._v(" "),n("span",{staticClass:"input-group-addon skin-color"},[n("span",{class:a.g3wtemplate.getFontClass(t.options.format.time?"time":"calendar")})])])]):a._e(),a._v(" "),n("sub",[a._v(a._s(t.options.description))]),a._v(" "),a.is_staff?n("sub",[t.options.description?n("br"):a._e(),a._v(" "),n("span",{staticClass:"skin-color"},[a._v(a._s(t.type))]),a._v(" | "),n("span",{staticClass:"skin-color"},[a._v(a._s(t.widget_type))]),a._v(" "),t.options.value?[a._v(': { key: "'+a._s(t.options.key)+'", value: "'+a._s(t.options.value)+' }"')]:a._e(),a._v(" "),t.options.layer_id?[n("br"),n("span",{staticClass:"skin-color"},[a._v("layer_id:")]),a._v(' "'+a._s(t.options.layer_id)+'"')]:a._e(),a._v(" "),t.dependance?[n("br"),n("span",{staticClass:"skin-color"},[a._v("depends_on:")]),a._v(' "'+a._s(t.dependance)+'"')]:a._e(),a._v(" "),t.dependance?[n("br"),n("span",{staticClass:"skin-color"},[a._v("strict:")]),a._v(" "+a._s(t.dependance_strict))]:a._e()],2):a._e(),a._v(" "),t.logicop?n("div",{staticClass:"search-logicop skin-border-color"},[n("h4",[a._v(a._s(t.logicop))])]):a._e()])}),a._v(" "),n("div",{staticClass:"form-group"},[n("button",{directives:[{name:"t",rawName:"v-t",value:"dosearch",expression:"'dosearch'"}],staticClass:"sidebar-button-run btn btn-block pull-right",attrs:{id:"dosearch","data-i18n":"dosearch"},on:{click:function(e){return e.stopPropagation(),a.doSearch(e)}}})])],2)]),a._v(" "),a._t("footer"),a._v(" "),a.layers_url?n("div",{staticStyle:{"padding-top":"5em"}},[n("b",[n("a",{attrs:{href:a.layers_url,target:"_blank"}},[a._v("Edit in admin")])])]):a._e()],2)},e.staticRenderFns=[],e._scopeId="data-v-51de5286"},{"g3w-constants":140,"g3w-i18n":143,"mixins/resize":182,"store/application":193,"utils/convertQGISDateTimeFormatToMoment":202,"utils/createSingleFieldParameter":211,"utils/getDataForSearchInput":220,"vueify/lib/insert-css":2}],118:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),e=e("store/application"),i=(e=e)&&e.__esModule?e:{default:e},a.default={name:"SidebarItem",data:function(){var e=this.$options.component;return{info:e.info||{state:null,style:null,class:null},main:!0,component:e,active:!1,title:e.title||"",open:!!e.state.open,icon:e.icon,iconColor:e.iconColor,collapsible:!1!==e.collapsible,actions:e.actions,sidebar:i.default.gui.sidebar}},methods:{triggerAction:function(e,t){e.fnc(t)}},mounted:function(){var a=this,n=this.$options.opts||{},e=document.getElementById("g3w-sidebarcomponents");[null,void 0].includes(n.position)||n.position<0||n.position>=e.children.length?$(e).append(this.$el):Array.from(e.children).forEach(function(e,t){t!==n.position&&e.id!==n.position||e.insertAdjacentElement(n.before||void 0===n.before?"beforebegin":"afterend",a.$el)}),this.component.mount(this.$refs["component-placeholder"]),this.component.click=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).open,e=void 0!==e&&e,t=(e&&i.default.sidebar.components.forEach(function(e){e!==a.component&&e.getOpen()&&e.click({open:!1})}),a.component.getInternalComponent().$el);t.classList.toggle("menu-open",e),t.parentNode.classList.toggle("active",e),a.component.setOpen(e)}}},t.exports.__esModule&&(t.exports=t.exports.default);var i,e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var a=this,e=a.$createElement,n=a._self._c||e;return n("li",{directives:[{name:"show",rawName:"v-show",value:a.component.state.visible,expression:"component.state.visible"},{name:"disabled",rawName:"v-disabled",value:a.component.state.disabled,expression:"component.state.disabled"}],staticClass:"treeview sidebaritem",class:{active:a.open},attrs:{id:a.component.id}},[n("bar-loader",{attrs:{loading:a.component.state.loading}}),a._v(" "),n("a",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:a.sidebar.open?"":a.title,expression:"sidebar.open ? '' : title",arg:"right",modifiers:{create:!0}}],staticStyle:{display:"flex","justify-content":"space-between","align-items":"center"},attrs:{href:"#","current-tooltip":a.sidebar.open?"":a.title}},[n("div",[a.sidebar.open?n("i",{class:a.icon,style:{color:a.iconColor}}):n("span",[n("i",{class:a.icon,style:{color:a.iconColor}})]),a._v(" "),n("span",{directives:[{name:"t",rawName:"v-t",value:a.title,expression:"title"}],staticClass:"treeview-label"})]),a._v(" "),n("div",[a.info.state?n("span",{class:a.info.class,staticStyle:{position:"absolute",right:"5px","font-weight":"bold"},style:a.info.style,attrs:{title:a.info.tooltip}},[a._v(a._s(a.info.state))]):a._e(),a._v(" "),a._l(a.actions,function(t){return n("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:left.create",value:t.tooltip,expression:"action.tooltip",arg:"left",modifiers:{create:!0}}],key:t.id,staticClass:"action skin-tooltip-left",class:t.class,staticStyle:{"font-weight":"bold",padding:"3px"},style:t.style,on:{click:function(e){return e.stopPropagation(),a.triggerAction(t,a.component.internalComponent)}}})})],2),a._v(" "),a.collapsible?n("i",{staticClass:"pull-right",class:a.g3wtemplate.getFontClass("angle-left")}):a._e()]),a._v(" "),n("div",{ref:"component-placeholder"})],1)},e.staticRenderFns=[]},{"store/application":193}],119:[function(e,t,a){var n,i,r,o,s,l,u,c,d,p;e("vueify/lib/insert-css").insert(".content-bookmarks{font-weight:700;color:#fff;padding:5px;border-bottom:1px solid #fff;margin-bottom:2px}.spatial-bookmark{display:flex;align-items:baseline;justify-content:space-between;padding:5px!important}");function f(e){return e&&e.__esModule?e:{default:e}}function g(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),n=e("g3w-constants"),i=f(e("store/application")),r=f(e("services/gui")),o=f(e("store/projections")),s=f(e("components/InputText.vue")),l=e("utils/getUniqueDomId"),d=e("g3w-i18n").t,e=window.localStorage.getItem(n.LOCAL_ITEM_IDS.SPATIALBOOKMARKS.id),p=e?JSON.parse(e):void 0,a.default={name:"spatial-bookmarks",components:{InputText:s.default},data:function(){var e=i.default.project;return void 0===p[e.getId()]&&(p[e.getId()]=[]),{showaddform:!1,project:{bookmarks:e.state.bookmarks||[]},user:{bookmarks:p[e.getId()]},addbookmarkinput:{name:"add-bookmark",label:d("sdk.spatialbookmarks.input.name"),i18nLabel:!0,value:null,editable:!0,type:"varchar",input:{type:"text",options:{}},visible:!0,validate:{valid:!1,required:!0}}}},computed:{is_staff:function(){return window.initConfig.user.is_staff},lang:function(){return i.default.language}},methods:{addBookMark:function(){this.user.bookmarks.push({id:(0,l.getUniqueDomId)(),name:this.addbookmarkinput.value,extent:r.default.getService("map").getMapExtent(),removable:!0,crs:{epsg:+r.default.getService("map").getCrs().split("EPSG:")[1]}}),this.saveUserBookMarks(),this.showaddform=!1},removeBookMark:function(t){this.user.bookmarks=this.user.bookmarks.filter(function(e){return t!==e.id}),this.saveUserBookMarks()},saveUserBookMarks:function(){p[i.default.project.getId()]=this.user.bookmarks;try{window.localStorage.setItem(n.LOCAL_ITEM_IDS.SPATIALBOOKMARKS.id,JSON.stringify(p))}catch(e){}},showAddForm:function(){this.addbookmarkinput.value=null,this.showaddform=!0},gotoSpatialBookmark:(c=g(function*(e){var t=e.extent,e=e.crs;e.epsg!==r.default.getService("map").getEpsg().split("EPSG:")[1]&&(e=yield o.default.registerProjection("EPSG:"+e.epsg),t=ol.proj.transformExtent(t,e,r.default.getService("map").getProjection())),r.default.getService("map").zoomToExtent(t,{force:!0})}),function(e){return c.apply(this,arguments)})},watch:{showaddform:(u=g(function*(e){if(e){yield this.$nextTick();for(var t=0;t<this.$refs.add_bookmark_input.$el.children.length;t++)this.$refs.add_bookmark_input.$el.children[t].classList.remove("col-sm-12")}}),function(e){return u.apply(this,arguments)})},created:function(){var e=this;this.$on("close",function(){return e.showaddform=!1})}},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var a=this,e=a.$createElement,n=a._self._c||e;return n("ul",{staticClass:"treeview-menu g3w-spatial-bookmarks menu-items",class:{"g3w-tools":!a.showaddform},attrs:{id:"g3w-spatial-bookmarks"}},[a.showaddform?n("li",[n("div",{staticStyle:{display:"flex","justify-content":"end"}},[n("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:left.create",value:"close",expression:"'close'",arg:"left",modifiers:{create:!0}}],staticClass:"sidebar-button sidebar-button-icon",class:a.g3wtemplate.getFontClass("close"),staticStyle:{padding:"5px",margin:"3px"},on:{click:function(e){e.stopPropagation(),a.showaddform=!1}}})]),a._v(" "),n("helpdiv",{attrs:{message:"sdk.spatialbookmarks.helptext"}}),a._v(" "),n("div",{staticClass:"container add-bookmark-input",staticStyle:{padding:"5px",width:"100%"}},[n("input-text",{ref:"add_bookmark_input",attrs:{state:a.addbookmarkinput}})],1),a._v(" "),n("div",{staticStyle:{"margin-top":"5px"}},[n("button",{directives:[{name:"t",rawName:"v-t",value:"add",expression:"'add'"},{name:"disabled",rawName:"v-disabled",value:!a.addbookmarkinput.validate.valid,expression:"!addbookmarkinput.validate.valid"}],staticClass:"sidebar-button-run btn btn-block",on:{click:function(e){return e.stopPropagation(),a.addBookMark(e)}}})])],1):[a.is_staff?n("div",{staticClass:"content-bookmarks"},[n("span",{directives:[{name:"t",rawName:"v-t",value:"sdk.spatialbookmarks.sections.project.title",expression:"'sdk.spatialbookmarks.sections.project.title'"}]}),a._v(" "),n("a",{staticStyle:{float:"right"},attrs:{href:"https://docs.qgis.org/3.34/"+a.lang+"/docs/user_manual/map_views/map_view.html#bookmarking-extents-on-the-map",target:"_blank",title:"QGIS Docs"}},[n("i",{class:a.g3wtemplate.getFontClass("external-link")})])]):a._e(),a._v(" "),a._l(a.project.bookmarks,function(t){return[t.nodes?n("li",[n("div",{staticStyle:{"font-weight":"bold",width:"100%"},style:{borderBottom:t.expanded?"2px solid #2c3b41":"none"},on:{click:function(e){e.stopPropagation(),t.expanded=!t.expanded}}},[n("span",{class:a.g3wtemplate.getFontClass(t.expanded?"caret-down":"caret-right"),staticStyle:{"margin-right":"5px"}}),a._v(" "),n("span",[a._v(a._s(t.name))])]),a._v(" "),n("ul",{directives:[{name:"show",rawName:"v-show",value:t.expanded,expression:"bookmark.expanded"}],staticStyle:{"margin-left":"10px"}},a._l(t.nodes,function(t){return n("li",{staticClass:"spatial-bookmark",on:{click:function(e){return e.stopPropagation(),a.gotoSpatialBookmark(t)}}},[n("div",[n("span",{class:a.g3wtemplate.getFontClass("bookmark"),staticStyle:{"margin-right":"5px","font-size":"0.7em"}}),a._v(" "),n("span",{staticClass:"g3w-long-text"},[a._v(a._s(t.name))])])])}),0)]):n("li",{staticClass:"spatial-bookmark",on:{click:function(e){return e.stopPropagation(),a.gotoSpatialBookmark(t)}}},[n("div",[n("span",{class:a.g3wtemplate.getFontClass("bookmark"),staticStyle:{"margin-right":"5px","font-size":"0.7em"}}),a._v(" "),n("span",{staticClass:"g3w-long-text"},[a._v(a._s(t.name))])])])]}),a._v(" "),n("div",{staticClass:"content-bookmarks",staticStyle:{display:"flex","justify-content":"space-between","align-items":"center","margin-top":"10px"}},[n("span",{directives:[{name:"t",rawName:"v-t",value:"sdk.spatialbookmarks.sections.user.title",expression:"'sdk.spatialbookmarks.sections.user.title'"}]}),a._v(" "),n("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:left.create",value:"add",expression:"'add'",arg:"left",modifiers:{create:!0}}],staticClass:"sidebar-button sidebar-button-icon",class:a.g3wtemplate.getFontClass("plus"),staticStyle:{padding:"5px",cursor:"pointer"},on:{click:function(e){return e.stopPropagation(),a.showAddForm(e)}}})]),a._v(" "),a._l(a.user.bookmarks,function(t){return n("li",{staticClass:"spatial-bookmark",on:{click:function(e){return e.stopPropagation(),a.gotoSpatialBookmark(t)}}},[n("div",[n("span",{class:a.g3wtemplate.getFontClass("bookmark"),staticStyle:{"margin-right":"5px","font-size":"0.7em"}}),a._v(" "),n("span",{staticClass:"g3w-long-text"},[a._v(a._s(t.name))])]),a._v(" "),n("span",{staticClass:"sidebar-button sidebar-button-icon",staticStyle:{color:"red",margin:"5px",cursor:"pointer"},on:{click:function(e){return e.stopPropagation(),a.removeBookMark(t.id)}}},[n("i",{class:a.g3wtemplate.getFontClass("trash")})])])})]],2)},e.staticRenderFns=[]},{"components/InputText.vue":86,"g3w-constants":140,"g3w-i18n":143,"services/gui":188,"store/application":193,"store/projections":195,"utils/getUniqueDomId":232,"vueify/lib/insert-css":2}],120:[function(e,t,a){var n,i,r,o,s,u,c,l,d,p,f,g,h,y,m,v,_,b,w,x,k,S,E,L,T,C;e("vueify/lib/insert-css").insert("#open_attribute_table{margin-top:5px}#g3w-table-toolbar{margin:.755em 1ch 0 0;position:relative;bottom:3px;display:inline-flex;border:1px solid #d2d6de;background-color:#fff;float:left}\n.geometry[data-v-b4d834d0]{cursor:pointer}#noheaders[data-v-b4d834d0]{background-color:#fff;font-weight:700;margin-top:10px}input.form-control.column-search[data-v-b4d834d0]::placeholder{font-weight:400;font-style:italic}input.form-control.column-search[data-v-b4d834d0]{height:25px;min-width:40px;padding:2px}#open_attribute_table .action-button[data-v-b4d834d0]{padding:5px}#g3w-table-toolbar .action-button[data-v-b4d834d0]{padding:4px}#g3w-table-toolbar .action-button.toggled[data-v-b4d834d0]{color:#fff!important;background-color:var(--skin-color)}#layer_attribute_table[data-v-b4d834d0]{width:100%;user-select:none}#layer_attribute_table>tbody>tr[data-v-b4d834d0]:not(.selected):hover{background-color:rgba(255,255,0,.15)}label[for=attribute_table_select_all_rows][data-v-b4d834d0]{margin-bottom:0!important}\n#g3w-view-content .dataTables_filter{margin-left:auto;margin-right:1ch}#g3w-view-content .dataTables_info{padding-left:.5ch;font-weight:lighter}#open_attribute_table .paginate_button{background:transparent;color:currentColor!important;box-shadow:none}#open_attribute_table .paginate_button.disabled{opacity:.25}#open_attribute_table #layer_attribute_table_length{padding-top:.755em}");function M(e){return e&&e.__esModule?e:{default:e}}function P(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}function O(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function I(e){return{id:e.id,feature:{attributes:e.attributes||e.properties,geometry:e.geometry&&(0,p.coordinatesToGeometry)(e.geometry.type,e.geometry.coordinates)}}}Object.defineProperty(a,"__esModule",{value:!0}),n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},i=e("g3w-constants"),r=M(e("g3w-component")),o=M(e("store/application")),s=M(e("components/FieldG3W.vue")),u=M(e("services/gui")),c=M(e("services/data")),l=e("mixins"),d=e("utils/debounce"),p=e("utils/coordinatesToGeometry"),f=e("utils/getUniqueDomId"),g=e("utils/promisify"),h=e("utils/getCatalogLayerById"),T=e("g3w-i18n").t,C=[10,25,50,100],a.default={name:"G3WTable",mixins:[l.resizeMixin],components:{Field:s.default},data:function(){var a=(0,h.getCatalogLayerById)(this.$options.layerId);return{layer:a,state:{features:[],headers:[null].concat(O(a.getTableHeaders())),geometry:!0,allfeatures:0,selectAll:!1,nofilteredrow:!1,show_tools:!1,geolayer:{active:!1,in_bbox:void 0}},relations:(a.isGeoLayer()?[]:a.getRelations().getArray()).map(function(e){return[e,(0,h.getCatalogLayerById)(e.getFather())]}).filter(function(e){var e=n(e,2),t=e[0],e=e[1];return a.getId()!==t.getFather()&&e.isGeoLayer()}).map(function(e){var e=n(e,2),t=e[0];return{layer:e[1],father_fields:t.getFatherField(),fields:t.getChildField(),features:{}}}),filter:[],has_map:!0,async_highlight:function(){},getAll:!1,search:{},firstCall:!0,map_bbox:{key:null,cb:null},disableSelectAll:!1}},computed:{has_features:function(){return!!this.state.features.length},current_layout:function(){return o.default.gui.layout[o.default.gui.layout.__current]}},methods:{editFeature:function(e){$(".tooltip").remove(),u.default.getService("queryresults").editFeature({layer:{id:this.layer.getId()},feature:e})},openForm:(L=P(function*(e){$(".tooltip").remove();try{yield(0,g.promisify)(c.default.getData("search:fids",{inputs:{layer:this.layer,fids:[e.id],formatter:1}})),e.geometry&&u.default.getService("map").zoomToGeometry((0,p.coordinatesToGeometry)(e.geometry.type,e.geometry.coordinates))}catch(e){}}),function(e){return L.apply(this,arguments)}),get_check_id:function(e){return e&&(this.get_check_id.cached_id=(0,f.getUniqueDomId)()),this.get_check_id.cached_id},getDataFromBBOX:(E=P(function*(){var e=this,t=u.default.getService("map"),a=(this.state.geolayer.active=!this.state.geolayer.active,this.state.geolayer.active);a&&(this.map_bbox.cb=function(){e.state.geolayer.in_bbox=e.state.geolayer.active?t.getMapBBOX().join(","):void 0,$(e.$refs.attribute_table).DataTable().ajax.reload()}),a&&(this.map_bbox.key=t.getMap().on("moveend",this.map_bbox.cb)),this.map_bbox.cb&&this.map_bbox.cb(),a||(ol.Observable.unByKey(this.map_bbox.key),this.map_bbox.key=null,this.map_bbox.cb=null)}),function(){return E.apply(this,arguments)}),checkSelectAll:function(){this.state.selectAll=this.layer.getSelectionFids().has(i.SELECTION.ALL)||this.state.features.every(function(e){return e.selected})},inverseSelection:(S=P(function*(){this.getAll||(yield this.getFeatures()),this.state.features.forEach(function(e){return e.selected=!e.selected}),this.layer.invertSelectionFids(),this.checkSelectAll()}),function(){return S.apply(this,arguments)}),selectAllRows:(k=P(function*(){var t=this,e=(this.state.selectAll=!this.state.selectAll,0<this.filter.length);e||(this.getAll||(yield this.getFeatures()),this.state.features.forEach(function(e){return e.selected=t.state.selectAll}),yield this.layer[this.state.selectAll?"setSelectionFidsAll":"clearSelectionFids"]()),e&&(this.state.selectAll?this.state.features.filter(function(e){return t.filter.includes(e.id)}).forEach(function(e){e.selected=!0,t.layer.includeSelectionFid(e.id)}):(this.state.features.forEach(function(e){return e.selected=!1}),this.layer.clearSelectionFids())),this.state.show_tools=this.state.features.some(function(e){return e.selected})}),function(){return k.apply(this,arguments)}),highlight:(x=P(function*(i){var n,r,o=this,s=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],l=u.default.getService("map");return i&&i.geometry?(this.async_highlight=function(){l.clearHighlightGeometry(),l.highlightGeometry(i.geometry,{zoom:s,duration:1/0})},i.geometry&&this.has_map?this.async_highlight():void(i.geometry||!i.geometry&&0<!this.relations.length||(n=[],r=[],(yield Promise.allSettled(this.relations.flatMap(function(e){var t=e.layer,a=e.father_fields,n=e.fields.map(function(e){return i.attributes[e]});return r.push(n),s?c.default.getData("search:features",{inputs:{layer:t,formatter:1,filter:a.map(function(e,t){return e+"|eq|"+encodeURIComponent(n[t])}).join("|AND,")},outputs:!1}):[]}))).forEach(function(e,t){var a;"fulfilled"===e.status&&(a=o.relations[t],t=r[t].join("__"),e=e.value&&e.value.data[0],void 0===a.features[t]&&(a.features[t]=e&&e.features||[]),n.push.apply(n,O(a.features[t]))),s?l.zoomToFeatures(n,{highlight:!0}):l.highlightFeatures(n)})))):l.clearHighlightGeometry()}),function(e){return x.apply(this,arguments)}),select:function(e){e.selected=!e.selected,this.state.selectAll=this.state.features.every(function(e){return e.selected}),this.layer[e.selected?"includeSelectionFid":"excludeSelectionFid"](e.id),this.state.show_tools=0<this.layer.getSelectionFids().size},resize:(w=P(function*(){yield this.$nextTick();var e=this.$el.querySelector("div.dataTables_scrollBody");e&&(e.style.height=u.default.isMobile()?"100%":((document.querySelector(".content")||{}).clientHeight||0)-((this.$el.querySelector("div.dataTables_scrollHeadInner")||{}).clientHeight||0)-100+"px"),$(this.$refs.attribute_table).DataTable().columns.adjust()}),function(){return w.apply(this,arguments)}),getFeatures:(b=P(function*(e){var t=this;try{u.default.setLoadingContent(!0);var a,n=yield(0,g.promisify)(this.layer.getDataTable(e||{})),i=this.layer.isGeoLayer()&&n.features;if(i&&!e&&(a=this.state.features.map(function(e){return e.id}),n.features.filter(function(e){return e.geometry&&!a.includes(e.id)}).forEach(function(e){return t.layer.addOlSelectionFeature(I(e))}),this.getAll=!0),i)return n.features}catch(e){return Promise.reject()}finally{u.default.setLoadingContent(!1)}}),function(e){return b.apply(this,arguments)}),getData:(_=P(function*(){var a=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.start,t=void 0===t?0:t,n=e.order,n=void 0===n?[]:n,i=e.length,i=void 0===i?this.layer.getAttributeTablePageLength()||C[1]:i,r=e.columns,r=void 0===r?[]:r,e=e.search,e=void 0===e?{value:null}:e;if(u.default.setLoadingContent(!0),this.layer.setAttributeTablePageLength(i),0===this.state.headers.length)return{data:[],recordsTotal:0,recordsFiltered:0};this.state.features.splice(0),0===n.length&&n.push({column:1,dir:"asc"}),this.search={field:r.filter(function(e){return e.search&&e.search.value}).map(function(e){return e.name+"|ilike|"+e.search.value+"|and"}).join(",")||void 0,page:0===t||this.layer.state.filter.active?1:t/i+1,page_size:i,search:e.value&&0<e.value.length?e.value:null,in_bbox:this.state.geolayer.in_bbox,ordering:("asc"===n[0].dir?"":"-")+this.state.headers[n[0].column].name,formatter:1};try{var o,s=yield(0,g.promisify)(this.layer.getDataTable(this.search));return this.state.allfeatures=s.count,this.state.featurescount=(s.features||[]).length,(o=this.state.features).push.apply(o,O((s.features||[]).map(function(e){return a.layer.isGeoLayer()&&e.geometry&&!a.layer.getOlSelectionFeature(e.id)&&a.layer.addOlSelectionFeature(I(e)),{id:e.id,selected:a.layer.hasSelectionFid(e.id),attributes:e.attributes||e.properties,geometry:a.layer.isGeoLayer()&&e.geometry||void 0}}))),this.state.show_tools=this.layer.state.filter.active||0<this.layer.getSelectionFids().size,this.state.selectAll=this.layer.state.filter.active||this.state.features.every(function(e){return e.selected}),{data:this.state.features.map(function(t){return[null].concat(a.state.headers.filter(function(e){return e}).map(function(e){return e.value=(t.attributes||t.properties)[e.name],e.value}))}),recordsFiltered:s.count,recordsTotal:s.count,filter:this.state.features.map(function(e){return e.id})}}catch(e){return u.default.notify.error(T("info.server_error")),Promise.reject(e)}finally{u.default.setLoadingContent(!1)}}),function(){return _.apply(this,arguments)}),unSelectAll:function(){this.state.features.forEach(function(e){return e.selected=!1}),this.state.show_tools=!1,this.state.selectAll=!1},onGUIContent:function(){this.has_map=100!==(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).perc},filterChangeHandler:function(){$(this.$refs.attribute_table).DataTable().ajax.reload()}},beforeCreate:function(){this.delayType="debounce"},created:(v=P(function*(){this.unSelectAll=this.unSelectAll.bind(this),this.onGUIContent=this.onGUIContent.bind(this),u.default.onbefore("setContent",this.onGUIContent),this.layer.on("unselectionall",this.unSelectAll),this.layer.on("filtertokenchange",this.filterChangeHandler),u.default.closeSideBar(),this.current_layout.rightpanel.height=55,u.default.showContent({content:new r.default({id:"openattributetable",service:{state:this.state},internalComponent:this}),split:u.default.isMobile()?"h":"v",push:!1,title:this.layer.getTitle(),text:!0}),this.isMobile()&&u.default.hideSidebar()}),function(){return v.apply(this,arguments)}),mounted:(m=P(function*(){var a,n,i=this,r=(this.last_map_control=u.default.getService("map").getMapControls().find(function(e){return e.control.isToggled&&e.control.isToggled()}),this.last_map_control&&this.last_map_control.control.toggle(),this.setContentKey=u.default.onafter("setContent",this.resize),yield this.$nextTick(),void 0),o={},s=$(this.$refs.attribute_table).DataTable({ajax:(0,d.debounce)((a=P(function*(e,t){try{u.default.disableContent(!0);var a=yield i.getData(e);t(a),i.disableSelectAll=0===i.state.features.length,r&&r(a.filter),yield i.$nextTick(),s.columns.adjust()}catch(e){}u.default.disableContent(!1)}),function(e,t){return a.apply(this,arguments)}),800),bSortCellsTop:!0,columns:this.state.headers,columnDefs:[{orderable:!1,searchable:!1,targets:0,width:"1%"}],deferLoading:this.state.allfeatures,dom:'frt<"#g3w-table-toolbar">lip',lengthMenu:C,order:[1,"asc"],pageLength:this.layer.getAttributeTablePageLength()||C[1],processing:!1,responsive:!0,scrollCollapse:!0,scrollX:!0,serverSide:!0,sSearch:!1}),e=(this.changeColumn=(0,d.debounce)((n=P(function*(e,t){var a=e.target.value.trim();s.one("draw",P(function*(){o[t]=a,i.disableSelectAll=0===i.state.features.length,i.filter=Object.values(o).find(function(e){return e})?yield new Promise(function(e){return r=e}):[]})),s.columns(t).search(a).draw()}),function(e,t){return n.apply(this,arguments)})),document.createDocumentFragment());e.appendChild(this.$refs.table_toolbar),document.getElementById("g3w-table-toolbar").appendChild(e),document.querySelector("#g3w-view-content .g3-content-header-action-tools").insertAdjacentElement("beforebegin",document.querySelector(".dataTables_info")),document.querySelector("#g3w-view-content .g3-content-header-action-tools").insertAdjacentElement("beforebegin",document.querySelector(".dataTables_filter")),document.getElementById("table_body_attributes").remove(),s.ajax.reload()}),function(){return m.apply(this,arguments)}),beforeDestroy:(y=P(function*(){var e=this;this.last_map_control&&!this.last_map_control.control.isToggled()&&this.last_map_control.control.toggle(),this.last_map_control=null,this.layer.off("unselectionall",this.unSelectAll),this.layer.off("filtertokenchange",this.filterChangeHandler),ol.Observable.unByKey(this.map_bbox.key),this.map_bbox.key=null,this.map_bbox.cb=null,this.highlight(),this.has_map||setTimeout(function(){e.async_highlight(),e.has_map=!0,e.async_highlight=function(){}}),u.default.un("setContent",this.setContentKey),document.querySelector("#g3w-view-content .dataTables_info").remove(),document.querySelector("#g3w-view-content .dataTables_filter").remove(),$(this.$refs.attribute_table).DataTable().destroy(!0)}),function(){return y.apply(this,arguments)})},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var n=this,e=n.$createElement,i=n._self._c||e;return i("div",{attrs:{id:"open_attribute_table"}},[i("div",{ref:"table_toolbar",staticStyle:{display:"flex","justify-content":"space-between",padding:"1px"}},[n.layer.isGeoLayer()?i("div",{directives:[{name:"disabled",rawName:"v-disabled",value:n.state.geolayer.active&&n.current_layout.rightpanel.height_100,expression:"state.geolayer.active && current_layout.rightpanel.height_100"},{name:"t-tooltip",rawName:"v-t-tooltip.create",value:"layer_selection_filter.tools.show_features_on_map",expression:"'layer_selection_filter.tools.show_features_on_map'",modifiers:{create:!0}}],staticClass:"skin-color action-button skin-tooltip-right",class:[n.g3wtemplate.getFontClass("map"),n.state.geolayer.active?"toggled":""],attrs:{"data-placement":"right"},on:{click:function(e){return e.stopPropagation(),n.getDataFromBBOX(e)}}}):n._e(),n._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:n.state.show_tools,expression:"state.show_tools"},{name:"t-tooltip",rawName:"v-t-tooltip.create",value:"layer_selection_filter.tools.clear",expression:"'layer_selection_filter.tools.clear'",modifiers:{create:!0}}],staticClass:"skin-color action-button skin-tooltip-right",class:n.g3wtemplate.getFontClass("clear"),attrs:{"data-placement":"right"},on:{click:function(e){return e.stopPropagation(),n.layer.clearSelectionFids()}}}),n._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:n.state.show_tools,expression:"state.show_tools"},{name:"t-tooltip",rawName:"v-t-tooltip.create",value:"layer_selection_filter.tools.invert",expression:"'layer_selection_filter.tools.invert'",modifiers:{create:!0}}],staticClass:"skin-color action-button skin-tooltip-right",class:[n.g3wtemplate.getFontClass("invert"),n.layer.state.filter.active?"g3w-disabled":""],attrs:{"data-placement":"right"},on:{click:function(e){return e.stopPropagation(),n.inverseSelection(e)}}}),n._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:n.state.show_tools,expression:"state.show_tools"},{name:"t-tooltip",rawName:"v-t-tooltip.create",value:"layer_selection_filter.tools.filter",expression:"'layer_selection_filter.tools.filter'",modifiers:{create:!0}}],staticClass:"skin-color action-button skin-tooltip-right",class:[n.g3wtemplate.getFontClass("filter"),n.layer.state.filter.active?"toggled":""],attrs:{"data-placement":"right"},on:{click:function(e){return e.stopPropagation(),n.layer.toggleFilterToken()}}})]),n._v(" "),n.state.headers.length?i("table",{ref:"attribute_table",staticClass:"table table-striped row-border compact nowrap",attrs:{id:"layer_attribute_table"}},[i("thead",[i("tr",[i("th"),n._v(" "),n._l(n.state.headers,function(e,t){return 0<t?i("th",[n._v(n._s(e.label))]):n._e()})],2),n._v(" "),i("tr",[i("th",{directives:[{name:"disabled",rawName:"v-disabled",value:n.disableSelectAll,expression:"disableSelectAll"}]},[i("input",{staticClass:"magic-checkbox",attrs:{type:"checkbox",id:"attribute_table_select_all_rows"},domProps:{checked:n.state.selectAll}}),n._v(" "),i("label",{attrs:{for:"attribute_table_select_all_rows"},on:{"!click":function(e){return e.stopPropagation(),e.preventDefault(),n.selectAllRows(e)}}},[n._v(" ")])]),n._v(" "),n._l(n.state.headers,function(e,t){return 0<t?i("th",[i("input",{staticClass:"form-control column-search",attrs:{type:"text",placeholder:e.name,title:"search by "+e.name},on:{keyup:function(e){return n.changeColumn(e,t)}}})]):n._e()})],2)]),n._v(" "),i("tbody",{attrs:{id:"table_body_attributes",hidden:""}}),n._v(" "),i("tbody",{ref:"table_body",on:{mouseleave:function(e){return n.highlight()}}},n._l(n.state.features,function(a,e){return i("tr",{key:a.id,class:[e%2==1?"odd":"pair","feature_attribute",{geometry:!!a.geometry},{selected:a.selected}],attrs:{role:"row"},on:{mouseover:function(e){return n.highlight(a,!1)},click:function(e){return e.stopPropagation(),n.highlight(a,!0)}}},[i("td",[i("div",{staticStyle:{display:"flex"}},[i("input",{staticClass:"magic-checkbox",attrs:{type:"checkbox",id:n.get_check_id(!0)},domProps:{checked:a.selected}}),n._v(" "),i("label",{attrs:{for:n.get_check_id(!1)},on:{"!click":function(e){return e.stopPropagation(),e.preventDefault(),n.select(a)}}}),n._v(" "),i("i",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:top.create",value:"sdk.tooltips.relations.row_to_form",expression:"'sdk.tooltips.relations.row_to_form'",arg:"top",modifiers:{create:!0}}],class:"action-button skin-color "+n.g3wtemplate.getFontClass("table"),on:{click:function(e){return e.stopPropagation(),n.openForm(a)}}}),n._v(" "),a.geometry?n._e():i("i",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:top.create",value:"no_geometry",expression:"'no_geometry'",arg:"top",modifiers:{create:!0}}],class:"action-button "+n.g3wtemplate.getFontClass("alert"),staticStyle:{color:"currentColor !important"}}),n._v(" "),n.layer.isEditable()?i("i",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:top.create",value:"sdk.tooltips.editing",expression:"'sdk.tooltips.editing'",arg:"top",modifiers:{create:!0}}],class:"action-button skin-color "+n.g3wtemplate.getFontClass("pencil"),on:{click:function(e){return e.stopPropagation(),n.editFeature(a)}}}):n._e()])]),n._v(" "),n._l(n.state.headers,function(e,t){return 0<t?i("td",[i("field",{attrs:{feature:a,state:{label:void 0,value:a.attributes[e.name]}}})],1):n._e()})],2)}),0)]):i("div",{directives:[{name:"t",rawName:"v-t",value:"dataTable.no_data",expression:"'dataTable.no_data'"}],attrs:{id:"noheaders"}})])},e.staticRenderFns=[],e._scopeId="data-v-b4d834d0"},{"components/FieldG3W.vue":44,"g3w-component":139,"g3w-constants":140,"g3w-i18n":143,mixins:180,"services/data":187,"services/gui":188,"store/application":193,"utils/coordinatesToGeometry":204,"utils/debounce":213,"utils/getCatalogLayerById":218,"utils/getUniqueDomId":232,"utils/promisify":247,"vueify/lib/insert-css":2}],121:[function(e,t,a){var n,i;e("vueify/lib/insert-css").insert(".tool_disabled[data-v-31811884]{cursor:not-allowed}.tool_disabled>span[data-v-31811884]{color:#777}.tool_type[data-v-31811884]{cursor:pointer;vertical-align:center;position:absolute;right:0;top:0;padding:5px}");function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(a,"__esModule",{value:!0}),n=r(e("store/application")),i=r(e("services/gui")),a.default={name:"g3w-tool",props:["tool"],methods:{showToolStateMessage:function(){i.default.showModalDialog({title:this.tool.state.type.toUpperCase(),message:this.tool.state.message})}},computed:{disabled:function(){return!this.tool.offline&&!n.default.online||this.tool.loading||this.tool.disabled},sidebarOpen:function(){return n.default.gui.sidebar.open}}},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var r=this,e=r.$createElement,e=r._self._c||e;return e("div",["checkbox"===r.tool.type?e("div",{staticClass:"checkbox"},[e("label",[e("input",{directives:[{name:"model",rawName:"v-model",value:r.tool.isCheck,expression:"tool.isCheck"}],staticStyle:{cursor:"pointer"},attrs:{id:r.tool.layerName,type:"checkbox"},domProps:{value:r.tool.layerName,checked:Array.isArray(r.tool.isCheck)?-1<r._i(r.tool.isCheck,r.tool.layerName):r.tool.isCheck},on:{click:function(e){return r.tool.action(r.tool)},change:function(e){var t,a,n=r.tool.isCheck,e=e.target,i=!!e.checked;Array.isArray(n)?(t=r.tool.layerName,a=r._i(n,t),e.checked?a<0&&r.$set(r.tool,"isCheck",n.concat([t])):-1<a&&r.$set(r.tool,"isCheck",n.slice(0,a).concat(n.slice(a+1)))):r.$set(r.tool,"isCheck",i)}}}),r._v("\n      "+r._s(r.tool.name)+"\n    ")])]):e("div",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:r.sidebarOpen?null:r.tool.html&&r.tool.html.text||r.tool.name,expression:"sidebarOpen ? null : tool.html ?  tool.html.text || tool.name : tool.name",arg:"right",modifiers:{create:!0}}],staticClass:"tool",class:{tool_disabled:r.disabled},staticStyle:{position:"relative"},attrs:{"current-tooltip":r.sidebarOpen?null:r.tool.html&&r.tool.html.text||r.tool.name},on:{click:function(e){r.disabled||r.tool.action(r.tool)}}},[e("bar-loader",{attrs:{loading:r.tool.loading}}),r._v(" "),e("i",{class:r.g3wtemplate.getFontClass(r.tool.icon||"caret-right")}),r._v(" "),r.tool.html?e("span",{staticClass:"tool-label"},[e("i",{class:r.tool.html.icon}),r._v("\n    "+r._s(r.tool.html.text||r.tool.name)+"\n    ")]):e("span",{directives:[{name:"t",rawName:"v-t",value:r.tool.name,expression:"tool.name"}],staticClass:"tool-label"}),r._v(" "),r.tool.state.type?e("span",{staticClass:"tool_type",style:{color:{alert:"red",info:"blue",warning:"orange"}[r.tool.state.type]},on:{click:function(e){return e.stopPropagation(),r.showToolStateMessage(e)}}},[e("i",{class:r.g3wtemplate.getFontClass(r.tool.state.type)})]):r._e()],1)])},e.staticRenderFns=[],e._scopeId="data-v-31811884"},{"services/gui":188,"store/application":193,"vueify/lib/insert-css":2}],122:[function(e,t,a){var n,i,r,o;e("vueify/lib/insert-css").insert(".usermessage-content[data-v-57c4f706]{color:#fff;z-index:1000;position:absolute;line-height:normal;padding:3px;min-width:250px;box-shadow:0 3px 5px rgba(0,0,0,.3);border-radius:0 0 3px 3px}.usermessage-tool[data-v-57c4f706]{cursor:move;position:fixed}.usermessage-content.mobile[data-v-57c4f706]{padding:0;min-width:100%}.usermessage-header-content[data-v-57c4f706]{display:flex;align-items:baseline;justify-content:space-between;width:100%;border-bottom:2px solid #eee}.usermessage-header-icontype[data-v-57c4f706]{padding:10px 0 0 5px;font-weight:700;font-size:1.3em}.usermessage-content.mobile .usermessage-header-icontype[data-v-57c4f706]{padding:0 0 0 5px;font-size:1.1em}.usermessage-header-title[data-v-57c4f706],.usermessage-header-title h4[data-v-57c4f706]{font-weight:700;text-align:center}.usermessage-content.mobile .usermessage-header-title h4[data-v-57c4f706]{margin:0}.usermessage-header-subtitle[data-v-57c4f706]{font-weight:700;margin:5px}.usermessage-header-right[data-v-57c4f706]{padding:5px}.usermessage-header-right-item[data-v-57c4f706]{font-weight:700!important;font-size:1.2em;cursor:pointer}.usermessage-message[data-v-57c4f706]{width:100%;padding:10px;max-height:100px;font-size:1.1em;align-self:flex-start;overflow-y:auto}");function s(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},e=e("services/gui"),o=(e=e)&&e.__esModule?e:{default:e},a.default={name:"usermessage",props:{id:{},type:{type:String,default:"info"},title:{type:String,default:null},subtitle:{type:String,default:null},position:{type:String,default:"top"},size:{type:String,default:"fullpage"},message:{type:String,default:""},textMessage:{type:Boolean,default:!1},autoclose:{type:Boolean,default:!1},draggable:{type:Boolean,default:!1},duration:{type:Number,default:2e3},closable:{type:Boolean,default:!0},iconClass:{type:String,default:null}},data:function(){var e,t,a=this.position.split("-"),a=r(a,2),n=a[0],a=a[1];return{style:i({},"center"===n?{top:0,bottom:0,maxHeight:"20%"}:(t=50,(n=n)in(e={})?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e),{center:{left:0,right:0,margin:"auto"},right:{right:0}}[a]||{},{width:{small:"325px",medium:"50%",fullpage:"100%"}[a?"small":this.size]||"100%"},{success:{backgroundColor:"#62ac62",color:"#FFF"},info:{backgroundColor:"#44a0bb",color:"#FFF"},warning:{backgroundColor:"#f29e1d",color:"#FFF"},alert:{backgroundColor:"#c34943",color:"#FFF"},tool:{backgroundColor:"#FFF",color:"#222d32","z-index":100,marginLeft:document.body.classList.contains("sidebar-collapse")?"5px":"40px"},loading:{backgroundColor:"#FFF",color:"#222d32",fontWeight:"bold"}}[this.type])}},computed:{showheader:function(){return"loading"!==this.type}},methods:{addClassMobile:function(){return this.isMobile()&&!o.default.isSidebarVisible()},closeUserMessage:function(){this.$emit("close-usermessage")},hideShow:function(){}},created:function(){this.observe=null},mounted:(n=s(function*(){var t,a,n,i,r,e,o=this;function s(){document.removeEventListener("mouseup",s),document.removeEventListener("mousemove",l)}function l(e){e.preventDefault(),a=i-e.clientX,n=r-e.clientY,i=e.clientX,r=e.clientY,t.style.marginLeft&&(a-=parseInt(t.style.marginLeft),t.style.marginLeft=null),t.style.marginTop&&(n-=parseInt(t.style.marginTop),t.style.marginTop=null),t.style.top=t.offsetTop-n+"px",t.style.left=t.offsetLeft-a+"px"}"tool"===this.type&&(t=this.$refs.user_message,r=i=n=a=0,t.addEventListener("mousedown",function(t){[".select2-container","button","select","input","textarea"].some(function(e){return t.target.closest(e)})||(t.preventDefault(),i=t.clientX,r=t.clientY,document.addEventListener("mouseup",s),document.addEventListener("mousemove",l))}),this.observer=new MutationObserver(function(e){e.forEach(function(e){"class"===e.attributeName&&(o.style.marginLeft=e.target.classList.contains("sidebar-collapse")?"5px":"40px")})}),this.observer.observe(document.body,{attributes:!0})),this.autoclose&&(yield this.$nextTick(),e=setTimeout(function(){o.closeUserMessage(),clearTimeout(e)},this.duration))}),function(){return n.apply(this,arguments)}),beforeDestroy:function(){this.observer&&(this.observer.disconnect(),this.observer=null)}},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var e,t=this,a=t.$createElement,a=t._self._c||a;return a("div",{ref:"user_message",staticClass:"usermessage-content",class:((e={mobile:t.addClassMobile()})["usermessage-"+t.type]=!0,e),style:t.style,attrs:{id:t.id}},[t.showheader?a("div",{staticClass:"usermessage-header-content"},[a("i",{staticClass:"usermessage-header-icontype",class:t.g3wtemplate.getFontClass(t.iconClass||t.type)}),t._v(" "),a("div",{staticClass:"usermessage-header-title"},[t._t("header",[t.title?a("h4",{directives:[{name:"t",rawName:"v-t",value:t.title,expression:"title"}]}):a("h4",[t._v(" "+t._s(t.type.toUpperCase()))]),t._v(" "),t.subtitle?a("h5",{directives:[{name:"t",rawName:"v-t",value:t.subtitle,expression:"subtitle"}],staticClass:"usermessage-header-subtitle"}):t._e()])],2),t._v(" "),a("div",{staticClass:"usermessage-header-right"},[!t.autoclose&&t.closable?a("div",{on:{click:t.closeUserMessage}},[a("i",{staticClass:"usermessage-header-right-item",class:t.g3wtemplate.getFontClass("close")})]):t._e()])]):t._e(),t._v(" "),t._t("body",[t.textMessage?a("div",{staticClass:"usermessage-message"},[t._v(t._s(t.message))]):a("div",{directives:[{name:"t",rawName:"v-t",value:t.message,expression:"message"}],staticClass:"usermessage-message"})]),t._v(" "),t._t("footer")],2)},e.staticRenderFns=[],e._scopeId="data-v-57c4f706"},{"services/gui":188,"vueify/lib/insert-css":2}],123:[function(n,e,t){var i,a,r,f,g,o,s,l,u,c,d,p,h,y;n("vueify/lib/insert-css").insert(".g3w-add-wms-url-message[data-v-965f11b2]{font-weight:700;color:#000}.g3w-wmsurl-error[data-v-965f11b2]{background-color:red}.g3w-wmsurl-already-added[data-v-965f11b2]{color:inherit;font-weight:400;display:inline-block}#add_custom_url_wms_input[data-v-965f11b2]::placeholder{font-size:85%;opacity:.5}.wms_url_input_content input[data-v-965f11b2]{padding:1ch}.wms_url_input_content[data-v-965f11b2]{margin-bottom:5px}.wms-icon-action[data-v-965f11b2]{font-weight:700;font-size:1.3em;box-shadow:0 5px 10px #1e282c}.wms-icon-action[data-v-965f11b2]:hover{box-shadow:none}.new_wms_item[data-v-965f11b2]{display:flex;flex-direction:column;justify-content:space-between;background:transparent!important;margin-bottom:10px}");function m(e){return e&&e.__esModule?e:{default:e}}function v(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(t,"__esModule",{value:!0}),i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},a=m(n("g3w-panel")),_=m(n("store/application")),r=m(n("services/data")),f=m(n("services/gui")),g=n("utils/getUniqueDomId"),o=(e=>{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t})(n("components/WMSLayersPanel.vue")),h=_.default.project.getId(),y=void 0,t.default={name:"wms",data:function(){return{state:{adminwmsurls:this.$options.wmsurls||[],localwmsurls:[]},url:null,id:null,loading:!1,status:{error:!1,added:!1}}},computed:{inputswmsurlvalid:function(){return null!==this.url&&this.url.trim()&&this.url&&this.url.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,6}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g)&&null!==this.id&&this.id.trim()}},methods:{addNewUrl:(p=v(function*(t){var e=this.state.localwmsurls.find(function(e){return e.url==t.url||e.id==t.id}),a={error:!1,added:!!e};if(!e)try{var n=yield this.getWMSLayers(t.url);if(!n.result)throw"invalid response";var i=this.getLocalWMSData();this.state.localwmsurls.push(t),i.urls=this.state.localwmsurls,this.updateLocalWMSData(i),n.wmsurl=t.url,this._showWmsLayersPanel(n)}catch(e){a.error=!0}return a}),function(e){return p.apply(this,arguments)}),addwmsurl:(d=v(function*(){this.loading=!0;var e=yield this.addNewUrl({url:this.url,id:this.id}),t=e.error,e=e.added;this.status.error=t,this.status.added=e,this.loading=!1}),function(){return d.apply(this,arguments)}),deleteWmsUrl:function(t){this.state.localwmsurls=this.state.localwmsurls.filter(function(e){return t!==e.id});var e=this.getLocalWMSData();e.urls=this.state.localwmsurls,this.updateLocalWMSData(e)},_addExternalWMSLayer:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=e.url,r=e.layers,o=e.name,t=e.epsg,t=void 0===t?f.default.getService("map").getEpsg():t,a=e.position,s=void 0===a?"top":a,l=e.opacity,a=e.visible,u=void 0===a||a,c=f.default.getService("map"),d=n("map/layers/imagelayer").RasterLayer,p=ol.proj.get(t);return new Promise(function(e,t){var a=new d({id:o||(0,g.getUniqueDomId)(),layers:r,projection:p,url:i}),n=a.getOLLayer();n.getSource().once("imageloadend",e),n.getSource().once("imageloaderror",t),c.addExternalLayer(a,{position:s,opacity:l,visible:u})})},addWMSlayer:(c=v(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.url,a=e.name,a=void 0===a?"wms_"+(0,g.getUniqueDomId)():a,n=e.layers,n=void 0===n?[]:n,i=e.epsg,r=e.position,o=e.visible,o=void 0===o||o,e=e.opacity,e=void 0===e?1:e;try{var s=this.getLocalWMSData();if(y){var l=s.wms[y.internalPanel.url];if(y.internalPanel.added=l&&l.some(function(t){return t.layers.length===y.internalPanel.selectedlayers.length?y.internalPanel.selectedlayers.every(function(e){return t.layers.includes(e)}):void 0}),y.internalPanel.added)return;y.internalPanel.loading=!0}var u={url:t,name:a,layers:n,epsg:i,position:r,visible:o,opacity:e};void 0===s.wms[t]?s.wms[t]=[u]:s.wms[t].push(u),this.updateLocalWMSData(s);try{yield this._addExternalWMSLayer(u)}catch(e){f.default.getService("map").removeExternalLayer(a),this.deleteWms(a),setTimeout(function(){f.default.showUserMessage({type:"warning",message:"sidebar.wms.layer_add_error"})})}}catch(e){}y&&(y.internalPanel.clear(),y.close())}),function(){return c.apply(this,arguments)}),getWMSLayers:(u=v(function*(e){var t={result:!1,layers:[],info_formats:[],abstract:null,methods:[],map_formats:[],title:null};try{t=yield r.default.getData("ows:wmsCapabilities",{inputs:{url:e},outputs:!1})}catch(e){}return t}),function(e){return u.apply(this,arguments)}),_showWmsLayersPanel:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return(y=new a.default({service:this,id:(0,g.getUniqueDomId)(),title:"sidebar.wms.panel.title",internalPanel:new(Vue.extend(o))({service:this,config:e}),show:!0})).internalPanel.$on("add-wms-layer",this.addWMSlayer.bind(this)),y},showWmsLayersPanel:(l=v(function*(e){var t=!1;try{this.loading=!0;var a=yield this.getWMSLayers(e);(t=!a.result)||(a.wmsurl=e,this._showWmsLayersPanel(a))}catch(e){}finally{this.status.error=t,this.status.added=!1,this.loading=!1}}),function(e){return l.apply(this,arguments)}),deleteWms:function(a){var n=this.getLocalWMSData();Object.keys(n.wms).find(function(e){var t=n.wms[e].findIndex(function(e){return e.name==a});return-1!==t&&n.wms[e].splice(t,1),-1!==t&&0==n.wms[e].length&&delete n.wms[e],!0}),this.updateLocalWMSData(n)},clear:function(){y=null},changeLayerData:function(a){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=this.getLocalWMSData();Object.keys(i.wms).find(function(e){var t=i.wms[e].findIndex(function(e){return e.name==a});if(-1!==t)return i.wms[e][t][n.key]=n.value,!0}),this.updateLocalWMSData(i)},getLocalWMSData:function(){var e=window.localStorage.getItem("externalwms");return((e?JSON.parse(e):void 0)||{})[h]},updateLocalWMSData:function(e){var t=window.localStorage.getItem("externalwms"),t=(t?JSON.parse(t):void 0)||{};t[h]=e;try{window.localStorage.setItem("externalwms",JSON.stringify(t))}catch(e){}}},mounted:(s=v(function*(){var t,a=this,e=(g3wsdk.core.project.ProjectsRegistry.onafter("setCurrentProject",(t=v(function*(e){a.projectId=h=e.getId(),a.state.adminwmsurls=e.wmsurls||[]}),function(e){return t.apply(this,arguments)})),yield f.default.isReady(),f.default.getService("map")),n=(yield e.isReady(),this.deleteWms=this.deleteWms.bind(this),e.on("remove-external-layer",this.deleteWms),this.getLocalWMSData());void 0===n&&(n={urls:[],wms:{}},this.updateLocalWMSData(n)),setTimeout(function(){e.on("change-layer-position-map",function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.id;return a.changeLayerData(t,{key:"position",value:e.position})}),e.on("change-layer-opacity",function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.id;return a.changeLayerData(t,{key:"opacity",value:e.opacity})}),e.on("change-layer-visibility",function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.id;return a.changeLayerData(t,{key:"visible",value:e.visible})}),Object.keys(n.wms).forEach(function(t){n.wms[t].forEach(function(e){return a._addExternalWMSLayer(i({url:t},e))})})}),this.state.localwmsurls=n.urls}),function(){return s.apply(this,arguments)}),beforeDestroy:function(){f.default.getService("map").off("remove-external-layer",this.deleteWms)}},e.exports.__esModule&&(e.exports=e.exports.default);var _="function"==typeof e.exports?e.exports.options:e.exports;_.render=function(){var n=this,e=n.$createElement,i=n._self._c||e;return i("ul",{staticClass:"treeview-menu g3w-tools menu-items"},[n.loading?i("li",[i("bar-loader",{attrs:{loading:n.loading}})],1):n._e(),n._v(" "),i("li",{staticClass:"new_wms_item"},[i("div",{staticClass:"wms_url_input_content"},[n._m(0),n._v(" "),i("a",{staticStyle:{float:"right"},attrs:{href:"https://g3w-suite.readthedocs.io/en/v3.7.x/g3wsuite_client.html#wms",target:"_blank",title:"Docs"}},[i("i",{class:n.g3wtemplate.getFontClass("external-link")})]),n._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:n.url,expression:"url"}],staticClass:"form-control",staticStyle:{width:"100%",color:"#000000"},attrs:{id:"add_custom_url_wms_input",placeholder:"http://example.org/?&service=WMS&request=GetCapabilities"},domProps:{value:n.url},on:{input:function(e){e.target.composing||(n.url=e.target.value)}}})]),n._v(" "),i("div",{staticClass:"wms_url_input_content"},[i("label",{attrs:{for:"add_custom_name_url_wms_input",title:"required"}},[i("span",{directives:[{name:"t",rawName:"v-t",value:"sidebar.wms.panel.label.name",expression:"'sidebar.wms.panel.label.name'"}]}),n._v(" "),i("i",{staticStyle:{"font-family":"Monospace",color:"var(--skin-color)"}},[n._v("*")])]),n._v(" "),i("input",{directives:[{name:"model",rawName:"v-model",value:n.id,expression:"id"}],staticClass:"form-control",staticStyle:{width:"100%",color:"#000000"},attrs:{id:"add_custom_name_url_wms_input"},domProps:{value:n.id},on:{input:function(e){e.target.composing||(n.id=e.target.value)}}})]),n._v(" "),i("div",[i("button",{directives:[{name:"disabled",rawName:"v-disabled",value:!n.inputswmsurlvalid,expression:"!inputswmsurlvalid"}],staticClass:"btn btn-block skin-background-color",staticStyle:{width:"100%"},on:{click:function(e){return e.preventDefault(),e.stopPropagation(),n.addwmsurl(e)}}},[i("i",{class:n.g3wtemplate.getFontClass("plus-square")}),n._v(" "),i("span",{directives:[{name:"t",rawName:"v-t",value:"add",expression:"'add'"}]})])])]),n._v(" "),n.status.error?i("li",[i("div",{directives:[{name:"t",rawName:"v-t",value:"server_error",expression:"'server_error'"}],staticClass:"g3w-add-wms-url-message g3w-wmsurl-error"})]):n.status.added?i("li",[n._v("\n    ⚠️\n    "),i("div",{directives:[{name:"t",rawName:"v-t",value:"sidebar.wms.url_already_added",expression:"'sidebar.wms.url_already_added'"}],staticClass:"g3w-add-wms-url-message g3w-wmsurl-already-added"})]):n._e(),n._v(" "),i("li",{staticClass:"skin-border-color",staticStyle:{background:"transparent !important","border-top":"2px solid"}},[i("div",{staticStyle:{"max-height":"200px","overflow-y":"auto"}},[n._l(n.state.adminwmsurls,function(e){var t=e.id;return i("div",{key:n.wmsurl,staticStyle:{display:"flex","justify-content":"space-between","align-items":"center","border-bottom":"1px solid #ccc","padding-bottom":"3px"}},[i("span",{staticClass:"g3w-long-text",staticStyle:{"flex-grow":"1","margin-right":"15px"}},[n._v(n._s(t)+"\n        ")]),n._v(" "),i("span",{staticClass:"skin-color",staticStyle:{padding:"5px"},on:{click:function(e){return e.stopPropagation(),n.showWmsLayersPanel(t)}}},[i("i",{class:n.g3wtemplate.getFontClass("plus-square"),staticStyle:{"font-weight":"bold","font-size":"1.3em"}})])])}),n._v(" "),n._l(n.state.localwmsurls,function(e){var t=e.id,a=e.url;return i("div",{key:t,staticStyle:{"border-bottom":"1px solid #cccccc","padding-bottom":"3px"}},[i("div",{staticStyle:{display:"flex","justify-content":"space-between","align-items":"center","padding-top":"3px"}},[i("span",{staticClass:"g3w-long-text",staticStyle:{"flex-grow":"1","margin-right":"15px","font-weight":"bold"}},[n._v(n._s(t))]),n._v(" "),i("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:top.create",value:"sidebar.wms.add_wms_layer",expression:"'sidebar.wms.add_wms_layer'",arg:"top",modifiers:{create:!0}}],staticClass:"skin-color",staticStyle:{padding:"3px",margin:"2px"},on:{click:function(e){return e.stopPropagation(),n.showWmsLayersPanel(a)}}},[i("i",{staticClass:"wms-icon-action",class:n.g3wtemplate.getFontClass("plus-square")})]),n._v(" "),i("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:top.create",value:"sidebar.wms.delete_wms_url",expression:"'sidebar.wms.delete_wms_url'",arg:"top",modifiers:{create:!0}}],staticStyle:{color:"red",padding:"3px",margin:"2px"},on:{click:function(e){return e.stopPropagation(),n.deleteWmsUrl(t)}}},[i("i",{staticClass:"wms-icon-action",class:n.g3wtemplate.getFontClass("trash"),staticStyle:{color:"red"}})])]),n._v(" "),i("div",{staticClass:"g3w-long-text",staticStyle:{"font-size":"0.7em"},attrs:{title:a}},[n._v(n._s(a))])])})],2)])])},_.staticRenderFns=[function(){var e=this.$createElement,e=this._self._c||e;return e("label",{attrs:{for:"add_custom_url_wms_input",title:"required"}},[e("span",[this._v("URL")]),this._v(" "),e("i",{staticStyle:{"font-family":"Monospace",color:"var(--skin-color)"}},[this._v("*")])])}],_._scopeId="data-v-965f11b2"},{"components/WMSLayersPanel.vue":124,"g3w-panel":145,"map/layers/imagelayer":169,"services/data":187,"services/gui":188,"store/application":193,"utils/getUniqueDomId":232,"vueify/lib/insert-css":2}],124:[function(e,t,a){var n,i,o;e("vueify/lib/insert-css").insert(".g3w-wms-panel-title[data-v-64ebf92a]{font-size:1.2em;font-weight:700;margin-bottom:10px}button.wms-add-layer-button[data-v-64ebf92a]{width:100%;margin-top:10px}.g3w-wms-external-panel-layer-added-message[data-v-64ebf92a]{font-weight:700;color:red;margin:5px 0}");function r(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}Object.defineProperty(a,"__esModule",{value:!0}),e=e("store/projections"),o=(e=e)&&e.__esModule?e:{default:e},a.default={name:"wmpspanel",data:function(){return{loading:!1,position:void 0,name:void 0,title:null,abstract:null,map_formats:[],info_formats:[],methods:[],layers:[],selectedlayers:[],projections:[],epsg:null,added:!1}},methods:{clear:function(){this.selectedlayers=[],this.name=null,this.loading=!1},getLayersByEpsg:function(t){var a=this;return null===t?this.$options.config.layers:this.layers.filter(function(e){e=e.name;return a.layerProjections[e].crss.includes(t)})},getProjectionsByName:function(t){var a=this;return this.projections.filter(function(e){return a.layerProjections[t].crss.includes(e)})}},watch:{selectedlayers:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];0===e.length?(this.epsg=null,this.projections=[]):1===e.length?(this.epsg=this.layerProjections[e[0]].crss[0],this.projections=this.layerProjections[e[0]].crss):this.projections=this.getProjectionsByName(e[e.length-1])},epsg:(i=r(function*(){yield this.$nextTick(),this.layers=this.getLayersByEpsg(this.epsg)}),function(){return i.apply(this,arguments)})},created:(n=r(function*(){var n=this,t=this.$options.config,e=t.layers,a=t.title,i=t.abstract,r=t.methods,t=t.wmsurl;try{this.url=r.GetMap.urls.find(function(e){return"Get"===e.type}).url}catch(e){this.url=t}this.title=a,this.abstract=i,this.layerProjections={},e.forEach(function(e){var t=e.name,a=e.crss;n.layerProjections[t]={title:e.title,crss:a.map(function(e){return o.default.get(e),"EPSG:"+e.epsg}).sort()}}),this.layers=e}),function(){return n.apply(this,arguments)}),beforeDestroy:function(){this.$data=null}},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{directives:[{name:"disabled",rawName:"v-disabled",value:t.loading,expression:"loading"}]},[a("bar-loader",{attrs:{loading:t.loading}}),t._v(" "),a("h3",{staticClass:"skin-color g3w-wms-panel-title"},[t._v(t._s(t.title))]),t._v(" "),t.abstract?a("helpdiv",{attrs:{message:t.abstract}}):t._e(),t._v(" "),a("label",{directives:[{name:"t",rawName:"v-t",value:"sidebar.wms.panel.label.layers",expression:"'sidebar.wms.panel.label.layers'"}],attrs:{for:"g3w-wms-layers"}}),t._v(" "),a("select",{directives:[{name:"select2",rawName:"v-select2",value:"selectedlayers",expression:"'selectedlayers'"}],attrs:{id:"g3w-wms-layers",multiple:!0,clear:!0}},t._l(t.layers,function(e){return a("option",{key:e.name,domProps:{value:e.name}},[t._v(t._s(e.title))])}),0),t._v(" "),a("label",{directives:[{name:"t",rawName:"v-t",value:"sidebar.wms.panel.label.projections",expression:"'sidebar.wms.panel.label.projections'"}],attrs:{for:"g3w-wms-projections"}}),t._v(" "),a("select",{directives:[{name:"select2",rawName:"v-select2",value:"epsg",expression:"'epsg'"}],attrs:{id:"g3w-wms-projections"}},t._l(t.projections,function(e){return a("option",{key:e,domProps:{value:e}},[t._v(t._s(e))])}),0),t._v(" "),a("label",{directives:[{name:"t",rawName:"v-t",value:"sidebar.wms.panel.label.name",expression:"'sidebar.wms.panel.label.name'"}],attrs:{for:"g3w-wms-layer-name"}}),t._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:t.name,expression:"name"}],staticClass:"form-control",attrs:{id:"g3w-wms-layer-name"},domProps:{value:t.name},on:{input:function(e){e.target.composing||(t.name=e.target.value)}}}),t._v(" "),t.added?a("div",{directives:[{name:"t",rawName:"v-t",value:"sidebar.wms.layer_id_already_added",expression:"'sidebar.wms.layer_id_already_added'"}],staticClass:"g3w-wms-external-panel-layer-added-message"}):t._e(),t._v(" "),a("layerspositions",{attrs:{position:t.position},on:{"layer-position-change":function(e){t.position=e}}}),t._v(" "),a("button",{directives:[{name:"disabled",rawName:"v-disabled",value:0===t.selectedlayers.length,expression:"0 === selectedlayers.length"}],staticClass:"btn wms-add-layer-button sidebar-button skin-button",on:{click:function(e){e.stopPropagation(),t.$emit("add-wms-layer",{url:t.url,position:t.position,epsg:t.epsg,layers:t.selectedlayers,name:t.name&&t.name.trim()||void 0})}}},[a("i",{class:t.g3wtemplate.getFontClass("plus-square"),staticStyle:{"font-weight":"bold"}})])],1)},e.staticRenderFns=[],e._scopeId="data-v-64ebf92a"},{"store/projections":195,"vueify/lib/insert-css":2}],125:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.FormService=a.FormComponent=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},i=function(e,t,a){return t&&r(e.prototype,t),a&&r(e,a),e};function r(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,a){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);return void 0!==n?"value"in n?n.value:void 0!==(n=n.get)?n.call(a):void 0:null!==(n=Object.getPrototypeOf(e))?o(n,t,a):void 0}var s=g(e("g3w-object")),l=g(e("g3w-component")),u=g(e("services/gui")),c=(e=>{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t})(e("components/Form.vue")),d=g(e("components/FormBody.vue")),p=e("utils/getDefaultExpression"),f=e("utils/getFilterExpression");function g(e){return e&&e.__esModule?e:{default:e}}function h(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}function y(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function m(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function v(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function _(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}a.FormComponent=(_(b,l.default),i(b,[{key:"addFormComponents",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];this.getService().addComponents(e)}},{key:"addFormComponent",value:function(e){e&&this.getService().addComponent(e)}},{key:"layout",value:function(){this.getInternalComponent().reloadLayout()}},{key:"mount",value:function(e,t){return o(b.prototype.__proto__||Object.getPrototypeOf(b.prototype),"mount",this).call(this,e,t).then(function(){u.default.setModal(!0)})}}]),b);function b(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(m(this,b),v(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,n({},e,{id:e.id||"form",perc:null!==e.layer.getFormPercentage()?e.layer.getFormPercentage():e.perc,service:new(e.service||x),vueComponentObject:e.vueComponentObject||c})))),e=e.components||[{id:e.id,title:e.title,name:e.name,root:!0,component:d.default,headerComponent:e.headerComponent}];return t.getService().addComponents(e),t.getService().setComponent(e[0].component),t.onafter("mount",function(){return u.default.setModal(!0)}),t}var w,x=a.FormService=(_(k,s.default),i(k,[{key:"init",value:function(){this._setInitForm(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}},{key:"_setInitForm",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.fields,a=e.feature,n=e.parentData,i=e.layer,r=e.title,r=void 0===r?"Form":r,o=e.formId,s=e.name,l=e.buttons,l=void 0===l?{}:l,u=e.context_inputs,c=e.isnew,d=e.footer,d=void 0===d?{}:d,p=e.headerComponent;this.layer=i,this.feature=a.clone(),this.title=r,this.formId=o,this.name=s,this.buttons=l,this.context_inputs=u,this.parentData=n,this.headerComponent=p,this.state={layerid:i.getId(),loading:!1,components:[],disabledcomponents:[],component:null,headers:[],currentheaderid:null,fields:null,buttons:this.buttons,disabled:!1,isnew:c,valid:!0,update:a.isNew(),tovalidate:{},feature:this.feature,componentstovalidate:{},footer:d,ready:!1},this.force.update=a.isNew(),this.filter_expression_fields_dependencies={},this.default_expression_fields_dependencies={},this.default_expression_fields_on_update=[],this.listenChangeInput=!0,this.setFormFields(t),this.layer&&e.formStructure&&this.setFormStructure(this.layer.getLayerEditingFormStructure())}},{key:"setReady",value:function(){this.state.ready=0<arguments.length&&void 0!==arguments[0]&&arguments[0]}},{key:"changeInput",value:function(e){this.feature.set(e.name,e.value),!0===this.listenChangeInput&&(this.evaluateFilterExpressionFields(e),this.evaluateDefaultExpressionFields(e),this.isValid(e),this.isUpdated(e))}},{key:"isUpdated",value:function(e){this.state.update=this.force.update||(this.state.update?!!this.state.fields.find(function(e){return e.update}):e.update)}},{key:"setUpdate",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).force;this.force.update=void 0!==t&&t,this.state.update=this.force.update||e,!1===this.state.update&&this.state.fields.forEach(function(e){return e._value=e.value})}},{key:"evaluateDefaultExpressionFields",value:function(){var t=this,e=this.default_expression_fields_dependencies[(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).name];e&&e.forEach(function(e){(0,p.getDefaultExpression)({parentData:t.parentData,qgs_layer_id:t.layer.getId(),field:t._getField(e),feature:t.feature})})}},{key:"evaluateFilterExpressionFields",value:function(){var t=this,e=this.filter_expression_fields_dependencies[(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).name];e&&e.forEach(function(e){(0,f.getFilterExpression)({parentData:t.parentData,qgs_layer_id:t.layer.getId(),field:t._getField(e),feature:t.feature})})}},{key:"_handleFieldWithFilterExpression",value:function(t,e){var a,n,i=this;e&&(a=void 0===(a=e.referencing_fields)?[]:a,e=void 0===(e=e.referenced_columns)?[]:e,n=new Set,[].concat(y(e),y(a)).forEach(function(e){return n.add(e)}),n.forEach(function(e){void 0===i.filter_expression_fields_dependencies[e]&&(i.filter_expression_fields_dependencies[e]=[]),i.filter_expression_fields_dependencies[e].push(t.name)}),(0,f.getFilterExpression)({parentData:this.parentData,qgs_layer_id:this.layer.getId(),feature:this.feature,field:t}))}},{key:"_handleFieldWithDefaultExpression",value:function(t,e){var a,n,i,r=this;e&&(a=void 0===(a=e.referencing_fields)?[]:a,n=void 0===(n=e.referenced_columns)?[]:n,(e=void 0!==(e=e.apply_on_update)&&e)||this.state.isnew)&&(i=new Set,[].concat(y(n),y(a)).forEach(function(e){return i.add(e)}),e&&(this.default_expression_fields_on_update.push(t),i.forEach(function(e){void 0===r.default_expression_fields_dependencies[e]&&(r.default_expression_fields_dependencies[e]=[]),r.default_expression_fields_dependencies[e].push(t.name)})),this.state.isnew)&&(0,p.getDefaultExpression)({field:t,feature:this.feature,qgs_layer_id:this.layer.getId(),parentData:this.parentData})}},{key:"handleFieldsWithExpression",value:function(){var a=this;(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(e){var t=e.input.options,t=void 0===t?{}:t;a._handleFieldWithFilterExpression(e,t.filter_expression),a._handleFieldWithDefaultExpression(e,t.default_expression)}),Object.keys(this.filter_expression_fields_dependencies).forEach(function(e){return a.evaluateFilterExpressionFields({name:e})})}},{key:"setCurrentFormPercentage",value:function(e){this.layer.setFormPercentage(e)}},{key:"setLoading",value:function(){this.state.loading=0<arguments.length&&void 0!==arguments[0]&&arguments[0]}},{key:"setValidComponent",value:function(e){var t=e.id;this.state.componentstovalidate[t]=e.valid,this.isValid()}},{key:"getValidComponent",value:function(e){return this.state.componentstovalidate[e]}},{key:"isValid",value:function(e){var t,a=this;if(e){if(!e.validate.mutually||e.validate.required||e.validate.empty||(e.validate._valid=e.validate.valid,e.validate.mutually_valid=e.validate.mutually.reduce(function(e,t){return e&&a.state.tovalidate[t].validate.empty},!0),e.validate.valid=e.validate.mutually_valid&&e.validate.valid),e.validate.mutually&&!e.validate.required&&e.validate.empty){e.value=null,e.validate.mutually_valid=!0,e.validate.valid=!0,e.validate._valid=!0;for(var n=[],i=e.validate.mutually.length;i--;){var r=e.validate.mutually[i];this.state.tovalidate[r].validate.empty||n.push(r)}n.length<2&&n.forEach(function(e){a.state.tovalidate[e].validate.mutually_valid=!0,a.state.tovalidate[e].validate.valid=!0,setTimeout(function(){a.state.tovalidate[e].validate.valid=a.state.tovalidate[e].validate._valid,a.state.valid=a.state.valid&&a.state.tovalidate[e].validate.valid})})}e.validate.mutually||e.validate.empty||!e.validate.min_field&&!e.validate.max_field||(t=e.validate.min_field||e.validate.max_field,e.validate.valid=e.validate.min_field?this.state.tovalidate[e.validate.min_field].validate.empty||+e.value>+this.state.tovalidate[e.validate.min_field].value:this.state.tovalidate[e.validate.max_field].validate.empty||+e.value<+this.state.tovalidate[e.validate.max_field].value,e.validate.valid&&(this.state.tovalidate[t].validate.valid=!0))}this.state.valid=Object.values(this.state.tovalidate).reduce(function(e,t){return e&&t.validate.valid},!0)&&Object.values(this.state.componentstovalidate).reduce(function(e,t){return e&&t},!0)}},{key:"addComponents",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=!0,a=!1,n=void 0;try{for(var i,r=e[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var o=i.value;this.addComponent(o)}}catch(e){a=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(a)throw n}}}},{key:"addComponent",value:function(e){var t,a,n,i,r,o,s;e&&(t=e.id,a=e.title,n=e.name,i=e.icon,o=e.headerComponent,s=void 0===(s=e.header)||s,void 0!==(r=e.valid)&&(this.state.componentstovalidate[t]=r,this.state.valid=this.state.valid&&r,this.eventBus.$emit("add-component-validate",{id:t,valid:r})),s&&(this.state.headers.push({title:a,name:n,id:t,icon:i,component:o}),this.state.currentheaderid=this.state.currentheaderid||t),this.state.components.push(e))}},{key:"replaceComponent",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.id,e=e.component;this.state.components.splice(this.state.components.findIndex(function(e){return t===e.id}),1,e)}},{key:"disableComponent",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.id;e.disabled?this.state.disabledcomponents.push(t):this.state.disabledcomponents=this.state.disabledcomponents.filter(function(e){return t!==e})}},{key:"setCurrentComponentById",value:function(t){if(!this.state.disabledcomponents.includes(t))return this.setIdHeader(t),this.state.component=this.state.components.find(function(e){return t===e.id}).component,this.state.component}},{key:"setRootComponent",value:function(){this.state.component=this.state.components.find(function(e){return e.root}).component}},{key:"getRootComponent",value:function(){return this.state.components.find(function(e){return e.root}).component}},{key:"isRootComponent",value:function(e){return e===this.getRootComponent()}},{key:"getComponentById",value:function(t){return this.state.components.find(function(e){return t===e.id})}},{key:"setComponent",value:function(e){this.state.component=e}},{key:"addedComponentTo",value:function(){this.state.addedcomponentto[0<arguments.length&&void 0!==arguments[0]?arguments[0]:"body"]=!0}},{key:"addToValidate",value:function(e){this.state.tovalidate[e.name]=e,this.state.ready&&this.isValid(e)}},{key:"removeToValidate",value:function(e){delete this.state.tovalidate[e.name],this.isValid()}},{key:"getState",value:function(){return this.state}},{key:"_setState",value:function(e){this.state=e}},{key:"getFields",value:function(){return this.state.fields}},{key:"_getField",value:function(t){return this.state.fields.find(function(e){return t===e.name})}},{key:"getEventBus",value:function(){return this.eventBus}},{key:"setIdHeader",value:function(e){this.state.currentheaderid=e}},{key:"getContext",value:function(){return this.context_inputs.context}},{key:"getSession",value:function(){return this.getContext().session}},{key:"getInputs",value:function(){return this.context_inputs.inputs}},{key:"handleRelation",value:function(e){e.relationId}},{key:"clearAll",value:function(){this.eventBus.$off("addtovalidate"),this.eventBus.$off("set-main-component"),this.eventBus.$off("set-loading-form"),this.eventBus.$off("component-validation"),this.eventBus.$off("disable-component")}},{key:"saveDefaultExpressionFieldsNotDependencies",value:(w=h(function*(){var i=this;if(0!==this.default_expression_fields_on_update.length){this.listenChangeInput=!1;for(var r=[],e=[],t=function*(a){for(var n=Object.keys(i.default_expression_fields_dependencies).filter(function(t){return i.default_expression_fields_on_update.find(function(e){return e.name===t})&&i.default_expression_fields_dependencies[t].find(function(e){return e===i.default_expression_fields_on_update[a].name})}),e=0;e<n.length;e++)yield*function*(t){if(void 0!==r.find(function(e){return n[t]===e}))return"continue";try{var e=yield(0,p.getDefaultExpression)({field:i._getField(n[t]),feature:i.feature,qgs_layer_id:i.layer.getId(),parentData:i.parentData});i.feature.set(n[t],e),r.push(n[t])}catch(e){}}(e)},a=0;a<this.default_expression_fields_on_update.length;a++)yield*t(a);this.default_expression_fields_on_update.forEach(function(t){void 0===r.find(function(e){return t.name===e})&&e.push((0,p.getDefaultExpression)({field:t,feature:i.feature,qgs_layer_id:i.layer.getId(),parentData:i.parentData}))});try{yield Promise.allSettled(e)}catch(e){}this.listenChangeInput=!0}}),function(){return w.apply(this,arguments)})}]),k);function k(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(m(this,k),v(this,(k.__proto__||Object.getPrototypeOf(k)).call(this,e)));return t.state=null,t.eventBus=new Vue,t.eventBus.$on("set-loading-form",function(){return t.state.loading=0<arguments.length&&void 0!==arguments[0]&&arguments[0]}),t.force={update:!1,valid:!1},t.layer,t.setters={setInitForm:function(){this._setInitForm(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})},setFormStructure:function(e){this.state.formstructure=e},setFormFields:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];this.state.fields=e,this.handleFieldsWithExpression(e)},setupFields:function(){},setFormData:function(){this.setFormFields(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[])},setField:function(e){},setState:function(e){this._setState(e)},addActionsForForm:function(e){},postRender:function(e){}},t}},{"components/Form.vue":51,"components/FormBody.vue":52,"g3w-component":139,"g3w-object":144,"services/gui":188,"utils/getDefaultExpression":221,"utils/getFilterExpression":222}],126:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});function n(){return i.apply(this,arguments)}var i,l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},u=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},g=(i=x(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.filter,a=e.feature_count,a=void 0===a?1e4:a,n=e.state,i=void 0===(i=e.queryUrl)?n.queryurl:i,e=void 0===(e=e.show)?"search"===n.type:e,r=(n.searching=!0,void 0),o=void 0;try{r=yield m.default.getData("search:features",{inputs:{layer:n.search_layers,filter:t||(0,v.createFilterFormInputs)({layer:n.search_layers,inputs:n.forminputs.filter(function(e){return-1===[null,void 0,g.SEARCH_ALLVALUE].indexOf(e.value)&&""!==e.value.toString().trim()})}),queryUrl:i,formatter:1,feature_count:a,raw:!1},outputs:e&&{title:n.title}}),e&&h.default.project.state.autozoom_query&&r&&r.data&&1===r.data.length&&y.default.getService("map").zoomToFeatures(r.data[0].features);var s,l,u,c=!e&&"search_1n"===n.type,d=c&&(r.data[0]||{}).features||[],p=d.length&&h.default.project.getRelationById(n.search_1n_relationid),f=p&&h.default.project.getLayerById(p.referencedLayer);c&&!d.length&&(y.default.outputDataPlace(Promise.resolve({data:[]})),o=[]),p&&(s=p.fieldRef,l=s.referencedField,u=s.referencingField,o=yield m.default.getData("search:features",{inputs:{layer:f,filter:(0,v.createFilterFormInputs)({layer:f,inputs:d.map(function(t){return{attribute:1===l.length?l[0]:l,logicop:"OR",operator:"eq",value:[].concat(k(new Set(1===u.length?d.map(function(e){return e.get(u[0])}):u.map(function(e){return t.get(e)}))))}})}),formatter:1,feature_count:a},outputs:{title:n.title}}))}catch(e){}return n.searching=!1,o||r}),a.SearchPanel=function(){var a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=1<arguments.length&&void 0!==arguments[1]&&arguments[1],o={loading:{},searching:!1,title:a.name,type:a.type||"search",queryurl:(a.options||{}).queryurl,search_endpoint:"api",search_1n_relationid:a.options.search_1n_relationid,search_layers:[(a.options||{}).querylayerid||(a.options||{}).layerid||null].concat(k((a.options||{}).otherquerylayerids||[])).map(function(e){return(0,b.getCatalogLayerById)(e)}),forminputs:((a.options||{}).filter||[]).map(function(e,t){return{id:e.id||(0,d.getUniqueDomId)(),type:e.input.type||"textfield",widget_type:e.input.widget_type,label:e.label,attribute:e.attribute,values:e.input.options.values||[],dvalues:{},dependance_strict:e.input.options.dependance_strict||!1,dependance:e.input.options.dependance||!1,value:"selectfield"===e.input.type?g.SEARCH_ALLVALUE:null,operator:e.op,logicop:t===a.options.filter.length-1?null:e.logicop,loading:!0,disabled:e.input.options.disabled||!1,options:e.input.options}})},t=(o.mounted=(()=>{var t=x(function*(e){for(var t=0;t<=e.forminputs.length-1;t++){var a=e.forminputs[t],n="autocompletefield"===a.type;a.values=[].concat(k("selectfield"===a.type?[g.SEARCH_ALLVALUE]:[]),k(a.dependance_strict||n?a.values:yield(0,f.getDataForSearchInput)({state:e,field:a.attribute}))).map(function(e){return"Object"===(0,p.toRawType)(e)?e:{key:e,value:e}}),a.dependance&&(e.loading[a.dependance]=!1,a.disabled=a.dependance_strict),a._values=[].concat(k(a.values)),a.loading=!1}});return function(e){return t.apply(this,arguments)}})()(o),a.service||Object.assign(new r.default,{state:o,doSearch:n,run:(0,_.debounce)(function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];var n=y.default.getService("map").getMap().getSize(),n=u(n,2),i=n[0],n=n[1],r=y.default.isMobile()&&(0===i||0===n);setTimeout(function(){r&&y.default.hideSidebar(),s.getService().doSearch(l({},t,{state:o}))},r?0:600)}),clear:function(){s.getService().state=null},createFilter:function(){return(0,v.createFilterFormInputs)({layer:o.search_layers,inputs:o.forminputs.filter(function(e){return![null,void 0,g.SEARCH_ALLVALUE].includes(e.value)&&""!==e.value.toString().trim()})})}})),s=new c.default(l({},a,{show:e,id:a.id||(0,d.getUniqueDomId)(),title:a.title||"search",vueComponentObject:a.component||w,service:t}));return s},e("g3w-constants")),r=o(e("g3w-object")),c=o(e("g3w-panel")),h=o(e("store/application")),y=o(e("services/gui")),m=o(e("services/data")),d=e("utils/getUniqueDomId"),v=e("utils/createFilterFormInputs"),p=e("utils/toRawType"),f=e("utils/getDataForSearchInput"),_=e("utils/debounce"),b=e("utils/getCatalogLayerById"),w=(e=>{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t})(e("components/SearchPanel.vue"));function o(e){return e&&e.__esModule?e:{default:e}}function x(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}function k(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}},{"components/SearchPanel.vue":117,"g3w-constants":140,"g3w-object":144,"g3w-panel":145,"services/data":187,"services/gui":188,"store/application":193,"utils/createFilterFormInputs":206,"utils/debounce":213,"utils/getCatalogLayerById":218,"utils/getDataForSearchInput":220,"utils/getUniqueDomId":232,"utils/toRawType":257}],127:[function(e,t,a){var n=(e=>{if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t.default=e,t})(e("vue-color"));var i=window.initConfig;if(i.baseurl)try{new URL(i.baseurl)}catch(e){i.baseurl=new URL(i.baseurl,window.location).toString()}i.group=Object.assign(i.group||{},new Proxy(Object.fromEntries(Object.keys(i).filter(function(e){return!["i18n","staticurl","client","mediaurl","user","baseurl","vectorurl","proxyurl","rasterurl","interfaceowsurl","main_map_title","main_map_title","g3wsuite_logo_img","credits","version","group","frontendurl"].includes(e)}).map(function(e){return[e,i[e]]})),{get:function(e,t,a){return Reflect.get.apply(Reflect,arguments)}})),i.overviewproject=i.overviewproject?i.overviewproject.gid:null,window.VueColor=n,window.VueCookie=e("vue-cookie")},{"vue-color":"vue-color","vue-cookie":"vue-cookie"}],128:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.trigger=a.unwatch=a.watch=void 0;var r=e("utils/getUniqueDomId"),o=new Vue,s={};a.watch=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.el,a=e.attr,n=e.watcher,e=e.immediate,e=void 0===e||e,i=(0,r.getUniqueDomId)(),t=(t.setAttribute(a,i),s[i]={});return n&&(t.unwatch=o.$watch(n[0],n[1],n[2]||{immediate:e}),t.handler=n[1]),i},a.unwatch=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=e.el.getAttribute(e.attr);e&&(s[e].unwatch(),delete s[e])},a.trigger=function(e){var t=e.el,a=e.data;return s[t.getAttribute(e.attr)].handler(a)}},{"utils/getUniqueDomId":232}],129:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(e,t){t.value?e.setAttribute("checked","checked"):e.removeAttribute("checked")}},{}],130:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default={bind:function(t,a,n){this.event=function(e){t===e.target||t.contains(e.target)||(e.stopPropagation(),n.context[a.expression](e))},document.body.addEventListener("click",this.event,!0)},unbind:function(){document.body.removeEventListener("click",this.event,!0)}}},{}],131:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default=function(e,t){e.classList.toggle("g3w-disabled",t.value)}},{}],132:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var n=e("store/application"),i=(n=n)&&n.__esModule?n:{default:n},r=e("directives/utils");var o="g3w-v-download-id";a.default={bind:function(a,n){"boolean"==typeof n.value&&!n.value||(0,r.watch)({el:a,attr:o,watcher:[function(){return i.default.download},function(e){var t=n.modifiers&&n.modifiers.show?"hide":"disabled";a.classList.toggle("g3w-"+t,"hide"==t?!e:e)}]})},unbind:function(e){return(0,r.unwatch)({el:e,attr:o})}}},{"directives/utils":128,"store/application":193}],133:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var n=e("store/application"),y=(n=n)&&n.__esModule?n:{default:n},m=e("directives/utils");var v="g3w-v-select2-id";a.default={inserted:function(o,s,l){function e(){$(o).select2({tags:p,width:"100%",dropdownCssClass:"skin-color",dropdownAutoWidth:f,dropdownParent:!0===g?$(o.parentNode):void 0,templateResult:a,templateSelection:n,minimumResultsForSearch:r?void 0:-1,createTag:function(e){e=e.term.trim();return e?{id:e,text:e,newTag:!0}:null}}).on("select2:select select2:unselect",function(e){var t,a,n,i,r;s.value&&(t=s.value,a="select2:select"===e.type,n=e.params.data.id,e=l.context,a&&(i=h?e[t][c].value:e[t],u&&i.every(function(e){return n!==e})?i.push(n):h?e[t][c].value=n:(r=(i=(""+t).split(".")).pop(),i.reduce(function(e,t){return e=e[t]},l.context)[r]=n)),!a&&u&&(h?e[t][c].value=e[t][c].value.filter(function(e){return n!==e}):e[t]=e[t].filter(function(e){return n!==e})),a||u)&&o.dispatchEvent(new Event("change"))})}var t=l.data.attrs||{},a=t.templateResult,n=t.templateSelection,i=t.multiple,u=void 0!==i&&i,i=t.search,r=void 0===i||i,i=t.select2_value,c=t.indexItem,d=t.createTag,p=void 0!==d&&d,d=t.dropdownAutoWidth,f=void 0!==d&&d,d=t.dropdownParent,g=void 0!==d&&d,h=s.value&&Array.isArray(l.context[s.value])&&void 0!==c;e(),s.value&&void 0!==i&&($(o).val(i).trigger("change"),l.g3w_observer=new MutationObserver(function(e){e=(e.find(function(e){return"select2_value"===e.attributeName})||{}).target;e&&$(o).val(e.getAttribute("select2_value")).trigger("change")}),l.g3w_observer.observe(o,{attributes:!0})),(0,m.watch)({el:o,attr:v,watcher:[function(){return y.default.language},e],immediate:!1})},unbind:function(e,t){t.g3w_observer&&t.g3w_observer.disconnect(),$(e).select2("destroy"),(0,m.unwatch)({el:e,attr:v})}}},{"directives/utils":128,"store/application":193}],134:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var n=e("store/application"),i=(n=n)&&n.__esModule?n:{default:n},r=e("directives/utils");var o=e("g3w-i18n").t,s="g3w-v-t-html-id";a.default={bind:function(e,t){(0,r.watch)({el:e,attr:s,watcher:[function(){return i.default.language},function(){e.innerHTML=""+o(t.value)}]})},update:function(e,t){t.value!==t.oldValue&&(e.innerHTML=""+o(t.value))},unbind:function(e){return(0,r.unwatch)({el:e,attr:s})}}},{"directives/utils":128,"g3w-i18n":143,"store/application":193}],135:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var n=e("store/application"),i=(n=n)&&n.__esModule?n:{default:n},r=e("directives/utils");var o=e("g3w-i18n").tPlugin,s="g3w-v-t-plugin-id";a.default={bind:function(t,a){var n=t.innerHTML;(0,r.watch)({el:t,attr:s,watcher:[function(){return i.default.language},function(){var e=null!==a.value?o(a.value):"";switch(a.arg||"post"){case"pre":t.innerHTML=e+" "+n;break;case"post":t.innerHTML=n+" "+e}}]})},unbind:function(e){return(0,r.unwatch)({el:e,attr:s})}}},{"directives/utils":128,"g3w-i18n":143,"store/application":193}],136:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var n=e("store/application"),i=(n=n)&&n.__esModule?n:{default:n},r=e("directives/utils");var n=e("g3w-i18n"),o=n.t,s=n.tPlugin,l="g3w-v-t-title-id";a.default={bind:function(t,a){(0,r.watch)({el:t,attr:l,watcher:[function(){return i.default.language},function(){var e=("plugin"===a.arg?s:o)(a.value);t.setAttribute("title",e),t.setAttribute("data-original-title",e)}]})},unbind:function(e){return(0,r.unwatch)({el:e,attr:l})}}},{"directives/utils":128,"g3w-i18n":143,"store/application":193}],137:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var n=e("store/application"),i=(n=n)&&n.__esModule?n:{default:n},r=e("directives/utils");var n=e("g3w-i18n"),o=n.t,s=n.tPlugin,l="g3w-v-t-tooltip-id";a.default={bind:function(a,n){n.modifiers.create&&(n.arg&&(a.setAttribute("data-placement",n.arg),a.classList.add("skin-tooltip-"+n.arg)),a.setAttribute("data-container","body"),$(a).tooltip({trigger:i.default.ismobile?"click":"hover",html:!0}).on("shown.bs.tooltip",function(){i.default.ismobile&&setTimeout(function(){return $(a).tooltip("hide")},600)})),(0,r.watch)({el:a,attr:l,watcher:[function(){return i.default.language},function(e){var e=e.el,e=void 0===e?a:e,t=e.getAttribute("current-tooltip");null===t&&(t=n.value),e.setAttribute("data-original-title",n.modifiers.text?t:("plugin"===n.arg?s:o)(t))}]})},componentUpdated:function(e,t){var a=e.getAttribute("current-tooltip");[null,""].includes(a)&&$(e).tooltip("hide"),null!=a&&a!==t.oldValue&&(0,r.trigger)({el:e,attr:l,data:{el:e}})},unbind:function(e){$(e).tooltip("hide"),(0,r.unwatch)({el:e,attr:l})}}},{"directives/utils":128,"g3w-i18n":143,"store/application":193}],138:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var n=e("store/application"),i=(n=n)&&n.__esModule?n:{default:n},r=e("directives/utils");function o(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).el,t=null===e.__currentBinding.value?"":s(e.__currentBinding.value);switch(e.__currentBinding.arg||"post"){case"pre":e.innerHTML=t+" "+e.__innerHTML;break;case"post":e.innerHTML=e.__innerHTML+" "+t}}var s=e("g3w-i18n").t,l="g3w-v-t-id";a.default={bind:function(e,t){e.__innerHTML=e.innerHTML,e.__currentBinding=t,(0,r.watch)({el:e,attr:l,watcher:[function(){return i.default.language},function(){return o({el:e})}]})},componentUpdated:function(e,t){e.__currentBinding.value!==t.value&&(e.__currentBinding=t,o({el:e}))},unbind:function(e){return(0,r.unwatch)({el:e,attr:l})}}},{"directives/utils":128,"g3w-i18n":143,"store/application":193}],139:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var i=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=function(e,t,a){return t&&r(e.prototype,t),a&&r(e,a),e};function r(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=c(e("g3w-object")),s=e("utils/noop"),l=e("utils/promisify"),u=c(e("services/gui"));function c(e){return e&&e.__esModule?e:{default:e}}function d(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}function p(e,t){return void 0!==e?e:t}var f=e("lodash.clonedeep"),e=e("util-deprecate");function g(e,t){for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}o=(e=>{var t=r;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,a=r;if(!(t instanceof a))throw new TypeError("Cannot call a class as a function");e.iconConfig&&(e.iconColor=e.iconConfig.color,e.icon=e.iconConfig.icon,delete e.iconConfig),e.icon=u.default.getFontClass(e.icon)||e.icon,e.open=p(e.open,!1),e.mobile=p(e.mobile,!0),e.collapsible=p(e.collapsible,!0);var n,i,t=((e,t)=>{if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")})(this,(r.__proto__||Object.getPrototypeOf(r)).call(this,{setters:{setOpen:function(e){this.state.open=e,this._setOpen&&this._setOpen(e)},setVisible:function(e){this.state.visible=e,this._setVisible&&this._setVisible(e)},setLoading:function(){this.state.loading=0<arguments.length&&void 0!==arguments[0]&&arguments[0]},setDisabled:function(){this.state.disabled=0<arguments.length&&void 0!==arguments[0]&&arguments[0]},reload:function(){this._reload&&this._reload()}}}));return t._firstLayout=!0,t.internalComponent=p(e.internalComponent,null),t._components=[],t.id=p(e.id,1e3*Math.random()),t.title=p(e.title,""),t.state={sizes:{width:0,height:0},info:p(e.info,null),open:p(e.open,!1),visible:p(e.visible,!0),loading:p(e.loading,!1),disabled:p(e.disabled,!1),resizable:p(e.resizable,!1),closewhenshowviewportcontent:p(e.closewhenshowviewportcontent,!0)},t.setService(e.service||t),e.internalComponent&&t.setInternalComponent(e.internalComponent),g(t,e),t.events=p(e.events,{}),t.events.open&&(n=(a=t.events.open).when,i=void 0===(a=a.cb)?function(){}:a,t["on"+(void 0===n?"after":n)]("setOpen",function(e){return i(e)})),e.vueComponentObject&&t.init(e),t}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e),n(r,[{key:"init",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this.vueComponent=f(e.vueComponentObject),this._components=e.components||[],this.setService(e.service||this._service||s.noop),this._service.init&&this.init!==this._service.init&&this._service.init(e),e.template&&(this.vueComponent.template=e.template),this.setInternalComponent=function(){this.internalComponent=new(Vue.extend(this.vueComponent))({service:this._service,template:e.template,propsData:e.propsData}),this.internalComponent.state=this.getService().state},this.setInternalComponent(),this}},{key:"getId",value:function(){return this.id}},{key:"setId",value:function(e){this.id=e}},{key:"getOpen",value:function(){return this.state.open}},{key:"getVisible",value:function(){return this.state.visible}},{key:"getTitle",value:function(){return this.state.title}},{key:"setTitle",value:function(e){this.state.title=e}},{key:"getService",value:function(){return this._service}},{key:"setService",value:function(e){this._service=e}},{key:"addComponent",value:function(e){this._components.push(e)}},{key:"removeComponent",value:function(a){var n=this;this._components.find(function(e,t){if(e===a)return n.splice(t,1),!0})}},{key:"getInternalComponent",value:function(){return this.internalComponent}},{key:"setInternalComponent",value:function(e){var a=this,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this.internalComponent=void 0===e&&this.internalComponentClass?new this.internalComponentClass:e,(t.events||[]).forEach(function(t){return a.internalComponent.$on(t.name,function(e){return t.handler&&t.handler(e)||a["set"+t.name[0].toUpperCase()+t.name.slice(1)](e)})}),this._service&&this._service.state&&(this.internalComponent.state=this._service.state)}},{key:"mount",value:function(t,a){var n=this;return(0,l.$promisify)(new Promise(function(e){n.internalComponent||n.setInternalComponent(),a&&$(t).append(n.internalComponent.$mount().$el),a||n.internalComponent.$mount(t),n.internalComponent.$nextTick(function(){$(t).localize(),n.emit("ready"),e(!0)}),n.emit("mount")}))}},{key:"unmount",value:function(){var e=this;return(0,l.$promisify)(d(function*(){e.internalComponent&&(e.state.resizable&&e.internalComponent.$off("resize-component",e.internalComponent.layout),e.state.open=!1,e.internalComponent.$destroy(!0),$(e.internalComponent.$el).remove(),e.internalComponent=null,e.emit("unmount"))}))}},{key:"ismount",value:function(){return this.internalComponent&&this.internalComponent.$el}},{key:"layout",value:function(e,t){var a=this;this.state.resizable&&this._firstLayout&&(this.internalComponent.$on("resize-component",this.internalComponent.layout),this._firstLayout=!1),this.internalComponent.$nextTick(function(){a.internalComponent.$emit("resize-component",{width:e,height:t})}),this.emit("layout")}}]),r})(o.default);a.default=o,Object.assign(o.prototype,{destroy:s.noop,click:s.noop,show:s.noop,overwriteServiceMethods:e(function(e){var a=this;Object.entries(e).forEach(function(e){var e=i(e,2),t=e[0];return a._service[t]=e[1]})},"[G3W-CLIENT] Component::overwriteServiceMethods(methodsOptions) is deprecated"),extendInternalComponent:e(function(e){var n=this;this.vueComponent?Object.entries(e).forEach(function(e){var e=i(e,2),t=e[0],a=e[1];switch(t){case"methods":n.extendInternalComponentMethods(a);break;case"components":n.extendInternalComponentComponents(a);break;case"computed":case"data":g(n.vueComponent[t],a)}}):this.vueComponent=e},"[G3W-CLIENT] Component::extendInternalComponent(internalComponentOptions) is deprecated")})},{"g3w-object":144,"lodash.clonedeep":"lodash.clonedeep","services/gui":188,"util-deprecate":"util-deprecate","utils/noop":242,"utils/promisify":247}],140:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.SELECTION=a.INCHES_PER_UNIT=a.DOTS_PER_INCH=a.SPATIAL_METHODS=a.LOCAL_ITEM_IDS=a.FONT_AWESOME_ICONS=a.VIEWPORT=a.TIMEOUT=a.SEARCH_ALLVALUE=a.QUERY_POINT_TOLERANCE=a.PRINT_SCALES=a.GEOMETRY_TYPES=a.GEOMETRY_FIELDS=a.FILTER_EXPRESSION_OPERATORS=a.FILTER_OPERATORS=a.G3W_FID=a.EPSG=a.DEFAULT_EDITING_CAPABILITIES=a.APP_VERSION=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},e=e("./version"),e=(e=e)&&e.__esModule?e:{default:e};var e=a.APP_VERSION=e.default,i=a.DEFAULT_EDITING_CAPABILITIES=["add_feature","change_feature","change_attr_feature","delete_feature"],r=(a.EPSG=["EPSG:3003","EPSG:3004","EPSG:3045","EPSG:3857","EPSG:4326","EPSG:6708","EPSG:23032","EPSG:23033","EPSG:25833","EPSG:32632","EPSG:32633"],a.G3W_FID="g3w_fid",a.FILTER_OPERATORS={gte:">=",lte:"<=",NOT:"!=",eq:"=",gt:">",lt:"<",IN:"IN",LIKE:"LIKE",ILIKE:"ILIKE",AND:"AND",OR:"OR"}),n=a.FILTER_EXPRESSION_OPERATORS=n({lte:"<=",ltgt:"!=",ilike:"ILIKE",like:"LIKE"},r),o=a.GEOMETRY_FIELDS=["geometryProperty","boundedBy","geom","the_geom","geometry","bbox","GEOMETRY","geoemtria","geometria"],s=a.GEOMETRY_TYPES={POINT:"Point",POINTZ:"PointZ",POINTM:"PointM",POINTZM:"PointZM",POINT25D:"Point25D",MULTIPOINT:"MultiPoint",MULTIPOINTZ:"MultiPointZ",MULTIPOINTM:"MutliPointM",MULTIPOINTZM:"MultiPointZM",MULTIPOINT25D:"MultiPoint25D",LINESTRING:"LineString",LINESTRINGZ:"LineStringZ",LINESTRINGM:"LineStringM",LINESTRINGZM:"LineStringZM",LINESTRING25D:"LineString25D",LINE:"Line",LINEZ:"LineZ",LINEM:"LineM",LINEZM:"LineZM",LINE25D:"Line25D",MULTILINESTRING:"MultiLineString",MULTILINESTRINGZ:"MultiLineStringZ",MULTILINESTRINGM:"MultiLineStringM",MULTILINESTRINGZM:"MultiLineStringZM",MULTILINESTRING25D:"MultiLineString25D",MULTILINE:"MultiLine",MULTILINEZ:"MultiLineZ",MULTILINEM:"MultiLineM",MULTILINEZM:"MultiLineZM",MULTILINE25D:"MultiLine25D",POLYGON:"Polygon",POLYGONZ:"PolygonZ",POLYGONM:"PolygonM",POLYGONZM:"PolygonZM",POLYGON25D:"Polygon25D",MULTIPOLYGON:"MultiPolygon",MULTIPOLYGONZ:"MultiPolygonZ",MULTIPOLYGONM:"MultiPolygonM",MULTIPOLYGONZM:"MultiPolygonZM",MULTIPOLYGON25D:"MultiPolygon25D",GEOMETRYCOLLECTION:"GeometryCollection",GEOMETRYCOLLECTIONZ:"GeometryCollectionZ",GEOMETRYCOLLECTIONM:"GeometryCollectionM",GEOMETRYCOLLECTIONZM:"GeometryCollectionZM",GEOMETRYCOLLECTION25D:"GeometryCollection25D"},l=a.PRINT_SCALES=[{value:100,label:"1:100"},{value:200,label:"1:200"},{value:500,label:"1:500"},{value:1e3,label:"1:1.000"},{value:2e3,label:"1:2.000"},{value:2500,label:"1:2.500"},{value:5e3,label:"1:5.000"},{value:1e4,label:"1:10.000"},{value:2e4,label:"1:20.000"},{value:25e3,label:"1:25.000"},{value:5e4,label:"1:50.000"},{value:1e5,label:"1:100.000"},{value:25e4,label:"1:250.000"},{value:5e5,label:"1:500.000"},{value:1e6,label:"1:1.000.000"},{value:25e5,label:"1:2.500.000"},{value:5e6,label:"1:5.000.000"},{value:1e7,label:"1:10.000.000"},{value:2e7,label:"1:20.000.000"},{value:5e7,label:"1:50.000.000"},{value:1e8,label:"1:100.000.000"},{value:25e7,label:"1:250.000.000"},{value:5e8,label:"1:500.000.000"}],u=a.QUERY_POINT_TOLERANCE={unit:"pixel",value:10},c=(a.SEARCH_ALLVALUE="__G3W_ALL__",a.TIMEOUT=6e4,a.VIEWPORT={resize:{map:{min:200},content:{min:200}}}),d=a.FONT_AWESOME_ICONS={"change-map":"fas fa-map-signs",map:"far fa-map",file:"fas fa-file-code",marker:"fas fa-map-marker-alt",relation:"fas fa-sitemap",tools:"fas fa-cogs",tool:"fas fa-cog",search:"fas fa-search",print:"fas fa-print",info:"fas fa-info-circle","info-circle":"fas fa-info-circle",globe:"fas fa-globe",mail:"fas fa-envelope",mobile:"fas fa-mobile",fax:"fas fa-fax",user:"fas fa-user",bars:"fas fa-bars",uncheck:"far fa-square",check:"far fa-check-square",checkmark:"fa fa-check",filluncheck:"fas fa-square",table:"fas fa-table",trash:"fas fa-trash","trash-o":"far fa-trash-alt",pencil:"fas fa-pencil-alt","ellips-h":"fas fa-ellipsis-h","ellips-v":"fas fa-ellipsis-v","arrow-up":"fas fa-chevron-up","arrow-down":"fas fa-chevron-down","arrow-left":"fas fa-chevron-left","arrow-right":"fas fa-chevron-right","resize-h":"fas fa-arrows-alt-h","resize-v":"fas fa-arrows-alt-v","resize-default":"fas fa-compress","caret-up":"fas fa-caret-up","caret-down":"fas fa-caret-down","caret-left":"fas fa-caret-left","caret-right":"fas fa-caret-right","empty-circle":"far fa-circle","cloud-upload":"fas fa-cloud-upload-alt",spinner:"fas fa-spinner",minus:"fas fa-minus","minus-square":"far fa-minus-square",plus:"fas fa-plus","plus-circle":"fas fa-plus-circle","plus-square":"far fa-plus-square",grid:"fas fa-th",home:"fas fa-home",folder:"fas fa-folder","sign-out":"fas fa-sign-out-alt",close:"fas fa-times",time:"far fa-clock",calendar:"fas fa-calendar-alt",list:"fas fa-list-alt",link:"fas fa-link",unlink:"fas fa-unlink",eye:"far fa-eye","eye-close":"far fa-eye-slash",save:"far fa-save",pdf:"fas fa-file-pdf",image:"far fa-image",video:"far fa-file-video",unknow:"far fa-question-circle",zip:"far fa-file-archive",text:"far fa-file-alt",excel:"far fa-file-excel",xls:"far fa-file-excel",gpx:"fas fa-location-arrow",gpkg:"fas fa-box-open",shapefile:"fas fa-file-archive",csv:"fas fa-file-csv",geotiff:"fas fa-th",ppt:"far fa-file-powerpoint",circle:"fas fa-circle",calculator:"fas fa-calculator",picture:"far fa-image",keyboard:"far fa-keyboard","file-download":"fas fa-file-download",copy:"far fa-copy",draw:"fas fa-draw-polygon",chart:"fas fa-chart-bar","chart-line":"fas fa-chart-line","chart-area":"fas fa-chart-area","chart-pie":"fas fa-chart-pie",run:"fas fa-play",warning:"fas fa-exclamation-circle",alert:"fas fa-exclamation-triangle",crosshairs:"fas fa-crosshairs",success:"far fa-check-circle",back:"fas fa-chevron-circle-left","file-upload":"fas fa-file-upload",wifi:"fas fa-wifi",mouse:"fas fa-mouse","copy-paste":"far fa-copy","vector-square":"fas fa-vector-square",download:"fas fa-download",credits:"fas fa-euro-sign",filter:"fas fa-filter",plugin:"fas fa-plug",invert:"fas fa-exchange-alt",clear:"fas fa-broom",palette:"fas fa-palette",layers:"fas fa-layer-group","sign-in":"fas fa-sign-in-alt",language:"fas fa-language",target:"fas fa-bullseye",pin:"fas fa-map-pin",square:"far fa-square",move:"fas fa-arrows-alt",moon:"fas fa-moon",sun:"fas fa-sun",refresh:"fas fa-sync-alt",pause:"fas fa-pause","step-backward":"fas fa-step-backward","fast-backward":"fas fa-fast-backward","step-forward":"fas fa-step-forward","fast-forward":"fas fa-fast-forward",crop:"fas fa-crop-alt",exit:"fas fa-door-open",slider:"fas fa-sliders-h",bookmark:"fas fa-bookmark",reply:"fas fa-reply",share:"fas fa-share","share-alt":"fa fa-share-alt","external-link":"fa fa-external-link-alt",pointer:"fa fa-hand-pointer",camera:"fas fa-camera-retro",measure:"fas fa-ruler-horizontal"},p=a.LOCAL_ITEM_IDS={MESSAGES:{id:"MESSAGES",value:{}},SPATIALBOOKMARKS:{id:"SPATIALBOOKMARKS",value:{}}},f=a.SPATIAL_METHODS=["intersects","within"],g=(a.DOTS_PER_INCH=96,a.INCHES_PER_UNIT={m:39.37,degrees:4374754});a.SELECTION={ALL:"__ALL__",EXCLUDE:"__EXCLUDE__"};a.default={APP_VERSION:e,DEFAULT_EDITING_CAPABILITIES:i,DOTS_PER_INCH:96,FILTER_OPERATORS:r,FILTER_EXPRESSION_OPERATORS:n,FONT_AWESOME_ICONS:d,G3W_FID:"g3w_fid",GEOMETRY_FIELDS:o,GEOMETRY_TYPES:s,INCHES_PER_UNIT:g,LOCAL_ITEM_IDS:p,PRINT_SCALES:l,QUERY_POINT_TOLERANCE:u,SEARCH_ALLVALUE:"__G3W_ALL__",SPATIAL_METHODS:f,TIMEOUT:6e4,VIEWPORT:c}},{"./version":260}],141:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});a.VM=new Vue},{}],142:[function(Me,e,t){!function(e){!function(){var a=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},e=C(Me("g3w-constants")),t=C(Me("store/application")),n=C(Me("services/application")),i=Me("utils/addZValueToOLFeatureGeometry"),r=Me("utils/is3DGeometry"),o=Me("utils/removeZValueToOLFeatureGeometry"),s=Me("utils/getOLGeometry"),l=Me("utils/isMultiGeometry"),u=Me("utils/isPointGeometryType"),c=Me("utils/isLineGeometryType"),d=Me("utils/isPolygonGeometryType"),p=Me("utils/createVectorLayerFromFile"),f=Me("utils/createSelectedStyle"),g=Me("utils/getAlphanumericPropertiesFromFeature"),h=Me("utils/getMapLayersByFilter"),y=Me("utils/areCoordinatesEqual"),m=Me("utils/splitFeature"),A=Me("utils/convertSingleMultiGeometry"),N=Me("utils/within"),G=Me("utils/intersects"),D=Me("utils/distance"),z=Me("utils/getDefaultExpression"),U=Me("utils/getFilterExpression"),v=Me("utils/getProjectUrl"),q=Me("utils/setProjectAliasUrl"),V=Me("utils/getProjectConfigByGid"),B=Me("utils/getListableProjects"),Y=Me("utils/getProject"),$=C(Me("components/InputG3W.vue")),W=C(Me("components/InputG3WFormInputs.vue")),_=C(Me("services/data")),H=C(Me("store/plugins")),Z=C(Me("services/tasks")),b=C(Me("services/gui")),w=Me("map/controls/measurecontrol"),Q=C(Me("mixins")),X=Me("utils/createMeasureTooltip"),K=Me("utils/removeMeasureTooltip"),J=Me("utils/getResolutionFromScale"),ee=Me("utils/getScaleFromResolution"),te=Me("utils/parsers"),ae=Me("utils/promisify"),x=C(Me("g3w-object")),k=C(Me("g3w-panel")),S=C(Me("g3w-component")),E=C(Me("map/interactions/pickfeatureinteraction")),L=C(Me("map/interactions/pickcoordinatesinteraction")),ne=Me("map/layers/layersstore"),ie=Me("map/layers/layer"),re=Me("map/layers/tablelayer"),oe=Me("map/layers/vectorlayer"),se=Me("map/layers/feature"),le=Me("map/layers/featuresstore"),T=Me("utils/getUniqueDomId"),ue=Me("utils/inherit"),ce=Me("utils/base"),de=Me("utils/noop"),pe=Me("utils/toRawType"),fe=Me("utils/throttle"),ge=Me("utils/debounce"),he=Me("utils/XHR"),ye=Me("utils/createFilterFormInputs"),me=Me("utils/colorHEXToRGB"),ve=Me("utils/getCatalogLayerById"),_e=Me("utils/getCatalogLayers");function C(e){return e&&e.__esModule?e:{default:e}}function M(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function P(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function O(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function I(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}var be=Me("g3w-i18n"),we=Me("./g3w-plugin").Plugin,xe=Me("./g3w-plugin").PluginService,ke=Me("services/map").default.MapLayersStoresRegistry,Se=Me("gui/fields/fieldsservice"),Ee=Me("components/g3w-search").SearchPanel,Le=Me("components/g3w-form").FormComponent,Te=Me("components/g3w-form").FormService,Ce=Me("gui/fields/fields"),F={constant:e.default,core:{G3WObject:x.default,utils:{base:ce.base,inherit:ue.inherit,XHR:he.XHR,getUniqueDomId:T.getUniqueDomId,uniqueId:T.getUniqueDomId,throttle:fe.throttle,debounce:ge.debounce,toRawType:pe.toRawType,colorHEXToRGB:me.colorHEXToRGB,createFilterFormInputs:ye.createFilterFormInputs,noop:de.noop},geoutils:{createVectorLayerFromFile:p.createVectorLayerFromFile,createSelectedStyle:f.createSelectedStyle,getAlphanumericPropertiesFromFeature:g.getAlphanumericPropertiesFromFeature,getQueryLayersPromisesByCoordinates:_.default.getQueryLayersPromisesByCoordinates,getMapLayersByFilter:h.getMapLayersByFilter,areCoordinatesEqual:y.areCoordinatesEqual,splitFeature:m.splitFeature,convertSingleMultiGeometry:A.convertSingleMultiGeometry,within:N.within,intersects:G.intersects,distance:D.distance,Geometry:{GeometryTypes:e.default.GEOMETRY_TYPES,removeZValueToOLFeatureGeometry:o.removeZValueToOLFeatureGeometry,addZValueToOLFeatureGeometry:i.addZValueToOLFeatureGeometry,getOLGeometry:s.getOLGeometry,isMultiGeometry:l.isMultiGeometry,isPointGeometryType:u.isPointGeometryType,isLineGeometryType:c.isLineGeometryType,isPolygonGeometryType:d.isPolygonGeometryType,is3DGeometry:r.is3DGeometry}},ApplicationService:n.default,ApplicationState:t.default,i18n:be,task:{TaskService:Z.default},data:{DataRouterService:_.default},errors:{parsers:{Server:te.ResponseParser.get("g3w-error")}},project:{ProjectsRegistry:Object.assign(new x.default,{setters:{setCurrentProject:function(e){}},getProjectUrl:v.getProjectUrl,setProjectAliasUrl:q.setProjectAliasUrl,getProjectConfigByGid:V.getProjectConfigByGid,getListableProjects:B.getListableProjects,getProject:Y.getProject,getCurrentProject:function(){return t.default.project}})},map:{MapLayersStoreRegistry:ke},catalog:{CatalogLayersStoresRegistry:{getLayerById:ve.getCatalogLayerById,getLayers:_e.getCatalogLayers}},layer:{LayersStore:ne.LayersStore,Layer:ie.Layer,TableLayer:re.TableLayer,VectorLayer:oe.VectorLayer,features:{Feature:se.Feature,FeaturesStore:le.FeaturesStore}},interaction:{PickCoordinatesInteraction:L.default,PickFeatureInteraction:E.default},plugin:{Plugin:we,PluginsRegistry:H.default,PluginService:xe},input:{inputService:{handleFilterExpressionFormInput:U.getFilterExpression,handleDefaultExpressionFormInput:z.getDefaultExpression}}},gui:{GUI:b.default,Panel:k.default,ComponentsFactory:{build:function(e){var t=e.vueComponentObject,a=e.service,e=e.propsData;return new S.default(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).init({vueComponentObject:t,service:a,propsData:e})}},FieldsService:Se,vue:{Component:S.default,Panel:k.default,SearchPanel:Ee,FormComponent:Le,Inputs:{G3wFormInputs:W.default,G3WInput:$.default,InputsComponents:{text_input:Me("gui/inputs/text/vue/text"),texthtml_input:Me("gui/inputs/texthtml/vue/texthtml"),textarea_input:Me("gui/inputs/textarea/vue/textarea"),integer_input:Me("gui/inputs/integer/vue/integer"),string_input:Me("gui/inputs/text/vue/text"),float_input:Me("gui/inputs/float/vue/float"),radio_input:Me("gui/inputs/radio/vue/radio"),check_input:Me("gui/inputs/checkbox/vue/checkbox"),range_input:Me("gui/inputs/range/vue/range"),datetimepicker_input:Me("gui/inputs/datetimepicker/vue/datetimepicker"),unique_input:Me("gui/inputs/unique/vue/unique"),select_input:Me("gui/inputs/select/vue/select"),media_input:Me("gui/inputs/media/vue/media"),select_autocomplete_input:Me("gui/inputs/select/vue/select"),picklayer_input:Me("gui/inputs/picklayer/vue/picklayer"),color_input:Me("gui/inputs/color/vue/color"),slider_input:Me("gui/inputs/sliderrange/vue/sliderrange"),lonlat_input:Me("gui/inputs/lonlat/vue/lonlat")}},Fields:Ce,Mixins:Q.default,services:{FormService:Te}}},ol:{interactions:{PickFeatureInteraction:E.default,PickCoordinatesInteraction:L.default},controls:{},utils:{merge:function(e,t){return a({},e,t)},getScaleFromResolution:ee.getScaleFromResolution,getResolutionFromScale:J.getResolutionFromScale,createMeasureTooltip:X.createMeasureTooltip,removeMeasureTooltip:K.removeMeasureTooltip}},info:function(){Promise.allSettled([new Promise(function(e){return $script("https://unpkg.com/platform@1.3.6/platform.js",e)}),new Promise(function(e){return n.default.complete?e():n.default.on("complete",e)})]).finally(I(function*(){var e=window.platform||{};window.console.info(("\n[g3wsdk.info]\n\n- g3w-admin: __"+initConfig.version+"__\n- g3w-client: __3.11.0-alpha.1__\n"+Object.entries(t.default.pluginsConfigs).map(function(e){return"    - "+e[0]+": __"+e[1].version+"__"}).join("\n")+"\n- browser: __"+e.name+" "+e.version+"__\n- operating system: __"+e.os.toString()+"__\n").trim())}))},version:e.default.APP_VERSION};function j(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return M(this,j),e.geometryType="LineString",P(this,(j.__proto__||Object.getPrototypeOf(j)).call(this,e))}function R(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return M(this,R),e.geometryType="Polygon",P(this,(R.__proto__||Object.getPrototypeOf(R)).call(this,e))}F.core.geometry={Geom:F.core.geoutils,Geometry:F.core.geoutils.Geometry},F.ol.interactions.measure={},F.ol.interactions.measure.AreaInteraction=(O(R,w.MeasureInteraction),R),F.ol.interactions.measure.LengthInteraction=(O(j,w.MeasureInteraction),j),F.core.geoutils.isSameBaseGeometryType=function(e,t){return e.replace("Multi","")===t.replace("Multi","")},F.core.ApplicationService.setLocalItem=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.id,e=e.data;try{window.localStorage.setItem(t,JSON.stringify(e))}catch(e){return e}},F.core.ApplicationService.removeLocalItem=function(e){return window.localStorage.removeItem(e)},F.core.ApplicationService.getLocalItem=function(e){return window.localStorage.getItem(e)?JSON.parse(window.localStorage.getItem(e)):void 0},F.core.ApplicationService.getApplicationUser=function(){return t.default.user},F.core.ApplicationService.changeProject=function(){var t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).gid;return(0,ae.$promisify)(I(function*(){var e=b.default.getService("map").addMapExtentUrlParameterToUrl((0,v.getProjectUrl)(t),crs);try{history.replaceState(null,null,e)}catch(e){}location.replace(e)}))},F.core.ApplicationService.reloadCurrentProject=function(){return F.core.ApplicationService.changeProject({gid:t.default.project.getGid()})},F.core.ApplicationService.setCurrentLayout=function(){return t.default.gui.layout.__current=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"app"},F.core.ApplicationService.getCurrentLayoutName=function(){return t.default.gui.layout.__current},F.core.ApplicationService.isIframe=function(){return t.default.iframe},window.g3wsdk=F}.call(this)}.call(this,Me("_process"))},{"./g3w-plugin":146,_process:1,"components/InputG3W.vue":76,"components/InputG3WFormInputs.vue":77,"components/g3w-form":125,"components/g3w-search":126,"g3w-component":139,"g3w-constants":140,"g3w-i18n":143,"g3w-object":144,"g3w-panel":145,"gui/fields/fields":3,"gui/fields/fieldsservice":4,"gui/inputs/checkbox/vue/checkbox":6,"gui/inputs/color/vue/color":7,"gui/inputs/datetimepicker/vue/datetimepicker":9,"gui/inputs/float/vue/float":11,"gui/inputs/integer/vue/integer":14,"gui/inputs/lonlat/vue/lonlat":16,"gui/inputs/media/vue/media":18,"gui/inputs/picklayer/vue/picklayer":20,"gui/inputs/radio/vue/radio":22,"gui/inputs/range/vue/range":24,"gui/inputs/select/vue/select":26,"gui/inputs/sliderrange/vue/sliderrange":30,"gui/inputs/text/vue/text":31,"gui/inputs/textarea/vue/textarea":32,"gui/inputs/texthtml/vue/texthtml":33,"gui/inputs/unique/vue/unique":35,"map/controls/measurecontrol":159,"map/interactions/pickcoordinatesinteraction":164,"map/interactions/pickfeatureinteraction":165,"map/layers/feature":166,"map/layers/featuresstore":167,"map/layers/layer":170,"map/layers/layersstore":171,"map/layers/tablelayer":172,"map/layers/vectorlayer":173,mixins:180,"services/application":186,"services/data":187,"services/gui":188,"services/map":190,"services/tasks":192,"store/application":193,"store/plugins":194,"utils/XHR":196,"utils/addZValueToOLFeatureGeometry":197,"utils/areCoordinatesEqual":198,"utils/base":199,"utils/colorHEXToRGB":200,"utils/convertSingleMultiGeometry":203,"utils/createFilterFormInputs":206,"utils/createMeasureTooltip":208,"utils/createSelectedStyle":210,"utils/createVectorLayerFromFile":212,"utils/debounce":213,"utils/distance":214,"utils/getAlphanumericPropertiesFromFeature":217,"utils/getCatalogLayerById":218,"utils/getCatalogLayers":219,"utils/getDefaultExpression":221,"utils/getFilterExpression":222,"utils/getListableProjects":224,"utils/getMapLayersByFilter":225,"utils/getOLGeometry":226,"utils/getProject":227,"utils/getProjectConfigByGid":228,"utils/getProjectUrl":229,"utils/getResolutionFromScale":230,"utils/getScaleFromResolution":231,"utils/getUniqueDomId":232,"utils/inherit":235,"utils/intersects":236,"utils/is3DGeometry":237,"utils/isLineGeometryType":238,"utils/isMultiGeometry":239,"utils/isPointGeometryType":240,"utils/isPolygonGeometryType":241,"utils/noop":242,"utils/parsers":245,"utils/promisify":247,"utils/removeMeasureTooltip":249,"utils/removeZValueToOLFeatureGeometry":250,"utils/setProjectAliasUrl":254,"utils/splitFeature":255,"utils/throttle":256,"utils/toRawType":257,"utils/within":259}],143:[function(e,t,a){var e=e("store/application"),o=(e=e)&&e.__esModule?e:{default:e};t.exports={getAppLanguage:function(){return window.initConfig.user.i18n||"en"},t:function(e){return i18next.t(e)},tPlugin:function(e){return i18next.t("plugins."+e)},addI18n:function(e){for(var t in e)for(var a in e[t])i18next.addResource(t,"translation",a,e[t][a])},addI18nPlugin:function(e){var t,a,n=e.name,i=e.config;for(t in i)o.default.i18n.plugins[t]&&(o.default.i18n.plugins[t].plugins[n]=i[t]);for(a in o.default.i18n.plugins)for(var r in o.default.i18n.plugins[a])i18next.addResource(a,"translation",r,o.default.i18n.plugins[a][r])}}},{"store/application":193}],144:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=function(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e};function i(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var c=e("utils/noop"),o=e("utils/debounce"),s=e("utils/throttle");function l(t,e,a,n){if(n)return a.call(t,n);var i=n;Object.defineProperty(t,e,{get:function(){return i},set:function(e){(i=e)&&a.call(t,e)}})}e=(e=>{var t=a;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);function a(e){var t;if(this instanceof a)return l(t=((e,t)=>{if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")})(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e)),"setters",t._setupListenersChain,(e=e||{}).setters||t.setters),l(t,"throttles",t._setupThrottles,e.throttles||t.throttles),l(t,"debounces",t._setupDebounces,e.debounces||t.debounces),t;throw new TypeError("Cannot call a class as a function")}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e),n(a,[{key:"onafter",value:function(e,t,a){return this._onsetter("after",e,t,!1,a)}},{key:"onceafter",value:function(e,t,a){return this._onsetter("after",e,t,!1,a,!0)}},{key:"onbefore",value:function(e,t,a){return this._onsetter("before",e,t,!1,a)}},{key:"oncebefore",value:function(e,t,a){return this._onsetter("before",e,t,!1,a,!0)}},{key:"onbeforeasync",value:function(e,t,a){return this._onsetter("before",e,t,!0,a)}},{key:"un",value:function(n,i){Object.entries(this.settersListeners).forEach(function(e){var e=r(e,2),a=(e[0],e[1]);void 0===i?a[n].splice(0):a[n].forEach(function(e,t){e.key===i&&a[n].splice(t,1)})})}},{key:"_onsetter",value:function(e,t,a,n){var i=4<arguments.length&&void 0!==arguments[4]?arguments[4]:0,r=5<arguments.length&&void 0!==arguments[5]&&arguments[5],o=void 0;return this.settersListeners&&void 0!==this.settersListeners[e][t]&&(o=""+(Math.floor(1e6*Math.random())+Date.now()),this.settersListeners[e][t].push({key:o,fnc:a,async:n,priority:i,once:r}),this.settersListeners[e][t]=this.settersListeners[e][t].sort(function(e,t){return t.priority-e.priority})),o}},{key:"_setupListenersChain",value:function(u){var e,t=this;this.settersListeners={after:{},before:{}};for(e in u)(l=>{t.settersListeners.after[l]=[],t.settersListeners.before[l]=[],t[l]=function(){for(var o=this,e=arguments.length,s=Array(e),t=0;t<e;t++)s[t]=arguments[t];return $.Deferred(function(i){var r=0;(function e(t){var a,n=o.settersListeners.before[l].length;!0!==t&&!1!==t||t?(r===n&&(i.resolve((u[l]instanceof Function?u[l]:u[l].fnc).apply(o,s)),a=[],o.settersListeners.after[l].forEach(function(e){e.fnc.apply(o,s),e.once&&a.push(e.key)}),a.forEach(function(e){return o.un(l,e)}),o.emitEvent("set:"+l,s)),r<n&&((t=o.settersListeners.before[l][r++]).async?(s.push(e),t.fnc.apply(o,s)):e(t.fnc.apply(o,s)),t.once)&&o.settersListeners.before[l].splice(r-1,1)):((!(u[l]instanceof Function)&&u[l].fallback||c.noop).apply(o,s),i.reject())})(!0)})}})(e);return this.settersListeners}},{key:"_setupDebounces",value:function(e){for(var t in e)this[t]=(0,o.debounce)(e[t].fnc,e[t].delay)}},{key:"_setupThrottles",value:function(e){for(var t in e)this[t]=(0,s.throttle)(e[t].fnc,e[t].delay)}},{key:"get",value:function(e){return!this[e]||this[e]instanceof Function?null:this[e]}},{key:"set",value:function(e,t){this[e]=t}}]),a})(EventEmitter);a.default=e},{"utils/debounce":213,"utils/noop":242,"utils/throttle":256}],145:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var i=function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e};function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=l(e("services/gui")),o=l(e("g3w-object")),s=e("utils/promisify");function l(e){return e&&e.__esModule?e:{default:e}}e=(e=>{var t=n;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,a=n;if(t instanceof a)return(t=((e,t)=>{if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")})(this,(n.__proto__||Object.getPrototypeOf(n)).call(this))).id=e.id||null,t.title=e.title||"",t.service=e.service,e.vueComponentObject?t.internalPanel=new(Vue.extend(e.vueComponentObject))({service:t.service}):t.internalPanel=e.panel||e.internalPanel||null,!0===e.show&&t.internalPanel&&t.show(),t;throw new TypeError("Cannot call a class as a function")}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e),i(n,[{key:"getId",value:function(){return this.id}},{key:"getTitle",value:function(){return this.title}},{key:"getService",value:function(){return this.service}},{key:"setService",value:function(e){this.service=e}},{key:"getInternalPanel",value:function(){return this.internalPanel}},{key:"setInternalPanel",value:function(e){this.internalPanel=e}},{key:"show",value:function(){r.default.showPanel(this)}},{key:"close",value:function(){r.default.closePanel()}},{key:"mount",value:function(e){var t=this.internalPanel,a=t.$mount();return $(e).append(a.$el),a.$nextTick(function(){$(e).localize(),t.onShow&&t.onShow()}),(0,s.$promisify)(Promise.resolve(!0))}},{key:"unmount",value:function(){var e=this.internalPanel;return e.$destroy(!0),$(e.$el).remove(),e.onClose&&e.onClose(),this.internalComponent=null,this.service&&this.service.clear&&this.service.clear(),(0,s.$promisify)(Promise.resolve())}}]),n})(o.default);a.default=e},{"g3w-object":144,"services/gui":188,"utils/promisify":247}],146:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.PluginService=a.Plugin=void 0;var n=function(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e};function i(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=d(e("g3w-object")),o=d(e("g3w-component")),l=d(e("store/application")),s=d(e("store/plugins")),u=d(e("services/gui")),c=e("utils/toRawType");function d(e){return e&&e.__esModule?e:{default:e}}function p(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}function f(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function g(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function h(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var y,m=e("g3w-i18n").addI18nPlugin,v=e("lodash.clonedeep");a.Plugin=(h(_,r.default),n(_,[{key:"setName",value:function(e){this.name=e}},{key:"getName",value:function(){return this.name}},{key:"setConfig",value:function(e){this.config="Object"===(0,c.toRawType)(e)?e:null}},{key:"getConfig",value:function(e){return this.config||l.default.pluginsConfigs[e||this.name]}},{key:"setLocale",value:function(e){e&&this.name&&m({name:this.name,config:e})}},{key:"setService",value:function(e){(this.service=e)&&e.setPlugin(this)}},{key:"getService",value:function(){return this.service}},{key:"setDependencies",value:function(){this.dependencies=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]}},{key:"setApi",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};(this._api=e).getConfig=this._api.getConfig}},{key:"getApi",value:function(){return this._api}},{key:"setHookService",value:function(e){this._hook=e}},{key:"getHookService",value:function(){return this.hookservices[0<arguments.length&&void 0!==arguments[0]?arguments[0]:"tools"]}},{key:"setLayout",value:function(e){var t=(e=void 0!==e?e:v(l.default.gui.layout.app)).rightpanel||{width:50,height:50,width_default:50,height_default:50,width_100:!1,height_100:!1};e.rightpanel=Object.assign(t,{width:e.rightpanel.width||t.width,height:e.rightpanel.height||t.width,width_default:e.rightpanel.width||t.width,height_default:e.rightpanel.height||t.width,width_100:!1,height_100:!1}),l.default.gui.layout[this.name]=e}},{key:"setCurrentLayout",value:function(){l.default.gui.layout.__current=this.name}},{key:"setReady",value:function(e){var t=this;this._ready=e,this._ready&&this.setLayout(),this.emit("set-ready",e,this.name),setTimeout(function(){clearTimeout(t._timeout),l.default.plugins=l.default.plugins.filter(function(e){return t.name!==e})},0)}},{key:"isReady",value:function(){var a=this;return new Promise(function(t){a._ready?t(a._ready):a.once("set-ready",function(e){a._ready=e,t(a._ready)})})}},{key:"isCurrentProjectCompatible",value:function(e){return e===l.default.project.getGid()}},{key:"registerPlugin",value:function(e){var t=this,e=this.isCurrentProjectCompatible(e);return e?s.default.registerPlugin(this):(l.default.plugins=l.default.plugins.filter(function(e){return t.name!==e}),clearTimeout(this._timeout)),e}},{key:"getDependencyPlugins",value:function(e){var t=this;return this.dependencies=e||this.dependencies,Promise.all(this.dependencies.map(function(e){return t.getDependencyPlugin(e)}))}},{key:"getDependencyPluginsObject",value:(y=p(function*(e){var a={},n=yield this.getDependencyPlugins(e);return this.dependencies.forEach(function(e,t){return a[e]=n[t]}),a}),function(e){return y.apply(this,arguments)})},{key:"getDependencyPlugin",value:function(a){return l.default.pluginsConfigs[a]?new Promise(function(t){var e=s.default.getPlugin(a);e&&e.isReady().then(function(){return t(e.getApi())})||s.default.onafter("registerPlugin",function(e){a===e.name&&e.isReady().then(function(){return t(e.getApi())})})}):Promise.reject({error:"no plugin"})}},{key:"setHookLoading",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.hook,e=e.loading,e=void 0!==e&&e;this.getHookService(void 0===t?"tools":t).setLoading(e)}},{key:"addToolGroup",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.hook,a=e.position,e=e.title;this.getHookService(void 0===t?"tools":t).addToolGroup(a,e)}},{key:"removeToolGroup",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.hook,e=e.group;this.getHookService(t).removeToolGroup(e.title)}},{key:"addTools",value:function(t,e){var a=this,n=t.hook||"tools",i=[];return t.action||t.type?(this.setHookService(n),i=(this.config.configs||[this.config]).map(function(e){return{icon:t.icon,type:t.type,name:e.name||t.name,html:t.html,options:t.options||{},action:t.action&&t.action.bind(a,e),loading:void 0!==t.loading&&t.loading,disabled:void 0!==t.disabled&&t.disabled,offline:void 0===t.offline||t.offline,state:void 0!==t.state?t.state:{type:null,message:null}}}),this.getHookService(n).addTools(i,e)):this.removeToolGroup({hook:n,group:e}),i}},{key:"setToolState",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.id,e=e.state,a=void 0===e?{type:null,message:null}:e;this.hookservices[this._hook].state.toolsGroups.find(function(e){e=e.tools.find(function(e){return e.name===t});if(e)return e.state.type=a.type,e.state.message=a.message,!0})}},{key:"removeTools",value:function(){this.hookservices[this._hook].removeTools()}},{key:"createSideBarComponent",value:function(e){function t(e,t){return void 0!==e?e:t}var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return a.vueComponentObject=e,a.collapsible=t(a.collapsible,!0),a.mobile=t(a.mobile,!0),a.sidebarOptions=t(a.sidebarOptions,{position:1}),u.default.addComponent(new o.default(a),"sidebar",a.sidebarOptions),this.once("unload",function(){return u.default.removeComponent(a.id,"sidebar",a.sidebarOptions)}),u.default.getComponent(a.id)}},{key:"unload",value:function(){this.service&&this.service.clearAllEvents(),this.emit("unload")}},{key:"load",value:function(){}},{key:"getProject",value:function(){return l.default.project}},{key:"addDependency",value:function(e){this.dependencies.push(e)}},{key:"addFontClass",value:function(e){var t=e.name;Vue.prototype.g3wtemplate.addFontClass({name:t,className:e.className})}},{key:"addFontClasses",value:function(){var t=this;(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(e){return t.addFontClass(e)})}}]),_);function _(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.name,t=void 0===t?null:t,a=e.config,a=void 0===a?l.default.pluginsConfigs[t]:a,n=e.service,n=void 0===n?null:n,i=e.dependencies,i=void 0===i?[]:i,r=e.i18n,r=void 0===r?null:r,o=e.fontClasses,o=void 0===o?[]:o,e=e.api,e=void 0===e?{}:e,s=(f(this,_),g(this,(_.__proto__||Object.getPrototypeOf(_)).call(this)));return s.setName(t),s.setConfig(a),s.setLocale(r),s.setService(n),s.setDependencies(i),s.addFontClasses(o),s.setApi(e),s.setHookService(null),s._ready=!1,s.hookservices={search:u.default.getService("search"),tools:u.default.getService("tools")},s._timeout=setTimeout(function(){l.default.plugins=l.default.plugins.filter(function(e){return s.name!==e}),s.name&&delete l.default.gui.layout[s.name]},1e4),s}a.PluginService=(h(b,r.default),n(b,[{key:"init",value:function(){this.config=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}}},{key:"setCurrentLayout",value:function(){l.default.gui.layout.__current=this.getPlugin().getName()}},{key:"resetCurrentLayout",value:function(){l.default.gui.layout.__current=this.currentLayout}},{key:"setPlugin",value:function(e){this.plugin=e}},{key:"getPlugin",value:function(){return this.plugin}},{key:"isIframe",value:function(){return l.default.iframe}},{key:"getCurrentProject",value:function(){return l.default.project}},{key:"getGid",value:function(){return this.config.gid&&this.config.gid.split(":")[1]}},{key:"getConfig",value:function(){return this.config}},{key:"setConfig",value:function(e){this.config=e}},{key:"setApi",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.dependency,e=e.api;t?this._api.dependencies[t]=e:this._api.own=e}},{key:"getApi",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).dependency;return e&&this._api.dependencies[e]||this._api.own}},{key:"initEvents",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];for(e in t)this._pluginEvents[t[e]]={}}},{key:"subscribeEvent",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.name,a=e.once,a=void 0!==a&&a,n=e.owner,e=e.listener;this._pluginEvents[t]=this._pluginEvents[t]||{},this._pluginEvents[t][n]=e,a?this.once(t,e):this.on(t,e)}},{key:"triggerEvent",value:function(e){var t=e.name,e=e.params;this.emit(t,void 0===e?{}:e)}},{key:"unsubscribeEvent",value:function(e){var t=e.name,e=e.owner;this.removeEvent(t,this._pluginEvents[t][e]),delete this._pluginEvents[t][e]}},{key:"unsubscribeAllEvents",value:function(){for(var e in this._pluginEvents)this.removeEvent(e),delete this._pluginEvents[e]}},{key:"clearAllEvents",value:function(){this.unsubscribeAllEvents(),this.unwatch(),this.vm=null,this._pluginEvents=null}},{key:"loadPlugin",value:function(){return!0}},{key:"clear",value:function(){}}]),b);function b(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(f(this,b),g(this,(b.__proto__||Object.getPrototypeOf(b)).call(this,e)));return t.plugin,t._api={own:null,dependencies:{}},t._pluginEvents={},t._appEvents=[],t.currentLayout=l.default.gui.layout.__current,t.vm=new Vue,t.unwatch=t.vm.$watch(function(){return l.default.gui.layout.__current},function(e){return t.currentLayout=e!==t.getPlugin().getName()?e:t.currentLayout}),t}},{"g3w-component":139,"g3w-i18n":143,"g3w-object":144,"lodash.clonedeep":"lodash.clonedeep","services/gui":188,"store/application":193,"store/plugins":194,"utils/toRawType":257}],147:[function(o,A,N){var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},s=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},l=(o("./deprecated"),o("./g3w-globals"),o("g3w-constants")),G=E(o("locales")),u=E(o("store/application")),c=E(o("g3w-object")),D=E(o("g3w-panel")),d=E(o("g3w-component")),p=E(o("services/application")),f=E(o("services/gui")),z=E(o("components/App.vue")),e=E(o("components/GlobalImage.vue")),t=E(o("components/GlobalGallery.vue")),a=E(o("components/GlobalGeo.vue")),n=E(o("components/GlobalSkeleton.vue")),i=E(o("components/GlobalBarLoader.vue")),g=E(o("components/GlobalProgressBar.vue")),h=E(o("components/GlobalHelpDiv.vue")),y=E(o("components/GlobalResize.vue")),m=E(o("components/GlobalLayerPositions.vue")),v=E(o("components/GlobalDateTime.vue")),_=E(o("components/GlobalRange.vue")),b=E(o("components/GlobalResizeIcon.vue")),w=E(o("components/GlobalTabs.vue")),x=E(o("components/GlobalDivider.vue")),U=E(o("directives/v-disabled")),q=E(o("directives/v-checked")),V=E(o("directives/v-select2")),B=E(o("directives/v-t-tooltip")),Y=E(o("directives/v-t-html")),W=E(o("directives/v-t-title")),H=E(o("directives/v-t")),Z=E(o("directives/v-t-plugin")),Q=E(o("directives/v-download")),X=E(o("directives/v-click-outside")),k=o("utils/noop"),S=o("utils/XHR"),K=o("utils/promisify"),J=o("utils/getProject");function E(e){return e&&e.__esModule?e:{default:e}}function L(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}var T=o("g3w-i18n"),ee=T.addI18n,C=T.t,te=T.tPlugin,M=(Vue.component(e.default.name,e.default),Vue.component(t.default.name,t.default),Vue.component(a.default.name,a.default),Vue.component(i.default.name,i.default),Vue.component(g.default.name,g.default),Vue.component(n.default.name,n.default),Vue.component(h.default.name,h.default),Vue.component(y.default.name,y.default),Vue.component(m.default.name,m.default),Vue.component(v.default.name,v.default),Vue.component(_.default.name,_.default),Vue.component(b.default.name,b.default),Vue.component(w.default.name,w.default),Vue.component(x.default.name,x.default),Vue.filter("t",function(e){return C(e)}),Vue.filter("tPlugin",function(e){return null!==e?te(e):""}),Vue.directive("disabled",U.default),Vue.directive("checked",q.default),Vue.directive("select2",V.default),Vue.directive("t-tooltip",B.default),Vue.directive("t-html",Y.default),Vue.directive("t-title",W.default),Vue.directive("t",H.default),Vue.directive("t-plugin",Z.default),Vue.directive("download",Q.default),Vue.directive("click-outside",X.default),Vue.use(window.VueCookie),Vue.use({install:function(e){function t(){return a.apply(this,arguments)}var a;e.prototype.g3wtemplate={font:l.FONT_AWESOME_ICONS,addFontClass:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.name,a=void 0===this.font[t];return a&&(this.font[t]=e.className),a},getFontClass:function(e){return void 0===this.font[e]?"":this.font[e]}},e.mixin({methods:{isMobile:(a=function(){return isMobile.any},t.toString=function(){return a.toString()},t)}})}},{}),Vue.mixin({inheritAttrs:!1}),$("body").append('<div id="startingspinner"><div class="double-bounce1"></div><div class="double-bounce2"></div></div>'),{}),P={};function O(){$.extend($.fn.dataTableExt.oStdClasses,{sFilterInput:"form-control search"}),$.extend(!0,$.fn.dataTable.defaults,{language:{sSearch:"",searchPlaceholder:C("dosearch"),sLengthMenu:C("dataTable.lengthMenu"),paginate:{previous:"«",next:"»"},info:C("dataTable.info"),zeroRecords:C("dataTable.nodatafilterd"),infoFiltered:""}})}function I(n){return new Promise(function(e,t){var a=document.createElement("script");a.onload=e,a.onerror=function(e){t(new Error("Failed to load script: "+n))},a.src=n,document.head.appendChild(a)})}var F,j=window.initConfig,R=(u.default.user=j.user,p.default.emit("initconfig",j),j.vendorkeys||{});j.baselayers.forEach(function(e){e.apikey&&(R[e.servertype?e.servertype.toLowerCase():null]=e.apikey)}),Object.keys(R).forEach(function(e){return u.default.keys.vendorkeys[e]=R[e]}),Object.assign(j,{logo_img:j.header_logo_img,logo_link:j.header_logo_link,terms_of_use_text:j.header_terms_of_use_text,urls:Object.assign(j.urls||{},{ows:"ows",api:"api",initconfig:"api/initconfig",config:"api/config",baseurl:j.baseurl,frontendurl:j.frontendurl,staticurl:j.staticurl,clienturl:j.staticurl+j.client,mediaurl:j.mediaurl,vectorurl:j.vectorurl,proxyurl:j.proxyurl,rasterurl:j.rasterurl,interfaceowsurl:j.interfaceowsur}),layout:j.layout||{},plugins:j.plugins||{},tools:j.tools||{tools:[]},views:j.views||{},user:j.user||null}),j.layout.iframe=window.top!==window.self,u.default.lng=j.user.i18n||"en",u.default.language=j.user.i18n||"en",(j.i18n||[]).map(function(e){return e[0]}).forEach(function(e){return u.default.i18n.plugins[e]={plugins:{}}}),i18next.use(i18nextXHRBackend).init({lng:j.user.i18n,ns:"app",fallbackLng:"en",resources:G.default}),jqueryI18next.init(i18next,$,{tName:"t",i18nName:"i18n",handleName:"localize",selectorAttr:"data-i18n",targetAttr:"data-i18n-target",optionsAttr:"data-i18n-options",useOptionsAttr:!1,parseDefaultValueFromContent:!0}),ee(u.default.i18n.plugins),$.ajaxSetup({beforeSend:function(e){e.setRequestHeader("Accept-Language",j.user.i18n||"en")}}),new Promise((F=L(function*(n,t){try{j.macrogroups=yield S.XHR.get({url:"/"+u.default.user.i18n+"/about/api/macrogroup/"})}catch(e){}try{j.groups=yield S.XHR.get({url:"/"+u.default.user.i18n+"/about/api/group/nomacrogroup/"})}catch(e){}j.layout.rightpanel=Object.assign(j.layout.rightpanel||{},{width:j.layout.rightpanel.width||50,height:j.layout.rightpanel.height||50,width_default:j.layout.rightpanel.width||50,height_default:j.layout.rightpanel.height||50,width_100:!1,height_100:!1}),u.default.gui.layout.app=j.layout,j.projects.forEach(function(e){return Object.assign(e,{baselayers:j.baselayers,minscale:j.minscale,maxscale:j.maxscale,crs:j.crs,vectorurl:j.vectorurl,rasterurl:j.rasterurl})});var i=setTimeout(function(){t("Timeout")},l.TIMEOUT);(0,J.getProject)(j.initproject,{map_theme:new URLSearchParams(location.search).get("map_theme")}).then(function(e){clearTimeout(i);var t=o("services/map").default.MapLayersStoresRegistry,a=(Object.assign(u.default.project,e),e.getLayersStore());u.default.catalog[a.getId()]=a,t.addLayersStore(a),g3wsdk.core.project.ProjectsRegistry.setCurrentProject(e),window.addEventListener("online",function(){u.default.online=!0,p.default.online()}),window.addEventListener("offline",function(){u.default.online=!1,p.default.offline()}),p.default.emit("ready"),u.default.map.epsg=e.state.crs.epsg,u.default.iframe&&o("services/iframe").default.init({project:e}),Object.keys(l.LOCAL_ITEM_IDS).forEach(function(e){try{void 0===(window.localStorage.getItem(e)?JSON.parse(window.localStorage.getItem(e)):void 0)&&window.localStorage.setItem(e,JSON.stringify(l.LOCAL_ITEM_IDS[e].value))}catch(e){}}),n(!0)}).catch(function(e){t(e)})}),function(e,t){return F.apply(this,arguments)})).then(function(){var e;O(),(isMobile.any||(window.initConfig.layout||{}).iframe)&&$("body").addClass("sidebar-collapse"),new Vue({el:"#app",created:function(){var e,t;Vue.component("app",z.default),Object.assign(P,{sidebar:[new function(){var i=u.default.project.getState(),a=new d.default({id:"metadata",collapsible:!1,icon:f.default.getFontClass("file"),iconColor:"#fff",title:"sdk.metadata.title",service:Object.assign(new c.default,{state:{name:i.title,groups:Object.entries({general:["title","name","description","abstract","keywords","fees","accessconstraints","contactinformation","wms_url"],spatial:["crs","extent"],layers:["layers"]}).reduce(function(e,t){var t=s(t,2),n=t[0],t=t[1];return e[n]=t.reduce(function(e,t){var a=(i.metadata&&i.metadata[t]?i.metadata:i)[t];return a&&(e[t]={value:a,label:"sdk.metadata.groups."+n+".fields."+t}),e},{}),e},{})},content:null,show:!1}),vueComponentObject:{template:"<div></div>"}});return a._setOpen=function(e){var t=a.getService();(t.show=e)?(t.content=new d.default({service:t,internalComponent:new(Vue.extend(o("components/MetadataProject.vue")))({state:t.state})}),t.content.layout=k.noop,f.default.setContent({content:t.content,title:"sdk.metadata.title",perc:100}),t.show=!0):f.default.closeContent()},f.default.on("closecontent",function(){return a.getService().state.open=!1}),a},new function(){var e=new d.default({id:"spatialbookmarks",icon:f.default.getFontClass("bookmark"),iconColor:"#00bcd4",title:"sdk.spatialbookmarks.title",vueComponentObject:o("components/SpatialBookMarks.vue")});return f.default.on("closecontent",function(){e.state.open=!1}),e},Object.assign(new d.default({id:"print",visible:window.initConfig.user.is_staff||0<(u.default.project.getPrint()||[]).length,icon:f.default.getFontClass("print"),iconColor:"#FF9B21",title:"print",service:{},internalComponent:new(Vue.extend(o("components/Print.vue")))}),{_setOpen:function(e){this.getInternalComponent().showPrintArea(e)}}),new d.default({id:"search",visible:!0,icon:f.default.getFontClass("search"),iconColor:"#8dc3e3",title:u.default.project.state.search_title||"search",service:Object.assign(new c.default,{state:{searches:(u.default.project.state.search||[]).sort(function(e,t){return(""+e.name).localeCompare(t.name)}),tools:[],querybuildersearches:(e=u.default.querybuilder.searches,t=u.default.project.getId(),e[t]=e[t]||[],e[t])},title:u.default.project.state.search_title||"search",addTool:function(e){this.state.tools.push(e)},addTools:function(e){var t=!0,a=!1,n=void 0;try{for(var i,r=e[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var o=i.value;this.addTool(o)}}catch(e){a=!0,n=e}finally{try{!t&&r.return&&r.return()}finally{if(a)throw n}}},showPanel:function(e){return new(o("components/g3w-search").SearchPanel)(e,!0)},getTitle:function(){return this.title},removeTools:function(){this.state.tools.splice(0)},stop:function(e){return(0,K.$promisify)(Promise.resolve(e))},removeTool:function(){}}),actions:[{id:"querybuilder",class:f.default.getFontClass("calculator")+" sidebar-button sidebar-button-icon",tooltip:C("sdk.querybuilder.title"),fnc:function(){return f.default.closeContent(),f.default.closeSideBar(),new D.default({title:C("sdk.querybuilder.title"),show:!0,vueComponentObject:o("components/QueryBuilder.vue")})},style:{color:"#8DC3E3",padding:"6px",fontSize:"1.2em",borderRadius:"3px",marginRight:"5px"}}],vueComponentObject:o("components/Search.vue")}),new function(){var e,i={id:"tools",icon:f.default.getFontClass("tools"),iconColor:"#FFE721",toolsGroups:[],visible:!1,loading:!1},a=new c.default({setters:{addTool:function(e,t){var a=t.title,t=t.position,n=i.toolsGroups.find(function(e){return e.name===a});return n||i.toolsGroups.splice(t,0,n={name:a,tools:[]}),n.tools.push(Object.assign(e,{state:e.state||{type:null,message:null},action:e.action||(M[e.type]||k.noop).bind(null,e.options)}))},addToolGroup:function(e,t){var a=i.toolsGroups.find(function(e){return e.name===t});return a||i.toolsGroups.splice(e,0,a={name:t,tools:[]}),a},addTools:function(e,t){var a=this;e.forEach(function(e){return a.addTool(e,t)})},removeToolGroup:function(t){i.toolsGroups=i.toolsGroups.filter(function(e){return e.name!==t})},removeTools:function(){i.toolsGroups.splice(0)}}}),n=(a.state=i,a.config=null,a.getState=function(){return i},a.reload=function(){a.removeTools()},a.setLoading=function(){i.loading=0<arguments.length&&void 0!==arguments[0]&&arguments[0]},a.ACTIONS=M,u.default.project.getState().tools||{});for(e in n)(t=>{a.addToolGroup(0,t.toUpperCase()),a.addTools(n[t].map(function(e){return{name:e.name,action:M[t].bind(null,e)}}),{position:0,title:t.toUpperCase()})})(e);var t,r=new d.default({id:"tools",icon:f.default.getFontClass("tools"),iconColor:"#FFE721",title:"tools",service:a,internalComponent:new(Vue.extend({template:'\n                    <ul class="g3w-tools treeview-menu">\n                      <bar-loader :loading="state.loading"/>\n                      <li v-for="g in state.toolsGroups" :key="g.name">\n                        <div class="tool-header"><i :class="g3wtemplate.getFontClass(\'tool\')"></i><span>{{ g.name }}</span></div>\n                        <div :id="g.name + \'-tools\'" class="tool-box"><g3w-tool v-for="t in g.tools" :key="t.name" :tool="t" /></div>\n                      </li>\n                    </ul>',components:{G3wTool:o("components/Tool.vue")},data:function(){return{state:null}},watch:{"state.toolsGroups":(t=L(function*(e){r.setVisible(0<e.length),this.$emit("visible",0<e.length),yield f.default.isReady(),document.querySelector("#g3w-sidebarcomponents #tools").classList.toggle("single",1===e.length&&"EDITING"===e[0].name)}),function(e){return t.apply(this,arguments)})}}))});return r._setOpen=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];(r.internalComponent.state.open=e)&&f.default.closeContent()},r},Object.assign(new d.default({id:"wms",icon:f.default.getFontClass("layers"),title:"sidebar.wms.add_wms_layer",service:{},internalComponent:new(Vue.extend(o("components/WMS.vue")))}),{_setOpen:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];(this.getInternalComponent().state.open=e)&&f.default.closeContent()}}),new function(){var e={id:"catalog",icon:f.default.getFontClass("map"),iconColor:"#019A4C",config:{legend:{config:(window.initConfig.layout||{}).legend}}},i={highlightlayers:!1,external:{wms:[],vector:[]},layerstrees:Object.values(u.default.catalog).map(function(e){return{tree:e.getLayersTree(),storeid:e.getId()}}),layersgroups:[],legend:Object.assign(e.config.legend||{},{place:u.default.project.state.legend_position||"tab"})},t=e.service||new c.default({setters:{addExternalLayer:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layer,e=e.type,e=void 0===e?"vector":e;t.removable=!0,i.external[e].push(t)},removeExternalLayer:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=e.name,e=e.type,n=void 0===e?"vector":e;i.external[n].filter(function(e,t){if(a===e.name)return i.external[n].splice(t,1),!0})}}});return t.state=i,t.createLayersGroup=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.title,e=e.layers;return{title:void 0===t?"Layers Group":t,nodes:(void 0===e?[]:e).map(function(e){return e})}},t.addLayersGroup=function(e){i.layersgroups.push(e)},t.getExternalLayers=function(e){e=e.type;return i.external[void 0===e?"vector":e]},new d.default(r({},e,{title:"catalog",resizable:!0,vueComponentObject:o("components/Catalog.vue"),service:t}))}],queryresults:new function(){var e=new d.default({id:"queryresults",title:"Query Results",service:o("services/queryresults").default,vueComponentObject:o("components/QueryResults.vue")});return e.getElement=function(){return e.internalComponent?e.internalComponent.$el:void 0},e.unmount=function(){return e.getService().closeComponent(),d.default.prototype.unmount.call(e)},e.layout=k.noop,e.getService().onafter("setLayersData",L(function*(){e.internalComponent||e.setInternalComponent(),yield e.internalComponent.$nextTick()})),e},map:new d.default({id:"map",title:"Map Component",service:new(o("services/map").default.MapService)({id:"map"}),vueComponentObject:o("components/Map.vue")}),content:Object.assign(new d.default({id:"contents",title:"contents",vueComponentObject:{template:'<div id="contents" class="contents"></div>'}}),{parent:null,contentsdata:u.default.contentsdata,getComponentById:function(t){return(u.default.contentsdata.find(function(e){return t==e.content.id})||{}).content}})}),this.$watch(function(){return u.default.language},O)},mounted:(e=L(function*(){yield this.$nextTick(),P.sidebar.forEach(function(e){isMobile.any&&!1===e.mobile||(u.default.sidebar.components.push(e),new(Vue.extend(o("components/SidebarItem.vue")))({component:e}).$mount())}),P.sidebar.forEach(function(e){return f.default.addComponent(e)}),f.default.addComponent(P.queryresults),$(document).localize(),P.map.mount("#g3w-view-map",!0),P.content.mount("#g3w-view-content",!0),f.default.addComponent(P.map),f.default.addComponent(P.content),yield this.$nextTick(),u.default.sizes.sidebar.width=$(".main-sidebar").width(),f.default.ready();try{var e,t=u.default.project.getGid(),a={},n=(Object.entries(window.initConfig.plugins).filter(function(e){return s(e,2)[1].gid===t}).forEach(function(e){var e=s(e,2),t=e[0];return a[t]=e[1]}),Object.assign(u.default.pluginsConfigs,a),Object.keys(u.default.pluginsConfigs).forEach(function(e){return u.default.configurationPlugins.push(e)}),Object.keys(u.default.pluginsConfigs).forEach(function(e){return u.default.plugins.push(e)}),u.default.project.getState()||{});for(e in n&&n.law&&n.law.length?(u.default.pluginsConfigs.law=n.law,u.default.pluginsConfigs.law.gid=n.gid):delete u.default.pluginsConfigs.law,u.default.pluginsConfigs)Object.entries(u.default.pluginsConfigs[e].plugins||{}).forEach(function(e){var e=s(e,2),t=e[0];return u.default.pluginsConfigs[t]=r({},u.default.pluginsConfigs[t],e[1])});yield Promise.allSettled(Object.entries(u.default.pluginsConfigs).map((i=L(function*(e){var e=s(e,2),t=e[0],e=e[1];if(e){e.baseUrl=window.initConfig.urls.staticurl;try{yield Promise.all((e.jsscripts||[]).map(I)),yield I(""+window.initConfig.urls.staticurl+t+"/js/plugin.js?"+Date.now())}catch(e){return u.default.plugins=u.default.plugins.filter(function(e){return t!==e}),Promise.reject()}}}),function(e){return i.apply(this,arguments)})))}catch(e){}var i;p.default.complete=!0,p.default.emit("complete")}),function(){return e.apply(this,arguments)})})}).catch(function(e){e&&(e.responseJSON&&e.responseJSON.error.data?e=e.responseJSON.error.data:e.statusText&&(e=e.statusText)),$("#startingspinner").remove(),new Vue(r({el:"#app"},Vue.compile('<div class="error-initial-page skin-background-color">\n          <template v-if="isMobile()">\n            <h3 class="oops">Oops!</h3>\n            <h5 class="cause">'+(e||C("error_page.error"))+'</h5>\n            <h6 class="at-moment">'+C("error_page.at_moment")+'</h6>\n            <h4 class="f5">'+C("error_page.f5")+'</h4>\n          </template>\n          <template v-else>\n            <h1 class="oops">Oops!</h1>\n            <h1 class="cause">'+(e||C("error_page.error"))+'</h1>\n            <h3 class="at-moment">'+C("error_page.at_moment")+'</h3>\n            <h2 class="f5">'+C("error_page.error")+"</h2>\n          </template>\n        </div>")))})},{"./deprecated":127,"./g3w-globals":142,"components/App.vue":36,"components/Catalog.vue":37,"components/GlobalBarLoader.vue":55,"components/GlobalDateTime.vue":56,"components/GlobalDivider.vue":57,"components/GlobalGallery.vue":58,"components/GlobalGeo.vue":59,"components/GlobalHelpDiv.vue":60,"components/GlobalImage.vue":61,"components/GlobalLayerPositions.vue":62,"components/GlobalProgressBar.vue":63,"components/GlobalRange.vue":64,"components/GlobalResize.vue":65,"components/GlobalResizeIcon.vue":66,"components/GlobalSkeleton.vue":67,"components/GlobalTabs.vue":68,"components/Map.vue":91,"components/MetadataProject.vue":98,"components/Print.vue":99,"components/QueryBuilder.vue":102,"components/QueryResults.vue":103,"components/Search.vue":116,"components/SidebarItem.vue":118,"components/SpatialBookMarks.vue":119,"components/Tool.vue":121,"components/WMS.vue":123,"components/g3w-search":126,"directives/v-checked":129,"directives/v-click-outside":130,"directives/v-disabled":131,"directives/v-download":132,"directives/v-select2":133,"directives/v-t":138,"directives/v-t-html":134,"directives/v-t-plugin":135,"directives/v-t-title":136,"directives/v-t-tooltip":137,"g3w-component":139,"g3w-constants":140,"g3w-i18n":143,"g3w-object":144,"g3w-panel":145,locales:152,"services/application":186,"services/gui":188,"services/iframe":189,"services/map":190,"services/queryresults":191,"store/application":193,"utils/XHR":196,"utils/getProject":227,"utils/noop":242,"utils/promisify":247}],148:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default={translation:{error_page:{error:"Verbindungsfehler",at_moment:"Karte anzeigen ist im Moment nicht möglich",f5:"Drücken Sie Strg+F5"},cookie_law:{message:"Diese Website verwendet Cookies, um Ihnen die bestmögliche Erfahrung auf unserer Website zu bieten.",buttonText:"Verstanden!"},default:"default",sign_in:"Anmelden",layer_selection_filter:{tools:{filter:"Filter aktivieren/deaktivieren",nofilter:"Filter entfernen",invert:"Auswahl umkehren",clear:"Auswahl löschen",show_features_on_map:"Aktualisieren Sie die Ergebnisse beim Verschieben der Karte",savefilter:"Filter speichern",filterName:"Filtername"}},warning:{not_supported_format:"Nicht unterstütztes Format"},layer_position:{top:"OBEN",bottom:"UNTEN",message:"Position relativ zu den Layern im TOC"},sdk:{atlas:{template_dialog:{title:"Template auswählen"}},spatialbookmarks:{title:"Räumliche Lesezeichen",helptext:"Bewegen Sie sich auf der Kartenausdehnung, fügen Sie den Namen ein und klicken Sie auf Hinzufügen",input:{name:"Name"},sections:{project:{title:"Projekt-Lesezeichen"},user:{title:"Benutzer-Lesezeichen"}}},search:{all:"ALLE",no_results:"Keine Ergebnisse",searching:"Suchen ...",error_loading:"Fehler beim Datenladen",layer_not_searchable:"Layer ist nicht durchsuchbar",layer_not_querable:"Layer ist nicht abfragbar",autocomplete:{inputshort:{pre:"Bitte",post:"oder mehrere Zeichen eingeben"}}},print:{no_layers:"Kein Layer zu drucken",template:"Template",labels:"Labels",scale:"Skala",format:"Format",rotation:"Drehung",download_image:"Bild herunterladen",fids_instruction:"Akzeptierte Werte: von 1 bis [max]. Es ist möglich, ein Intervall einzugeben, z. B. 4-6",fids_example:"Bsp. 1,4-6 druckt id 1,4,5,6",help:"Die im Druck angezeigten Layer können die im Projekt definierten sein und nicht die auf der Karte angezeigten"},querybuilder:{search:{run:"Ausführen",info:"Information",delete:"Löschen",edit:"Bearbeiten"},messages:{changed:"Gespeichert",number_of_features:"Anzahl der Features"},panel:{button:{all:"ALLE",save:"SPEICHERN",test:"TEST",clear:"LÖSCHEN",run:"AUSFÜHREN",manual:"MANUELL"},layers:"LAYERS",fields:"FELDER",values:"WERTE",operators:"OPERATOREN",expression:"AUSDRUCK"},error_run:"Es ist ein Fehler aufgetreten. Bitte überprüfen Sie die Abfrage",error_test:"Während der Ausführung der Abfrage ist ein Fehler aufgetreten",delete:"Soll es gelöscht werden?",additem:"Geben Sie den Namen der neuen Suche ein"},errors:{layers:{load:"Einige Layer sind nicht verfügbar"},unsupported_format:"Nicht unterstütztes Format",add_external_layer:"Fehler im Ladevorgang des Layers"},metadata:{title:"Metadaten",groups:{general:{title:"ALLGEMEIN",fields:{title:"TITEL",name:"NAME",description:"BESCHREIBUNG",abstract:"ABASTRACT",keywords:"SCHLÜSSELWÖRTER",fees:"GEBÜHREN",accessconstraints:"ZUGRIFFSBESCHRÄNKUNG",contactinformation:"KONTAKTE",subfields:{contactinformation:{contactelectronicmailaddress:"Email",personprimary:"Referenzen",contactvoicetelephone:"Telefon",contactorganization:"Firma",ContactOrganization:"Firma",contactposition:"Position",ContactPosition:"Position",contactperson:"Person",ContactPerson:"Person"}},wms_url:"WMS"}},spatial:{title:"SPATIAL",fields:{crs:"EPSG",extent:"BBOX"}},layers:{title:"LAYERS",fields:{layers:"LAYERS",subfields:{crs:"EPSG",bbox:"BBOX",title:"TITEL",name:"NAME",geometrytype:"GEOMETRIE",source:"QUELLE",attributes:"ATTRIBUTE",abstract:"ABSTRACT",attribution:"ATRIBUTION",keywords:"SCHLÜSSELWÖRTER",metadataurl:"METADATEN URL",dataurl:"DATEN URL"}},groups:{general:"ALLGEMEIN",spatial:"SPATIAL"}}}},tooltips:{relations:{form_to_row:"Zeilenansicht",row_to_form:"Formularansicht",zoomtogeometry:"Auf Geometrie zoomen"},copy_map_extent_url:"Link zur Kartenansicht kopieren",download_shapefile:"Shapefile herunterladen",download_gpx:"DGPX herunterladen",download_gpkg:"GPKG herunterladen",download_csv:"CSV herunterladen",download_xls:"XLS herunterladen",download_pdf:"PDF herunterladen",show_chart:"Diagramm anzeigen",atlas:"Atlas drucken",editing:"Editing"},mapcontrols:{query:{tooltip:"Query layer",actions:{add_selection:{hint:"Auswahl hinzufügen/entfernen"},zoom_to_features_extent:{hint:"Zoom auf Feature-Ausdehnung"},add_features_to_results:{hint:"Hinzufügen/Entfernen von Features zu den Ergebnissen"},remove_feature_from_results:{hint:"Feature aus den Ergebnissen entfernen"},zoom_to_feature:{hint:"Zum Feature zoomen"},relations:{hint:"Relationen anzeigen"},relations_charts:{hint:"Relationship-Diagramm anzeigen"},download_features_shapefile:{hint:"Features Shapefile herunterladen"},download_shapefile:{hint:"Feature Shapefile herunterladen"},download_features_gpx:{hint:"Feature GPX herunterladen"},download_features_gpkg:{hint:"Feature GPKG herunterladen"},download_gpx:{hint:"Feature GPX herunterladen"},download_gpkg:{hint:"Feature GPKG herunterladen"},download_features_csv:{hint:"Features CSV herunterladen"},download_csv:{hint:"Feature CSV herunterladen"},download_features_xls:{hint:"Features XLS herunterladen"},download_xls:{hint:"Feature XLS herunterladen"},download_pdf:{hint:"Feature PDF herunterladen"},atlas:{hint:"Atlas drucken"},copy_zoom_to_fid_url:{hint:"Kopieren der Karten-URL mit dieser Geometrie-Feature-Erweiterung",hint_change:"Kopiert"}}},queryby:{title:"Query area",layer:"Selected layer:",none:"NONE",new:"TEMPORARY LAYER",all:"ALL",methods:{intersects:"intersects",within:"within"},querybypolygon:{tooltip:"select a polygon"},querybydrawpolygon:{tooltip:"draw a polygon"},querybbox:{tooltip:"draw a rectangle"},querybycircle:{tooltip:"draw a circle"}},querybypolygon:{download:{title:"Attribute herunterladen",choiches:{feature:{label:"Nur Features"},feature_polygon:{label:"Features+Query Polygon"}}},tooltip:"Query nach Polygon",no_geometry:"Keine Geometrie in der Antwort",help:{message:"<ul><li>Wählen Sie einen Polygon Layer auf TOC.</li><li>Stellen Sie sicher, dass der Layer sichtbar ist.</li><li>Klicken Sie auf ein Feature des ausgewählten Layers.</li></ul>"}},querybydrawpolygon:{tooltip:"Abfrage durch Polygon zeichnen"},querybbox:{tooltip:"BBox Layer abfragen",nolayers_visible:"Es sind keine abfragbaren Layer sichtbar. Bitte setzen Sie mindestens einen sichtbaren wfs Layer, um die Abfrage zu starten",help:{message:"<ul><li>Ein Quadrat auf der Karte ziehen, um unterstrichene Layer im TOC abzufragen</li></ul>"}},addlayer:{messages:{csv:{warning:"Das Ergebnis in der Karte ist unvollständig, da die unten stehende Liste fehlerhafter Einträge enthält:"}},tooltip:"Layer hinzufügen"},geolocation:{tooltip:"Geolokalisierung"},measures:{length:{tooltip:"Länge",help:"Klicken Sie auf die Karte, um die Linie zu zeichnen. Drücken Sie <br>CANC, wenn Sie den letzten Eckpunkt löschen möchten."},area:{tooltip:"Fläche",help:"Drücken Sie <br>CANC, wenn Sie den letzten Eckpunkt löschen wollen."}},scale:{no_valid_scale:"Ungültige Skala"},scaleline:{units:{metric:"Meter",nautical:"Nautische Meile"}},zoomhistory:{zoom_last:"Zoom Vorheriger",zoom_next:"Zoom Nächster"}},relations:{relation_data:"Daten zur Relation",no_relations_found:"Keine Relationen gefunden",back_to_relations:"Zurück zu den Relationen",list_of_relations_feature:"Liste der Relationen des Features",error_missing_father_field:"Ein Feld fehlt",field:"Relation key field"},form:{loading:"Laden ...",inputs:{messages:{errors:{picklayer:"Kein Feature ausgewählt. Prüfen, ob der Layer in Bearbeitung oder im aktuellen Maßstab sichtbar ist"}},tooltips:{picklayer:"Wert aus dem Layer abrufen",lonlat:"Zum Abrufen der Koordinaten auf die Karte klicken"},input_validation_mutually_exclusive:"Feld schließt sich gegenseitig aus mit ",input_validation_error:"Obligatorisches Feld oder falscher Datentyp",input_validation_min_field:"Der Wert muss größer/gleich sein als der Feldwert  ",input_validation_max_field:"Der Wert muss kleiner/gleich sein als der Feldwert ",input_validation_exclude_values:"Wert muss einmalig sein",integer:"integer",bigint:"integer",text:"text",varchar:"text",textarea:"text",string:"string",date:"date",datetime:"date",float:"float",table:"table"},footer:{required_fields:"Erforderliche Felder"},messages:{qgis_input_widget_relation:"Spezifisches Relations-Formular verwenden, um mit Relationen zu arbeiten"}},catalog:{current_map_theme_prefix:"THEMA",choose_map_theme:"THEMA AUSWÄHLEN",choose_map_theme_input_label:"Name des neuen Themes",project_map_theme:"Projekt Themes",user_map_theme:"Benutzer Themes",question_delete_map_theme:"Möchten Sie das Thema löschen??",delete_map_theme:"Theme erfolgreich gelöscht",saved_map_theme:"Thema erfolgreich gespeichert",updated_map_theme:"Thema aktualisieren gespeichert",invalid_map_theme_name:"Der Name ist bereits vorhanden oder falsch",menu:{layerposition:"Position der Ebenen",setwmsopacity:"Opazität einstellen",wms:{title:"",copy:"Klicken Sie hier, um die Url zu kopieren",copied:"Kopiert"},download:{unknow:"Herunterladen",shp:"Shapefile herunterladen",gpx:"GPX herunterladen",gpkg:"GPKG herunterladen",csv:"CSV herunterladen",xls:"XLS herunterladen",geotiff:"GEOTIFF herunterladen",geotiff_map_extent:"GEOTIFF herunterladen (aktueller Ansichtsumfang)"}}},wps:{list_process:"Liste der Prozesse",tooltip:"Karte anklicken"}},credits:{g3wSuiteFramework:"Applikation basiert auf OS-Framework",g3wSuiteDescription:"Veröffentlichen und verwalten Sie Ihre QGIS-Projekte im Internet",productOf:"Framework entwickelt von"},toggle_color_scheme:"Farbschema umschalten",logout:"Logout",no_other_projects:"Kein weiteres Projekt für diese Gruppe",no_other_groups:"Keine weiteren Gruppen für diese Makrogruppe",yes:"Ja",no:"No",back:"Zurück",backto:"Zurück zu ",changemap:"Karte ändern",change_session:"Sitzung ändern",component:"Allgemeine Komponente",search:"Suche",no_results:"Keine Ergebnisse gefunden",print:"Drucken",create_print:"Drucken erstellen",dosearch:"Suche",catalog:"Karte",data:"Daten",externalwms:"WMS",baselayers:"Base",tools:"Tools",tree:"Layers",legend:"Legende",nobaselayer:"Keine Basemap",street_search:"Adresse finden",show:"Anzeigen",hide:"Ausblenden",copy_form_data:"Daten kopieren",paste_form_data:"Einfügen",copy_form_data_from_feature:"Daten von der Karte kopieren",error_map_loading:"Fehler beim Laden der Karte",check_internet_connection_or_server_admin:"Internetverbindung prüfen oder Admin kontaktieren",could_not_load_vector_layers:"Verbindungsfehler: Layers können geladen werden",server_saver_error:"Fehler beim Speichern auf dem Server",server_error:"Server-Verbindungsfehler",save:"Speichern",cancel:"Abbrechen",update:"Aktualisieren",close:"Schließen",dont_show_again:"Diese Meldung nicht mehr anzeigen",enlange_reduce:"Vergrößern / Verkleinern",reset_default:"Standardgröße",add:"Hinzufügen",exitnosave:"Beenden ohne Speichern",annul:"Abbrechen",layer_is_added:"Layer mit gleichem Namen bereits hinzugefügt",sidebar:{wms:{panel:{title:"WMS Layer hinzufügen",label:{position:"Kartenposition",name:"Name",projections:"Projektion",layers:"Layers"}},add_wms_layer:"WMS Layer hinzufügen",delete_wms_url:"WMS Url löschen",layer_id_already_added:"WMS Layer bereits hinzugefügt",url_already_added:"WMS URL/Name bereits hinzugefügt",layer_add_error:"WMS Layer nicht hinzugefügt. Bitte überprüfen Sie alle WMS-Parameter oder Url"}},info:{title:"Ergebnisse",list_of_relations:"List of Relations",open_link:"Beigefügtes Dokument öffnen",server_error:"Auf dem Server ist ein Fehler aufgetreten",no_results:"Keine Ergebnisse für diese Anfrage/Suche gefunden",link_button:"Öffnen"},mapcontrols:{geolocation:{error:"Position kann nicht bestimmt werden"},geocoding:{choose_layer:"Wählen Sie eine Ebene aus, auf der Sie diese Funktion hinzufügen möchten",placeholder:"Addresse ...",nolayers:"Für dieses Projekt wurden keine bearbeitbaren Punktebenen gefunden",noresults:"Keine Ergebnisse",notresponseserver:"Keine Antwort vom Server"},add_layer_control:{header:"Layer hinzufügen",select_projection:"Layer Projektion auswählen",select_field_to_show:"Feld auswählen, das auf der Karte angezeigt werden soll",select_csv_separator:"Begrenzer auswählen",select_csv_x_field:"X-Feld auswählen",select_csv_y_field:"Y-Feld auswählen",select_color:"Layer Farbe auswählen",drag_layer:"Layer hierher ziehen und ablegen"},query:{input_relation:"Klicken, um Relationen anzuzeigen"},length:{tooltip:"Länge"},area:{tooltip:"Area"},screenshot:{error:"Screenshot Fehlererstellung",securityError:'  \n        <p><b>Sicherheitsfehler</b>: Eine externe Ebene verhindert, dass die Karte gedruckt wird. Gehen Sie zur Überprüfung wie folgt vor:</p>\n        <ol>\n          <li>Entfernen Sie alle manuell hinzugefügten externen Ebenen (z. B. WMS-Ebenen)</li>\n          <li>Neuladen der Seite erzwingen: <code>STRG + F5</code></li>\n          <li>Drucken Sie die Karte erneut</li>\n        </ol>\n        <p>Für weitere Informationen wenden Sie sich bitte an den Serveradministrator zu: <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image" style="color: #000 !important;font -weight: fett;">&#x2139;&#xFE0F; Sicherheit und befleckte Leinwände</a></p>\n        '}},catalog_items:{helptext:"Klicken Sie mit der rechten Maustaste auf einen einzelnen Layer, um auf zusätzliche Funktionen zuzugreifen",contextmenu:{zoomtolayer:"Zoom auf Layer",open_attribute_table:"Attributtabelle öffnen",show_metadata:"Metadaten",styles:"Stile",vector_color_menu:"Farbe einstellen/ändern",layer_opacity:"Opazität",filters:"Filters"}},dataTable:{previous:"Vorherige",next:"Weiter",lengthMenu:"Zeigen Sie _MENU_ Werte pro Seite an",info:"_TOTAL_ Ergebnissen",no_data:"Keine Daten",nodatafilterd:"Keine passenden Datensätze gefunden",infoFiltered:"(gefiltert aus _MAX_ Gesamtsätzen)"}}}},{}],149:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default={translation:{error_page:{error:"Connection error",at_moment:"At the moment is not possible show map",f5:"Press Ctrl+F5"},cookie_law:{message:"This website uses cookies to ensure you get the best experience on our website.",buttonText:"Got It!"},default:"default",sign_in:"Sign in",layer_selection_filter:{tools:{filter:"Enable/Disable filter",nofilter:"Remove Filter",invert:"Invert Selection",clear:"Clear Selection",show_features_on_map:"Update results when map moves",savefilter:"Save Filter",filterName:"Filter Name"}},warning:{not_supported_format:"Not supported format"},layer_position:{top:"TOP",bottom:"BOTTOM",message:"Position relative to layers on TOC"},sdk:{atlas:{template_dialog:{title:"Select Template"}},spatialbookmarks:{title:"Bookmarks",helptext:"Move on map extent, insert name and click Add",input:{name:"Name"},sections:{project:{title:"Project Bookmarks"},user:{title:"User Bookmarks"}}},search:{all:"ALL",no_results:"No results",searching:"Searching ...",error_loading:"Error Loading Data",layer_not_searchable:"Layer is not searchable",layer_not_querable:"Layer is not querable",autocomplete:{inputshort:{pre:"Please enter",post:"or more characters"}}},print:{no_layers:"No Layer to print",template:"Template",labels:"Labels",scale:"Scale",format:"Format",rotation:"Rotation",download_image:"Download Image",fids_instruction:"Values accepted: from 1 to value of [max]. Is possible to insert a range ex. 4-6",fids_example:"Ex. 1,4-6 will be printed id 1,4,5,6",help:"The layers shown in the print could be those defined on the project and not those displayed on the map"},querybuilder:{title:"Advanced search",search:{run:"Run",info:"Information",delete:"Delete",edit:"Edit"},messages:{changed:"Saved",number_of_features:"Features found:"},panel:{button:{all:"SEARCH A VALUE",save:"SAVE",test:"TEST",clear:"CLEAR",run:"RUN",manual:"MANUAL"},layers:"LAYERS",fields:"FIELDS",values:"VALUES",operators:"OPERATORS",expression:"EXPRESSION"},error_run:"An error occurs. Please check the query",error_test:"An error occur during query execution",delete:"Do you want delete it?",additem:"Insert the name of the new search"},errors:{layers:{load:"Some layers are not available"},unsupported_format:"Not supported format",add_external_layer:"Load layer error"},metadata:{title:"Metadata",groups:{general:{title:"GENERAL",fields:{title:"TITLE",name:"NAME",description:"DESCRIPTION",abstract:"ABSTRACT",keywords:"KEYWORDS",fees:"FEES",accessconstraints:"ACCESS CONSTRAINT",contactinformation:"CONTACTS",subfields:{contactinformation:{contactelectronicmailaddress:"Email",personprimary:"References",contactvoicetelephone:"Phone",contactorganization:"Organization",ContactOrganization:"Organization",contactposition:"Position",ContactPosition:"Position",contactperson:"Person",ContactPerson:"Person"}},wms_url:"WMS"}},spatial:{title:"SPATIAL",fields:{crs:"EPSG",extent:"BBOX"}},layers:{title:"LAYERS",fields:{layers:"LAYERS",subfields:{crs:"EPSG",bbox:"BBOX",title:"TITLE",name:"NAME",geometrytype:"GEOMETRY",source:"SOURCE",attributes:"ATTRIBUTES",abstract:"ABSTRACT",attribution:"ATTRIBUTION",keywords:"PAROLE CHIAVE",metadataurl:"METADATA URL",dataurl:"DATA URL"}},groups:{general:"GENERAL",spatial:"SPATIAL"}}}},tooltips:{relations:{form_to_row:"Row View",row_to_form:"Form View",zoomtogeometry:"Zoom to Geometry"},copy_map_extent_url:"Copy share URL",download_shapefile:"Download Shapefile",download_gpx:"Download GPX",download_gpkg:"Download GPKG",download_csv:"Download CSV",download_xls:"Download XLS",download_pdf:"Download PDF",show_chart:"Show Chart",atlas:"Print Atlas",editing:"Editing"},mapcontrols:{query:{tooltip:"Query layer",actions:{add_selection:{hint:"Add/Remove Selection"},zoom_to_features_extent:{hint:"Zoom to features extent"},add_features_to_results:{hint:"Add/Remove features to results"},remove_feature_from_results:{hint:"Remove feature from results"},zoom_to_feature:{hint:"Zoom to feature"},relations:{hint:"Show Relations"},relations_charts:{hint:"Show relations chart"},download_features_shapefile:{hint:"Download features Shapefile"},download_shapefile:{hint:"Download feature Shapefile"},download_features_gpx:{hint:"Download feature GPX"},download_features_gpkg:{hint:"Download features GPKG"},download_gpx:{hint:"Download feature GPX"},download_gpkg:{hint:"Download feature GPKG"},download_features_csv:{hint:"Download features CSV"},download_csv:{hint:"Download feature CSV"},download_features_xls:{hint:"Download features XLS"},download_xls:{hint:"Download feature XLS"},download_pdf:{hint:"Download feature PDF"},atlas:{hint:"Print Atlas"},copy_zoom_to_fid_url:{hint:"Share via link",hint_change:"Copied"}}},queryby:{title:"Query area",layer:"Selected layer:",none:"NONE",new:"TEMPORARY LAYER",all:"ALL",methods:{intersects:"intersects",within:"within"},querybypolygon:{tooltip:"select a polygon"},querybydrawpolygon:{tooltip:"draw a polygon"},querybbox:{tooltip:"draw a rectangle"},querybycircle:{tooltip:"draw a circle"}},querybypolygon:{download:{title:"Attributes download",choiches:{feature:{label:"Features only"},feature_polygon:{label:"Features+Query Polygon"}}},tooltip:"Query By Polygon",no_geometry:"No geometry on response",help:{message:"<ul><li>Select a (visible) layer.</li><li>Click on a geometry within map.</li></ul>"}},querybydrawpolygon:{tooltip:"Query by Draw Polygon ",help:{message:"<ul><li>Click on map to add a new vertex</li><li>Double click to finish and query layers (underlined in yellow in legend)</li></ul>"}},querybbox:{tooltip:"Query BBox layer",nolayers_visible:"No querable layers are visible. Please set at least one visible wfs layer to run query",help:{message:"<ul><li>Drag the mouse to draw a rectangle and query layers (underlined in yellow in legend)</li></ul>"}},querybycircle:{tooltip:"Query by Draw Circle ",label:"Radius",help:{message:"<ul><li>Click on map to draw circle</li></ul>"}},addlayer:{messages:{csv:{warning:"The result in the map is partial due to the presence of the below incorrect records list:"}},tooltip:"Add Layer"},geolocation:{tooltip:"Geolocation"},measures:{title:"Measure",length:{tooltip:"Length",help:"Click on map to draw the line. Press <br>CANC if you want delete last vertex"},area:{tooltip:"Area",help:"Click to draw poligon.Press <br>CANC if you want delete last vertex"}},screenshot:{title:"Screen capture",screenshot:"PNG",geoscreenshot:"GeoTIFF",download:"Generate"},scale:{no_valid_scale:"Invalid Scale"},scaleline:{units:{metric:"Meters",nautical:"Nautical Mile"}},zoomhistory:{zoom_last:"Zoom Last",zoom_next:"Zoom Next"}},relations:{relation_data:"Relation data",no_relations_found:"No relations found",back_to_relations:"Back to relations",list_of_relations_feature:"List of relations of feature",error_missing_father_field:"Field is missing",field:"Relation key field"},form:{loading:"Loading ...",inputs:{messages:{errors:{picklayer:"No feature selected. Check if layer is on editing or visible at current scale"}},tooltips:{picklayer:"Get value from ma layer",lonlat:"Click on map to get coordinates"},input_validation_mutually_exclusive:"Field mutually exclusive with ",input_validation_error:"Mandatory Field or wrong data type",input_validation_min_field:"Value has to be more/equal to field value  ",input_validation_max_field:"Value has to be less/equal to field value ",input_validation_exclude_values:"Value has to be unique",integer:"integer",bigint:"integer",text:"text",varchar:"text",textarea:"text",string:"string",date:"date",datetime:"date",float:"float",table:"table"},footer:{required_fields:"Required fields"},messages:{qgis_input_widget_relation:"Use relation specific form to work with relation"}},catalog:{current_map_theme_prefix:"THEME",choose_map_theme:"CHOOSE THEME",choose_map_theme_input_label:"Name of new map theme",project_map_theme:"Project Themes",user_map_theme:"User Themes",question_delete_map_theme:"Do you want delete the theme?",delete_map_theme:"Theme deleted successfully",saved_map_theme:"Theme saved successfully",updated_map_theme:"Theme updated successfully",invalid_map_theme_name:"Invalid or exiting name",menu:{layerposition:"Layer Position",setwmsopacity:"Set Opacity",wms:{title:"",copy:"Click here to copy url",copied:"Copied"},download:{unknow:"Download",shp:"Download Shapefile",gpx:"Download GPX",gpkg:"Download GPKG",csv:"Download CSV",xls:"Download XLS",geotiff:"Download GEOTIFF",geotiff_map_extent:"Download GEOTIFF(current view extent)"}}},wps:{list_process:"List of process",tooltip:"Click on map"}},credits:{g3wSuiteFramework:"Application based on OS framework",g3wSuiteDescription:"Publish and manage your QGIS projects on the web",productOf:"Framework developed by"},toggle_color_scheme:"Toggle color scheme",logout:"Logout",no_other_projects:"No more project for this group",no_other_groups:"No more groups for this Macrogroup",yes:"Yes",no:"No",back:"Back",backto:"Back to ",changemap:"Change Map",change_session:"Change Session",component:"Generic Component",search:"Search",no_results:"No results found",print:"Print",create_print:"Create Print",dosearch:"Search",catalog:"Map",data:"Data",externalwms:"WMS",baselayers:"Base",tools:"Tools",tree:"Layers",legend:"Legend",nobaselayer:"No basemap",street_search:"Find Address",show:"Show",hide:"Hide",copy_form_data:"Copy data",paste_form_data:"Paste",copy_form_data_from_feature:"Copy data from map",error_map_loading:"Error occurs loading map",check_internet_connection_or_server_admin:"Check internet connection or contact admin",could_not_load_vector_layers:"Connection error: Layers can be loaded",server_saver_error:"Error in server saving",server_error:"Server connection error",save:"Save",cancel:"Cancel",update:"Update",close:"Close",dont_show_again:"Don't show again",enlange_reduce:"Enlarge / Reduce",reset_default:"Default size",add:"Add",exitnosave:"Exit without save",annul:"Cancel",layer_is_added:"Layer with same name already added",sidebar:{wms:{panel:{title:"Add WMS Layer",label:{position:"Map Position",name:"Name",projections:"Projection",layers:"Layers"}},add_wms_layer:"Add WMS layer",delete_wms_url:"Delete WMS url",layer_id_already_added:"WMS Layer already added",url_already_added:"WMS URL/Name already added",layer_add_error:"WMS Layer not added. Please check all wms parameter or url"}},info:{title:"Results",list_of_relations:"List of Relations",open_link:"Open attached document",server_error:"An error occurred from server",no_results:"No results found for this query/search",link_button:"Open"},mapcontrols:{geolocation:{error:"Can't get your position"},geocoding:{choose_layer:"Choose a layer where to add this feature",placeholder:"Address ...",nolayers:"No editable point layers found on this project",noresults:"No results",notresponseserver:"No response from server"},add_layer_control:{header:"Add Layer",select_projection:"Select layer projection",select_field_to_show:"Select Field to show on map",select_csv_separator:"Select delimiter",select_csv_x_field:"Select X field",select_csv_y_field:"Select Y field",select_color:"Select Layer Color",drag_layer:"Drag and drop layer here",persistent_data:"Persistent data",persistent_help:"save layer into browser storage"},query:{input_relation:"Click to show relations"},length:{tooltip:"Length"},area:{tooltip:"Area"},screenshot:{error:"Screenshot error creation",securityError:'  \n        <p><b>Security Error</b>: an external layer is preventing map from being printed. To check, proceed as follows:</p>\n        <ol>\n          <li>remove any manually added external layers (eg. WMS layers)</li>\n          <li>force page reload: <code>CTRL + F5</code></li>\n          <li>print again the map</li>\n        </ol>\n        <p>For more info please contact server administrator about: <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image" style="color: #000 !important;font-weight: bold;">&#x2139;&#xFE0F; security and tainted canvases</a></p>\n        '}},catalog_items:{helptext:"Right-click on individual layer to access additional features",contextmenu:{zoomtolayer:"Zoom to Layer",open_attribute_table:"Open Attribute Table",show_metadata:"Metadata",styles:"Styles",vector_color_menu:"Set/Change Color",layer_opacity:"Opacity",filters:"Filters"}},dataTable:{previous:"Previous",next:"Next",lengthMenu:"Show _MENU_ values per page",info:"_TOTAL_ entries",no_data:"No data",nodatafilterd:"No matching records found",infoFiltered:"(filtered from _MAX_ total records)"},no_geometry:"This item has no geometry"}}},{}],150:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default={translation:{error_page:{error:"Yhteysvirhe",at_moment:"Tällä hetkellä ei ole mahdollista näyttää karttaa",f5:"Paina Ctrl+F5"},cookie_law:{message:"This website uses cookies to ensure you get the best experience on our website.",buttonText:"Got It!"},default:"oletuksena",sign_in:"Kirjaudu sisään",layer_selection_filter:{tools:{filter:"Ota suodatin käyttöön/poista käytöstä",nofilter:"Poista Suodattaa",invert:"Käänteinen Valinta",clear:"Peruuttaa Valinta",show_features_on_map:"Päivitä tulokset karttaa siirtäessäsi",savefilter:"Tallenna suodatin",filterName:"Suodattimen Nimi"}},warning:{not_supported_format:"Not supported format"},layer_position:{top:"TOP",bottom:"BOTTOM",message:"Position relative to layers on TOC"},sdk:{atlas:{template_dialog:{title:"Valitse Template"}},spatialbookmarks:{title:"Tilalliset kirjanmerkit",helptext:"Siirry kartan laajuuteen, lisää nimi ja napsauta Lisää",input:{name:"Nimi"},sections:{project:{title:"Projektin kirjanmerkit"},user:{title:"Käyttäjän kirjanmerkit"}}},search:{all:"KAIKKI",no_results:"Ei tuloksia",searching:"Haetaan ...",error_loading:"Virhe ladattaessa tietoja.",layer_not_searchable:"Taso ei ole haettavissa.",layer_not_querable:"Tasolle ei voi suorittaa kyselyitä.",autocomplete:{inputshort:{pre:"Syötä",post:"tai useampi merkki"}}},print:{no_layers:"Ei tulostettavia tasoja",template:"Template",labels:"Labels",scale:"Mittakaava",format:"Formaatti",rotation:"Kierto",download_image:"Lataa kuva",fids_instruction:"Hyväksytyt arvot: yhdestä arvoon [max]. Salittua syöttää myös väli, esim. 4-6.",fids_example:"Esimerkiksi 1,4-6 tulostuu id 1,4,5,6.",help:"Tulosteessa esiintyvät tasot voivat olla projektissa määriteltyjä ei kartalla esiintyviä."},querybuilder:{search:{run:"Suorita",info:"Informaatio",delete:"Poista",edit:"Muokkaa"},messages:{changed:"Tallennettu",number_of_features:"Ominaisuuksien lukumäärä"},panel:{button:{all:"KAIKKI",save:"TALLENNA",test:"TESTI",clear:"TYHJENNÄ",run:"SUORITA",manual:"MANUAALINEN"},layers:"TASOT",fields:"KENTÄT",values:"ARVOT",operators:"OPERAATTORIT",expression:"LAUSEKE"},error_run:"Tapahtui virhe. Tarkista kysely.",error_test:"Kyselyä suorittaessa tapahtui virhe.",delete:"Haluatko poistaa sen?",additem:"Anna nimi uudelle haulle."},errors:{layers:{load:"Jotkin tasot eivät ole saatavilla."},unsupported_format:"Ei tuettu formaatti",add_external_layer:"Tason latausvirhe"},metadata:{title:"Metatiedot",groups:{general:{title:"YLEINEN",fields:{title:"OTSIKKO",name:"NIMI",description:"KUVAUS",abstract:"TIIVISTELMÄ",keywords:"AVAINSANAT",fees:"MAKSUT",accessconstraints:"PÄÄSYRAJOITUKSET",contactinformation:"YHTEYSTIEDOT",subfields:{contactinformation:{contactelectronicmailaddress:"Sähköposti",personprimary:"Viitteet",contactvoicetelephone:"Puhelin",contactorganization:"Organisaatio",ContactOrganization:"Organisaatio",contactposition:"Asema",ContactPosition:"Asema",contactperson:"Yhteyshenkilö",ContactPerson:"Yhteyshenkilö"}},wms_url:"WMS"}},spatial:{title:"SPATIAL",fields:{crs:"EPSG",extent:"BBOX"}},layers:{title:"TASOT",fields:{layers:"TASOT",subfields:{crs:"EPSG",bbox:"BBOX",title:"OTSIKKO",name:"NIMI",geometrytype:"GEOMETRIA",source:"LÄHDE",attributes:"ATTRIBUUTIT",abstract:"TIIVISTELMÄ",attribution:"ATTRIBUUTIO",keywords:"AVAINSANAT",metadataurl:"METATIEDON URL",dataurl:"DATA URL"}},groups:{general:"YLEINEN",spatial:"SPATIAL"}}}},tooltips:{relations:{form_to_row:"Rivinäkymä",row_to_form:"Taulukkonäkymä",zoomtogeometry:"Zoomaa geometriaan"},copy_map_extent_url:"Kopioi kartan katselulinkki",download_shapefile:"Lataa SHP-tiedosto",download_gpx:"Lataa GPX-tiedosto",download_gpkg:"Lataa GPKG-tiedosto",download_csv:"Lataa CSV-tiedosto",download_xls:"Lataa XLS-tiedosto",download_pdf:"Lataa PDF-tiedosto",show_chart:"Näytä kaavio",atlas:"Tulosta Atlas",editing:"Editing"},mapcontrols:{query:{tooltip:"Kyselytaso",actions:{add_selection:{hint:"Lisää/Poista valinta"},zoom_to_features_extent:{hint:"Tarkenna ominaisuuden laajuuteen"},add_features_to_results:{hint:"Add/Remove features to results"},remove_feature_from_results:{hint:"Remove feature from results"},zoom_to_feature:{hint:"Tarkenna ominaisuuteen"},relations:{hint:"Näytä relaatiot"},relations_charts:{hint:"Näytä relaatiokaavio"},download_features_shapefile:{hint:"Lataa ominaisuuden SHP-tiedosto"},download_shapefile:{hint:"Lataa ominaisuuden SHP-tiedosto"},download_features_gpx:{hint:"Lataa ominaisuuden GPX-tiedosto"},download_features_gpkg:{hint:"Lataa ominaisuuden GPKG-tiedosto"},download_gpx:{hint:"Lataa ominaisuuden GPX-tiedosto"},download_gpkg:{hint:"Lataa ominaisuuden GPKG-tiedosto"},download_features_csv:{hint:"Lataa ominaisuuden CSV-tiedosto"},download_csv:{hint:"Lataa ominaisuuden CSV-tiedosto"},download_features_xls:{hint:"Lataa ominaisuuden XLS-tiedosto"},download_xls:{hint:"Lataa ominaisuuden XLS-tiedosto"},download_pdf:{hint:"Lataa ominaisuuden PDF-tiedosto"},atlas:{hint:"Tulosta Atlas"},copy_zoom_to_fid_url:{hint:"Copy map URL with this geometry feature extension",hint_change:"Copied"}}},queryby:{title:"Query area",layer:"Selected layer:",none:"NONE",new:"TEMPORARY LAYER",all:"ALL",methods:{intersects:"intersects",within:"within"},querybypolygon:{tooltip:"select a polygon"},querybydrawpolygon:{tooltip:"draw a polygon"},querybbox:{tooltip:"draw a rectangle"},querybycircle:{tooltip:"draw a circle"}},querybypolygon:{download:{title:"Attributes download",choiches:{feature:{label:"Features only"},feature_polygon:{label:"Features+Query Polygon"}}},tooltip:"Kysely monikulmiolla",no_geometry:"No geometry on response",help:{message:"<ul><li>Valitse monikulmiotaso luettelosta.</li><li>Tarkista, että taso on näkyvillä.</li><li>Valitse ominaisuus valitulla tasolla.</li></ul>"}},querybydrawpolygon:{tooltip:"Kysely piirtopolygonin mukaan"},querybbox:{tooltip:"Tasoon kohdituva BBox-kysely",nolayers_visible:"Ei kyseltäviä tasoja näkyvillä. Aseta vähintään yksi WFS-taso näkyväksi suorittaaksesi haun.",help:{message:"<ul><li>Piirrä suorakulmio kartalle suorittaaksesi kyselyn luettelossa alleviivatuille tasoille.</li></ul>"}},querybycircle:{tooltip:"Query by Draw Circle ",label:"Radius",help:{message:"<ul><li>Click on map to draw circle</li></ul>"}},addlayer:{messages:{csv:{warning:"The result in the map is partial due to the presence of the below incorrect records list:"}},tooltip:"Lisää taso"},geolocation:{tooltip:"Maantieteellinen sijainti"},measures:{length:{tooltip:"Pituus",help:"Piirrä murtoviiva kartalle. Paina <br>CANC, mikäli haluat poistaa edellisen pisteen."},area:{tooltip:"Alue",help:"Piirrä monikulmio kartalle. Paina <br>CANC, mikäli haluat poistaa edellisen pisteen."}},scale:{no_valid_scale:"Väärä mittakaava"},scaleline:{units:{metric:"Meters",nautical:"Nautical Mile"}},zoomhistory:{zoom_last:"Zoom Edellinen",zoom_next:"Zoom Seurata"}},relations:{relation_data:"Relaation tiedot",no_relations_found:"Relaatiota ei löytynyt.",back_to_relations:"Takaisin relaatioihin",list_of_relations_feature:"Lista ominaisuuden relaatioista",error_missing_father_field:"Kenttä puuttu",field:"Relation key field"},form:{loading:"Ladataan...",inputs:{messages:{errors:{picklayer:"Ominaisuuksia ei valiitu. Tarkista, että taso on muokattavissa tai näkyvissä nykyisellä mittakaavalla."}},tooltips:{picklayer:"Valitse arvo karttatasolta",lonlat:"Click on map to get coordinates"},input_validation_mutually_exclusive:"Kenttä toisensa poissulkeva.",input_validation_error:"Pakollinen kenttä tai väärä tietotyyppi.",input_validation_min_field:"Arvon tulee olla suurempi tai yhtäsuuri kuin kentän arvo.",input_validation_max_field:"Arvon tulee olla pienempi tai yhtäsuuri kuin kentän arvo.",input_validation_exclude_values:"Arvon tulee olla uniikki.",integer:"kokonaisluku",bigint:"kokonaisluku",text:"teksti",varchar:"teksti",textarea:"teksti",string:"merkkijono",date:"päiväys",datetime:"päiväys",float:"liukuluku",table:"taulukko"},footer:{required_fields:"Vaaditut kentät"},messages:{qgis_input_widget_relation:"Käytä relaatioiden määrittämiseen tähän tarkoitettua toimintoa"}},catalog:{current_map_theme_prefix:"THEME",choose_map_theme:"CHOOSE THEME",choose_map_theme_input_label:"Uuden teeman nimi",project_map_theme:"Projektin Themes",user_map_theme:"Käyttäjä Themes",question_delete_map_theme:"Haluatko poistaa teeman?",delete_map_theme:"Teeman poistaminen onnistui",saved_map_theme:"Teeman tallennus onnistui",updated_map_theme:"Teeman päivittää onnistui",invalid_map_theme_name:"Nimi on jo olemassa tai se on virheellinen",menu:{layerposition:"Kerroksen sijainti",setwmsopacity:"Aseta Opacity",wms:{title:"",copy:"Paina tästä kopioidaksesi url:n.",copied:"Kopioitu."},download:{unknow:"Lataa",shp:"Lataa SHP-tiedosto",gpx:"Lataa GPX-tiedosto",gpkg:"Lataa GPKG-tiedosto",csv:"Lataa CSV-tiedosto",xls:"Lataa XLS-tiedosto",geotiff:"Lataa GEOTIFF-tiedosto",geotiff_map_extent:"Lataa GEOTIFF-tiedosto(current view extent)"}}},wps:{list_process:"Lista prosesseista",tooltip:"Valitse kartalta"}},credits:{g3wSuiteFramework:"Sovellus perustuu OS framework",g3wSuiteDescription:"Julkaise ja hallinnoi QGIS-projekteja verkossa.",productOf:"Frameworkin on kehittänyt"},toggle_color_scheme:"Toggle color scheme",logout:"Kirjaudu ulos",no_other_projects:"Ei projekteja tälle ryhmälle",no_other_groups:"Ei enää ryhmiä tälle makroryhmälle",yes:"Kyllä",no:"Ei",back:"Palaa",backto:"Takaisin ",changemap:"Vaihda karttaa",change_session:"Vaihda istuntoa",component:"Yleinen komponentti",search:"Hae",no_results:"Ei hakutuloksia",print:"Tulosta",create_print:"Luo tuloste",dosearch:"Hae",catalog:"Kartta",data:"Data",externalwms:"WMS",baselayers:"Taustakartta",tools:"Työkalut",tree:"Tasot",legend:"Merkintöjen selite",nobaselayer:"Ei taustakarttaa",street_search:"Hae osoite",show:"Näytä",hide:"Piilota",copy_form_data:"Kopioi tiedot",paste_form_data:"Liitä",copy_form_data_from_feature:"Kopioi tiedot kartalta",error_map_loading:"Virhe ladattessa karttaa",check_internet_connection_or_server_admin:"Tarkista internetyhteys tai ota yhteyttä ylläpitäjään.",could_not_load_vector_layers:"Yhteysvirhe, tasoja ei voida ladata.",server_saver_error:"Virhe tallentaessa palvelimelle.",server_error:"Yhteysvirhe palvelimeen",save:"Tallenna",cancel:"Peruuta",update:"Päivittää",close:"Sulje",dont_show_again:"Älä näytä viestiä uudelleen",enlange_reduce:"Suurenna / Pienennä",reset_default:"Oletuskoko",add:"Lisää",exitnosave:"Poistu tallentamatta",annul:"Peruuta",layer_is_added:"Samanniminen taso on jo lisätty.",sidebar:{wms:{panel:{title:"Add WMS Layer",label:{position:"Map Position",name:"Name",projections:"Projection",layers:"Layers"}},add_wms_layer:"Aggiungi WMS layer",delete_wms_url:"Delete WMS url",layer_id_already_added:"WMS Taso on jo lisätty.",url_already_added:"WMS URL/Nimi on jo lisätty.",layer_add_error:"WMS Layer not added. Please check all wms parameter or url"}},info:{title:"Tulokset",list_of_relations:"List of Relations",open_link:"Avaa liitetiedosto",server_error:"Palvelimella tapahtui virhe.",no_results:"Ei tuloksia haulle/kyselylle.",link_button:"Avaa"},mapcontrols:{geolocation:{error:"Sijaintiasi ei saada"},geocoding:{choose_layer:"Valitse kerros, johon tämä ominaisuus lisätään",placeholder:"Osoite ...",nolayers:"Tästä projektista ei löytynyt muokattavia pistetasoja",noresults:"Ei tuloksia",notresponseserver:"Ei vastausta palvelimelta"},add_layer_control:{header:"Lisää taso",select_projection:"Valitse tason projektio",select_field_to_show:"Select Field to show on map",select_csv_separator:"Select delimiter",select_csv_x_field:"Select X field",select_csv_y_field:"Select Y field",select_color:"Valitse tason väri",drag_layer:"Vedä ja pudota taso tähän"},query:{input_relation:"Paina näyttääksesi relaatiot"},length:{tooltip:"Pituus"},area:{tooltip:"Pinta-ala"},screenshot:{error:"Screenshot error creation",securityError:'  \n        <p><b>Turvallisuusvirhe</b>: ulkoinen kerros estää karttaa tulostamasta. Tarkistaaksesi, toimi seuraavasti:</p>\n        <ol>\n          <li>poista manuaalisesti lisätyt ulkoiset tasot (esim. WMS-tasot)</li>\n          <li>Pakota sivun uudelleenlataus: <code>CTRL + F5</code></li>\n          <li>tulosta kartta uudelleen</li>\n        </ol>\n        <p>Saat lisätietoja palvelimen järjestelmänvalvojalta seuraavista aiheista: <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image" style="color: #000 !important;font -paino: lihavoitu;">&#x2139;&#xFE0F; turvallisuus ja likaiset kankaat</a></p>\n        '}},catalog_items:{helptext:"Napsauta hiiren kakkospainikkeella yksittäistä tasoa päästäksesi lisäominaisuuksiin.",contextmenu:{zoomtolayer:"Tarkenna tasoon",open_attribute_table:"Avaa attribuuttitaulu",show_metadata:"Metatiedot",styles:"Tyylejä",vector_color_menu:"Aseta/muuta väriä",layer_opacity:"Peittävyys",filters:"Filters"}},dataTable:{previous:"Edellinen",next:"Seuraava",lengthMenu:"Näytä _MENU_ arvoa sivulla",info:"tulosta _TOTA_:stä",no_data:"Ei tietoja",nodatafilterd:"Vastaavia tietueita ei löytynyt",infoFiltered:"(filtered from _MAX_ total records)"}}}},{}],151:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default={translation:{error_page:{error:"Erreur de connexion",at_moment:"Pour le moment, il n'est pas possible d'afficher la carte",f5:"Appuyez sur Ctrl+F5"},cookie_law:{message:"Ce site utilise des cookies pour assurer une bonne convivialité pour l'utilisateur final.",buttonText:"J’ai compris !"},default:"par défaut ",sign_in:"Se connecter ",layer_selection_filter:{tools:{filter:"Activer/Désactiver le filtre",nofilter:"Supprimer le filtre ",invert:"Sélection inversée ",clear:"Effacer la sélection ",show_features_on_map:"Mettre à jour les résultats lors du déplacement de la carte",savefilter:"Sauver le Filtre",filterName:"Nom du Filtre"}},warning:{not_supported_format:"Format non supporté"},layer_position:{top:"HAUT",bottom:"BAS",message:"Position relative des couches dans la table des matières"},sdk:{atlas:{template_dialog:{title:"Sélectionnez un modèle"}},spatialbookmarks:{title:"Signets spatiaux",helptext:"Déplacez-vous sur l'étendue de la carte, insérez le nom et cliquez sur Ajouter",input:{name:"Nom"},sections:{project:{title:"Signets du projet"},user:{title:"Signets de l'utilisateur"}}},search:{all:"TOUTES",no_results:"Aucune valeur trouvée",searching:"Je cherche...",error_loading:"Erreur de chargement des valeurs",layer_not_searchable:"La couche n’est pas recherchable",layer_not_querable:"La couche n'est pas interrogeable",autocomplete:{inputshort:{pre:"Tapez au moins",post:"caractères"}}},print:{no_layers:"Aucune layer visible",scale:"Échelle",format:"Format",rotation:"Rotation",download_image:"Télécharger l'image",fids_instruction:"Valeurs acceptées : de 1 à la valeur maximale indiquée par [max]. Il est également possible d'indiquer une fourchette de valeurs, par exemple 4-6",fids_example:"Par exemple 1,4-6 les ids 1,4,5,6 seront imprimés",help:"Les couches montrées dans l'impression peuvent être celles définies dans le projet et non celles montrées sur la carte"},querybuilder:{search:{run:"Lancer la recherche",info:"Information",delete:"Supprimer",edit:"Modifier"},messages:{changed:"Enregistré correctement",number_of_features:"Nombre d'entités"},panel:{button:{all:"TOUTES",save:"SAUVEGARDER",test:"TESTER",clear:"NETTOYER",run:"EXECUTER",manual:"MANUEL"},layers:"COUCHES",fields:"CHAMPS",values:"VALEURS",operators:"OPERATEURS",expression:"EXPRESSION"},error_run:"Une erreur s'est produite. Vérifiez si la requête est correcte",error_test:"Erreur d'exécution de la requête",delete:"Voulez-vous confirmer la suppression ?",additem:"Entrer le nom de la requête"},errors:{layers:{load:"Certaines couches du projet ne sont pas disponibles actuellement et n'apparaissent donc pas dans la vue actuelle"},unsupported_format:"Format non supporté",add_external_layer:"Erreur lors du chargement de la couche"},metadata:{title:"Métadonnées",groups:{general:{title:"GÉNÉRAL",fields:{title:"TITRE",name:"NOM",description:"DESCRIPTION",abstract:"ABREGE",keywords:"LISTE DE MOTS-CLÉS",fees:"DROITS D'INSCRIPTION",accessconstraints:"CONTRAINTES D'ACCÈS",contactinformation:"CONTACTS",subfields:{contactinformation:{contactelectronicmailaddress:"E-mail",personprimary:"Références",contactvoicetelephone:"Téléphone",contactorganization:"Organisation",ContactOrganization:"Organisation",contactposition:"Localisation",ContactPosition:"Localisation",contactperson:"Personne",ContactPerson:"Personne"}},wms_url:"WMS"}},spatial:{title:"INFO SPATIALE",fields:{crs:"EPSG",extent:"BBOX"}},layers:{title:"COUCHES",groups:{general:"GENERALE",spatial:"INFO SPATIALE"},fields:{layers:"COUCHES",subfields:{crs:"EPSG",bbox:"BBOX",title:"TITRE",name:"NOM",geometrytype:"GÉOMÉTRIE",source:"SOURCE",attributes:"ATTRIBUTS",abstract:"ABRÉGÉ",attribution:"ATTRIBUTION",keywords:"MOTS- CLÉS",metadataurl:"URL DE MÉTADONNÉES",dataurl:"URL DES DONNÉES"}}}}},tooltips:{relations:{form_to_row:"Afficher le format de la ligne",row_to_form:"Format du formulaire d'affichage",zoomtogeometry:"Zoom sur la géométrie"},zoom_to_features_extent:"Zoom sur les entités",copy_map_extent_url:"Copier le lien de visualisation de la carte",download_shapefile:"Télécharger le fichier Shapefile",download_gpx:"Télécharger GPX",download_gpkg:"Télécharger GPKG",download_csv:"Télécharger CSV",download_xls:"Télécharger XLS",download_pdf:"Télécharger PDF",show_chart:"Montrer le graphique",atlas:"Imprimer l'Atlas",editing:"Modifier"},mapcontrols:{query:{tooltip:"Couche Interrogée",actions:{add_selection:{hint:"Ajouter/supprimer une sélection"},zoom_to_features_extent:{hint:"Zoom sur les entités"},add_features_to_results:{hint:"Ajouter des fonctionnalités aux résultats"},remove_feature_from_results:{hint:"Supprimer l'entité des résultats"},zoom_to_feature:{hint:"Zoom sur les entités"},relations:{hint:"Voir les relations"},relations_charts:{hint:"Voir les graphiques de relations"},download_features_shapefile:{hint:"Télécharger les entités vers Shapefile"},download_shapefile:{hint:"Télécharger le Shapefile"},download_features_gpx:{hint:"Télécharger les entités vers GPX"},download_features_gpkg:{hint:"Télécharger les entités vers GPKG"},download_gpx:{hint:"Télécharger le GPX"},download_gpkg:{hint:"Télécharger le GPKG"},download_features_csv:{hint:"Télécharger les entités vers CSV"},download_csv:{hint:"Télécharger le CSV"},download_features_xls:{hint:"Télécharger les entités vers XLS"},download_xls:{hint:"Télécharger le XLS"},download_pdf:{hint:"Télécharger le PDF"},atlas:{hint:"Imprimer l'Atlas"},copy_zoom_to_fid_url:{hint:"Copier l'URL de la carte avec l'extension vers cette géométrie",hint_change:"Copié"}}},queryby:{title:"Query area",layer:"Selected layer:",none:"NONE",new:"TEMPORARY LAYER",all:"ALL",methods:{intersects:"intersects",within:"within"},querybypolygon:{tooltip:"select a polygon"},querybydrawpolygon:{tooltip:"draw a polygon"},querybbox:{tooltip:"draw a rectangle"},querybycircle:{tooltip:"draw a circle"}},querybypolygon:{download:{title:"Téléchargement des attributs",choiches:{feature:{label:"Entités seulement"},feature_polygon:{label:"Entités+Requête Polygon "}}},tooltip:"Requête par polygone",no_geometry:"La réponse ne contient pas de géométrie",help:{message:"<ul><li>Sélectionnez une couche de polygone dans la légende.</li><li>Vérifiez que la couche est visible dans la carte.</li><li>Cliquez sur une géométrie de la couche sélectionnée.</li></ul>"}},querybydrawpolygon:{tooltip:"Requête par polygone de dessin"},querybbox:{tooltip:"Requête pour BBOX",nolayers_visible:"Aucune couche requêtable n'est visible. Assurez-vous qu'au moins une couche wfs est visible pour exécuter la requête",help:{message:"<ul><li>Dessinez un rectangle pour interroger les couches surlignées en jaune</li></ul>"}},querybycircle:{tooltip:"Query by Draw Circle ",label:"Radius",help:{message:"<ul><li>Click on map to draw circle</li></ul>"}},addlayer:{messages:{csv:{warning:"Le résultat de la carte est partiel en raison de la présence des enregistrements incorrects suivants :"}},tooltip:"Ajouter un layer"},geolocation:{tooltip:"Géolocalisation"},measures:{length:{tooltip:"Longueur",help:"Cliquez sur la carte pour continuer à dessiner la ligne.<br>CANC si vous voulez supprimer le dernier vertex inséré"},area:{tooltip:"Zone",help:"Cliquez pour continuer à dessiner le polygone.<br>CANC si vous voulez supprimer le dernier vertex inséré"}},scale:{no_valid_scale:"Échelle invalide"},scaleline:{units:{metric:"Mètre",nautical:"Mile Nautique"}},zoomhistory:{zoom_last:"Zoom Précédent",zoom_next:"Zoom Suivant"}},relations:{relation_data:"Données relationnelles",no_relations_found:"Aucune relation trouvée",back_to_relations:"Retour aux relations",list_of_relations_feature:"Liste des relations entre les entités",error_missing_father_field:"Le champ concerné n'existe pas",field:"Relation key field"},form:{loading:"Chargement...",inputs:{messages:{errors:{picklayer:"Aucune entité sélectionnée. Vérifier si la couche est en édition ou non visible à l'échelle actuelle"}},tooltips:{picklayer:"Obtenir la valeur de la carte",lonlat:"Cliquez sur la carte pour obtenir les coordonnées"},input_validation_mutually_exclusive:"Champ mutuellement exclusif avec ",input_validation_error:"Champ obligatoire ou type de valeur incorrect",input_validation_min_field:"La valeur doit être supérieure ou égale au camp ",input_validation_max_field:"La valeur doit être inférieure ou égale au champ ",input_validation_exclude_values:"Le champ doit contenir une valeur différente",integer:"entier",bigint:"entier",text:"textuel",varchar:"textuel",textarea:"textuel",string:"chaîne",date:"date",datetime:"date",float:"décimal",table:"table"},footer:{required_fields:"Champs obligatoires"},messages:{qgis_input_widget_relation:"Gérer les relations via un formulaire dédié"}},catalog:{current_map_theme_prefix:"THEME",choose_map_theme:"SÉLECTIONNEZ LE THÈME",choose_map_theme_input_label:"Nom du nouveau thème",project_map_theme:"Thème du projet",user_map_theme:"Thème de l'utilisateur",question_delete_map_theme:"Voulez-vous supprimer le thème ?",delete_map_theme:"Thème supprimé avec succès",saved_map_theme:"Thème enregistré avec succès",updated_map_theme:"Thème mise à jour avec succès",invalid_map_theme_name:"Le nom existe déjà ou est incorrect",menu:{layerposition:"Position du calque",setwmsopacity:"Définir l'opacité",wms:{title:"",copy:"Cliquez ici pour copier l'url",copied:"Copié"},download:{unknow:"Télécharger",shp:"Télécharger Shapefile",gpx:"Télécharger GPX",gpkg:"Télécharger GPKG",csv:"Télécharger CSV",xls:"Télécharger XLS",geotiff:"Télécharger GEOTIFF",geotiff_map_extent:"Télécharger GEOTIFF(vue courante)"}}},wps:{list_process:"Liste des processus",tooltip:"Cliquez sur la carte"}},credits:{g3wSuiteFramework:"Application construite avec le framework OS",g3wSuiteDescription:"Publiez et gérez vos projets QGIS sur le Web",productOf:"Framework développé par"},logout:"Quitter",no_other_projects:"Il n'y a pas d'autres projets dans ce groupe de cartes",no_other_groups:"Il n'y a pas d'autres groupes dans ce macrogroupe",yes:"Oui",no:"No",back:"Retour",backto:"Retour à ",changemap:"Changer de carte",change_session:"Changer de sessuib",component:"Composant générique",search:"Recherches",no_results:"Aucun résultat trouvé",print:"Imprimer",create_print:"Créer une impression",dosearch:"Recherche",catalog:"Carte",data:"Données",externalwms:"WMS",baselayers:"Bases",tools:"Outils",tree:"Strates",legend:"Légende",nobaselayer:"Pas de carte de base",street_search:"Adresse de recherche",show:"Afficher",hide:"Cacher",copy_form_data:"Copier les données du formulaire",paste_form_data:"Coller",copy_form_data_from_feature:"Copier les données de la carte",error_map_loading:"Erreur de chargement de la nouvelle carte",check_internet_connection_or_server_admin:"Vérifiez la connexion internet ou contactez l'administrateur",could_not_load_vector_layers:"Erreur de connexion au serveur : il n'a pas été possible de charger les vecteurs demandés",server_saver_error:"Erreur de sauvegarde sur le serveur",server_error:"Une erreur s'est produite dans la requête au serveur",save:"Sauvegarder",cancel:"Supprimer",update:"Mise à jour",close:"Fermer",dont_show_again:"Ne plus afficher ce message",enlange_reduce:"Agrandir / Réduire",reset_default:"Taille par défaut",add:"Ajouter",exitnosave:"Quitter sans sauvegarder",annul:"Annuler",layer_is_added:"Couche avec le même nom déjà ajoutée",wms_layer_id_already_added:"Couche WMS déjà ajoutée",wms_url_already_added:"URL WMS déjà ajouté",sidebar:{wms:{panel:{title:"Ajouter une couche WMS",label:{position:"Position sur la carte",name:"Nom",projections:"Projection",layers:"Couches"}},add_wms_layer:"Ajouter une couche WMS",delete_wms_url:"Supprimer une url WMS",layer_id_already_added:"La couche est déjà présente.",url_already_added:"L'URL WMS est déjà présent.",layer_add_error:"Couche WMS non ajoutée. Veuillez vérifier tous les paramètres de l'URL"}},info:{title:"Résultats",list_of_relations:"Liste des relations",open_link:"Ouvrir le document joint",server_error:"Une erreur s'est produite dans la requête au serveur",no_results:"Aucun résultat pour cette requête/recherche",link_button:"Ouvrir"},mapcontrols:{geolocation:{error:"Votre position ne peut être calculée."},geocoding:{choose_layer:"Choisissez un calque où ajouter cette entité",placeholder:"Adresse ...",nolayers:"Aucune couche de points modifiable trouvée sur ce projet",noresults:"Aucun résultat",notresponseserver:"Le serveur ne répond pas"},add_layer_control:{header:"Ajouter une couche",select_projection:"Sélectionnez le système de projection de couches",select_field_to_show:"Sélectionnez le champ à afficher sur la carte",select_csv_separator:"Sélectionner le séparateur",select_csv_x_field:"Sélectionnez le champ X",select_csv_y_field:"Sélectionnez le champ Y",select_color:"Sélectionnez la couleur du layer",drag_layer:"Faire glisser le layer vers cette zone"},query:{input_relation:"Cliquez pour voir les relations"},length:{tooltip:"Longueur"},area:{tooltip:"Zone"},screenshot:{error:"Erreur de création de la capture d'écran",securityError:'  \n        <p><b>Erreur de sécurité</b> : une couche externe empêche l\'impression de la carte. Pour vérifier, procédez comme suit :</p>\n        <ol>\n          <li>supprimer toutes les couches externes ajoutées manuellement (par exemple, les couches WMS)</li>\n          <li>forcer le rechargement de la page : <code>CTRL + F5</code></li>\n          <li>imprimer à nouveau la carte</li>\n        </ol>\n        <p>Pour plus d\'informations, veuillez contacter l\'administrateur du serveur à propos de : <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image" style="color: #000 !important;font -poids : gras ;">&#x2139;&#xFE0F; sécurité et toiles souillées</a></p>\n        '}},catalog_items:{helptext:"Cliquez avec le bouton droit de la souris sur les différentes couches pour accéder à des fonctionnalités supplémentaires",contextmenu:{zoomtolayer:"Zoom sur le layer",open_attribute_table:"Ouvrir la table attributaire",show_metadata:"Métadonnées",styles:"Styles",vector_color_menu:"Définir/changer la couleur",layer_opacity:"Opacité",filters:"Filters"}},dataTable:{previous:"Précédent",next:"Suivant",lengthMenu:"Afficher _MENU_ valeurs par page",info:"_TOTAL_ résultats",nodatafilterd:"Aucun résultat trouvé",infoFiltered:"(Filtré par _MAX_ rangs totaux)"}}}},{}],152:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var n=c(e("./it")),i=c(e("./en")),r=c(e("./fi")),o=c(e("./se")),s=c(e("./fr")),l=c(e("./de")),u=c(e("./ro")),e=c(e("./pl"));function c(e){return e&&e.__esModule?e:{default:e}}n={it:n.default,en:i.default,fi:r.default,se:o.default,fr:s.default,de:l.default,ro:u.default,pl:e.default};a.default=n},{"./de":148,"./en":149,"./fi":150,"./fr":151,"./it":153,"./pl":154,"./ro":155,"./se":156}],153:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default={translation:{error_page:{error:"Errore di connessione",at_moment:"Al momento non è possibile caricare la mappa",f5:"Premi Ctrl+F5"},cookie_law:{message:"Questo sito utilizza i cookie per garantire una buona usabilità all'utilizzatore finale.",buttonText:"Ho capito!"},default:"predefinito",sign_in:"Accedi",layer_selection_filter:{tools:{filter:"Attiva/Disattiva Filtro",nofilter:"Rimuovi filtro",invert:"Inverti Selezione",clear:"Annulla selezione",show_features_on_map:"Aggiorna i risultati quando si sposta la mappa",savefilter:"Salva Filtro",filterName:"Nome Filtro"}},warning:{not_supported_format:"Formato non supportato"},layer_position:{top:"IN CIMA",bottom:"IN FONDO",message:"Posizione"},sdk:{atlas:{template_dialog:{title:"Seleziona Template"}},spatialbookmarks:{title:"Segnalibri",helptext:"Posizionati all'estensione del tuo nuovo segnalibro, definisci il nome e clicca Aggiungi",input:{name:"Nome"},sections:{project:{title:"Segnalibri Progetto"},user:{title:"Segnalibri Utente"}}},search:{all:"TUTTE",no_results:"Nessun valore trovato",searching:"Sto cercando ..",error_loading:"Errore nel caricamento valori",layer_not_searchable:"Il layer non è ricercabile",layer_not_querable:"Il layer non è interrogabile",autocomplete:{inputshort:{pre:"Digita almeno",post:"caratteri"}}},print:{no_layers:"Nessun Layer visibile",template:"Template",labels:"Etichette",scale:"Scala",format:"Formato",rotation:"Rotazione",download_image:"Scarica Immagine",fids_instruction:"Valori accettati: da 1 al valore massimo indicato da [max]. Possibile indicare anche range di valori es. 4-6",fids_example:"Es. 1,4-6 verranno stampati gli id 1,4,5,6",help:"I livelli esportati sono definiti dall'amministratore"},querybuilder:{title:"Ricerca avanzata",search:{run:"Esegui",info:"Informazioni",delete:"Rimuovi",edit:"Modifica"},messages:{changed:"Salvato correttamente",number_of_features:"Elementi trovati:"},panel:{button:{all:"TROVA UN VALORE",save:"SALVA",test:"VERIFICA",clear:"PULISCI",run:"ESEGUI",manual:"MANUALE"},layers:"LAYERS",fields:"CAMPI",values:"VALORI",operators:"OPERATORI",expression:"ESPRESSIONE"},error_run:"Si è verificato un errore. Verificare se la query è corretta",error_test:"Errore nell'esecuzione della query",delete:"Vuoi confermare la cancellazione?",additem:"Inserisci nome della ricerca"},errors:{layers:{load:"Alcuni livelli presenti nel progetto non sono attualmente disponibili e quindi non compaiono nell'attuale visualizzazione"},unsupported_format:"Formato non supportato",add_external_layer:"Errore nel caricamento del layer"},metadata:{title:"Metadati",groups:{general:{title:"GENERALE",fields:{title:"TITOLO",name:"NOME",description:"DESCRIZIONE",abstract:"ABSTRACT",keywords:"LISTA DELLE PAROLE CHIAVE",fees:"CANONI",accessconstraints:"VINCOLI DI ACCESSO",contactinformation:"CONTATTI",subfields:{contactinformation:{contactelectronicmailaddress:"E-mail",personprimary:"Riferimenti",contactvoicetelephone:"Telefono",contactorganization:"Organizzazione",ContactOrganization:"Organizzazione",contactposition:"Posizione",ContactPosition:"Posizione",contactperson:"Persona",ContactPerson:"Persona"}},wms_url:"WMS"}},spatial:{title:"INFO SPAZIALI",fields:{crs:"EPSG",extent:"BBOX"}},layers:{title:"STRATI",groups:{general:"GENERALE",spatial:"INFO SPAZIALI"},fields:{layers:"STRATI",subfields:{crs:"EPSG",bbox:"BBOX",title:"TITOLO",name:"NOME",geometrytype:"GEOMETRIA",source:"SORGENTE",attributes:"ATTRIBUTI",abstract:"ABSTRACT",attribution:"ATTRIBUTION",keywords:"PAROLE CHIAVE",metadataurl:"METADATA URL",dataurl:"DATA URL"}}}}},tooltips:{relations:{form_to_row:"Visualizza riga",row_to_form:"Visualizza modulo",zoomtogeometry:"Zoom sulla geometria"},zoom_to_features_extent:"Zoom sulle features",copy_map_extent_url:"Copia URL di condivisione",download_shapefile:"Scarica Shapefile",download_gpx:"Scarica GPX",download_gpkg:"Scarica GPKG",download_csv:"Scarica CSV",download_xls:"Scarica XLS",download_pdf:"Scarica PDF",show_chart:"Mostra Grafico",atlas:"Stampa Atlas",editing:"Modifica"},mapcontrols:{query:{tooltip:"Interroga Layer",actions:{add_selection:{hint:"Aggiungi/Rimuovi Selezione"},zoom_to_features_extent:{hint:"Zoom sulle geometrie"},add_features_to_results:{hint:"Aggiungi elementi ai risultati"},remove_feature_from_results:{hint:"Rimuovi elemento dai risultati"},zoom_to_feature:{hint:"Zoom sulla geometria"},relations:{hint:"Visualizza Relazioni"},relations_charts:{hint:"Visualizza grafici relazioni"},download_features_shapefile:{hint:"Scarica come Shapefile"},download_shapefile:{hint:"Scarica come Shapefile"},download_features_gpx:{hint:"Scarica come GPX"},download_features_gpkg:{hint:"Scarica come GPKG"},download_gpx:{hint:"Scarica come GPX"},download_gpkg:{hint:"Scarica come GPKG"},download_features_csv:{hint:"Scarica come CSV"},download_csv:{hint:"Scarica come CSV"},download_features_xls:{hint:"Scarica come XLS"},download_xls:{hint:"Scarica come XLS"},download_pdf:{hint:"Scarica come PDF"},atlas:{hint:"Stampa Atlas"},copy_zoom_to_fid_url:{hint:"Condividi tramite link",hint_change:"URL copiato negli appunti"}}},queryby:{title:"Interroga un area",layer:"Livello selezionato:",none:"NESSUNO",new:"LIVELLO TEMPORANEO",all:"TUTTI",methods:{intersects:"interseca",within:"all'interno"},querybypolygon:{tooltip:"seleziona un poligono"},querybydrawpolygon:{tooltip:"disegna un poligono"},querybbox:{tooltip:"disegna un rettangolo"},querybycircle:{tooltip:"disegna un cerchio"}},querybypolygon:{download:{title:"Download attributi",choiches:{feature:{label:"Solo features"},feature_polygon:{label:"Features+Poligono Interrogazione"}}},tooltip:"Interroga per poligono",no_geometry:"Non contiene la geometria nella risposta",help:{message:"<ul><li>Seleziona un livello (visibile).</li><li>Clicca su una geometria nella mappa.</li></ul>"}},querybydrawpolygon:{tooltip:"Disegna un poligono per interrogare",help:{message:"<ul><li>Clicca sulla mappa per aggiungere un nuovo vertice</li><li>Doppio click per terminare ed interrogare i livelli (sottolineati in giallo nella legenda)</li></ul>"}},querybbox:{tooltip:"Interroga per BBOX",nolayers_visible:"Nessun layer interrogabile è visibile. Assicurarsi che almeno un layer wfs sia visibile per eseguire l'interrogazione",help:{message:"<ul><li>Trascina il mouse per disegnare un rettangolo ed interrogare i livelli (sottolineati in giallo nella legenda)</li></ul>"}},querybycircle:{tooltip:"Disegna un cerchio per interrogare",label:"Raggio",help:{message:"<ul><li>Clicca sulla mappa per disegnare il cerchio</li></ul>"}},addlayer:{messages:{csv:{warning:"Il risultato in mappa è parziale a causa della presenza dei seguenti records non corretti:"}},tooltip:"Aggiungi livello"},geolocation:{tooltip:"Mostra la mia posizione"},measures:{title:"Misura",length:{tooltip:"Lunghezza",help:"Clicca sulla mappa per continuare a disegnare la linea.<br>CANC se si vuole cancellare l'ultimo vertice inserito"},area:{tooltip:"Area",help:"Clicca per continuare a disegnare il poligono.<br>CANC se si vuole cancellare l'ultimo vertice inserito"}},screenshot:{title:"Cattura schermata",screenshot:"PNG",geoscreenshot:"GeoTIFF",download:"Genera"},scale:{no_valid_scale:"Scala non valida"},scaleline:{units:{metric:"Metri",nautical:"Miglio Nautico"}},zoomhistory:{zoom_last:"Zoom Precedente",zoom_next:"Zoom Successivo"}},relations:{relation_data:"Dati Relazione",no_relations_found:"Nessuna relazione trovata",back_to_relations:"Ritorna alle relazioni",list_of_relations_feature:"Lista delle relazioni della feature",error_missing_father_field:"Il campo relazionato non esiste",field:"Campo chiave relazione"},form:{loading:"Caricamento ...",inputs:{messages:{errors:{picklayer:"Nessuna feature selezionata. Verificare se il layer è in editing o non visibile alla scala attuale"}},tooltips:{picklayer:"Prendi valore dalla mappa",lonlat:"Clicca sulla mappa per prendere le coordinate"},input_validation_mutually_exclusive:"Campo mutualmente esclusivo con ",input_validation_error:"Campo obbligatorio o tipo valore non corretto",input_validation_min_field:"Valore deve essere magiore uguale a quello del camp ",input_validation_max_field:"Valore deve essere minore uguale a quello del campo ",input_validation_exclude_values:"Campo deve contenere un valore diverso",integer:"intero",bigint:"intero",text:"testuale",varchar:"testuale",textarea:"testuale",string:"stringa",date:"data",datetime:"data",float:"float",table:"table"},footer:{required_fields:"Campi obbligatori"},messages:{qgis_input_widget_relation:"Gestisci le relazioni tramite form dedicato"}},catalog:{current_map_theme_prefix:"TEMA",choose_map_theme:"SCEGLI TEMA",choose_map_theme_input_label:"Nome del nuovo tema",project_map_theme:"Temi Progetto",user_map_theme:"Temi Utente",question_delete_map_theme:"Vuoi cancellare il tema ?",delete_map_theme:"Tema cancellato con successo",saved_map_theme:"Tema salvato con successo",updated_map_theme:"Tema aggiornato con successo",invalid_map_theme_name:"Nome già esistente o non corretto",menu:{layerposition:"Posizione Layer",setwmsopacity:"Cambia opacità",wms:{title:"",copy:"Clicca qui per copiare url",copied:"Copiato"},download:{unknow:"Scarica",shp:"Scarica Shapefile",gpx:"Scarica GPX",gpkg:"Scarica GPKG",csv:"Scarica CSV",xls:"Scarica XLS",geotiff:"Scarica GEOTIFF",geotiff_map_extent:"Scarica GEOTIFF(estensione vista corrente)"}}},wps:{list_process:"Lista dei processi",tooltip:"Clicca sulla mappa"}},credits:{g3wSuiteFramework:"Applicativo realizzato con il framework OS",g3wSuiteDescription:"Pubblica e gestisci i tuoi progetti QGIS sul Web",productOf:"Framework sviluppato da"},toggle_color_scheme:"Cambia colore",logout:"Esci",no_other_projects:"Non ci sono altri progetti in questo gruppo cartografico",no_other_groups:"Non ci sono altri gruppi in questo Macrogruppo",yes:"Si",no:"No",back:"Indietro",backto:"Torna a ",changemap:"Cambia Mappa",change_session:"Cambia Sessione",component:"Componente Generico",search:"Ricerche",no_results:"Nessun risultato trovato",print:"Stampa",create_print:"Crea Stampa",dosearch:"Cerca",catalog:"Mappa",data:"Dati",externalwms:"WMS",baselayers:"Basi",tools:"Strumenti",tree:"Strati",legend:"Legenda",nobaselayer:"Nessuna mappa di base",street_search:"Cerca indirizzo",show:"Mostra",hide:"Nascondi",copy_form_data:"Copia i dati del modulo",paste_form_data:"Incolla",copy_form_data_from_feature:"Copia i dati dalla mappa",error_map_loading:"Errore di caricamento della nuova mappa",check_internet_connection_or_server_admin:"Controllare la connessione internet o contattare l'amministratore",could_not_load_vector_layers:"Errore di connessione al server: non è stato possibile caricare i vettoriali richiesti",server_saver_error:"Errore nel salvataggio sul server",server_error:"Si è verificato un errore nella richiesta al server",save:"Salva",cancel:"Cancella",update:"Aggiorna",close:"Chiudi",dont_show_again:"Non mostrare più",enlange_reduce:"Allarga / Riduci",reset_default:"Dimensione predefinita",add:"Aggiungi",exitnosave:"Esci senza salvare",annul:"Annulla",layer_is_added:"Esiste già un livello con lo stesso nome",sidebar:{wms:{panel:{title:"Aggiunta livello WMS",label:{position:"Posizione su Mappa",name:"Nome",projections:"Sistema di riferimento",layers:"Layers"}},add_wms_layer:"Aggiungi livello WMS",delete_wms_url:"Elimina WMS url",layer_id_already_added:"Questo Layer WMS è già stato aggiunto",url_already_added:"URL/Nome WMS già aggiunto",layer_add_error:"WMS Layer non aggiunto. Verificare i parametri o l'url"}},info:{title:"Risultati",list_of_relations:"Lista delle relazioni",open_link:"Apri documento allegato",server_error:"Si è verificato un errore nella richiesta al server",no_results:"Nessun risultato per questa interrogazione/ricerca ",link_button:"Apri"},mapcontrols:{geolocation:{error:"Non è possibile ottenere la tua posizione."},geocoding:{choose_layer:"Scegli un livello in cui aggiungere questa funzionalità",placeholder:"Indirizzo ...",nolayers:"Nessun layer di punti modificabile trovato in questo progetto",noresults:"Nessun risultato",notresponseserver:"Il server non risponde"},add_layer_control:{header:"Aggiungi livello",select_projection:"Sistema di riferimento",select_field_to_show:"Campo da visualizzare sulla mappa",select_csv_separator:"Seleziona il separatore",select_csv_x_field:"Seleziona il campo X",select_csv_y_field:"Seleziona il campo Y",select_color:"Colore",drag_layer:"Aggiungi il file in questa area",persistent_data:"Persistenza",persistent_help:"salva il livello nella memoria del browser"},query:{input_relation:"Clicca per consultare le relazioni"},length:{tooltip:"Lunghezza"},area:{tooltip:"Area"},screenshot:{error:"Errore nella creazione dello screenshot",securityError:'  \n        <p><b>Errore di sicurezza</b>: uno strato esterno impedisce la stampa della mappa. Per verificare, procedere come segue:</p>\n        <ol>\n          <li>rimuovi eventuali layer esterni aggiunti manualmente (es. layer WMS)</li>\n          <li>forza il ricaricamento della pagina: <code>CTRL + F5</code></li>\n          <li>stampa nuovamente la mappa</li>\n        </ol>\n        <p>Per maggiori informazioni contattare l\'amministratore del server in merito a: <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image" style="color: #000 !important;font-weight: bold;">&#x2139;&#xFE0F; security and tainted canvases</a></p>\n        '}},catalog_items:{helptext:"Tasto destro sui singoli layer per accedere alle funzionalità aggiuntive",contextmenu:{zoomtolayer:"Zoom sul Layer",open_attribute_table:"Apri tabella attributi",show_metadata:"Metadati",styles:"Stili",vector_color_menu:"Setta/Cambia Colore",layer_opacity:"Trasparenza",filters:"Filtri"}},dataTable:{previous:"Precedente",next:"Successivo",lengthMenu:"Mostra _MENU_ valori per pagina",info:"_TOTAL_ elementi",nodatafilterd:"Nessun risultato trovato",infoFiltered:"(Filtrati da _MAX_ total righe)"},no_geometry:"Questo elemento non ha geometria"}}},{}],154:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default={translation:{error_page:{error:"Błąd połączenia",at_moment:"W tej chwili nie jest możliwe mapa pokazująca",f5:"Naciśnij Ctrl+F5"},cookie_law:{message:"Ta strona internetowa korzysta z plików cookie, aby uzyskać najlepsze wrażenia na naszej stronie internetowej.",buttonText:"Rozumiem!"},default:"domyślny",sign_in:"Zalogować się",layer_selection_filter:{tools:{filter:"Włącz/wyłącz filtr",nofilter:"Usuń filtr",invert:"Odwróć wybór",clear:"Jasny wybór",show_features_on_map:"Pokaż funkcje widoczne na mapie",savefilter:"Zapisz filtr",filterName:"Nazwa filtru"}},warning:{not_supported_format:"Nie obsługiwany format"},layer_position:{top:"SZCZYT",bottom:"SPÓD",message:"Pozycja względem warstw na TOC"},sdk:{atlas:{template_dialog:{title:"Wybierz szablon"}},spatialbookmarks:{title:"Zakładki przestrzenne",helptext:"Poruszaj zasięg mapy, wstaw nazwę i kliknij Dodaj",input:{name:"Nazwa"},sections:{project:{title:"Zakładki projektu"},user:{title:"Zakładki użytkowników"}}},search:{all:"WSZYSTKO",no_results:"Brak wyników",searching:"Poszukiwanie ...",error_loading:"Błąd Dane dotyczące ładowania",layer_not_searchable:"Warstwa nie można przeszukiwać",layer_not_querable:"Warstwa nie jest zapytana",autocomplete:{inputshort:{pre:"Podaj",post:"lub więcej znaków"}}},print:{no_layers:"Brak warstwy do wydrukowania",template:"Szablon",labels:"Etykiety",scale:"Skala",format:"Format",rotation:"Obrót",download_image:"Pobierz obraz",fids_instruction:"Zaakceptowane wartości: od 1 do wartości [maks.]. Możliwe jest wstawienie zasięgu ex. 4-6",fids_example:"Były. 1,4-6 zostanie wydrukowany 1,4,5,6",help:"Warstwy pokazane w druku mogą być warstwy zdefiniowane w projekcie, a nie wyświetlane na mapie"},querybuilder:{search:{run:"Uruchomić",info:"Informacja",delete:"Usuwać",edit:"Edytować"},messages:{changed:"Uratowany",number_of_features:"Liczba funkcji"},panel:{button:{all:"WSZYSTKO",save:"RATOWAĆ",test:"TEST",clear:"JASNE",run:"URUCHOMIĆ",manual:"PODRĘCZNIK"},layers:"Warstwy",fields:"Pola",values:"Wartości",operators:"Operatorzy",expression:"WYRAŻENIE"},error_run:"Występuje błąd. Sprawdź zapytanie",error_test:"Błąd wystąpił podczas wykonywania zapytania",delete:"Chcesz to usunąć?",additem:"Włóż nazwę nowego wyszukiwania"},errors:{layers:{load:"Niektóre warstwy nie są dostępne"},unsupported_format:"Nie obsługiwany format",add_external_layer:"Błąd warstwy ładowania"},metadata:{title:"Metadane",groups:{general:{title:"OGÓLNY",fields:{title:"TYTUŁ",name:"NAZWA",description:"OPIS",abstract:"ABSTRAKCYJNY",keywords:"SŁOWA KLUCZOWE",fees:"OPŁATY",accessconstraints:"Ograniczenie dostępu",contactinformation:"ŁĄCZNOŚĆ",subfields:{contactinformation:{contactelectronicmailaddress:"E-mail",personprimary:"Bibliografia",contactvoicetelephone:"Telefon",contactorganization:"Organizacja",ContactOrganization:"Organizacja",contactposition:"Pozycja",ContactPosition:"Pozycja",contactperson:"Osoba",ContactPerson:"Osoba"}},wms_url:"WMS"}},spatial:{title:"PRZESTRZENNY",fields:{crs:"EPSG",extent:"Bbox"}},layers:{title:"Warstwy",fields:{layers:"Warstwy",subfields:{crs:"EPSG",bbox:"Bbox",title:"TYTUŁ",name:"NAZWA",geometrytype:"GEOMETRIA",source:"ŹRÓDŁO",attributes:"Atrybuty",abstract:"ABSTRAKCYJNY",attribution:"ATRYBUCJA",keywords:"Chiave zwolnienia warunkowego",metadataurl:"URL METADATA",dataurl:"URL danych"}},groups:{general:"OGÓLNY",spatial:"PRZESTRZENNY"}}}},tooltips:{relations:{form_to_row:"Widok wiersza",row_to_form:"Widok formularza",zoomtogeometry:"Powiększ geometrię"},copy_map_extent_url:"Kopiuj link Widok Mapa",download_shapefile:"Pobierz ShapeFile",download_gpx:"Pobierz GPX",download_gpkg:"Pobierz GPKG",download_csv:"Pobierz CSV",download_xls:"Pobierz XLS",show_chart:"Wykres pokazowy",atlas:"Wydrukuj atlas"},mapcontrols:{query:{tooltip:"Warstwa zapytania",actions:{add_selection:{hint:"Dodaj/usuń wybór"},zoom_to_features_extent:{hint:"Zoom w zakresie funkcji"},add_features_to_results:{hint:"Dodaj/usuń funkcje do wyników"},remove_feature_from_results:{hint:"Usuń funkcję z wyników"},zoom_to_feature:{hint:"Zoom do funkcji"},relations:{hint:"Pokaż relacje"},relations_charts:{hint:"Pokaż wykres relacji"},download_features_shapefile:{hint:"Pobierz funkcje ShapeFile"},download_shapefile:{hint:"Pobierz funkcję kształtu plik"},download_features_gpx:{hint:"Pobierz funkcję GPX"},download_features_gpkg:{hint:"Pobierz funkcje GPKG"},download_gpx:{hint:"Pobierz funkcję GPX"},download_gpkg:{hint:"Pobierz funkcję gpkg"},download_features_csv:{hint:"Pobierz funkcje CSV"},download_csv:{hint:"Pobierz funkcję CSV"},download_features_xls:{hint:"Pobierz funkcje XLS"},download_xls:{hint:"Pobierz funkcję XLS"},atlas:{hint:"Wydrukuj atlas"},copy_zoom_to_fid_url:{hint:"Skopiuj adres URL map z tym rozszerzeniem funkcji geometrii",hint_change:"Skopiowane"}}},queryby:{title:"Query area",layer:"Selected layer:",none:"NONE",new:"TEMPORARY LAYER",all:"ALL",methods:{intersects:"intersects",within:"within"},querybypolygon:{tooltip:"select a polygon"},querybydrawpolygon:{tooltip:"draw a polygon"},querybbox:{tooltip:"draw a rectangle"},querybycircle:{tooltip:"draw a circle"}},querybypolygon:{download:{title:"Pobieranie atrybutów",choiches:{feature:{label:"Tylko funkcje"},feature_polygon:{label:"Funkcje+Polygon zapytania"}}},tooltip:"Zapytanie według wielokąta",no_geometry:"Brak geometrii w odpowiedzi",help:{message:"<ul><li>Wybierz warstwę wielokąta na Toc.</li><li>upewnij się, że warstwa jest widoczna.</li><li>Kliknij funkcję wybranej warstwy.</li></ul>"}},querybydrawpolygon:{tooltip:"Zapytanie przez Polygon Draw"},querybbox:{tooltip:"Zapytanie warstwa Bbox",nolayers_visible:"Nie widać zapytaniach warstw. Ustaw co najmniej jedną widoczną warstwę WFS, aby uruchomić zapytanie",help:{message:"<ul><li>Narysuj kwadrat na mapie, aby zapytają podkreślone warstwy na Toc</li></ul>"}},querybycircle:{tooltip:"Query by Draw Circle ",label:"Radius",help:{message:"<ul><li>Click on map to draw circle</li></ul>"}},addlayer:{messages:{csv:{warning:"Wynik na mapie jest częściowy ze względu na obecność poniższej listy błędnych rekordów:"}},tooltip:"Dodaj warstwę"},geolocation:{tooltip:"Geolokalizację"},measures:{length:{tooltip:"Długość",help:"Kliknij mapę, aby narysować linię. Naciśnij <br> Canc, jeśli chcesz usunąć ostatni wierzchołek"},area:{tooltip:"Obszar",help:"Kliknij, aby narysować Poligon.press <br> Canc Jeśli chcesz usunąć ostatni wierzchołek"}},scale:{no_valid_scale:"Nieprawidłowa skala"},scaleline:{units:{metric:"Metry",nautical:"Mila morska"}},zoomhistory:{zoom_last:"Zoom ostatni",zoom_next:"Zoom Dalej"}},relations:{relation_data:"Dane dotyczące relacji",no_relations_found:"Nie znaleziono żadnych relacji",back_to_relations:"Powrót do relacji",list_of_relations_feature:"Lista relacji funkcji",error_missing_father_field:"Brakuje pola",field:"Relation key field"},form:{loading:"Ładowanie ...",inputs:{messages:{errors:{picklayer:"Brak wybranej funkcji. Sprawdź, czy warstwa jest w edycji lub widoczna w bieżącej skali"}},tooltips:{picklayer:"Uzyskaj wartość z warstwy MA",lonlat:"Kliknij mapę, aby uzyskać współrzędne"},input_validation_mutually_exclusive:"Pole wzajemnie wykluczające się z",input_validation_error:"Obowiązkowe pole lub niewłaściwy typ danych",input_validation_min_field:"Wartość musi być większa/równa wartości pola",input_validation_max_field:"Wartość musi być mniej/równa wartości pola",input_validation_exclude_values:"Wartość musi być wyjątkowa",integer:"liczba całkowita",bigint:"liczba całkowita",text:"tekst",varchar:"tekst",textarea:"tekst",string:"strunowy",date:"data",datetime:"data",float:"platforma",table:"tabela"},footer:{required_fields:"Wymagane pola"},messages:{qgis_input_widget_relation:"Użyj relacji konkretna forma do pracy w związku z relacją"}},catalog:{current_map_theme_prefix:"TEMAT",choose_map_theme:"Wybierz motyw",menu:{layerposition:"Pozycja warstwy",setwmsopacity:"Ustaw krycie",wms:{title:"--",copy:"Kliknij tutaj, aby skopiować adres URL",copied:"Skopiowane"},download:{unknow:"Pobierać",shp:"Pobierz ShapeFile",gpx:"Pobierz GPX",gpkg:"Pobierz GPKG",csv:"Pobierz CSV",xls:"Pobierz XLS",geotiff:"Pobierz Geotiff",geotiff_map_extent:"Pobierz Geotiff (Obecny zasięg View)"}}},wps:{list_process:"Lista procesu",tooltip:"Kliknij mapę"}},credits:{g3wSuiteFramework:"Aplikacja oparta na strukturze systemu operacyjnego",g3wSuiteDescription:"Publikuj i zarządzaj projektami QGIS w Internecie",productOf:"Ramy opracowane przez"},toggle_color_scheme:"Przełącz kolorystykę",logout:"Wyloguj",no_other_projects:"Nigdy więcej projektu dla tej grupy",no_other_groups:"Nigdy więcej grup dla tej makrogrupy",yes:"Tak",no:"NIE",back:"Z powrotem",backto:"Wrócić do",changemap:"Zmień mapę",change_session:"Zmień sesję",component:"Komponent ogólny",search:"Szukaj",no_results:"Nie znaleziono wyników",print:"Wydrukować",create_print:"Utwórz druk",dosearch:"Szukaj",catalog:"Mapa",data:"Dane",externalwms:"WMS",baselayers:"Baza",tools:"Narzędzia",tree:"Warstwy",legend:"Legenda",nobaselayer:"Brak mapy bazowej",street_search:"Znajdź adres",show:"Pokazywać",hide:"Ukrywać",copy_form_data:"Skopiuj dane",paste_form_data:"Pasta",copy_form_data_from_feature:"Skopiuj dane z mapy",error_map_loading:"Występuje błąd mapy ładowania",check_internet_connection_or_server_admin:"Sprawdź połączenie internetowe lub skontaktuj się z administratorem",could_not_load_vector_layers:"Błąd połączenia: Warstwy można załadować",server_saver_error:"Błąd zapisywania serwera",server_error:"Błąd połączenia serwera",save:"Ratować",cancel:"Anulować",close:"Zamknąć",dont_show_again:"Nie pokazuj ponownie",enlange_reduce:"Powiększ / zmniejsz",reset_default:"Rozmiar domyślny",add:"Dodać",exitnosave:"Wyjdź bez zapisu",annul:"Anulować",layer_is_added:"Warstwa o tej samej nazwie już dodanej",sidebar:{wms:{panel:{title:"Dodaj warstwę WMS",label:{position:"Pozycja mapy",name:"Nazwa",projections:"Występ",layers:"Warstwy"}},add_wms_layer:"Dodaj warstwę WMS",delete_wms_url:"Usuń adres URL WMS",layer_id_already_added:"Już dodana warstwa WMS",url_already_added:"WMS URL/Nazwa już dodana",layer_add_error:"Warstwa WMS nie dodano. Sprawdź wszystkich parametrów lub adresu URL WMS"}},info:{title:"Wyniki",list_of_relations:"Lista relacji",open_link:"Otwarty załączony dokument",server_error:"Wystąpił błąd z serwera",no_results:"Nie znaleziono wyników dla tego zapytania/wyszukiwania",link_button:"otwarty"},mapcontrols:{geolocations:{error:"Nie mogę zdobyć swojej pozycji"},geocoding:{choose_layer:"Wybierz warstwę, gdzie dodać tę funkcję",placeholder:"Adres ...",nolayers:"Brak edytowalnych warstw punktowych w tym projekcie",noresults:"Brak wyników",notresponseserver:"Brak odpowiedzi z serwera"},add_layer_control:{header:"Dodaj warstwę",select_projection:"Wybierz projekcję warstwy",select_field_to_show:"Wybierz pole, aby pokazać na mapie",select_csv_separator:"Wybierz Selimiter",select_csv_x_field:"Wybierz pole x",select_csv_y_field:"Wybierz pole Y.",select_color:"Wybierz kolor warstwy",drag_layer:"Przeciągnij i upuść warstwę tutaj"},query:{input_relation:"Kliknij, aby pokazać relacje"},length:{tooltip:"Długość"},area:{tooltip:"Obszar"},screenshot:{error:"Tworzenie błędów z ekranu",securityError:'  \n        <p><b>Błąd bezpieczeństwa</b>: Warstwa zewnętrzna zapobiega wydrukowaniu mapy. Aby sprawdzić, postępuj w następujący sposób:</p>\n        <ol>\n          <li>Usuń wszelkie ręcznie dodane warstwy zewnętrzne (np. WMORY WMS)</li>\n          <li>Przeładowanie strony Siły: <code> CTRL + F5</code></li>\n          <li>Wydrukuj ponownie mapę</li>\n        </ol>\n        <p>Aby uzyskać więcej informacji, skontaktuj się z administratorem serwera o: <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image" style="color: #000 !important;font-weight: bold;">&#x2139;&#xFE0F; security and tainted canvases</a></p>\n        '}},catalog_items:{helptext:"Kliknij indywidualną warstwę prawym przyciskiem myszy, aby uzyskać dostęp do dodatkowych funkcji",contextmenu:{zoomtolayer:"Zoom do warstwy",open_attribute_table:"Otwórz tabelę atrybutów",show_metadata:"Metadane",styles:"Style",vector_color_menu:"Ustaw/zmiana kolor",layer_opacity:"Nieprzezroczystość",filters:"Filtry"}},dataTable:{previous:"Poprzedni",next:"Następny",lengthMenu:"Pokaż menu_",info:"Pokazanie _start_ do _end_ wpisów _total_",no_data:"Brak danych",nodatafilterd:"nie znaleziono pasujacego wyniku",infoFiltered:"(Filtrowane z _max_ całkowitych rekordów)"}}}},{}],155:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default={translation:{error_page:{error:"Eroare de conexiune",at_moment:"Momentan nu este posibil să afișați harta",f5:"Apăsați Ctrl+F5"},cookie_law:{message:"Acest website foloseste cookie-uri pentru a furniza vizitatorilor o experiență mult mai bună de navigare",buttonText:"Am înțeles!"},default:"Implicit",sign_in:"Logare",layer_selection_filter:{tools:{filter:"Activați/Dezactivați filtrul",nofilter:"Eliminare Filtrare",invert:"Inversare Selecție",clear:"Elimină Selecția",show_features_on_map:"Rezultatele se actualizează când harta este deplasată",savefilter:"Salvează Filtrul",filterName:"Nume Filtru"}},warning:{not_supported_format:"Formatul nu este acceptat"},layer_position:{top:"SUS",bottom:"JOS",message:"Poziție relativă la straturile din TOC"},sdk:{atlas:{template_dialog:{title:"Selectați Template"}},spatialbookmarks:{title:"Marcaje spațiale",helptext:"Deplasați-vă pe întinderea hărții, introduceți numele și faceți clic pe Adăugați",input:{name:"Nume"},sections:{project:{title:"Marcaje de proiect"},user:{title:"Marcaje utilizator"}}},search:{all:"Toate",no_results:"Fără rezultat",searching:"Căutare ...",error_loading:"Încărcarea a eșuat",layer_not_searchable:"Nu se poate căuta pe strat",layer_not_querable:"Stratul nu se poate interoga",autocomplete:{inputshort:{pre:"Te rog introdu",post:"sau mai multe caractere"}}},print:{no_layers:"Nu avem straturi de print",template:"Șablon",labels:"Etichete",scale:"Scară",format:"Format",rotation:"Rotație",download_image:"Descarcă Imaginea",fids_instruction:"Valori acceptate: de la 1 la valoarea [max]. Este posibilă inserarea de interval, de ex. 4-6",fids_example:"Ex. 1,4-6 vor fi tipărite id 1,4,5,6",help:"Straturile prezentate în print pot fi acelea definite în proiect și nu acelea prezentate în cadrul hărții"},querybuilder:{search:{run:"Execută",info:"Info",delete:"Elimină",edit:"Modifică"},messages:{changed:"Salvat",number_of_features:"Număr de entități"},panel:{button:{all:"TOATE",save:"SALVEAZĂ",test:"TEST",clear:"ȘTERGE",run:"RUN",manual:"MANUAL"},layers:"STRATURI",fields:"CÂMPURI",values:"VALORI",operators:"OPERATORI",expression:"EXPRESII"},error_run:"A survenit o eroare. De verificat interogarea",error_test:"A survenit o eroare în timp ce se executa interogarea",delete:"Vrei să o ștergi?",additem:"Introdu numele noii căutări"},errors:{layers:{load:"Câteva straturi nu sunt disponibile"},unsupported_format:"Formatul nu este acceptat",add_external_layer:"Eroare încărcare strat"},metadata:{title:"Metadate",groups:{general:{title:"GENERALITĂȚI",fields:{title:"TITLU",name:"NUME",description:"DESCRIERE",abstract:"ABSTRACT",keywords:"CUVINTE CHEIE",fees:"TAXE",accessconstraints:"CONSTRÂNGERI DE ACCES",contactinformation:"CONTACTE",subfields:{contactinformation:{contactelectronicmailaddress:"Email",personprimary:"Referințe",contactvoicetelephone:"Telefon",contactorganization:"Organizație",ContactOrganization:"Organizație",contactposition:"Poziție",ContactPosition:"Poziție",contactperson:"Persoana",ContactPerson:"Persoana"}},wms_url:"WMS"}},spatial:{title:"SPAȚIAL",fields:{crs:"EPSG",extent:"BBOX"}},layers:{title:"STRATURI",fields:{layers:"STRATURI",subfields:{crs:"EPSG",bbox:"BBOX",title:"TITLU",name:"NUME",geometrytype:"GEOMETRIE",source:"SURSA",attributes:"ATRIBUTE",abstract:"ABSTRACT",attribution:"ATRIBUIRE",keywords:"CUVINTE CHEIE",metadataurl:"URL METADATE",dataurl:"URL DATE"}},groups:{general:"GENERALITĂȚI",spatial:"SPAȚIAL"}}}},tooltips:{relations:{form_to_row:"Vizualizare pe rânduri",row_to_form:"Vizualizare formular",zoomtogeometry:"Măriți la geometrie"},copy_map_extent_url:"Copiază linkul de vizualizare hartă",download_shapefile:"Descarcă Shapefile",download_gpx:"Descarcă GPX",download_gpkg:"Descarcă GPKG",download_csv:"Descarcă CSV",download_xls:"Descarcă XLS",download_pdf:"Descarcă PDF",show_chart:"Arată Diagrama",atlas:"Tipărire Atlas",editing:"Editing"},mapcontrols:{query:{tooltip:"Interogare strat",actions:{add_selection:{hint:"Adaugă/Elimină Selecția"},zoom_to_features_extent:{hint:"Zoom la încadrarea entităților"},add_features_to_results:{hint:"Adaugă/Elimină entități rezultat"},remove_feature_from_results:{hint:"Elimină entitate din rezultat"},zoom_to_feature:{hint:"Zoom la entitate"},relations:{hint:"Arată Relațiile"},relations_charts:{hint:"Arată diagrama de relații"},download_features_shapefile:{hint:"Descarcă entități în Shapefile"},download_shapefile:{hint:"Descarcă entitate în Shapefile"},download_features_gpx:{hint:"Descarcă entități în GPX"},download_features_gpkg:{hint:"Descarcă entități în GPKG"},download_gpx:{hint:"Descarcă entitate în GPX"},download_gpkg:{hint:"Descarcă entitate în GPKG"},download_features_csv:{hint:"Descarcă entități în CSV"},download_csv:{hint:"Descarcă entitate în CSV"},download_features_xls:{hint:"Descarcă entități în XLS"},download_xls:{hint:"Descarcă entitate în XLS"},download_pdf:{hint:"Descarcă entitate în PDF"},atlas:{hint:"Tipărire Atlas"},copy_zoom_to_fid_url:{hint:"Copiază URL hartă cu întinderea geometriei entității",hint_change:"Copiat"}}},queryby:{title:"Query area",layer:"Selected layer:",none:"NONE",new:"TEMPORARY LAYER",all:"ALL",methods:{intersects:"intersects",within:"within"},querybypolygon:{tooltip:"select a polygon"},querybydrawpolygon:{tooltip:"draw a polygon"},querybbox:{tooltip:"draw a rectangle"},querybycircle:{tooltip:"draw a circle"}},querybypolygon:{download:{title:"Descărcare atribute",choiches:{feature:{label:"Doar entități"},feature_polygon:{label:"Entități+Poligon Interogare"}}},tooltip:"Interogare După Poligon",no_geometry:"Nu avem geometrii în răspuns",help:{message:"<ul><li>Selectează un strat poligon din TOC.</li><li>Asigură-te că stratul este vizibil.</li><li>Click pe o entitate a stratului selectat.</li></ul>"}},querybydrawpolygon:{tooltip:"Interogare prin poligon de desen"},querybbox:{tooltip:"Interogare BBox strat",nolayers_visible:"Nu este vizibil niciun strat de interogare. Trebuie setat cel puțin un strat WFS vizibil pentru a efectua interogarea",help:{message:"<ul><li>Desenează un pătrat pe hartă pentru a interoga straturile din TOC de sub </li></ul>"}},querybycircle:{tooltip:"Query by Draw Circle ",label:"Radius",help:{message:"<ul><li>Click on map to draw circle</li></ul>"}},addlayer:{messages:{csv:{warning:"Rezultateul pe hartă este parțial datorită prezenței următoarei liste de rezultate incorecte:"}},tooltip:"Adaugă Strat"},geolocation:{tooltip:"Geolocalizare"},measures:{length:{tooltip:"Lungime",help:"Click pe hartă pentru a desena linia. Apasă <br>CANC dacă dorești să ștergi ultimul vertex"},area:{tooltip:"Aria",help:"Click pentru desen poligon. Apasă <br>CANC dacă dorești să ștergi ultimul vertex"}},scale:{no_valid_scale:"Scară Invalidă"},scaleline:{units:{metric:"Metri",nautical:"Mile Nautice"}},zoomhistory:{zoom_last:"Zoom Anterior",zoom_next:"Zoom Urmatorul"}},relations:{relation_data:"Date Relații",no_relations_found:"Nu am găsit nicio relație",back_to_relations:"Înapoi la relații",list_of_relations_feature:"Lista de relații a entității",error_missing_father_field:"Câmpul de legătură lipsește",field:"Relation key field"},form:{loading:"Se încarcă ...",inputs:{messages:{errors:{picklayer:"Nu avem entitate selectată. Verifică dacă stratul este în editare sau vizibil la scara curentă if layer is on editing or visible at current scale"}},tooltips:{picklayer:"Ia valoare din strat",lonlat:"Click pe hartă pentru a prelua coordonate"},input_validation_mutually_exclusive:"Câmp ce se exclude mutual cu ",input_validation_error:"Câmp mandatoriu sau tip de date greșit",input_validation_min_field:"Valoarea trebuie să fie mai mare/egală cu valoare câmpului ",input_validation_max_field:"Valoarea trebuie să fie mai mică/egală cu valoare câmpului ",input_validation_exclude_values:"Valoarea trebuie să fie unică",integer:"integer - nr. întreg",bigint:"integer - nr. întreg",text:"text",varchar:"text",textarea:"text",string:"string - text",date:"data",datetime:"data",float:"float - nr. cu zecimale",table:"tabelă"},footer:{required_fields:"Câmpuri necesare"},messages:{qgis_input_widget_relation:"Folosește formular specific de relații pentru a lucra cu relația"}},catalog:{current_map_theme_prefix:"TEMA",choose_map_theme:"ALEGE TEMA",choose_map_theme_input_label:"Numele noii tema",project_map_theme:"Tema de proiect",user_map_theme:"Tema utilizator",question_delete_map_theme:"Doriți să ștergeți tema?",delete_map_theme:"Tema a fost ștearsă cu succes",saved_map_theme:"Tema a fost salvată cu succes",updated_map_theme:"Tema a fost actualizată cu succes",invalid_map_theme_name:"Numele există deja sau este incorect",menu:{layerposition:"Poziție Strat",setwmsopacity:"Alege Opacitatea",wms:{title:"Titlu",copy:"Click pentru copiere URL",copied:"Copiat"},download:{unknow:"Descarcă",shp:"Descarcă Shapefile",gpx:"Descarcă GPX",gpkg:"Descarcă GPKG",csv:"Descarcă CSV",xls:"Descarcă XLS",geotiff:"Descarcă GEOTIFF",geotiff_map_extent:"Descarcă GEOTIFF(ce se vede în cadrul hărții)"}}},wps:{list_process:"Lista de procese",tooltip:"Click pe hartă"}},credits:{g3wSuiteFramework:"Aplicație bazată pe frameworkul",g3wSuiteDescription:"Publică și administrează proiectele de QGIS pe WEB",productOf:"Framework dezvoltat de"},toggle_color_scheme:"Comutare schemă de culori",logout:"Deconectare",no_other_projects:"No more project for this group",no_other_groups:"Nu mai sunt grupuri pentru acest macrogrup",yes:"Da",no:"Nu",back:"Înapoi",backto:"Înapoi la ",changemap:"Schimbare Hartă",change_session:"Schimbați sesiunea",component:"Componentă Generică",search:"Căutare",no_results:"Niciun rezultat găsit",print:"Tipărire",create_print:"Tipărește",dosearch:"Caută",catalog:"Hartă",data:"Data",externalwms:"WMS",baselayers:"Straturi Bază",tools:"Instrumente",tree:"Straturi",legend:"Legendă",nobaselayer:"Fără strat de bază",street_search:"Caută Adresă",show:"Arată",hide:"Ascunde",copy_form_data:"Copiază data",paste_form_data:"Lipește",copy_form_data_from_feature:"Copiază data din hartă",error_map_loading:"Sunt erori la încărcarea hărții",check_internet_connection_or_server_admin:"Verificați conexiune de internet sau contactați administratorul de sistem",could_not_load_vector_layers:"Eroare de conexiune: Straturile nu pot fi încărcate",server_saver_error:"Eroare la salvarea pe server",server_error:"Eroare de conexiune la server",save:"Salvează",cancel:"Anulează",update:"Actualizați",close:"Închide",dont_show_again:"Nu mai afișa mesajul",enlange_reduce:"Mărește / Micșorează",reset_default:"Mărimea implicită",add:"Adaugă",exitnosave:"Ieșire fără salvare",annul:"Anulează",layer_is_added:"Există un strat cu același nume deja adăugat",sidebar:{wms:{panel:{title:"Adaugă strat WMS",label:{position:"Poziție Hartă",name:"Nume",projections:"Proiecție",layers:"Straturi"}},add_wms_layer:"Adaugă strat WMS",delete_wms_url:"Șterge URL WMS",layer_id_already_added:"Strat WMS deja adăugat",url_already_added:"URL WMS/Nume deja adăugat",layer_add_error:"Stratul WMS nu s-a adăugat. Verificați URL-ul sau parametrii WMS"}},info:{title:"Rezultate",list_of_relations:"List of Relations",open_link:"Deschide document atașat",server_error:"Serverul a întâmpinat o eroare",no_results:"Niciun rezultat",link_button:"Deschide"},mapcontrols:{geolocation:{error:"Nu te-am putut localiza"},geocoding:{choose_layer:"Alegeți un strat unde să adăugați această caracteristică",placeholder:"Adresa ...",nolayers:"Nu s-au găsit straturi de puncte editabile în acest proiect",noresults:"Niciun rezultat",notresponseserver:"Niciun răspuns de la server"},add_layer_control:{header:"Adăugare Strat",select_projection:"Selectează proiecția strat",select_field_to_show:"Selectează câmpul de arătat pe hartă",select_csv_separator:"Selectează delimitatorul",select_csv_x_field:"Selectează câmpul X - Est",select_csv_y_field:"Selectează câmpul Y - Nord",select_color:"Selectează culoare strat",drag_layer:"Trageți stratul aici (Drag&Drop)"},query:{input_relation:"Click pentru a arăta relațiile"},length:{tooltip:"Lungime"},area:{tooltip:"Arie"},screenshot:{error:"Eroare captură ecran",securityError:'  \n        <p><b>Eroare de securitate</b>: un strat extern împiedică imprimarea hărții. Pentru a verifica, procedați după cum urmează:</p>\n        <ol>\n          <li>eliminați orice straturi externe adăugate manual (de exemplu, straturi WMS)</li>\n          <li>forțați reîncărcarea paginii: <code>CTRL + F5</code></li>\n          <li>tipărește din nou harta</li>\n        </ol>\n        <p>Pentru mai multe informații, vă rugăm să contactați administratorul serverului despre: <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image" style="color: #000 !important;font -greutate: bold;">&#x2139;&#xFE0F; securitate și pânze contaminate</a></p>\n        '}},catalog_items:{helptext:"Click dreapta pe strat pentru a accesa opțiuni",contextmenu:{zoomtolayer:"Zoom pe Strat",open_attribute_table:"Deschide Tabela Atribute",show_metadata:"Metadate",styles:"Stiluri",vector_color_menu:"Setează/Schimbă Culoare",layer_opacity:"Opacitate",filters:"Filters"}},dataTable:{previous:"Anteriorul",next:"Următorul",lengthMenu:"Afișați _MENU_ valori pe pagină",info:"_TOTAL_ rezultate",no_data:"Fără date",nodatafilterd:"Niciun rezultat",infoFiltered:"(filtrat din _MAX_ de rezultate totale)"}}}},{}],156:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default={translation:{error_page:{error:"Anslutningsfel",at_moment:"För närvarande är det inte möjligt att visa kartan",f5:"Tryck på Ctrl+F5"},cookie_law:{message:"Denna applikation använder cookies för att den ska fungera så bra som möjligt för dig.",buttonText:"Jag accepterar"},default:"standard",sign_in:"Logga in",layer_selection_filter:{tools:{filter:"Aktivera/inaktivera filter",nofilter:"Avlägsna Filtrera",invert:"Invertera Urval",clear:"Annullera Urval",show_features_on_map:"Rezultatele se actualizează când harta este deplasată",savefilter:"Spara Filter",filterName:"Filternamn"}},warning:{not_supported_format:"Formatet stöds inte"},layer_position:{top:"Överst",bottom:"Underst",message:"Position relativt till lager i lagerlistan"},sdk:{atlas:{template_dialog:{title:"Välj Template"}},spatialbookmarks:{title:"Rumsliga bokmärken",helptext:"Flytta på kartans omfattning, ange namn och klicka på Lägg till",input:{name:"Namn"},sections:{project:{title:"Projektbokmärken"},user:{title:"Användarbokmärken"}}},search:{all:"ALLA",no_results:"Inga resultat",searching:"Sökning ...",error_loading:"Fel vid laddning av uppgifter.",layer_not_searchable:"Nivån kan inte sökas.",layer_not_querable:"Förfrågningar kan inte göras på nivån.",autocomplete:{inputshort:{pre:"Mata in",post:"eller flera tecken"}}},print:{no_layers:"Inga nivåer att skriva ut",template:"Template",labels:"Labels",scale:"Skala",format:"Format",rotation:"Rotation",download_image:"Ladda ner bild",fids_instruction:"Godkända värden: Från ett till värdet [max]. Mellanslag tillåts, t.ex. 4-6.",fids_example:"Exempelvis 1,4-6 skriver ut id 1,4,5,6.",help:"Nivåerna på utskriften kan vara specificerade i ett projekt inte sådana som visas på karta."},querybuilder:{search:{run:"Utför",info:"Information",delete:"Ta bort",edit:"Redigera"},messages:{changed:"Sparat",number_of_features:"Antal funktione"},panel:{button:{all:"ALLA",save:"SPARA",test:"TEST",clear:"TÖM",run:"UTFÖR",manual:"MANUELL"},layers:"NIVÅER",fields:"FÄLT",values:"VÄRDEN",operators:"OPERATÖRER",expression:"KLAUSUL"},error_run:"Ett fel inträffade. Kontrollera förfrågan.",error_test:"Ett fel inträffade när förfrågan utfördes.",delete:"Vill du ta bort den?",additem:"Ge den nya sökningen ett namn."},errors:{layers:{load:"Vissa nivåer är inte tillgängliga."},unsupported_format:"Formatet stöds inte",add_external_layer:"Fel vid laddning av nivån"},metadata:{title:"Metadata",groups:{general:{title:"ALLMÄN",fields:{title:"RUBRIK",name:"NAMN",description:"BESKRIVNING",abstract:"SAMMANDRAG",keywords:"NYCKELORD",fees:"AVGIFTER",accessconstraints:"ÅTKOMSTBEGRÄNSNINGAR",contactinformation:"KONTAKTUPPGIFTER",subfields:{contactinformation:{contactelectronicmailaddress:"E-post",personprimary:"Referenser",contactvoicetelephone:"Telefon",contactorganization:"Organisation",ContactOrganization:"Organisation",contactposition:"Ställning",ContactPosition:"Ställning",contactperson:"Kontaktperson",ContactPerson:"Kontaktperson"}},wms_url:"WMS"}},spatial:{title:"SPATIAL",fields:{crs:"EPSG",extent:"BBOX"}},layers:{title:"NIVÅER",fields:{layers:"NIVÅER",subfields:{crs:"EPSG",bbox:"BBOX",title:"RUBRIK",name:"NAMN",geometrytype:"GEOMETRI",source:"KÄLLA",attributes:"ATTRIBUT",abstract:"SAMMANDRAG",attribution:"TILLSKRIVNING",keywords:"NYCKELORD",metadataurl:"METADATA URL",dataurl:"DATA URL"}},groups:{general:"ALLMÄN",spatial:"SPATIAL"}}}},tooltips:{relations:{form_to_row:"Radvy",row_to_form:"Tabellvy",zoomtogeometry:"Zooma till geometri"},copy_map_extent_url:"Kopiera länk till karta",download_shapefile:"Ladda SHP-fil",download_gpx:"Ladda GPX-fil",download_gpkg:"Ladda GPKG-fil",download_csv:"Ladda CSV-fil",download_xls:"Ladda XLS-fil",download_pdf:"Ladda PDF-fil",show_chart:"Visa diagram",atlas:"Skriv ut Atlas",editing:"Editing"},mapcontrols:{query:{tooltip:"Förfrågningsnivå",actions:{add_selection:{hint:"Lägg till/Avlägsna Urval"},zoom_to_features_extent:{hint:"Zooma till egenskapens omfattning"},add_features_to_results:{hint:"Add/Remove features to results"},remove_feature_from_results:{hint:"Remove feature from results"},zoom_to_feature:{hint:"Zooma till egenskapen"},relations:{hint:"Visa relationerna"},relations_charts:{hint:"Visa relationsdiagrammet"},download_features_shapefile:{hint:"Ladda egenskapens SHP-fil"},download_shapefile:{hint:"Ladda egenskapens SHP-fil"},download_features_gpx:{hint:"Ladda egenskapens GPX-fil"},download_features_gpkg:{hint:"Ladda egenskapens GPKG-fil"},download_gpx:{hint:"Ladda egenskapens GPX-fil"},download_gpkg:{hint:"Ladda egenskapens GPKG-fil"},download_features_csv:{hint:"Ladda egenskapens CSV-fil"},download_csv:{hint:"Ladda egenskapens CSV-fil"},download_features_xls:{hint:"Ladda egenskapens XLS-fil"},download_xls:{hint:"Ladda egenskapens XLS-fil"},download_pdf:{hint:"Ladda egenskapens PDF-fil"},atlas:{hint:"Skriv ut Atlas"},copy_zoom_to_fid_url:{hint:"Copy map URL with this geometry feature extension",hint_change:"Copied"}}},queryby:{title:"Query area",layer:"Selected layer:",none:"NONE",new:"TEMPORARY LAYER",all:"ALL",methods:{intersects:"intersects",within:"within"},querybypolygon:{tooltip:"select a polygon"},querybydrawpolygon:{tooltip:"draw a polygon"},querybbox:{tooltip:"draw a rectangle"},querybycircle:{tooltip:"draw a circle"}},querybypolygon:{download:{title:"Attributes download",choiches:{feature:{label:"Features only"},feature_polygon:{label:"Features+Query Polygon"}}},tooltip:"Förfrågan med polygon",no_geometry:"No geometry on response",help:{message:"<ul><li>Välj polygonnivå i listan.</li><li>Kontrollera att nivån är synlig.</li><li>Välj egenskap på önskad nivå.</li></ul>"}},querybydrawpolygon:{tooltip:"Fråga efter ritpolygon"},querybbox:{tooltip:"BBox-förfrågan som riktar sig till en nivå",nolayers_visible:"Inga nivåer som förfrågningar kan riktas till. Gör minst en WFS-nivå synlig för att kunna utföra sökningen.",help:{message:"<ul><li>Rita upp en rektangel på kartan för att utföra förfrågan på de i listan understreckade nivåerna.</li></ul>"}},querybycircle:{tooltip:"Query by Draw Circle ",label:"Radius",help:{message:"<ul><li>Click on map to draw circle</li></ul>"}},addlayer:{messages:{csv:{warning:"The result in the map is partial due to the presence of the below incorrect records list:"}},tooltip:"Lägg till nivå"},geolocation:{tooltip:"Geografiskt läge"},measures:{length:{tooltip:"Längd",help:"Rita upp en bruten linje på kartan. Tryck <br>CANC, om du vill ta bort föregående punkt."},area:{tooltip:"Område",help:"Rita upp en polygon på kartan. Tryck <br>CANC, om du vill ta bort föregående punkt."}},scale:{no_valid_scale:"Fel skala"},scaleline:{units:{metric:"Meters",nautical:"Nautical Mile"}},zoomhistory:{zoom_last:"Zoom Föregående",zoom_next:"Zoom Nästa"}},relations:{relation_data:"Relationsuppgifter",no_relations_found:"Inga relationer hittades.",back_to_relations:"Tillbaka till relationerna",list_of_relations_feature:"Lista på egenskapens relationer",error_missing_father_field:"Fält saknas",field:"Relation key field"},form:{loading:"Laddning...",inputs:{messages:{errors:{picklayer:"Inga egenskaper har valts. Kontroller att nivån kan redigeras eller att den syns med nuvarande skala."}},tooltips:{picklayer:"Välj värde på kartnivå",lonlat:"Click on map to get coordinates"},input_validation_mutually_exclusive:"Fälten utesluter varandra.",input_validation_error:"Obligatoriskt fält eller fel datatyp.",input_validation_min_field:"Värdet ska vara större eller lika stort som värdet i fältet.",input_validation_max_field:"Värdet ska vara mindre eller lika stort som värdet i fältet.",input_validation_exclude_values:"Värdet ska vara unikt.",integer:"heltal",bigint:"heltal",text:"text",varchar:"text",textarea:"text",string:"teckensträng",date:"datum",datetime:"datum",float:"flyttal",table:"tabell"},footer:{required_fields:"Obligatoriska fält"},messages:{qgis_input_widget_relation:"Använd den specifika funktinen för att bestämma relationer"}},catalog:{current_map_theme_prefix:"THEME",choose_map_theme:"CHOOSE THEME",choose_map_theme_input_label:"Namn på det nya temat",project_map_theme:"Temat de proiect",user_map_theme:"Temat utilizator",question_delete_map_theme:"Vill du ta bort temat?",delete_map_theme:"Temat har tagits bort",saved_map_theme:"Temat har sparats",updated_map_theme:"Temat har uppdaterats",invalid_map_theme_name:"Namnet finns redan eller är felaktigt",menu:{layerposition:"Lagerposition",setwmsopacity:"Ställ in Opacitet",wms:{title:"",copy:"Tryck här för att kopiera url.",copied:"Kopierad."},download:{unknow:"Ladda",shp:"Ladda SHP-fil",gpx:"Ladda GPX-fil",gpkg:"Ladda GPKG-fil",csv:"Ladda CSV-fil",xls:"Ladda XLS-fil",geotiff:"Ladda GEOTIFF-fil",geotiff_map_extent:"Ladda GEOTIFF-fil(current view extent)"}}},wps:{list_process:"Lista på processer",tooltip:"Välj på kartan"}},credits:{g3wSuiteFramework:"Tillämpningen baserar på OS framework",g3wSuiteDescription:"Publicera och hantera QGIS-projekt på nätet.",productOf:"Framework har utvecklats av"},toggle_color_scheme:"Toggle color scheme",logout:"Logga ut",no_other_projects:"Inga projekt för denna grupp",no_other_groups:"Inga fler grupper för denna makrogrupp",yes:"Ja",no:"Nej",back:"Gå tillbaka",backto:"Tillbaka ",changemap:"Byt karta",change_session:"Ändra session",component:"Allmän komponent",search:"Sök",no_results:"Inga sökresultat",print:"Skriv ut",create_print:"Skapa utskrift",dosearch:"Sök",catalog:"Karta",data:"Data",externalwms:"WMS",baselayers:"Bakgrundskarta",tools:"Verktyg",tree:"Nivåer",legend:"Förklaring till beteckningarna",nobaselayer:"Ingen bakgrundskarta",street_search:"Sök adress",show:"Visa",hide:"Dölj",copy_form_data:"Kopiera uppgifterna",paste_form_data:"Infoga",copy_form_data_from_feature:"Kopiera uppgifter från kartan",error_map_loading:"Fel vid laddning av kartan",check_internet_connection_or_server_admin:"Kontrollera internetanslutningen eller kontakta administratören.",could_not_load_vector_layers:"Fel i anslutningen, nivåer kan inte laddas.",server_saver_error:"Fel vid lagring på servern.",server_error:"Fel på anslutningen till servern",save:"Spara",cancel:"Ånga",update:"Uppdatering",close:"Stäng",dont_show_again:"Visa inte det här meddelandet igen",enlange_reduce:"Förstora / Förminska",reset_default:"Standardstorlek",add:"Lägg till",exitnosave:"Lämna programmet utan att spara",annul:"Ångra",layer_is_added:"Lagret med samma namn har redan lagts till.",sidebar:{wms:{panel:{title:"Add WMS Layer",label:{position:"Map Position",name:"Name",projections:"Projection",layers:"Layers"}},add_wms_layer:"Aggiungi WMS layer",delete_wms_url:"Delete WMS url",layer_id_already_added:"WMS Nivån har redan lagts till.",url_already_added:"WMS URL/Namn har redan lagts till.",layer_add_error:"WMS Layer not added. Please check all wms parameter or url"}},info:{title:"Resultat",list_of_relations:"List of Relations",open_link:"Öppna filbilaga",server_error:"Ett fel uppstod på servern.",no_results:"Inga resultat för sökningen/förfrågan.",link_button:"Öppna"},mapcontrols:{geolocation:{error:"Du kan inte lokaliseras"},geocoding:{choose_layer:"Välj ett lager där du vill lägga till denna funktion",placeholder:"Adress ...",nolayers:"Inga redigerbara punktlager hittades i det här projektet",noresults:"Inga resultat",notresponseserver:"Inget svar från servern"},add_layer_control:{header:"Lägg till nivå",select_projection:"Välj projektion för nivån",select_field_to_show:"Select Field to show on map",select_csv_separator:"Select delimiter",select_csv_x_field:"Select X field",select_csv_y_field:"Select Y field",select_color:"Välj färg på nivån",drag_layer:"Dra och släpp nivån hit"},query:{input_relation:"Tryck för att visa relationerna"},length:{tooltip:"Längd"},area:{tooltip:"Areal"},screenshot:{error:"Screenshot error creation",securityError:'  \n        <p><b>Säkerhetsfel</b>: ett externt lager hindrar kartan från att skrivas ut. Gör så här för att kontrollera:</p>\n        <ol>\n          <li>ta bort alla manuellt tillagda externa lager (t.ex. WMS-lager)</li>\n          <li>tvinga om inläsning av sidan: <code>CTRL + F5</code></li>\n          <li>skriv ut kartan igen</li>\n        </ol>\n        <p>För mer information kontakta serveradministratören om: <a href="https://developer.mozilla.org/en-US/docs/Web/HTML/CORS_enabled_image" style="color: #000 !important;font -vikt: fet;">&#x2139;&#xFE0F; säkerhet och nedsmutsade dukar</a></p>\n        '}},catalog_items:{helptext:"Högerklicka på en enskild nivå för att komma till tilläggsegenskaperna.",contextmenu:{zoomtolayer:"Zooma till nivå",open_attribute_table:"Öppna attributtabellen",show_metadata:"Metadata",styles:"Stilar",vector_color_menu:"Ställ in/ändra färg",layer_opacity:"Opacitet",filters:"Filters"}},dataTable:{previous:"Föregående",next:"Nästa",lengthMenu:"Visa _MENU_ värden per sida",info:"_TOTAL_ resultat",no_data:"Inga uppgifter",nodatafilterd:"Inga motsvarande poster hittades",infoFiltered:"(filtered from _MAX_ total records)"}}}},{}],157:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.GeolocationControl=void 0;var n=function(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e};function i(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=o(e("services/gui")),e=o(e("map/controls/interactioncontrol"));function o(e){return e&&e.__esModule?e:{default:e}}a.GeolocationControl=(e=>{var t=a;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);function a(){var t;if(this instanceof a)return(t=((e,t)=>{if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")})(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,{visible:!0,offline:!1,enabled:!0,name:"geolocation",tipLabel:"sdk.mapcontrols.geolocation.tooltip",label:""})))._layer=new ol.layer.Vector({source:new ol.source.Vector,style:new ol.style.Style({text:new ol.style.Text({text:"",font:'900 3em "Font Awesome 5 Free"',fill:new ol.style.Fill({color:"red"}),offsetY:-15})})}),t._geolocation=new ol.Geolocation({trackingOptions:{enableHighAccuracy:!0}}),t.on("controlclick",function(e){t._geolocation.getTracking()?t._geolocation.setTracking(!1):t.geolocate()}),t;throw new TypeError("Cannot call a class as a function")}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e),n(a,[{key:"_showMarker",value:function(e){var t=e.map,a=e.coordinates,e=e.show,e=void 0===e||e;this._layer&&(this._layer.getSource().clear(),e?(t.getView().setCenter(a),this._layer.getSource().addFeature(new ol.Feature({geometry:new ol.geom.Point(a)})),t.addLayer(this._layer)):t.removeLayer(this._layer))}},{key:"geolocate",value:function(){var t,a=this,n=this.getMap();n&&(t=void 0,this._geolocation.on("change:position",function(){var e=a._geolocation.getPosition();e&&(t=a.on("toggled",function(){a._showMarker({map:n,coordinates:a._geolocation.getPosition(),show:a.isToggled()})}),$(a.element).removeClass("g3w-ol-disabled"),a._showMarker({map:n,coordinates:e,show:a.isToggled()}))}),this._geolocation.on("error",function(e){a._layer=null,r.default.showUserMessage({type:"warning",title:"mapcontrols.geolocation.error",message:e.message,autoclose:!1}),a.toggle(!1),ol.Observable.unByKey(t),t=null}),this._geolocation.setProjection(n.getView().getProjection()),this._geolocation.setTracking(!0))}}]),a})(e.default)},{"map/controls/interactioncontrol":158,"services/gui":188}],158:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var n=function(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e};function i(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(e,t,a){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);return void 0!==n?"value"in n?n.value:void 0!==(n=n.get)?n.call(a):void 0:null!==(n=Object.getPrototypeOf(e))?r(n,t,a):void 0}var o=e("g3w-constants"),e=e("services/gui"),s=(e=e)&&e.__esModule?e:{default:e};function l(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}function u(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}e=(e=>{var t=i;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,a=i;if(!(t instanceof a))throw new TypeError("Cannot call a class as a function");if(e.ol)return(n=u(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,{element:e.ol.element})))._options=e,n._control=e.ol,n.positionCode=e.position||"tl",n.offline=!0,$(n._control.element).addClass("ol-control-"+n.positionCode),u(n,n);e.enabled=void 0===e.enabled?!!e.interactionClass:e.enabled,e.visible=void 0===e.visible||e.visible;var n,t=(e.name||"").split(" ").join("-").toLowerCase();return e.element||(e.element=(new(Vue.extend({template:'<div class="ol-'+t+' ol-unselectable ol-control">\n          <button type="button" v-t-tooltip="\''+(e.tipLabel||t)+"'\">\n            "+(e.label||"")+(e.customClass?'<i class="'+e.customClass+'"></i>':"")+"\n          </button>\n        </div>"}))).$mount().$el),(n=u(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e)))._options=e,n.cursorClass=e.cursorClass,n._originalonlick=null,n._onclick=e.onclick,n._enabled=e.enabled,n.offline=void 0===e.offline||e.offline,n.name=t,n.id=n.name+"_"+Math.floor(1e6*Math.random()),n.eventKeys={},n.positionCode=e.position||"tl",n.priority=e.priority||0,$(e.element).on("click",function(e){return n._handleClick(e)}),n.setVisible(e.visible),n._options.postRender&&n._options.postRender.call(n),n._toggled=!1,n._toggled=!1,n._interactionClassOptions=e.interactionClassOptions,e.interactionClass&&n.initInteraction(e),u(n)}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e),n(i,[{key:"setMouseCursor",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.cursorClass,a=this.getMap().getViewport();e?setTimeout(function(){return a.classList.add(t)}):a.classList.remove(t)}},{key:"initInteraction",value:function(){var t,a,n=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=e.visible,i=void 0===i||i,r=e.enabled,r=void 0===r||r,o=e.toggled,s=void 0!==o&&o,o=e.clickmap,o=void 0!==o&&o,l=e.interactionClass,l=void 0===l?null:l,u=e.autountoggle,u=void 0!==u&&u,c=e.geometryTypes,c=void 0===c?[]:c,d=e.onhover,d=void 0!==d&&d,p=e.help,p=void 0===p?null:p,f=e.toggledTool,g=e.interactionClassOptions,g=void 0===g?{}:g,h=e.layers,e=e.spatialMethod;this.layers=void 0===h?[]:h,this.unwatches=[],this._visible=i,this.clickmap=o,this._interactionClass=l,this._interaction=null,this._autountoggle=u,this._geometryTypes=c,this._onhover=d,this._help=p,this._helpButton,this._toolButton,this.toggledTool,this.spatialMethod=e,this._interactionClassOptions=g,!0===s&&this.on("setMap",function(){return n.toggle(s)}),this._help&&this._createModalHelp(),f&&this.createControlTool(f),this.setEnable(r),this.spatialMethod&&(t=this.spatialMethod,a=null,this.on("toggled",function(e){!0===e.toggled?a=n.on("change-spatial-method",n.runSpatialQuery):null!==a&&(ol.Observable.unByKey(a),a=null,n.setSpatialMethod(t),n.clear())}))}},{key:"isClickMap",value:function(){return this.clickmap}},{key:"isToggled",value:function(){return this._toggled}},{key:"setEventKey",value:function(e){var t=e.eventType,e=e.eventKey;this.eventKeys[t]={eventKey:e,originalHandler:e.listener}}},{key:"resetOriginalHandlerEvent",value:function(e){this.eventKeys[e]&&this.eventKeys[e].eventKey&&(ol.Observable.unByKey(this.eventKeys[e].eventKey),this.eventKeys[e].eventKey=this.on(e,this.eventKeys[e].originalHandler))}},{key:"overwriteEventHandler",value:function(e){var t=e.eventType,e=e.handler;this.eventKeys[t]&&this.eventKeys[t].eventKey&&(ol.Observable.unByKey(this.eventKeys[t].eventKey),this.eventKeys[t].eventKey=this.on(t,e))}},{key:"getPosition",value:function(e){return{top:(e=e||this.positionCode).includes("t"),left:e.includes("l"),bottom:e.includes("b"),right:e.includes("r")}}},{key:"_handleClick",value:function(e){this._enabled&&(this.toggle(),e.preventDefault(),this.dispatchEvent("controlclick"))}},{key:"layout",value:function(e){var t,a,e=$(e.getViewport()).find(".ol-control-"+this.positionCode);e.length&&(t=this.getPosition(),e=e.last(),a=t.left?e.position().left:e.position().right,t=t.left?"left":"right",a=$(this.element).position()[t]+a+e[0].offsetWidth+2,$(this.element).css(t,a+"px"))}},{key:"setMap",value:function(e){var t,a,n=this;this._options.onSetMap&&this._options.onSetMap.call(this,{setter:"before",map:e}),this.layout(e),this._control?this._control.setMap(e):r(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"setMap",this).call(this,e),!this._interaction&&this._interactionClass&&(this._interaction=new this._interactionClass(this._interactionClassOptions),e.addInteraction(this._interaction),this._interaction.setActive(!1)),this._interaction&&this.cursorClass&&this._interaction.on("change:active",function(e){return n.setMouseCursor(e.target.get(e.key))}),this._onclick&&(t=$(this.element).children("button"),a=!1,$(this.element).on("click",l(function*(){a||(a=!0,t.addClass("g3w-ol-disabled"),yield n._onclick(),t.removeClass("g3w-ol-disabled"),a=!1)}))),this.dispatchEvent({type:"setMap",map:e}),this._options.onSetMap&&this._options.onSetMap.call(this,{setter:"after",map:e})}},{key:"hideControl",value:function(){var e,t=$(this.element).position().left,a=$(this.element).outerWidth();$(this.element).siblings(".ol-control-tl").each(function(){$(this).position().left>t&&(e=$(this).position().left,a>$(this).outerWidth()&&(t+=a-$(this).outerWidth()),$(this).css("left",t+"px"),t=e,a=$(this).outerWidth())}),$(this.element).hide()}},{key:"setEnable",value:function(e){$(this.element).find("button").first().toggleClass("g3w-ol-disabled",!e),!e&&this._interaction&&this._interaction.setActive(!1),this._enabled=e}},{key:"getEnable",value:function(){return this._enabled}},{key:"setVisible",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this._visible=e,$(this.element)[e?"show":"hide"]()}},{key:"isVisible",value:function(){return this._visible}},{key:"overwriteOnClickEvent",value:function(e){this._originalonlick=this._originalonlick||this._onclick,this._onclick=e}},{key:"resetOriginalOnClickEvent",value:function(){this._onclick=this._originalonlick||this._onclick,this._originalonlick=null}},{key:"onSelectLayer",value:function(){}},{key:"runSpatialQuery",value:function(){}},{key:"clear",value:function(){}},{key:"onAddExternalLayer",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.layer}},{key:"onRemoveExternalLayer",value:function(e){}},{key:"checkVisibile",value:function(e){return!0}},{key:"enable",value:function(){$(this.element).removeClass("g3w-disabled")}},{key:"disable",value:function(){$(this.element).addClass("g3w-disabled")}},{key:"createControlTool",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};switch(e.type){case"spatialMethod":this.toggledTool={template:'\n            <div style="width: 100%; padding: 5px;">\n              <select ref="select" style="width: 100%" :search="false" v-select2="\'method\'">\n                <option v-for="method in methods">{{ method }}</option>\n              </select>\n            </div>',data:function(){return{methods:o.SPATIAL_METHODS,method:t.getSpatialMethod()}},watch:{method:function(e){return t.setSpatialMethod(e)}},created:function(){s.default.toggleUserMessage(!1)},beforeDestroy:function(){s.default.toggleUserMessage(!0)}};break;case"custom":this.toggledTool=e.component}"how"===e.how&&this._onhover&&(this._toolButton=$('<span style="display:none" class="tool_mapcontrol_button"><i class="'+s.default.getFontClass("tool")+'"></i></span>'),$(this.element).prepend(this._toolButton),this._toolButton.on("click",function(e){e.stopPropagation(),t.showToggledTool(!0)}),$(this.element).hover(function(){return t._toggled&&t._toolButton.show()}),$(this.element).mouseleave(function(){return t._toolButton.hide()}))}},{key:"showToggledTool",value:function(){!(0<arguments.length&&void 0!==arguments[0])||arguments[0]?s.default.showUserMessage({title:this.toggledTool.__title,type:"tool",size:"small",iconClass:this.toggledTool.__iconClass,closable:!!this._toolButton,hooks:{body:this.toggledTool}}):s.default.closeUserMessage()}},{key:"toggle",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:!this._toggled,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};a.parent=void 0!==a.parent&&a.parent,e!==this._toggled&&(this._toggled=e,this.cursorClass&&this.setMouseCursor(e),e&&this.getMap().getControls().forEach(function(e){e.id&&e.toggle&&e.id!==t.id&&e.id!==a.parent&&e.toggle(!1)}),this._interaction&&this._interaction.setActive(e),$(this.element).find("button").first()[e?"addClass":"removeClass"]("g3w-ol-toggled"),e&&this._toolButton?this._toolButton.show():!e&&this._toolButton&&this._toolButton.hide(),this.toggledTool&&this.showToggledTool(this._toggled),this.dispatchEvent({type:"toggled",toggled:e}),this._options.onToggled)&&this._options.onToggled.call(this,e)}},{key:"getGeometryTypes",value:function(){return this._geometryTypes}},{key:"setGeometryTypes",value:function(e){this._geometryTypes=e}},{key:"getInteraction",value:function(){return this._interaction}},{key:"setSpatialMethod",value:function(){this.spatialMethod=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"intersects",this.dispatchEvent({type:"change-spatial-method",spatialMethod:this.spatialMethod})}},{key:"getSpatialMethod",value:function(){return this.spatialMethod}},{key:"setLayers",value:function(){this.layers=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]}},{key:"getOlControl",value:function(){return this._control}},{key:"showHide",value:function(){this.element&&$(this.element).toggle()}}]),i})(ol.control.Control);a.default=e},{"g3w-constants":140,"services/gui":188}],159:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.MeasureControl=a.MeasureInteraction=void 0;var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},i=function(e,t,a){return t&&r(e.prototype,t),a&&r(e,a),e};function r(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=c(e("services/gui")),s=c(e("map/controls/interactioncontrol")),l=e("utils/createMeasureTooltip"),u=e("utils/removeMeasureTooltip");function c(e){return e&&e.__esModule?e:{default:e}}function d(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function p(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var g=e("g3w-i18n").t,h=a.MeasureInteraction=(f(y,ol.interaction.Draw),i(y,[{key:"clear",value:function(){this._layer.getSource().clear(),this._clearMessagesAndListeners(),this._map&&((0,u.removeMeasureTooltip)(n({map:this._map},this.measureTooltip)),this.measureTooltip=null,this._map.removeLayer(this._layer))}},{key:"_clearMessagesAndListeners",value:function(){this._feature=null,this._map&&(this._measureTooltipElement=null,this._helpTooltipElement.innerHTML="",this._helpTooltipElement.classList.add("hidden"),ol.Observable.unByKey(this._featureGeometryChangelistener),ol.Observable.unByKey(this._poinOnMapMoveListener),$(document).off("keydown",this._keyDownEventHandler))}},{key:"_drawStart",value:function(e){var a=this;this._map=this.getMap(),this._map.removeLayer(this._layer),this._feature=e.feature,this.feature&&this._feature.setGeometry(this.feature.getGeometry()),this._keyDownEventHandler=function(e){var t=a._feature.getGeometry();46===e.keyCode&&(t instanceof ol.geom.Polygon&&2<t.getCoordinates()[0].length||t instanceof ol.geom.LineString&&1<t.getCoordinates().length)&&a.removeLastPoint()},$(document).on("keydown",this._keyDownEventHandler),this._layer.getSource().clear(),this._poinOnMapMoveListener=this._map.on("pointermove",function(e){e.dragging||a._feature&&a._helpMsg&&(a._helpTooltipElement.innerHTML=g(a._helpMsg),a._helpTooltip.setPosition(e.coordinate),a._helpTooltipElement.classList.remove("hidden"))}),this._helpTooltipElement&&this._helpTooltipElement.parentNode.removeChild(this._helpTooltipElement),this._helpTooltip&&this._map.removeOverlay(this._helpTooltip),this._helpTooltipElement=document.createElement("div"),this._helpTooltipElement.className="mtooltip hidden",this._helpTooltip=new ol.Overlay({element:this._helpTooltipElement,offset:[15,0],positioning:"center-left"}),this._map.addOverlay(this._helpTooltip),this.measureTooltip&&(0,u.removeMeasureTooltip)(n({},this.measureTooltip,{map:this._map})),this.measureTooltip=(0,l.createMeasureTooltip)({map:this._map,feature:this._feature})}},{key:"_drawEnd",value:function(){this.measureTooltip.tooltip.getElement().className="mtooltip mtooltip-static",this.measureTooltip.tooltip.setOffset([0,-7]),this._clearMessagesAndListeners(),this._map.addLayer(this._layer)}}]),y);function y(e){d(this,y);var t=new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"}),stroke:new ol.style.Stroke({color:e.drawColor||"rgba(0, 0, 0, 0.5)",lineDash:[10,10],width:3}),image:new ol.style.Circle({radius:5,stroke:new ol.style.Stroke({color:"rgba(0, 0, 0, 0.7)"}),fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"})})}),a=new ol.source.Vector,t=p(this,(y.__proto__||Object.getPrototypeOf(y)).call(this,{source:a,type:e.geometryType||"LineString",style:t}));return t._helpTooltip,t._helpMsg=e.help,t._projection=e.projection,t.feature=e.feature,t._map=null,t._feature=null,t._layer=new ol.layer.Vector({source:a,style:function(){return[new ol.style.Style({stroke:new ol.style.Stroke({lineDash:[10,10],width:3}),fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.2)"})})]}}),t.set("beforeRemove",t.clear),t.set("layer",t._layer),t.on("drawstart",t._drawStart),t.on("drawend",t._drawEnd),t}a.MeasureControl=(f(m,s.default),i(m,[{key:"addType",value:function(e){var a=this;this.types.push(e),this._interactionClassOptions.geometryType={area:"Polygon",length:"LineString"}[e],this.interactions[e]=new h(this._interactionClassOptions),this.interactions[e].setActive(!1),this._interaction||(this._interaction=this.interactions[e]),1<this.types.length&&(this.toggledTool=this.toggledTool||{__title:"sdk.mapcontrols.measures.title",__iconClass:"measure",data:function(){return{types:a.types,type:a.types[0]}},template:'\n          <div style="width: 100%; padding: 5px;">\n            <select ref="select" style="width: 100%" :search="false" v-select2="\'type\'">\n              <option v-for="type in types" :value="type" v-t="\'sdk.mapcontrols.measures.\' + type + \'.tooltip\'"></option>\n            </select>\n          </div>',watch:{type:function(e,t){a.interactions[t].setActive(!1),a.interactions[t].clear(),a.getMap().removeInteraction(a.interactions[t]),a.getMap().addInteraction(a.interactions[e]),a.interactions[e].setActive(!0),a._interaction=a.interactions[e]}},created:function(){o.default.toggleUserMessage(!1)},beforeDestroy:function(){o.default.toggleUserMessage(!0)}})}}]),m);function m(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(d(this,m),p(this,(m.__proto__||Object.getPrototypeOf(m)).call(this,n({},e,{clickmap:!0,enabled:!0,onToggled:function(e){this._interaction.setActive(this.isToggled()),e||this._interaction.clear(),e||this.interactions[this.types[0]]===this._interaction||(this.getMap().removeInteraction(this._interaction),this._interaction=this.interactions[this.types[0]],this.getMap().addInteraction(this._interaction))}}))));return t.types=[],t.interactions={},(e.types||[]).forEach(function(e){return t.addType(e)}),0===t.types.length&&t.setVisible(!1),t.on("setMap",function(e){return e.map.addInteraction(t._interaction)}),t}},{"g3w-i18n":143,"map/controls/interactioncontrol":158,"services/gui":188,"utils/createMeasureTooltip":208,"utils/removeMeasureTooltip":249}],160:[function(a,e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.QueryBy=void 0;var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},n=function(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e};function i(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=a("g3w-constants"),s=a("g3w-eventbus"),l=h(a("services/gui")),u=h(a("services/data")),c=h(a("store/application")),d=h(a("map/controls/interactioncontrol")),p=h(a("map/interactions/pickcoordinatesinteraction")),f=a("utils/throttle"),g=a("utils/getCatalogLayerById");function h(e){return e&&e.__esModule?e:{default:e}}function y(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function m(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}var v=a("g3w-i18n").t,_=[o.GEOMETRY_TYPES.POLYGON,o.GEOMETRY_TYPES.POLYGONZ,o.GEOMETRY_TYPES.POLYGONM,o.GEOMETRY_TYPES.POLYGONZM,o.GEOMETRY_TYPES.POLYGON25D,o.GEOMETRY_TYPES.MULTIPOLYGON,o.GEOMETRY_TYPES.MULTIPOLYGONZ,o.GEOMETRY_TYPES.MULTIPOLYGONM,o.GEOMETRY_TYPES.MULTIPOLYGONZM,o.GEOMETRY_TYPES.MULTIPOLYGON25D],b={},w=Vue.observable({bbox:null,dfeature:null,layer:null,feature:null,coordinates:null,radius:0});function x(){return(l.default.getService("map").getSelectedLayer()||{getId:function(){return"__ALL__"}}).getId()}t.QueryBy=(e=>{var t,a=i;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);function i(){var a,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,n=i;if(t instanceof n)return(a=((e,t)=>{if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")})(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,r({},e,{name:"queryby",label:"",tipLabel:"sdk.mapcontrols.queryby.title",enabled:!0,cursorClass:null})))).types=[],(e.types||[]).forEach(function(e){return a.addType(e)}),0===a.types.length?a.setVisible(!1):a.element.classList.add("ol-"+a.types[0]),(b.queryby=a).selectedLayer="__ALL__",a.on("toggled",function(e){var t;if(!e.toggled)return l.default.closeUserMessage();l.default.showUserMessage({title:"sdk.mapcontrols.queryby.title",type:"tool",size:"small",iconClass:"info",closable:!1,hooks:{body:{data:function(){return{types:a.types,type:a.types[0],methods:o.SPATIAL_METHODS,method:a.getSpatialMethod(),layers:[],selectedLayer:x()}},template:'\n              <div style="width: 100%;">\n                \x3c!-- DOCS URL --\x3e\n                <a\n                  :href  = "\'https://g3w-suite.readthedocs.io/en/v3.8.x/g3wsuite_client.html#map-controls\'"\n                  target = "_blank"\n                  style  = "position: absolute;inset: 1em 1em auto auto;"\n                  title  = "Docs"\n                >\n                  <i :class = "g3wtemplate.getFontClass(\'external-link\')"></i>\n                </a>\n                \x3c!-- SPATIAL METHOD --\x3e\n                <div style="padding: 5px;">\n                  <select :search="false" v-select2="\'method\'">\n                    <option v-for="method in methods" :value="method" v-t="\'sdk.mapcontrols.queryby.methods.\' + method"></option>\n                  </select>\n                </div>\n                \x3c!-- QUERY TYPE --\x3e\n                <div style="padding: 5px;">\n                  <select :search="false" v-select2="\'type\'" :templateSelection="templateType" :templateResult="templateType">\n                    <option v-for="type in types" :value="type" v-t="\'sdk.mapcontrols.queryby.\' + type + \'.tooltip\'"></option>\n                  </select>\n                </div>\n                \x3c!-- RADIUS TYPE IN METERS--\x3e\n                <div v-if="\'querybycircle\' === type" style="padding: 5px;">\n                  <label for="g3w_querybycircle_radius" v-t:pre="\'sdk.mapcontrols.querybycircle.label\'">[m]</label>\n                  <div style = "display: flex">\n                    <input\n                      id      = "g3w_querybycircle_radius"\n                      v-model = "radius"\n                      class   =  "form-control"\n                      step    = \'1\'\n                      min     = \'0\'\n                      type    = "number"/>\n                    \x3c!-- CLEAR RADIUS --\x3e\n                    <button \n                      type        = "button" \n                      @click.stop = "radius = 0" \n                      class       = "btn btn-default"\n                    >\n                      <i :class="g3wtemplate.getFontClass(\'clear\')"></i>\n                    </button>\n                  </div>\n                </div>\n                \x3c!-- SELECTED LAYER --\x3e\n                <div style = "padding: 5px;">\n                  <label v-t="\'sdk.mapcontrols.queryby.layer\'"></label>\n                  <select ref="layer" :select2_value = "selectedLayer" v-select2="\'selectedLayer\'" :templateSelection="templateLayer" :templateResult="templateLayer">\n                    <option v-t="all" :value ="\'__ALL__\'"></option>\n                    <option v-for="layer in layers" :value="layer.getId()" :selected="selectedLayer === layer.getId()">{{ layer.get(\'name\') }}</option>\n                    <option :value="\'__NEW__\'" v-t="\'sdk.mapcontrols.queryby.new\'"></option>\n                  </select>\n                </div>\n                \x3c!-- HELP TEXT --\x3e\n                <div ref="help" v-t-html="help"></div>\n                \x3c!-- CLEAR SELECTION --\x3e\n                <button v-if = "![\'__ALL__\', \'__NEW__\'].includes(selectedLayer)" class="clear-selected-layer btn btn-block btn-warning"  @click.stop="selectedLayer = \'__ALL__\'"><i :class = "g3wtemplate.getFontClass(\'clear\')"></i> <span v-t="\'layer_selection_filter.tools.clear\'"></span></button>\n              </div>',computed:{control:function(){return b[this.type]},queryable:function(){var t=this;return(this.control.layers||[]).filter(function(e){return"querybypolygon"!==t.type||_.includes(e.getGeometryType())})},no_layers:function(){return!this.queryable||!k(this.control)},help:function(){return"sdk.mapcontrols."+this.type+".help.message"},all:function(){return this.no_layers?"sdk.mapcontrols.queryby.none":"sdk.mapcontrols.queryby.all"},radius:{get:function(){return w.radius},set:function(e){Number.isNaN(e)||e<0?this.radius=w.radius:(w.radius=Math.floor(e*("m"===l.default.getService("map").getMapUnits()?1:ol.proj.Units.METERS_PER_UNIT.degrees)),w.dfeature&&0<w.radius&&(w.dfeature.getGeometry().setRadius(w.radius),b.queryby.runSpatialQuery(this.type)))}}},watch:{method:function(){this.reset()},type:function(){var e=this;this.reset().then(function(){return e.update__ALL__Text()})},control:function(){var t=this;this.types.forEach(function(e){return b.queryby.element.classList.toggle("ol-"+e,e===t.type)})},layers:function(){this.selectedLayerNotQuerable()},all:function(){this.update__ALL__Text()},selectedLayer:{immediate:!0,handler:function(e,t){var a,n,i=this;this.selectedLayerNotQuerable(),void 0!==t&&(a=l.default.getService("map"),"__NEW__"===e&&(n=a.onafter("loadExternalLayer",function(e){a.selectLayer(e.get("id")),i.reset()}),$("#modal-addlayer").one("hidden.bs.modal",function(){return a.un("loadExternalLayer",n)}),a.showAddLayerModal()),["__ALL__","__NEW__"].includes(e)||e===x()||a.selectLayer(e),["__ALL__","__NEW__"].includes(e))&&"__ALL__"!==x()&&a.selectLayer()}}},methods:{update__ALL__Text:function(){$(this.$refs.layer).select2("close"),$(this.$refs.layer).find('option[value="__ALL__"]').text(v(this.all)),$(this.$refs.layer).select2("data")[0].text=v(this.all),$(this.$refs.layer).trigger("change")},selectedLayerNotQuerable:function(){["__ALL__","__NEW__"].includes(this.selectedLayer)||!this.layers.length||this.layers.map(function(e){return e.getId()}).includes(this.selectedLayer)||(this.selectedLayer="__ALL__")},reset:(t=m(function*(){var e,t=this;this.layers.splice(0),this.types.filter(function(e){return e!==t.type}).forEach(function(e){"querybycircle"===e&&(w.radius=0),"querybbox"===e&&(w.bbox=null),"querybypolygon"===e&&(w.layer=null,w.feature=null,w.coordinates=null),["querybydrawpolygon","querybycircle"].includes(t.type)||(w.dfeature=null),b[e].autorun=!1}),this.control.spatialMethod=this.method,this.control.toggle(!0,{parent:b.queryby.id}),this.control.layers.forEach(function(e){return e.setTocHighlightable(["querybbox","querybydrawpolygon"].includes(t.type))}),yield this.$nextTick(),(e=this.layers).push.apply(e,y(this.queryable)),"querybypolygon"===this.type&&this.control.setEnable(!1),this.control.autorun&&b.queryby.runSpatialQuery(this.type)}),function(){return t.apply(this,arguments)}),templateType:function(e){return e.id?$('<span><i class="'+l.default.getFontClass({querybbox:"square",querybycircle:"empty-circle",querybydrawpolygon:"draw",querybypolygon:"pointer"}[e.id])+'"></i>&nbsp;&nbsp;'+e.text+"</span>"):e.text},templateLayer:function(t){var e;return t.id&&"__NEW__"!==t.id?(e=l.default.getService("map").getLegacyExternalLayers(),e=(0,g.getCatalogLayerById)(t.id)||e.find(function(e){return e.get("id")===t.id}),e="__ALL__"!==t.id&&e?'<i class="'+l.default.getFontClass(e.isVisible()?"eye":"eye-close")+'"></i>&nbsp;&nbsp;':"",$("<span>"+e+t.text+"</span>")):t.text}},mounted:function(){b.queryby.usermessage=this,l.default.toggleUserMessage(!1),this.reset()},beforeDestroy:function(){l.default.toggleUserMessage(!0),a.types.forEach(function(e){b[e].toggle(!1),b[e].autorun=!1,b.queryby.element.classList.toggle("ol-"+e,e===a.types[0]),b[e].layers.forEach(function(e){return e.setTocHighlightable(!1)})})}}}})}),a;throw new TypeError("Cannot call a class as a function")}return a.prototype=Object.create(e&&e.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(a,e):a.__proto__=e),n(i,[{key:"addType",value:function(i){var e,t,a=this;this.types.includes(i)||(this.types.splice(this.types.includes("querybypolygon")?this.types.indexOf("querybypoyling"):this.types.length,0,i),t=b[i]=new d.default({name:i,offline:!1,visible:!1,geometryTypes:["querybypolygon","querybydrawpolygon"].includes(i)?_:[],cursorClass:"querybypolygon"!==i?"ol-crosshair":"ol-pointer",interactionClass:{querybbox:ol.interaction.DragBox,querybycircle:ol.interaction.Draw,querybydrawpolygon:ol.interaction.Draw,querybypolygon:p.default}[i],interactionClassOptions:["querybydrawpolygon","querybycircle"].includes(i)?{type:"querybydrawpolygon"===i?"Polygon":"Circle"}:{},layers:S(i),onSetMap:function(e){var t,a,n=this,e=e.setter;"after"===e&&("querybbox"===i&&(t=null,this._interaction.on("boxstart",function(e){return t=e.coordinate}),this._interaction.on("boxend",(0,f.throttle)(function(e){w.bbox=ol.extent.boundingExtent([t,e.coordinate]),n.dispatchEvent({type:"bboxend",extent:w.bbox}),t=null,n._autountoggle&&n.toggle()})),this.setEventKey({eventType:"bboxend",eventKey:this.on("bboxend",function(){return b.queryby.runSpatialQuery("querybbox")})})),"querybycircle"===i&&this._interaction.on("drawstart",function(e){var t=e.feature.getGeometry();t.setRadius(w.radius),t.on("change",function(){return w.radius=t.getRadius()}),0<w.radius&&n._interaction.finishDrawing()}),["querybydrawpolygon","querybycircle"].includes(i)&&(this._interaction.on("drawend",(0,f.throttle)(function(e){var t;"querybycircle"===i&&(t=e.feature.getGeometry().getRadius(),w.radius=t*("m"===l.default.getService("map").getMapUnits()?1:ol.proj.Units.METERS_PER_UNIT.degrees)),w.dfeature=e.feature,n.dispatchEvent({type:"drawend",feature:w.dfeature}),n._autountoggle&&n.toggle()})),this.setEventKey({eventType:"drawend",eventKey:this.on("drawend",function(){return b.queryby.runSpatialQuery(i)})})),"querybypolygon"===i)&&(this._interaction.on("picked",(0,f.throttle)((a=m(function*(e){w.coordinates=e.coordinate,n.dispatchEvent({type:"picked",coordinates:w.coordinates}),n._autountoggle&&n.toggle()}),function(e){return a.apply(this,arguments)}))),this.setEventKey({eventType:"picked",eventKey:this.on("picked",m(function*(){l.default.closeSideBar();try{var e=(yield u.default.getData("query:coordinates",{inputs:{feature_count:c.default.project.state.feature_count||5,coordinates:w.coordinates},outputs:{show:function(e){var t=e.data,e=e.query,t=0===(void 0===t?[]:t).length;return e.coordinates=t?e.coordinates:null,t}}})).data,t=void 0===e?[]:e;t.length&&t[0].features.length&&(w.feature=t[0].features[0],w.layer=t[0].layer,b.queryby.runSpatialQuery("querybypolygon"))}catch(e){}}))}),this.setEnable(!1))},clickmap:!0}),l.default.getService("map").addControl(i,i,t,!1,!1),t._interaction.on("change:active",function(e){a.setMouseCursor(e.target.get(e.key),t.cursorClass),a.cursorClass=t.cursorClass,["querybbox","querybydrawpolygon"].includes(i)&&(l.default.getService("catalog").state.highlightlayers=e.target.get(e.key))}),this.unwatches=this.unwatches||[],this.unwatches.forEach(function(e){return e()}),this.unwatches.splice(0),(e=this.unwatches).push.apply(e,y(this.types.flatMap(function(e){var t=b[e];return(t.layers||[]).map(function(e){return s.VM.$watch(function(){return e.state.visible},function(){a.usermessage&&$(a.usermessage.$refs.layer).trigger("change"),t.setEnable(t.isToggled()&&k(t)),t._interaction.setActive(t.getEnable())})})}))))}},{key:"onSelectLayer",value:function(i){var e=document.querySelector(".usermessage-content .clear-selected-layer");e&&e.classList.toggle("hidden",!i),this.usermessage&&(this.usermessage.selectedLayer=i?i.getId():"__ALL__"),this.types.forEach(function(e){var t=b[e],a=i&&t.layers.find(function(e){return e===i}),n=i&&i.isQueryable()&&(t.getGeometryTypes()||[]).includes(i.getGeometryType());["querybbox","querybydrawpolygon","querybycircle"].includes(e)&&t.setEnable(t.isToggled()&&(i?a&&a.isVisible():k(t))),"querybypolygon"===e&&t.setEnable(t.isToggled()&&n&&k(t)),t._interaction.setActive(t.getEnable())})}},{key:"onAddExternalLayer",value:function(e){var a=e.layer,n=e.unWatches;this.types.forEach(function(e){var t=b[e];t.layers=S(e),"querybbox"===e&&a.setTocHighlightable(t.isToggled()&&t.getEnable()),n.push(s.VM.$watch(function(){return[a.selected,a.visible]},function(){t.setEnable(t.isToggled()&&(a.selected?a.visible:k(t))),t._interaction.setActive(t.getEnable())},{immediate:!0}))})}},{key:"onRemoveExternalLayer",value:function(a){var e=this;this.types.forEach(function(e){var t=b[e];t.layers=S(e).filter(function(e){return e.getId()!==a.getId()}),t.setEnable(t.isToggled()&&k(b[e])),t._interaction.setActive(t.getEnable())}),setTimeout(function(){e.usermessage&&e.usermessage.reset()})}},{key:"runSpatialQuery",value:(t=m(function*(t){try{var a,e,n,i=b[t];l.default.closeSideBar(),"querybbox"===t&&null===w.bbox||"querybypolygon"===t&&[w.coordinates,w.feature,w.layer].includes(null)||(a=l.default.getService("map").getSelectedLayer(),e=l.default.getService("map").getLegacyExternalLayers(),n=c.default.project,"querybbox"===t&&(yield u.default.getData("query:bbox",{inputs:{bbox:w.bbox,feature_count:n.state.feature_count||5,addExternal:!a||e.some(function(e){return e===a}),layersFilterObject:{SELECTED_OR_ALL:!0,FILTERABLE:!0,VISIBLE:!0},condition:{filtrable:{ows:"WFS"}},multilayers:[].concat(n.state.querymultilayers).includes(i.name),filterConfig:{spatialMethod:i.getSpatialMethod()}}})),["querybypolygon","querybydrawpolygon","querybycircle"].includes(t)&&(yield u.default.getData("query:polygon",{inputs:{layerName:"querybypolygon"===t?w.layer.getName?w.layer.getName():w.layer.get("name"):"",excludeSelected:"querybypolygon"===t||!a,feature:(()=>{switch(t){case"querybypolygon":return w.feature;case"querybydrawpolygon":return w.dfeature;case"querybycircle":var e=w.dfeature.clone();return e.setGeometry(ol.geom.Polygon.fromCircle(w.dfeature.getGeometry(),64)),e}})(),external:{add:"querybypolygon"===t||!a||e.some(function(e){return e===a}),filter:{SELECTED:["querybydrawpolygon","querybycircle"].includes(t)&&(!a||e.some(function(e){return e===a}))}},type:(t||"").replace("queryby","")||void 0,multilayers:[].concat(n.state.querymultilayers).includes("querybypolygon"),filterConfig:{spatialMethod:i.getSpatialMethod()}},outputs:{show:function(e){e=e.error;return!(void 0!==e&&e)}}})),i.autorun=!0)}catch(e){}}),function(e){return t.apply(this,arguments)})}]),i})(d.default);function k(e){var t=l.default.getService("map").getSelectedLayer();return"querybypolygon"===e.name?!(!t||!t.isVisible()||!e.layers.some(function(e){return e!==t&&e.isVisible()&&e.isFilterable({ows:"WFS"})})&&!l.default.getService("map").getLegacyExternalLayers().find(function(e){return e!==t&&!0===e.visible})):!(!(e.layers||[]).some(function(e){return e.isVisible()})&&!l.default.getService("map").getLegacyExternalLayers().some(function(e){return e.visible}))}function S(t){var e=a("services/map").default.MapLayersStoresRegistry.getQuerableLayersStores();return[].concat(y(new Set([].concat(y(e.flatMap(function(e){return e.getLayers({GEOLAYER:!0,FILTERABLE:!0,SELECTED_OR_ALL:!0},{filtrable:{ows:"WFS"}})}).filter(function(e){return"wfs"===e.getProvider("filter").getName()})),y((l.default.getService("map").getLegacyExternalLayers()||[]).filter(function(e){return"querybypolygon"!==t||_.includes(e.getGeometryType())})),y("querybypolygon"===t?e.flatMap(function(e){return e.getLayers({GEOLAYER:!0,QUERYABLE:!0,SELECTED_OR_ALL:!0},{})}):[])))))}},{"g3w-constants":140,"g3w-eventbus":141,"g3w-i18n":143,"map/controls/interactioncontrol":158,"map/interactions/pickcoordinatesinteraction":164,"services/data":187,"services/gui":188,"services/map":190,"store/application":193,"utils/getCatalogLayerById":218,"utils/throttle":256}],161:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.ScaleControl=void 0;var n=function(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e};function i(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,a){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);return void 0!==n?"value"in n?n.value:void 0!==(n=n.get)?n.call(a):void 0:null!==(n=Object.getPrototypeOf(e))?s(n,t,a):void 0}var l=e("g3w-constants"),u=e("utils/getResolutionFromScale"),c=e("utils/getScaleFromResolution");var d=e("g3w-i18n").t;a.ScaleControl=(e=>{var t=o;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);function o(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,a=o;if(!(t instanceof a))throw new TypeError("Cannot call a class as a function");e.target="scale-control",e.offline=!0;t=((e,t)=>{if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")})(this,(o.__proto__||Object.getPrototypeOf(o)).call(this,e));return t.isMobile=e.isMobile||!1,t}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e),n(o,[{key:"layout",value:function(t){var n=this,a=!1,i=!1,r=$(this.element).children("select").select2({tags:!0,dropdownParent:$(t.getTargetElement()),width:"120px",height:"20px",language:{noResults:function(){return d("sdk.mapcontrols.scale.no_valid_scale")}},minimumResultsForSearch:this.isMobile?-1:0,createTag:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=null,a=void 0;return e.term.includes("1:")?a=e.term.split("1:")[1]:Number.isInteger(Number(e.term))&&0<Number(e.term)&&(a=Number(e.term))<=n.scales[0]&&(t={id:a,text:"1:"+e.term,new:!0},o()),t}});function o(){r.find("option").each(function(e,t){return!n.scales.includes(+t.value)&&$(t).remove()})}function s(e){(r.find("option[value='"+e.id+"']").length?r.val(e.id):(o(),r.append(new Option(e.text,e.id,!0,!0)))).trigger("change")}t.on("change:size",function(){return r.select2("close")}),t.on("moveend",function(){var e;a?(s({id:e=parseInt((0,c.getScaleFromResolution)(this.getView().getResolution(),this.getView().getProjection().getUnits())),text:"1:"+e,new:!0}),a=!1):i=!1});function e(){t.getView().on("change:resolution",function(){return a=!i})}e(),t.on("change:view",e),r.on("select2:select",function(e){i=!0;e=e.params.data;e.new&&(o(),s(e)),t.getView().setResolution((0,u.getResolutionFromScale)(+e.id,t.getView().getProjection().getUnits()))})}},{key:"setMap",value:function(e){var t,a,n,i,r;e&&(t=parseInt((0,c.getScaleFromResolution)(e.getView().getResolution(),e.getView().getProjection().getUnits())),this.scales=l.PRINT_SCALES.map(function(e){return e.value}).filter(function(e){return e<t}),this.scales.unshift(t),a=document.createElement("div"),n=document.createElement("select"),i=Object.assign(document.createElement("optgroup"),{label:""}),this.scales.forEach(function(e,t){i.appendChild(Object.assign(document.createElement("option"),{value:e,text:"1:"+e,selected:0===t}))}),n.appendChild(i),this.isMobile||((r=document.createElement("optgroup")).label="Custom",n.appendChild(r)),a.appendChild(n),this.element=a,$(this.element).css("height","20px"),this.layout(e),s(o.prototype.__proto__||Object.getPrototypeOf(o.prototype),"setMap",this).call(this,e))}}]),o})(ol.control.Control)},{"g3w-constants":140,"g3w-i18n":143,"utils/getResolutionFromScale":230,"utils/getScaleFromResolution":231}],162:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.ScreenshotControl=void 0;var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},n=function(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e};function i(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=u(e("store/application")),s=u(e("services/gui")),l=e("utils/sameOrigin"),e=u(e("map/controls/interactioncontrol"));function u(e){return e&&e.__esModule?e:{default:e}}function c(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}a.ScreenshotControl=(e=>{var t=i;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,a=i;if(!(t instanceof a))throw new TypeError("Cannot call a class as a function");e.layers=void 0===e.layers?[]:e.layers;var n=((e,t)=>{if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")})(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,r({name:"maptoimage",tipLabel:"Screenshot",label:"",clickmap:!0,enabled:!0,layers:[]},e)));return n.types=[],(e.types||[]).forEach(function(e){return n.addType(e)}),n.layers=e.layers,n.setVisible(n.checkVisible(n.layers)),n.isVisible()&&(s.default.getService("map").onafter("loadExternalLayer",n._addLayer.bind(n)),s.default.getService("map").onafter("unloadExternalLayer",n._removeLayer.bind(n))),n}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e),n(i,[{key:"addType",value:function(e){var t,a=this;this.types.push(e),this.toggledTool=this.toggledTool||{__title:"sdk.mapcontrols.screenshot.title",__iconClass:"camera",data:function(){return{types:a.types,type:a.types[0]}},template:'\n        <div style="width: 100%; padding: 5px;">\n          <select ref="select" style="width: 100%;" :search="false" v-select2="\'type\'">\n            <option v-for="type in types" :value="type" v-t="\'sdk.mapcontrols.screenshot.\' + type"></option>\n          </select>\n          <button style="margin-top: 5px" class="btn btn-block btn-success" @click.stop="download" v-t="\'sdk.mapcontrols.screenshot.download\'"></button>\n        </div>',methods:{download:(t=c(function*(e){var t=s.default.getService("map");o.default.download=!0,e.target.disabled=!0;try{var a,n=yield t.createMapImage();"screenshot"===this.type?window.saveAs(n,"map_"+Date.now()+".png"):((a=new FormData).append("image",n),a.append("csrfmiddlewaretoken",t.getCookie("csrftoken")),a.append("bbox",t.getMapBBOX().toString()),window.saveAs(yield(yield fetch("/"+t.project.getType()+"/api/asgeotiff/"+t.project.getId()+"/",{method:"POST",body:a})).blob(),"map_"+Date.now()+".tif"))}catch(e){s.default.showUserMessage({type:"SecurityError"===err.name?"warning":"alert",message:"SecurityError"===err.name?"mapcontrols.screenshot.securityError":"mapcontrols.screenshot.error",autoclose:!1})}return o.default.download=!1,!(e.target.disabled=!1)}),function(e){return t.apply(this,arguments)})},created:function(){s.default.toggleUserMessage(!1)},beforeDestroy:function(){s.default.toggleUserMessage(!0)}}}},{key:"_addLayer",value:function(e){var t=this;this.layers.push(e),this.change(this.layers),e.on("change:visible",function(){return t.change(t.layers)})}},{key:"_removeLayer",value:function(t){this.layers=this.layers.filter(function(e){return e!==t}),this.change(this.layers)}},{key:"change",value:function(){this.setVisible(this.checkVisible(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]))}},{key:"checkVisible",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return this.isVisible()&&!e.some(d)}}]),i})(e.default);function d(e){var t=void 0;return!(e.getVisible&&!e.getVisible()||e instanceof ol.layer.Vector)&&(e instanceof ol.layer.Tile||e instanceof ol.layer.Image?(t=e.getSource().getUrl())&&!(0,l.sameOrigin)(t,location):!!(e.getConfig().source||{}).external&&(t=e.getConfig().source.url)&&!(0,l.sameOrigin)(t,location))}},{"map/controls/interactioncontrol":158,"services/gui":188,"store/application":193,"utils/sameOrigin":252}],163:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.StreetViewControl=void 0;var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},o=function(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e};function i(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function s(e,t,a){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);return void 0!==n?"value"in n?n.value:void 0!==(n=n.get)?n.call(a):void 0:null!==(n=Object.getPrototypeOf(e))?s(n,t,a):void 0}var l=f(e("store/application")),u=f(e("services/gui")),c=e("utils/XHR"),d=f(e("map/controls/interactioncontrol")),p=f(e("map/interactions/pickcoordinatesinteraction"));function f(e){return e&&e.__esModule?e:{default:e}}var g="https://maps.googleapis.com/maps/api/",e=(e=>{var t=i;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);function i(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=this,n=i;if(a instanceof n)return(t=((e,t)=>{if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")})(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,r({},e,{offline:!1,visible:!0,name:"streetview",tipLabel:"StreetView",clickmap:!0,label:"",interactionClass:p.default,interactionClassOptions:{cursor:"ol-streetview"},cursorClass:"ol-streetview"})))).key=l.default.keys.vendorkeys.google,t.key&&c.XHR.get({url:g+"streetview",params:{location:0,size:"456x456",key:t.key}}).catch(function(e){t.keyError=e.responseText}),$script(g+"js?"+(t.key?"key="+t.key:"")),t._sv=null,t._panorama=null,t._map=null,t._projection=null,t._lastposition=null,t._streetViewFeature=new ol.Feature,t.active=!1,t._layer=new ol.layer.Vector({source:new ol.source.Vector({features:[]}),style:function(e){var e=e.getGeometry().getCoordinates(),t=(this._lastposition=this._lastposition||e,e[0]-this._lastposition[0]),a=e[1]-this._lastposition[1],a=-Math.atan2(a,t),t=[new ol.style.Style({text:new ol.style.Text({text:"",font:"bold 18px icomoon",fill:new ol.style.Fill({color:"#ffffff"})})}),new ol.style.Style({image:new ol.style.Icon({src:"/static/client/images/streetviewarrow.png",rotation:a})})];return this._lastposition=e,t}}),t.key&&u.default.on("closecontent",function(){t.isToggled()&&t._layer.getSource().clear()}),t;throw new TypeError("Cannot call a class as a function")}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e),o(i,[{key:"setProjection",value:function(e){this._projection=e}},{key:"setPosition",value:function(e){var t,a=this,n=this;this.active=!0,this._sv||(this._sv=new google.maps.StreetViewService),this._sv.getPanorama({location:e},function(e){n._panorama=new google.maps.StreetViewPanorama(document.getElementById("streetview"),{imageDateControl:!0}),n._panorama.addListener("position_changed",function(){var e;n.isToggled()&&(e=ol.proj.transform([this.getPosition().lng(),this.getPosition().lat()],"EPSG:4326",n._projection.getCode()),n._streetViewFeature.setGeometry(new ol.geom.Point(e)),(t=n._map.getPixelFromCoordinate(e))[0]+15>n._map.getSize()[0]||t[1]+15>n._map.getSize()[1]||t[0]<15||t[1]<15)&&n._map.getView().setCenter(e)}),e&&e.location&&(n._panorama.setPov({pitch:0,heading:0}),n._panorama.setPosition(e.location.latLng))}).then(function(e){void 0===e&&u.default.closeContent()}).catch(function(e){a.toggle()})}},{key:"setMap",value:function(e){var t=this;this._map=e,s(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"setMap",this).call(this,e),this.setProjection(this._map.getView().getProjection()),this._map.addLayer(this._layer),this._interaction.on("picked",function(e){e=e.coordinate;t.showStreetView(e),t._autountoggle&&t.toggle()})}},{key:"showStreetView",value:function(e){var t=ol.proj.transform(e,this._map.getView().getProjection().getCode(),"EPSG:4326"),t=n(t,2),a=t[0],t=t[1];this.key?(u.default.setContent({title:"StreetView",content:'<div id="streetview">'+(this.keyError?'<div\n          style = "display: flex;justify-content: center;align-items: center;font-weight: bold;height: 100%;padding: 10px;background-color: #FFF;"\n          class = "skin-color"\n        >'+this.keyError+"</div>":"")+"</div>"}),this.keyError||this.setPosition({lng:a,lat:t})):(this._streetViewFeature.setGeometry(new ol.geom.Point(e)),window.open("https://www.google.com/maps/@?api=1&map_action=pano&viewpoint="+t+","+a))}},{key:"clearMarker",value:function(){this._streetViewFeature.setGeometry(null)}},{key:"clear",value:function(){this._layer.getSource().clear(),this._streetViewFeature.setGeometry(null),this.clearMarker(),this._panorama=null,this.active&&u.default.closeContent(),this.active=!1}},{key:"toggle",value:function(e){s(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"toggle",this).call(this,e),this.isToggled()?this._layer.getSource().addFeatures([this._streetViewFeature]):this.clear()}}]),i})(d.default);a.StreetViewControl=e},{"map/controls/interactioncontrol":158,"map/interactions/pickcoordinatesinteraction":164,"services/gui":188,"store/application":193,"utils/XHR":196}],164:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r=function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e};function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,a){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);return void 0!==n?"value"in n?n.value:void 0!==(n=n.get)?n.call(a):void 0:null!==(n=Object.getPrototypeOf(e))?o(n,t,a):void 0}var s=(e=>{var t=n;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,a=n;if(t instanceof a)return(t=((e,t)=>{if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")})(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,i({handleDownEvent:function(e){var t=this;return this._centerMap=e.map.getView().getCenter(),setTimeout(function(){t._centerMap===e.map.getView().getCenter()&&t.handleUpEvent(e)},300),!1},handleUpEvent:function(e){return this.dispatchEvent({type:"picked",coordinate:e.coordinate}),!1},handleMoveEvent:function(e){return e.map.getViewport().classList.add(this._cursor),!0}},e))))._cursor=e.cursor||"ol-pointer",t._centerMap=null,t;throw new TypeError("Cannot call a class as a function")}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e),r(n,[{key:"shouldStopEvent",value:function(){return!1}},{key:"setActive",value:function(e){var t=this.getMap();t&&t.getViewport().classList.remove(this._cursor),o(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"setActive",this).call(this,e)}},{key:"setMap",value:function(e){e||this.getMap().getViewport().classList.remove(this._cursor),o(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"setMap",this).call(this,e)}}]),n})(ol.interaction.Pointer);a.default=s},{}],165:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r=function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e};function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,a){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);return void 0!==n?"value"in n?n.value:void 0!==(n=n.get)?n.call(a):void 0:null!==(n=Object.getPrototypeOf(e))?o(n,t,a):void 0}var s=(e=>{var t=n;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,a=n;if(t instanceof a)return t=((e,t)=>{if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")})(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,i({handleDownEvent:function(e){return this.pickedFeature_=this.featuresAtPixel_(e.pixel,e.map),this.pickedFeature_},handleUpEvent:function(e){return this.pickedFeature_&&this.dispatchEvent({type:"picked",feature:this.pickedFeature_,coordinate:e.coordinate,layer:this.pickedLayer_}),!0},handleMoveEvent:function(e){e.map.getTargetElement().style.cursor=this.featuresAtPixel_(e.pixel,e.map)?"pointer":""}},e))),a=e.features,t.features_=Array.isArray(a)&&0<a.length?a:null,t.layers_=e.layers||null,t.pickedFeature_=null,t.pickedLayer_=null,t;throw new TypeError("Cannot call a class as a function")}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e),r(n,[{key:"layerFilter_",value:function(e){var t=(this.layers_||[]).includes(e);return this.pickedLayer_=t&&e,t}},{key:"featuresAtPixel_",value:function(e,t){var a=this,n=null,t=t.forEachFeatureAtPixel(e,function(e){return!a.features_||a.features_.includes(e)?e:null},{layerFilter:this.layerFilter_.bind(this),hitTolerance:isMobile&&isMobile.any?10:0});return n=t?t:n}},{key:"shouldStopEvent",value:function(){return!1}},{key:"setMap",value:function(e){e||(this.getMap().getTargetElement().style.cursor=""),o(n.prototype.__proto__||Object.getPrototypeOf(n.prototype),"setMap",this).call(this,e)}}]),n})(ol.interaction.Pointer);a.default=s},{}],166:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.Feature=void 0;var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=function(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e};function i(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function o(e,t,a){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);return void 0!==n?"value"in n?n.value:void 0!==(n=n.get)?n.call(a):void 0:null!==(n=Object.getPrototypeOf(e))?o(n,t,a):void 0}var s=e("g3w-constants"),l=(s=s)&&s.__esModule?s:{default:s},u=e("utils/getUniqueDomId");a.Feature=(e=>{var t=i;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);function i(){var t,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=this,n=i;if(e instanceof n)return(t=((e,t)=>{if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")})(this,(i.__proto__||Object.getPrototypeOf(i)).call(this))).state={new:!1,state:null,visible:!0},t._uid=(0,u.getUniqueDomId)(),t._geometry=!1,a.feature&&a.properties&&Array.isArray(a.properties)?a.properties.forEach(function(e){return t.set(e,a.feature.get(e))}):a.feature&&t.setProperties(a.feature.getProperties()),a.feature&&(t.setId(a.feature.getId()),t.setGeometryName(a.feature.getGeometryName())),(e=a.feature&&a.feature.getGeometry())&&(t._geometry=!0,t.setGeometry(e)),(n=t.getStyle())&&t.setStyle(n),t;throw new TypeError("Cannot call a class as a function")}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e),r(i,[{key:"getUid",value:function(){return this._uid}},{key:"isGeometry",value:function(){return this._geometry}},{key:"cloneNew",value:function(e){var t=this.clone();return t._uid=(0,u.getUniqueDomId)(),t.setTemporaryId(),e&&!1===e.editable&&t.set(e.name,null),t}},{key:"clone",value:function(){var e=o(i.prototype.__proto__||Object.getPrototypeOf(i.prototype),"clone",this).call(this);return e.setId(this.getId()),this.isGeometry()&&e.setGeometry(e.getGeometry().clone()),(e=new i({feature:e}))._uid=this.getUid(),e.setState(this.getState()),this.isNew()&&e.setNew(),e}},{key:"setTemporaryId",value:function(){this.setId("_new_"+(0,u.getUniqueDomId)()),this.setNew()}},{key:"setNew",value:function(){this.state.new=!0}},{key:"delete",value:function(){return this.state.state="delete",this}},{key:"update",value:function(){return this.state.state="update",this}},{key:"add",value:function(){return this.state.state="add",this}},{key:"isNew",value:function(){return this.state.new}},{key:"isAdded",value:function(){return"add"===this.state.state}},{key:"isUpdated",value:function(){return"update"===this.state.state}},{key:"isDeleted",value:function(){return"delete"===this.state.state}},{key:"setState",value:function(e){this.state.state=e}},{key:"getState",value:function(){return this.state.state}},{key:"getAlphanumericProperties",value:function(){return Object.entries(this.getProperties()).filter(function(e){e=n(e,2),e=e[0];return!l.default.GEOMETRY_FIELDS.includes(e)}).reduce(function(e,t){t=n(t,2);return e[t[0]]=t[1],e},{})}},{key:"clearState",value:function(){this.state.state=null,this.state.new=!1}},{key:"isVisible",value:function(){return this.state.visible}},{key:"setVisible",value:function(){this.state.visible=!(0<arguments.length&&void 0!==arguments[0])||arguments[0]}}]),i})(ol.Feature)},{"g3w-constants":140,"utils/getUniqueDomId":232}],167:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.FeaturesStore=void 0;var i=function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e};function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r=e("g3w-object"),r=(r=r)&&r.__esModule?r:{default:r},o=e("utils/promisify"),s=e("utils/XHR");function l(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}var u=e("lodash.clonedeep");a.FeaturesStore=(e=>{var t=n;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,a=n;if(t instanceof a)return(t=((e,t)=>{if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")})(this,(n.__proto__||Object.getPrototypeOf(n)).call(this)))._features=e.features||[],t._provider=e.provider||null,t._loadedIds=[],t._lockIds=[],t.setters={addFeatures:function(){var t=this;(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(e){return t._addFeature(e)})},addFeature:function(e){this._addFeature(e)},removeFeature:function(e){this._removeFeature(e)},updateFeature:function(e){this._updateFeature(e)},clear:function(){this._clearFeatures()},getFeatures:function(){var t=this,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return(0,o.$promisify)(l(function*(){var e;return t._provider?(e=t._filterFeaturesResponse(yield t._provider.getFeatures(a)),t.addFeatures(e),e):t._features}))},commit:function(e,t){var a=this;return(0,o.$promisify)(l(function*(){return e&&a._provider?(e.lockids=a._lockIds,yield s.XHR.post({url:a._provider._layer.getUrl("commit"),data:JSON.stringify(e),contentType:"application/json"})):Promise.reject()}))},featuresLockedByOtherUser:function(){}},t;throw new TypeError("Cannot call a class as a function")}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e),i(n,[{key:"clone",value:function(){return u(this)}},{key:"setProvider",value:function(e){this._provider=e}},{key:"getProvider",value:function(){return this._provider}},{key:"unlock",value:function(){var e=this;return(0,o.$promisify)(l(function*(){return yield s.XHR.post({url:e._provider._layer.getUrl("unlock")})}))}},{key:"_filterFeaturesResponse",value:function(){var t,a,n=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=e.features,i=void 0===i?[]:i,e=e.featurelocks,r=void 0===e?[]:e;return 0===r.length?(0<i.length&&this.featuresLockedByOtherUser(i),[]):(t=this._lockIds.map(function(e){return e.featureid}),r.filter(function(e){e=e.featureid;return!t.includes(e)}).forEach(function(e){return n._lockIds.push(e)}),a=[],e=i.filter(function(e){var t=e.getId();return r.find(function(e){e=e.featureid;return t==e})?-1===n._loadedIds.indexOf(t)&&(n._loadedIds.push(t),!0):(a.push(e),!1)}),r.length<i.length&&this.featuresLockedByOtherUser(a),e)}},{key:"getLockIds",value:function(){return this._lockIds}},{key:"addLockIds",value:function(e){var t=this;this._lockIds=_.union(this._lockIds,e),this._lockIds.forEach(function(e){e=e.featureid;return t._loadedIds.push(e)})}},{key:"getFeatureById",value:function(t){return this._features.find(function(e){return t==e.getId()})}},{key:"getFeatureByUid",value:function(t){return this._features.find(function(e){return t===e.getUid()})}},{key:"_addFeature",value:function(e){this._features.push(e)}},{key:"_updateFeature",value:function(a){var n=this;this._features.find(function(e,t){if(a.getUid()===e.getUid())return n._features[t]=a,!0})}},{key:"setFeatures",value:function(){this._features=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]}},{key:"_removeFeature",value:function(t){this._features=this._features.filter(function(e){return t.getUid()!==e.getUid()})}},{key:"_clearFeatures",value:function(){this._features=null,this._features=[],this._lockIds=[],this._loadedIds=[]}},{key:"getDataProvider",value:function(){return this._provider}},{key:"readFeatures",value:function(){return this._features}}]),n})(r.default)},{"g3w-object":144,"lodash.clonedeep":"lodash.clonedeep","utils/XHR":196,"utils/promisify":247}],168:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},i=function(e,t,a){return t&&r(e.prototype,t),a&&r(e,a),e};function r(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=c(e("services/gui")),s=c(e("store/projections")),l=e("utils/getScaleFromResolution"),u=e("utils/XHR");function c(e){return e&&e.__esModule?e:{default:e}}a.default=function(e){var t=a;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);function a(){var e=this,t=a;if(!(e instanceof t))throw new TypeError("Cannot call a class as a function");e=this,t=(a.__proto__||Object.getPrototypeOf(a)).apply(this,arguments);if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e),i(a,[{key:"setup",value:function(){var r,o=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this.config&&(Object.assign(this.config,{map_crs:t.project.getProjection().getCode(),multilayerid:e.multilayer,projection:e.projection?e.projection.getCode()===e.crs.epsg?e.projection:s.default.get(e.crs):void 0,attributions:e.attributions||void 0}),this.legendCategories={},this.olSelectionFeatures={},Object.assign(this.state,{geolayer:"NoGeometry"!==e.geometrytype,legend:{url:null,loading:!1,error:!1,show:!0,change:!1},external:e.source&&e.source.external||!1,bbox:e.bbox||null,visible:e.visible||!1,checked:e.visible||!1,epsg:e.crs.epsg,hidden:e.hidden||!1,scalebasedvisibility:e.scalebasedvisibility||!1,minscale:e.minscale,maxscale:e.maxscale,ows_method:e.ows_method,exclude_from_legend:"boolean"!=typeof e.exclude_from_legend||e.exclude_from_legend,categories:!1,expanded:e.expanded,opacity:e.opacity||100}),e.source)&&e.source.url&&(r=new URL(this.config.source.url),["VERSION","REQUEST","BBOX","LAYERS","WIDTH","HEIGHT","DPI","FORMAT","CRS"].forEach(function(e){for(var t=[e.toUpperCase(),e.toLowerCase()],a=0;a<2;a++){var n=t[a],i=r.searchParams.get(n);if(i){o.config.source.url=o.config.source.url.replace(n+"="+i,"");break}}}))}},{key:"getLegendGraphic",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).all;return u.XHR.get({url:this.getLegendUrl((window.initConfig.layout||{legend:{}}).legend,{categories:!0,format:"application/json",all:void 0===e||e})})}},{key:"setCategories",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];this.legendCategories[this.getCurrentStyle().name]=e,this.state.categories=0<(e||[]).filter(function(e){return e.ruleKey}).length}},{key:"getCategories",value:function(){return this.legendCategories[this.getCurrentStyle().name]}},{key:"clearCategories",value:function(){this.legendCategories={},this.state.categories=!1}},{key:"clearOlSelectionFeatures",value:function(){this.olSelectionFeatures={}}},{key:"getOlSelectionFeature",value:function(e){return this.olSelectionFeatures[e]}},{key:"updateOlSelectionFeature",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.id,e=e.feature,t=this.getOlSelectionFeature(t);t&&(t.feature=e,o.default.getService("map").setSelectionFeatures("update",{feature:e}))}},{key:"deleteOlSelectionFeature",value:function(e){var t=this.getOlSelectionFeature(e);t&&(o.default.getService("map").setSelectionFeatures("remove",{feature:t.feature}),delete this.olSelectionFeatures[e])}},{key:"getOlSelectionFeatures",value:function(){return this.olSelectionFeatures}},{key:"addOlSelectionFeature",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.id,e=e.feature,a=new ol.Feature(e.geometry);return a.setId(t),Object.entries(e.attributes).forEach(function(e){var e=n(e,2),t=e[0];return a.set(t,e[1])}),this.olSelectionFeatures[t]=this.olSelectionFeatures[t]||{feature:a,added:!1,selected:!1},this.olSelectionFeatures[t]}},{key:"hideOlSelectionFeatures",value:function(){o.default.getService("map").toggleSelection(!1)}},{key:"updateMapOlSelectionFeatures",value:function(){Object.values(this.olSelectionFeatures).forEach(function(e){e.selected&&!e.added&&(o.default.getService("map").setSelectionFeatures("add",{feature:e.feature}),e.added=!0),!e.selected&&e.added&&(o.default.getService("map").setSelectionFeatures("remove",{feature:e.feature}),e.added=!1)}),o.default.getService("map").toggleSelection(Object.values(this.olSelectionFeatures).some(function(e){return e.selected}))}},{key:"setInversionOlSelectionFeatures",value:function(){Object.values(this.olSelectionFeatures).forEach(function(e){e.selected=!e.selected,!e.selected&&e.added&&(o.default.getService("map").setSelectionFeatures("remove",{feature:e.feature}),e.added=!1),e.selected&&!e.added&&(o.default.getService("map").setSelectionFeatures("add",{feature:e.feature}),e.added=!0)})}},{key:"setOlSelectionFeatureByFid",value:function(e,t){var a=this.getOlSelectionFeature(e);if(a&&a.feature)return a.selected="add"===t,this.setOlSelectionFeatures({id:e,feature:a.feature},t)}},{key:"setOlSelectionFeatures",value:function(e){var t,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"add";return e&&((t=this.getOlSelectionFeature(e.id)).feature.__layerId="add"!==a||t.added?void 0:this.getId(),this.updateMapOlSelectionFeatures()),e||Object.values(this.olSelectionFeatures).forEach(function(e){e.added&&o.default.getService("map").setSelectionFeatures("remove",{feature:e.feature}),e.added=!1,e.selected=!1}),void 0===Object.values(this.olSelectionFeatures).find(function(e){return e.added})}},{key:"isLayerCheckedAndAllParents",value:function(){var e=this.isChecked();if(e)for(var t=this.state.parentGroup;e&&t;)e=e&&t.checked,t=t.parentGroup;return e}},{key:"setChecked",value:function(e){this.state.checked=e}},{key:"isChecked",value:function(){return this.state.checked}},{key:"setVisible",value:function(e){var t=this.state.visible;return this.state.visible=e&&this.isChecked(),t!==this.state.visible&&this.change(),this.state.visible}},{key:"isVisible",value:function(){return this.state.visible}},{key:"isDisabled",value:function(){return this.state.disabled}},{key:"isPrintable",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).scale;return this.isLayerCheckedAndAllParents()&&(!this.state.scalebasedvisibility||e>=this.state.maxscale&&e<=this.state.minscale)}},{key:"getStyles",value:function(){return(this.config.source.external?this.config.source:this.config).styles}},{key:"getStyle",value:function(){return this.config.source.external?this.config.source.styles:this.config.styles?this.config.styles.find(function(e){return e.current}).name:""}},{key:"getOpacity",value:function(){return this.state.opacity}},{key:"setCurrentStyle",value:function(t){var e=!this.config.styles.find(function(e){return t===e.name}).current;return this.config.styles.forEach(function(e){return e.current=t===e.name}),e}},{key:"getCurrentStyle",value:function(){return this.config.styles.find(function(e){return e.current})}},{key:"setDisabled",value:function(e){if(this.state.scalebasedvisibility){for(var e=(0,l.getScaleFromResolution)(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:"m"),t=(this.state.disabled=!(e>=this.state.maxscale&&e<=this.state.minscale),this.state.disabled=0===this.state.minscale?!(e>=this.state.maxscale):this.state.disabled,!0),a=this.state.parentGroup;a;)t=t&&a.checked,a=a.parentGroup;t&&this.setVisible(!this.state.disabled),this.isFilterable()&&this.setTocHighlightable(!this.state.disabled)}else this.state.disabled=!1}},{key:"getMultiLayerId",value:function(){return this.config.multilayerid}},{key:"getGeometryType",value:function(){return this.config.geometrytype}},{key:"getOwsMethod",value:function(){return this.config.ows_method}},{key:"setProjection",value:function(){this.config.projection=s.default.get(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}},{key:"getProjection",value:function(){return this.config.projection}},{key:"getEpsg",value:function(){return this.config.crs.epsg}},{key:"getCrs",value:function(){return this.config.projection?this.config.projection.getCode():null}},{key:"getMapCrs",value:function(){return this.config.map_crs}},{key:"isCached",value:function(){return this.config.cache_url&&""!==this.config.cache_url}},{key:"getCacheUrl",value:function(){return this.isCached()&&this.config.cache_provider&&"mapproxy"===this.config.cache_provider?this.config.cache_url:this.isCached()?this.config.cache_url+"/{z}/{x}/{y}.png":void 0}},{key:"hasAxisInverted",value:function(){var e=this.getProjection();return"ne"===(e.getAxisOrientation?e.getAxisOrientation():"enu").substr(0,2)}},{key:"getMapLayer",value:function(){}},{key:"setMapProjection",value:function(e){this._mapProjection=e}},{key:"getMapProjection",value:function(){return this._mapProjection}}]),a}},{"services/gui":188,"store/projections":195,"utils/XHR":196,"utils/getScaleFromResolution":231}],169:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.RasterLayer=a.ImageLayer=void 0;function i(e,t,a){null===e&&(e=Function.prototype);var n=Object.getOwnPropertyDescriptor(e,t);return void 0!==n?"value"in n?n.value:void 0!==(n=n.get)?n.call(a):void 0:null!==(n=Object.getPrototypeOf(e))?i(n,t,a):void 0}var r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},T=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},n=function(e,t,a){return t&&o(e.prototype,t),a&&o(e,a),e};function o(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=e("g3w-constants"),l=f(e("g3w-object")),C=f(e("store/application")),u=f(e("store/projections")),c=f(e("map/layers/geo-mixin")),p=e("map/layers/layer"),d=e("map/layers/vectorlayer"),M=e("utils/get_legend_params");function f(e){return e&&e.__esModule?e:{default:e}}function g(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}function h(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function y(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function P(e,t){return t||0===t?""+e+t:null}m(_,l.default),n(_,[{key:"getId",value:function(){return this.id}},{key:"getOLLayer",value:function(e){return this._olLayer||(this._olLayer=this._makeOlLayer(e)),this._olLayer}},{key:"getSource",value:function(){return this.getOLLayer().getSource()}},{key:"getLayerConfigs",value:function(){return this.layers}},{key:"addLayer",value:function(t){this.allLayers.find(function(e){return t===e})||this.allLayers.push(t),this.layers.find(function(e){return t===e})||this.layers.push(t),"XYZ"===this.config.type&&(this.layer=t)}},{key:"removeLayer",value:function(t){this.layers=this.layers.filter(function(e){return t!==e})}},{key:"isVisible",value:function(){return 0<this.layers.filter(function(e){return e.isVisible()}).length}},{key:"_makeOlLayer",value:function(e){var t,a,n=this,i=void 0,r="image";return(i="ARCGISMAPSERVER"===this.config.type?new ol.layer.Tile({visible:!0,source:new ol.source.TileArcGISRest({url:this.config.url,projection:this.config.projection})}):"WMTS"===this.config.type?(r="tile",(a="mapproxy"===(t={url:"mapproxy"!==this.config.cache_provider&&this.layers[0]&&this.layers[0].getWmsUrl?this.layers[0].getWmsUrl():this.config.url,id:this.config.id,projection:this.config.projection,iframe_internal:this.iframe_internal,layers:e?this.layers.map(function(e){return e.getWMSLayerName()}):this.layers,cache_provider:this.config.cache_provider,cache_type:this.config.cache_type,cache_layer:this.config.cache_layer,cache_extent:this.config.cache_extent,cache_grid:this.config.cache_grid,cache_grid_extent:this.config.cache_grid_extent}).cache_provider&&ol.tilegrid.createXYZ({extent:t.cache_grid_extent}).getResolutions())?new ol.layer.Tile({source:new ol.source.WMTS({url:t.url,layer:t.cache_layer,matrixSet:t.cache_grid,format:t.cache_format||"png",projection:t.layers[0].getProjection(),tileGrid:new ol.tilegrid.WMTS({resolutions:a,origin:ol.extent.getTopLeft(t.cache_grid_extent),matrixIds:a.map(function(e,t){return t})}),style:t.style||"",transparent:!1})}):_._makeOlLayer({layerObj:t,extraParams:this.extraParams||{},tiled:!0})):"XYZ"===this.config.type?(a=this.config.url&&this.projection?this.projection:this.layer.getProjection(),new ol.layer.Tile({visible:!0,projection:a,source:new ol.source.XYZ({url:this.config.url,maxZoom:20,minZoom:void 0,projection:a,crossOrigin:void 0,tileLoadFunction:this.iframe_internal?function(t,e){var a;fetch("POST"===method?(e||"").split("?")[0]:e,{method:method,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:"POST"===method?e.split("?")[1]:void 0}).then((a=g(function*(e){return t.getImage().src=window.URL.createObjectURL(yield e.blob())}),function(e){return a.apply(this,arguments)})).catch(function(e){t.setState(ol.TileState.ERROR)})}:void 0,tileGrid:"degrees"===a.getUnits()||"mapproxy"===this.config.cache_provider?new ol.tilegrid.TileGrid({resolutions:ol.tilegrid.createXYZ({extent:a.getExtent(),maxZoom:20}).getResolutions().slice(1),extent:a.getExtent()}):void 0})})):_._makeOlLayer({layerObj:{url:this.layers[0]&&this.layers[0].getWmsUrl?this.layers[0].getWmsUrl():this.config.url,id:this.config.id,projection:this.config.projection,iframe_internal:this.iframe_internal,layers:e?this.layers.map(function(e){return e.getWMSLayerName()}):this.layers,format:this.config.format},extraParams:this.extraParams},this._method)).getSource().on(r+"loadstart",function(){return n.emit("loadstart")}),i.getSource().on(r+"loadend",function(){return n.emit("loadend")}),i.getSource().on(r+"loaderror",function(){return n.emit("loaderror")}),i}},{key:"update",value:function(){var t,a,n,i,r,o,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},s=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},l=s.force,s=((e,t)=>{var a,n={};for(a in e)0<=t.indexOf(a)||Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a]);return n})(s,["force"]);l||(t=e.resolution,a=e.mapUnits,this.allLayers.forEach(function(e){return e.setDisabled(t,a),e.isDisabled()})),"XYZ"===this.config.type?this._olLayer.setVisible(this.layer.isVisible()):(l=this.layers.filter(function(e){return e.isVisible()})||[]).length<=0?this._olLayer.setVisible(!1):(n=[],i=[],o=r=void 0,l.forEach(function(e){var t=(0,M.get_legend_params)(e),a=t.LEGEND_ON,t=t.LEGEND_OFF;n.push(e.getStyle()),i.push(parseInt(e.getOpacity()/100*255)),a&&(r=void 0===r?a:r+";"+a),t&&(o=void 0===o?t:o+";"+t)}),this._olLayer.setVisible(!0),this._olLayer.getSource().updateParams&&this._olLayer.getSource().updateParams(T({},s,{LEGEND_ON:r,LEGEND_OFF:o,filtertoken:C.default.tokens.filtertoken,LAYERS:(l[0].isArcgisMapserver()?"show:":"")+l.map(function(e){return e.getWMSLayerName()}).join(","),STYLES:n.join(","),OPACITIES:i.join(",")})))}},{key:"setupCustomMapParamsToLegendUrl",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};"XYZ"!==this.config.type&&[].concat(this.layer||this.layers).forEach(function(e){return e.setMapParamstoLegendUrl(t)})}}]);var v=_;function _(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"GET",i=(h(this,_),y(this,(_.__proto__||Object.getPrototypeOf(_)).call(this)));return i.config=e,i.id=e.id,i.iframe_internal=e.iframe_internal||!1,i.extent=e.extent,i.projection=e.projection,i.layer=null,i.layers=e.layers||[],i.allLayers=[],i.showSpinnerWhenLoading=!0,"XYZ"!==i.config.type&&(i.LAYERTYPE={LAYER:"layer",MULTILAYER:"multilayer"},i.getInfoFormat=function(){return"application/vnd.ogc.gml"},i.getGetFeatureInfoUrl=function(e,t,a,n){return i.getOLLayer().getSource().getGetFeatureInfoUrl(e,t,a,n)},i.getQueryUrl=function(){return i.layers[0].infourl&&""!==i.layers[0].infourl?i.layers[0].infourl:i.config.url}),i.extraParams=t,i._method=a,i}v._makeOlLayer=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"GET";return new(e.tiled?ol.layer.Tile:ol.layer.Image)({id:e.layerObj.id,name:e.layerObj.name,opacity:void 0!==e.layerObj.opacity?e.layerObj.opacity:1,visible:e.layerObj.visible,extent:e.layerObj.extent,maxResolution:e.layerObj.maxResolution,source:new(e.tiled?ol.source.TileWMS:ol.source.ImageWMS)({ratio:1,url:e.layerObj.url,projection:e.layerObj.projection?e.layerObj.projection.getCode():null,params:T({},Object.fromEntries(Object.entries({DPI:s.DOTS_PER_INCH,TRANSPARENT:!0,FORMAT:e.layerObj.format,LAYERS:void 0!==e.layerObj.layers?e.layerObj.layers:"",VERSION:void 0!==e.layerObj.version?e.layerObj.version:"1.3.0",SLD_VERSION:void 0!==e.layerObj.sld_version?e.layerObj.sld_version:"1.1.0"}).filter(function(e){e=r(e,2);return"FORMAT"!==e[0]||void 0!==e[1]})),e.extraParams||{}),imageLoadFunction:e.layerObj.iframe_internal||"POST"===n?function(t,e){var a;fetch("POST"===n?(e||"").split("?")[0]:e,{method:n,headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:"POST"===n?e.split("?")[1]:void 0}).then((a=g(function*(e){return t.getImage().src=window.URL.createObjectURL(yield e.blob())}),function(e){return a.apply(this,arguments)})).catch(function(e){t.setState(ol.TileState.ERROR)})}:void 0})})};m(w,(0,c.default)(p.Layer)),n(w,[{key:"getLayerForEditing",value:(b=g(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.force,a=e.vectorurl,n=e.project_type,e=e.project;if(!(void 0!==t&&t)&&!this.isEditable())return null;try{var i=yield new d.VectorLayer(this.config,{vectorurl:a,project_type:n,project:e||C.default.project}).layerForEditing;return this.setEditingLayer(i),i}catch(e){return Promise.reject(e)}}),function(){return b.apply(this,arguments)})},{key:"isBaseLayer",value:function(){return this.config.baselayer}},{key:"isWMS",value:function(){return w.WMSServerTypes.includes(this.config.servertype)}},{key:"isLayerProjectionASMapProjection",value:function(){return this.config.crs.epsg===this.config.map_crs}},{key:"getCrs",value:function(){return this.config.crs.epsg}},{key:"isExternalWMS",value:function(){return!!(this.config.source&&this.config.source.external&&this.config.source.url)}},{key:"isArcgisMapserver",value:function(){return this.isExternalWMS()&&p.Layer.SourceTypes.ARCGISMAPSERVER===this.config.source.type}},{key:"_getBaseLayerName",value:function(){return this.isWmsUseLayerIds()?this.getId():this.getName()}},{key:"_hasExternalWMSOrLegend",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"map",t=this.config.source;return t&&("map"!==e||this.isExternalWMS()&&this.isLayerProjectionASMapProjection())&&("legend"===e||t.external)}},{key:"getWMSLayerName",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).type,t=(this.config||{source:{}}).source,t=t.layers||t.layer;return t&&this._hasExternalWMSOrLegend(void 0===e?"map":e)?t:this._getBaseLayerName()}},{key:"getWmsUrl",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).type,t=(this.config||{source:{}}).source;return t.url&&this._hasExternalWMSOrLegend(void 0===e?"map":e)&&["wms","wmst"].includes(t.type)?t.url:this.config.wmsUrl}},{key:"getWFSLayerName",value:function(){return(this.config.infolayer&&""!==this.config.infolayer?this.config.infolayer:this.getName()).replace(/\s/g,"_").replaceAll(":","-")}},{key:"useProxy",value:function(){return this.isExternalWMS()&&this.isLayerProjectionASMapProjection()&&this.getInfoFormats()}},{key:"getWMSInfoLayerName",value:function(){return this.useProxy()?this.getSource().layers:this._getBaseLayerName()}},{key:"getPrintLayerName",value:function(){return this.isWmsUseLayerIds()?this.getId():this.getName()}},{key:"getStringBBox",value:function(){var e=this.config.bbox;return e.minx+","+e.miny+","+e.maxx+","+e.maxy}},{key:"isWfsActive",value:function(){return Array.isArray(this.config.ows)&&this.config.ows.some(function(e){return"WFS"===e})}},{key:"getFullWmsUrl",value:function(){var e=C.default.project.state.metadata.wms_url;return e&&!this.isExternalWMS()?e:this.getWmsUrl()}},{key:"getCatalogWmsUrl",value:function(){var e=C.default.project.state.metadata.wms_url;return e&&!this.isExternalWMS()?e:this.getWmsUrl()+"?service=WMS&version=1.3.0&request=GetCapabilities"}},{key:"getCatalogWfsUrl",value:function(){return this.getWfsUrl()+"?service=WFS&version=1.1.0&request=GetCapabilities"}},{key:"getCatalogWfs3Url",value:function(){return this.getWfsUrl()+"wfs3/"}},{key:"getWfsUrl",value:function(){var e=C.default.project.state.metadata.wms_url;return e||this.config.wmsUrl}},{key:"getQueryUrl",value:function(){var e=i(w.prototype.__proto__||Object.getPrototypeOf(w.prototype),"getQueryUrl",this).call(this),t=p.Layer.ServerTypes.QGIS===this.getServerType()&&this.isExternalWMS()&&this.isLayerProjectionASMapProjection();return t&&this.getInfoFormats()?this.getSource().url:t?e+"SOURCE="+this.config.source.type:e}},{key:"getIconUrlFromLegend",value:function(){return this.getLegendUrl({layertitle:!1})}},{key:"getLegendUrl",value:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{categories:!1,all:!1,format:"image/png"},n=void 0,i=void 0,t=T({},t,this.customParams),r=t.width,o=t.height,s=t.color,s=void 0===s?"white":s,l=t.fontsize,l=void 0===l?10:l,u=t.transparent,u=void 0===u||u,c=t.boxspace,d=t.layerspace,p=t.layertitle,p=void 0===p||p,f=t.layertitlespace,g=t.symbolspace,h=t.iconlabelspace,y=t.symbolwidth,m=t.symbolheight,v=t.itemfontfamily,_=t.layerfontfamily,b=t.layerfontbold,w=t.itemfontbold,x=t.layerfontitalic,k=t.itemfontitalic,S=t.rulelabel,E=t.crs,L=t.bbox,t=t.sld_version,t=void 0===t?"1.1.0":t;return i=(i=this.isArcgisMapserver()?(n=this.getConfig().source.url.replace("/rest/","/")+"/WMSServer",["request=GetLegendGraphic","version=1.3.0","format=image/png","LAYER="+this.getConfig().source.layer]):(e=a.categories&&(["image/png",void 0].includes(a.format)||C.default.project.state.context_base_legend)?(0,M.get_legend_params)(this):void 0,n=this.getWmsUrl({type:"legend"}),["SERVICE=WMS","VERSION=1.3.0","REQUEST=GetLegendGraphic",P("SLD_VERSION=",t),P("WIDTH=",r),P("HEIGHT=",o),P("FORMAT=",void 0===a.format?"image/png":a.format),P("TRANSPARENT=",u),P("ITEMFONTCOLOR=",s),P("LAYERFONTCOLOR=",s),P("LAYERTITLE=",p),P("ITEMFONTSIZE=",l),P("CRS=",E),P("BBOX=",[!1,void 0].includes(a.all)&&L&&L.join(",")),P("BOXSPACE=",c),P("LAYERSPACE=",d),P("LAYERTITLESPACE=",f),P("SYMBOLSPACE=",g),P("ICONLABELSPACE=",h),P("SYMBOLWIDTH=",a.categories&&"application/json"===a.format?16:y),P("SYMBOLHEIGHT=",a.categories&&"application/json"===a.format?16:m),P("LAYERFONTFAMILY=",_),P("ITEMFONTFAMILY=",v),P("LAYERFONTBOLD=",b),P("ITEMFONTBOLD=",w),P("LAYERFONTITALIC=",x),P("ITEMFONTITALIC=",k),P("RULELABEL=",S),P("LEGEND_ON=",e&&e.LEGEND_ON),P("LEGEND_OFF=",e&&e.LEGEND_OFF),P("STYLES=",a.categories&&"application/json"===a.format?encodeURIComponent(this.getCurrentStyle().name):void 0),P("LAYER=",this.getWMSLayerName({type:"legend"}))])).filter(function(e){return e}),this.legendUrl=""+n+(-1<n.indexOf("?")?"&":"?")+i.join("&"),this.legendUrl}},{key:"setMapParamstoLegendUrl",value:function(e){var t=e.bbox;this.customParams=T({},this.customParams,{bbox:t,crs:e.crs})}},{key:"getWfsCapabilities",value:function(){return this.config.wfscapabilities||1===this.config.capabilities}},{key:"getMapLayer",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1];if(this._mapLayer)return this._mapLayer;e.iframe_internal=C.default.iframe&&!this.isExternalWMS();var a=this.isExternalWMS()?"GET":this.getOwsMethod(),n=this.config.bbox?[this.config.bbox.minx,this.config.bbox.miny,this.config.bbox.maxx,this.config.bbox.maxy]:null,i=this.config.source,r=this.config.cache_provider,o=this.config.cache_service_type||"tms",s=this.config.cache_layer,l=this.config.cache_extent,u=this.config.cache_grid,c=this.config.cache_grid_extent,d=this.isCached()?this.getCacheUrl():e.url||this.getWmsUrl();return this.isCached()&&"tms"===o?new v(T({},e,{extent:n,url:d,cache_provider:r,type:"XYZ"}),{},a):this.isExternalWMS()&&i&&p.Layer.SourceTypes.ARCGISMAPSERVER===i.type?new v(T({},e,i),t):this.isCached()&&"wmts"===o?new v(T({},e,{url:d,cache_provider:r,cache_layer:s,cache_extent:l,cache_grid:u,cache_grid_extent:c,type:"WMTS"}),t,a):this.isExternalWMS()&&i&&p.Layer.SourceTypes.WMST===i.type?new v(T({},e,{url:d,cache_provider:r,type:"WMTS"}),t,a):new v(T({},e,{url:d}),t,a)}},{key:"getFormat",value:function(){return this.isExternalWMS()&&this.getSource()?this.getSource().format:i(w.prototype.__proto__||Object.getPrototypeOf(w.prototype),"getFormat",this).call(this)}},{key:"getOwsMethod",value:function(){return this.isExternalWMS()||!/^\/ows/.test(new URL(this.getQueryUrl(),window.initConfig.baseurl).pathname)?"GET":this.config.ows_method}},{key:"update",value:function(e,t){this.isWMS()&&this._mapLayer.update(e,t)}},{key:"setVisible",value:function(e){return this._mapLayer&&this.getOLLayer().setVisible(e),i(w.prototype.__proto__||Object.getPrototypeOf(w.prototype),"setVisible",this).call(this,e)}},{key:"getSource",value:function(){return this._mapLayer?this.getOLLayer().getSource():i(w.prototype.__proto__||Object.getPrototypeOf(w.prototype),"getSource",this).call(this)}},{key:"getProjectionFromCrs",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return e.epsg=e.epsg||"EPSG:3857",u.default.get(e)}},{key:"getOLLayer",value:function(){var e=this;return!this._olLayer&&this._makeOlLayer&&(this._olLayer=this._makeOlLayer(),this._olLayer.getSource().on("imageloadstart",function(){return e.emit("loadstart")}),this._olLayer.getSource().on("imageloadend",function(){return e.emit("loadend")}),this._mapLayer.config.attributions&&this._olLayer.getSource().setAttributions(this._mapLayer.config.attributions),this._olLayer.setVisible(this._mapLayer.state.visible)),this._olLayer}}]);var b,e=w;function w(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},d=(h(this,w),y(this,(w.__proto__||Object.getPrototypeOf(w)).call(this,e,t)));return d._BASE_LAYER=t._BASE_LAYER,d.setters={change:function(){}},d.config.baselayer=e.baselayer||!1,d.type=p.Layer.LayerTypes.IMAGE,d.legendUrl=null,d.customParams={},d.setup(e,t),"OSM"===d._BASE_LAYER&&(d._makeOlLayer=function(){return new ol.layer.Tile({source:new ol.source.OSM({url:d.config.url}),id:d.config.name||"osm",title:d.config.title||"OSM",basemap:!0})}),"Bing"===d._BASE_LAYER&&(d._makeOlLayer=function(){var e={streets:"Road",aerial:"Aerial",aerialwithlabels:"AerialWithLabels"}[d.config.source&&d.config.source.subtype]||"Aerial";return new ol.layer.Tile({name:e,visible:!1,preload:1/0,source:new ol.source.BingMaps({imagerySet:e,key:C.default.keys.vendorkeys.bing}),basemap:!0})}),"TMS"===d._BASE_LAYER&&(d._makeOlLayer=function(){var e=void 0!==d.config.url?d.config.url:null,t=e&&d.getProjectionFromCrs(d.config.crs);if(e)return new ol.layer.Tile({visible:!1,projection:t,source:new ol.source.XYZ({url:e,maxZoom:d.config.maxZoom,minZoom:d.config.minZoom,projection:t,crossOrigin:"anonymous",tileGrid:"degrees"===t.getUnits()?new ol.tilegrid.TileGrid({resolutions:ol.tilegrid.createXYZ({extent:t.getExtent(),maxZoom:d.config.maxZoom}).getResolutions().slice(1),extent:t.getExtent()}):void 0})})}),"TMS"===d._BASE_LAYER&&(d._makeOlLayer=function(){return new ol.layer.Tile({visible:!1,source:new ol.source.TileArcGISRest({url:void 0===d.config.url?null:d.config.url,projection:d.getProjectionFromCrs(d.config.crs),attributions:d.config.attributions})})}),"WMTS"===d._BASE_LAYER&&(d._makeOlLayer=function(){var a,e=d.config,t=e.url,n=e.layer,i=e.attributions,r=e.matrixSet,o=e.format,o=void 0===o?"image/png":o,s=e.style,s=void 0===s?"default":s,l=e.requestEncoding,u=e.grid,e=e.grid_extent,c=d.config.projection||d.getProjectionFromCrs(d.config.crs);return r?(a=ol.extent.getWidth(c.getExtent())/256,new ol.layer.Tile({opacity:.7,source:new ol.source.WMTS({url:t,projection:c,layer:n,matrixSet:r,requestEncoding:l,format:o,attributions:i,tileGrid:new ol.tilegrid.WMTS({origin:ol.extent.getTopLeft(c.getExtent()),resolutions:Array.from({length:14},function(e,t){return a/Math.pow(2,t)}),matrixIds:Array.from({length:14},function(e,t){return t})}),style:s})})):u&&e?(r=ol.tilegrid.createXYZ({extent:e}).getResolutions(),new ol.layer.Tile({source:new ol.source.WMTS({url:t,layer:n,projection:c,matrixSet:u,format:o||"png",tileGrid:new ol.tilegrid.WMTS({origin:ol.extent.getTopLeft(e),resolutions:r,matrixIds:r.map(function(e,t){return t})}),style:s,transparent:!1})})):void 0}),"WMS"===d._BASE_LAYER&&(d._makeOlLayer=function(){return v._makeOlLayer({layerObj:{url:d.config.url,projection:d.getProjectionFromCrs(d.config.crs),attributions:d.config.attributions,layers:d.config.layers,tiled:void 0!==d.config.singleTile&&d.config.singleTile,opacity:void 0===d.config.opacity?1:d.config.opacity}})}),"ARCGISMAPSERVER"===d._BASE_LAYER&&(d._makeOlLayer=function(){var e=d.config,t=e.url,a=e.visible;return new ol.layer.Tile({extent:e.extent,visible:void 0===a||a,source:new ol.source.TileArcGISRest({url:t,projection:e.projection,attributions:e.attributions,crossOrigin:e.crossOrigin})})}),d._makeOlLayer&&d.isWMS()?(d._mapLayer=new v({url:d.getWmsUrl(),id:d.state.id,tiled:d.state.tiled}),d._mapLayer.addLayer(d)):d._makeOlLayer&&(d._mapLayer=d),d}e.WMSServerTypes=[p.Layer.ServerTypes.QGIS,p.Layer.ServerTypes.Mapserver,p.Layer.ServerTypes.Geoserver,p.Layer.ServerTypes.OGC],a.ImageLayer=e,a.RasterLayer=v},{"g3w-constants":140,"g3w-object":144,"map/layers/geo-mixin":168,"map/layers/layer":170,"map/layers/vectorlayer":173,"store/application":193,"store/projections":195,"utils/get_legend_params":233}],170:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.Layer=void 0;var v=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},_=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},b=function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e};function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var w=e("g3w-constants"),x=i(e("store/application")),k=i(e("services/data")),S=i(e("services/gui")),E=i(e("g3w-object")),L=e("utils/parseAttributes"),T=e("utils/promisify"),C=e("utils/downloadFile"),M=e("utils/XHR"),P=e("utils/prompt"),O=i(e("components/Table.vue")),I=e("utils/parsers"),g=e("utils/get_legend_params"),o=e("utils/createRelationsUrl"),s=e("map/layers/feature");function i(e){return e&&e.__esModule?e:{default:e}}function F(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}function j(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e){return void 0!==e}function h(e,t){return void 0!==e?e:t}var R=e("g3w-i18n").t;function A(e,t){var a=new r[e];return Object.assign(a,{_name:e,_layer:t,getLayer:function(){return a._layer},setLayer:function(e){return a._layer=e},getFeatures:a.getFeatures||function(){},query:a.query||function(){},getName:function(){return a._name}})}var r={geojson:(b(p,[{key:"query",value:function(){return(0,T.$promisify)(Promise.resolve([]))}},{key:"getFeatures",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return(0,T.$promisify)(F(function*(){return(new ol.format.GeoJSON).readFeatures(t.data||(yield M.XHR.get({url:t.url||e._layer.get("source").url})).results,{featureProjection:t.mapProjection,dataProjection:t.projection||"EPSG:4326"})}))}}]),p),qgis:(b(d,[{key:"query",value:function(){var n=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this._projections=this._projections||{map:null,layer:null},(0,T.$promisify)(F(function*(){var e,t="table"===n._layer.getType(),a=(t||(n._projections.map=n._layer.getMapProjection()||n._projections.layer),i.layers?i.layers.map(function(e){return e.getWMSLayerName()}).join(","):n._layer.getWMSLayerName());return i.filter?("geometry"!==(e=[].concat(i.filter).map(function(e){return{type:e._type||e.type,value:e._filter||e.value}}))[0].type&&(n._projections.layer=null),e=e.filter(function(e){return e.value}),a=yield M.XHR.get({url:i.queryUrl||n._layer.getUrl("query"),params:{SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetFeatureInfo",filtertoken:x.default.tokens.filtertoken,LAYERS:a,QUERY_LAYERS:a,INFO_FORMAT:n._layer.getInfoFormat()||"application/vnd.ogc.gml",FEATURE_COUNT:i.feature_count||10,CRS:t?x.default.map.epsg:n._projections.map.getCode(),I:i.I,J:i.J,FILTER:e.length?e.map(function(e){return e.value}).join(";"):void 0,WITH_GEOMETRY:!t}}),e=void 0===i.layers?[n._layer]:i.layers,i.raw?a:I.ResponseParser.get(e[0].getInfoFormat())({response:a,projections:n._projections,layers:e,wms:!0})):Promise.reject()}))}},{key:"getConfig",value:function(){return(0,T.$promisify)(M.XHR.get({url:this._layer.getUrl("config")}))}},{key:"getFeatures",value:function(){var n=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return Object.entries(r).forEach(function(e){var e=_(e,2),t=e[0];[null,void 0].includes(e[1])&&delete r[t]}),(0,T.$promisify)(F(function*(){var e;if(r=((r=new URLSearchParams(r||{}).toString())?"?":"")+r,!i.editing)return{data:(e=(yield M.XHR.get({url:n._layer.getUrl("data")+r})).vector).data,count:e.count};try{var t,a=void 0;return i.filter?l(i.filter.bbox)?a=yield M.XHR.post({url:n._layer.getUrl("editing")+r,data:JSON.stringify({in_bbox:i.filter.bbox.join(","),filtertoken:x.default.tokens.filtertoken}),contentType:"application/json"}):l(i.filter.fid)?a=yield M.XHR.get({url:(0,o.createRelationsUrl)(i.filter.fid)}):i.filter.field?a=yield M.XHR.post({url:n._layer.getUrl("editing")+r,data:JSON.stringify(i.filter),contentType:"application/json"}):l(i.filter.fids)?a=yield M.XHR.get({url:n._layer.getUrl("editing")+r,params:i.filter}):l(i.filter.nofeatures)&&(a=yield M.XHR.post({url:n._layer.getUrl("editing")+r,data:JSON.stringify({field:(i.filter.nofeatures_field||"id")+"|eq|__G3W__NO_FEATURES__"}),contentType:"application/json"})):a=yield M.XHR.post({url:n._layer.getUrl("editing")+r,contentType:"application/json"}),a.result?(t=a.featurelocks.map(function(e){return e.featureid}),{count:a.vector.count,featurelocks:a.featurelocks,features:I.ResponseParser.get("g3w-"+n._layer.getType()+"/json")(a.vector.data,"NoGeometry"===a.vector.geometrytype?{}:{crs:n._layer.getCrs()}).filter(function(e){return t.includes(""+e.getId())}).map(function(e){return new s.Feature({feature:e})})}):void 0}catch(e){}return Promise.reject({message:R("info.server_error")})}))}}]),d),wms:(b(c,[{key:"query",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layers,a=void 0===t?[this._layer]:t,t=e.size,t=void 0===t?[101,101]:t,n=e.coordinates,i=void 0===n?[]:n,r=e.resolution,n=r*t[0]/2,o=r*t[1]/2,n=[i[0]-n,i[1]-o,i[0]+n,i[1]+o],s=this._layer.getMapProjection()||this._layer.getProjection(),o=h(e.query_point_tolerance,w.QUERY_POINT_TOLERANCE),l=a[0].getQueryUrl(),u=a[0].getOwsMethod(),c=a[0].useProxy(),d=(l||"").split("SOURCE"),p={SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetFeatureInfo",CRS:s.getCode(),LAYERS:(a||[this._layer.getWMSInfoLayerName()]).map(function(e){return e.getWMSInfoLayerName()}).join(","),QUERY_LAYERS:(a||[this._layer.getWMSInfoLayerName()]).map(function(e){return e.getWMSInfoLayerName()}).join(","),filtertoken:x.default.tokens.filtertoken,INFO_FORMAT:this._layer.getInfoFormat()||"application/vnd.ogc.gml",FEATURE_COUNT:h(e.feature_count,10),WITH_GEOMETRY:!0,DPI:w.DOTS_PER_INCH,FILTER_GEOM:"map"===o.unit?(new ol.format.WKT).writeGeometry(ol.geom.Polygon.fromCircle(new ol.geom.Circle(i,o.value))):void 0,FI_POINT_TOLERANCE:"map"===o.unit?void 0:o.value,FI_LINE_TOLERANCE:"map"===o.unit?void 0:o.value,FI_POLYGON_TOLERANCE:"map"===o.unit?void 0:o.value,G3W_TOLERANCE:"map"===o.unit?void 0:o.value*r,I:"map"===o.unit?void 0:Math.floor((i[0]-n[0])/r),J:"map"===o.unit?void 0:Math.floor((n[3]-i[1])/r),WIDTH:t[0],HEIGHT:t[1],STYLES:"",BBOX:("ne"===s.getAxisOrientation().substr(0,2)?[n[1],n[0],n[3],n[2]]:n).join(","),LEGEND_ON:a.flatMap(function(e){return(0,g.get_legend_params)(e).LEGEND_ON}).filter(Boolean).join(";")||void 0,LEGEND_OFF:a.flatMap(function(e){return(0,g.get_legend_params)(e).LEGEND_OFF}).filter(Boolean).join(";")||void 0,SOURCE:!c&&"GET"===u&&1<d.length?d[1]:void 0},f=void 0;return(0,T.$promisify)(Promise.race([new Promise(function(e){f=setTimeout(function(){e({data:(a||[]).map(function(e){return{layer:e,rawdata:"timeout"}}),query:{coordinates:i,resolution:r}})},w.TIMEOUT)}),F(function*(){try{var e,t=void 0;return c?t=yield a[0].getDataProxyFromServer("wms",{url:l,params:p,method:u,headers:{"Content-Type":p.INFO_FORMAT}}):"GET"===u?(e=(d.length?d[0]:l).replace(/[?&]$/,""),t=yield M.XHR.get({url:e+(-1===e.indexOf("?")?"?":"&")+Object.keys(p).filter(function(e){return![void 0,null].includes(p[e])}).map(function(e){return e+"="+encodeURIComponent(p[e])}).join("&")})):"POST"===u&&(t=yield M.XHR.post({url:l,data:p})),{data:I.ResponseParser.get(a[0].getInfoFormat())({response:t,layers:a,wms:!0,projections:{map:s,layer:null}}),query:{coordinates:i,resolution:r}}}finally{c||clearTimeout(f)}})()]))}}]),c),wfs:(b(u,[{key:"query",value:function(){var a=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=n.filter||{},o=n.layers||[this._layer],s=(o[0].getQueryUrl()+"/").replace(/\/+$/,"/"),l=o[0].getOwsMethod(),u=(Object.assign(r,{config:r.config||{},type:r._type||r.type,value:r._filter||r.value}),i=Object.assign(i,{SERVICE:"WFS",VERSION:"1.1.0",REQUEST:"GetFeature",MAXFEATURES:h(n.feature_count,10),TYPENAME:o.map(function(e){return e.getWFSLayerName()}).join(","),OUTPUTFORMAT:o[0].getInfoFormat(),SRSNAME:(n.reproject?o[0].getProjection():this._layer.getMapProjection()).getCode(),FILTER:"all"!==r.type?("("+(new ol.format.WFS).writeGetFeature({featureTypes:[o[0]],filter:{bbox:ol.format.filter.bbox("the_geom",r.value),geometry:ol.format.filter[r.config.spatialMethod||"intersects"]("the_geom",r.value),expression:null}[r.type]}).children[0].innerHTML+")").repeat(o.length||1):void 0}),void 0);return(0,T.$promisify)(Promise.race([new Promise(function(e){u=setTimeout(function(){e({data:(o||[]).map(function(e){return{layer:e,rawdata:"timeout"}}),query:{}})},w.TIMEOUT)}),F(function*(){try{var e=void 0,t=("GET"!==l||["all","geometry"].includes(r.type)||(e=yield M.XHR.get({url:s+"?"+new URLSearchParams(i||{}).toString()})),"POST"!==l&&!["all","geometry"].includes(r.type)||(e=yield M.XHR.post({url:s,data:i})),I.ResponseParser.get(o[0].getInfoFormat())({response:e,projections:{map:a._layer.getMapProjection(),layer:n.reproject?a._layer.getProjection():null},layers:o,wms:!1}));return t.flatMap(function(e){return e.features||[]}).forEach(function(e){return Object.entries(e.getProperties()).forEach(function(e){var e=_(e,2),t=e[0],e=e[1];return e&&e["xsi:nil"]&&feature.set(t,"NULL")})}),{data:t}}finally{clearTimeout(u)}})()]))}}]),u)};function u(){j(this,u)}function c(){j(this,c)}function d(){j(this,d)}function p(){j(this,p)}var N={download:{format:"shapefile",url:"shp"},download_gpkg:{format:"gpkg",url:"gpkg"},download_gpx:{format:"gpx",url:"gpx"},download_csv:{format:"csv",url:"csv"},download_xls:{format:"xls",url:"xls"},download_raster:{format:"geotiff",url:"geotiff"},download_pdf:{format:"pdf",url:"pdf"}},e=(e=>{var t,a,n,i,r,o,s,l,u,c,d,p,f,g,h,y=m;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);function m(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=(j(this,m),((e,t)=>{if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")})(this,(m.__proto__||Object.getPrototypeOf(m)).call(this))),t=t.project||x.default.project,n=e.baselayer?"":t.getType()+"/"+t.getId()+"/"+e.id+"/",i=e.baselayer?"":t.state.vectorurl,r=e.baselayer?"":t.state.rasterurl,r=(a.config=Object.assign(e,v({id:e.id||"Layer",title:e.title||e.name,download:!!e.download,geolayer:!1,baselayer:!!e.baselayer,fields:e.fields||{},urls:v({query:e.infourl||e.wmsUrl},e.urls||{},e.baselayer?{}:{filtertoken:i+"filtertoken/"+n,data:i+"data/"+n,shp:i+"shp/"+n,csv:i+"csv/"+n,xls:i+"xls/"+n,gpx:i+"gpx/"+n,gpkg:i+"gpkg/"+n,geotiff:r+"geotiff/"+n,editing:i+"editing/"+n,commit:i+"commit/"+n,config:i+"config/"+n,unlock:i+"unlock/"+n,widget:{unique:i+"widget/unique/data/"+n},featurecount:t.getUrl("featurecount"),pdf:"/html2pdf/"})},e.baselayer?{}:{searchParams:{I:0,J:0}},{search_endpoint:"api"})),t.getRelations().filter(function(e){return[e.referencedLayer,e.referencingLayer].includes(a.getId())})),i=(a._relations={_relations:(r||[]).reduce(function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=Date.now(),n={loading:!1,id:t.id||"id_"+a,name:t.name||"name_"+a,origname:t.origname||"origname_"+a,father:t.referencedLayer,child:t.referencingLayer,type:t.type,editable:t.editable||!1,prefix:t.prefix,fatherField:[].concat(t.fieldRef.referencedField),childField:[].concat(t.fieldRef.referencingField)};return e[n.id]=Object.assign(new E.default(t),{state:n,getId:function(){return n.id},setId:function(e){return n.id=e},getName:function(){return n.name},setName:function(e){return n.name=e},getChild:function(){return n.child},getFather:function(){return n.father},getState:function(){return n},getType:function(){return n.type},getFatherField:function(){return n.fatherField},getChildField:function(){return n.childField},setLoading:function(e){return n.loading=!!e},isLoading:function(){return n.loading},isEditable:function(){return n.editable},getPrefix:function(){return n.prefix},getFields:function(){return{father:n.fatherField,child:n.childField}},getTitle:function(){return n.title},setTitle:function(e){return n.title=e}}),e},{}),_length:r?r.length:0,_reloadRelationsInfo:function(){this._relationsInfo={children:{},fathers:{},father_child:{}};var a,n,e=this._relationsInfo,i=e.father_child,r=e.fathers,o=e.children;Object.entries(this._relations).forEach(function(e){var e=_(e,2),t=e[0],e=e[1];a=e.getFather(),n=e.getChild(),i[a+n]=t,r[a]=r[a]||[],o[n]=o[n]||[],r[a].push(n),o[n].push(a)})},getLength:function(){return this._length},getRelations:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).type,t=void 0===e?null:e;if(!t)return this._relations;if(-1===["ONE","MANY"].indexOf(t))return{};var a,n={};for(a in this._relations)t===this._relations[a].getType()&&(n[a]=this._relations[a]);return n},setRelations:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];this._relations=Array.isArray(e)?e:[]},getRelationById:function(e){return this._relations[e]},getArray:function(){return Object.entries(this._relations).map(function(e){return e[1]})},getRelationByFatherChildren:function(e,t){return this.getRelationById(this._relationsInfo.father_child[e+t])},isChild:function(e){return!!this._relationsInfo.children[e]},isFather:function(e){return!!this._relationsInfo.fathers[e]},hasChildren:function(e){return 0<(this.getChildren(e)||[]).length},hasFathers:function(e){return 0<(this.getFathers(e)||[]).length},getChildren:function(e){return this.isFather(e)?this._relationsInfo.fathers[e]:null},getFathers:function(e){return this.isChild(e)?this._relationsInfo.children[e]:null}},a._relations._reloadRelationsInfo(),e.styles&&e.styles.find(function(e){return e.current}).name),i=(a.state={id:e.id,title:e.title,selected:e.selected||!1,disabled:e.disabled||!1,metadata:e.metadata,openattributetable:a.canShowTable(),removable:e.removable||!1,downloadable:a.isDownloadable(),source:e.source,styles:e.styles,defaultstyle:i,infoformat:a.getInfoFormat(),infoformats:a.config.infoformats||[],projectLayer:!0,geolayer:!1,attributetable:{pageLength:null},visible:e.visible||!1,tochighlightable:!1,inediting:!1,selection:{active:!1},filter:{active:!1,current:null},filters:e.filters||[],featurecount:e.featurecount,stylesfeaturecount:e.featurecount&&i&&(n={},t=i,r=e.featurecount,t in n?Object.defineProperty(n,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):n[t]=r,n),name:e.name,expanded:e.expanded,toc:"boolean"!=typeof e.toc||e.toc},a.selectionFids=new Set,a._layersstore=e.layersstore||null,a.config.servertype+" "+(a.config.source&&a.config.source.type));return a.providers={data:["QGIS virtual","QGIS postgres","QGIS oracle","QGIS mssql","QGIS spatialite","QGIS ogr","QGIS delimitedtext","QGIS wfs"].includes(i)?A("qgis",a):"G3WSUITE geojson"==i?A("geojson",a):void 0,filter:["QGIS virtual","QGIS postgres","QGIS oracle","QGIS mssql","QGIS spatialite","QGIS ogr","QGIS delimitedtext","QGIS wfs","QGIS wmst","QGIS wcs","QGIS wms"].includes(i)&&A("wfs",a),filtertoken:["QGIS virtual","QGIS postgres","QGIS oracle","QGIS mssql","QGIS spatialite","QGIS ogr","QGIS delimitedtext"].includes(i)&&A("qgis",a),query:["QGIS virtual","QGIS postgres","QGIS oracle","QGIS mssql","QGIS spatialite","QGIS ogr","QGIS delimitedtext","QGIS wfs","QGIS wmst","QGIS wcs","QGIS wms","QGIS gdal","QGIS postgresraster","QGIS vector-tile","QGIS vectortile","QGIS arcgismapserver","QGIS mdal","OGC wms"].includes(i)?A("wms",a):"G3WSUITE geojson"==i?A("geojson",a):void 0,search:["QGIS virtual","QGIS postgres","QGIS oracle","QGIS mssql","QGIS spatialite","QGIS ogr","QGIS delimitedtext","QGIS wfs"].includes(i)&&A("qgis",a)},a.proxyData={wms:null},a}return y.prototype=Object.create(e&&e.prototype,{constructor:{value:y,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(y,e):y.__proto__=e),b(m,[{key:"getDownloadFilefromDownloadDataType",value:function(e,t){t=t.data,t=void 0===t?{}:t;return t.filtertoken=this.getFilterToken(),"pdf"===e?(0,C.downloadFile)({url:this.getUrl("pdf"),headers:{"Content-Type":"application/json; charset=utf-8"},data:JSON.stringify(t),mime_type:"application/pdf",method:"POST"}):M.XHR.fileDownload({url:this.getUrl("shapefile"===e?"shp":e),data:t,httpMethod:"POST"})}},{key:"getGeoTIFF",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).data;return this.getDownloadFilefromDownloadDataType("geotiff",{data:void 0===e?{}:e})}},{key:"getXls",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).data;return this.getDownloadFilefromDownloadDataType("xls",{data:void 0===e?{}:e})}},{key:"getShp",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).data;return this.getDownloadFilefromDownloadDataType("shapefile",{data:void 0===e?{}:e})}},{key:"getGpx",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).data;return this.getDownloadFilefromDownloadDataType("gpx",{data:void 0===e?{}:e})}},{key:"getGpkg",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).data;return this.getDownloadFilefromDownloadDataType("gpkg",{data:void 0===e?{}:e})}},{key:"getCsv",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).data;return this.getDownloadFilefromDownloadDataType("csv",{data:void 0===e?{}:e})}},{key:"getDownloadableFormats",value:function(){var t=this;return Object.keys(N).filter(function(e){return t.config[e]}).map(function(e){return N[e].format})}},{key:"getDownloadUrl",value:function(t){return(Object.values(N).find(function(e){return e.format===t})||{}).url}},{key:"isDownloadable",value:function(){return!!this.getDownloadableFormats().length}},{key:"isGeoTIFFDownlodable",value:function(){return!this.isBaseLayer()&&this.config.download&&"gdal"===this.config.source.type}},{key:"isShpDownlodable",value:function(){return!this.isBaseLayer()&&this.config.download&&"gdal"!==this.config.source.type}},{key:"isXlsDownlodable",value:function(){return!this.isBaseLayer()&&!!this.config.download_xls}},{key:"isGpxDownlodable",value:function(){return!this.isBaseLayer()&&!!this.config.download_gpx}},{key:"isGpkgDownlodable",value:function(){return!this.isBaseLayer()&&!!this.config.download_gpkg}},{key:"isCsvDownlodable",value:function(){return!this.isBaseLayer()&&!!this.config.download_csv}},{key:"getRelations",value:function(){return this._relations}},{key:"getRelationById",value:function(t){return this._relations.getArray().find(function(e){return t===e.getId()})}},{key:"getRelationAttributes",value:function(t){var e=this._relations.find(function(e){return t===e.name});return e?e.fields:[]}},{key:"getRelationsAttributes",value:function(){return(this.state.relations||[]).reduce(function(e,t){return e[t.name]=t.fields,e},{})}},{key:"isChild",value:function(){return!!this.getRelations()&&this._relations.isChild(this.getId())}},{key:"isFather",value:function(){return!!this.getRelations()&&this._relations.isFather(this.getId())}},{key:"getChildren",value:function(){return this.isFather()?this._relations.getChildren(this.getId()):[]}},{key:"getFathers",value:function(){return this.isChild()?this._relations.getFathers(this.getId()):[]}},{key:"hasChildren",value:function(){return!!this.hasRelations()&&this._relations.hasChildren(this.getId())}},{key:"hasFathers",value:function(){return!!this.hasRelations()&&this._relations.hasFathers(this.getId())}},{key:"hasRelations",value:function(){return!!this._relations}},{key:"isSelected",value:function(){return this.state.selected}},{key:"setSelected",value:function(e){this.state.selected=e}},{key:"setSelection",value:(h=F(function*(){var e,t=0<arguments.length&&void 0!==arguments[0]&&arguments[0];(this.state.selection.active=t)||(t=this.state.filter.active,(e=null!==this.state.filter.current)&&t&&(yield this._applyFilterToken(this.state.filter.current)),!e&&t&&(yield this.deleteFilterToken()),this.emit("unselectionall",this.getId()))}),function(){return h.apply(this,arguments)})},{key:"isSelectionActive",value:function(){return this.state.selection.active}},{key:"getSelection",value:function(){return this.state.selection}},{key:"getFilter",value:function(){return this.state.filter}},{key:"setFilter",value:function(){this.state.filter.active=0<arguments.length&&void 0!==arguments[0]&&arguments[0],this.isGeoLayer()&&this.state.filter.active&&this.hideOlSelectionFeatures(),this.isGeoLayer()&&!this.state.filter.active&&this.updateMapOlSelectionFeatures()}},{key:"applyFilter",value:(g=F(function*(e){this.providers.filtertoken&&(null!==this.state.filter.current&&e.fid===this.state.filter.current.fid||(yield this.clearSelectionFids(),S.default.closeContent()),yield this._applyFilterToken(e))}),function(e){return g.apply(this,arguments)})},{key:"_applyFilterToken",value:(f=F(function*(e){try{var t=yield M.XHR.get({url:this.providers.filtertoken._layer.getUrl("filtertoken"),params:{mode:"apply",fid:e.fid}});t&&t.result&&t.data&&(this.setFilter(!1),this.state.filter.current=e,this.setFilterToken(t.data))}catch(e){}}),function(e){return f.apply(this,arguments)})},{key:"saveFilter",value:function(){var a,t;!this.providers.filtertoken||0<!this.selectionFids.size||(a=this,(0,P.prompt)({label:R("layer_selection_filter.tools.savefilter"),value:a.state.filter.current?a.state.filter.current.name:"",callback:(t=F(function*(e){var t=yield M.XHR.get({url:a.providers.filtertoken._layer.getUrl("filtertoken"),params:{mode:"save",name:e}});t&&t.result&&t.data&&(void 0===(e=a.state.filters.find(function(e){return t.data.fid===e.fid}))&&(e={fid:t.data.fid,name:t.data.name},a.state.filters.push(e)),a.state.filter.current=e,a.setFilter(!1),a.getSelection().active=!1,a.selectionFids.clear(),a.isGeoLayer()&&a.setOlSelectionFeatures(),a.emit("unselectionall",a.getId()))}),function(e){return t.apply(this,arguments)})}))}},{key:"toggleFilterToken",value:(p=F(function*(){this.setFilter(!this.state.filter.active);var e=this.state.filter.current,t=this.state.filter.active;return t&&(yield this.createFilterToken()),e&&!t&&(yield this.applyFilter(this.state.filter.current)),e||t||(yield this.deleteFilterToken()),this.state.filter.active}),function(){return p.apply(this,arguments)})},{key:"deleteFilterToken",value:(d=F(function*(t){try{if(this.providers.filtertoken){var e=void 0;try{var a=yield M.XHR.get({url:this.providers.filtertoken._layer.getUrl("filtertoken"),params:{fid:t,mode:void 0===t?"delete":"delete_saved"}});a&&a.result&&a.data&&(e=a.data.filtertoken)}catch(e){}void 0!==t&&(this.state.filters=this.state.filters.filter(function(e){return t!==e.fid})),this.state.filter.current=null,this.state.filter.active&&this.setFilter(!1),this.setFilterToken(e)}}catch(e){}}),function(e){return d.apply(this,arguments)})},{key:"setFilterToken",value:function(){x.default.tokens.filtertoken=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,this.emit("filtertokenchange",{layerId:this.getId()})}},{key:"createFilterToken",value:(c=F(function*(){try{var e=this.providers.filtertoken,t=this.selectionFids;if(e&&!(0<!t.size))if(t.has(w.SELECTION.ALL)){try{yield M.XHR.get({url:this.providers.filtertoken._layer.getUrl("filtertoken"),params:{fid:void 0,mode:"delete"}})}catch(e){}this.setFilterToken(null)}else{var a=Array.from(t),n=(yield M.XHR.get({url:e._layer.getUrl("filtertoken"),params:t.has(w.SELECTION.EXCLUDE)?{fidsout:a.filter(function(e){return e!==w.SELECTION.EXCLUDE}).join(",")}:{fidsin:a.join(",")}})).data,i=void 0===n?{}:n;this.setFilterToken(i.filtertoken)}}catch(e){}}),function(){return c.apply(this,arguments)})},{key:"getFilterToken",value:function(){return x.default.tokens.filtertoken}},{key:"setSelectionFidsAll",value:function(){this.selectionFids.clear(),this.selectionFids.add(w.SELECTION.ALL),this.isGeoLayer()&&(Object.values(this.olSelectionFeatures).forEach(function(e){return e.selected=!0}),this.updateMapOlSelectionFeatures()),this.setSelection(!0),this.state.filter.active&&this.createFilterToken()}},{key:"getSelectionFids",value:function(){return this.selectionFids}},{key:"invertSelectionFids",value:function(){var e=this.selectionFids;e.has(w.SELECTION.EXCLUDE)?e.delete(w.SELECTION.EXCLUDE):e.has(w.SELECTION.ALL)?e.delete(w.SELECTION.ALL):0<e.size&&e.add(w.SELECTION.EXCLUDE),this.isGeoLayer()&&this.setInversionOlSelectionFeatures(),this.state.filter.active&&this.createFilterToken(),this.setSelection(0<e.size)}},{key:"hasSelectionFid",value:function(e){var t=this.selectionFids;return!!t.has(w.SELECTION.ALL)||(t.has(w.SELECTION.EXCLUDE)?!t.has(e):t.has(e))}},{key:"includeSelectionFid",value:(u=F(function*(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],a=this.selectionFids,n=a.has(w.SELECTION.EXCLUDE)&&a.has(e);n&&a.delete(e),n||a.add(e),n&&1===a.size&&this.setSelectionFidsAll(),n||this.isSelectionActive()||this.setSelection(!0),this.isGeoLayer()&&this.setOlSelectionFeatureByFid(e,n?"remove":"add"),t&&this.state.filter.active&&(yield this.createFilterToken())}),function(e){return u.apply(this,arguments)})},{key:"excludeSelectionFid",value:(l=F(function*(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],a=this.selectionFids;!a.has(w.SELECTION.ALL)&&0!==a.size||(a.clear(),a.add(w.SELECTION.EXCLUDE)),a.has(w.SELECTION.EXCLUDE)?a.add(e):a.delete(e),0===a.size&&this.clearSelectionFids(),1===a.size&&a.has(w.SELECTION.EXCLUDE)&&(a.clear(),this.setselectionFidsAll()),this.isGeoLayer()&&(a=a.has(w.SELECTION.EXCLUDE)?a.has(e):!a.has(e),this.setOlSelectionFeatureByFid(e,a?"remove":"add")),t&&this.state.filter.active&&(yield this.createFilterToken())}),function(e){return l.apply(this,arguments)})},{key:"includeSelectionFids",value:(s=F(function*(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],a=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];e.forEach(function(e){return t.includeSelectionFid(e,!1)}),a&&this.state.filter.active&&(yield this.createFilterToken())}),function(){return s.apply(this,arguments)})},{key:"excludeSelectionFids",value:(o=F(function*(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],a=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];e.forEach(function(e){return t.excludeSelectionFid(e,!1)}),a&&this.state.filter.active&&(yield this.createFilterToken())}),function(){return o.apply(this,arguments)})},{key:"clearSelectionFids",value:(r=F(function*(){this.selectionFids.clear(),this.isGeoLayer()&&(Object.values(this.olSelectionFeatures).forEach(function(e){return e.selected=!1}),this.updateMapOlSelectionFeatures()),yield this.setSelection(!1)}),function(){return r.apply(this,arguments)})},{key:"getProxyData",value:function(e){return e?this.proxyData[e]:this.proxyData}},{key:"setProxyData",value:function(e){this.proxyData[e]=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}}},{key:"clearProxyData",value:function(e){this.proxyData[e]=null}},{key:"getDataProxyFromServer",value:(i=F(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"wms",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};try{var a=yield k.default.getData("proxy:"+e,{inputs:t,outputs:!1}),n=a.response,i=a.data;return this.setProxyData(e,JSON.parse(i)),n}catch(e){}}),function(){return i.apply(this,arguments)})},{key:"changeProxyDataAndReloadFromServer",value:function(){var a=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"wms",i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return Object.keys(i).forEach(function(t){Object.keys(i[t]).forEach(function(e){a.proxyData[n][t][e]=i[t][e]})}),this.getDataProxyFromServer(n,this.proxyData[n])}},{key:"isInEditing",value:function(){return this.state.inediting}},{key:"setInEditing",value:function(){this.state.inediting=0<arguments.length&&void 0!==arguments[0]&&arguments[0]}},{key:"getSearchParams",value:function(){return this.config.searchParams}},{key:"getSearchEndPoint",value:function(){return"api"}},{key:"setAttributeTablePageLength",value:function(e){this.state.attributetable.pageLength=e}},{key:"getAttributeTablePageLength",value:function(){return this.state.attributetable.pageLength}},{key:"getWMSLayerName",value:function(){return this.isWmsUseLayerIds()?this.getId():this.getName()}},{key:"isWmsUseLayerIds",value:function(){return this.config.wms_use_layer_ids}},{key:"getSourceType",value:function(){return this.config.source?this.config.source.type:null}},{key:"isGeoLayer",value:function(){return this.state.geolayer}},{key:"getDataTable",value:function(){var a=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.page,n=void 0===t?null:t,t=e.page_size,i=void 0===t?null:t,t=e.ordering,r=void 0===t?null:t,t=e.search,o=void 0===t?null:t,t=e.suggest,s=void 0===t?null:t,t=e.formatter,l=void 0===t?0:t,t=e.custom_params,u=void 0===t?{}:t,c=e.field,d=e.in_bbox;return(0,T.$promisify)(F(function*(){var e,t;return a.getProvider("filter")||a.getProvider("data")?(t=(e=yield(0,T.promisify)(a.getProvider("data").getFeatures({editing:!1},v({},u,{field:c,page:n,page_size:i,ordering:r,search:o,formatter:l,suggest:s,in_bbox:d,filtertoken:x.default.tokens.filtertoken})))).data.features||[],{headers:(0,L.parseAttributes)(a.getAttributes(),t.length?t[0].properties:[]),features:t,title:a.getTitle(),count:e.count}):Promise.reject()}))}},{key:"getFeatureByFids",value:(n=F(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.fids,t=void 0===t?[]:t,e=e.formatter,e=void 0===e?0:e,a=this.getUrl("data");try{var n=yield M.XHR.get({url:a,params:{fids:t.toString(),formatter:e}});if(n&&n.result&&n.vector&&n.vector.data)return n.vector.data.features}catch(e){}}),function(){return n.apply(this,arguments)})},{key:"searchFeatures",value:function(){var a,e=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t=n.search_endpoint,r=void 0===t?this.config.search_endpoint:t;return new Promise((a=F(function*(t,a){switch(r){case"ows":e.search(n,i).then(function(e){t({data:e})}).fail(function(e){a(e)});break;case"api":try{t(yield e.getFilterData({queryUrl:n.queryUrl,field:n.filter,ordering:n.ordering,unique:n.unique,raw:void 0!==n.raw&&n.raw,suggest:n.suggest,formatter:void 0!==n.formatter?n.formatter:1}))}catch(e){a(e)}}}),function(e,t){return a.apply(this,arguments)}))}},{key:"getFilterData",value:(a=F(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.raw,t=void 0!==t&&t,a=e.suggest,n=e.field,i=e.unique,r=e.fformatter,o=e.ffield,s=e.formatter,s=void 0===s?1:s,l=e.queryUrl,e=e.ordering,u=this.getProvider("data"),a=(u._projections=u._projections||{map:null,layer:null},{field:n,suggest:a,ordering:e,formatter:s,unique:i,fformatter:r,ffield:o,filtertoken:x.default.tokens.filtertoken});try{var c=l||u._layer.getUrl("data"),d=n?yield M.XHR.post({url:c,contentType:"application/json",data:JSON.stringify(a)}):yield M.XHR.get({url:c,params:a});if("table"!==u._layer.getType()&&(u._projections.map=u._layer.getMapProjection()||u._projections.layer),t)return d;if(i&&d.result)return d.data;if(r&&d.result)return d;if(d.result)return{data:I.ResponseParser.get("application/json")({layers:[u._layer],response:d.vector.data,projections:u._projections})}}catch(e){return Promise.reject(e)}return Promise.reject()}),function(){return a.apply(this,arguments)})},{key:"search",value:function(){var e=v({},e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},{feature_count:e.feature_count||10},this.config.searchParams,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}),t=this.getProvider("search");return(0,T.$promisify)(F(function*(){return t?yield(0,T.promisify)(t.query(e)):Promise.reject(R("sdk.search.layer_not_searchable"))}))}},{key:"query",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this.getProvider(e.filter?"filter":"query");return(0,T.$promisify)(F(function*(){return t?yield(0,T.promisify)(t.query(e)):Promise.reject(R("sdk.search.layer_not_querable"))}))}},{key:"get",value:function(e){return this.config[e]||this.state[e]}},{key:"getFields",value:function(){return this.config.fields}},{key:"getEditingFields",value:function(){return this.config.editing.fields}},{key:"getTableFields",value:function(){return(this.config.fields||[]).filter(function(e){return e.show})}},{key:"getTableHeaders",value:function(){return this.getTableFields().filter(function(e){return!w.GEOMETRY_FIELDS.includes(e.name)})}},{key:"getProject",value:function(){return this.config.project}},{key:"getConfig",value:function(){return this.config}},{key:"getLayerEditingFormStructure",value:function(){return this.config.editor_form_structure}},{key:"hasFormStructure",value:function(){return!!this.config.editor_form_structure}},{key:"getCustomStyle",value:function(){return this.config.customstyle}},{key:"getState",value:function(){return this.state}},{key:"getSource",value:function(){return this.state.source}},{key:"getEditingLayer",value:function(){return this._editingLayer}},{key:"setEditingLayer",value:function(e){this._editingLayer=e}},{key:"isHidden",value:function(){return this.state.hidden}},{key:"setHidden",value:function(){this.state.hidden=!(0<arguments.length&&void 0!==arguments[0])||arguments[0]}},{key:"getId",value:function(){return this.config.id}},{key:"getMetadata",value:function(){return this.state.metadata}},{key:"getTitle",value:function(){return this.config.title}},{key:"getName",value:function(){return this.config.name}},{key:"getOrigName",value:function(){return this.config.origname}},{key:"getServerType",value:function(){return this.config.servertype||m.ServerTypes.QGIS}},{key:"getType",value:function(){return this.type}},{key:"isType",value:function(e){return e===this.getType()}},{key:"setDisabled",value:function(e){this.state.disabled=e}},{key:"isDisabled",value:function(){return this.state.disabled}},{key:"isVisible",value:function(){return this.state.visible}},{key:"setVisible",value:function(e){this.state.visible=e}},{key:"isQueryable",value:function(){return!!(this.config.capabilities&&this.config.capabilities&m.CAPABILITIES.QUERYABLE)}},{key:"getTocHighlightable",value:function(){return this.state.tochighlightable}},{key:"setTocHighlightable",value:function(){this.state.tochighlightable=0<arguments.length&&void 0!==arguments[0]&&arguments[0]}},{key:"isFilterable",value:function(){var e,n=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=!!(this.config.capabilities&&this.config.capabilities&m.CAPABILITIES.FILTERABLE);return t&&i&&(e=Object.keys(i).reduce(function(e,t){var a=n.get(t),t=i[t];return e&&Array.isArray(a)?a.includes(t):t===a},!0),t=t&&e),t}},{key:"isQtimeseries",value:function(){return this.config.qtimeseries}},{key:"isEditable",value:function(){return!!(this.config.capabilities&&this.config.capabilities&m.CAPABILITIES.EDITABLE)}},{key:"isBaseLayer",value:function(){return this.config.baselayer}},{key:"getUrl",value:function(e){return this.config.urls[e]}},{key:"setUrl",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.type;this.config.urls[t]=e.url}},{key:"getQueryUrl",value:function(){return this.config.urls.query}},{key:"getQueryLayerOrigName",value:function(){return this.state.infolayer&&""!==this.config.infolayer?this.config.infolayer:this.config.origname}},{key:"getInfoFormat",value:function(e){return!0===this.config.qtimeseries||"gdal"===this.getSourceType()?"application/json":this.config.infoformat&&""!==this.config.infoformat&&"wfs"!==e?this.config.infoformat:"application/vnd.ogc.gml"}},{key:"getInfoFormats",value:function(){return this.state.infoformats}},{key:"getInfoUrl",value:function(){return this.config.infourl}},{key:"setInfoFormat",value:function(e){this.config.infoformat=e}},{key:"getAttributes",value:function(){return this.config.fields}},{key:"changeAttribute",value:function(e,t,a){var n=!0,i=!1,r=void 0;try{for(var o,s=this.config.fields[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value;if(l.name===e){l.type=t,l.options=a;break}}}catch(e){i=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(i)throw r}}}},{key:"getAttributeLabel",value:function(t){return(this.getAttributes().find(function(e){return t===e.name})||{}).label}},{key:"getProvider",value:function(e){return this.providers[e]}},{key:"getProviders",value:function(){return this.providers}},{key:"getLayersStore",value:function(){return this._layersstore}},{key:"setLayersStore",value:function(e){this._layersstore=e}},{key:"canShowTable",value:function(){return!this.config.not_show_attributes_table&&!this.isBaseLayer()&&(m.ServerTypes.QGIS===this.getServerType()&&[m.SourceTypes.POSTGIS,m.SourceTypes.ORACLE,m.SourceTypes.WFS,m.SourceTypes.OGR,m.SourceTypes.MSSQL,m.SourceTypes.SPATIALITE].includes(this.config.source.type)&&this.isQueryable()?0<this.getTableFields().length:m.ServerTypes.G3WSUITE===this.getServerType()&&"geojson"===this.get("source").type||!(m.ServerTypes.G3WSUITE===this.getServerType()||!this.isFilterable()))}},{key:"changeFieldType",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.name,a=e.type,n=e.options,n=void 0===n?{}:n,e=e.reset,e=void 0!==e&&e,i=this.getFields().find(function(e){return t===e.name});return i&&e?(i.type=i._type,delete i._type,delete i[a+"options"],i.type):i&&!e?(i._type=i.type,i.type=a,i[a+"options"]=n,i._type):void 0}},{key:"changeConfigFieldType",value:function(e){var t=e.name,a=e.options,n=e.reset;return this.changeFieldType({name:t,type:e.type,options:void 0===a?{}:a,reset:void 0!==n&&n})}},{key:"clear",value:function(){}},{key:"isVector",value:function(){return m.LayerTypes.VECTOR===this.getType()}},{key:"isTable",value:function(){return m.LayerTypes.TABLE===this.getType()}},{key:"getFeatureCount",value:function(){return this.state.featurecount}},{key:"getStyleFeatureCount",value:(t=F(function*(t){if(void 0!==this.state.stylesfeaturecount){if(void 0===this.state.stylesfeaturecount[t])try{var e=yield M.XHR.post({url:""+this.config.urls.featurecount+this.getId()+"/",data:JSON.stringify({style:t}),contentType:"application/json"}),a=e.result,n=e.data;this.state.stylesfeaturecount[t]=!0===a?n:{}}catch(e){cansole.warn(e),this.state.stylesfeaturecount[t]={}}return this.state.stylesfeaturecount[t]}}),function(e){return t.apply(this,arguments)})},{key:"getFormat",value:function(){return this.config.format||x.default.project.state.wms_getmap_format||"image/png"}},{key:"openAttributeTable",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};new(Vue.extend(O.default))(v({},e,{layerId:this.state.id}))}}]),m})(E.default);e.LayerTypes={TABLE:"table",IMAGE:"image",VECTOR:"vector"},e.ServerTypes={OGC:"OGC",QGIS:"QGIS",Mapserver:"Mapserver",Geoserver:"Geoserver",ARCGISMAPSERVER:"ARCGISMAPSERVER",OSM:"OSM",BING:"Bing",LOCAL:"Local",TMS:"TMS",WMS:"WMS",WMTS:"WMTS",G3WSUITE:"G3WSUITE"},e.SourceTypes={VIRTUAL:"virtual",POSTGIS:"postgres",SPATIALITE:"spatialite",ORACLE:"oracle",MSSQL:"mssql",CSV:"delimitedtext",OGR:"ogr",GDAL:"gdal",WMS:"wms",WMST:"wmst",WFS:"wfs",WCS:"wcs",MDAL:"mdal","VECTOR-TILE":"vector-tile",VECTORTILE:"vectortile",ARCGISMAPSERVER:"arcgismapserver",GEOJSON:"geojson",POSTGRESRASTER:"postgresraster"},e.CAPABILITIES={QUERYABLE:1,FILTERABLE:2,EDITABLE:4},e.SELECTION_STATE=w.SELECTION,a.Layer=e},{"components/Table.vue":120,"g3w-constants":140,"g3w-i18n":143,"g3w-object":144,"map/layers/feature":166,"services/data":187,"services/gui":188,"store/application":193,"utils/XHR":196,"utils/createRelationsUrl":209,"utils/downloadFile":215,"utils/get_legend_params":233,"utils/parseAttributes":244,"utils/parsers":245,"utils/promisify":247,"utils/prompt":248}],171:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.LayersStore=void 0;var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},i=function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e};function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=e("g3w-object"),s=(s=s)&&s.__esModule?s:{default:s},l=e("utils/getUniqueDomId");a.LayersStore=(e=>{var t=n;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,a=n;if(t instanceof a)return(t=((e,t)=>{if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")})(this,(n.__proto__||Object.getPrototypeOf(n)).call(this))).config={id:e.id||Date.now(),projection:e.projection,extent:e.extent,initextent:e.initextent,wmsUrl:e.wmsUrl,catalog:!0!==e.catalog&&!1!==e.catalog||e.catalog},t.state={layerstree:[],relations:null},t._isQueryable=!0!==e.queryable&&!1!==e.queryable||e.queryable,t._layers=t.config.layers||{},t.setters={setLayerSelected:function(t,a){this.getLayers().forEach(function(e){return e.state.selected=t===e.getId()&&a})},addLayers:function(){var t=this;(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(e){return t.addLayer(e)})},addLayer:function(e){this._addLayer(e)},removeLayer:function(e){this._removeLayer(e)}},t;throw new TypeError("Cannot call a class as a function")}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e),i(n,[{key:"isQueryable",value:function(){return this._isQueryable}},{key:"setQueryable",value:function(e){this._isQueryable=!!e}},{key:"showOnCatalog",value:function(){return this.config.catalog}},{key:"setOptions",value:function(){this.config=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}}},{key:"getId",value:function(){return this.config.id}},{key:"_addLayer",value:function(e){this._layers[e.getId()]=e}},{key:"_removeLayer",value:function(e){delete this._layers[e.getId()]}},{key:"removeLayers",value:function(){var t=this;Object.entries(this._layers).forEach(function(e){e=o(e,2);e[0];return t.removeLayer(e[1])})}},{key:"getLayersDict",value:function(){var t,e,a,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return!n||[n.PRINTABLE,n.QUERYABLE,n.FILTERABLE,n.EDITABLE,n.VISIBLE,n.SELECTED,n.CACHED,n.SELECTED_OR_ALL,n.SERVERTYPE,n.BASELAYER,n.GEOLAYER,n.VECTORLAYER,n.HIDDEN,n.DISABLED,n.IDS].every(function(e){return void 0===e})?this._layers:(e=Object.values(this._layers),n.IDS&&(t=[].concat(n.IDS),e=e.filter(function(e){return t.includes(e.getId())})),n.SELECTED_OR_ALL&&(e=0<(a=e.filter(function(e){return e.isSelected()})).length?a:e),(a=function(e){return"boolean"==typeof e})(n.SELECTED)&&!n.SELECTED_OR_ALL&&(e=e.filter(function(e){return n.SELECTED===e.isSelected()})),a(n.QUERYABLE)&&(e=e.filter(function(e){return n.QUERYABLE===e.isQueryable()})),a(n.FILTERABLE)&&(e=e.filter(function(e){return n.FILTERABLE===e.isFilterable(i.filtrable||null)})),a(n.EDITABLE)&&(e=e.filter(function(e){return n.EDITABLE===e.isEditable()})),a(n.VISIBLE)&&(e=e.filter(function(e){return n.VISIBLE===e.isVisible()})),a(n.CACHED)&&(e=e.filter(function(e){return n.CACHED===e.isCached()})),a(n.BASELAYER)&&(e=e.filter(function(e){return n.BASELAYER===e.isBaseLayer()})),a(n.GEOLAYER)&&(e=e.filter(function(e){return n.GEOLAYER===e.state.geolayer})),a(n.VECTORLAYER)&&(e=e.filter(function(e){return n.VECTORLAYER===e.isType("vector")})),a(n.HIDDEN)&&(e=e.filter(function(e){return n.HIDDEN===e.isHidden()})),a(n.DISABLED)&&(e=e.filter(function(e){return n.DISABLED===e.isDisabled()})),"string"==typeof n.SERVERTYPE&&n.SERVERTYPE.length&&(e=e.filter(function(e){return n.SERVERTYPE===e.getServerType()})),n.PRINTABLE&&(e=e.filter(function(e){return e.state.geolayer&&e.isPrintable({scale:n.PRINTABLE.scale})})),i.TOC_ORDER&&this.state.layerstree?this._getAllSiblingsChildrenLayersId(this.state.layerstree[0]).filter(function(t){return e.find(function(e){return t===e.getId()})}).map(function(t){return e.find(function(e){return t===e.getId()})}):e)}},{key:"getLayers",value:function(){return Object.values(this.getLayersDict(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}))}},{key:"getBaseLayers",value:function(){return this.getLayersDict({BASELAYER:!0})}},{key:"getLayerById",value:function(e){return this.getLayersDict()[e]}},{key:"getLayerByName",value:function(t){return this._layers.find(function(e){return t===e.getName()})}},{key:"getLayerAttributes",value:function(e){return this.getLayerById(e).getAttributes()}},{key:"getLayerAttributeLabel",value:function(e,t){return this.getLayerById(e).getAttributeLabel(t)}},{key:"getGeoLayers",value:function(){return this.getLayers({GEOLAYER:!0})}},{key:"_getAllSiblingsChildrenLayersId",value:function(e){var a=[];return function t(e){e.nodes.forEach(function(e){e.id?a.push(e.id):t(e)})}(e),a}},{key:"_getAllParentLayersId",value:function(e,t){var a=[];return{nodes:e.nodes.filter(function(e){return t!==e})}.nodes.forEach(function(e){e.id&&a.push(e.id)}),a}},{key:"selectLayer",value:function(e,t){this.setLayerSelected(e,t)}},{key:"getProjection",value:function(){return this.config.projection}},{key:"getExtent",value:function(){return this.config.extent}},{key:"getInitExtent",value:function(){return this.config.initextent}},{key:"getWmsUrl",value:function(){return this.config.wmsUrl}},{key:"removeLayersTree",value:function(){this.state.layerstree.splice(0,this.state.layerstree.length)}},{key:"getLayersTree",value:function(){return this.state.layerstree}},{key:"setLayersTree",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1],a=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],n=this.getInitExtent(),n=o(n,4),i=n[0],t={title:t||this.config.id,root:!0,parentGroup:null,expanded:a,disabled:!1,checked:!0,bbox:{minx:i,miny:n[1],maxx:n[2],maxy:n[3]},nodes:e};0<e.length&&(this._traverseLayersTree(e,t),this.state.layerstree.splice(0,0,t))}},{key:"createLayersTree",value:function(e){var t,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{layerstree:null,expanded:!1,full:!1},n=[];if(a.layerstree&&!0===a.full)return this.state.layerstree;a.layerstree&&!0!==a.full&&(t=this.getLayers({BASELAYER:!1}).map(function(e){return e.getId()}),this._traverseLightLayersTree(a.layerstree,n,t)),a.layerstree||(n=this.getGeoLayers().map(function(e){return{id:e.getId(),name:e.getName(),title:e.getTitle(),visible:e.isVisible()||!1}})),this.setLayersTree(n,e,a.expanded)}},{key:"_traverseLightLayersTree",value:function(e,a,n){var i=this;e.forEach(function(t){var e=null;null!=t.id&&n.find(function(e){return t.id===e})&&(e=r({},e,t)),null!=t.nodes&&(e=r({},e,{name:t.name,title:t.name,groupId:(0,l.getUniqueDomId)(),root:!1,nodes:[],checked:t.checked,mutually_exclusive:t["mutually-exclusive"],"mutually-exclusive":t["mutually-exclusive"]}),i._traverseLightLayersTree(t.nodes,e.nodes,n)),null!==e&&(e.expanded=t.expanded,a.push(e))})}},{key:"_traverseLayersTree",value:function(a,n){var i=this;a.forEach(function(e,t){void 0!==e.id&&(a[t]=i.getLayerById(e.id).getState()),void 0!==e.id&&(a[t]=i.getLayerById(e.id).getState(),void 0!==a[t].bbox)&&i._setLayersTreeGroupBBox(n,{bbox:a[t].bbox,epsg:a[t].epsg}),Array.isArray(e.nodes)&&(e.nodes.forEach(function(e){return e.parentGroup=n}),i._traverseLayersTree(e.nodes,e)),a[t].parentGroup=n})}},{key:"_setLayersTreeGroupBBox",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=t.bbox,t=t.epsg,n=this.getProjection().getCode();t!==n&&(t=ol.proj.transformExtent([a.minx,a.miny,a.maxx,a.maxy],t,n),a={minx:(t=o(t,4))[0],miny:t[1],maxx:t[2],maxy:t[3]}),void 0===e.bbox?e.bbox=a:e.bbox=ol.extent.extend([e.bbox.minx,e.bbox.miny,e.bbox.maxx,e.bbox.maxy],[a.minx,a.miny,a.maxx,a.maxy]).reduce(function(e,t,a){switch(a){case 0:e.minx=t;break;case 1:e.miny=t;break;case 2:e.maxx=t;break;case 3:e.maxy=t}return e},{minxx:null,miny:null,maxx:null,maxy:null}),e.parentGroup&&!1===e.parentGroup.root&&this._setLayersTreeGroupBBox(e.parentGroup,{bbox:e.bbox,epsg:n})}}]),n})(s.default)},{"g3w-object":144,"utils/getUniqueDomId":232}],172:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.TableLayer=void 0;var i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},r=function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e};function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=e("g3w-constants"),l=e("utils/waitFor"),u=e("utils/promisify"),o=e("utils/XHR"),c=e("utils/getCatalogLayerById"),d=e("map/layers/layer"),p=e("map/layers/featuresstore"),f=e("map/layers/feature");function g(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}var h=e("lodash.clonedeep");a.TableLayer=(e=>{var t,a=n;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);function n(){var r,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t=this,a=n;if(t instanceof a)return(r=((e,t)=>{if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")})(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e,o))).setters={clearFeatures:function(){this._featuresstore.clearFeatures()},addFeature:function(e){this._featuresstore.addFeature(e)},updateFeature:function(e){this._featuresstore.updateFeature(e)},setFeatures:function(e){this._featuresstore.setFeatures(e)},setColor:function(e){this._color=e},getFeatures:function(){var t=this,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return(0,u.$promisify)(g(function*(){var e=yield(0,u.promisify)(t._featuresstore.getFeatures(a));return t.emit("getFeatures",e),e}))},commit:function(t){var n=this;return(0,u.$promisify)(g(function*(){var e=yield(0,u.promisify)(n._featuresstore.commit(t));if(e&&e.result)try{var a=(0,c.getCatalogLayerById)(n.getId());a.isGeoLayer()&&t.update.forEach(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.id,e=e.geometry;a.getOlSelectionFeature(t)&&a.updateOlSelectionFeature({id:t,geometry:e})}),t.delete.forEach(function(e){a.hasSelectionFid(e)&&a.excludeSelectionFid(e)})}catch(e){}return e}))}},r.type=d.Layer.LayerTypes.TABLE,r._color=null,r.layerId=e.id,r.isEditable()&&(r.layerForEditing=g(function*(){try{var e=yield(0,u.promisify)(r.getProvider("data").getConfig(o)),t=e.vector,a=e.constraints,n=void 0===a?{}:a,i=e.capabilities;return yield(0,l.waitFor)(function(){return window.g3wsdk.core.hasOwnProperty("editing")},s.TIMEOUT),r.config.editing={fields:t.fields,format:t.format,constraints:n,capabilities:i||window.g3wsdk.constant.DEFAULT_EDITING_CAPABILITIES,form:{perc:null},style:t.style,geometrytype:t.geometrytype},t.style&&r.setColor(t.style.color),r._editor=new window.g3wsdk.core.editing.Editor({layer:r}),r.setReady(!0),r}catch(e){return r.setReady(!1),Promise.reject(r)}})(),r.state=i({},r.state,{editing:{started:!1,modified:!1,ready:!1}})),r._featuresstore=new p.FeaturesStore({provider:r.providers.data}),r;throw new TypeError("Cannot call a class as a function")}return a.prototype=Object.create(e&&e.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(a,e):a.__proto__=e),r(n,[{key:"setFormPercentage",value:function(e){this.config.editing.form.perc=e}},{key:"getFormPercentage",value:function(){return this.config.editing.form.perc}},{key:"clone",value:function(){return h(this)}},{key:"getColor",value:function(){return this._color}},{key:"readFeatures",value:function(){return this._featuresstore.readFeatures()}},{key:"getLayerForEditing",value:(t=g(function*(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).vectorurl;e&&(this.vectorUrl=e);try{return yield this.clone().layerForEditing}catch(e){return e}}),function(){return t.apply(this,arguments)})},{key:"getEditingSource",value:function(){return this._editor.getEditingSource()}},{key:"readEditingFeatures",value:function(){return this._editor.readEditingFeatures()}},{key:"getEditingLayer",value:function(){return this}},{key:"getEditingConstrains",value:function(){return this.config.editing.constraints}},{key:"getEditingCapabilities",value:function(){return this.config.editing.capabilities}},{key:"isFieldRequired",value:function(t){return(this.getEditingFields().find(function(e){return t===e.name})||{validate:{required:!1}}).validate.required}},{key:"unlock",value:function(){var e=this;return(0,u.$promisify)(g(function*(){yield(0,u.promisify)(e._featuresstore.unlock())}))}},{key:"getEditingFields",value:function(){var e=(this.config.editing.fields.length?this.config.editing:this.config).fields;return e=0<arguments.length&&void 0!==arguments[0]&&arguments[0]?e.filter(function(e){return e.editable}):e}},{key:"isPkField",value:function(t){return(this.getEditingFields().find(function(e){return t===e.name})||{}).pk}},{key:"isEditingFieldEditable",value:function(t){return(this.getEditingFields().find(function(e){return e.name===t})||{editable:!1}).editable}},{key:"getEditingNotEditableFields",value:function(){return this.config.editing.fields.filter(function(e){return!e.editable}).map(function(e){return e.name})}},{key:"getEditingMediaFields",value:function(){return this.config.editing.fields.filter(function(e){return"media"===e.input.type}).map(function(e){return e.name})}},{key:"isReady",value:function(){return this.state.editing.ready}},{key:"setReady",value:function(){this.state.editing.ready=0<arguments.length&&void 0!==arguments[0]&&arguments[0]}},{key:"getWidgetData",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return(0,u.$promisify)(g(function*(){return yield o.XHR.get({url:e.getProvider("data")._layer.getUrl("widget")[t.type],params:{fields:t.fields}})}))}},{key:"getEditor",value:function(){return this._editor}},{key:"isStarted",value:function(){return this._editor.isStarted()}},{key:"getFeaturesStore",value:function(){return this._featuresstore}},{key:"setFeaturesStore",value:function(e){this._featuresstore=e}},{key:"setSource",value:function(e){this.setFeaturesStore(e)}},{key:"getSource",value:function(){return this._featuresstore}},{key:"addFeatures",value:function(){var t=this;(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(e){return t.addFeature(e)})}},{key:"addLockIds",value:function(e){this._featuresstore.addLockIds(e)}},{key:"setFieldsWithValues",value:function(e,t){t=function a(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).reduce(function(e,t){return"child"===t.type?e[t.name]=a(t.fields):"null"===t.value&&(t.value=null),e[t.name]=t.value,e},{})}(t);return e.setProperties(t),t}},{key:"getFieldsWithValues",value:function(e){var a=this,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=t.exclude,i=void 0===n?[]:n,n=t.get_default_value,r=void 0===n||n,t=h(this.getEditingFields()),n=void 0;if(e instanceof f.Feature)n=e;else if(e instanceof ol.Feature)n=new f.Feature({feature:e});else{if(!e)return t;n=this.getFeatureById(e)}var o=n.getProperties();return t.forEach(function(t){var e;t.value=o[t.name],t._value=o[t.name],t.update=!1,t.visible=-1===i.indexOf(t.name),void 0===t.validate&&(t.validate={}),t.forceNull=!1,t.validate.valid=!0,t.validate._valid=!0,t.value_from_default_value=!1,t.get_default_value=r,t.validate.exclude_values=new Set,t.validate.unique=t.validate.unique||!1,t.validate.required=t.validate.required||!1,t.validate.mutually_valid=!0,t.validate.empty=!1,t.validate.message=null,t.input&&(e=a.getEditingFields().find(function(e){return e.name===t.name}).input.options,t.input.options.loading=e.loading||{state:null},t.input.options.values=e.values||[])}),t}},{key:"createNewFeature",value:function(){var e=new f.Feature({feature:new ol.Feature(this.getEditingFields().reduce(function(e,t){return e[t.name]=null,e},{}))});return e.setNew(),e}}]),n})(d.Layer)},{"g3w-constants":140,"lodash.clonedeep":"lodash.clonedeep","map/layers/feature":166,"map/layers/featuresstore":167,"map/layers/layer":170,"utils/XHR":196,"utils/getCatalogLayerById":218,"utils/promisify":247,"utils/waitFor":258}],173:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.VectorLayer=void 0;var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=function(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e};function i(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=g(e("g3w-object")),s=g(e("services/gui")),l=e("utils/isPointGeometryType"),u=e("utils/isLineGeometryType"),c=e("utils/isPolygonGeometryType"),d=g(e("map/layers/geo-mixin")),p=e("utils/promisify"),f=e("map/layers/layer"),e=e("map/layers/tablelayer");function g(e){return e&&e.__esModule?e:{default:e}}function h(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}a.VectorLayer=(e=>{var t=i;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=this,n=i;if(a instanceof n)return(a=((e,t)=>{if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")})(this,(i.__proto__||Object.getPrototypeOf(i)).call(this,e,t)))._mapLayer=null,a.type=f.Layer.LayerTypes.VECTOR,n=e.servertype+" "+(e.source&&e.source.type),a.setup(e,t),"G3WSUITE geojson"==n&&(a._g3w_geojson=!0,a.config.style=e.style,a.setup(e)),a;throw new TypeError("Cannot call a class as a function")}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e),r(i,[{key:"getEditingLayer",value:function(){return this.getMapLayer().getOLLayer()}},{key:"resetEditingSource",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];this.getMapLayer().resetSource(e)}},{key:"getEditingGeometryType",value:function(){return this.config.editing.geometrytype}},{key:"getMapLayer",value:function(){var e,t,a=this;return this._mapLayer||(this._mapLayer=new o.default,t=(e=this._g3w_geojson?this.get("style"):this.config.editing?this.config.editing.style:this.getCustomStyle())?new ol.style.Style(Object.entries(e||{}).reduce(function(e,t){var t=n(t,2),a=t[0],t=t[1];return"point"===a&&t.icon&&(e.image=new ol.style.Icon({src:t.icon.url,imageSize:t.icon.width})),"line"===a&&(e.stroke=new ol.style.Stroke({color:t.color,width:t.width})),"polygon"===a&&(e.fill=new ol.style.Fill({color:t.color})),e},{})):null,this._mapLayer._olLayer=new ol.layer.Vector({id:this.getId(),source:new ol.source.Vector({features:this._editor&&this._editor.getEditingSource().getFeaturesCollection()||[]})}),!(t=!(t=!t&&(0,l.isPointGeometryType)(this.getGeometryType())?new ol.style.Style({image:new ol.style.Circle({fill:new ol.style.Fill({color:this.getColor()}),radius:5})}):t)&&(0,u.isLineGeometryType)(this.getGeometryType())?new ol.style.Style({stroke:new ol.style.Stroke({color:this.getColor(),width:3})}):t)&&(0,c.isPolygonGeometryType)(this.getGeometryType())&&(t=new ol.style.Style({stroke:new ol.style.Stroke({color:"#000000",width:1}),fill:new ol.style.Fill({color:this.getColor()})}),this._mapLayer._olLayer.setOpacity(.6)),this._mapLayer._olLayer.setStyle(t),Object.assign(this._mapLayer,{_olLayer:this._mapLayer._olLayer,mapService:s.default.getService("map"),geometryType:this.getGeometryType(),geometrytype:null,type:null,crs:null,id:this.getId(),name:this._g3w_geojson&&this.getName()||"",style:e,color:this.getColor(),projection:(this._g3w_geojson?this:s.default.getService("map")).getProjection().getCode(),url:this._g3w_geojson?this.get("source").url:void 0,provider:this.getProvider("data"),getProvider:function(){return a._mapLayer.provider},resetSource:function(){return a._mapLayer.setSource(new ol.source.Vector({features:0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]}))},getFeatures:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return(0,p.$promisify)(h(function*(){return a._mapLayer.addFeatures(yield(0,p.promisify)(a._mapLayer.provider.getFeatures(e)))}))},addFeatures:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return a._mapLayer.getSource().addFeatures(e)},addFeature:function(e){return e&&a.getSource().addFeature(e)},getOLLayer:function(){return a._mapLayer._olLayer},getSource:function(){return a._mapLayer._olLayer.getSource()},setSource:function(e){return a._mapLayer._olLayer.setSource(e)},setStyle:function(e){return a._mapLayer._olLayer.setStyle(e)},getFeatureById:function(e){return e?a._mapLayer._olLayer.getSource().getFeatureById(e):null},isVisible:function(){return a._mapLayer._olLayer.getVisible()},setVisible:function(e){return a._mapLayer._olLayer.setVisible(e)},clear:function(){return a._mapLayer.getSource().clear()},addToMap:function(e){return e.addLayer(a._mapLayer._olLayer)}}),this._g3w_geojson&&this._mapLayer.getFeatures({url:this.get("source").url,mapProjection:s.default.getService("map").getProjection().getCode()})),this._mapLayer}}]),i})((0,d.default)(e.TableLayer))},{"g3w-object":144,"map/layers/geo-mixin":168,"map/layers/layer":170,"map/layers/tablelayer":172,"services/gui":188,"utils/isLineGeometryType":238,"utils/isPointGeometryType":240,"utils/isPolygonGeometryType":241,"utils/promisify":247}],174:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var n,i=e("utils/getCatalogLayerById");function r(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}a.default={methods:{autocompleteRequest:(n=r(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layerId,a=e.field,e=e.value,n=[];try{n=yield(0,i.getCatalogLayerById)(t).getFilterData({suggest:a+"|"+e,unique:a})}catch(e){}return n.map(function(e){return{id:e,text:e}})}),function(){return n.apply(this,arguments)})}}},{"utils/getCatalogLayerById":218}],175:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default={computed:{tabIndex:function(){return this.editable?0:-1},notvalid:function(){return!1===this.state.validate.valid},editable:function(){return this.state.editable},showhelpicon:function(){return this.state.help&&this.state.help.message.trim()},disabled:function(){return!this.editable||["loading","error"].includes(this.loadingState)},loadingState:function(){return this.state.input.options.loading?this.state.input.options.loading.state:null}},methods:{setLoading:function(e){this.state.input.options.loading.state=e?"loading":"ready"},showHideHelp:function(){this.state.help.visible=!this.state.help.visible},mobileChange:function(e){this.state.value=e.target.value,this.change()},change:function(){this.service.setEmpty(),this.service.validate(),this.service.setUpdate(),this.$emit("changeinput",this.state)},isVisible:function(){}}}},{}],176:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default={created:function(){this.__CLICK_EVENT={count:0,timeoutID:null}},methods:{handleClick:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=arguments[1];this.__CLICK_EVENT&&(this.__CLICK_EVENT.count+=1,this.__CLICK_EVENT.timeoutID||(this.__CLICK_EVENT.timeoutID=setTimeout(function(){void 0!==t[e.__CLICK_EVENT.count]&&t[e.__CLICK_EVENT.count].call(a),e.__resetClickMixin()},300)))},__resetClickMixin:function(){this.__CLICK_EVENT.count=0,this.__CLICK_EVENT.timeoutID=null},__clearClickMixin:function(){this.__resetClickMixin(),this.__CLICK_EVENT=null}},beforeDestroy:function(){this.__clearClickMixin()}}},{}],177:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default={methods:{getFieldService:function(){return void 0===this._fieldsService&&(this._fieldsService=e("gui/fields/fieldsservice")),this._fieldsService},getFieldType:function(e){return this.getFieldService().getType(e)},isSimple:function(e){return this.getFieldService().isSimple(e)},isLink:function(e){return this.getFieldService().isLink(e)},isImage:function(e){return this.getFieldService().isImage(e)},isPhoto:function(e){return this.getFieldService().isPhoto(e)},isVue:function(e){return this.getFieldService().isVue(e)},sanitizeFieldValue:function(e){return Array.isArray(e)&&!e.length?"":e}}}},{"gui/fields/fieldsservice":4}],178:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default={data:function(){return{valid:!1}},methods:{addToValidate:function(e){this.tovalidate.push(e)},changeInput:function(e){this.isValid(e)},isValid:function(e){var t,a=this;if(e)if(e.validate.mutually){if(!e.validate.required)if(e.validate.empty){e.value=null,e.validate.mutually_valid=!0,e.validate.valid=!0,e.validate._valid=!0;for(var n=[],i=e.validate.mutually.length;i--;){var r=e.validate.mutually[i];this.tovalidate[r].validate.empty||n.push(r)}n.length<2&&n.forEach(function(e){a.tovalidate[e].validate.mutually_valid=!0,a.tovalidate[e].validate.valid=!0,setTimeout(function(){a.tovalidate[e].validate.valid=a.tovalidate[e].validate._valid,a.state.valid=a.state.valid&&a.tovalidate[e].validate.valid})})}else e.validate._valid=e.validate.valid,e.validate.mutually_valid=e.validate.mutually.reduce(function(e,t){return e&&a.tovalidate[t].validate.empty},!0),e.validate.valid=e.validate.mutually_valid&&e.validate.valid}else e.validate.empty||!e.validate.min_field&&!e.validate.max_field||(t=e.validate.min_field||e.validate.max_field,e.validate.valid=e.validate.min_field?this.tovalidate[e.validate.min_field].validate.empty||+e.value>+this.tovalidate[e.validate.min_field].value:this.tovalidate[e.validate.max_field].validate.empty||+e.value<+this.tovalidate[e.validate.max_field].value,e.validate.valid&&(this.tovalidate[t].validate.valid=!0));this.valid=Object.values(this.tovalidate).reduce(function(e,t){return e&&t.validate.valid},!0)}},created:function(){this.tovalidate=[]},destroyed:function(){this.tovalidate=null}}},{}],179:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var e=e("services/gui"),n=(e=e)&&e.__esModule?e:{default:e};a.default={methods:{showLayer:function(){this.visible=!this.visible,this.layer.setVisible(this.visible)}},created:function(){var e=this.data,t=n.default.getService("map").getProjection().getCode(),a=void 0;switch(e.type){case"Point":case"MultiPoint":a=[new ol.style.Style({image:new ol.style.Circle({radius:6,fill:new ol.style.Fill({color:[255,255,255,1]}),stroke:new ol.style.Stroke({color:[0,0,0,1],width:2})})}),new ol.style.Style({image:new ol.style.Circle({radius:2,fill:new ol.style.Fill({color:[255,255,255,1]}),stroke:new ol.style.Stroke({color:[0,0,0,1],width:2})})})];break;case"Line":case"MultiLineString":case"Polygon":case"MultiPolygon":a=new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255, 255, 255, 0.3)"}),stroke:new ol.style.Stroke({color:[0,0,0,1],width:2})})}this.layer=new ol.layer.Vector({source:new ol.source.Vector({features:(new ol.format.GeoJSON).readFeatures(e,{featureProjection:t})}),visible:!!this.visible,style:a}),n.default.getService("map").getMap().addLayer(this.layer)},beforeDestroy:function(){n.default.getService("map").getMap().removeLayer(this.layer)}}},{"services/gui":188}],180:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.mixins=a.autocompleteMixin=a.baseInputMixin=a.widgetMixins=a.formInputsMixins=a.select2Mixin=a.selectMixin=a.resizeMixin=a.geoMixin=a.mediaMixin=a.fieldsMixin=void 0;var n=p(e("mixins/autocomplete")),i=p(e("mixins/fields")),r=p(e("mixins/media")),o=p(e("mixins/geo")),s=p(e("mixins/resize")),l=p(e("mixins/select")),u=p(e("mixins/select2")),c=p(e("mixins/form-inputs")),d=p(e("mixins/widget")),e=p(e("mixins/base-input"));function p(e){return e&&e.__esModule?e:{default:e}}var f={autocompleteMixin:n.default,fieldsMixin:i.default,mediaMixin:r.default,geoMixin:o.default,resizeMixin:s.default,selectMixin:l.default,select2Mixin:u.default,formInputsMixins:c.default,widgetMixins:d.default,baseInputMixin:e.default};a.fieldsMixin=i.default,a.mediaMixin=r.default,a.geoMixin=o.default,a.resizeMixin=s.default,a.selectMixin=l.default,a.select2Mixin=u.default,a.formInputsMixins=c.default,a.widgetMixins=d.default,a.baseInputMixin=e.default,a.autocompleteMixin=n.default,a.mixins=f,a.default=f},{"mixins/autocomplete":174,"mixins/base-input":175,"mixins/fields":177,"mixins/form-inputs":178,"mixins/geo":179,"mixins/media":181,"mixins/resize":182,"mixins/select":183,"mixins/select2":184,"mixins/widget":185}],181:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};a.default={computed:{filename:function(){return this.value&&this.value.split("/").pop()}},methods:{isMedia:function(e){return!(!e||"object"!==(void 0===e?"undefined":n(e))||Object!==e.constructor||!e.mime_type)},getMediaType:function(e){var t={type:null,options:{}};switch(e){case"image/gif":case"image/png":case"image/jpeg":case"image/bmp":t.type="image";break;case"application/pdf":t.type="pdf";break;case"video/mp4":case"video/ogg":case"video/x-ms-wmv":case"video/x-msvideo":case"video/quicktime":t.type="video",t.options.format=e;break;case"application/gzip":case"application/zip":t.type="zip";break;case"application/msword":case"application/vnd.oasis.opendocument.text":t.type="text";break;case"application/vnd.ms-office":case"application/vnd.oasis.opendocument.spreadsheet":t.type="excel";break;case"application/vnd.openxmlformats-officedocument.presentationml.presentation":case"application/vnd.ms-powerpoint":case"application/vnd.oasis.opendocument.presentation":t.type="ppt";break;default:t.type="unknow"}return t}}}},{}],182:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var n=e("services/gui"),i=(n=n)&&n.__esModule?n:{default:n},n=e("utils/throttle"),e=e("utils/debounce");function r(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}var o,s={throttle:n.throttle,debounce:e.debounce};a.default={created:function(){var e=this.delayType&&s[this.delayType]||s.throttle;this.delayResize=this.resize?e(this.resize.bind(this),this.delayTime):null,i.default.on("resize",this.delayResize)},mounted:(o=r(function*(){yield this.$nextTick(),this.resize&&this.resize()}),function(){return o.apply(this,arguments)}),beforeDestroy:function(){i.default.off("resize",this.delayResize),this.delayResize=null,this.delayTime=null}}},{"services/gui":188,"utils/debounce":213,"utils/throttle":256}],183:[function(e,t,a){function n(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}var i,r;Object.defineProperty(a,"__esModule",{value:!0}),a.default={methods:{getLanguage:function(){return window.initConfig.user.i18n||"en"},changeSelect:(r=n(function*(e){this.state.value="null"===e?null:e,yield this.$nextTick(),this.change()}),function(e){return r.apply(this,arguments)}),getValue:function(e){return null===e?"null":e},resetValues:function(){this.state.input.options.values.splice(0)}},computed:{autocomplete:function(){return"select_autocomplete"===this.state.input.type&&this.state.input.options.usecompleter}},watch:{notvalid:(i=n(function*(e){yield this.$nextTick(),this.select2&&this.select2.data("select2").$container[e?"addClass":"removeClass"]("input-error-validation")}),function(e){return i.apply(this,arguments)})}}},{}],184:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var n=i(e("store/application")),e=i(e("mixins/resize"));function i(e){return e&&e.__esModule?e:{default:e}}a.default={mixins:[e.default],methods:{setValue:function(){this.select2.val(this.state.value).trigger("change")},resize:function(){this.select2&&!n.default.ismobile&&this.select2.select2("close")}},beforeDestroy:function(){this.select2&&(this.select2.select2("destroy"),this.select2.off(),this.select2=null)}}},{"mixins/resize":182,"store/application":193}],185:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default={data:function(){return{changed:!1}},methods:{widgetChanged:function(){this.changed=!0,this.change()},stateValueChanged:function(e){}},watch:{"state.value":function(e){this.changed?this.changed=!1:this.stateValueChanged(e)}}}},{}],186:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var n=e("g3w-constants"),e=e("g3w-object");e=new((e=e)&&e.__esModule?e:{default:e}).default({setters:{online:function(){},offline:function(){}}});e.version=n.APP_VERSION,a.default=e},{"g3w-constants":140,"g3w-object":144}],187:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},d=e("g3w-constants"),p=n(e("store/application")),f=n(e("services/gui")),g=e("utils/groupBy"),h=e("utils/getMapLayersByFilter"),r=e("utils/XHR"),y=e("utils/promisify");function n(e){return e&&e.__esModule?e:{default:e}}function m(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}var i,o,s,l,u,v,_,b,w,x,k,S,E=e("g3w-i18n").t,L=(i=m(function*(){var e=yield Promise.allSettled(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]);return e.some(function(e){return"fulfilled"===e.status})?e.filter(function(e){return"fulfilled"===e.status}).map(function(e){return e.value}):Promise.reject(e.filter(function(e){return"rejected"===e.status}).map(function(e){return e.reason}))}),function(){return i.apply(this,arguments)});a.default={getData:(S=m(function*(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=t.inputs,t=t.outputs,t=void 0===t?{}:t,e=this[e](void 0===a?{}:a);return t&&f.default.outputDataPlace(e,t),yield yield e}),function(e){return S.apply(this,arguments)}),"query:coordinates":(k=m(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.coordinates,a=e.layerIds,a=void 0===a?[]:a,n=e.multilayers,n=void 0!==n&&n,i=e.query_point_tolerance,i=void 0===i?d.QUERY_POINT_TOLERANCE:i,r=e.addExternal,r=void 0===r||r,e=e.feature_count,o=f.default.getService("catalog").state.external.vector.some(function(e){return e.selected}),s=(0,h.getMapLayersByFilter)({QUERYABLE:!0,SELECTED_OR_ALL:0===a.length,VISIBLE:!0,IDS:a.length?a.map(function(e){return e}):void 0});try{return{result:!0,type:"ows",query:{coordinates:t,type:"coordinates",external:{add:(o&&!(0<a.length)||1!==s.length||!s[0].isSelected())&&r,filter:{SELECTED:o}}},data:((!o||0<a.length)&&(yield(0,y.promisify)(this.getQueryLayersPromisesByCoordinates(s,{multilayers:n,feature_count:e,query_point_tolerance:i,coordinates:t})))||[]).flatMap(function(e){e=e.data;return void 0===e?[]:e})}}catch(e){throw e}}),function(){return k.apply(this,arguments)}),"query:bbox":(x=m(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.bbox,a=e.feature_count,a=void 0===a?p.default.project.state.feature_count||5:a,n=e.filterConfig,n=void 0===n?{}:n,i=e.multilayers,i=void 0!==i&&i,r=e.condition,r=void 0===r?{filtrable:{ows:"WFS"}}:r,o=e.excludeSelected,o=void 0===o?null:o,s=e.addExternal,s=void 0===s||s,e=e.layersFilterObject,e=void 0===e?{SELECTED_OR_ALL:!0,FILTERABLE:!0,VISIBLE:!0}:e,l=f.default.getService("catalog").state.external.vector.some(function(e){return e.selected}),o=l||"boolean"==typeof o&&o;try{return{result:!0,type:"ows",query:{bbox:t,type:"bbox",filterConfig:n,external:{add:s,filter:{SELECTED:o}}},data:(!l&&(yield this.getQueryLayersPromisesByGeometry((0,h.getMapLayersByFilter)(e,r),{geometry:ol.geom.Polygon.fromExtent(t),feature_count:a,filterConfig:n,multilayers:i,projection:f.default.getService("map").getMap().getView().getProjection()}))||[]).flatMap(function(e){e=e.data;return void 0===e?[]:e})}}catch(e){throw e}}),function(){return x.apply(this,arguments)}),"query:polygon":(w=m(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.feature,a=e.feature_count,a=void 0===a?p.default.project.state.feature_count||5:a,n=e.filterConfig,n=void 0===n?{}:n,i=e.multilayers,i=void 0!==i&&i,r=e.condition,r=void 0===r?{filtrable:{ows:"WFS"}}:r,o=e.layerName,o=void 0===o?"":o,s=e.excludeSelected,s=void 0===s?null:s,l=e.external,l=void 0===l?{add:!0,filter:{SELECTED:!1}}:l,e=e.type,e=void 0===e?"polygon":e,u=t.getGeometry();try{return{result:!0,type:"ows",error:!u,query:{fid:f.default.getService("catalog").state.external.vector.some(function(e){return e.selected})?t.getId():t.get(d.G3W_FID),geometry:u,layerName:o,type:e,filterConfig:n,external:l},usermessage:!u&&{type:"warning",message:o+" - "+E("sdk.mapcontrols.querybypolygon.no_geometry"),messagetext:!0,autoclose:!1},data:((yield this.getQueryLayersPromisesByGeometry((0,h.getMapLayersByFilter)(c({},"boolean"==typeof s?{SELECTED:!s}:{SELECTED_OR_ALL:!0},{FILTERABLE:!0,VISIBLE:!0}),r),{geometry:u,multilayers:i,feature_count:a,filterConfig:n,projection:p.default.project.getProjection()}))||[]).flatMap(function(e){e=e.data;return void 0===e?[]:e})}}catch(e){throw e}}),function(){return w.apply(this,arguments)}),"search:features":(b=m(function*(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{layer:layer,filter:filter,raw:!1,queryUrl:queryUrl,feature_count:feature_count,formatter:1,ordering:ordering};return m(function*(){var e=t.layer,a=((e,t)=>{var a,n={};for(a in e)0<=t.indexOf(a)||Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a]);return n})(t,["layer"]);return a.filter=[].concat(a.filter),{data:(yield Promise.allSettled([].concat(e).map(function(e,t){return e.searchFeatures(c({},a,{filter:a.filter[t]}))}))).filter(function(e){return"fulfilled"===e.status}).map(function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).value;return t.raw?{data:e}:Array.isArray(e.data)&&0<e.data.length?e.data[0]:void 0}),query:{type:"search",search:t.filter},type:"api"}})()}),function(){return b.apply(this,arguments)}),"search:fids":(_=m(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layer,a=e.formatter,a=void 0===a?0:a,e=e.fids,e=void 0===e?[]:e,n=[];try{n=(t&&(yield t.getFeatureByFids({fids:e,formatter:a}))||[]).map(function(e){var t=void 0!==e.properties?e.properties:{},a=(t[d.G3W_FID]=e.id,new ol.Feature(e.geometry&&new ol.geom[e.geometry.type](e.geometry.coordinates)));return a.setProperties(t),a.setId(e.id),a})}catch(e){}return{data:[{layer:t,features:n}],query:{type:"search"}}}),function(){return _.apply(this,arguments)}),"search:layersfids":(v=m(function*(){var a=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layers,t=void 0===t?[]:t,n=e.fids,i=void 0===n?[]:n,n=e.formatter,r=void 0===n?0:n,e=[];try{e=(yield Promise.all(t.map(function(e,t){return a["search:fids"]({layer:e,fids:i[t],formatter:r})}))).map(function(e){return e.data})}catch(e){}return{data:e,query:{type:"search"}}}),function(){return v.apply(this,arguments)}),"expression:expression":(u=m(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};try{var t=yield r.XHR.post({url:""+p.default.project.getUrl("vector_data")+e.layer_id+"/",contentType:"application/json",data:JSON.stringify(e)});return t.result?t.vector.data.features||[]:null}catch(e){return Promise.reject(e)}}),function(){return u.apply(this,arguments)}),"expression:expression_eval":function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return r.XHR.post({url:"/api/expression_eval/"+p.default.project.getId()+"/",contentType:"application/json",data:JSON.stringify(e)})},"proxy:wms":(l=m(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.url,a=e.method,a=void 0===a?"GET":a,n=e.params,i=void 0===n?{}:n,n=e.headers,e=void 0===n?{}:n;"GET"===a&&(t=new URL(t),Object.keys(i).forEach(function(e){return t.searchParams.set(e,i[e])}),t=t.toString());try{return{response:yield r.XHR.post({data:JSON.stringify({url:t,params:i,headers:e,method:a}),contentType:"application/json",url:""+window.initConfig.proxyurl}),data:JSON.stringify({url:t,params:i,headers:e,method:a})}}catch(e){}}),function(){return l.apply(this,arguments)}),"proxy:data":function(){},"ows:wmsCapabilities":(s=m(function*(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).url;try{return yield r.XHR.post({url:""+window.initConfig.interfaceowsurl,contentType:"application/json",data:JSON.stringify({url:e,service:"wms"})})}catch(e){}}),function(){return s.apply(this,arguments)}),getQueryLayersPromisesByCoordinates:function(e){var t,a,n,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},r=i.coordinates,o=i.feature_count,s=void 0===o?10:o,o=i.query_point_tolerance,l=void 0===o?d.QUERY_POINT_TOLERANCE:o,o=i.multilayers,u=void 0!==o&&o,o=i.reproject,c=void 0===o||o;return 0===e.length?(0,y.$promisify)(Promise.resolve(e)):(i=f.default.getService("map").getMap(),t=i.getSize(),a=i.getView().getProjection(),n=i.getView().getResolution(),(0,y.$promisify)(m(function*(){return yield L(Object.values(u?(0,g.groupBy)(e,function(e){return e.getInfoFormat()+":"+e.getInfoUrl()+":"+e.getMultiLayerId()}):e).map(function(e){return(0,y.promisify)([].concat(e)[0].query(u?{feature_count:s,coordinates:r,query_point_tolerance:l,mapProjection:a,size:t,resolution:n,reproject:c,layers:e}:{feature_count:s,coordinates:r,query_point_tolerance:l,mapProjection:a,size:t,resolution:n}))}))})))},getQueryLayersPromisesByGeometry:(o=m(function*(e){var n,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=t.geometry,a=t.projection,r=t.filterConfig,o=void 0===r?{}:r,r=t.multilayers,s=void 0!==r&&r,r=t.feature_count,l=void 0===r?10:r;return 0===e.length?[]:(n=a.getCode(),yield L(Object.values(s?(0,g.groupBy)(e,function(e){return e.getMultiLayerId()+"_"+e.getProjection().getCode()}):e).map(function(e){var t=[].concat(e)[0],a=t.getProjection().getCode(),a={config:o,type:"geometry",value:n===a?i:i.clone().transform(n,a)};return(0,y.promisify)(t.query(s?{filter:a,feature_count:l,layers:e}:{filter:a,feature_count:l,filterConfig:o}))})))}),function(e){return o.apply(this,arguments)})}},{"g3w-constants":140,"g3w-i18n":143,"services/gui":188,"store/application":193,"utils/XHR":196,"utils/getMapLayersByFilter":225,"utils/groupBy":234,"utils/promisify":247}],188:[function(p,e,t){Object.defineProperty(t,"__esModule",{value:!0});var f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},h=function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e};function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}a=L(function*(){var t;yield Promise.allSettled((_.default.contentsdata||[]).map((t=L(function*(e){e.content instanceof m.default||e.content instanceof v.default?yield(0,k.promisify)(e.content.unmount()):$(GUI.getComponent("contents").parent).empty()}),function(e){return t.apply(this,arguments)}))),_.default.contentsdata.splice(0,_.default.contentsdata.length)});var a,y=function(){return a.apply(this,arguments)},d=p("g3w-constants"),i=r(p("g3w-object")),m=r(p("g3w-component")),v=r(p("g3w-panel")),_=r(p("store/application")),b=r(p("services/iframe")),w=p("utils/getUniqueDomId"),x=p("utils/toRawType"),k=p("utils/promisify"),S=p("utils/getListableProjects"),E=p("utils/getProjectUrl");function r(e){return e&&e.__esModule?e:{default:e}}function L(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}var T={},C={navbar:null,sidebar:null,viewport:null};function M(){var e=_.default.viewport,t=e.primaryView,a="map"===e.primaryView?"content":"map",n=$(".main-sidebar"),i=n.length&&n.offset().left,n=(n.length&&n[0].getBoundingClientRect().width)+i,i=$("#app")[0].getBoundingClientRect().width-n,n=$(document).innerHeight()-$(".navbar-header").innerHeight(),r=void 0,o=void 0,s=void 0,l=void 0,u=_.default.gui.layout[_.default.gui.layout.__current].rightpanel[("h"===e.split?"width":"height")+"_100"],c=_.default.gui.layout[_.default.gui.layout.__current].rightpanel["h"===e.split?"width":"height"],u=(100===e.secondaryPerc||u?100:c)/100,o="h"===e.split?(r=i-(s=e.secondaryVisible?Math.max(i*u,d.VIEWPORT.resize.content.min):0),l=n):(s=i,l=e.secondaryVisible?Math.max(n*u,d.VIEWPORT.resize.content.min):0,r=e.secondaryVisible&&1==u?0:i,n-l);e[t].sizes.width=r,e[t].sizes.height=o,e[a].sizes.width=s,e[a].sizes.height=l}function P(){var e=$(".content"),t=0,a=$(".sidebar-aside-toggle"),n=_.default.gui.layout[_.default.gui.layout.__current].rightpanel[("h"===_.default.viewport.split?"width":"height")+"_100"];return e&&_.default.viewport.secondaryVisible&&n?a&&a.is(":visible")&&(n=a.outerWidth(),e.css("padding-left",n+5),t=n-5):(n=a.outerWidth(),e.css("padding-left",100===_.default.viewport.secondaryPerc?n+5:15)),{reducedWidth:t,reducedHeight:0}}t.default=new((e=>{var t,a,n,i,r,o,s,l,u=c;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);function c(e){var t,a;if(this instanceof c)return(t=((e,t)=>{if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")})(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,e))).setters={setContent:(a=L(function*(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=(this.emit("opencontent",!0),this._closeUserMessage&&this.closeUserMessage(),t.content=t.content||null,t.title=t.title||"",t.push=(!0===t.push||!1===t.push)&&t.push,t.perc=isMobile.any?100:t.perc,t.split=t.split||"h",t.backonclose=(!0===t.backonclose||!1===t.backonclose)&&t.backonclose,t.showtitle=!0!==t.showtitle&&!1!==t.showtitle||t.showtitle,_.default.gui.layout[_.default.gui.layout.__current].rightpanel["h"===_.default.viewport.split?"width":"height"]),a=(t.perc=void 0!==t.perc?t.perc:a,t.push=t.push||!1,100===t.perc?"show-content-full":"show-content"),n=(Object.assign(_.default.viewport.content,{title:t.title,split:void 0!==t.split?t.split:null,closable:void 0===t.closable||t.closable,backonclose:void 0===t.backonclose||t.backonclose,contentsdata:this.getComponent("contents").contentsdata,style:void 0!==t.style?t.style:{},headertools:void 0!==t.headertools?t.headertools:[],showgoback:void 0===t.showgoback||t.showgoback}),this._showView("content",t),this.getComponent("contents")),i=(t.push||(yield y()),t.content),t=Object.assign(t,{parent:n.internalComponent.$el,append:!0});n.parent=t.parent,i instanceof jQuery||"string"==typeof i?(e="string"==typeof i?$(i).length?$("<div> "+i+" </div>"):$(i):i,$(n.parent).append(e),_.default.contentsdata.push({content:e,options:t})):(i.mount&&"function"==typeof i.mount?(-1!==(e=_.default.contentsdata.findIndex(function(e){return e.content.getId&&i.getId()===e.content.getId()}))&&(yield(0,k.promisify)(_.default.contentsdata[e].content.unmount()),_.default.contentsdata.splice(e,1)),yield(0,k.promisify)(i.mount(n.parent,t.append||!1)),$(n.parent).localize()):n.parent.appendChild(i),_.default.contentsdata.push({content:i,options:t})),Array.from(n.internalComponent.$el.children).forEach(function(e,t,a){return e.style.display=t===a.length-1?"block":"none"}),n.setOpen(!0),this._layoutComponents(a)}),function(){return a.apply(this,arguments)})},t.isready=!1,t.push_content=!1,t._closeUserMessage=!0,t.dialog=bootbox,t.notify={warning:function(e){t.showUserMessage({type:"warning",message:e,autoclose:1<arguments.length&&void 0!==arguments[1]&&arguments[1]})},error:function(e){t.showUserMessage({type:"alert",message:e,autoclose:1<arguments.length&&void 0!==arguments[1]&&arguments[1]})},info:function(e){t.showUserMessage({type:"info",message:e,autoclose:1<arguments.length&&void 0!==arguments[1]&&arguments[1]})},success:function(e){t.showUserMessage({type:"success",message:e,autoclose:!0})}},t.currentoutputplace="gui",t;throw new TypeError("Cannot call a class as a function")}function d(){return s.apply(this,arguments)}return u.prototype=Object.create(e&&e.prototype,{constructor:{value:u,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(u,e):u.__proto__=e),h(c,[{key:"addComponent",value:function(e,t){var a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{},n=!0;return t&&-1<Object.keys(C).indexOf(t)&&("sidebar"===t?(isMobile.any&&!1===e.mobile||(_.default.sidebar.components.push(e),new(Vue.extend(p("components/SidebarItem.vue")))({component:e,opts:a}).$mount()),n=!0):C[t]&&(n=C[t].addComponents([e],a))),n&&this.setComponent(e),!0}},{key:"setPushContent",value:function(){this.push_content=0<arguments.length&&void 0!==arguments[0]&&arguments[0]}},{key:"setComponent",value:function(e){var t=e.getId();void 0===T[t]&&(T[t]=e)}},{key:"getComponent",value:function(e){return T[e]}},{key:"getComponents",value:function(){return T}},{key:"ready",value:function(){var t=this,a=!1,n=!1;function i(){n=!0,e()}var e=function e(){!0===n?(a=!(n=!1),t._layout("resize"),requestAnimationFrame(e)):a=!1};_.default.viewport.SIDEBARWIDTH=this.getSize({element:"sidebar",what:"width"}),this._layout(),$(window).resize(function(){!1===a&&i()}),$(".main-sidebar").on("transitionend",function(e){e.target===this&&($(this).trigger("trans-end"),i())}),this.emit("ready"),this.isready=!0}},{key:"isReady",value:function(){var t=this;return new Promise(function(e){return t.isready?e():t.once("ready",e)})}},{key:"getService",value:function(e){e=this.getComponent(e);return e&&e.getService()}},{key:"downloadWrapper",value:(l=L(function*(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this.setLoadingContent(!0);try{yield e(t)}catch(e){this.showUserMessage({type:"alert",message:e||"server_error",textMessage:!!e})}_.default.download=!0,_.default.download=!1,this.setLoadingContent(!1)}),function(e){return l.apply(this,arguments)})},{key:"isMobile",value:(s=function(){return isMobile.any},d.toString=function(){return s.toString()},d)},{key:"getFontClass",value:function(e){return Vue.prototype.g3wtemplate.getFontClass(e)}},{key:"getResourcesUrl",value:function(){return window.initConfig.staticurl+window.initConfig.client}},{key:"outputDataPlace",value:(o=L(function*(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=(0,w.getUniqueDomId)();if("iframe"===this.currentoutputplace)return b.default.outputDataPlace(e,t);this.setLoadingContent(!0);var n=["function","boolean"].includes(g(t.show)),n=(Object.assign(t,f({condition:!n||t.show,add:!1},n?{}:t.show)),this.pending_output&&(yield this.pending_output()),t.add||this.showQueryResults(t.title||""),{}),i=!1;this.pending_output=L(function*(){return i=!0}),this.crid=a;try{i||(n=yield e),!i&&t.before&&(yield t.before(n)),!i&&n.usermessage&&this.showUserMessage({type:n.usermessage.type,message:n.usermessage.message,autoclose:n.usermessage.autoclose});var r=i||"function"!=typeof t.condition?!1!==t.condition:t.condition(n);!i&&r&&(this.getService("queryresults")||this.showQueryResults(t.title||"")).setQueryResponse(n,{add:t.add}),i||r||(this.pending_output=this.closeContent.bind(this)),!i&&t.after&&t.after(n)}catch(e){this.showUserMessage({type:"alert",message:function e(t){var a,n=(0,x.toRawType)(t);return"Error"===n?"CLIENT - "+t.message:"Object"===n&&t.responseJSON&&!1===t.responseJSON.result?((a=t.responseJSON.error).code||"").toUpperCase()+" "+(a.data||"")+" "+(a.message||""):"Object"===n&&t.responseText?t.responseText:"Array"===n?t.map(e).join(" "):t||"server_error"}(e),textMessage:!0}),yield this.closeContent()}this.pending_output=null,this.setLoadingContent(a!==this.crid)}),function(e){return o.apply(this,arguments)})},{key:"showForm",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=p("components/g3w-form").FormComponent,t=new(e.formComponent||t)(e);return this.setContent({perc:e.perc,content:t,split:void 0!==e.split?e.split:"h",crumb:e.crumb,push:!!e.push,showgoback:!!e.showgoback,closable:!1}),t.getService()}},{key:"closeForm",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).pop,e=void 0!==e&&e,t=(this.emit("closeform",!1),!e&&_.default.viewport.content.backonclose&&1<_.default.viewport.content.contentsdata.length);(e||t)&&this.popContent(),e||t||this.closeContent(),this.setModal(!1)}},{key:"disableElement",value:function(e){var t=e.element,e=e.disable;$(t)[e?"addClass":"removeClass"]("g3w-disabled")}},{key:"disableContent",value:function(e){_.default.viewport.content.disabled=e}},{key:"disablePanel",value:function(){this.disableElement({element:"#g3w-sidebarpanel-placeholder",disable:0<arguments.length&&void 0!==arguments[0]&&arguments[0]})}},{key:"closeSideBar",value:function(){_.default.sidebar.components.forEach(function(e){return e.getOpen()&&e.state.closewhenshowviewportcontent&&e.collapsible&&e.click({open:!1})})}},{key:"showQueryResults",value:function(e,t){var a=this.getComponent("queryresults").getService();return a.clearState(),t&&a.setQueryResponse(t),this.setContent({content:this.getComponent("queryresults"),title:"info.title",crumb:{title:"info.title",trigger:null},push:this.push_content,post_title:e,perc:isMobile.any?100:void 0}),a}},{key:"addNavbarItem",value:function(e){_.default.navbaritems.push(e)}},{key:"showPanel",value:(r=L(function*(t){var e,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=(_.default.sidebar.title=t.title,_.default.sidebar.parent="#g3w-sidebarpanel-placeholder",_.default.sidebar.contentsdata.at(-1)),n=(n&&$(n.content.internalPanel.$el).hide(),f({parent:"#g3w-sidebarpanel-placeholder"},a)),a=_.default.sidebar.parent,i=_.default.sidebar.contentsdata;t instanceof jQuery||"string"==typeof t?(e="string"==typeof t?$(t).length?$("<div> "+t+" </div>"):$(t):t,$(a).append(e),i.push({content:e,options:n})):(t.mount&&"function"==typeof t.mount?(-1!==(e=i.findIndex(function(e){return e.content.getId&&t.getId()===e.content.getId()}))&&(yield(0,k.promisify)(i[e].content.unmount()),i.splice(e,1)),yield(0,k.promisify)(t.mount(a,n.append||!1)),$(a).localize()):a.appendChild(t),i.push({content:t,options:n}))}),function(e){return r.apply(this,arguments)})},{key:"closePanel",value:(i=L(function*(){var e,t=_.default.sidebar.contentsdata;t.length<=0||((e=t.slice(-1)[0].content)instanceof m.default||e instanceof v.default?yield(0,k.promisify)(e.unmount()):$(_.default.sidebar.parent).empty(),t.pop(),(e=_.default.sidebar.contentsdata.at(-1))&&($(e.content.internalPanel.$el).show(),_.default.sidebar.title=e.content.title))}),function(){return i.apply(this,arguments)})},{key:"showUserMessage",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.title,a=e.subtitle,n=e.message,i=e.type,r=e.position,o=e.size,s=e.draggable,l=e.duration,u=e.textMessage,c=void 0!==u&&u,d=e.closable,p=e.autoclose,u=e.hooks,f=void 0===u?{}:u,u=e.iconClass,g=void 0===u?null:u;return this.closeUserMessage(),setTimeout(function(){Object.assign(_.default.viewport.usermessage,{id:(0,w.getUniqueDomId)(),show:!0,message:n,textMessage:c,title:t,subtitle:a,position:r,duration:l,type:i,size:o,autoclose:p,closable:d,draggable:s,hooks:f,iconClass:g})}),_.default.viewport.usermessage}},{key:"closeUserMessage",value:function(){Object.assign(_.default.viewport.usermessage,{id:null,show:!1,textMessage:!1,message:""})}},{key:"showModalDialog",value:function(){return this.dialog.dialog(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}},{key:"showSpinner",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.container||"body",a=e.id||"loadspinner",n=e.where||"prepend",i=e.style||"",r=e.transparent?"background-color: transparent":"",e=e.center?"margin: auto":"";$("#"+a).length||$(t)[n].call($(t),'<div id="'+a+'" class="spinner-wrapper '+i+'" style="'+r+'"><div class="spinner '+i+'" style="'+e+'"></div></div>')}},{key:"hideSpinner",value:function(){$("#"+(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"loadspinner")).remove()}},{key:"toggleSidebar",value:function(){!document.body.classList.contains("sidebar-open")&&(document.body.classList.contains("sidebar-collapse")||window.innerWidth<=767)?this.showSidebar():this.hideSidebar()}},{key:"showFullModal",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.element,e=e.show,e=void 0===e||e;$(void 0===t?"#full-screen-modal":t).modal(e?"show":"hide")}},{key:"disableSideBar",value:function(){_.default.gui.sidebar.disabled=!(0<arguments.length&&void 0!==arguments[0])||arguments[0]}},{key:"showContent",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this.setLoadingContent(!1),e.perc=isMobile.any?100:e.perc,this.setContent(e),!0}},{key:"pushContent",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.perc=isMobile.any?100:e.perc,e.push=!0,this.setContent(e)}},{key:"getContentLength",value:function(){return _.default.viewport.content.contentsdata.length}},{key:"setCurrentContentOptions",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=_.default.viewport.content.contentsdata.at(-1)||null;t&&e.title&&(t.options.title=e.title),t&&e.crumb&&(t.options.crumb=e.crumb)}},{key:"getCurrentContent",value:function(){return _.default.viewport.content.contentsdata.at(-1)||null}},{key:"getProjectMenuDOM",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.projects,t=void 0===t?[]:t,a=e.host,e=e.cbk,n={projects:t&&Array.isArray(t)&&t,cbk:e,host:a};return new m.default(f({},n,{id:"projectsmenu",title:n.title||"menu",internalComponent:new(Vue.extend(p("components/ProjectsMenu.vue")))({host:n.host,state:{menuitems:(n.projects||(0,S.getListableProjects)()).map(function(e){return{title:e.title,description:e.description,thumbnail:e.thumbnail,gid:e.gid,cbk:n.cbk||function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return(0,k.$promisify)(L(function*(){var e=c.getService("map").addMapExtentUrlParameterToUrl((0,E.getProjectUrl)(t.gid));try{history.replaceState(null,null,e)}catch(e){}location.replace(e)}))}}})}})})).getInternalComponent().$mount().$el}},{key:"toggleUserMessage",value:function(){this._closeUserMessage=!(0<arguments.length&&void 0!==arguments[0])||arguments[0]}},{key:"hideClientMenu",value:function(){window.initConfig.user=null}},{key:"hideChangeMaps",value:function(){window.initConfig.projects=[]}},{key:"setLoadingContent",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];return(_.default.viewport.content.loading=e)&&new Promise(function(e){return setTimeout(e,200)})}},{key:"toggleFullViewContent",value:function(){var e=_.default.viewport,t=_.default.gui.layout[_.default.gui.layout.__current].rightpanel;t[("h"===e.split?"width":"height")+"_100"]=!t[("h"===e.split?"width":"height")+"_100"],this._layoutComponents()}},{key:"resetToDefaultContentPercentage",value:function(){var e=_.default.viewport,t=_.default.gui.layout[_.default.gui.layout.__current].rightpanel;t["h"===e.split?"width":"height"]=t[("h"===e.split?"width":"height")+"_default"],t[("h"===e.split?"width":"height")+"_100"]=!1,this._layoutComponents()}},{key:"hideContent",value:function(e){var t=_.default.gui.layout[_.default.gui.layout.__current].rightpanel["h"===_.default.viewport.split?"width":"height"];return _.default.viewport.secondaryVisible=!e,this._layout("hide-content"),t}},{key:"closeContent",value:(n=L(function*(){this.emit("closecontent",!1);var e=_.default.viewport,t=0<e.content.contentsdata.length;return t&&(this.getComponent("contents").setOpen(!1),y()),t&&"map"===e.primaryView&&(yield y(),e.secondaryPerc=0),t&&(e.secondaryVisible=!1,this._layout("close-content"),yield Vue.nextTick()),this.getComponent("map")}),function(){return n.apply(this,arguments)})},{key:"popContent",value:(a=L(function*(){var e,t;return _.default.viewport.content.contentsdata.length?(t=(e=this.getComponent("contents").contentsdata.at(-2)).options,Object.assign(_.default.viewport.content,{title:t.title,split:void 0!==t.split?t.split:null,closable:void 0===t.closable||t.closable,backonclose:void 0===t.backonclose||t.backonclose,contentsdata:this.getComponent("contents").contentsdata,style:void 0!==t.style?t.style:{},headertools:void 0!==t.headertools?t.headertools:[],showgoback:void 0===t.showgoback||t.showgoback}),this._showView("content",e.options),_.default.contentsdata.length<=0?void 0:((t=_.default.contentsdata.slice(-1)[0].content)instanceof m.default||t instanceof v.default?yield(0,k.promisify)(t.unmount()):$(this.getComponent("contents").parent).empty(),_.default.contentsdata.pop(),Array.from(this.getComponent("contents").internalComponent.$el.children).forEach(function(e,t,a){return e.style.display=t===a.length-1?"block":"none"}),_.default.viewport.secondaryPerc=e.options.perc,this._layout("pop-content"),this.getComponent("contents").contentsdata.at(-1))):Promise.reject()}),function(){return a.apply(this,arguments)})},{key:"isSidebarVisible",value:function(){return!document.body.classList.contains("sidebar-collapse")}},{key:"setModal",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=arguments[1],a=this.getService("map");e?a.startDrawGreyCover(t):a.stopDrawGreyCover()}},{key:"showSidebar",value:function(){document.body.classList.add("sidebar-open"),document.body.classList.remove("sidebar-collapse"),_.default.gui.sidebar.open=!0}},{key:"hideSidebar",value:function(){document.body.classList.remove("sidebar-open"),document.body.classList.add("sidebar-collapse"),_.default.gui.sidebar.open=!1}},{key:"getSize",value:function(e){var t=e.element,e=e.what;if(t&&e)return _.default.sizes[t][e]}},{key:"_showView",value:(t=L(function*(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=_.default.viewport,n=t.perc,n=void 0===n?e==a.primaryView?100:50:n,i=t.split,i=void 0===i?"h":i;a[e].aside=e!=a.primaryView||void 0!==t.aside&&t.aside,0<(e==a.primaryView?100-n:n)?(a.secondaryVisible=!0,a.split=void 0!==i?i:a.split,a.secondaryPerc=void 0!==n?n:a.perc,this._layout()):("map"===a.primaryView&&(yield y(),a.secondaryPerc=0),a.secondaryVisible=!1,this._layout(),yield Vue.nextTick())}),function(e){return t.apply(this,arguments)})},{key:"_layoutComponents",value:function(){var n=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null;requestAnimationFrame(function(){var e=P(),t=e.reducedWidth||0,e=e.reducedHeight||0,a=(M(),n.getService("map").layout({width:_.default.viewport.map.sizes.width-t,height:_.default.viewport.map.sizes.height-e}),_.default.viewport.content.sizes.width-t);Vue.nextTick(function(){var e=n.getComponent("contents").internalComponent.$el,t=e.parentElement.clientHeight-((e.parentElement.querySelector(".close-panel-block")||{}).offsetHeight||0)-((e.parentElement.querySelector(".content_breadcrumb")||{}).offsetHeight||0)-10;e.style.height=t+"px",e.firstChild&&(e.firstChild.style.height=t+"px"),_.default.contentsdata.forEach(function(e){"function"==typeof e.content.layout&&e.content.layout(.5+a,t)})}),i&&setTimeout(function(){n.emit(i)})})}},{key:"_layout",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null,t=P();M(t.reducedWidth),this._layoutComponents(e)}}]),c})(i.default))},{"components/ProjectsMenu.vue":101,"components/SidebarItem.vue":118,"components/g3w-form":125,"g3w-component":139,"g3w-constants":140,"g3w-object":144,"g3w-panel":145,"services/iframe":189,"store/application":193,"utils/getListableProjects":224,"utils/getProjectUrl":229,"utils/getUniqueDomId":232,"utils/promisify":247,"utils/toRawType":257}],189:[function(n,A,e){Object.defineProperty(e,"__esModule",{value:!0});var N=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},t=function(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e};function i(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}a=h(function*(e){return e=(0,D.normalizeEpsg)(e),yield G.default.registerProjection(e),e});var a,r=function(e){return a.apply(this,arguments)},o=c(n("g3w-object")),s=c(n("services/gui")),l=c(n("store/application")),u=c(n("store/plugins")),G=c(n("store/projections")),D=n("utils/normalizeEpsg"),z=n("utils/createSingleFieldParameter"),U=n("utils/getUniqueDomId");function c(e){return e&&e.__esModule?e:{default:e}}function d(e,t){var a,n={};for(a in e)0<=t.indexOf(a)||Object.prototype.hasOwnProperty.call(e,a)&&(n[a]=e[a]);return n}function p(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function f(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function g(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function h(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}t(w,[{key:"init",value:(b=h(function*(){for(var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).project,t=(yield s.default.isReady(),this.services={app:new V,editing:new Z},e.state.layers.map(function(e){return{id:e.id,name:e.name}})),a=Object.keys(this.services),n=0;n<a.length;n++){var i=this.services[a[n]];void 0===i.getLayers()&&i.setLayers(t),yield i.init(),i.on("response",this.eventResponseServiceHandler)}this.postMessage({id:null,action:"app:ready",response:{result:!0,data:{layers:t}}}),window.addEventListener("message",this.getMessage,!1)}),function(){return b.apply(this,arguments)})},{key:"eventResponseServiceHandler",value:function(e){var t=e.action;this.postMessage({id:null,action:t,response:e.response})}},{key:"outputDataPlace",value:(_=h(function*(e){var t=void 0,a=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).action,a=void 0===a?"app:results":a,e=yield e,n=e.result,e=e.data,e=void 0===e?[]:e,i=new ol.format.GeoJSON;try{t=e.map(function(e){var t,a=e.layer,e=e.features;return t={},a=a.getId(),e={features:i.writeFeatures(e)},a in t?Object.defineProperty(t,a,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[a]=e,t})}catch(e){n=!1,t=e}this.postMessage({id:null,action:a,response:{result:n,data:t}})}),function(e){return _.apply(this,arguments)})},{key:"postMessage",value:function(){window.parent&&window.parent.postMessage(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},"*")}},{key:"stopPendingActions",value:(v=h(function*(){var t=this,a=[];return Object.keys(this.pendingactions).forEach(function(e){a.push(t.services[t.pendingactions[e].context].stop()),delete t.pendingactions[e]}),Promise.allSettled(a)}),function(){return v.apply(this,arguments)})},{key:"getMessage",value:(m=h(function*(e){if(e&&e.data){var e=e.data,t=e.id,t=void 0===t?(0,U.getUniqueDomId)():t,a=e.single,a=void 0===a||a,n=e.action,e=e.data,i=(n||"").split(":"),i=N(i,2),r=i[0],i=i[1],o=!1,s=void 0;try{var l=this.services[r].getReady();l&&a&&(yield this.stopPendingActions()),l&&(this.pendingactions[t]={context:r},s=yield this.services[r][i](e),o=!0)}catch(e){o=!1,s=e}this.postMessage({id:t,action:n,response:{result:o,data:s}}),delete this.pendingactions[t]}}),function(e){return m.apply(this,arguments)})},{key:"clear",value:(y=h(function*(){for(var e=Object.keys(this.services),t=0;t<e.length;t++)this.services[e[t]].off("response",this.eventResponseServiceHandler);yield this.stopPendingActions(),window.removeEventListener("message",this.getMessage,!1)}),function(){return y.apply(this,arguments)})}]);var y,m,v,_,b,q=w;function w(){g(this,w),this.pendingactions={},this.getMessage=this.getMessage.bind(this),this.eventResponseServiceHandler=this.eventResponseServiceHandler.bind(this)}f(L,o.default),t(L,[{key:"init",value:(E=h(function*(){var t,a=this,e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).layers;this.layers=void 0===e?{}:e,l.default.configurationPlugins.includes(this.pluginName)&&((e=u.default.getPlugin(this.pluginName))?(this.setDependencyApi(e.getApi()),this.setReady(!0)):u.default.onafter("registerPlugin",(t=h(function*(e){yield e.isReady(),e.getName()===a.pluginName&&(a.setDependencyApi(e.getApi()),a.setReady(!0))}),function(e){return t.apply(this,arguments)})))}),function(){return E.apply(this,arguments)})},{key:"setDependencyApi",value:function(){this.dependencyApi=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}}},{key:"getDependecyApi",value:function(){return this.dependencyApi}},{key:"getQgsLayerId",value:function(e){var t=e.qgs_layer_id,e=e.noValue,e=void 0===e?this.layers.map(function(e){return e.id}):e;return t?[].concat(t):e}},{key:"searchFeature",value:(S=h(function*(e){var t=e.layer,e=e.feature,a=e.field,e=e.value,t=(yield n("services/data").default.getData("search:features",{inputs:{layer:t,filter:(0,z.createSingleFieldParameter)({field:a,value:e,operator:"eq"})},outputs:!1})).data;return void 0===t?[]:t}),function(e){return S.apply(this,arguments)})},{key:"findFeaturesWithGeometry",value:(k=h(function*(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.feature,a=e.qgs_layer_id,n=void 0===a?[]:a,a=e.zoom,i=void 0!==a&&a,a=e.highlight,r=void 0!==a&&a,o={found:!1,features:[],qgs_layer_id:null},s=n.length,l=0;!o.found&&l<s;){var u=this.project.getLayerById(n[l]);try{var c=u&&(yield this.searchFeature({layer:u,feature:t})),d=c.length&&c[0].features;if(o.found=d&&0<d.length&&!!d.find(function(e){return e.getGeometry()}),!d||!o.found)throw"invalid response";o.features=d,o.qgs_layer_id=n[l],i&&(yield this.mapService.zoomToFeatures(d,{highlight:r}))}catch(e){l++}}return o.found||this.zoomToExtent(this.mapService.project.state.initextent),o}),function(){return k.apply(this,arguments)})},{key:"setLayers",value:function(){this.layers=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]}},{key:"getLayers",value:function(){return this.layers}},{key:"setReady",value:function(){this.ready=0<arguments.length&&void 0!==arguments[0]&&arguments[0]}},{key:"getReady",value:function(){return this.ready}},{key:"stop",value:(x=h(function*(){}),function(){return x.apply(this,arguments)})},{key:"clear",value:function(){}}]);var x,k,S,E,o=L;function L(){g(this,L);var e=p(this,(L.__proto__||Object.getPrototypeOf(L)).call(this));return e.ready=!1,e.mapService=s.default.getService("map"),e.project=l.default.project,e.layers=void 0,e.pluginName,e.dependencyApi={},e}f(j,o),t(j,[{key:"init",value:function(){var t=this;return new Promise(function(e){t.mapService.once("ready",function(){t._map=t.mapService.getMap(),t._mapCrs=t.mapService.getCrs(),t.mapControls.screenshot.control=t.mapService.getMapControlByType({type:"screenshot"}),t.setReady(!0),e()})})}},{key:"results",value:(F=h(function*(e){e=e.capture;return s.default.currentoutputplace=void 0===e||e?"iframe":"gui",[]}),function(e){return F.apply(this,arguments)})},{key:"screenshot",value:(I=h(function*(e){var a=this,e=e.capture;void 0===e||e?this.mapControls.screenshot.control.overwriteOnClickEvent(h(function*(){var t=void 0;try{t={result:!0,data:yield a.mapService.createMapImage()}}catch(e){t={result:!1,data:e}}finally{a.emit("response",{response:t,action:"app:screenshot"})}})):this.mapControls.screenshot.control.resetOriginalOnClickEvent()}),function(e){return I.apply(this,arguments)})},{key:"getcenter",value:(O=h(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this.mapService.getCenter();return void 0!==e.epsg?ol.proj.transform(t,this.mapService.getEpsg(),yield r(e.epsg)):t}),function(){return O.apply(this,arguments)})},{key:"zoomtocoordinates",value:(P=h(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.coordinates,t=void 0===t?[]:t,e=e.epsg;return t&&Array.isArray(t)&&2===t.length?(void 0!==e&&(e=yield r(e),t=ol.proj.transform(t,e,this.mapService.getEpsg())),this.mapService.zoomTo(t),t):Promise.reject(t)}),function(){return P.apply(this,arguments)})},{key:"getextent",value:(M=h(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this.mapService.getMapExtent();return void 0!==e.epsg?ol.proj.transformExtent(t,this.mapService.getEpsg(),yield r(e.epsg)):t}),function(){return M.apply(this,arguments)})},{key:"zoomtoextent",value:(C=h(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.extent,t=void 0===t?[]:t,e=e.epsg;return t&&Array.isArray(t)&&4===t.length?(void 0!==e?(e=r(e),t=ol.proj.transformExtent(t,e,this.mapService.getEpsg())):this.mapService.goToBBox(t),t):Promise.reject(t)}),function(){return C.apply(this,arguments)})},{key:"zoomtofeature",value:(T=h(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.qgs_layer_id,a=e.feature,e=e.highlight,e=void 0!==e&&e,t=this.getQgsLayerId({qgs_layer_id:t});return(yield this.findFeaturesWithGeometry({qgs_layer_id:t,feature:a,zoom:!0,highlight:e})).qgs_layer_id}),function(){return T.apply(this,arguments)})}]);var T,C,M,P,O,I,F,V=j;function j(){g(this,j);var e=p(this,(j.__proto__||Object.getPrototypeOf(j)).call(this));return e.mapControls={screenshot:{control:null},changeMap:{control:null}},e}f(R,o),t(R,[{key:"startAction",value:(H=h(function*(e){var a=this,t=e.toolboxes,n=e.resolve,i=e.reject;this.responseObject.cb=i,this.dependencyApi.setSaveConfig({cb:{done:function(e){a.responseObject.cb=n,a.responseObject.qgs_layer_id=e.getId(),a.responseObject.error=null,a.dependencyApi.hidePanel()},error:function(e,t){a.responseObject.cb=i,a.responseObject.qgs_layer_id=e.getId(),a.responseObject.error=t}}}),this.dependencyApi.showPanel({toolboxes:t}),this.isRunning=!0}),function(e){return H.apply(this,arguments)})},{key:"stopAction",value:(W=h(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.qgs_layer_id&&(yield this.stopEditing(e.qgs_layer_id))}),function(){return W.apply(this,arguments)})},{key:"addSubscribeEvents",value:function(e){var t=this.subscribersHandlers[e](1<arguments.length&&void 0!==arguments[1]?arguments[1]:{});return this.dependencyApi.subscribe(e,t),this.subscribevents.push({event:e,handler:t}),t}},{key:"resetSubscribeEvents",value:function(){var t=this;this.subscribevents.forEach(function(e){t.dependencyApi.unsubscribe(e.event,e.handler)})}},{key:"add",value:function(){var a,i=this,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise((a=h(function*(e,t){if(i.isRunning)return t();var a=r.qgs_layer_id,n=d(r,["qgs_layer_id"]).properties,a=i.getQgsLayerId({qgs_layer_id:a,noValue:i.dependencyApi.getEditableLayersId()}),e=(yield i.startAction({toolboxes:a,resolve:e,reject:t}),(yield i.startEditing(a,{tools:i.config.tools.add,startstopediting:!1,action:"add",selected:1===a.length})).filter(function(e){return"fulfilled"===e.status}).map(function(e){return e.value}));s.default.isSidebarVisible()||s.default.showSidebar(),1===e.length&&e[0]&&e[0].setActiveTool(e[0].getToolById("addfeature")),i.addSubscribeEvents("addfeature",{properties:n,toolboxes:e}),i.addSubscribeEvents("closeeditingpanel",{qgs_layer_id:a})}),function(e,t){return a.apply(this,arguments)}))}},{key:"update",value:($=h(function*(){var a,i=this,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new Promise((a=h(function*(e,t){var a,n;return!i.isRunning&&(n=r.qgs_layer_id,a=d(r,["qgs_layer_id"]).feature,n=i.getQgsLayerId({qgs_layer_id:n,noValue:i.dependencyApi.getEditableLayersId()}),(n=yield i.findFeaturesWithGeometry({qgs_layer_id:n,feature:a,zoom:!0,highlight:!0,selected:1===n.length})).found)?(yield i.startAction({toolboxes:[n.qgs_layer_id],resolve:e,reject:t}),yield i.startEditing([n.qgs_layer_id],{feature:a,tools:i.config.tools.update,startstopediting:!1,action:"update"}),s.default.isSidebarVisible()||s.default.showSidebar(),void i.addSubscribeEvents("closeeditingpanel",{qgs_layer_id:[n.qgs_layer_id]})):t()}),function(e,t){return a.apply(this,arguments)}))}),function(){return $.apply(this,arguments)})},{key:"delete",value:function(){}},{key:"startEditing",value:(Y=h(function*(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=a.action,n=void 0===n?"add":n,i=a.feature,r={};switch(a.filter=r,n){case"add":r.nofeatures=!0;break;case"update":r.field=i.field+"|eq|"+i.value}var o=[];return e.forEach(function(e){o.push(t.dependencyApi.startEditing(e,a))}),yield Promise.allSettled(o)}),function(){return Y.apply(this,arguments)})},{key:"stopEditing",value:(B=h(function*(e){var t=this,a=[];e.forEach(function(e){a.push(t.dependencyApi.stopEditing(e))}),yield Promise.allSettled(a),this.clear()}),function(e){return B.apply(this,arguments)})},{key:"stop",value:function(){var t=this;return new Promise(function(e){t.dependencyApi.hidePanel(),s.default.hideSidebar(),t.once("clear",e)})}},{key:"clear",value:function(){this.dependencyApi.resetDefault(),this.isRunning=!1,this.responseObject={cb:null,qgs_layer_id:null,error:null},this.resetSubscribeEvents(),this.emit("clear")}}]);var B,Y,$,W,H,Z=R;function R(){g(this,R);var o=p(this,(R.__proto__||Object.getPrototypeOf(R)).call(this));return o.pluginName="editing",o.subscribevents=[],o.isRunning=!1,o.responseObject={cb:null,qgs_layer_id:null,error:null},o.config={tools:{add:{disabled:[{id:"deletefeature"},{id:"copyfeatures"},{id:"editmultiattributes"},{id:"deletePart"},{id:"splitfeature"},{id:"mergefeatures"}]},update:{disabled:[{id:"addfeature"},{id:"copyfeatures"},{id:"deletefeature"},{id:"editmultiattributes"},{id:"deletePart"},{id:"splitfeature"},{id:"mergefeatures"}]},delete:{enabled:[{id:"deletefeature",options:{active:!0}}]}}},o.subscribersHandlers={canUndo:function(e){var a=e.activeTool,e=e.disableToolboxes,n=void 0===e?[]:e;return function(t){!1===t&&(o.responseObject.qgs_layer_id=null,o.responseObject.error=null),a.setEnabled(!t),n.forEach(function(e){return e.setEditing(!t)})}},canRedo:function(){},cancelform:function(e){return function(){e()}},addfeature:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=e.properties,r=e.toolboxes;return function(t){Object.keys(i).forEach(function(e){return t.set(e,i[e])});var a=void 0,n=[];r.forEach(function(e){var t=e.getToolById("addfeature");t.isActive()?(t.setEnabled(!1),a=t):(e.setEditing(!1),n.push(e))}),o.subscribevents.find(function(e){return"canUndo"!==e.event})&&o.addSubscribeEvents("cancelform",o.addSubscribeEvents("canUndo",{activeTool:a,disableToolboxes:n}))}},closeeditingpanel:function(e){var t=e.qgs_layer_id;return function(){o.responseObject.cb({qgs_layer_id:o.responseObject.qgs_layer_id,error:o.responseObject.error}),o.stopAction({qgs_layer_id:t})}}},o}e.default=new q},{"g3w-object":144,"services/data":187,"services/gui":188,"store/application":193,"store/plugins":194,"store/projections":195,"utils/createSingleFieldParameter":211,"utils/getUniqueDomId":232,"utils/normalizeEpsg":243}],190:[function(c,N,e){Object.defineProperty(e,"__esModule",{value:!0});var p=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},d=function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e};function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var f=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},g=O(c("localforage")),t=O(c("g3w-object")),h=O(c("store/application")),y=O(c("store/plugins")),m=c("utils/createVectorLayerFromFile"),v=c("utils/isPointGeometryType"),_=c("utils/isLineGeometryType"),b=c("utils/isPolygonGeometryType"),w=c("utils/createSelectedStyle"),x=c("utils/getMapLayersByFilter"),k=c("utils/getScaleFromResolution"),S=c("utils/getResolutionFromScale"),E=c("utils/getUniqueDomId"),L=c("utils/throttle"),T=c("utils/createFilterFromString"),a=O(c("map/controls/interactioncontrol")),i=O(c("map/interactions/pickcoordinatesinteraction")),r=c("map/controls/queryby"),o=c("map/controls/geolocationcontrol"),s=c("map/controls/streetviewcontrol"),G=c("map/controls/scalecontrol"),D=c("map/controls/screenshotcontrol"),z=c("map/controls/measurecontrol"),C=O(c("services/data")),u=O(c("services/application")),M=O(c("services/gui")),U=O(c("components/MapControlZoomHistory.vue")),q=O(c("components/MapControlGeocoding.vue")),V=c("utils/groupBy"),B=c("utils/getProject"),Y=c("utils/getCatalogLayerById"),W=c("utils/getCatalogLayers"),P=c("map/layers/vectorlayer");function O(e){return e&&e.__esModule?e:{default:e}}function I(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function F(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}var j={ZOOM:{maxScale:1e3},ANIMATION:{duration:2e3}},R={controls:{},offlineids:[],selectedLayer:null,stores:{},externalLayers:[],animatingHighlight:!1,layers:Object.assign(new t.default({setters:{addLayersStore:function(e){R.stores[e.getId()]=e},removeLayersStore:function(e){e&&delete R.layers.stores[e.getId()]}}}),{getLayerById:function(t){return Object.values(R.stores).map(function(e){return e.getLayerById(t)}).find(function(e){return e})},getLayers:function(t){return Object.values(R.stores).flatMap(function(e){return e.getLayers(t)})},getQuerableLayersStores:function(){return Object.values(R.stores).filter(function(e){return e.isQueryable()})},getLayersStore:function(e){return R.stores[e]},getLayersStores:function(){return Object.values(R.stores)}})},A={zoomtoextent:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new a.default(f({},e,{ol:new ol.control.ZoomToExtent(e)}))},zoom:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new a.default(f({},e,{ol:new ol.control.Zoom(e)}))},scaleline:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new a.default(f({},e,{ol:new ol.control.ScaleLine(e)}))},overview:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new a.default(f({},e,{ol:new ol.control.OverviewMap(e)}))},zoomhistory:function(){return new a.default({element:(new(Vue.extend(U.default))).$mount().$el,tipLabel:"sdk.mapcontrols.addlayer.tooltip"})},geocoding:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new a.default({element:new(Vue.extend(q.default))({propsData:e.config}).$mount().$el,offline:!1})},zoombox:function(){return new a.default(f({},0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},{name:"zoombox",tipLabel:"Zoom to box",label:"",interactionClass:ol.interaction.DragBox,cursorClass:"ol-crosshair",onSetMap:function(e){var t=this,e=e.setter;"after"===e&&(this._startCoordinate=null,this._interaction.on("boxstart",function(e){return t._startCoordinate=e.coordinate}),this._interaction.on("boxend",function(e){t.dispatchEvent({type:"zoomend",extent:ol.extent.boundingExtent([t._startCoordinate,e.coordinate])}),t._startCoordinate=null,t._autountoggle&&t.toggle()}))}}))},query:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new a.default(f({},e,{offline:!1,name:"query",tipLabel:"sdk.mapcontrols.query.tooltip",label:e.label||"",clickmap:!0,interactionClass:i.default,cursorClass:"ol-help",onSetMap:function(e){var t,a,n=this,i=e.map,e=e.setter;this.runQuery=this.runQuery||(t=F(function*(e){e=e.coordinates;M.default.closeSideBar();try{var t=h.default.project;yield C.default.getData("query:coordinates",{inputs:{coordinates:e,feature_count:t.state.feature_count||5,query_point_tolerance:t.getQueryPointTolerance(),multilayers:[].concat(t.state.querymultilayers).includes(n.name)}})}catch(e){}}),function(e){return t.apply(this,arguments)}),"before"===e&&(a=null,this.on("toggled",function(e){!0!==e.toggled?(ol.Observable.unByKey(a),a=null):null===a&&i&&(a=n.getInteraction().on("picked",(0,L.throttle)(function(e){return n.runQuery({coordinates:e.coordinate})})))}),this.setEventKey({eventType:"picked",eventKey:this.on("picked",this.runQuery)}))}}))},queryby:r.QueryBy,geolocation:o.GeolocationControl,streetview:s.StreetViewControl,addlayers:function(){return new a.default(f({},0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},{tipLabel:"sdk.mapcontrols.addlayer.tooltip",label:"",name:"addlayer",onSetMap:function(e){var t=this;"after"===e.setter&&$(this.element).on("click",function(){return t.dispatchEvent("addlayer")})}}))},measure:z.MeasureControl,mouseposition:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return Object.assign(new ol.control.MousePosition(f({},e,{target:e.target||"mouse-position-control"})),{offline:!0})},scale:G.ScaleControl,onclick:a.default,screenshot:D.ScreenshotControl},r=(A.nominatim=A.geocoding,A.ontoggle=A.onclick,A.area=A.measure,A.length=A.measure,A.geoscreenshot=A.screenshot,A.querybbox=A.queryby,A.querybycircle=A.queryby,A.querybydrawpolygon=A.queryby,A.querybypolygon=A.queryby,(e=>{var t,a,n,i,r,o,s=u;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);function u(){var t,a,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=this,i=u;if(n instanceof i)return(t=((e,t)=>{if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")})(this,(u.__proto__||Object.getPrototypeOf(u)).call(this))).state={mapUnits:"m",bbox:[],hidemaps:[],resolution:null,center:null,loading:!1,hidden:!0,scale:0,mapcontrolsalignement:"rv",mapcontrolDOM:null,mapcontrolready:!1,mapControl:{disabled:!1},map_info:{info:null,style:null},mapunits:["metric"]},t.id="MapService",t._ready=new Promise(function(e){return t.once("viewerset",e)}),t.viewer=null,t.target=e.target||"map",t.layersCount=0,t.maps_container=e.maps_container||"g3w-maps",t.project=e.project||h.default.project,t._controls=[],t._layers={base:{},g3w:[],external_wms:[],external_vector:[],external:[]},t._externalInteractions=[],t.defaultsLayers={mapcenter:new ol.layer.Vector({source:new ol.source.Vector,style:new ol.style.Style({image:new ol.style.Icon({opacity:1,src:"/static/client/images/mapcentermarker.svg",scale:.8})})}),_style:{highlightLayer:{color:void 0},selectionLayer:{color:"red"}},highlightLayer:new ol.layer.Vector({source:new ol.source.Vector,style:function(e){return[(0,w.createSelectedStyle)({geometryType:e.getGeometry().getType(),color:t.defaultsLayers._style.highlightLayer.color,fill:!0})]}}),selectionLayer:new ol.layer.Vector({source:new ol.source.Vector,style:function(e){return[(0,w.createSelectedStyle)({geometryType:e.getGeometry().getType(),color:t.defaultsLayers._style.selectionLayer.color,fill:!0})]}})},t.layersExtraParams={},t._drawShadow={type:"coordinate",outer:[],inner:[],scale:null,rotation:null,listener:null},t.config=e.config||window.initConfig,t._howManyAreLoading=0,t._marker=null,t.onLayerLoadStart=t.onLayerLoadStart.bind(t),t.onLayerLoadEnd=t.onLayerLoadEnd.bind(t),t.onLayerLoadError=t.onLayerLoadError.bind(t),t.onExtraParamsSet=t.onExtraParamsSet.bind(t),t.onSetCurrentProject=t.onSetCurrentProject.bind(t),t.updateMapLayers=t.updateMapLayers.bind(t),t._keyEvents={ol:[],g3wobject:[],stores:[],base:t.project.onafter("setBaseLayer",t.updateMapLayers),unwatches:[]},e.project||t._keyEvents.g3wobject.push({who:g3wsdk.core.project.ProjectsRegistry,setter:"setCurrentProject",key:g3wsdk.core.project.ProjectsRegistry.onafter("setCurrentProject",t.onSetCurrentProject)}),t.debounces={setupCustomMapParamsToLegendUrl:{fnc:function(){t._setupCustomMapParamsToLegendUrl.apply(t,arguments)},delay:1e3}},t.setters={setupControls:function(){var s=this,e=this.config,t=e.header_terms_of_use_text,e=e.header_terms_of_use_link,a=!!t&&(e?'<a href="'+e+'">'+t+"</a>":'<span class="skin-color" style="font-weight: bold">'+t+"</span>");if(this.getMapLayers().forEach(function(e){return e.getSource().setAttributions(a)}),(a||(0,x.getMapLayersByFilter)({BASELAYER:!0}).length)&&this.getMap().addControl(new ol.control.Attribution({collapsible:!1,target:"map_footer_left"})),this.config&&this.config.mapcontrols)return e=Array.isArray(this.config.mapcontrols)?this.config.mapcontrols.reduce(function(e,t){return e[t]={},e},{}):this.config.mapcontrols,Object.entries(e).forEach(function(e){var a,n,t,i,e=p(e,2),r=e[0],e=e[1],o=void 0===e?{}:e;switch(r){case"zoom":s.createMapControl(r);break;case"zoombox":isMobile.any||s.createMapControl(r,{}).on("zoomend",function(e){return s.viewer.fit(e.extent)});break;case"zoomtoextent":s.createMapControl(r,{options:{label:"",extent:s.project.state.initextent}});break;case"mouseposition":isMobile.any||(a="degrees"===s.getProjection().getUnits(),n=s.getEpsg(),i=s.createMapControl(r,{add:!(t=function(e,t){return"EPSG:4326"===e?ol.coordinate.format(ol.proj.transform(t,n,"EPSG:4326")," Lng: {x}, Lat: {y}   [EPSG:4326] ",4):ol.coordinate.format(t," "+(a?"Lng":"X")+": {x}, "+(a?"Lat":"Y")+": {y}   ["+e+"] ",a?4:2)}),options:{coordinateFormat:t.bind(null,n),undefinedHTML:!1,projection:s.getCrs()}}),"EPSG:4326"!==n&&i.on("change:epsg",function(e){return i.setCoordinateFormat(t.bind(null,e.epsg))}));break;case"screenshot":case"geoscreenshot":isMobile.any||(s.getMapControlByType("screenshot")?s.getMapControlByType("screenshot").addType(r):s.createMapControl("screenshot",{options:{types:[r],layers:[].concat(I(R.layers.getLayers()),I(s._layers.external))}}));break;case"scale":s.createMapControl(r,{add:!1,options:{coordinateFormat:ol.coordinate.createStringXY(4),projection:s.getCrs(),isMobile:isMobile.any}});break;case"query":s.createMapControl(r,{add:!0,toggled:!0});break;case"querybypolygon":case"querybbox":case"querybycircle":case"querybydrawpolygon":isMobile.any||(s.getMapControlByType("queryby")?s.getMapControlByType("queryby").addType(r):s.createMapControl("queryby",{options:{types:[r]}}));break;case"streetview":s.createMapControl(r,{});break;case"scaleline":s.createMapControl(r,{add:!1,options:{position:"br"}});break;case"overview":!isMobile.any&&window.initConfig.overviewproject&&(0,B.getProject)(window.initConfig.overviewproject).then(function(n){var a=s.getMap(),i=new ol.View(s._calculateViewOptions({project:n,width:200,height:150}));i.on("change:center",function(){var e=i.getCenter(),t=a.getView().constrainCenter(e);t[0]===e[0]&&t[1]===e[1]||i.setCenter(t)}),s.createMapControl(r,{add:!1,options:{view:i,position:"bl",collapsed:!1,className:"ol-overviewmap ol-custom-overviewmap",collapseLabel:$('<span class="'+M.default.getFontClass("arrow-left")+'"></span>')[0],label:$('<span class="'+M.default.getFontClass("arrow-right")+'"></span>')[0],layers:Object.entries(n.getLayersStore().getLayers({GEOLAYER:!0,BASELAYER:!1}).reduce(function(e,t){var a=t.getMultiLayerId();return void 0===e[a]&&(e[a]=[]),e[a].push(t),e},{})||[]).map(function(e){var e=p(e,2),t=e[0],e=e[1],a=new(c("map/layers/imagelayer").RasterLayer)({url:n.state.WMSUrl,id:"overview_layer_"+t,tiled:e[0].state.tiled});return e.reverse().forEach(function(e){return a.addLayer(e)}),a.getOLLayer(!0)}).reverse()}}),document.querySelector(".g3w-map-controls-left-bottom").style.left="230px",new MutationObserver(function(e){e.forEach(function(e){"class"===e.attributeName&&(document.querySelector(".g3w-map-controls-left-bottom").style.left=e.target.classList.contains("ol-collapsed")?"50px":"230px")})}).observe(document.querySelector(".ol-custom-overviewmap"),{attributes:!0})}).catch(function(e){});break;case"geocoding":case"nominatim":s.createMapControl(r,{add:!1,options:{config:o}});break;case"geolocation":s.createMapControl(r).on("click",(0,L.throttle)(function(e){return s.showMarker(e.coordinates)}));break;case"addlayers":isMobile.any||s.createMapControl(r,{}).on("addlayer",function(){return s.showAddLayerModal()});break;case"length":case"area":isMobile.any||(s.getMapControlByType("measure")?s.getMapControlByType("measure").addType(r):s.createMapControl("measure",{options:{name:"measure",tipLabel:"sdk.mapcontrols.measures.title",types:[r],interactionClassOptions:{projection:s.getProjection(),help:"sdk.mapcontrols.measures."+r+".help"}}}));break;case"zoomhistory":$(".g3w-map-controls-left-bottom").append(s.createMapControl(r,{add:!1}).element)}}),this.getMapControls()},addHideMap:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).switchable,e=void 0!==e&&e,e={id:"hidemap_"+Date.now(),map:null,switchable:e};return this.state.hidemaps.push(e),e},setHidden:function(e){this.state.hidden=e},setupViewer:(a=F(function*(e,t){var a,n,i,r,o,s,l,u,c,d=this;0!==e&&0!==t&&(a=+((c=new URLSearchParams(location.search)).get("showmarker")||0),n=c.get("iframetype"),i=c.get("zoom_to_fid"),r=c.get("ztf"),o={lat:parseFloat(c.get("lat")),lon:parseFloat(c.get("lon")),x:parseFloat(c.get("x")),y:parseFloat(c.get("y"))},this.viewer&&this.viewer.destroy(),e=this._calculateViewOptions({width:e,height:t,project:this.project,map_extent:c.get("map_extent")}),t=new ol.Map({controls:ol.control.defaults({attribution:!1,zoom:!1,rotateOptions:{autoHide:!0,tipLabel:"Reset rotation (CTRL+DRAG to rotate)"}}),interactions:ol.interaction.defaults().extend([new ol.interaction.DragRotate({condition:ol.events.condition.platformModifierKeyOnly})]),ol3Logo:!1,view:new ol.View(e),keyboardEventTarget:document,target:this.target}),this.viewer={map:t,getMap:function(){return d.viewer.map},getView:function(){return d.viewer.map.getView()},getZoom:function(){return d.viewer.map.getView().getZoom()},getResolution:function(){return d.viewer.map.getView().getResolution()},getCenter:function(){return d.viewer.map.getView().getCenter()},destroy:function(){d.viewer.map&&(d.viewer.map.dispose(),d.viewer.map=null)},zoomTo:this.zoomTo.bind(this),goTo:this.goTo.bind(this),fit:this._fit.bind(this),changeBaseLayer:function(t){return d.map.getLayers().insertAt(0,d.map.getLayers().find(function(e){return t===e.get("name")}))}},(s=this.viewer.getMap()).getInteractions().getArray().find(function(e){return e instanceof ol.interaction.DoubleClickZoom}).setActive(!1),l=void s.on("click",function(e){var e=e.coordinate,a=new ol.layer.Vector({source:new ol.source.Vector({features:[new ol.Feature({geometry:new ol.geom.Point(e)})]}),style:new ol.style.Style}),n=+new Date,i=a.on("postcompose",function(e){var e=e.frameState.time-n,t=ol.easing.easeOut(e/1700);a.setStyle(new ol.style.Style({image:new ol.style.Circle({radius:40*t,fill:new ol.style.Fill({color:[225,227,228,.1]}),stroke:new ol.style.Stroke({color:[225,227,228,1],width:1.85*(1-t)})})})),1700<e&&(s.removeLayer(a),ol.Observable.unByKey(i))});s.addLayer(a)}),u=!1,(new Vue).$watch(function(){return[d.getCurrentToggledMapControl(),y.default.getPlugin("editing")&&y.default.getPlugin("editing").getActiveTool()]},function(e){var e=p(e,2),t=e[0];u=!(l=t)&&!e[1],s.getViewport().classList.toggle("ol-grab",u),s.getInteractions().getArray().find(function(e){return e instanceof ol.interaction.DoubleClickZoom}).setActive(u)}),c=void s.on(["pointerdrag","pointerup"],function(e){s.getViewport().classList.toggle("ol-grabbing",!("pointerdrag"!=e.type||l&&l.getInteraction()instanceof ol.interaction.DragBox)),s.getViewport().classList.toggle("ol-grab","pointerup"==e.type&&u)}),i?yield this.zoomToFid(i):r?yield this.zoomToFeaturesUrl(r):isNaN(o.lat)||isNaN(o.lon)?isNaN(o.x)||isNaN(o.y)||(c=new ol.geom.Point([o.x,o.y])):c=new ol.geom.Point(ol.proj.transform([o.lon,o.lat],"EPSG:4326",this.getEpsg())),c&&c.getExtent()&&(yield this.zoomToGeometry(c)),1==a&&this.defaultsLayers.mapcenter.getSource().addFeature(new ol.Feature({geometry:new ol.geom.Point(this.getCenter())})),"map"===n&&(this.config.mapcontrols={}),j.ZOOM.maxScale=Math.min((0,k.getScaleFromResolution)(this.getMap().getView().getResolutionForExtent(this.project.state.initextent,this.getMap().getSize()),this.getMapUnits()),j.ZOOM.maxScale),this.state.size=this.viewer.map.getSize(),this.state.mapUnits=this.viewer.map.getView().getProjection().getUnits(),this.config.background_color&&$("#"+this.target).css("background-color",this.config.background_color),$(this.viewer.map.getViewport()).prepend('<div id="map-spinner" style="position:absolute; top: 50%; right: 50%"></div>'),this.viewer.map.getInteractions().forEach(function(e){return d._watchInteraction(e)}),this.viewer.map.getInteractions().on("add",function(e){return d._watchInteraction(e.element)}),this._marker=new ol.Overlay({position:null,positioning:"center-center",element:document.getElementById("marker"),stopEvent:!1}),this.viewer.map.addOverlay(this._marker),this.viewer.map.getLayers().on("add",function(e){e=d.setLayerZIndex({layer:e.element,zindex:e.element.get("basemap")||"bottom"===e.element.get("position")?0:void 0});d.defaultsLayers.mapcenter&&d.defaultsLayers.mapcenter.setZIndex(e+1),d.defaultsLayers.highlightLayer&&d.defaultsLayers.highlightLayer.setZIndex(e+1),d.defaultsLayers.selectionLayer&&d.defaultsLayers.selectionLayer.setZIndex(e+2)}),this.viewer.map.getLayers().on("remove",function(e){e.element.getZIndex()===d.layersCount&&d.layersCount--}),this.state.bbox=this.getMapBBOX(),this.state.resolution=this.viewer.getResolution(),this.state.center=this.viewer.getCenter(),this._setupAllLayers(),this.setUpMapOlEvents(),R.layers.getLayersStores().forEach(this._setUpEventsKeysToLayersStore.bind(this)),R.layers.onafter("addLayersStore",this._setUpEventsKeysToLayersStore.bind(this)),R.layers.onafter("removeLayersStore",this._removeEventsKeysToLayersStore.bind(this)),this.emit("viewerset"),this.setupControls(),this.emit("ready"))}),function(e,t){return a.apply(this,arguments)}),controlClick:function(e){},loadExternalLayer:function(e){},unloadExternalLayer:function(e){}},t.on("extraParamsSet",t.onExtraParamsSet),t;throw new TypeError("Cannot call a class as a function")}return s.prototype=Object.create(e&&e.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(s,e):s.__proto__=e),d(u,[{key:"onExtraParamsSet",value:function(t,e){var a=this;e&&this.getMapLayers().forEach(function(e){return e.update(a.state,t)})}},{key:"onSetCurrentProject",value:function(e){function t(){var e=n.viewer.map.getSize(),t=(e=p(e,2))[0],e=e[1],a=n.project.state.extent,t=ol.extent.getWidth(a)/t,e=ol.extent.getHeight(a)/e,t=Math.max(t,e)>n.viewer.map.getView().getMaxResolution()?Math.max(t,e):n.viewer.map.getView().getMaxResolution(),e=new ol.View({extent:a,projection:n.viewer.map.getView().getProjection(),center:n.viewer.map.getView().getCenter(),resolution:n.viewer.map.getView().getResolution(),maxResolution:t});j.ZOOM.maxScale=Math.min((0,k.getScaleFromResolution)(n.getMap().getView().getResolutionForExtent(n.project.state.initextent,n.getMap().getSize()),n.getMapUnits()),j.ZOOM.maxScale),n.viewer.map.setView(e),n._setupAllLayers(),n.setUpMapOlEvents(),n.setupCustomMapParamsToLegendUrl()}var n=this,a=(this.removeLayers(),this._keyEvents.base&&this.project.un("setBaseLayer",this._keyEvents.base),this.project.getId()===e.getId());this.project=e;(a||h.default.iframe)&&t(),a||this.getMap().once("change:size",t)}},{key:"onLayerLoadStart",value:function(){0===this._howManyAreLoading&&(this.emit("loadstart"),M.default.showSpinner({container:$("#map-spinner"),id:"maploadspinner",style:"transparent"})),this._howManyAreLoading+=1}},{key:"onLayerLoadEnd",value:function(){--this._howManyAreLoading,0===this._howManyAreLoading&&(this.emit("loadend"),M.default.hideSpinner("maploadspinner"))}},{key:"onLayerLoadError",value:function(){this.project.state.show_load_layer_error&&(this.onLayerLoadError.shown||(M.default.notify.warning("sdk.errors.layers.load"),this.onLayerLoadError.shown=!0),this.onLayerLoadEnd())}},{key:"isReady",value:function(){return this._ready}},{key:"setUpMapOlEvents",value:function(){var e=this,t=this.project.state.context_base_legend;this._keyEvents.ol.forEach(function(e){return ol.Observable.unByKey(e)}),this._keyEvents.ol.push(this.viewer.map.getView().on("change:resolution",function(){e.state.bbox=e.getMapBBOX(),e.state.resolution=e.viewer.getResolution(),e.state.center=e.viewer.getCenter(),e.updateMapLayers(),t&&e.setupCustomMapParamsToLegendUrl()})),t?this._keyEvents.ol.push(this.viewer.map.on("moveend",function(){return e.setupCustomMapParamsToLegendUrl()})):this.setupCustomMapParamsToLegendUrl()}},{key:"clear",value:function(){var a=this;this.removeListener("extraParamsSet",this.onExtraParamsSet),["ol","g3wobject"].forEach(function(e){switch(e){case"ol":a._keyEvents[e].forEach(function(e){return ol.Observable.unByKey(e)});break;case"g3wobject":a._keyEvents[e].forEach(function(e){return e.who.un(e.setter,e.key)});break;case"eventemitter":a._keyEvents[e].forEach(function(e){var t=e.event;return a.removeListener(t,e.listener)})}a._keyEvents[e].splice(0)}),R.layers.getLayersStores().forEach(this._removeEventsKeysToLayersStore.bind(this))}},{key:"_addHideMap",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.ratio,a=e.layers,a=void 0===a?[]:a,e=e.mainview,e=void 0!==e&&e,n=this.state.hidemaps.at(-1),i=this.getMap().getView(),e=e?i:{projection:i.getProjection(),center:i.getCenter(),resolution:this.getResolution()};return n.map=new ol.Map({controls:ol.control.defaults({attribution:!1,zoom:!1}),interactions:ol.interaction.defaults(),ol3Logo:!1,view:e instanceof ol.View?e:new ol.View(e),keyboardEventTarget:document,target:n.id}),t&&(i=n.map.getSize(),e=p(i,2)[0],n.map.setSize([e,e*t])),(a||[]).forEach(function(e){return n.map.addLayer(e)}),n.map}},{key:"removeHideMap",value:function(t){var e=(this.state.hidemaps||[]).findIndex(function(e){return t===e.id});-1!==e&&this.state.hidemaps.splice(e,1)}},{key:"createMapImage",value:function(){var n=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=e.map;return new Promise(function(t,a){try{var e=$(i?i.getViewport():$("#"+n.maps_container+" .g3w-map").last().children(".ol-viewport")[0]).children("canvas")[0];navigator.msSaveBlob?t(e.msToBlob()):e.toBlob(function(e){return t(e)})}catch(e){a(e)}})}},{key:"getProject",value:function(){return this.project}},{key:"getMap",value:function(){try{return this.viewer.map}catch(e){}}},{key:"getProjection",value:function(){return this.project.getProjection()}},{key:"isMapHidden",value:function(){return this.state.hidden}},{key:"getCrs",value:function(){return this.project.getProjection().getCode()}},{key:"getViewport",value:function(){return this.viewer.map.getViewport()}},{key:"getResolution",value:function(){return this.viewer.map.getView().getResolution()}},{key:"getEpsg",value:function(){return this.viewer.map.getView().getProjection().getCode()}},{key:"showMarker",value:function(e){var t=this,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1e3;this._marker.setPosition(e),setTimeout(function(){return t._marker.setPosition()},a)}},{key:"getLayerByName",value:function(t){return this.getMap().getLayers().getArray().find(function(e){return t===e.get("name")})}},{key:"getLayerById",value:function(t){return this.getMap().getLayers().getArray().find(function(e){return t===e.get("id")})}},{key:"getVectorLayerFeaturesFromCoordinates",value:function(e,t){var a=void 0,n=[],i=this.getMap(),r=this.getLayerById(e);if(Array.isArray(t)){if(2===t.length){e=i.getPixelFromCoordinate(t);i.forEachFeatureAtPixel(e,function(e){return n.push(e)},{layerFilter:function(e){return e===r}})}else if(4===t.length)switch(a=ol.geom.Polygon.fromExtent(t),r.constructor){case P.VectorLayer:n=r.getIntersectedFeatures(a);break;case ol.layer.Vector:r.getSource().getFeatures().forEach(function(e){return a.intersectsExtent(e.getGeometry().getExtent())&&n.push(e)})}}else if(t instanceof ol.geom.Polygon||t instanceof ol.geom.MultiPolygon)switch(a=t,r.constructor){case P.VectorLayer:n=r.getIntersectedFeatures(a);break;case ol.layer.Vector:r.getSource().getFeatures().forEach(function(e){return a.intersectsExtent(feature.getGeometry().getExtent())&&n.push(e)})}return n}},{key:"getQueryLayerByCoordinates",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=t.layer,i=t.coordinates;return new Promise(function(t,a){n.query({coordinates:i,mapProjection:e.getProjection(),resolution:e.getResolution()}).then(function(e){return t(e)}).fail(function(e){a(e)})})}},{key:"createMapControl",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=t.id,n=t.visible,i=t.add,i=void 0===i||i,r=t.toggled,t=t.options,r=A[e]?new A[e](f({type:e,toggled:void 0!==r&&r},void 0===t?{}:t)):void 0;return void 0===n&&(n=!r.isVisible||r.isVisible()),r&&this.addControl(a||e,e,r,i,n),r}},{key:"showAddLayerModal",value:function(){this.emit("addexternallayer")}},{key:"getCenter",value:function(){return this.getMap().getView().getCenter()}},{key:"zoomToFid",value:(o=F(function*(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:"").split(1<arguments.length&&void 0!==arguments[1]?arguments[1]:"|"),e=p(e,2),t=e[0],e=e[1];void 0===t&&void 0===e||(t=(e=void 0===(t=(yield C.default.getData("search:fids",{inputs:{layer:this.project.getLayerById(t),fids:[e]},outputs:{show:{loading:!1,condition:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).data,e=void 0===e?[]:e;return e[0]&&0<e[0].features.length}}}})).data)?[]:t)[0]&&e[0].features[0])&&(yield this.zoomToFeatures([t]))}),function(){return o.apply(this,arguments)})},{key:"zoomToFeaturesUrl",value:(r=F(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";try{var t,a,n,i,r=e.split(":"),o=p(r,2),s=o[0],l=o[1];s&&l&&(a=(t=this.project.getLayers().find(function(e){return s===e.id||s===e.name||s===e.origname}))&&this.project.getLayerById(t.id),i=(n=t&&(yield C.default.getData("search:features",{inputs:{layer:a,filter:(0,T.createFilterFromString)({layer:a,filter:l})},outputs:{show:{loading:!1}}})))&&n.data&&n.data[0]&&n.data[0].features)&&this.zoomToFeatures(i)}catch(e){}}),function(){return r.apply(this,arguments)})},{key:"getMapExtent",value:function(){var e=this.getMap();return e.getView().calculateExtent(e.getSize())}},{key:"addMapExtentUrlParameterToUrl",value:function(e,t){return(e=new URL(e)).searchParams.set("map_extent",(void 0!==t&&t!==this.getEpsg()?ol.proj.transformExtent(this.getMapExtent(),this.getEpsg(),t):this.getMapExtent()).toString()),e.toString()}},{key:"setMapControlsContainer",value:function(e){this.state.mapcontrolDOM=e}},{key:"getMapControlByType",value:function(t){return"string"!=typeof t&&(t=t.type),(this._controls.find(function(e){return t===e.type})||{}).control}},{key:"addControl",value:function(e,t,a){var n=this,i=!(3<arguments.length&&void 0!==arguments[3])||arguments[3],r=!(4<arguments.length&&void 0!==arguments[4])||arguments[4],e=(this.state.mapcontrolready=!1,this.viewer.map.addControl(a),a.on("toggled",function(e){return n.emit("mapcontrol:toggled",e)}),this._controls.push({id:e,type:t,control:a,visible:r,mapcontrol:i&&r}),a.on("controlclick",function(e){var e=e.target,t=!(!e.isClickMap||!e.isClickMap());t&&n._externalInteractions.forEach(function(e){return e.setActive(!1)}),n.controlClick(e,{clickmap:t})}),$(a.element).find("button"));e.tooltip({placement:"left",container:"body",trigger:M.default.isMobile()?"click":"hover"}),M.default.isMobile()&&e.on("shown.bs.tooltip",function(){var e=this;setTimeout(function(){return $(e).tooltip("hide")},600)}),i&&!r&&(a.element.style.display="none"),i&&$(".g3w-map-controls").append(a.element),!1===(R.controls[t]=a).offline&&R.offlineids.push({id:t,enable:a.getEnable()}),!1===a.offline&&a.getEnable()&&a.setEnable(h.default.online),this.state.mapcontrolready=!0}},{key:"showControls",value:function(t){var a=this;this._controls.forEach(function(e){return a.viewer.map.removeControl(e.control)}),this._controls.forEach(function(e){e.visible=!t||-1<t.indexOf(e.type)||e.visible,e.visible&&a.viewer.map.addControl(e.control)})}},{key:"getMapControls",value:function(){return this._controls}},{key:"removeControlById",value:function(a){var n=this;this._controls.find(function(e,t){if(a===e.id)return n._controls.splice(t,1),n.viewer.map.removeControl(e.control),e.control.hideControl&&e.control.hideControl(),!0})}},{key:"removeControl",value:function(a){var n=this;this._controls.find(function(e,t){if(a===e.type)return n._controls.splice(t,1),n.viewer.map.removeControl(e.control),e.control.hideControl&&e.control.hideControl(),!0})}},{key:"_unToggleControls",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).close,t=void 0===e||e;this._controls.forEach(function(e){e.control.isToggled&&e.control.isToggled()&&(e.control.toggle(!1),t)&&M.default.closeContent()})}},{key:"deactiveMapControls",value:function(){this._unToggleControls({close:!1})}},{key:"disableClickMapControls",value:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this._controls.filter(function(e){return e.control.isClickMap&&e.control.isClickMap()}).forEach(function(e){e.control.isToggled()&&e.control.toggle(),e.control[t?"disable":"enable"]()})}},{key:"_setupCustomMapParamsToLegendUrl",value:function(){var e,t;0<arguments.length&&void 0!==arguments[0]&&!arguments[0]||(t=(t=(e=this.getMap())&&e.getSize().filter(function(e){return 0<e})||null)&&2===t.length?e.getView().calculateExtent(t):this.project.state.initextent,this.getMapLayers().forEach(function(e){return e.setupCustomMapParamsToLegendUrl})&&l.setupCustomMapParamsToLegendUrl({crs:this.getEpsg(),bbox:"neu"===e.getView().getProjection().getAxisOrientation()?[t[1],t[0],t[3],t[2]]:t}),this.emit("change-map-legend-params"))}},{key:"getMapLayerByLayerId",value:function(t){return this.getMapLayers().find(function(e){return e.getLayerConfigs().find(function(e){return t===e.getId()})})}},{key:"getMapLayers",value:function(){return this._layers.g3w}},{key:"getBaseLayers",value:function(){return this._layers.base}},{key:"getMapLayerForLayer",value:function(t){return this.getMapLayers().find(function(e){return"layer_"+t.getMultiLayerId()===e.getId()})}},{key:"getProjectLayer",value:function(e){return R.layers.getLayerById(e)}},{key:"_calculateViewOptions",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.project,a=e.width,n=e.height,e=e.map_extent,e=e?e.split(",").map(function(e){return+e}):t.state.initextent,t=t.state.extent;return{extent:t,projection:this.getProjection(),center:ol.extent.getCenter(e),maxResolution:Math.max(ol.extent.getWidth(t)/a,ol.extent.getHeight(t)/n),resolution:Math.max(ol.extent.getWidth(e)/a,ol.extent.getHeight(e)/n)}}},{key:"getMapUnits",value:function(){return this.state.mapUnits}},{key:"_removeEventsKeysToLayersStore",value:function(a){var e=a.getId();this._keyEvents.stores[e]&&(this._keyEvents.stores[e].forEach(function(e){Object.entries(e).forEach(function(e){var e=p(e,2),t=e[0];return a.un(t,e[1])})}),delete this._keyEvents.stores[e])}},{key:"_setUpEventsKeysToLayersStore",value:function(e){var t=this,a=e.getId();this._keyEvents.stores[a]=[],e.getLayers().forEach(function(e){return"vector"===e.getType()&&t.addLayerToMap(e.getMapLayer())}),this._keyEvents.stores[a].push({addLayer:e.onafter("addLayer",function(e){"vector"===e.getType()&&t.addLayerToMap(e.getMapLayer())})}),this._keyEvents.stores[a].push({removeLayer:e.onafter("removeLayer",function(e){"vector"===e.getType()&&t.viewer.map.removeLayer(e.getOLLayer())})})}},{key:"_setupAllLayers",value:function(){var i=this,e=(0,x.getMapLayersByFilter)({BASELAYER:!0}),e=(e.forEach(function(e){var t=e.getMapLayer();i.registerMapLayerListeners(t),i._layers.base[e.getId()]=t}),Object.values(e.length?this._layers.base:{}).reverse().forEach(function(e){e.update(i.state,i.layersExtraParams),i.addLayerToMap(e)}),(0,x.getMapLayersByFilter)({BASELAYER:!1,VECTORLAYER:!1})),a=(e.forEach(function(e){return e.setMapProjection(i.getProjection())}),{}),r=[];Object.entries((0,V.groupBy)(e,function(e){var t=e.getMultiLayerId();return e.isQtimeseries()?(a[t]=void 0===a[t]?0:a[t]+1,t+"_"+a[t]):void 0===a[t]?t:t+"_"+(a[t]+1)})).forEach(function(e){var e=p(e,2),t=e[0],e=e[1],a=e[0]||[],n=a.getMapLayer({id:"layer_"+t,projection:i.getProjection(),format:1===e.length?a.getFormat():null},1===e.length?{}:i.layersExtraParams);e.reverse().forEach(function(e){return n.addLayer(e)}),r.push(n),i.registerMapLayerListeners(n)}),r.reverse().forEach(function(e){i._layers.g3w.push(e),i.addLayerToMap(e)}),this.updateMapLayers();(0,x.getMapLayersByFilter)({VECTORLAYER:!0}).forEach(function(e){e.setMapProjection(i.getProjection()),i.addLayerToMap(e.getMapLayer())});e=this.getMap();e.addLayer(this.defaultsLayers.mapcenter),e.addLayer(this.defaultsLayers.selectionLayer),e.addLayer(this.defaultsLayers.highlightLayer),g.default.getItem("externalLayers").then(function(e){Object.entries(e||{}).forEach(function(e){var e=p(e,2),t=e[0],e=e[1],a=new ol.layer.Vector({source:new ol.source.Vector({features:(new ol.format.GeoJSON).readFeatures(e.features)})});a.set("name",t),i.addExternalLayer(a,f({},e.options,{zoomToExtent:!1}))})})}},{key:"setDefaultLayerStyle",value:function(e){e&&this.defaultsLayers[e]&&(this.defaultsLayers._style[e]=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{})}},{key:"removeLayers",value:function(){var t=this;Object.keys(this._layers.base).forEach(function(e){return t.viewer.map.removeLayer(t._layers.base[e].getOLLayer())}),this.getMapLayers().forEach(function(e){t.unregisterMapLayerListeners(e),t.viewer.map.removeLayer(e.getOLLayer())}),this._layers.g3w=[],this._layers.external.forEach(function(e){t.removeExternalLayer(e.get("name"))}),this._layers.external.splice(0),this.defaultsLayers.mapcenter.getSource().clear(),this.defaultsLayers.highlightLayer.getSource().clear(),this.defaultsLayers.selectionLayer.getSource().clear(),this.getMap().removeLayer(this.defaultsLayers.mapcenter),this.getMap().removeLayer(this.defaultsLayers.highlightLayer),this.getMap().removeLayer(this.defaultsLayers.selectionLayer)}},{key:"setLayerZIndex",value:function(e){var t=e.layer,e=e.zindex,e=void 0===e?this.layersCount+=1:e;return t.setZIndex(e),this.emit("set-layer-zindex",{layer:t,zindex:e}),e}},{key:"addLayerToMap",value:function(e){e=e.getOLLayer();e&&this.getMap().addLayer(e)}},{key:"createMapLayer",value:function(e){e.setMapProjection(this.getProjection());var t=e.getMapLayer({id:"layer_"+e.getMultiLayerId(),projection:this.getProjection()},this.layersExtraParams);return t.addLayer(e),t}},{key:"updateMapLayer",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{force:!1},a=(2<arguments.length&&void 0!==arguments[2]?arguments[2]:{}).showSpinner,a=void 0===a||a;return t.force&&(t.g3w_time=Date.now()),a!==e.showSpinnerWhenLoading&&((e.showSpinnerWhenLoading=a)?(e.on("loadstart",this.onLayerLoadStart),e.on("loadend",this.onLayerLoadEnd),e.on("loaderror",this.onLayerLoadError)):(e.off("loadstart",this.onLayerLoadStart),e.off("loadend",this.onLayerLoadEnd),e.off("loaderror",this.onLayerLoadError))),e.update(this.state,t),e}},{key:"updateMapLayers",value:function(){var t=this,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.getMapLayers().forEach(function(e){return t.updateMapLayer(e,a)}),Object.values(this.getBaseLayers()).forEach(function(e){return e.update(t.state,t.layersExtraParams)})}},{key:"registerMapLayerListeners",value:function(t){var a=this,e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];t.on("loadstart",this.onLayerLoadStart),t.on("loadend",this.onLayerLoadEnd),t.on("loaderror",this.onLayerLoadError),e&&(Array.isArray(t.layers)?t.layers:[]).forEach(function(e){e.onbefore("change",function(){return a.updateMapLayer(t,{force:!0})}),e.on("filtertokenchange",function(){return a.updateMapLayer(t,{force:!0})})})}},{key:"unregisterMapLayerListeners",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];e.un("loadstart",this.onLayerLoadStart),e.un("loadend",this.onLayerLoadEnd),e.un("loaderror",this.onLayerLoadError),t&&(Array.isArray(e.layers)?e.layers:[]).forEach(function(e){e.un("change"),e.removeEvent("filtertokenchange")})}},{key:"setTarget",value:function(e){this.target=e}},{key:"getCurrentToggledMapControl",value:function(){return(this._controls.find(function(e){return e.control&&e.control.isToggled&&e.control.isToggled()})||{}).control}},{key:"addInteraction",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{active:!0,close:!0},a=t.active,a=void 0===a||a,n=this.getCurrentToggledMapControl(),i=n&&n.isToggled&&n.isToggled()||!1;return(!n||!n.isClickMap||n.isClickMap())&&a&&this._unToggleControls(t),this.getMap().addInteraction(e),e.setActive(a),this._externalInteractions.push(e),{control:n,toggled:i}}},{key:"removeInteraction",value:function(t){t&&t.setActive(!1),this.viewer.map.removeInteraction(t),this._externalInteractions=this._externalInteractions.filter(function(e){return t!==e})}},{key:"_watchInteraction",value:function(e){var t=this;e.on("change:active",function(e){e.target instanceof ol.interaction.Pointer&&e.target.getActive()&&t.emit("mapcontrol:active",e.target)})}},{key:"showMapInfo",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.info,e=e.style;this.state.map_info.info=t,this.state.map_info.style=e||this.state.map_info.style}},{key:"zoomTo",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:6,a=this.viewer.map.getView();a.setCenter(e),a.setZoom(t)}},{key:"goTo",value:function(e,t){var a=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],n=this.viewer.map.getView();t=t||6,a?n.animate({duration:300,center:e},t?{zoom:t,duration:300}:{duration:300,resolution:n.getResolution()}):n.setCenter(e),t&&!a&&n.setZoom(t)}},{key:"goToRes",value:(i=F(function*(t,a){var n=this,i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2];a=a||this.viewer.map.getView().getResolution(),yield new Promise(function(e){n.viewer.map.getView().once("change:center",function(){return setTimeout(e,500)}),i?n.viewer.map.getView().animate({duration:200,center:t},{duration:200,resolution:a}):(n.viewer.map.getView().setCenter(t),n.viewer.map.getView().setResolution(a))})}),function(e,t){return i.apply(this,arguments)})},{key:"getGeometryAndExtentFromFeatures",value:function(){var n=void 0,i=void 0,e=void 0,r=[];if((0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).filter(function(e){return e.getGeometry?e.getGeometry():e.geometry}).forEach(function(e){var t=e.getGeometry?e.getGeometry():e.geometry,a=t instanceof ol.geom.Geometry,e=a?[].concat(I(t.getExtent())):e.bbox,e=(n=ol.extent.extend(void 0===n?e:n,e),i=i||(a?t.getType():t.type),a?t.getCoordinates():t.coordinates);r.push(e)}),0<r.length){var t=i.includes("Multi");try{e=new ol.geom[t?i:"Multi"+i](t?r.flat():r),n=void 0===n?e.getExtent():n}catch(e){}}return{extent:n,geometry:e}}},{key:"highlightFeatures",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=this.getGeometryAndExtentFromFeatures(e).geometry;t.zoom=!1,this.highlightGeometry(e,t)}},{key:"zoomToGeometry",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{highlight:!1},a=e&&e.getExtent();return t.highlight&&a&&(t.highLightGeometry=e),this.zoomToExtent(a,t)}},{key:"zoomToFeatures",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{highlight:!1},e=this.getGeometryAndExtentFromFeatures(e),a=e.geometry,e=e.extent;return t.highlight&&e&&(t.highLightGeometry=a),this.zoomToExtent(e,t)}},{key:"zoomToExtent",value:(n=F(function*(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};if(!e)return Promise.resolve();var a,n=this.getMap(),i=void 0;i=!1===ol.extent.containsExtent(this.project.state.extent,e)?n.getView().getResolutionForExtent(this.project.state.extent,n.getSize()):!0===t.force?n.getView().getResolutionForExtent(e,n.getSize()):(a=n.getView().getResolution())<(i=Math.max(n.getView().getResolutionForExtent(e,n.getSize()),(0,S.getResolutionFromScale)(j.ZOOM.maxScale,this.getMapUnits())))&&i<a?a:i,yield this.goToRes(ol.extent.getCenter(e),i),t.highLightGeometry&&(yield this.highlightGeometry(t.highLightGeometry,{zoom:!1,duration:t.duration}))}),function(e){return n.apply(this,arguments)})},{key:"goToBBox",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.getEpsg();e=t===this.getEpsg()?e:ol.proj.transformExtent(e,t,this.getEpsg()),this.viewer.fit(ol.extent.containsExtent(this.project.state.extent,e)?e:this.project.state.extent)}},{key:"_fit",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=this.viewer.map.getView();"boolean"==typeof t.animate&&!t.animate||(a.animate({duration:200,center:a.getCenter()}),a.animate({duration:200,resolution:a.getResolution()})),delete t.animate,a.fit(e,f({},t,{constrainResolution:void 0===t.constrainResolution||t.constrainResolution,size:this.viewer.map.getSize()}))}},{key:"setSelectionFeatures",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"add",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=(t.color&&this.setDefaultLayerStyle("selectionLayer",{color:t.color}),this.defaultsLayers.selectionLayer.getSource());switch(e){case"add":a.addFeature(t.feature);break;case"remove":a.removeFeature(t.feature);break;case"update":a.getFeatureById(t.feature.getId()).setGeometry(t.feature.getGeometry());break;case"clear":a.clear()}}},{key:"toggleSelection",value:function(){this.defaultsLayers.selectionLayer.setVisible(!(0<arguments.length&&void 0!==arguments[0])||arguments[0])}},{key:"highlightGeometry",value:(a=F(function*(e){var t,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=a.duration||j.ANIMATION.duration,i=this.defaultsLayers.highlightLayer,r="function"==typeof a.hide?a.hide:null,o="boolean"!=typeof a.highlight||a.highlight,s="boolean"!=typeof a.zoom||a.zoom,e=e instanceof ol.geom.Geometry?e:(new ol.format.GeoJSON).readGeometry(e);if(this.clearHighlightGeometry(),this.setDefaultLayerStyle("highlightLayer",{color:a.color}),s&&(yield this.zoomToExtent(e.getExtent())),o)return a.style&&i.setStyle(a.style),i.getSource().addFeature(new ol.Feature({geometry:e})),new Promise((t=F(function*(e){function t(){i.getSource().clear(),a.style&&i.setStyle(function(e){return[(0,w.createSelectedStyle)({geometryType:e.getGeometry().getType(),color:a.color,fill:!0})]}),r||(R.animatingHighlight=!1),e()}r&&r(t),n&&n!==1/0&&!r&&(R.animatingHighlight=!0,setTimeout(t,n))}),function(e){return t.apply(this,arguments)}))}),function(e){return a.apply(this,arguments)})},{key:"clearHighlightGeometry",value:function(){R.animatingHighlight||this.defaultsLayers.highlightLayer.getSource().clear(),this.defaultsLayers._style.highlightLayer={color:void 0}}},{key:"refreshMap",value:function(){this.updateMapLayers(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{force:!0})}},{key:"layout",value:function(e){var t=e.width,e=e.height,a=document.getElementById(this.target),a=(a&&(a.style.height=e+"px",a.style.width=t+"px"),t<=0||e<=0),n=!!this.viewer;n&&!a&&(this.getMap().updateSize(),this.state.hidemaps.forEach(function(e){return e.map.updateSize()}),this.state.bbox=this.getMapBBOX(),this.state.resolution=this.viewer.getResolution(),this.state.center=this.viewer.getCenter(),this.updateMapLayers()),n||this.setupViewer(t,e),this.setHidden(a)}},{key:"getMapBBOX",value:function(){return this.viewer.map.getView().calculateExtent(this.viewer.map.getSize())}},{key:"setInnerGreyCoverBBox",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this.viewer.map,a=void 0,n=void 0;e.inner&&(n="pixel"===e.type?(a=[e.inner[0],e.inner[1]],[e.inner[2],e.inner[3]]):(a=t.getPixelFromCoordinate([e.inner[0],e.inner[1]]),t.getPixelFromCoordinate([e.inner[2],e.inner[3]])),this._drawShadow.inner[0]=a[0]*ol.has.DEVICE_PIXEL_RATIO,this._drawShadow.inner[1]=a[1]*ol.has.DEVICE_PIXEL_RATIO,this._drawShadow.inner[2]=n[0]*ol.has.DEVICE_PIXEL_RATIO,this._drawShadow.inner[3]=n[1]*ol.has.DEVICE_PIXEL_RATIO),this._drawShadow.scale=[null,void 0].includes(e.scale)?this._drawShadow.scale||1:e.scale,this._drawShadow.rotation=[null,void 0].includes(e.rotation)?this._drawShadow.rotation||0:e.rotation,this._drawShadow.outer&&t.render()}},{key:"startDrawGreyCover",value:function(t){var r,o,s,l,u,c=this,e=this.viewer.map;this.stopDrawGreyCover(),this._drawShadow.listener=e.on("postcompose",function(e){var a=e.context,e=c.getMap().getSize(),n=e[1]*ol.has.DEVICE_PIXEL_RATIO,i=e[0]*ol.has.DEVICE_PIXEL_RATIO;c._drawShadow.outer=[0,0,i,n],a.restore(),a.beginPath(),a.moveTo(0,0),a.lineTo(i,0),a.lineTo(i,n),a.lineTo(0,n),a.lineTo(0,0),a.closePath(),c._drawShadow.inner.length&&(a.save(),r=c._drawShadow.inner[0],s=c._drawShadow.inner[3],o=c._drawShadow.inner[2],l=c._drawShadow.inner[1],u=c._drawShadow.rotation,c._drawShadow.scale,a.translate((o+r)/2,(l+s)/2),a.rotate(u*Math.PI/180),a.moveTo(-(o-r)/2,(l-s)/2),a.lineTo((o-r)/2,(l-s)/2),a.lineTo((o-r)/2,-(l-s)/2),a.lineTo(-(o-r)/2,-(l-s)/2),a.lineTo(-(o-r)/2,(l-s)/2),a.closePath()),a.fillStyle="rgba(0, 5, 25, 0.40)",a.fill(),t&&(a.font="bold 25px Arial",a.fillStyle="#ffffff",a.textAlign="center",t.split("\n").forEach(function(e,t){return a.fillText(e,i/2,n/2+30*t)})),a.restore()})}},{key:"stopDrawGreyCover",value:function(){this._drawShadow.listener&&(ol.Observable.unByKey(this._drawShadow.listener),this._drawShadow.inner.length&&(this._drawShadow={type:"coordinate",outer:[],inner:[],scale:null,rotation:null}),this._drawShadow.listener=null),this.getMap().render()}},{key:"removeExternalLayer",value:function(a){var t=this,n=this.getLayerByName(a),e=n._type||"vector";M.default.getService("queryresults").unregisterVectorLayer(n),M.default.getService("catalog").removeExternalLayer({name:a,type:e}),this.viewer.map.removeLayer(n),"vector"===e&&(this._keyEvents.unwatches[a].forEach(function(e){return e()}),delete this._keyEvents.unwatches[a]),"vector"===e&&g.default.getItem("externalLayers").then(function(e){a in(e=e||{})&&delete e[a],g.default.setItem("externalLayers",e)}),"vector"===e&&(this._layers.external_vector=this._layers.external_vector.filter(function(t){if(a!==t.name)return!0;Object.values(R.controls).forEach(function(e){return e.onRemoveExternalLayer&&e.onRemoveExternalLayer(t)}),t===R.selectedLayer&&(R.selectedLayer=null)})),"wms"===e&&(this._layers.external_wms=this._layers.external_wms.filter(function(e){if(e.getId()!==n.id)return!0;t.unregisterMapLayerListeners(e,n.projectLayer)})),this._layers.external=this._layers.external.filter(function(e){return e.get("id")!==n.get("id")}),this.unloadExternalLayer(n),this.emit("remove-external-layer",a)}},{key:"getLegacyExternalLayers",value:function(){return this._layers.external_vector}},{key:"getExternalLayers",value:function(){return this._layers.external}},{key:"addExternalLayer",value:(t=F(function*(a){var t=this,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=a.getOLLayer?a.getOLLayer():a,n=(e!==a&&(e.set("id",a.getId()),e.set("name",a.getId())),a=e,void 0);if(i.position=void 0===i.position?"top":i.position,i.opacity=void 0===i.opacity?1:i.opacity,i.visible=void 0===i.visible||i.visible,i.persistent=void 0===i.persistent||i.persistent,a instanceof ol.layer.Vector){a.set("id",a.get("id")||(0,E.getUniqueDomId)()),(n=a).filter={active:!1},n.selection={active:!1,features:[]},i.color&&i.field&&n.setStyle(Object.assign(function(e){i.color=i.color.rgba?"rgba("+[i.color.rgba.r,i.color.rgba.g,i.color.rgba.b,i.color.rgba.a].join()+")":i.color;var t=e.getGeometry().getType(),a=i.color,n=void 0;return(0,v.isPointGeometryType)(t)?n=new ol.style.Style({image:new ol.style.Circle({fill:new ol.style.Fill({color:a}),stroke:new ol.style.Stroke({color:a,width:1}),radius:5})}):(0,_.isLineGeometryType)(t)?n=new ol.style.Style({stroke:new ol.style.Stroke({color:a,width:3})}):(0,b.isPolygonGeometryType)(t)&&(n=new ol.style.Style({fill:new ol.style.Fill({color:"rgba(255,255,255,0.5)"}),stroke:new ol.style.Stroke({color:a,width:3})})),i.field&&n.setText(new ol.style.Text({text:""+e.get(i.field),font:"bold",scale:2,offsetY:15,fill:new ol.style.Fill({color:i.color}),stroke:new ol.style.Stroke({color:"#FFF",width:2})})),n},{_g3w_options:i}));e=void 0;try{var r=a.getStyle(),e=r._g3w_options?r._g3w_options.color:"blue"}catch(e){}a={id:a.get("id"),name:n.get("name")||n.get("id"),projectLayer:!1,title:n.get("name")||n.get("id"),removable:!0,external:!0,crs:i.crs,type:i.type,_type:"vector",visible:i.visible,checked:!0,position:i.position,opacity:i.opacity,color:e||"blue",filter:n.filter,selection:n.selection,tochighlightable:!1,download:i.download||!1,downloadUrl:i.downloadUrl}}a instanceof ol.layer.Image&&(a.id=a.get("id"),a.removable=!0,a.projectLayer=!1,a.name=a.get("name"),a.title=a.get("name"),a._type="wms",a.opacity=i.opacity,a.position=i.position,a.external=!0,a.checked=i.visible),this.getLayerByName(a.name)&&M.default.notify.warning("layer_is_added",!1);var o,s,r=a._type||a.type,e={vector:n,wms:a}[r]||(yield(0,m.createVectorLayerFromFile)({name:a.name,type:r,crs:a.crs,data:a.data}));return e?(o="vector"===r&&e.getSource().getFeatures()||[],s="vector"===r&&e.getSource().getExtent()||[],o.forEach(function(e,t){return e.setId(t)}),o.length&&(a.geometryType=o[0].getGeometry().getType(),a.selected=!1),s.length&&(a.bbox={minx:s[0],miny:s[1],maxx:s[2],maxy:s[3]}),e.set("position",i.position),e.setOpacity(i.opacity),e.setVisible(i.visible),a.set=a.set||function(e,t){return a[e]=t},a.get=a.get||function(e){return a[e]},a.getId=a.getId||function(){return a.id},a.getName=a.getName||function(){return a.name},a.getGeometryType=a.getGeometryType||function(){return a.geometryType},a.setTocHighlightable=a.setTocHighlightable||function(e){return a.tochighlightable=e},a.getTocHighlightable=a.getTocHighlightable||function(){return a.tochighlightable},a.isSelected=a.isSelected||function(){return a.selected},a.setSelected=a.setSelected||function(e){return a.selected=e},a.isQueryable=a.isQueryable||function(){return!!n},a.isVisible=a.isVisible||function(){return n&&(a.visible=n.getVisible()),a.visible},a.setVisible=a.setVisible||function(e){n&&n.setVisible(e),a.visible=e},this.viewer.map.addLayer(e),this._layers.external.push(e),"vector"===r&&this._layers.external_vector.push(a),"wms"===r&&(this._layers.external_wms.push(a),this.registerMapLayerListeners(a,!1)),n&&!1!==i.persistent&&g.default.getItem("externalLayers").then(function(e){var t,a;g.default.setItem("externalLayers",f({},e||{},(e={},t=n.get("name"),a={features:(new ol.format.GeoJSON).writeFeatures(n.getSource().getFeatures()),options:i},t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e)))}),M.default.getService("queryresults").registerVectorLayer(e),M.default.getService("catalog").addExternalLayer({layer:a,type:r}),"vector"===r&&(this._keyEvents.unwatches[a.name]=[],Object.values(R.controls).forEach(function(e){return e.onAddExternalLayer&&e.onAddExternalLayer({layer:a,unWatches:t._keyEvents.unwatches[a.name]})})),s&&i.zoomToExtent&&this.viewer.map.getView().fit(s),this.loadExternalLayer(e),e):Promise.reject()}),function(e){return t.apply(this,arguments)})},{key:"getCookie",value:function(e){Vue.cookie.get(e)}},{key:"selectLayer",value:function(e){var t="string"==typeof e?e:e&&e.getId();R.selectedLayer&&t===R.selectedLayer.getId()&&(t=null),e=(0,Y.getCatalogLayerById)(t)||this.getLegacyExternalLayers().find(function(e){return t===e.getId()}),(0,W.getCatalogLayers)().concat(this.getLegacyExternalLayers()).forEach(function(e){return e.setSelected(e.getId()===t)}),R.selectedLayer=e&&e.isSelected()?e:null,Object.values(R.controls).forEach(function(e){return e.onSelectLayer&&e.onSelectLayer(R.selectedLayer)})}},{key:"getSelectedLayer",value:function(){return R.selectedLayer}}]),u})(t.default));u.default.onbefore("offline",function(){return R.offlineids.forEach(function(e){e.enable=R.controls[e.id].getEnable(),R.controls[e.id].setEnable(!1)})}),u.default.onbefore("online",function(){return R.offlineids.forEach(function(e){var t=e.id;return R.controls[t].setEnable(e.enable)})}),e.default={MapService:r,MapLayersStoresRegistry:R.layers}},{"components/MapControlGeocoding.vue":93,"components/MapControlZoomHistory.vue":94,"g3w-object":144,localforage:"localforage","map/controls/geolocationcontrol":157,"map/controls/interactioncontrol":158,"map/controls/measurecontrol":159,"map/controls/queryby":160,"map/controls/scalecontrol":161,"map/controls/screenshotcontrol":162,"map/controls/streetviewcontrol":163,"map/interactions/pickcoordinatesinteraction":164,"map/layers/imagelayer":169,"map/layers/vectorlayer":173,"services/application":186,"services/data":187,"services/gui":188,"store/application":193,"store/plugins":194,"utils/createFilterFromString":207,"utils/createSelectedStyle":210,"utils/createVectorLayerFromFile":212,"utils/getCatalogLayerById":218,"utils/getCatalogLayers":219,"utils/getMapLayersByFilter":225,"utils/getProject":227,"utils/getResolutionFromScale":230,"utils/getScaleFromResolution":231,"utils/getUniqueDomId":232,"utils/groupBy":234,"utils/isLineGeometryType":238,"utils/isPointGeometryType":240,"utils/isPolygonGeometryType":241,"utils/throttle":256}],191:[function(l,e,t){Object.defineProperty(t,"__esModule",{value:!0});var x=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e},i=function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e};function n(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var u=l("g3w-eventbus"),k=r(l("services/gui")),S=l("g3w-constants"),a=r(l("g3w-object")),c=r(l("g3w-component")),s=r(l("map/interactions/pickcoordinatesinteraction")),o=r(l("store/application")),d=r(l("services/data")),p=r(l("components/QueryResultsActionDownloadFormats.vue")),f=r(l("components/QueryResultsActionQueryPolygonCSVAttributes.vue")),E=l("utils/getAlphanumericPropertiesFromFeature"),g=l("utils/intersects"),h=l("utils/within"),y=l("utils/printAtlas"),m=l("utils/downloadFile"),v=l("utils/throttle"),_=l("utils/getUniqueDomId"),b=l("utils/copyUrl"),w=l("utils/getCatalogLayerById"),L=l("map/layers/layer"),T=l("map/layers/vectorlayer");function r(e){return e&&e.__esModule?e:{default:e}}function C(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}var M=l("g3w-i18n").t;t.default=new((e=>{var a,r,t=n;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);function n(){var t,a;if(this instanceof n)return(t=((e,t)=>{if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")})(this,(n.__proto__||Object.getPrototypeOf(n)).call(this))).setters={setQueryResponse:function(a){var n,i,w=this,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{add:!1},t=(a.data||(a.data=[]),a.query||(a.query={external:{add:!1,filter:{SELECTED:!1}}}),a.query.external||(a.query.external={add:!1,filter:{SELECTED:!1}}),!1===e.add&&(this.clearState(),this.state.query=a.query,this.state.type=a.type),!0===a.query.external.add&&!1===e.add&&(n=k.default.getService("catalog"),i=a.query.external.filter.SELECTED,this._vectorLayers.forEach(function(e){var t=e.get("id");e.getVisible()&&[void 0,!!(n.state.external.vector.find(function(e){return e.id===t})||{}).selected].includes(i)&&a.data["__g3w_marker"===t?"unshift":"push"](w.getVectorLayerFeaturesFromQueryRequest(e,a.query))})),!1===e.add&&{coordinates:2===(this.state.query.coordinates||[]).length&&new ol.geom.Point(this.state.query.coordinates),bbox:4===(this.state.query.bbox||[]).length&&ol.geom.Polygon.fromExtent(this.state.query.bbox),polygon:this.state.query.geometry,drawpolygon:this.state.query.geometry,circle:this.state.query.geometry}[this.state.query.type]),t=(t&&((t=new ol.Feature(t)).setId(void 0),this.resultsQueryLayer.getSource().clear(),k.default.getService("map").getMap().removeLayer(this.resultsQueryLayer),this.resultsQueryLayer.getSource().addFeature(t),k.default.getService("map").getMap().addLayer(this.resultsQueryLayer),this.resultsQueryLayer.setZIndex(k.default.getService("map").getMap().getLayers().getLength())),a.data.flatMap(function(e){return[].concat(e)}).filter(function(e){return e&&(void 0!==e.rawdata||Array.isArray(e.features)&&0<e.features.length)}).map(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=e.layer,t=e.features,n=e.rawdata,i=e.error,e=a instanceof L.Layer,r=a instanceof ol.layer.Vector,o="string"==typeof a||a instanceof String,s=void 0;if(o)s=L.Layer.LayerTypes.VECTOR;else if(e)try{s=a.getSourceType()}catch(i){}var l=o&&a.split("_"),u=(e?a.getId():void 0)||(r?a.get("id"):void 0)||(o?a:void 0),c=void 0,d=void 0,p=(!(c=t&&t.length?c:[])&&a instanceof L.Layer&&(d=a.getAttributes().map(function(e){return"ows"===w.state.type?x({},e,{name:e.name.replace(/ /g,"_")}):e})),!c&&a instanceof ol.layer.Vector&&(d=a.getProperties()),(!c&&"string"==typeof a||a instanceof String)&&(d=t[0]?t[0].getProperties():[]),(!c&&a instanceof L.Layer&&d||[]).filter(function(e){try{return"_"===e.name[0]||Number.isInteger(+e.name[0])}catch(e){return!1}}).map(function(e){return{alias:e.name.replace(/_/,""),name:e.name}})),f=(!c&&p.length&&t.forEach(function(a){var e=Object.keys(a.getProperties());p.forEach(function(t){e.find(function(e){if(e===t.alias)return a.set(t.name,a.get(e)),!0})})}),!c&&(0,E.getAlphanumericPropertiesFromFeature)(Object.keys(t[0]instanceof ol.Feature?t[0].getProperties():t[0].properties))),c=c||(d&&0<d.length?d.filter(function(e){return-1<f.indexOf(e.name)}):f.map(function(e){return{name:e,label:e,show:S.G3W_FID!==e&&[void 0,"gdal","wms","wcs","wmst","postgresraster"].includes(s),type:"varchar"}})),g=r||o,d=e&&a.hasFormStructure()&&a.getLayerEditingFormStructure(),h=d&&Array.isArray(w._relations[a.getId()])&&0<w._relations[a.getId()].length;if(h){var y=!0,m=!1,v=void 0;try{for(var _,b=d[Symbol.iterator]();!(y=(_=b.next()).done);y=!0)!function e(t){if(t.nodes){var a=!0,n=!1,i=void 0;try{for(var r,o=t.nodes[Symbol.iterator]();!(a=(r=o.next()).done);a=!0)e(r.value)}catch(e){n=!0,i=e}finally{try{!a&&o.return&&o.return()}finally{if(n)throw i}}}else t.name&&(t.relation=!0)}(_.value)}catch(e){m=!0,v=e}finally{try{!y&&b.return&&b.return()}finally{if(m)throw v}}}return{id:u,attributes:c,external:g,features:(!n&&t||[]).map(function(e){return{id:g||e instanceof ol.Feature?e.getId():e.id,attributes:e instanceof ol.Feature?e.getProperties():e.properties,geometry:e instanceof ol.Feature?e.getGeometry():e.geometry,selection:e.selection,show:!0}}),hasgeometry:Array.isArray(t)&&!n&&t.some(function(e){return e instanceof ol.Feature?e.getGeometry():e.geometry}),hasImageField:Array.isArray(t)&&!n&&t.length&&c.some(function(e){return"image"===e.type}),loading:!1,show:!0,expandable:!0,addfeaturesresults:{active:!1},downloadformats:{active:!1},editable:e&&a.isEditable(),inediting:e&&a.isInEditing(),source:e?a.getSource():void 0,infoformat:e?a.getInfoFormat():void 0,infoformats:e?a.getInfoFormats():[],downloads:e?a.getDownloadableFormats():[],formStructure:h?{structure:d,fields:a.getFields().filter(function(e){return e.show}).concat((Array.isArray(t)&&!n&&0<t.length&&c||[]).filter(function(t){return a.getFields().some(function(e){return e.name===t.name})}))}:void 0,relationsattributes:e||r||o?[]:void 0,filter:e&&!["wms","wcs","wmst"].includes(s)?a.state.filter:{},selection:e&&!["wms","wcs","wmst"].includes(s)&&a.state.selection||r&&a.selection||{},title:e&&a.getTitle()||r&&a.get("name")||o&&l&&(4<l.length?l.slice(0,l.length-4).join(" "):a)||void 0,atlas:w.getAtlasByLayerId(u),rawdata:n||null,error:i||"",toc:g||a.state.toc}}));this.setLayersData(t,e)},setLayersData:function(){var a=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{add:!1};!1===t.add&&e.sort(function(e,t){return e.external?0:a._projectLayerIds.indexOf(e.id)>a._projectLayerIds.indexOf(t.id)?1:-1}),e.forEach(function(e){return t.add?a.updateLayerResultFeatures(e):a.state.layers.push(e)}),this.setActionsForLayers(e,{add:t.add}),this.state.changed=!0},addComponent:function(e){this.state.components.push(e)},addActionsForLayers:function(e,t){},postRender:function(e){},closeComponent:function(){},changeLayerResult:function(n){var i=this;this.state.layersactions[n.id].forEach(function(e){return e.change&&e.change(n)}),(n.features||[]).forEach(function(e,t){var a=i.state.currentactiontools[n.id];void 0!==a&&(void 0===a[t]&&Vue.set(a,t,null),a[t]=null)})},activeMapInteraction:function(){},editFeature:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.layer},openCloseFeatureResult:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.open},removeFeatureLayerFromResult:function(e,t){this.updateLayerResultFeatures({id:e.id,external:e.external,features:[t]})}},t.unlistenerlayeractionevents=[],t._relations={},t._atlas=[],t.plotLayerIds=[],t.state={logged:void 0!==o.default.user.id,zoomToResult:!0,components:[],layers:[],changed:!1,query:null,type:"ows",layersactions:{},actiontools:{},currentactiontools:{},currentactionfeaturelayer:{},layeractiontool:{},layersFeaturesBoxes:{},layerscustomcomponents:{}},t._vectorLayers=[],t._addFeaturesLayerResultInteraction={id:null,interaction:null,mapcontrol:null,toggleeventhandler:null},t._asyncFnc={todo:function(){},zoomToLayerFeaturesExtent:{async:!1},highLightLayerFeatures:{async:!1},goToGeometry:{async:!1}},t.resultsQueryLayer=new ol.layer.Vector({source:new ol.source.Vector,style:function(e){return new ol.style.Style("Point"===e.getGeometry().getType()?{text:new ol.style.Text({fill:new ol.style.Stroke({color:"black"}),text:"",font:'900 3em "Font Awesome 5 Free"',offsetY:-15})}:{stroke:new ol.style.Stroke({color:"black"})})}}),g3wsdk.core.project.ProjectsRegistry.onafter("setCurrentProject",function(e){t._project=e,t._setRelations(e),t._atlas=e.getPrint().filter(function(e){return e.atlas})||[],t.state.download_data=!1,t.plotLayerIds=[]}),t._project=o.default.project,t._projectLayerIds=(a=[],t._project.state.layerstree.forEach(function t(e){(e.nodes||[e]).forEach(function(e){e.id?a.push(e.id):t(e)})}),a),t._setRelations(t._project),t._atlas=t._project.getPrint().filter(function(e){return e.atlas})||[],k.default.onbefore("setContent",function(e){100===e.perc&&k.default.isMobile()&&(t._asyncFnc.zoomToLayerFeaturesExtent.async=!0,t._asyncFnc.highLightLayerFeatures.async=!0,t._asyncFnc.goToGeometry.async=!0)}),t;throw new TypeError("Cannot call a class as a function")}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e),i(n,[{key:"addLayersPlotIds",value:function(){this.plotLayerIds=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]}},{key:"registerCustomComponent",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.id,t=void 0===t?(0,_.getUniqueDomId)():t,a=e.layerId,n=e.component,i=e.type,i=void 0===i?"feature":i,e=e.position,e=void 0===e?"after":e;return void 0===this.state.layerscustomcomponents[a]&&(this.state.layerscustomcomponents[a]={layer:{before:[],after:[]},feature:{before:[],after:[]}}),this.state.layerscustomcomponents[a][i][e].push({id:t,component:n}),t}},{key:"updateLayerResultFeatures",value:function(t){var a,n=this,i=this.state.layers.find(function(e){return e.id===t.id});responseFeatures=t.features||[],external=(this.state.layers.find(function(e){return e.id===t.id})||{}).external,(has_features=i&&0<(i.features||[]).length)&&(a=i.features.map(function(e){return external?e.id:e.attributes[S.G3W_FID]}),responseFeatures.forEach(function(e){var t=n._getFeatureId(e,external);a.some(function(e){return e===t})?(setTimeout(function(){return delete n.state.layersFeaturesBoxes[n.getBoxId(i,e)]}),i.features=(i.features||[]).filter(function(e){return n._getFeatureId(e,external)!==t})):i.features.push(e)}),(i.features||[]).forEach(function(e){var t=1<(i.features||[]).length,a=n.state.layersFeaturesBoxes[n.getBoxId(i,e)];a&&setTimeout(function(){return a.collapsed=t})})),i&&0===(i.features||[]).length&&setTimeout(function(){n.state.layers=n.state.layers.filter(function(e){return e.id!==i.id}),n.clearHighlightGeometry(i),n.removeAddFeaturesLayerResultInteraction(!0)}),1===this.state.layers.length&&k.default.getService("map").highlightFeatures(this.state.layers[0].features,{duration:1/0}),this.changeLayerResult(i)}},{key:"getBoxId",value:function(e,t,a){return null!=a?e.id+"_"+t.id+"_"+a:e.id+"_"+t.id}},{key:"setActionsForLayers",value:function(e){var s=this;(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{add:!1}).add||(this.unlistenerlayeractionevents=[],e.forEach(function(i){s.state.layeractiontool[i.id]=Vue.observable({component:null,config:null}),s.state.currentactiontools[i.id]=Vue.observable(x({},Array((i.features||[]).length).fill(null))),s.state.currentactionfeaturelayer[i.id]=Vue.observable(x({},Array((i.features||[]).length).fill(null))),s.state.layersactions[i.id]=s.state.layersactions[i.id]||[];var e,r=1===i.downloads.length&&(i.downloads||[]).at(0),t=(s._relations[i.id]||[]).filter(function(e){return"MANY"===e.type}),o=t.map(function(t){return s.plotLayerIds.find(function(e){return e===t.referencingLayer})}).filter(Boolean);r&&(i[r]=Vue.observable({active:!1})),1<i.downloads.length&&(s.state.actiontools.downloadformats=s.state.actiontools.downloadformats||{},s.state.actiontools.downloadformats[i.id]={downloads:i.downloads.map(function(r){return{id:"download_"+r+"_feature",download:!0,format:r,class:k.default.getFontClass(r),hint:"sdk.tooltips.download_"+r,cbk:function(e,t,a,n,i){s.downloadFeatures(r,e,t,a,n,i),"polygon"!==s.state.query.type&&(a=s.state.layersactions[e.id].find(function(e){return"downloads"===e.id})).cbk(e,t,a,n,i)}}})}),(e=s.state.layersactions[i.id]).push.apply(e,(e=>{if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)})([i.hasgeometry&&{id:"gotogeometry",mouseover:!0,class:k.default.getFontClass("marker"),hint:"sdk.mapcontrols.query.actions.zoom_to_feature.hint",cbk:(0,v.throttle)(s.goToGeometry.bind(s))},t.length&&{id:"show-query-relations",class:k.default.getFontClass("relation"),hint:"sdk.mapcontrols.query.actions.relations.hint",cbk:function(e,t,a){k.default.setCurrentContentOptions({crumb:{text:!0,title:e.title}}),k.default.pushContent({content:new c.default({internalComponent:new(Vue.extend(l("components/RelationsPage.vue")))({relations:a.relations,chartRelationIds:a.chartRelationIds,feature:t,layer:e})}),backonclose:!0,title:"info.list_of_relations",id:"__G3W_LIST_OF_RELATIONS_ID__",crumb:{title:"info.list_of_relations",trigger:null},closable:!1})},relations:t,chartRelationIds:o},o.length&&{id:"show-plots-relations",opened:!0,class:k.default.getFontClass("chart"),state:Vue.observable({toggled:i.features.reduce(function(e,t,a){return e[a]=null,e},{})}),hint:"sdk.mapcontrols.query.actions.relations_charts.hint",cbk:(0,v.throttle)(function(e,t,a,n,i){a.state.toggled[n]=!a.state.toggled[n],a.state.toggled[n]?s.emit("show-chart",o,i,{relations:s._relations[e.id],fid:t.attributes[S.G3W_FID],height:400}):s.hideChart(i)})},s.getAtlasByLayerId(i.id).length&&{id:"printatlas",download:!0,class:k.default.getFontClass("print"),hint:"sdk.tooltips.atlas",cbk:s.printAtlas.bind(s)},r&&{id:"download_"+r+"_feature",download:!0,state:Vue.observable({toggled:i.features.reduce(function(e,t,a){return e[a]=null,e},{})}),class:k.default.getFontClass("download"),hint:"sdk.tooltips.download_"+r,cbk:function(e,t,a,n,i){a.state.toggled[n]=!a.state.toggled[n],a.state.toggled[n]?s.downloadFeatures(r,e,t,a,n,"pdf"===r?i[0].innerHTML:null):s.setCurrentActionLayerFeatureTool({index:n,action:a,layer:e})}},1<i.downloads.length&&{id:"downloads",download:!0,class:k.default.getFontClass("download"),state:Vue.observable({toggled:i.features.reduce(function(e,t,a){return e[a]=null,e},{})}),toggleable:!0,hint:"Downloads",change:function(e){var a=this;e.features.forEach(function(e,t){return void 0===a.state.toggled[t]?u.VM.$set(a.state.toggled,t,!1):a.state.toggled[t]=!1})},cbk:function(e,t,a,n){a.state.toggled[n]=!a.state.toggled[n],s.setCurrentActionLayerFeatureTool({layer:e,index:n,action:a,component:a.state.toggled[n]?p.default:null})}},("__g3w_marker"===i.id||!i.external&&"wms"!==(i.source||{}).type)&&{id:"removefeaturefromresult",mouseover:!0,class:k.default.getFontClass("minus-square"),style:{color:"red"},hint:"sdk.mapcontrols.query.actions.remove_feature_from_results.hint",cbk:s.removeFeatureLayerFromResult.bind(s)},i.toc&&void 0!==i.selection.active&&{id:"selection",class:k.default.getFontClass("success"),hint:"sdk.mapcontrols.query.actions.add_selection.hint",state:Vue.observable({toggled:i.features.reduce(function(e,t,a){return e[a]=null,e},{})}),init:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=t.feature,n=t.index,t=t.action;i.external&&void 0!==i.selection.active?t.state.toggled[n]=a.selection.selected:a&&void 0!==i.selection.active&&(e=(0,w.getCatalogLayerById)(i.id),t.state.toggled[n]=e.state.filter.active&&null==e.state.filter.current||e.hasSelectionFid(a?s._getFeatureId(a,i.external):null))},change:function(e){var a=this;e.features.forEach(function(e,t){return void 0===a.state.toggled[t]&&u.VM.$set(a.state.toggled,t,!1)})},cbk:(0,v.throttle)(s.addToSelection.bind(s))},i.hasgeometry&&!i.external&&"wms"!==(i.source||{}).type&&{id:"link_zoom_to_fid",class:k.default.getFontClass("share-alt"),hint:"sdk.mapcontrols.query.actions.copy_zoom_to_fid_url.hint",hint_change:{hint:"sdk.mapcontrols.query.actions.copy_zoom_to_fid_url.hint_change",duration:1e3},cbk:function(e,t,a){var n=new URL(location.href);n.searchParams.set("zoom_to_fid",e.id+"|"+t.attributes[S.G3W_FID]),(0,b.copyUrl)(n.toString()),a.hint_changed=!0}},i.editable&&!1===i.inediting&&{id:"editing",class:k.default.getFontClass("pencil"),hint:"sdk.tooltips.editing",cbk:function(e,t){return s.editFeature({layer:e,feature:t})}}].filter(Boolean))),i.external&&i.toc&&void 0!==i.selection.active?i.features.forEach(function(t){return t.selection=(i.selection.features.find(function(e){return t.id===e.getId()})||{selection:{selected:!1}}).selection}):!i.external&&i.toc&&void 0!==i.selection.active&&(e=function(){return i.features.forEach(function(e,t){return s.state.layersactions[i.id].find(function(e){return"selection"===e.id}).state.toggled[t]=!1})},(0,w.getCatalogLayerById)(i.id).on("unselectionall",e),s.unlistenerlayeractionevents.push({layer:(0,w.getCatalogLayerById)(i.id),event:"unselectionall",handler:e}))}),this.addActionsForLayers(this.state.layersactions,this.state.layers))}},{key:"getActionLayerById",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layer,a=e.id;if(this.state.layersactions[t.id])return this.state.layersactions[t.id].find(function(e){return e.id===a})}},{key:"setCurrentActionLayerFeatureTool",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layer,a=e.action,n=e.index,e=e.component,e=void 0===e?null:e,i=this.state.currentactiontools[t.id],t=this.state.currentactionfeaturelayer[t.id];t[n]=e?a:null,i[n]=e,i[n]&&a.id!==t[n].id&&t[n].toggleable&&(t[n].state.toggled[n]=!1)}},{key:"addCurrentActionToolsLayer",value:function(e){var t,a=e.id,n=e.layer,i=e.config,e=e.action;n&&(this.state.actiontools[a]=(a={},t=n.id,i=void 0===i?{}:i,t in a?Object.defineProperty(a,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):a[t]=i,a),e)&&(this.state.layersactions[n.id]=this.state.layersactions[n.id]||[],this.state.layersactions[n.id].push(e))}},{key:"setLayerActionTool",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layer,a=e.component,e=e.config,e=void 0===e?null:e;this.state.layeractiontool[t.id].component=void 0===a?null:a,this.state.layeractiontool[t.id].config=e}},{key:"clear",value:function(){this._asyncFnc.todo(),this.unlistenerlayeractionevents.forEach(function(e){return e.layer.off(e.event,e.handler)}),this.unlistenerlayeractionevents=[],k.default.getService("map").clearHighlightGeometry(),this.resultsQueryLayer.getSource().clear(),this.removeAddFeaturesLayerResultInteraction(!0),this._asyncFnc={todo:function(){},zoomToLayerFeaturesExtent:{async:!1},highLightLayerFeatures:{async:!1},goToGeometry:{async:!1}},this.clearState(),this.closeComponent(),this.resultsQueryLayer.getSource().clear(),k.default.getService("map").getMap().removeLayer(this.resultsQueryLayer)}},{key:"isOneLayerResult",value:function(){return 1===this.state.layers.length}},{key:"removeAddFeaturesLayerResultInteraction",value:function(e){var t=this._addFeaturesLayerResultInteraction;null!==t.toggleeventhandler&&k.default.getService("map").off("mapcontrol:toggled",t.toggleeventhandler),null!==t.interaction&&k.default.getService("map").removeInteraction(t.interaction),null!==t.mapcontrol&&t.mapcontrol.toggle(e),Object.assign(t,{interaction:null,id:null,toggleeventhandler:null,mapcontrol:null})}},{key:"addLayerFeaturesToResultsAction",value:function(t){var a,n,i=this,r=this._addFeaturesLayerResultInteraction,e=![null,t.id].includes(r.id),o=e&&this.state.layers.find(function(e){return e.id===r.id});e&&o&&(o.addfeaturesresults.active=!1),e&&r.interaction&&k.default.getService("map").removeInteraction(r.interaction),r.id=t.id,t.addfeaturesresults.active=!t.addfeaturesresults.active,!1===t.addfeaturesresults.active?this.removeAddFeaturesLayerResultInteraction(!0):(this.activeMapInteraction(),a=(this.state.layers.find(function(e){return e.id===t.id})||{}).external,r.mapcontrol=r.mapcontrol||k.default.getService("map").getCurrentToggledMapControl()||null,r.interaction=new s.default,k.default.getService("map").addInteraction(r.interaction,{close:!1}),r.interaction.on("picked",(n=C(function*(e){e=e.coordinate;a?i.setQueryResponse({data:[i.getVectorLayerFeaturesFromQueryRequest(i._vectorLayers.find(function(e){return t.id===e.get("id")}),{coordinates:e})],query:{coordinates:e}},{add:!0}):yield d.default.getData("query:coordinates",{inputs:{coordinates:e,query_point_tolerance:i._project.getQueryPointTolerance(),layerIds:[t.id],multilayers:!1},outputs:{show:{add:!0}}})}),function(e){return n.apply(this,arguments)})),r.toggleeventhandler=function(e){e.target.isToggled()&&e.target.isClickMap()&&(t.addfeaturesresults.active=!1)},k.default.getService("map").once("mapcontrol:toggled",r.toggleeventhandler))}},{key:"deactiveQueryInteractions",value:function(){this.state.layers.forEach(function(e){e.addfeaturesresults&&(e.addfeaturesresults.active=!1)}),this.removeAddFeaturesLayerResultInteraction()}},{key:"zoomToLayerFeaturesExtent",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};t.highlight=!this.isOneLayerResult(),this._asyncFnc.zoomToLayerFeaturesExtent.async?this._asyncFnc.todo=k.default.getService("map").zoomToFeatures.bind(k.default.getService("map"),e.features||[],t):k.default.getService("map").zoomToFeatures(e.features||[],t)}},{key:"highLightLayerFeatures",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this._asyncFnc.highLightLayerFeatures.async?this._asyncFnc.todo=k.default.getService("map").highlightFeatures.bind(k.default.getService("map"),e.features||[],t):k.default.getService("map").highlightFeatures(e.features||[],t)}},{key:"clearState",value:function(){this.state.layers.splice(0),this.state.query=null,this.state.querytitle="",this.state.changed=!1,Object.values(this.state.layersactions).forEach(function(e){return e.forEach(function(e){return e.clear&&e.clear()})}),this.state.layersactions={},this.state.actiontools={},this.state.layeractiontool={},this.state.currentactiontools={},this.state.layersFeaturesBoxes={},this.removeAddFeaturesLayerResultInteraction()}},{key:"getState",value:function(){return this.state}},{key:"setState",value:function(e){this.state=e}},{key:"_setRelations",value:function(e){this._relations=(e.getRelations()||[]).reduce(function(e,t){return e[t.referencedLayer]=e[t.referencedLayer]||[],e[t.referencedLayer].push(t),e},{})}},{key:"getAtlasByLayerId",value:function(t){return this._atlas.filter(function(e){return e.atlas.qgs_layer_id===t})}},{key:"setTitle",value:function(e){this.state.querytitle=e||""}},{key:"trigger",value:(r=C(function*(t,e,a,n,i){var r;"highlightgeometry"===t&&this.highlightGeometry(e,a,n),"clearHighlightGeometry"===t&&this.clearHighlightGeometry(e,a,n),e&&this.state.layersactions[e.id]&&((r=this.state.layersactions[e.id].find(function(e){return e.id===t}))&&r.cbk&&(yield r.cbk(e,a,r,n,i)),r)&&r.route&&(e=r.route.replace(/{(\w*)}/g,function(e,t){return a.attributes.hasOwnProperty(t)?a.attributes[t]:""}))&&""!==e&&k.default.goto(e)}),function(e,t,a,n,i){return r.apply(this,arguments)})},{key:"registerVectorLayer",value:function(e){this._vectorLayers.includes(e)||this._vectorLayers.push(e)}},{key:"unregisterVectorLayer",value:function(t){var a=this;this._vectorLayers=this._vectorLayers.filter(function(e){return a.state.layers=a.state.layers.filter(function(e){return e.id!==t.get("id")}),e!==t})}},{key:"getVectorLayerFeaturesFromQueryRequest",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},a=e.coordinates,n=e.bbox,i=e.geometry,e=e.filterConfig,r=void 0===e?{}:e,o=[],e=a&&Array.isArray(a),s=n&&Array.isArray(n),a=(e&&k.default.getService("map").viewer.map.forEachFeatureAtPixel(k.default.getService("map").viewer.map.getPixelFromCoordinate(a),function(e){o.push(e)},{layerFilter:function(e){return e===t}}),(i=s&&!e?ol.geom.Polygon.fromExtent(n):i)instanceof ol.geom.Polygon||i instanceof ol.geom.MultiPolygon);return a&&!e&&T.VectorLayer===t.constructor?o=t.getIntersectedFeatures(i):a&&!e&&ol.layer.Vector===t.constructor&&t.getSource().getFeatures().forEach(function(e){var t=void 0;switch(r.spatialMethod){case"intersects":t=(0,g.intersects)(i,e.getGeometry());break;case"within":t=(0,h.within)(i,e.getGeometry());break;default:t=i.intersectsExtent(e.getGeometry().getExtent())}!0===t&&o.push(e)}),{features:o,layer:t}}},{key:"_printSingleAtlas",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.atlas,a=void 0===t?{}:t,t=e.features,e=void 0===t?[]:t,n=a.atlas&&a.atlas.field_name?a.atlas.field_name:"$id";return(0,y.printAtlas)({field:n,values:e.map(function(e){return e.attributes["$id"===n?S.G3W_FID:n]}),template:a.name,download:!0}).then(function(e){e=e.url;return k.default.downloadWrapper(m.downloadFile,{url:e,filename:a.name,mime_type:"application/pdf"})})}},{key:"showChart",value:function(e,t,a){this.emit("show-chart",e,t,a)}},{key:"hideChart",value:function(e){this.emit("hide-chart",e)}},{key:"printAtlas",value:function(e,t){var n,a=this,i=t?[t]:e.features,r=this.getAtlasByLayerId(e.id);r.length<=1?this._printSingleAtlas({features:i,atlas:r[0]}):(n="",r.forEach(function(e,t){var a=(0,_.getUniqueDomId)();n=(n+='<input id="'+a+'" g3w_atlas_index="'+t+'" class="magic-radio" type="radio" name="template" value="'+e.name+'"/>')+'<label for="'+a+'">'+e.name+"</label><br>"}),k.default.showModalDialog({title:M("sdk.atlas.template_dialog.title"),message:n,buttons:{success:{label:"OK",className:"skin-button",callback:function(){var e=$('input[name="template"]:checked').attr("g3w_atlas_index");if(void 0===e)return!1;a._printSingleAtlas({features:i,atlas:r[e]})}}}}))}},{key:"showLayerDownloadFormats",value:function(e){e.downloadformats.active=!e.downloadformats.active,this.setLayerActionTool({layer:e,component:e.downloadformats.active?p.default:null,config:e.downloadformats.active?x({},this.state.actiontools.downloadformats[e.id],{downloads:this.state.actiontools.downloadformats[e.id].downloads.filter(function(e){return"pdf"!==e.format})}):null})}},{key:"downloadFeatures",value:(a=C(function*(t,a){var e,n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:[],i=arguments[3],r=this,o=arguments[4],s=arguments[5],l=(n&&!Array.isArray(n)&&(n=[n]),this.state.query),u=void 0===l?{}:l,c={fids:n.map(function(e){return e.attributes[S.G3W_FID]}).join(",")},d=("pdf"===t&&(c.html=s),e=C(function*(){1<n.length&&(a.downloadformats.active=0<arguments.length&&void 0!==arguments[0]&&arguments[0],r.setLayerActionTool({layer:a})),yield k.default.downloadWrapper(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layer,a=e.type,e=e.data;return(0,w.getCatalogLayerById)(t.id).getDownloadFilefromDownloadDataType(a,{data:e})||Promise.resolve()},{layer:a,type:t,data:c});var e=r.state.layersactions[a.id].find(function(e){return"downloads"===e.id});1<n.length&&void 0===e&&(a[t].active=!1,r.setLayerActionTool({layer:a})),1<n.length&&void 0!==e&&(a.downloadformats.active=!1),n.length<=1&&void 0===e&&(i.state.toggled[o]=!1),n.length<=1&&void 0!==e&&(e.state.toggled[o]=!1),n.length<=1&&r.setCurrentActionLayerFeatureTool({index:o,action:i,layer:a})}),function(){return e.apply(this,arguments)});"polygon"!==u.type?yield d():(l=this.state.layersactions[a.id].find(function(e){return"downloads"===e.id}),s={choices:[{id:(0,_.getUniqueDomId)(),type:"feature",label:"sdk.mapcontrols.querybypolygon.download.choiches.feature.label"},{id:(0,_.getUniqueDomId)(),type:"polygon",label:"sdk.mapcontrols.querybypolygon.download.choiches.feature_polygon.label"}],download:function(e){"polygon"===e?(c.sbp_qgs_layer_id=a.id,c.sbp_fid=u.fid):(delete c.sbp_fid,delete c.sbp_qgs_layer_id),d(!0)}},1===n.length&&void 0===l&&(i.state.toggled[o]=!0),1===n.length&&(this.state.actiontools[f.default.name]=this.state.actiontools[a.id]||{},this.state.actiontools[f.default.name][a.id]=s,this.setCurrentActionLayerFeatureTool({layer:a,index:o,action:i,component:f.default})),void 0===l&&1!==n.length&&(a[t].active=!a[t].active),1!==n.length&&(l=l||a[t].active&&void 0===l,this.setLayerActionTool({layer:a,component:l?f.default:null,config:l?s:null})))}),function(e,t){return a.apply(this,arguments)})},{key:"goToGeometry",value:function(e,t){var a=this;t.geometry&&(this._asyncFnc.goToGeometry.async?this._asyncFnc.todo=k.default.getService("map")[this.isOneLayerResult()?"zoomToFeatures":"highlightGeometry"].bind(k.default.getService("map"),this.isOneLayerResult()?[t]:t.geometry,this.isOneLayerResult()?{}:{layerId:e.id,duration:1500}):setTimeout(function(){return k.default.getService("map")[a.isOneLayerResult()?"zoomToFeatures":"highlightGeometry"](a.isOneLayerResult()?[t]:t.geometry,a.isOneLayerResult()?{}:{layerId:e.id,duration:1500})}))}},{key:"highlightGeometry",value:function(e,t){t.geometry&&k.default.getService("map").highlightGeometry(t.geometry,{layerId:e.id,zoom:!1,duration:1/0})}},{key:"clearHighlightGeometry",value:function(e){k.default.getService("map").clearHighlightGeometry(),this.isOneLayerResult()&&k.default.getService("map").highlightFeatures(e.features,{duration:1/0})}},{key:"showRelation",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.relation,a=e.layerId,e=e.feature,n=this._project.getRelationById(t.name);k.default.pushContent({content:new c.default({internalComponent:new(Vue.extend(l("components/RelationsPage.vue")))({currentview:"relation",relations:[n],chartRelationIds:this.findPlotId(n.referencingLayer)?[n.referencingLayer]:[],nmRelation:this._project.getRelationById(t.nmRelationId),layer:{id:a},feature:e})}),crumb:{title:n.name,text:!0},title:n.name,text:!0,closable:!1})}},{key:"_getFeatureId",value:function(e,t){return t?e.id:e.attributes[S.G3W_FID]}},{key:"addToSelection",value:function(t,e,a,n){var i,r,o,s,l,u,c,d,p,f=k.default.getService("queryresults"),g=k.default.getService("map"),h=f._getFeatureId.bind(f),y=f.getActionLayerById.bind(f),m=void 0===e&&void 0===a&&void 0===n,v=m?y({layer:t,id:"selection"}):a,_=m&&Object.values(v.state.toggled).reduce(function(e,t){return e&&t},!0),b=m?t.external?t:(0,w.getCatalogLayerById)(t.id):(f.state.layers.find(function(e){return e.id===t.id})||{}).external?t:(0,w.getCatalogLayerById)(t.id),y=m?t.features&&t.features.length?t.features:[]:[e],a=m?{fids:0<y.length?y.map(function(e){return b.external?e.id:e.attributes[S.G3W_FID]}):null,features:y,force:_?"remove":"add"}:{fids:[e?h(e,b.external):null],features:y,index:n,force:void 0};m||(v.state.toggled[n]=!v.state.toggled[n]),t.external||[null,void 0].includes(a.fids)||(i=b,o=a.fids,s=a.features,r=a.force,o=Array.isArray(o)?o:[o],s=Array.isArray(s)?s:[s],l=[],u=[],o.forEach(function(e,t){var t=s[t],a=i.state.filter.active||i.hasSelectionFid(e);!a&&t&&t.geometry&&!i.getOlSelectionFeature(e)&&i.addOlSelectionFeature({id:e,feature:t}),void 0===r&&i[a?"excludeSelectionFid":"includeSelectionFid"](e),"add"!==r||a||l.push(e),"remove"===r&&u.push(e)}),i.includeSelectionFids(l,!1),i.excludeSelectionFids(u,!1),(i.state.filter.active?i.createFilterToken():Promise.resolve()).then(function(){var a=k.default.getService("queryresults").getState().layers;o.forEach(function(e,t){e=!i.hasSelectionFid(e)&&i.state.filter.active&&0<i.getSelectionFids().size&&a.find(function(e){return e.id===i.getId()});e&&e.features.splice(void 0===n?t:n,1)}),g.clearHighlightGeometry(),1!==a.length||a[0].features.length||a.splice(0)})),t.external&&![null,void 0].includes(a.fids)&&(c=b,f=a.fids,p=a.features,d=a.force,p=Array.isArray(p)?p:[p],void 0===c.selection.features&&(c.selection.features=[]),f.forEach(function(t,e){var a,n,e=p[e];void 0===c.selection.features.find(function(e){return e.getId()===t})&&(n=(a=e).attributes,e.geometry&&(a=new ol.Feature(e.geometry)).setId(t),Object.keys(n).forEach(function(e){return a.set(e,n[e])}),a.__layerId=c.id,a.selection=e.selection,c.selection.features.push(a)),"add"===d&&e.selection.selected||"remove"===d&&!e.selection.selected||(e.selection.selected=!e.selection.selected,g.setSelectionFeatures(e.selection.selected?"add":"remove",{feature:c.selection.features.find(function(e){return t===e.getId()})}))}),c.selection.active=c.selection.features.reduce(function(e,t){return e||t.selection.selected},!1)),m&&t.features.forEach(function(e,t){return v.state.toggled[t]=!_})}}]),n})(a.default))},{"components/QueryResultsActionDownloadFormats.vue":106,"components/QueryResultsActionQueryPolygonCSVAttributes.vue":108,"components/RelationsPage.vue":115,"g3w-component":139,"g3w-constants":140,"g3w-eventbus":141,"g3w-i18n":143,"g3w-object":144,"map/interactions/pickcoordinatesinteraction":164,"map/layers/layer":170,"map/layers/vectorlayer":173,"services/data":187,"services/gui":188,"store/application":193,"utils/copyUrl":205,"utils/downloadFile":215,"utils/getAlphanumericPropertiesFromFeature":217,"utils/getCatalogLayerById":218,"utils/getUniqueDomId":232,"utils/intersects":236,"utils/printAtlas":246,"utils/throttle":256,"utils/within":259}],192:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var n=function(e,t,a){return t&&i(e.prototype,t),a&&i(e,a),e};function i(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var r,g=e("utils/XHR");function h(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}function o(){if(!(this instanceof o))throw new TypeError("Cannot call a class as a function");this.tasks=[]}a.default=(n(o,[{key:"runTask",value:(r=h(function*(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=t.method,a=void 0===a?"GET":a,n=t.params,n=void 0===n?{}:n,i=t.url,r=t.taskUrl,o=t.interval,s=void 0===o?1e3:o,o=t.timeout,l=void 0===o?1/0:o,o=t.listener,u=void 0===o?function(){}:o;try{var c="GET"===a?yield g.XHR.get({url:i,params:n}):yield g.XHR.post({url:i,data:n.data||{},contentType:n.contentType||"application/json"}),d=c.result,p=c.task_id;if(!d)return Promise.reject(c);var f=setInterval(h(function*(){if(0<(l-=s)){var t=void 0;try{t=yield g.XHR.get({url:""+r+p})}catch(e){t=e}u({task_id:p,timeout:!1,response:t})}else u({timeout:!0}),e.stopTask({task_id:p})}),s);this.tasks.push({task_id:p,intervalId:f}),u({task_id:p,response:c})}catch(e){return Promise.reject(e)}}),function(){return r.apply(this,arguments)})},{key:"stopTask",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=this.tasks.find(function(e){return t.task_id===e.task_id});e&&clearInterval(e.intervalId)}},{key:"clear",value:function(){var t=this;this.tasks.forEach(function(e){e=e.taskId;return t.stopTask({taskId:e})}),this.tasks.splice(0)}}]),new o)},{"utils/XHR":196}],193:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var e=e("g3w-object"),e=(e=e)&&e.__esModule?e:{default:e};e=Vue.observable({ready:!1,iframe:window.top!==window.self,online:navigator.onLine,ismobile:isMobile.any,download:!1,upload:!1,baseLayerId:null,language:"en",lng:"en",plugins:[],pluginsConfigs:{},configurationPlugins:[],user:null,map:{epsg:"",unit:"metric"},gui:{app:{disabled:!1},sidebar:{disabled:!1,open:!0},layout:{__current:"app",app:{}}},keys:{vendorkeys:{google:void 0,bing:void 0}},tokens:{filtertoken:void 0},querybuilder:{cache:{},searches:JSON.parse(window.localStorage.getItem("QUERYBUILDERSEARCHES")||"{}")},navbaritems:[],sidebar:{title:"",components:[],parent:null,contentsdata:[]},contentsdata:[],viewport:{primaryView:"map",secondaryPerc:0,resized:{start:!1,h:!1,v:!1},split:"h",map:{sizes:{width:0,height:0},aside:!1},content:{loading:!1,disabled:!1,sizes:{width:0,height:0},resize:{h:{perc:0},v:{perc:0}},aside:!0,showgoback:!0,stack:[],closable:!0,backonclose:!1,contentsdata:[]},usermessage:{id:null,show:!1,title:null,message:null,position:null,type:null,draggable:null,cloasable:null,autoclose:null,textMessage:!1,hooks:{header:null,body:null,footer:null}},components:{map:null,content:null}},sizes:{sidebar:{width:0}},i18n:{plugins:{}},project:new e.default,catalog:{}});a.default=e},{"g3w-object":144}],194:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var e=e("g3w-object"),e=(e=e)&&e.__esModule?e:{default:e};var n={};a.default=Object.assign(new e.default,{setters:{registerPlugin:function(e){n[e.name]=n[e.name]||e}},getPlugin:function(e){return n[e]}})},{"g3w-object":144}],195:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var n,i=e("utils/normalizeEpsg");function r(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}a.default={get:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=ol.proj.get(t.epsg);return a||(t.proj4&&proj4.defs(t.epsg,t.proj4),e={code:t.epsg,extent:t.extent,axisOrientation:t.axisinverted?"neu":"enu",units:t.geographic?"degrees":"m"},(a=new ol.proj.Projection(e)).getAxisOrientation=function(){return e.axisOrientation},ol.proj.addProjection(a),ol.proj.proj4.register(proj4)),a},registerProjection:(n=r(function*(e){var t=ol.proj.get(e)||void 0;if(!t){var e=yield fetch("/crs/"+e.split(":")[1]),a=e.result,e=e.data;if(a)e.epsg=(0,i.normalizeEpsg)(e.epsg),t=this.get(e),ol.proj.proj4.register(proj4)}return t}),function(e){return n.apply(this,arguments)})}},{"utils/normalizeEpsg":243}],196:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.XHR=void 0;var r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},s=e("g3w-constants"),l=e("utils/downloadFile");function u(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}var n,i,o;a.XHR={get:(o=u(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.url,e=e.params,e=void 0===e?{}:e;if(!t)return Promise.reject("No url");e=new URLSearchParams(JSON.parse(JSON.stringify(e||{}))).toString(),t=yield(yield fetch(t+(e?"?":"")+e)).text();try{return JSON.parse(t)}catch(e){return t}}),function(){return o.apply(this,arguments)}),post:(i=u(function*(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.url,a=t.data,n=t.formdata,i=void 0!==n&&n,n=t.contentType,t=(i?(i=new FormData,Object.entries(a).forEach(function(e){var e=r(e,2),t=e[0];return i.append(t,e[1])})):i=n?"string"==typeof a?a:JSON.stringify(a||{}):new URLSearchParams(JSON.parse(JSON.stringify(a||{}))).toString(),yield(yield fetch(e,{method:"POST",body:i,headers:{"Content-Type":n||"application/x-www-form-urlencoded"}})).text());try{return JSON.parse(t)}catch(e){return t}}),function(){return i.apply(this,arguments)}),fileDownload:function(){var a,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=e.url,i=e.data,e=e.httpMethod,r=void 0===e?"POST":e,o=void 0;return new Promise((a=u(function*(e,t){try{return o=setTimeout(function(){t("Timeout")},s.TIMEOUT),(0,l.downloadFile)({url:"GET"===r?""+n+(i?"?"+new URLSearchParams(JSON.parse(JSON.stringify(i||{}))).toString():""):n,headers:{"Content-Type":"application/json","Access-Control-Expose-Headers":"Content-Disposition"},method:r,data:i&&JSON.stringify(i)}),e()}catch(e){return t(e)}finally{clearTimeout(o)}}),function(e,t){return a.apply(this,arguments)}))},delete:(n=u(function*(e){var t=e.url,e=e.data;return(yield fetch(t,{method:"DELETE",body:JSON.stringify(void 0===e?{}:e)})).json()}),function(e){return n.apply(this,arguments)})}},{"g3w-constants":140,"utils/downloadFile":215}],197:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.addZValueToOLFeatureGeometry=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.feature,e=e.geometryType;if((0,r.is3DGeometry)(e)){var a=t.getGeometry(),n=a.getCoordinates();switch(e||a.getType()){case i.GEOMETRY_TYPES.POINTZ:case i.GEOMETRY_TYPES.POINTM:case i.GEOMETRY_TYPES.POINTZM:case i.GEOMETRY_TYPES.POINT25D:t.getGeometry().setCoordinates(o(n));break;case i.GEOMETRY_TYPES.MULTIPOINTZ:case i.GEOMETRY_TYPES.MULTIPOINTM:case i.GEOMETRY_TYPES.MULTIPOINTZM:case i.GEOMETRY_TYPES.MULTIPOINT25D:case i.GEOMETRY_TYPES.LINESTRINGZ:case i.GEOMETRY_TYPES.LINESTRINGM:case i.GEOMETRY_TYPES.LINESTRINGZM:case i.GEOMETRY_TYPES.LINESTRING25D:case i.GEOMETRY_TYPES.LINEZ:case i.GEOMETRY_TYPES.LINEM:case i.GEOMETRY_TYPES.LINEZM:case i.GEOMETRY_TYPES.LINE25D:n.forEach(o),t.getGeometry().setCoordinates(n);break;case i.GEOMETRY_TYPES.MULTILINESTRINGZ:case i.GEOMETRY_TYPES.MULTILINESTRINGM:case i.GEOMETRY_TYPES.MULTILINESTRINGZM:case i.GEOMETRY_TYPES.MULTILINESTRING25D:case i.GEOMETRY_TYPES.MULTILINEZ:case i.GEOMETRY_TYPES.MULTILINEM:case i.GEOMETRY_TYPES.MULTILINEZM:case i.GEOMETRY_TYPES.MULTILINE25D:n.forEach(function(e){return e.forEach(o)}),t.getGeometry().setCoordinates(n);break;case i.GEOMETRY_TYPES.POLYGONZ:case i.GEOMETRY_TYPES.POLYGONM:case i.GEOMETRY_TYPES.POLYGONZM:case i.GEOMETRY_TYPES.POLYGON25D:n[0].forEach(o),t.getGeometry().setCoordinates(n);break;case i.GEOMETRY_TYPES.MULTIPOLYGONZ:case i.GEOMETRY_TYPES.MULTIPOLYGONM:case i.GEOMETRY_TYPES.MULTIPOLYGOZM:case i.GEOMETRY_TYPES.MULTIPOLYGON25D:n.forEach(function(e){return e[0].forEach(o)}),t.getGeometry().setCoordinates(n)}}return t};var i=e("g3w-constants"),r=e("utils/is3DGeometry");function o(e){return 2===e.length&&e.push(0),e}},{"g3w-constants":140,"utils/is3DGeometry":237}],198:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.areCoordinatesEqual=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];return e[0]===t[0]&&e[1]===t[1]}},{}],199:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.base=function(e,t,a){var n=arguments.callee.caller;if(n.superClass_)return n.superClass_.constructor.apply(e,Array.prototype.slice.call(arguments,1));for(var i=Array.prototype.slice.call(arguments,2),r=!1,o=e.constructor;o;o=o.superClass_&&o.superClass_.constructor)if(o.prototype[t]===n)r=!0;else if(r)return o.prototype[t].apply(e,i);{if(e[t]===n)return e.constructor.prototype[t].apply(e,i);throw Error("base called from a method of one name to a method of a different name")}}},{}],200:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.colorHEXToRGB=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"#FFFFFF";return[parseInt(e.substr(1,2),16),parseInt(e.substr(3,2),16),parseInt(e.substr(5,2),16)]}},{}],201:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.convertFeatureToGEOJSON=function(e){return(new ol.format.GeoJSON).writeFeatureObject(e)}},{}],202:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.convertQGISDateTimeFormatToMoment=function(e){var t=(e=e.replace(/y/g,"Y")).match(/d/g);t&&t.length<3&&(e=e.replace(/d/g,"D"));return e}},{}],203:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.convertSingleMultiGeometry=function(e,t){var a=e.getType();if(!t||t===a)return e;var n=(0,r.isMultiGeometry)(a),t=(0,r.isMultiGeometry)(t);if(!n||t)return n||!t?e:new ol.geom["Multi"+a]([e.getCoordinates()]);switch(e.getType()){case i.GEOMETRY_TYPES.MULTIPOLYGON:return e.getPolygons();case i.GEOMETRY_TYPES.MULTILINE:case i.GEOMETRY_TYPES.MULTILINESTRING:return e.getLineStrings();case i.GEOMETRY_TYPES.MULTIPOINT:return e.getPoints()}return[]};var i=e("g3w-constants"),r=e("utils/isMultiGeometry")},{"g3w-constants":140,"utils/isMultiGeometry":239}],204:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.coordinatesToGeometry=function(e,t){switch(e){case n.GEOMETRY_TYPES.POLYGON:case n.GEOMETRY_TYPES.POLYGONZ:case n.GEOMETRY_TYPES.POLYGONM:case n.GEOMETRY_TYPES.POLYGONZM:case n.GEOMETRY_TYPES.POLYGON25D:return new ol.geom.Polygon(t);case n.GEOMETRY_TYPES.MULTIPOLYGON:case n.GEOMETRY_TYPES.MULTIPOLYGONZ:case n.GEOMETRY_TYPES.MULTIPOLYGONM:case n.GEOMETRY_TYPES.MULTIPOLYGONZM:case n.GEOMETRY_TYPES.MULTIPOLYGON25D:return new ol.geom.MultiPolygon(t);case n.GEOMETRY_TYPES.LINESTRING:case n.GEOMETRY_TYPES.LINESTRINGZ:case n.GEOMETRY_TYPES.LINESTRINGM:case n.GEOMETRY_TYPES.LINESTRINGZM:case n.GEOMETRY_TYPES.LINESTRING25D:case n.GEOMETRY_TYPES.LINE:case n.GEOMETRY_TYPES.LINEZ:case n.GEOMETRY_TYPES.LINEM:case n.GEOMETRY_TYPES.LINEZM:case n.GEOMETRY_TYPES.LINE25D:return new ol.geom.LineString(t);case n.GEOMETRY_TYPES.MULTILINE:case n.GEOMETRY_TYPES.MULTILINEZ:case n.GEOMETRY_TYPES.MULTILINEM:case n.GEOMETRY_TYPES.MULTILINEZM:case n.GEOMETRY_TYPES.MULTILINE25D:case n.GEOMETRY_TYPES.MULTILINESTRING:case n.GEOMETRY_TYPES.MULTILINESTRINGZ:case n.GEOMETRY_TYPES.MULTILINESTRINGM:case n.GEOMETRY_TYPES.MULTILINESTRINGZM:case n.GEOMETRY_TYPES.MULTILINESTRING25D:return new ol.geom.MultiLineString(t);case n.GEOMETRY_TYPES.POINT:case n.GEOMETRY_TYPES.POINTZ:case n.GEOMETRY_TYPES.POINTM:case n.GEOMETRY_TYPES.POINTZM:case n.GEOMETRY_TYPES.POINT25D:return new ol.geom.Point(t);case n.GEOMETRY_TYPES.MULTIPOINT:case n.GEOMETRY_TYPES.MULTIPOINTZ:case n.GEOMETRY_TYPES.MULTIPOINTM:case n.GEOMETRY_TYPES.MULTIPOINTZM:case n.GEOMETRY_TYPES.MULTIPOINT25D:return new ol.geom.MultiPoint(t);default:return new ol.geom.Point(t)}};var n=e("g3w-constants")},{"g3w-constants":140}],205:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.copyUrl=function(e){var t=document.createElement("input");document.body.appendChild(t),t.value=e,t.select(),document.execCommand("copy"),document.body.removeChild(t)}},{}],206:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.createFilterFormInputs=function(e){var t=e.layer,e=e.inputs,r=void 0===e?[]:e,e=void 0,a=r.map(function(e,t){var a=e.attribute,n=e.value,i=e.operator,e=e.logicop;return Array.isArray(a)?a.map(function(e,t){return(0,o.createSingleFieldParameter)({field:e,value:n[t],operator:i,logicop:null})}).join("|AND,")||"":(0<t?"|"+r[t-1].logicop+",":"")+(0,o.createSingleFieldParameter)({field:a,value:n,operator:i,logicop:e})}).join("")||void 0;return e=[].concat(t).map(function(){return a}),Array.isArray(t)?e:e[0]};var o=e("utils/createSingleFieldParameter")},{"utils/createSingleFieldParameter":211}],207:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=(a.createFilterFromString=function(e){e=e.filter,e=void 0===e?"":e;return e=i.reduce(function(e,t){t=n(t,2),t[0],t=t[1];return e.replace(new RegExp("\\s+"+t+"\\s+","g"),""+t).replace(new RegExp("'"+t,"g"),""+t).replace(new RegExp(t+"'","g"),""+t)},e).replace(/'$/g,"").replace(/"/g,""),e=i.reduce(function(e,t){var t=n(t,2),a=t[0],t=t[1];return e.replace(new RegExp(t,"g"),["AND","OR"].includes(t)?"|"+a+",":"|"+a+"|")},e).split("|").map(function(e,t){return 0==(t+1)%3?encodeURIComponent(e):e}).join("|")},e("g3w-constants")),i=Object.entries(a.FILTER_EXPRESSION_OPERATORS)},{"g3w-constants":140}],208:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.createMeasureTooltip=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},l=e.map,e=e.feature,u=document.createElement("div"),c=(u.className="mtooltip mtooltip-measure",new ol.Overlay({element:u,offset:[0,-15],positioning:"bottom-center"}));return l.addOverlay(c),{tooltip:c,unbyKey:e.getGeometry().on("change",function(e){var t=void 0,e=e.target,a=(e instanceof ol.geom.Polygon?t=e.getInteriorPoint().getCoordinates():e instanceof ol.geom.MultiPolygon?t=e.getInteriorPoints().getCoordinates()[0]:(e instanceof ol.geom.LineString||e instanceof ol.geom.MultiLineString)&&(t=e.getLastCoordinate()),l.getView().getProjection()),n=(0,p.isLineGeometryType)(e.getType()),i=(0,f.isPolygonGeometryType)(e.getType()),r=(0,g.isMultiGeometry)(e.getType()),o="EPSG:3857"===a.getCode()||"degrees"===a.getUnits(),s=[],r=(i&&r&&(e.getPolygons()||[]).forEach(function(e){return e.getLinearRing().getCoordinates().forEach(function(e){return s.push(e)})}),i&&!r&&(s=e.getLinearRing().getCoordinates()),i&&2<s.length?new ol.geom.LineString(s):e),n=n||i&&2<s.length?o?ol.sphere.getLength(r,{projection:a.getCode()}):(0,g.isMultiGeometry)(r.getType())?r.getLineStrings().reduce(function(e,t){return e+t.getLength()},0):r.getLength():void 0,r=i?Math.round(o?ol.sphere.getArea(e,{projection:a.getCode()}):e.getArea()):void 0;void 0!==n&&(n="nautical"===d.default.map.unit?.0005399568*n+" nm":1e3<n?(Math.round(n/1e3*100)/100).toFixed(3)+" km":(Math.round(100*n)/100).toFixed(2)+" m"),void 0!==r&&(r="nautical"===d.default.map.unit?2.9155334959812285e-7*r+"  nmi²":1e6<r?(Math.round(r/1e6*100)/100).toFixed(6)+" km<sup>2</sup>":(Math.round(100*r)/100).toFixed(3)+" m<sup>2</sup>"),u.innerHTML=(void 0!==r?"Area: "+r+" <br>":"")+(void 0!==r&&void 0!==n?'<div style="width: 100%; padding: 3px; border-bottom: 2px solid #ffffff"></div> ':"")+(void 0!==n?n:""),c.setPosition(t)})}};var a=e("store/application"),d=(a=a)&&a.__esModule?a:{default:a},p=e("utils/isLineGeometryType"),f=e("utils/isPolygonGeometryType"),g=e("utils/isMultiGeometry")},{"store/application":193,"utils/isLineGeometryType":238,"utils/isMultiGeometry":239,"utils/isPolygonGeometryType":241}],209:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.createRelationsUrl=function(e){var t=e.layer,t=void 0===t?{}:t,a=e.relation,a=void 0===a?{}:a,n=e.fid,i=e.type,i=void 0===i?"data":i,e=e.formatter,e=void 0===e?1:e;return r.default.project.getLayerById(void 0===a.father?t.id===a.referencedLayer?a.referencingLayer:a.referencedLayer:t.id===a.father?a.child:a.father).getUrl(i)+"?relationonetomany="+a.id+"|"+(0,o.sanitizeFidFeature)(n)+"&formatter="+e};var a=e("store/application"),r=(a=a)&&a.__esModule?a:{default:a},o=e("utils/sanitizeFidFeature")},{"store/application":193,"utils/sanitizeFidFeature":253}],210:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.createSelectedStyle=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.geometryType,a=e.color,n=void 0===a?"rgb(255,255,0)":a,a=e.fill,i=void 0===a||a;switch(t){case"LineString":case"MultiLineString":return new ol.style.Style({stroke:new ol.style.Stroke({color:n,width:4})});case"Point":case"MultiPoint":return new ol.style.Style({image:new ol.style.Circle({radius:6,fill:i&&new ol.style.Fill({color:n}),stroke:!i&&new ol.style.Stroke({color:n,width:4})}),zIndex:1/0});case"MultiPolygon":case"Polygon":return new ol.style.Style({stroke:new ol.style.Stroke({color:n,width:4}),fill:i&&new ol.style.Fill({color:ol.color.asString([].concat((e=>{if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)})(ol.color.asArray(n))).splice(0,3).concat(.25))})});default:return null}}},{}],211:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.createSingleFieldParameter=function(e){var t=e.field,a=e.operator,n=void 0===a?"eq":a,a=e.logicop,a=void 0===a?"OR":a;return[].concat(e.value).map(function(e){return t+"|"+n.toLowerCase()+"|"+encodeURIComponent(e)}).join("|"+a+",")}},{}],212:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.createVectorLayerFromFile=void 0;r=l(function*(n,i,r,o,s){try{return yield new Promise((a=l(function*(e,t){var a=new JSZip,a=(a.load(yield s.arrayBuffer(s)),a.file(/.kml$/i)),a=a[a.length-1];a?e(x(n,i,r,o,a.asText(),new ol.format.KML({extractStyles:!1}),"EPSG:4326")):t()}),function(e,t){return a.apply(this,arguments)}))}catch(e){return Promise.reject(e)}var a});var r,o,n,_=function(e,t,a,n,i){return r.apply(this,arguments)},b=(o=l(function*(n,i,r,o,e){try{return yield new Promise((a=l(function*(t,a){shp(yield e.arrayBuffer(e)).then(function(e){t(x(n,i,r,o,JSON.stringify(e),new ol.format.GeoJSON({}),"EPSG:4326"))}).catch(function(e){a(e)})}),function(e,t){return a.apply(this,arguments)}))}catch(e){return Promise.reject(e)}var a}),function(e,t,a,n,i){return o.apply(this,arguments)}),s=(a.createVectorLayerFromFile=(n=l(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.name,a=e.type,n=e.crs,i=e.mapCrs,r=e.data,o=e.style;switch(a){case"gpx":return x(t,n,i,o,r,new ol.format.GPX);case"gml":return x(t,n,i,o,r,new ol.format.WMSGetFeatureInfo);case"geojson":return x(t,n,i,o,r,new ol.format.GeoJSON);case"kml":return x(t,n,i,o,r,new ol.format.KML({extractStyles:!1}),"EPSG:4326");case"csv":var s=t,l=n,u=i,c=o,d=r,p=d.headers,f=d.separator,g=d.values,h=d.x,y=d.y,m=[],v=[];return g.forEach(function(e,t){var a,n={},e=e.split(f);e.length===p.length?(a=[],e.forEach(function(e,t){t=p[t];t===h&&(a[0]=+e),t===y&&(a[1]=+e),n[t]=e}),void 0===a.find(function(e){return Number.isNaN(e)})&&(e=new ol.geom.Point(a),l!==u&&e.transform(l,u),(e=new ol.Feature(e)).setId(t),e.setProperties(n),m.push(e))):v.push({row:t+1,value:g[t]})}),0===m.length?Promise.reject():(v.length&&GUI.showUserMessage({type:"warning",message:"sdk.mapcontrols.addlayer.messages.csv.warning",hooks:{footer:{template:'<select v-select2="errorrows[0].value" class="skin-color" :search="false" style="width:100%">\n              <option v-for="errorrow in errorrows" :key="errorrow.row" :value="errorrow.value">[{{ errorrow.row}}] {{errorrow.value}}</option>\n          </select>',data:function(){return{errorrows:v}}}},autoclose:!1}),new ol.layer.Vector({source:new ol.source.Vector({features:m}),name:s,_fields:p,id:(0,w.getUniqueDomId)(),style:c}));case"kmz":return _(t,n,i,o,r);case"zip":return b(t,n,i,o,r)}}),function(){return n.apply(this,arguments)}),e("g3w-constants")),w=e("./getUniqueDomId");function l(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}function x(e,t,a,n,i,r,o){i=r.readFeatures(i,{dataProjection:o=void 0===o?t:o,featureProjection:a||o});if(0!==i.length)return r instanceof ol.format.KML&&i.forEach(function(e){return e.unset("styleUrl")}),new ol.layer.Vector({source:new ol.source.Vector({features:i}),name:e,_fields:Object.keys(i[0].getProperties()).filter(function(e){return s.GEOMETRY_FIELDS.indexOf(e)<0}),id:(0,w.getUniqueDomId)(),style:n})}},{"./getUniqueDomId":232,"g3w-constants":140}],213:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.debounce=function(n){var i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:500,r=void 0;return function(){for(var e=arguments.length,t=Array(e),a=0;a<e;a++)t[a]=arguments[a];clearTimeout(r),r=setTimeout(function(){return n.apply(void 0,t)},i)}}},{}],214:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.distance=function(e,t){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}},{}],215:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var n,i;a.downloadFile=(n=function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.filename,a=e.content,n=e.url,i=e.headers,i=void 0===i?{}:i,r=e.method,r=void 0===r?"GET":r,o=e.data,e=e.mime_type,e=void 0===e?"text/plain":e,s=a&&new Blob([a],{type:e}),n=!a&&n&&(yield fetch(n,{type:e,headers:i,body:o,method:r}))||{};if(!a&&(400===n.status||500===n.status))throw(yield n.json()).message;!a&&200!==n.status||((i=document.createElement("a")).setAttribute("href",window.URL.createObjectURL(s||(yield n.blob()))),i.setAttribute("download",t||(n.headers.get("content-disposition")||"filename=g3w_download_file").split("filename=").at(1)),i.dataset.downloadurl=[e||n.headers.get("content-type"),i.download,i.href].join(":"),i.click())},i=function(){var s=n.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})},function(){return i.apply(this,arguments)})},{}],216:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};a.flattenObject=function e(t,a){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:{};for(var i in t){var r=a?a+"_"+i:i;"object"===o(t[i])?e(t[i],r,n):n[r]=t[i]}return n}},{}],217:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.getAlphanumericPropertiesFromFeature=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return(Array.isArray(e)?e:Object.keys(e)).filter(function(e){return!n.GEOMETRY_FIELDS.includes(e)})};var n=e("g3w-constants")},{"g3w-constants":140}],218:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.getCatalogLayerById=function(t){return Object.values(n.default.catalog).map(function(e){return e.getLayerById(t)}).find(function(e){return e})};var a=e("store/application"),n=(e=a)&&e.__esModule?e:{default:e}},{"store/application":193}],219:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.getCatalogLayers=function(t){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return Object.values(n.default.catalog).flatMap(function(e){return e.getLayers(t,a)})};var a=e("store/application"),n=(e=a)&&e.__esModule?e:{default:e}},{"store/application":193}],220:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.getDataForSearchInput=void 0;var n,i,r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=a.getDataForSearchInput=(n=function*(e){var t=e.state,a=e.field,n=e.suggest;try{return(yield Promise.allSettled(t.search_layers.map(function(e){return e.getFilterData({suggest:n,fformatter:a,ordering:a,field:o.field({state:t,field:!n&&(t.forminputs.find(function(e){return e.attribute===a})||{}).dependance||a,fields:[]})})}))).filter(function(e){return"fulfilled"===e.status}).reduce(function(e,t){return e.concat(t.value.data||[])},[]).map(function(e){var e=r(e,2),t=e[0];return{key:e[1],value:t}})}catch(e){}return[]},i=function(){var s=n.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})},function(e){return i.apply(this,arguments)}),s=e("g3w-constants");o.field=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.state,a=e.field,e=e.fields,e=void 0===e?[]:e,a=t.forminputs.find(function(e){return e.attribute===a}),n=t.forminputs.find(function(e){return e.attribute===a.dependance});return n&&s.SEARCH_ALLVALUE!==n.value?(void 0!==n.value&&e.unshift(n.attribute+"|"+n.operator.toLowerCase()+"|"+encodeURI(n.value)+(e.length?"|"+n.logicop:"")),o.field({state:t,fields:e,field:n.attribute})):(e||[]).join()||void 0}},{"g3w-constants":140}],221:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.getDefaultExpression=void 0;a.getDefaultExpression=(n=function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.field,a=e.feature,n=e.qgs_layer_id,e=e.parentData,i=t.input.options,r=i.layer_id,r=void 0===r?n:r,o=i.default_expression,s=i.loading,i=i.default;if(o){s.state="loading";try{var l=yield u.default.getData("expression:expression_eval",{inputs:{field_name:t.name,layer_id:r,qgs_layer_id:n,form_data:(0,c.convertFeatureToGEOJSON)(a),formatter:0,expression:o.expression,parent:e&&{form_data:(0,c.convertFeatureToGEOJSON)(e.feature),qgs_layer_id:e.qgs_layer_id,formatter:0}},outputs:!1});return t.value=l}catch(e){return void 0!==i&&(t.value=i),Promise.reject(e)}finally{s.state="ready"}}},i=function(){var s=n.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})},function(){return i.apply(this,arguments)});var n,i,a=e("services/data"),u=(a=a)&&a.__esModule?a:{default:a},c=e("utils/convertFeatureToGEOJSON")},{"services/data":187,"utils/convertFeatureToGEOJSON":201}],222:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.getFilterExpression=void 0;a.getFilterExpression=(n=function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.field,a=e.feature,n=e.qgs_layer_id,e=e.parentData,i=t.input.options,r=i.key,o=i.value,s=i.layer_id,s=void 0===s?n:s,l=i.filter_expression,i=i.loading;if(l){i.state="loading";try{var u=yield p.default.getData("expression:expression",{inputs:{field_name:t.name,layer_id:s,qgs_layer_id:n,form_data:(0,f.convertFeatureToGEOJSON)(a),parent:e&&{form_data:(0,f.convertFeatureToGEOJSON)(e.feature),qgs_layer_id:e.qgs_layer_id,formatter:0},formatter:0,expression:l.expression},outputs:!1});if("select_autocomplete"===t.input.type){t.input.options.values=[];for(var c=[],d=0;d<u.length;d++)c.push({key:u[d].properties[r],value:u[d].properties[o]});c.sort(function(e,t){e=e.key,t=t.key;return"string"==typeof e&&(e=e.toLowerCase(),t=t.toLowerCase()),e<t?-1:t<e?1:0}),t.input.options.values=c}return u}catch(e){return Promise.reject(e)}finally{i.state="ready"}}},i=function(){var s=n.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})},function(){return i.apply(this,arguments)});var n,i,a=e("services/data"),p=(a=a)&&a.__esModule?a:{default:a},f=e("utils/convertFeatureToGEOJSON")},{"services/data":187,"utils/convertFeatureToGEOJSON":201}],223:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.getFormDataExpressionRequestFromFeature=function(t){delete t.attributes.geometry;var e=new ol.Feature(t.geometry),a={};return(0,i.getAlphanumericPropertiesFromFeature)(t.attributes).filter(function(e){return n.G3W_FID!==e}).forEach(function(e){return a[e]=t.attributes[e]}),e.setProperties(a),e.setId(t.attributes[n.G3W_FID]),(0,r.convertFeatureToGEOJSON)(e)};var n=e("g3w-constants"),i=e("utils/getAlphanumericPropertiesFromFeature"),r=e("utils/convertFeatureToGEOJSON")},{"g3w-constants":140,"utils/convertFeatureToGEOJSON":201,"utils/getAlphanumericPropertiesFromFeature":217}],224:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.getListableProjects=function(){return window.initConfig.projects,window.initConfig.projects.filter(function(e){return[null,void 0].includes(e.listable)?!(e.id===n.default.project.getId()||window.initConfig.overviewproject&&e.gid===window.initConfig.overviewproject)&&e:e.listable}).sort(function(e,t){return(e.title||"").localeCompare(t.title)})};var a=e("store/application"),n=(e=a)&&e.__esModule?e:{default:e}},{"store/application":193}],225:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a,n=arguments[t];for(a in n)Object.prototype.hasOwnProperty.call(n,a)&&(e[a]=n[a])}return e};a.getMapLayersByFilter=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return t=n({GEOLAYER:!0},t),e("services/map").default.MapLayersStoresRegistry.getQuerableLayersStores().flatMap(function(e){return e.getLayers(t,a)})}},{"services/map":190}],226:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.getOLGeometry=function(e){switch(e){case n.GEOMETRY_TYPES.LINESTRINGZ:case n.GEOMETRY_TYPES.LINESTRINGM:case n.GEOMETRY_TYPES.LINESTRINGZM:case n.GEOMETRY_TYPES.LINESTRING25D:case n.GEOMETRY_TYPES.LINE:case n.GEOMETRY_TYPES.LINEZ:case n.GEOMETRY_TYPES.LINEM:case n.GEOMETRY_TYPES.LINEZM:case n.GEOMETRY_TYPES.LINE25D:return"LineString";case n.GEOMETRY_TYPES.MULTILINESTRINGZ:case n.GEOMETRY_TYPES.MULTILINESTRINGM:case n.GEOMETRY_TYPES.MULTILINESTRINGZM:case n.GEOMETRY_TYPES.MULTILINESTRING25D:case n.GEOMETRY_TYPES.MULTILINE:case n.GEOMETRY_TYPES.MULTILINEZ:case n.GEOMETRY_TYPES.MULTILINEM:case n.GEOMETRY_TYPES.MULTILINEZM:case n.GEOMETRY_TYPES.MULTILINE25D:return"MultiLineString";case n.GEOMETRY_TYPES.POINT:case n.GEOMETRY_TYPES.POINTZ:case n.GEOMETRY_TYPES.POINTM:case n.GEOMETRY_TYPES.POINTZM:case n.GEOMETRY_TYPES.POINT25D:return"Point";case n.GEOMETRY_TYPES.MULTIPOINT:case n.GEOMETRY_TYPES.MULTIPOINTZ:case n.GEOMETRY_TYPES.MULTIPOINTM:case n.GEOMETRY_TYPES.MULTIPOINTZM:case n.GEOMETRY_TYPES.MULTIPOINT25D:return"MultiPoint";case n.GEOMETRY_TYPES.POLYGON:case n.GEOMETRY_TYPES.POLYGONZ:case n.GEOMETRY_TYPES.POLYGONM:case n.GEOMETRY_TYPES.POLYGONZM:case n.GEOMETRY_TYPES.POLYGON25D:return"Polygon";case n.GEOMETRY_TYPES.MULTIPOLYGON:case n.GEOMETRY_TYPES.MULTIPOLYGONZ:case n.GEOMETRY_TYPES.MULTIPOLYGONM:case n.GEOMETRY_TYPES.MULTIPOLYGONZM:case n.GEOMETRY_TYPES.MULTIPOLYGON25D:return"MultiPolygon";default:return e}};var n=e("g3w-constants")},{"g3w-constants":140}],227:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.getProject=void 0;var n,i,r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},l=(a.getProject=(n=function*(a){var e,t,n,i,r,o=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},s=window.initConfig.projects.find(function(e){return a===e.gid});return s?((t=(e=!v[a]&&(yield p.XHR.get({url:""+window.initConfig.urls.baseurl+window.initConfig.urls.config+"/"+window.initConfig.id+"/"+s.type+"/"+s.id+"?_t="+s.modified})))&&o.map_theme&&Object.values(e.map_themes).flat().find(function(e){return e.theme===o.map_theme}))&&(n=(i=yield p.XHR.get({url:"/"+s.type+"/api/prjtheme/"+s.id+"/"+o.map_theme})).result,i=i.data,n)&&(e.layerstree=i,t.layetstree=i,t.default=!0),v[a]=Object.assign(v[a]||{},Object.assign(s,e)),v[a]=Object.assign(v[a],{WMSUrl:""+window.initConfig.urls.baseurl+window.initConfig.urls.ows+"/"+window.initConfig.id+"/"+v[a].type+"/"+v[a].id+"/",relations:(v[a].relations||[]).map(function(t){return"ONE"===t.type&&v[a].layers.find(function(e){if(e.id===t.referencingLayer)return t.name=e.name,t.origname=e.origname,!0}),t}),catalog_tab:v[a].toc_tab_default||v[a]._catalog_tab||"layers",ows_method:v[a].ows_method||"GET",toc_layers_init_status:v[a].toc_layers_init_status||"not_collapsed",toc_themes_init_status:v[a].toc_themes_init_status||"collapsed",query_point_tolerance:v[a].query_point_tolerance||l.QUERY_POINT_TOLERANCE,crs:_(v[a].crs),baselayers:v[a].baselayers.filter(function(e){return"Bing"!==e.servertype||c.default.keys.vendorkeys.bing}).map(function(e){return Object.assign(e,{visible:e.id&&e.id===(null!==c.default.baseLayerId?c.default.baseLayerId:v[a].initbaselayer)||!!e.fixed,baselayer:!0})})}),function e(n){for(var t=0;t<n.length;t++)(t=>{var a=n[t];void 0!==a.id&&r.state.layers.forEach(function(e){if(a.id===e.id)return a.name=e.name,e.wmsUrl=r.state.WMSUrl,e.project=r,a[t]=Object.assign(e,a),!1}),Array.isArray(a.nodes)&&(a.title=a.name,e(a.nodes))})(t)}((r=Object.assign(new u.default,{setters:{setBaseLayer:function(t){var a=this;window.initConfig.baselayers.forEach(function(e){a._layersStore.getLayerById(e.id).setVisible(t===e.id),e.visible=t===e.id})}},state:v[a],urls:{map_themes:"/"+v[a].type+"/api/prjtheme/"+v[a].id+"/",vector_data:v[a].vectorurl+"data/"+v[a].type+"/"+v[a].id+"/",featurecount:v[a].vectorurl+"featurecount/"+v[a].type+"/"+v[a].id+"/"},_projection:d.default.get(_(v[a].crs)),_layersStore:new y.LayersStore,getQueryPointTolerance:function(){return r.state.query_point_tolerance},getRelations:function(){return r.state.relations},getRelationById:function(t){return r.state.relations.find(function(e){return t===e.id})},getLayerById:function(e){return r._layersStore.getLayerById(e)},getLayers:function(){return[].concat(m(r.state.layers),m(r.state.baselayers))},getState:function(){return r.state},getPrint:function(){return r.state.print||[]},getId:function(){return r.state.id},getType:function(){return r.state.type},getGid:function(){return r.state.gid},getName:function(){return r.state.name},getCrs:function(){return r._projection.getCode()},getProjection:function(){return r._projection},getLayersStore:function(){return r._layersStore},getUrl:function(e){return r.urls[e]},getConfigLayers:function(){var t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).key;return t?r.state.layers.filter(function(e){return void 0!==e[t]}):r.state.layers}})).state.layerstree),r._layersStore.setOptions({id:r.state.gid,projection:r._projection,extent:r.state.extent,initextent:r.state.initextent,wmsUrl:r.state.WMSUrl,catalog:window.initConfig.overviewproject!==r.state.gid}),r._layersStore.addLayers(r.getLayers().flatMap(function(e){var e=Object.assign(e,{crs:_(e.crs),projection:e.crs?d.default.get(e.crs):r._projection,ows_method:r.state.ows_method,wms_use_layer_ids:r.state.wms_use_layer_ids}),t=e.servertype+" "+(e.source&&e.source.type);return"NoGeometry"===e.geometrytype&&["QGIS virtual","QGIS postgres","QGIS mssql","QGIS spatialite","QGIS wfs","QGIS delimitedtext","QGIS oracle","QGIS ogr","QGIS mdal"].includes(t)?new f.TableLayer(e,{project:r}):["OGC wfs","G3WSUITE geojson"].includes(t)||["Local","G3WSUITE"].includes(e.servertype)?new g.VectorLayer(e,{project:r}):e.geometrytype&&"NoGeometry"!==e.geometrytype&&["OGC wms","QGIS postgresraster","QGIS virtual","QGIS postgres","QGIS mssql","QGIS spatialite","QGIS wfs","QGIS delimitedtext","QGIS oracle","QGIS ogr","QGIS mdal"].includes(t)||!e.geometrytype&&["OGC wms","QGIS postgresraster","QGIS wmst","QGIS wcs","QGIS wms","QGIS gdal","QGIS vectortile","QGIS vector-tile","QGIS mdal","QGIS arcgismapserver"].includes(t)?new h.ImageLayer(e,{project:r}):["OSM","Bing","TMS","ARCGISMAPSERVER","WMTS","WMS"].includes(e.servertype)?new h.ImageLayer(e,{project:r,_BASE_LAYER:e.servertype}):[]})),r._layersStore.createLayersTree(r.state.name,{layerstree:r.state.layerstree,expanded:"not_collapsed"===r.state.toc_layers_init_status}),(r.state.search||[]).forEach(function(e){return e.search_endpoint="api"}),r):Promise.reject("Project doesn't exist")},i=function(){var s=n.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})},function(e){return i.apply(this,arguments)}),e("g3w-constants")),u=s(e("g3w-object")),c=s(e("store/application")),d=s(e("store/projections")),o=e("utils/normalizeEpsg"),p=e("utils/XHR"),f=e("map/layers/tablelayer"),g=e("map/layers/vectorlayer"),h=e("map/layers/imagelayer"),y=e("map/layers/layersstore");function s(e){return e&&e.__esModule?e:{default:e}}function m(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}Object.entries({TableLayer:f.TableLayer,VectorLayer:g.VectorLayer,ImageLayer:h.ImageLayer}).forEach(function(e){e=r(e,2);e[0]});var v={};function _(e){return[void 0,null].includes(e)?e:e&&e.epsg?(e.epsg=(0,o.normalizeEpsg)(e.epsg),e):{epsg:(0,o.normalizeEpsg)(e),proj4:"",axisinverted:!1,geographic:!1}}},{"g3w-constants":140,"g3w-object":144,"map/layers/imagelayer":169,"map/layers/layersstore":171,"map/layers/tablelayer":172,"map/layers/vectorlayer":173,"store/application":193,"store/projections":195,"utils/XHR":196,"utils/normalizeEpsg":243}],228:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.getProjectConfigByGid=function(t){return window.initConfig.projects.find(function(e){return t===e.gid})}},{}],229:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.getProjectUrl=function(t){var a=window.initConfig.projects.find(function(e){return t===e.gid});try{return""+new URL(window.initConfig.urls.baseurl)+a.url}catch(e){return""+location.origin+window.initConfig.urls.baseurl+a.url}}},{}],230:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.getResolutionFromScale=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"m";return 1/((1<=e?1/e:e)*n.INCHES_PER_UNIT[t]*n.DOTS_PER_INCH)};var n=e("g3w-constants")},{"g3w-constants":140}],231:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.getScaleFromResolution=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"m";return Math.round(e*n.INCHES_PER_UNIT[t]*n.DOTS_PER_INCH)};var n=e("g3w-constants")},{"g3w-constants":140}],232:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.getUniqueDomId=function(){return(n+=1)+"_"+Date.now()};var n=0},{}],233:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.get_legend_params=function(n){var i=void 0,r=void 0;return(n.getCategories()||[]).forEach(function(e){var t=e.checked,a=e.ruleKey;t!==e._checked&&(t?i=(void 0===i?n.getWMSLayerName()+":":i+",")+a:r=(void 0===r?n.getWMSLayerName()+":":r+",")+a)}),{LEGEND_ON:i,LEGEND_OFF:r}}},{}],234:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.groupBy=function(e,n){return e.reduce(function(e,t){var a=n(t);return e[a]||(e[a]=[]),e[a].push(t),e},{})}},{}],235:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.inherit=function(e,t){function a(){}a.prototype=t.prototype,e.superClass_=t.prototype,e.prototype=new a,e.prototype.constructor=e}},{}],236:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.intersects=function(e,t){var a=new jsts.io.OL3Parser;return a.read(e).intersects(a.read(t))}},{}],237:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.is3DGeometry=function(t){return[n.GEOMETRY_TYPES.POINTZ,n.GEOMETRY_TYPES.POINTM,n.GEOMETRY_TYPES.POINTZM,n.GEOMETRY_TYPES.POINT25D,n.GEOMETRY_TYPES.MULTIPOINTZ,n.GEOMETRY_TYPES.MULTIPOINTM,n.GEOMETRY_TYPES.MULTIPOINTZM,n.GEOMETRY_TYPES.MULTIPOINT25D,n.GEOMETRY_TYPES.LINESTRINGZ,n.GEOMETRY_TYPES.LINESTRINGM,n.GEOMETRY_TYPES.LINESTRINGZM,n.GEOMETRY_TYPES.LINESTRING25D,n.GEOMETRY_TYPES.MULTILINESTRINGZ,n.GEOMETRY_TYPES.MULTILINESTRINGM,n.GEOMETRY_TYPES.MULTILINESTRINGZM,n.GEOMETRY_TYPES.MULTILINESTRING25D,n.GEOMETRY_TYPES.LINEZ,n.GEOMETRY_TYPES.LINEM,n.GEOMETRY_TYPES.LINEZM,n.GEOMETRY_TYPES.LINE25D,n.GEOMETRY_TYPES.MULTILINEZ,n.GEOMETRY_TYPES.MULTILINEM,n.GEOMETRY_TYPES.MULTILINEZM,n.GEOMETRY_TYPES.MULTILINE25D,n.GEOMETRY_TYPES.POLYGONZ,n.GEOMETRY_TYPES.POLYGONM,n.GEOMETRY_TYPES.POLYGONZM,n.GEOMETRY_TYPES.POLYGON25D,n.GEOMETRY_TYPES.MULTIPOLYGONZ,n.GEOMETRY_TYPES.MULTIPOLYGONM,n.GEOMETRY_TYPES.MULTIPOLYGONZM,n.GEOMETRY_TYPES.MULTIPOLYGON25D].find(function(e){return e===t})};var n=e("g3w-constants")},{"g3w-constants":140}],238:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.isLineGeometryType=function(e){return[n.GEOMETRY_TYPES.LINESTRING,n.GEOMETRY_TYPES.LINESTRINGZ,n.GEOMETRY_TYPES.LINESTRINGM,n.GEOMETRY_TYPES.LINESTRINGZM,n.GEOMETRY_TYPES.LINESTRING25D,n.GEOMETRY_TYPES.MULTILINESTRING,n.GEOMETRY_TYPES.MULTILINESTRINGZ,n.GEOMETRY_TYPES.MULTILINESTRINGM,n.GEOMETRY_TYPES.MULTILINESTRINGZM,n.GEOMETRY_TYPES.MULTILINESTRING25D,n.GEOMETRY_TYPES.LINE,n.GEOMETRY_TYPES.LINEZ,n.GEOMETRY_TYPES.LINEM,n.GEOMETRY_TYPES.LINEZM,n.GEOMETRY_TYPES.LINE25D,n.GEOMETRY_TYPES.MULTILINE,n.GEOMETRY_TYPES.MULTILINEZ,n.GEOMETRY_TYPES.MULTILINEM,n.GEOMETRY_TYPES.MULTILINEZM,n.GEOMETRY_TYPES.MULTILINE25D].includes(e)};var n=e("g3w-constants")},{"g3w-constants":140}],239:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.isMultiGeometry=function(e){return[n.GEOMETRY_TYPES.MULTIPOINT,n.GEOMETRY_TYPES.MULTIPOINTZ,n.GEOMETRY_TYPES.MULTIPOINTZM,n.GEOMETRY_TYPES.MULTIPOINTM,n.GEOMETRY_TYPES.MULTIPOINT25D,n.GEOMETRY_TYPES.MULTILINESTRING,n.GEOMETRY_TYPES.MULTILINESTRINGZ,n.GEOMETRY_TYPES.MULTILINESTRINGM,n.GEOMETRY_TYPES.MULTILINESTRINGZM,n.GEOMETRY_TYPES.MULTILINESTRING25D,n.GEOMETRY_TYPES.MULTILINE,n.GEOMETRY_TYPES.MULTILINEZ,n.GEOMETRY_TYPES.MULTILINEM,n.GEOMETRY_TYPES.MULTILINEZM,n.GEOMETRY_TYPES.MULTILINE25D,n.GEOMETRY_TYPES.MULTIPOLYGON,n.GEOMETRY_TYPES.MULTIPOLYGONZ,n.GEOMETRY_TYPES.MULTIPOLYGONM,n.GEOMETRY_TYPES.MULTIPOLYGONZM,n.GEOMETRY_TYPES.MULTIPOLYGON25D].includes(e)};var n=e("g3w-constants")},{"g3w-constants":140}],240:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.isPointGeometryType=function(e){return[n.GEOMETRY_TYPES.POINT,n.GEOMETRY_TYPES.POINTZ,n.GEOMETRY_TYPES.POINTM,n.GEOMETRY_TYPES.POINTZM,n.GEOMETRY_TYPES.POINT25D,n.GEOMETRY_TYPES.MULTIPOINT,n.GEOMETRY_TYPES.MULTIPOINTZ,n.GEOMETRY_TYPES.MULTIPOINTM,n.GEOMETRY_TYPES.MULTIPOINTZM,n.GEOMETRY_TYPES.MULTIPOINT25D].includes(e)};var n=e("g3w-constants")},{"g3w-constants":140}],241:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.isPolygonGeometryType=function(e){return[n.GEOMETRY_TYPES.POLYGON,n.GEOMETRY_TYPES.POLYGONZ,n.GEOMETRY_TYPES.POLYGONM,n.GEOMETRY_TYPES.POLYGONZM,n.GEOMETRY_TYPES.POLYGON25D,n.GEOMETRY_TYPES.MULTIPOLYGON,n.GEOMETRY_TYPES.MULTIPOLYGONZ,n.GEOMETRY_TYPES.MULTIPOLYGONM,n.GEOMETRY_TYPES.MULTIPOLYGONZM,n.GEOMETRY_TYPES.MULTIPOLYGON25D].includes(e)};var n=e("g3w-constants")},{"g3w-constants":140}],242:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.noop=function(){}},{}],243:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.normalizeEpsg=function(e){if("number"==typeof e)return"EPSG:"+e;if(""!==(e=e.replace(/[^\d\.\-]/g,"")))return"EPSG:"+parseInt(e)}},{}],244:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.parseAttributes=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1];if(e&&0<e.length)return e.filter(function(e){return-1<Object.keys(t).indexOf(e.name)});return Object.keys(t).filter(function(e){return-1===n.GEOMETRY_FIELDS.indexOf(e)}).map(function(e){return{name:e,label:e}})};var n=e("g3w-constants")},{"g3w-constants":140}],245:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.ResponseParser=void 0;var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},s=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},p=e("g3w-constants"),n=e("services/gui"),f=(n=n)&&n.__esModule?n:{default:n},g=e("utils/groupBy"),h=e("utils/is3DGeometry"),y=e("utils/removeZValueToOLFeatureGeometry"),l=e("utils/sanitizeFidFeature"),m=e("utils/reverseGeometry"),i=e("map/layers/feature");function v(e,t,a){t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a}var r=e("g3w-i18n").t,_=(Object.entries({G3W_FID:p.G3W_FID,GUI:f.default,Feature:i.Feature,t:r,is3DGeometry:h.is3DGeometry,removeZValueToOLFeatureGeometry:y.removeZValueToOLFeatureGeometry,sanitizeFidFeature:l.sanitizeFidFeature,reverseGeometry:m.reverseGeometry}).forEach(function(e){e=s(e,2);e[0]}),"GIS3W_ESCAPE_NUMERIC_FIELD_"),u=a.ResponseParser={get:function(e){switch(e){case"g3w-error":return function(){var t=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).error;return{parse:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).type,e=void 0===e?"responseJSON":e;return"responseJSON"===e&&t&&t.responseJSON&&t.responseJSON.error.message?t.responseJSON.error.message:"responseJSON"===e&&t&&t.errors?c(t.errors):"String"===e&&"string"==typeof t?t:"String"===e?c(t):r("server_saver_error")}}};case"g3w-table/json":return function(){return((0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).features||[]).map(function(e){var t=new i.Feature;return t.setProperties(e.properties),t.setId(e.id),t})};case"g3w-vector/gml":return function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.data,e=e.layer;try{return new ol.format.WMSGetFeatureInfo({layers:e.getQueryLayerOrigName()}).readFeatures("--"===t.substr(0,2)?t.split(/\r\n--/).filter(function(e){return/<([^ ]*)FeatureCollection/.test(e)||/<([^ ]*)msGMLOutput/.test(e)}).map(function(e){return e.substr(e.indexOf("<?xml"))}).pop():t)}catch(e){return[]}};case"g3w-vector/geojson":case"g3w-vector/json":return function(e,t){try{return new ol.format.GeoJSON({geometryName:"geometry",dataProjection:t.crs,featureProjection:t.mapCrs||t.crs}).readFeatures("string"==typeof e?JSON.parse(e):e)}catch(e){return[]}};case"application/json":return function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.response,a=e.projections,n=e.layers,n=void 0===n?[]:n,e=e.wms,i=void 0===e||e,r=n.map(function(e){return{layer:e,features:[]}}),o=n.map(function(e){return i?e.getWMSLayerName():e.getWFSLayerName()});return(t?new ol.format.GeoJSON({geometryName:"geometry",defaultDataProjection:a.layer||a.map}).readFeatures(t):[]).filter(function(t){var e=t.getId(),a=(0,l.sanitizeFidFeature)(e),e=e==a?0:o.indexOf(e);if(-1===e)return!1;var n=t.getProperties();t.set(p.G3W_FID,a),r[e].layer.getFields().filter(function(e){return e.show&&void 0===n[e.name]&&void 0!==n[e.label]}).forEach(function(e){return t.set(e.name,n[e.label])}),r[e].features.push(t)}),r};case"application/geojson":return function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layers,a=e.response;return a?t.map(function(e){return{layer:e,features:u.get("g3w-vector/geojson")(a,{})}}):[]};case"text/plain":case"text/html":return function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layers,a=e.response;return t.map(function(e){return{layer:e,rawdata:a}})};case"text/gml":return function(e){var t=e.layers,a=e.response;return t.map(function(e){return{layer:e,features:u.get("g3w-vector/gml")({data:a,layer:t[0]})}})};case"application/vnd.ogc.gml":return function(){var i,o,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.response,s=e.projections,a=e.layers,n=e.wms,r=void 0===n||n,n=e.id,l=void 0!==n&&n,u=(t=(t=!t||"string"==typeof t||t instanceof String?t:(new XMLSerializer).serializeToString(t))&&a.reduce(function(e,t,a){t=(r&&t.isWmsUseLayerIds()?t.getId():t.getName()).replace(/[\s'()/]+/g,function(e){return/\s/g.test(e)&&!r?"_":""});return r||(t=t.replace(/[/\\]+/g,"").replaceAll(":","-")),e.replace(new RegExp("qgs:"+t,"g"),"qgs:layer"+a)},t))&&Array.from(t.matchAll(/qgs:(\d+(?:\.\d+)?)(\w+)|qgs:(\w+):(\w+)/g)).filter(function(e,t){return 0==t%2}),c=(t=(t=u?u.reduce(function(e,t){return e.replace(new RegExp(t[0],"g"),"qgs:"+_+t[1]+t[2])},t):t)&&t.replace(new RegExp(String.fromCharCode(0),"g"),"0"),new X2JS),d=c.xml_str2json(t);return d?(d.ServiceExceptionReport&&d.ServiceExceptionReport.ServiceException&&f.default.showUserMessage({type:"warning",textMessage:!0,message:a[0].getName()+" - "+d.ServiceExceptionReport.ServiceException}),d.FeatureCollection&&d.FeatureCollection.featureMember?(i=[],o=[].concat(d.FeatureCollection.featureMember),a.forEach(function(e,t){var n,r=l?e.getId():"layer"+t,t=(d.FeatureCollection.featureMember=o.filter(function(e){return e[r]}).map(function(e){var t,a=e[r],i=e.__prefix;return[].concat(a).forEach(function(e){e._fid=e._fid&&e._fid.split(".")[1],e[p.G3W_FID]={__prefix:i,__text:e._fid}}),Array.isArray(a)?(t=(0,g.groupBy)(a,function(e){return Object.keys(e)}),1<Object.keys(t).length?Object.keys(t).map(function(e,n){return t[e].map(function(e,t){var a={};return v(a,"layer"+n+"_"+t,e),v(a,"__prefix",i),a})}).flat():a.map(function(e){var t={};return v(t,r,e),v(t,"__prefix",i),t})):e}).flat(),c.json2xml_str(d)),t=(new ol.format.WMSGetFeatureInfo).readFeatures(t),a=0<t.length&&!!t[0].getGeometry()&&s.layer&&s.layer.getCode()!==s.map.getCode();0<t.length&&u&&(n=Object.keys(t[0].getProperties()).filter(function(e){return-1!==e.indexOf(_)}),t.forEach(function(a){n.forEach(function(t){var e=u.find(function(e){return""+e[1]+e[2]===t.replace(_,"")});a.set(e[0].replace("qgs:",""),[].concat(a.get(t))[0]),a.unset(t)})})),a&&t.forEach(function(e){return e.setGeometry(e.getGeometry().transform(s.layer.getCode(),s.map.getCode()))}),a&&"ne"===(s.layer||s.map).getAxisOrientation().substr(0,2)&&t.forEach(function(e){return e.setGeometry((0,m.reverseGeometry)(e.getGeometry()))}),e.isGeoLayer()&&!(0,h.is3DGeometry)(e.getGeometryType())&&t.forEach(function(e){return(0,y.removeZValueToOLFeatureGeometry)({feature:e})}),i.unshift({layer:e,features:t})}),i):[]):[{layer:a[0],features:[]}]};default:return function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).layers;return(void 0===e?[]:e).map(function(e){return{layer:e,rawdata:r("warning.not_supported_format")}})}}}};function c(e,t){t=1<arguments.length&&void 0!==t?t:"server_saver_error";try{var a=Object.entries(e),n=a.find(function(e){e=s(e,2),e=e[0];return"fields"===e}),i=n||a[0],r=s(i,2)[1];return n||Array.isArray(r)||"object"!==(void 0===r?"undefined":o(r))?(n&&"string"==typeof r&&(t="["+a.find(function(e){return"fields"!==s(e,1)[0]})[0]+"] "+r),n&&"string"!=typeof r&&(t=Object.entries(r).reduce(function(e,t){var t=s(t,2),a=t[0],t=t[1];return""+e+a+" "+(Array.isArray(t)?t[0]:t)+"\n"},"")),n?t.replace(/\:|\./g,""):void 0):c(r,t)}catch(e){}}},{"g3w-constants":140,"g3w-i18n":143,"map/layers/feature":166,"services/gui":188,"utils/groupBy":234,"utils/is3DGeometry":237,"utils/removeZValueToOLFeatureGeometry":250,"utils/reverseGeometry":251,"utils/sanitizeFidFeature":253}],246:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.printAtlas=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"GET",a=i.default.project.getLayersStore(),n=1<e.values.length;return s[t]({url:a.getWmsUrl(),mime_type:"application/pdf",params:{SERVICE:"WMS",VERSION:"1.3.0",REQUEST:"GetPrintAtlas",EXP_FILTER:e.field+(n?" IN (":"=")+e.values.map(function(e){return"'"+e+"'"}).join()+(n?")":""),TEMPLATE:e.template,filtertoken:i.default.tokens.filtertoken,DOWNLOAD:e.download?1:void 0}})};var a=e("store/application"),i=(e=a)&&e.__esModule?e:{default:e};function n(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})}}var r,o,s={POST:(o=n(function*(e){var t=e.url,a=e.params,e=e.mime_type,t=yield fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded; charset=UTF-8"},body:new URLSearchParams((void 0===a?{}:a)||{}).toString()});if(t.ok)return{mime_type:e,layers:!0,url:URL.createObjectURL(yield t.blob())};throw new Error(500===t.status?"Internal Server Error":"Request Failed")}),function(e){return o.apply(this,arguments)}),GET:(r=n(function*(e){var t=e.url,a=e.params,e=e.mime_type;return{url:t+"?"+new URLSearchParams((void 0===a?{}:a)||{}).toString(),layers:!0,mime_type:e}}),function(e){return r.apply(this,arguments)})}},{"store/application":193}],247:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.promisify=function(a){if(a instanceof Promise)return a;return a&&a.then?new Promise(function(e,t){a.then(e).fail(t)}):(void 0,Promise.reject("not a promise"))},a.$promisify=function(a){if(void 0===a)return $.Deferred(function(e){return e.reject("not a promise")}).promise();if(a.always)return a;return $.Deferred((()=>{e=function*(t){try{t.resolve(yield a instanceof Promise?a:a())}catch(e){t.reject(e)}};var e,t=function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})};return function(e){return t.apply(this,arguments)}})()).promise()}},{}],248:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.prompt=void 0;a.prompt=(n=function*(e){var t=e.value,a=e.label,e=e.callback,n={value:t,id:(0,o.getUniqueDomId)()},i=new Vue({template:'\n      <div>\n        <label :for="id">'+a+'</label>\n        <input\n          v-model      = "value"\n          :id          = "id"\n          class        = "bootbox-input bootbox-input-text form-control"\n          autocomplete = "off"\n          type         = "text"\n        >\n      </div>',data:function(){return n}});new Promise(function(e,t){var a=r.default.showModalDialog({message:i.$mount().$el,closeButton:!1,buttons:{ok:{label:"Ok",className:"btn-success",callback:function(){return e(n.value)}},cancel:{label:"Cancel",className:"btn-danger",callback:function(){return t()}}}}).find("button.btn-success");a.prop("disabled",0===n.value.trim().length),i.$watch("value",function(e){a.prop("disabled",0===e.trim().length)})}).then(e).finally(function(){i.$destroy(),n=i=null})},i=function(){var s=n.apply(this,arguments);return new Promise(function(r,o){return function t(e,a){try{var n=s[e](a),i=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(i).then(function(e){t("next",e)},function(e){t("throw",e)});r(i)}("next")})},function(e){return i.apply(this,arguments)});var n,i,a=e("services/gui"),r=(a=a)&&a.__esModule?a:{default:a},o=e("utils/getUniqueDomId")},{"services/gui":188,"utils/getUniqueDomId":232}],249:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.removeMeasureTooltip=function(e){var t=e.map,a=e.tooltip,e=e.unbyKey;t.removeOverlay(a),ol.Observable.unByKey(e)}},{}],250:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.removeZValueToOLFeatureGeometry=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).feature,t=e.getGeometry();if(t){var a=t.getCoordinates();switch(t.getType()){case n.GEOMETRY_TYPES.POINT:3===a.length&&(a.splice(2),e.getGeometry().setCoordinates(a));break;case n.GEOMETRY_TYPES.MULTIPOINT:case n.GEOMETRY_TYPES.LINESTRING:case n.GEOMETRY_TYPES.LINE:a.forEach(function(e){return e.splice(2)}),e.getGeometry().setCoordinates(a);break;case n.GEOMETRY_TYPES.MULTILINESTRING:case n.GEOMETRY_TYPES.MULTILINE:a.forEach(function(e){return e.forEach(function(e){return e.splice(2)})}),e.getGeometry().setCoordinates(a);break;case n.GEOMETRY_TYPES.POLYGON:a[0].forEach(function(e){return e.splice(2)}),e.getGeometry().setCoordinates(a);break;case n.GEOMETRY_TYPES.MULTIPOLYGON:a.forEach(function(e){return e[0].forEach(function(e){return e.splice(2)})}),e.getGeometry().setCoordinates(a)}}return e};var n=e("g3w-constants")},{"g3w-constants":140}],251:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var a=t,n=[],i=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(i=(o=s.next()).done)&&(n.push(o.value),!a||n.length!==a);i=!0);}catch(e){t=!0,r=e}finally{try{!i&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")};a.reverseGeometry=function(e){return e.setCoordinates(function n(i){i.find(function(e){var t,a;if(!Array.isArray(e))return a=r(i,2),t=a[0],a=a[1],i[0]=a,i[1]=t,!0;n(e)});return i}(e.getCoordinates())),e}},{}],252:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.sameOrigin=function(e,t){try{return new URL(e).origin===new URL(t).origin}catch(e){return!1}}},{}],253:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.sanitizeFidFeature=function(e){"string"==typeof e&&Number.isNaN(+e)&&(e=(e=e.split(".")).at(2===e.length?1:0));return e}},{}],254:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.setProjectAliasUrl=function(t){var e=window.initConfig.projects.find(function(e){return t.gid===e.gid});e&&(e.url=""+(t.host||"")+t.url)}},{}],255:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0});var _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},b=(a.splitFeature=function a(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.feature,n=e.splitfeature;var m={feature:t.getGeometry(),split:n.getGeometry()};if("LineString"!==m.split.getType())return[];var i=[];var r=new jsts.io.OL3Parser;var o=(0,b.isMultiGeometry)(m.feature.getType());e=(0,x.isLineGeometryType)(m.feature.getType());t=(0,w.isPolygonGeometryType)(m.feature.getType());var s=t&&(o?m.feature.getPolygons():m.feature);var l=e&&(o?m.feature.getLineStrings():m.feature);{var u;o&&(e||t)&&(u=t?ol.geom.MultiPolygon:ol.geom.MultiLineString,(t?s:l).forEach(function(e){var t=a({splitfeature:n,feature:new ol.Feature({geometry:e})});0<t.length?t.forEach(function(e){return e&&i.push(new u([e.getCoordinates()]))}):i.push(new u([e.getCoordinates()]))}))}if(t&&!o){var c=void 0!==s.getCoordinates()[0][0][2],d=r.read(s),p=r.read(s.getLinearRing(0)),l=r.read(m.split),f=void 0;if(1<s.getLinearRingCount()){for(var g=void 0,h=1;h<s.getLinearRingCount();h++){var y=r.read(s.getLinearRing(h));g=void 0===g?y:g.union(y)}(f=new jsts.operation.polygonize.Polygonizer).add(g);var v=void 0;f.getPolygons().toArray().forEach(function(e){return v=void 0===v?e:v.union(e)}),f=v}c&&(s.getCoordinates()[0].forEach(function(e,t){return p.getCoordinates()[t].z=e[2]}),l.getCoordinates().forEach(function(e){return e.z=0}));t=p.union(l),l=new jsts.operation.polygonize.Polygonizer,t=(l.add(t),l.getPolygons().toArray());1<t.length&&t.forEach(function(e){var t,a,n;f&&(e=e.difference(f)),d.intersects(e.getInteriorPoint())&&(t=r.write(e),a=e.getCoordinates(),c&&(a.forEach(function(e,t){return e.z=(void 0===e.z?a[0===t?t+1:t-1]:e).z}),n=[],t.getCoordinates()[0].forEach(function(e,t){e.push(a[t].z),n.push(e)}),t.setCoordinates([n])),e=!(0,b.isMultiGeometry)(t.getType()),o?i.push(new ol.geom.MultiPolygon(e?[t.getCoordinates()]:t.getCoordinates())):e?i.push(t):t.getCoordinates().forEach(function(e){return i.push(new ol.geom.Polygon(e))}))})}if(e&&!o){l=(()=>{var e=m.split,t=m.feature,n=void 0!==t.getCoordinates()[0][2],a=!1,i=[],r=new jsts.io.WKTReader,o=new ol.format.WKT,s=new jsts.io.OL3Parser,l=r.read(o.writeGeometry(e)),e=o.writeGeometry(t);n&&(e=e.replace(" Z",""));for(var u=(o=r.read(e)).getCoordinates(),c=new jsts.geom.GeometryFactory,d=[],p=void 0,f=void 0,g=0;g<u.length-1;g++){f=u[g],p=u[g+1],n&&(f.z=t.getCoordinates()[g][2],p.z=t.getCoordinates()[g+1][2]);var h=c.createLineString([f,p]),h=h.intersection(l).getCoordinates();a=a||0<h.length,h.forEach(function(e){n&&(e.z=f.z);var t,a=s.write(c.createLineString((d.length?d:[]).concat([f,e])));n&&(t=a.getCoordinates(),a.setCoordinates([[].concat(k(t[0]),[f.z]),[].concat(k(t[1]),[e.z])])),d.length&&(d=[]),i.push(a),f=e}),d=d.concat([f,p])}var y=s.write(c.createLineString(d));return n&&y.setCoordinates(d.map(function(e,t){t=y.getCoordinates()[t];return t.push(e.z),t})),i.push(y),{v:a?i:[]}})();if("object"===(void 0===l?"undefined":_(l)))return l.v}return i},e("utils/isMultiGeometry")),w=e("utils/isPolygonGeometryType"),x=e("utils/isLineGeometryType");function k(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}},{"utils/isLineGeometryType":238,"utils/isMultiGeometry":239,"utils/isPolygonGeometryType":241}],256:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.throttle=function(t){var a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:500,n=void 0;return function(){var e=n;n=Date.now(),(void 0===e||a<n-e)&&t.apply(void 0,arguments)}}},{}],257:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.toRawType=function(e){return Object.prototype.toString.call(e).slice(8,-1)}},{}],258:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.waitFor=function(i,r){return new Promise(function(e,t){function a(){i()&&(clearInterval(n),e())}var n=setInterval(a,100);a(),r&&setTimeout(function(){clearInterval(n),t()},r)})}},{}],259:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.within=function(e,t){var a=new jsts.io.OL3Parser;return a.read(t).within(a.read(e))}},{}],260:[function(e,t,a){Object.defineProperty(a,"__esModule",{value:!0}),a.default="3.11.0-alpha.1"},{}]},{},[147]);
//# sourceMappingURL=app.min.js.map
