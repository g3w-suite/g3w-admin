!function umd(root,factory){"object"==typeof module&&"object"==typeof exports?module.exports=factory():"function"==typeof define&&define.amd?define([],factory):root.httpVueLoader=factory()}(this,(function factory(){"use strict";var scopeIndex=0;function StyleContext(component,elt){this.component=component,this.elt=elt}function ScriptContext(component,elt){this.component=component,this.elt=elt,this.module={exports:{}}}function TemplateContext(component,elt){this.component=component,this.elt=elt}function Component(name){this.name=name,this.template=null,this.script=null,this.styles=[],this._scopeId=""}function identity(value){return value}function parseComponentURL(url){var comp=url.match(/(.*?)([^/]+?)\/?(\.vue)?(\?.*|#.*|$)/);return{name:comp[2],url:comp[1]+comp[2]+(void 0===comp[3]?"/index.vue":comp[3])+comp[4]}}function resolveURL(baseURL,url){return"./"===url.substr(0,2)||"../"===url.substr(0,3)?baseURL+url:url}function httpVueLoader(url,name){var comp=parseComponentURL(url);return httpVueLoader.load(comp.url,name)}return StyleContext.prototype={withBase:function(callback){var tmpBaseElt;if(this.component.baseURI){(tmpBaseElt=document.createElement("base")).href=this.component.baseURI;var headElt=this.component.getHead();headElt.insertBefore(tmpBaseElt,headElt.firstChild)}callback.call(this),tmpBaseElt&&this.component.getHead().removeChild(tmpBaseElt)},scopeStyles:function(styleElt,scopeName){function process(){for(var sheet=styleElt.sheet,rules=sheet.cssRules,i=0;i<rules.length;++i){var rule=rules[i];if(1===rule.type){var scopedSelectors=[];rule.selectorText.split(/\s*,\s*/).forEach((function(sel){scopedSelectors.push(scopeName+" "+sel);var segments=sel.match(/([^ :]+)(.+)?/);scopedSelectors.push(segments[1]+scopeName+(segments[2]||""))}));var scopedRule=scopedSelectors.join(",")+rule.cssText.substr(rule.selectorText.length);sheet.deleteRule(i),sheet.insertRule(scopedRule,i)}}}try{process()}catch(ex){if(ex instanceof DOMException&&ex.code===DOMException.INVALID_ACCESS_ERR)return styleElt.sheet.disabled=!0,void styleElt.addEventListener("load",(function onStyleLoaded(){styleElt.removeEventListener("load",onStyleLoaded),setTimeout((function(){process(),styleElt.sheet.disabled=!1}))}));throw ex}},compile:function(){var hasTemplate=null!==this.template,scoped=this.elt.hasAttribute("scoped");if(scoped){if(!hasTemplate)return;this.elt.removeAttribute("scoped")}return this.withBase((function(){this.component.getHead().appendChild(this.elt)})),scoped&&this.scopeStyles(this.elt,"["+this.component.getScopeId()+"]"),Promise.resolve()},getContent:function(){return this.elt.textContent},setContent:function(content){this.withBase((function(){this.elt.textContent=content}))}},ScriptContext.prototype={getContent:function(){return this.elt.textContent},setContent:function(content){this.elt.textContent=content},compile:function(module){var childModuleRequire=function(childURL){return httpVueLoader.require(resolveURL(this.component.baseURI,childURL))}.bind(this),childLoader=function(childURL,childName){return httpVueLoader(resolveURL(this.component.baseURI,childURL),childName)}.bind(this);try{Function("exports","require","httpVueLoader","module",this.getContent()).call(this.module.exports,this.module.exports,childModuleRequire,childLoader,this.module)}catch(ex){if(!("lineNumber"in ex))return Promise.reject(ex);var vueFileData=responseText.replace(/\r?\n/g,"\n"),lineNumber=vueFileData.substr(0,vueFileData.indexOf(script)).split("\n").length+ex.lineNumber-1;throw new ex.constructor(ex.message,url,lineNumber)}return Promise.resolve(this.module.exports).then(httpVueLoader.scriptExportsHandler.bind(this)).then(function(exports){this.module.exports=exports}.bind(this))}},TemplateContext.prototype={getContent:function(){return this.elt.innerHTML},setContent:function(content){this.elt.innerHTML=content},getRootElt:function(){var tplElt=this.elt.content||this.elt;if("firstElementChild"in tplElt)return tplElt.firstElementChild;for(tplElt=tplElt.firstChild;null!==tplElt;tplElt=tplElt.nextSibling)if(tplElt.nodeType===Node.ELEMENT_NODE)return tplElt;return null},compile:function(){return Promise.resolve()}},Component.prototype={getHead:function(){return document.head||document.getElementsByTagName("head")[0]},getScopeId:function(){return""===this._scopeId&&(this._scopeId="data-s-"+(scopeIndex++).toString(36),this.template.getRootElt().setAttribute(this._scopeId,"")),this._scopeId},load:function(componentURL){return httpVueLoader.httpRequest(componentURL).then(function(responseText){this.baseURI=componentURL.substr(0,componentURL.lastIndexOf("/")+1);var doc=document.implementation.createHTMLDocument("");doc.body.innerHTML=(this.baseURI?'<base href="'+this.baseURI+'">':"")+responseText;for(var it=doc.body.firstChild;it;it=it.nextSibling)switch(it.nodeName){case"TEMPLATE":this.template=new TemplateContext(this,it);break;case"SCRIPT":this.script=new ScriptContext(this,it);break;case"STYLE":this.styles.push(new StyleContext(this,it))}return this}.bind(this))},_normalizeSection:function(eltCx){var p;return(p=null!==eltCx&&eltCx.elt.hasAttribute("src")?httpVueLoader.httpRequest(eltCx.elt.getAttribute("src")).then((function(content){return eltCx.elt.removeAttribute("src"),content})):Promise.resolve(null)).then(function(content){if(null!==eltCx&&eltCx.elt.hasAttribute("lang")){var lang=eltCx.elt.getAttribute("lang");return eltCx.elt.removeAttribute("lang"),httpVueLoader.langProcessor[lang.toLowerCase()].call(this,null===content?eltCx.getContent():content)}return content}.bind(this)).then((function(content){null!==content&&eltCx.setContent(content)}))},normalize:function(){return Promise.all(Array.prototype.concat(this._normalizeSection(this.template),this._normalizeSection(this.script),this.styles.map(this._normalizeSection))).then(function(){return this}.bind(this))},compile:function(){return Promise.all(Array.prototype.concat(this.template&&this.template.compile(),this.script&&this.script.compile(),this.styles.map((function(style){return style.compile()})))).then(function(){return this}.bind(this))}},httpVueLoader.load=function(url,name){return function(){return new Component(name).load(url).then((function(component){return component.normalize()})).then((function(component){return component.compile()})).then((function(component){var exports=null!==component.script?component.script.module.exports:{};return null!==component.template&&(exports.template=component.template.getContent()),void 0===exports.name&&void 0!==component.name&&(exports.name=component.name),exports._baseURI=component.baseURI,exports}))}},httpVueLoader.register=function(Vue,url){var comp=parseComponentURL(url);Vue.component(comp.name,httpVueLoader.load(comp.url))},httpVueLoader.install=function(Vue){Vue.mixin({beforeCreate:function(){var components=this.$options.components;for(var componentName in components)if("string"==typeof components[componentName]&&"url:"===components[componentName].substr(0,4)){var comp=parseComponentURL(components[componentName].substr(4)),componentURL="_baseURI"in this.$options?resolveURL(this.$options._baseURI,comp.url):comp.url;isNaN(componentName)?components[componentName]=httpVueLoader.load(componentURL,componentName):components[componentName]=Vue.component(comp.name,httpVueLoader.load(componentURL,comp.name))}}})},httpVueLoader.require=function(moduleName){return window[moduleName]},httpVueLoader.httpRequest=function(url){return new Promise((function(resolve,reject){var xhr=new XMLHttpRequest;xhr.open("GET",url),xhr.responseType="text",xhr.onreadystatechange=function(){4===xhr.readyState&&(xhr.status>=200&&xhr.status<300?resolve(xhr.responseText):reject(xhr.status))},xhr.send(null)}))},httpVueLoader.langProcessor={html:identity,js:identity,css:identity},httpVueLoader.scriptExportsHandler=identity,httpVueLoader}));