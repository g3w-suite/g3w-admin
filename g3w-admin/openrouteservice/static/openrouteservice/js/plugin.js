!function(){var e=window&&window.initConfig&&window.initConfig.group&&window.initConfig.group.plugins;e&&(e.openrouteservice=Object.assign(e.openrouteservice||{},{version:"3.8.0-alpha.0",hash:"f509534",branch:"dev"}))}(),function a(n,r,o){function s(t,e){if(!r[t]){if(!n[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(l)return l(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}i=r[t]={exports:{}},n[t][0].call(i.exports,function(e){return s(n[t][1][e]||e)},i,i.exports,a,n,r,o)}return r[t].exports}for(var l="function"==typeof require&&require,e=0;e<o.length;e++)s(o[e]);return s}({1:[function(e,t,i){var a=i.cache={};function n(){}i.insert=function(e){if(a[e])return n;a[e]=!0;var t=document.createElement("style");return t.setAttribute("type","text/css"),"textContent"in t?t.textContent=e:t.styleSheet.cssText=e,document.getElementsByTagName("head")[0].appendChild(t),function(){document.getElementsByTagName("head")[0].removeChild(t),a[e]=!1}}},{}],2:[function(e,t,i){var e=e("./panel.vue"),a=(e=e)&&e.__esModule?e:{default:e};var e=g3wsdk.core.utils,n=e.base;function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=(e.title="OPENROUTESERVICE",n(this,e),e.service),t=(this.setService(e),Vue.extend(a.default));this.setInternalPanel(new t({service:e})),this.unmount=function(){var e=this;return n(this,"unmount").then(function(){return e.service.clear()})}}(0,e.inherit)(r,g3wsdk.gui.Panel),t.exports=r},{"./panel.vue":3}],3:[function(e,t,i){var a,n,r,o,s,l,u;e("vueify/lib/insert-css").insert(".openrouteservice-plugin-footer[data-v-11b508b4]{margin-top:auto;font-weight:700}.row[data-v-11b508b4]{padding:2px}.openrouteservice-radio-buttons[data-v-11b508b4]{display:flex;justify-content:space-between;margin:5px 0}.openrouteservice-form-header[data-v-11b508b4]{font-weight:700;padding-bottom:3px;margin:0 0 2px;width:100%;border-bottom:1px solid #fff}");function p(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,i){try{var a=s[e](i),n=a.value}catch(e){return void o(e)}if(!a.done)return Promise.resolve(n).then(function(e){t("next",e)},function(e){t("throw",e)});r(n)}("next")})}}function c(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}Object.defineProperty(i,"__esModule",{value:!0}),e=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,a=arguments[t];for(i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},r=g3wsdk.core.ApplicationState,o=g3wsdk.gui.vue.Inputs.InputsComponents,s=g3wsdk.core.i18n.tPlugin,l=g3wsdk.gui.GUI,u={time:60,distance:1e5},i.default={name:"OpenRouteServiceForm",data:function(){return{validForm:!1,state:this.$options.service.state,currentinputs:"mapcoordinates",currentoutputs:"newlayer"}},components:e({},o),computed:{form:function(){return this.state.form},isochrones:function(){return this.state.form.isochrones},inputs:function(){return this.state.form.inputs},outputs:function(){return this.state.form.outputs}},methods:{translateInputsLabel:function(){function i(t){void 0===t.labels?(t.label=s(t.i18n_label),t.input.options&&Array.isArray(t.input.options.values)&&t.input.options.values.filter(function(e){void 0!==e.i18n_key&&(e.key=s(e.i18n_key))})):Object.keys(t.labels).forEach(function(e){t.labels[e]=s(t.i18n_labels[e])})}var a=this;Object.keys(this.state.form).forEach(function(t){Array.isArray(a.state.form[t])?a.state.form[t].forEach(i):Object.keys(a.state.form[t]).forEach(function(e){a.state.form[t][e].forEach(i)})})},validate:function(e){var t,i,a;e&&("range"===e.name?(t=this.isochrones[2],i=this.isochrones[4],e.value=e.value&&e.value.trim().match(/\d+,{0,1}/g).splice(0,10),e.value=e.value&&e.value.filter(function(e){return+e.replace(",","")<=u[t.value]}).join(""),0===(a=e.value?e.value.split(",").filter(function(e){return e}):[]).length?(e.value=null,i.editable=!1,e.validate.valid=!1,i.value=0):1<a.length?(i.editable=!1,i.value=0,i.input.options.min=0,i.input.options.max=0):(i.editable=!0,e.value=e.value>u[t.value]?""+u[t.value]:e.value,e.validate.valid=0<e.value,i.editable=0<+e.value,i.editable&&(i.input.options.min=Math.round(+e.value/10),i.input.options.max=+e.value,i.value=i.input.options.max))):"range_type"===e.name&&((a=this.isochrones[3]).value=+a.value>u[e.value]?""+u[e.value]:a.value,a.info="[MIN: 1 - MAX: "+u[e.value]+"]",a.validate.valid||(a.validate.message=a.info))),this.validForm=[].concat(c(this.isochrones),c(this.inputs[this.currentinputs]),c(this.outputs[this.currentoutputs])).reduce(function(e,t){return e&&(void 0===t.validate.valid||t.validate.valid)},!0)},run:(n=p(function*(){l.disableSideBar(!0),yield this.$options.service.run({api:this.currentinputs,output:this.currentoutputs,inputs:[].concat(c(this.isochrones),c(this.inputs[this.currentinputs]),c(this.outputs[this.currentoutputs]))}),l.disableSideBar(!1)}),function(){return n.apply(this,arguments)})},watch:{currentinputs:function(e){this.inputs[e].forEach(function(e){"select"===e.input.type&&null===e.value&&(e.value=e.input.options.values[0].value)}),this.validate()},currentoutputs:function(e){this.outputs[e].forEach(function(e){"select"===e.input.type&&null===e.value&&(e.value=e.input.options.values[0].value)}),this.validate()}},created:function(){var e=this;this.translateInputsLabel(),this.$watch(function(){return r.language},function(){return e.translateInputsLabel()})},mounted:(a=p(function*(){}),function(){return a.apply(this,arguments)})},t.exports.__esModule&&(t.exports=t.exports.default);i="function"==typeof t.exports?t.exports.options:t.exports;i.render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"g3w-openservice-plugin-panel form-group",staticStyle:{height:"100%"}},[i("div",{staticClass:"form-group",staticStyle:{display:"flex","flex-direction":"column",height:"100%"}},[i("div",{staticClass:"openrouteservice-form",attrs:{id:"openrouteservice-plugin-form-isochrones"}},[i("h5",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"openrouteservice.isochrones.title",expression:"'openrouteservice.isochrones.title'"}],staticClass:"openrouteservice-form-header skin-color"}),t._v(" "),i("form",{staticClass:"openrouteservice-form-inputs"},t._l(t.isochrones,function(e){return i("div",{key:e.name,staticClass:"row"},[i(e.input.type+"_input",{tag:"component",attrs:{state:e},on:{changeinput:t.validate}}),t._v(" "),i("span",{staticStyle:{height:"20px",width:"100%"}})],1)}),0)]),t._v(" "),i("div",{staticClass:"openrouteservice-form",attrs:{id:"openrouteservice-plugin-form-inputs"}},[i("h5",{staticClass:"openrouteservice-form-header skin-color"},[t._v("INPUT")]),t._v(" "),i("form",{staticClass:"openrouteservice-form-inputs"},[i("div",{staticClass:"openrouteservice-radio-buttons"},[i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.currentinputs,expression:"currentinputs"}],staticClass:"magic-radio",attrs:{id:"mapcoordinates",type:"radio",name:"radio",value:"mapcoordinates"},domProps:{checked:t._q(t.currentinputs,"mapcoordinates")},on:{change:function(e){t.currentinputs="mapcoordinates"}}}),t._v(" "),i("label",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"openrouteservice.isochrones.label.mapcoordinates",expression:"'openrouteservice.isochrones.label.mapcoordinates'"}],attrs:{for:"mapcoordinates"}})]),t._v(" "),i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.currentinputs,expression:"currentinputs"}],staticClass:"magic-radio",attrs:{id:"pointlayer",type:"radio",name:"radio",value:"from_layer",disabled:0===t.inputs.from_layer[0].input.options.values.length},domProps:{checked:t._q(t.currentinputs,"from_layer")},on:{change:function(e){t.currentinputs="from_layer"}}}),t._v(" "),i("label",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"openrouteservice.isochrones.label.pointlayer",expression:"'openrouteservice.isochrones.label.pointlayer'"}],attrs:{for:"pointlayer"}})])]),t._v(" "),t._l(t.inputs[this.currentinputs],function(e){return i("div",{key:e.name,staticClass:"row"},[i(e.input.type+"_input",{tag:"component",attrs:{state:e},on:{changeinput:t.validate}}),t._v(" "),i("span",{staticStyle:{height:"20px",width:"100%"}})],1)})],2)]),t._v(" "),i("div",{staticClass:"openrouteservice-form",attrs:{id:"openrouteservice-plugin-form-outputs"}},[i("h5",{staticClass:"openrouteservice-form-header skin-color"},[t._v("OUTPUT")]),t._v(" "),i("form",{staticClass:"openrouteservice-form-inputs"},[i("div",{staticClass:"openrouteservice-radio-buttons"},[i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.currentoutputs,expression:"currentoutputs"}],staticClass:"magic-radio",attrs:{id:"newlayer",type:"radio",name:"radio",value:"newlayer"},domProps:{checked:t._q(t.currentoutputs,"newlayer")},on:{change:function(e){t.currentoutputs="newlayer"}}}),t._v(" "),i("label",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"openrouteservice.outputs.newlayer",expression:"'openrouteservice.outputs.newlayer'"}],attrs:{for:"newlayer"}})]),t._v(" "),i("div",[i("input",{directives:[{name:"model",rawName:"v-model",value:t.currentoutputs,expression:"currentoutputs"}],staticClass:"magic-radio",attrs:{id:"existinglayer",type:"radio",name:"radio",value:"existinglayer",disabled:0===this.outputs.existinglayer[0].input.options.values.length},domProps:{checked:t._q(t.currentoutputs,"existinglayer")},on:{change:function(e){t.currentoutputs="existinglayer"}}}),t._v(" "),i("label",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"openrouteservice.outputs.existinglayer",expression:"'openrouteservice.outputs.existinglayer'"}],attrs:{for:"existinglayer"}})])]),t._v(" "),t._l(t.outputs[this.currentoutputs],function(e){return i("div",{key:e.name,staticClass:"row"},[i(e.input.type+"_input",{tag:"component",attrs:{state:e},on:{changeinput:t.validate}}),t._v(" "),i("span",{staticStyle:{height:"20px",width:"100%"}})],1)})],2)]),t._v(" "),i("div",{staticClass:"openrouteservice-plugin-footer"},[i("progressbar",{attrs:{progress:t.state.task.progress}}),t._v(" "),i("button",{directives:[{name:"disabled",rawName:"v-disabled",value:!t.validForm||t.state.loading,expression:"!validForm || state.loading"},{name:"t-plugin",rawName:"v-t-plugin",value:"openrouteservice.run",expression:"'openrouteservice.run'"}],staticClass:"btn btn-block skin-background-color",staticStyle:{"font-weight":"bold","margin-bottom":"10px","margin-top":"5px"},on:{click:function(e){return e.stopPropagation(),t.run(e)}}})],1)])])},i.staticRenderFns=[],i._scopeId="data-v-11b508b4"},{"vueify/lib/insert-css":1}],4:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={api:{urls:{compatible_layers:"/openrouteservice/api/compatible_layers",isochrone_mapcoordinates:"/openrouteservice/api/isochrone",isochrone_from_layer:"/openrouteservice/api/isochrone_from_layer",task:"/openrouteservice/api/isochrone_from_layer_result"}},form:{isochrones:[{visible:!0,name:"name",type:"varchar",i18n_label:"openrouteservice.isochrones.label.name",label:"",editable:!0,validate:{required:!0,valid:!1},pk:!1,default:"",input:{type:"text",options:{}},value:null},{visible:!0,name:"profile",type:"varchar",i18n_label:"openrouteservice.isochrones.label.profile",label:"",dropdownParent:!1,nullOption:!1,editable:!0,validate:{required:!0,valid:!1},pk:!1,default:"",input:{type:"select",options:{values:[],default:null}},value:null},{visible:!0,name:"range_type",type:"varchar",i18n_label:"openrouteservice.isochrones.label.range_type",label:"",dropdownParent:!1,nullOption:!1,editable:!0,validate:{required:!0,valid:!0},pk:!1,default:"",input:{type:"select",options:{values:[{key:"Time (minutes)",value:"time"},{key:"Distance (meters)",value:"distance"}],value:"time"}},value:"time"},{visible:!0,name:"range",type:"varchar",i18n_label:"openrouteservice.isochrones.label.range",label:"",info:"[MIN: 1 - MAX: 60]",editable:!0,validate:{required:!0,valid:!1,message:null},pk:!1,default:"",input:{type:"text",options:{min:1}},value:"1"},{visible:!0,name:"interval",type:"float",i18n_label:"openrouteservice.isochrones.label.interval",label:"",editable:!1,validate:{},pk:!1,default:"",input:{type:"slider",options:{min:0,max:0,step:1}},value:0},{visible:!0,name:"stroke_width",type:"float",i18n_label:"openrouteservice.isochrones.label.stroke_width",label:"",editable:!0,step:.01,validate:{required:!0,valid:!1},pk:!1,default:"",input:{type:"float",options:{min:0}},value:.26},{visible:!0,name:"color",type:"varchar",i18n_label:"openrouteservice.isochrones.label.color",label:"Color",editable:!0,validate:{},pk:!1,default:"",input:{type:"color",options:{}},value:"#FF0000"},{visible:!0,name:"transparency",type:"float",i18n_label:"openrouteservice.isochrones.label.transparency",label:"",editable:!0,validate:{required:!0,valid:!1},pk:!1,default:"",input:{type:"slider",options:{min:0,max:1,step:.1}},value:.8}],inputs:{mapcoordinates:[{visible:!0,name:"locations",type:"float",i18n_labels:{lon:"openrouteservice.inputs.label.mapcoordinates.lon",lat:"openrouteservice.inputs.label.mapcoordinates.lat"},labels:{lon:"",lat:""},epsg:"EPSG:4326",dropdownParent:!1,nullOption:!1,editable:!0,validate:{required:!0,valid:!0},pk:!1,default:"",input:{type:"lonlat",options:{}},values:{lon:0,lat:0},value:[[0,0]]}],from_layer:[{visible:!0,name:"from_layer",type:"varchar",i18n_label:"openrouteservice.inputs.label.from_layer",label:"Layer",dropdownParent:!1,nullOption:!1,editable:!0,validate:{required:!0,valid:!0},pk:!1,default:"",input:{type:"select",options:{values:[],value:null}},value:null}]},outputs:{newlayer:[{visible:!0,name:"new_layer_name",type:"varchar",i18n_label:"openrouteservice.outputs.label.new_layer_name",label:"",editable:!0,validate:{required:!0,valid:!1},pk:!1,default:"",input:{type:"text",options:{}},value:null},{visible:!0,name:"connection_id",type:"varchar",i18n_label:"openrouteservice.outputs.label.connection_id",label:"",dropdownParent:!1,nullOption:!1,editable:!0,validate:{required:!0,valid:!0},pk:!1,default:"",input:{type:"select",options:{values:[{i18n_key:"openrouteservice.outputs.label.input.select.__shapefile__",key:"New Shapefile",value:"__shapefile__"},{i18n_key:"openrouteservice.outputs.label.input.select.__spatialite__",key:"New Spatialite",value:"__spatialite__"},{i18n_key:"openrouteservice.outputs.label.input.select.__geopackage__",key:"New Geopackage",value:"__geopackage__"}]}},value:"__shapefile_"}],existinglayer:[{visible:!0,name:"qgis_layer_id",type:"varchar",label:"Existing Layer",dropdownParent:!1,nullOption:!1,editable:!0,validate:{required:!0,valid:!0},pk:!1,default:"",input:{type:"select",options:{values:[]}},value:null}]}}}},{}],5:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={isochrones:{title:"TRAVEL TIME (ISOCHRONE)",label:{name:"Name",profile:"Profile",range_type:"Mode",range:"Range",interval:"Interval",stroke_width:"Pen width",color:"Color",transparency:"Transparency",mapcoordinates:"Map Coordinates (EPSG:4326)",pointlayer:"Existing Layer Point",input:{select:{time:"Time (minutes)",distance:"Distance (meters)"}}}},inputs:{label:{mapcoordinates:{lon:"Longitude",lat:"Latitude"},from_layer:"Layer"}},outputs:{newlayer:"New Layer",existinglayer:"Existing Layer",label:{new_layer_name:"Layer name",connection_id:"Datasource",input:{select:{__shapefile__:"New Shapefile",__spatialite__:"New Spatialite",__geopackage__:"New Geopackage"}},existinglayer:{qgis_layer_id:"Existing Layer"}}},run:"Run"}},{}],6:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={isochrones:{title:"TRAVEL TIME (ISOCHRONE)",label:{name:"Name",profile:"Profile",range_type:"Mode",range:"Range",interval:"Interval",stroke_width:"Pen width",color:"Color",transparency:"Transparency",mapcoordinates:"Map Coordinates (EPSG:4326)",pointlayer:"Existing Layer Point",input:{select:{time:"Time (minutes)",distance:"Distance (meters)"}}}},inputs:{label:{mapcoordinates:{lon:"Longitude",lat:"Latitude"},from_layer:"Layer"}},outputs:{newlayer:"New Layer",existinglayer:"Existing Layer",label:{new_layer_name:"Layer name",connection_id:"Datasource",input:{select:{__shapefile__:"New Shapefile",__spatialite__:"New Spatialite",__geopackage__:"New Geopackage"}},existinglayer:{qgis_layer_id:"Existing Layer"}}},run:"Run"}},{}],7:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={isochrones:{title:"TRAVEL TIME (ISOCHRONE)",label:{name:"Name",profile:"Profile",range_type:"Mode",range:"Range",interval:"Interval",stroke_width:"Pen width",color:"Color",transparency:"Transparency",mapcoordinates:"Map Coordinates (EPSG:4326)",pointlayer:"Existing Layer Point",input:{select:{time:"Time (minutes)",distance:"Distance (meters)"}}}},inputs:{label:{mapcoordinates:{lon:"Longitude",lat:"Latitude"},from_layer:"Layer"}},outputs:{newlayer:"New Layer",existinglayer:"Existing Layer",label:{new_layer_name:"Layer name",connection_id:"Datasource",input:{select:{__shapefile__:"New Shapefile",__spatialite__:"New Spatialite",__geopackage__:"New Geopackage"}},existinglayer:{qgis_layer_id:"Existing Layer"}}},run:"Run"}},{}],8:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={isochrones:{title:"TRAVEL TIME (ISOCHRONE)",label:{name:"Name",profile:"Profile",range_type:"Mode",range:"Range",interval:"Interval",stroke_width:"Pen width",color:"Color",transparency:"Transparency",mapcoordinates:"Map Coordinates (EPSG:4326)",pointlayer:"Existing Layer Point",input:{select:{time:"Time (minutes)",distance:"Distance (meters)"}}}},inputs:{label:{mapcoordinates:{lon:"Longitude",lat:"Latitude"},from_layer:"Layer"}},outputs:{newlayer:"New Layer",existinglayer:"Existing Layer",label:{new_layer_name:"Layer name",connection_id:"Datasource",input:{select:{__shapefile__:"New Shapefile",__spatialite__:"New Spatialite",__geopackage__:"New Geopackage"}},existinglayer:{qgis_layer_id:"Existing Layer"}}},run:"Run"}},{}],9:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var a=u(e("./it")),n=u(e("./en")),r=u(e("./fi")),o=u(e("./se")),s=u(e("./fr")),l=u(e("./de")),e=u(e("./ro"));function u(e){return e&&e.__esModule?e:{default:e}}i.default={it:a.default,en:n.default,fi:r.default,se:o.default,fr:s.default,de:l.default,ro:e.default}},{"./de":5,"./en":6,"./fi":7,"./fr":8,"./it":10,"./ro":11,"./se":12}],10:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={isochrones:{title:"TEMPO DI VIAGGIO (ISOCHRONE)",label:{name:"Nome",profile:"Profilo",range_type:"Modalit√†",range:"Range",interval:"Intervallo",stroke_width:"Larghezza Penna",color:"Colore",transparency:"Trasparenza",mapcoordinates:"Coordinate Mappa (EPSG:4326)",pointlayer:"Layer Puntuale Progetto",input:{select:{time:"Time (minutes)",distance:"Distance (meters)"}}}},inputs:{label:{mapcoordinates:{lon:"Longitudine",lat:"Latitudine"},from_layer:"Layer"}},outputs:{newlayer:"Nuovo Layer",existinglayer:"Layer Esistente",label:{new_layer_name:"Nome Layer",connection_id:"Datasource",input:{select:{__shapefile__:"Nuovo Shapefile",__spatialite__:"Nuovo Spatialite",__geopackage__:"Nuovo Geopackage"}},existinglayer:{qgis_layer_id:"Existing Layer"}}},run:"Esegui"}},{}],11:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={isochrones:{title:"TRAVEL TIME (ISOCHRONE)",label:{name:"Name",profile:"Profile",range_type:"Mode",range:"Range",interval:"Interval",stroke_width:"Pen width",color:"Color",transparency:"Transparency",mapcoordinates:"Map Coordinates (EPSG:4326)",pointlayer:"Existing Layer Point",input:{select:{time:"Time (minutes)",distance:"Distance (meters)"}}}},inputs:{label:{mapcoordinates:{lon:"Longitude",lat:"Latitude"},from_layer:"Layer"}},outputs:{newlayer:"New Layer",existinglayer:"Existing Layer",label:{new_layer_name:"Layer name",connection_id:"Datasource",input:{select:{__shapefile__:"New Shapefile",__spatialite__:"New Spatialite",__geopackage__:"New Geopackage"}},existinglayer:{qgis_layer_id:"Existing Layer"}}},run:"Run"}},{}],12:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={isochrones:{title:"TRAVEL TIME (ISOCHRONE)",label:{name:"Name",profile:"Profile",range_type:"Mode",range:"Range",interval:"Interval",stroke_width:"Pen width",color:"Color",transparency:"Transparency",mapcoordinates:"Map Coordinates (EPSG:4326)",pointlayer:"Existing Layer Point",input:{select:{time:"Time (minutes)",distance:"Distance (meters)"}}}},inputs:{label:{mapcoordinates:{lon:"Longitude",lat:"Latitude"},from_layer:"Layer"}},outputs:{newlayer:"New Layer",existinglayer:"Existing Layer",label:{new_layer_name:"Layer name",connection_id:"Datasource",input:{select:{__shapefile__:"New Shapefile",__spatialite__:"New Spatialite",__geopackage__:"New Geopackage"}},existinglayer:{qgis_layer_id:"Existing Layer"}}},run:"Run"}},{}],13:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.I18N=i.APP=void 0;var a=n(e("./i18n")),e=n(e("./app"));function n(e){return e&&e.__esModule?e:{default:e}}i.APP=e.default,i.I18N=a.default;i.default={i18n:a.default,app:e.default}},{"./app":4,"./i18n":9}],14:[function(e,t,i){var a=e("./config"),n=(a=a)&&a.__esModule?a:{default:a};function r(){var e=this;o(this,{name:"openrouteservice",i18n:n.default.i18n,service:l}),this.service.once("ready",function(){e.registerPlugin(e.config.gid)&&(e.setupGUI(),e.setReady(!0))}),this.service.init(this.config)}var a=g3wsdk.core.utils,o=a.base,a=a.inherit,s=g3wsdk.core.plugin.Plugin,l=e("./service");a(r,s),r.prototype.setupGUI=function(){var t=this;this.createSideBarComponent({},{id:this.name,title:"OPENROUTESERVICE",open:!1,collapsible:!1,iconConfig:{color:"purple",icon:"layers"},mobile:!0,events:{open:{when:"before",cb:function(e){return e&&t.service.openForm()}}},sidebarOptions:{position:1}})},r.prototype.unload=function(){this.service.clear()},new r},{"./config":13,"./service":15}],15:[function(e,t,i){var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,a=arguments[t];for(i in a)Object.prototype.hasOwnProperty.call(a,i)&&(e[i]=a[i])}return e},o=e("./config/index");function a(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,i){try{var a=s[e](i),n=a.value}catch(e){return void o(e)}if(!a.done)return Promise.resolve(n).then(function(e){t("next",e)},function(e){t("throw",e)});r(n)}("next")})}}var n=g3wsdk.core.utils,r=n.base,s=n.inherit,u=n.XHR,p=n.colorHEXToRGB,c=g3wsdk.core.ApplicationService,d=g3wsdk.core.catalog.CatalogLayersStoresRegistry,v=g3wsdk.core.task.TaskService,f=g3wsdk.core.project.ProjectsRegistry,n=g3wsdk.core.plugin.PluginService,_=g3wsdk.gui.GUI,y=e("./components/panel/panel");function m(){var t;r(this),this.urls=o.APP.api.urls,this.init=function(){var n=this,e=(this.config=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},this.config.gid.split(":")[1]),r=(this.initializeUrls(e),f.getCurrentProject());this.taskId=null,Object.keys(this.config).forEach(function(t){var i,a;"isochrones"===t?(i=o.APP.form[t][1],a=o.APP.form.outputs.existinglayer[0],n.config[t].compatible&&n.config[t].compatible.forEach(function(e){e.layer_id;var t=e.qgis_layer_id,e=r.state.layers.find(function(e){return e.id===t});e&&a.input.options.values.push({key:e.name,value:t})}),n.config[t].pointlayers&&n.config[t].pointlayers.forEach(function(e,t){var i=e.layer_id,e=e.qgis_layer_id,e={key:r.getLayerById(e).getName(),value:i};o.APP.form.inputs.from_layer[0].input.options.values.push(e),0===t&&(o.APP.form.inputs.from_layer[0].value=e.value)}),Object.keys(n.config[t].profiles).forEach(function(e){i.value=null===i.value?e:i.value,i.input.options.values.push({key:n.config[t].profiles[e].name,value:e})})):"connections"===t&&(n.config[t]||[]).reverse().forEach(function(e){o.APP.form.outputs.newlayer[1].input.options.values.unshift({key:e.name,value:e.id}),o.APP.form.outputs.newlayer[1].value=e.id})}),this.state={loading:!1,form:null,task:{progress:null}},this.emit("ready")},this.createInitStateForm=function(){var e=JSON.parse(JSON.stringify(o.APP.form));this.state.form=e},this.initializeUrls=function(t){var i=this;Object.keys(this.urls).forEach(function(e){i.urls[e]=i.urls[e]+"/"+t+"/"})},this.openForm=function(){this.createInitStateForm(),this.openFormPanel=new y({service:this}),_.closeContent(),this.openFormPanel.show()},this.afterRun=function(e){e?(e=d.getLayerById(e))&&e.change():c.reloadCurrentProject()},this.run=(t=a(function*(t){var n=this,e=t.api,t=(t.output,t.inputs),t=void 0===t?[]:t,r=(this.state.loading=!0,{qgis_layer_id:null,connection_id:null,new_layer_name:null,profile:null,color:null,transparency:0,name:"",stroke_width:.26,ors:{locations:null,range_type:"time",range:[480],interval:60,location_type:"start",attributes:["area","reachfactor","total_pop"]}}),i=this.urls["isochrone_"+e];t.forEach(function(e){var t=e.name,e=e.value;"range"===t?e=e.split(",").map(function(e){return("time"===r.ors.range_type?60:1)*e}):"interval"===t?e=1<r.ors.range.length?null:+e:"color"===t?e=p(e):"from_layer"===t&&(i=""+i+e),void 0!==r[t]?r[t]=e:void 0!==r.ors[t]&&(r.ors[t]=e)});try{var a,o,s={data:JSON.stringify(r),contentType:"application/json"};"from_layer"!==e?((a=yield u.post(l({url:i},s))).result?this.afterRun(r.qgis_layer_id):_.showUserMessage({type:"alert",message:a.error,textMessage:!0}),this.state.loading=!1):(o=void 0,yield v.runTask({url:i,taskUrl:this.urls.task,params:s,method:"POST",listener:function(e){var t=e.task_id,e=(e.timeout,e.response),i=(e.result,e.progress),a=(e.task_result,e.status);"complete"===a?(n.afterRun(r.qgis_layer_id),v.stopTask({task_id:t}),n.state.loading=!1,n.state.task.progress=null,o=null):"executing"===a?(null===n.state.task.progress||void 0===n.state.task.progress||i>n.state.task.progress?o=Date.now():6e5<Date.now()-o&&(n.state.loading=!1,n.state.task.progress=null,v.stopTask({task_id:t}),_.showUserMessage({type:"warning",message:"Timeout",autoclose:!0}),o=null),n.state.task.progress=i):"500"==a&&(a=(i=e.responseJSON||{}).status,e=i.exception,i="error"===a,n.state.loading=!1,n.state.task.progress=null,o=null,v.stopTask({task_id:t}),_.showUserMessage({type:"alert",message:i?e:"server_error",textMessage:i}))}}))}catch(e){this.state.loading=!1;t=e.responseJSON?e.responseJSON.error:"server_error";_.showUserMessage({type:"alert",message:t,textMessage:!0})}}),function(e){return t.apply(this,arguments)}),this.clear=function(){this.openFormPanel=null}}s(m,n),t.exports=new m},{"./components/panel/panel":2,"./config/index":13}]},{},[14]);
//# sourceMappingURL=../g3w-client/src/plugins/openrouteservice/plugin.js.map
