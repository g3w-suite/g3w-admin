/**
 * @file
 * @author    Walter Lorenzetti <lorenzetti@gis3w.it>
 * @copyright 2016-02-18, Gis3w
 * @license   MPL 2.0
 */
/**
 * @file
 * @author    Walter Lorenzetti <lorenzetti@gis3w.it>
 * @copyright 2016-02-18, Gis3w
 * @license   MPL 2.0
 */
var $m;window.g3wadmin={},_.extend(g3wadmin,{tpl:{},widget:{},ui:{},forms:{},utils:{},currentModal:null,currentForm:null,bootstrap:function(){const t=this;this.ui.initCrudDetailWidget(),this.ui.initCrudDeleteWidget(),this.ui.initActiveDeactiveWidget(),$.each($('[data-widget-type="htmlItem"]'),(function(){t.widget.loadHtmlItem($(this))})),$('[data-widget-type="addProjectGroup"]').click((function(e){t.widget.addProjectGroup($(this))})),this.widget.ajaxUpload($('[data-widget-type="ajaxUpload"]')),$(".wys5").summernote({disableDragAndDrop:!0,lang:"it"===CURRENT_LANGUAGE_CODE?"it-IT":void 0,toolbar:[["magic",["style"]],["font",["bold","underline","italic","clear"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol","paragraph"]],["table",["table"]],["insert",["link"]],["view",["fullscreen","codeview","undo","redo","help"]]]}),this.ui.initRadioCheckbox(),this.ui.initBootstrapDatepicker(),this.ui.initBootstrapTimepicker(),this.ui.initBootstrapColorpicker(),this.ui.initSelect2(),this.ui.initLanguageSelect(),this.ui.initBackHistory(),this.ui.initAjaxFormWidget(),this.ui.initAjaxFilerWidget(),this.ui.initAjaxDownload(),this.ui.initPushMenu(),this.ui.showMessageOnLoad(),this.ui.initSetProjectPanoramicWidget(),this.ui.initMapSetExtent(),this.ui.initDataTable(),this.ui.closeMessages(),this.ui.initShowWEBServicesWidget()}}),window.ga=g3wadmin,
/**
 * @file
 * @author    Walter Lorenzetti <lorenzetti@gis3w.it>
 * @copyright 2016-02-18, Gis3w
 * @license   MPL 2.0
 */
_.extend(g3wadmin.tpl,{tplDefValues:{dialog:{modalTitle:gettext("Title"),modalBody:gettext("Content"),modalClass:"",modalSize:"",closeButton:!0,closeX:!0,closeButtonText:gettext("Close"),confirmButton:!0,confirmButtonText:"Ok"},ajaxError:{textStatus:"500",errorMessage:"",moreInfo:null},pageAlert:{status:"success",title:"OK",body:""}},dialog:_.template('    <div class="modal fade" tabindex="-1" role="dialog">        <div class="modal-dialog <%= modalClass %> <%= modalSize %>">        <div class="modal-content">          <div class="modal-header">            <% if(closeX) { %>            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>            <% } %>            <h4 class="modal-title"><%= modalTitle %></h4>          </div>          <div class="modal-body">            <%= modalBody %>          </div>          <div class="modal-footer">            <% if(closeButton) { %>            <button type="button" class="modal-button-close btn btn-default" data-dismiss="modal"><i class="fa fa-close"></i> <%= closeButtonText %></button>            <% } %>            <% if(confirmButton) { %>            <button type="button" class="modal-button-confirm btn btn-success"><i class="fa fa-check"></i> <%= confirmButtonText %></button>            <% } %>          </div>        </div>      </div>    </div>'),ajaxError:_.template("    <h3><%= textStatus %></h3>    <p><%= errorMessage %></p>    <% if(moreInfo) { %>        <p><%= moreInfo %></p>    <% } %>"),ajaxFormFieldError:_.template('    <span id="<%= errorId %>" class="help-block"><strong><%= errorMessage %></strong></span>    '),ajaxFiler:_.template('    <form action="<%= actionUrl %>" method="post" enctype="multipart/form-data">        <%= plusFormInputs %>        <input type="file" name="files[]" id="filer_input" multiple="multiple">    </form>    '),ajaxFiler_changeInput:_.template('    <div class="jFiler-input-dragDrop"><div class="jFiler-input-inner"><div class="jFiler-input-icon"><i class="icon-jfi-cloud-up-o"></i></div><div class="jFiler-input-text"><h3><%= drag_drop_message %></h3> <span style="display:inline-block; margin: 15px 0">or</span></div><a class="jFiler-input-choose-btn blue"><%= browse_button %></a></div></div>    '),ajaxFiler_box:_.template('    <ul class="jFiler-items-list jFiler-items-grid"></ul>    '),ajaxFiler_item:_.template('    <li class="jFiler-item">        <div class="jFiler-item-container">            <div class="jFiler-item-inner">                <div class="jFiler-item-thumb">                    <div class="jFiler-item-status"></div>                    <div class="jFiler-item-info">                        <span class="jFiler-item-title"><b title="{{fi-name}}">{{fi-name | limitTo: 25}}</b></span>                        <span class="jFiler-item-others">{{fi-size2}}</span>                    </div>                    {{fi-image}}                </div>                <div class="jFiler-item-assets jFiler-row">                    <ul class="list-inline pull-left">                        <li>{{fi-progressBar}}</li>                    </ul>                    <ul class="list-inline pull-right">                        <li><a class="icon-jfi-trash jFiler-item-trash-action"></a></li>                    </ul>                </div>            </div>        </div>    </li>    '),ajaxFiler_itemAppend:_.template('    <li class="jFiler-item">        <div class="jFiler-item-container">            <div class="jFiler-item-inner">                <div class="jFiler-item-thumb">                    <div class="jFiler-item-status"></div>                    <div class="jFiler-item-info">                        <span class="jFiler-item-title"><b title="{{fi-name}}">{{fi-name | limitTo: 25}}</b></span>                        <span class="jFiler-item-others">{{fi-size2}}</span>                    </div>                    {{fi-image}}                </div>                <div class="jFiler-item-assets jFiler-row">                    <ul class="list-inline pull-left">                        <li><span class="jFiler-item-others">{{fi-icon}}</span></li>                    </ul>                    <ul class="list-inline pull-right">                        <li><a class="icon-jfi-trash jFiler-item-trash-action"></a></li>                    </ul>                </div>            </div>        </div>    </li>    '),loading_box:_.template('        <div class="overlay">            <i class="fa fa-refresh fa-spin"></i>        </div>        '),ajaxFiler_progresBar:_.template('    <div class="bar"></div>    '),ajaxFiler_successMsg:_.template('    <div class="jFiler-item-others text-success"><i class="icon-jfi-check-circle"></i> Success</div>    '),ajaxFiler_errorMsg:_.template('    <div class="jFiler-item-others text-error"><i class="icon-jfi-minus-circle"></i> Error</div>    '),mapContainer:_.template('    <div id="modalMap" class="modalMap"></div>    '),pageAlert:_.template('    <div class="alert alert-<%= status %> alert-dismissable">        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">Ã—</button>        <h4><i class="icon fa fa-check"></i> <%= title %>!</h4>        <p class="body-alert"><%= body %></p>    </div>    ')}),
/**
 * @file
 * @author    Walter Lorenzetti <lorenzetti@gis3w.it>
 * @copyright 2016-02-18, Gis3w
 * @license   MPL 2.0
 */
_.extend(g3wadmin.ui,{before_datatable_callbacks:[],modal:function($modal,options){this.$modal=$modal,this.options=options,this.data=new Object,this.$modal.on("hidden.bs.modal",(function(t){$(this).remove()})),this.options.onModalShow&&this.$modal.on("shown.bs.modal",eval(this.options.onModalShow)),this.show=function(){this.$modal.modal({show:!0,backdrop:!(_.isObject(this.options)&&!_.isUndefined(this.options.backdrop))||this.options.backdrop})},this.hide=function(){this.$modal.modal("hide")},this.setBody=function(t){this.$modal.find(".modal-body").html(t)},this.setTitle=function(t){this.$modal.find(".modal-title").html(t)},this.setConfirmButtonAction=function(t){this.$modal.find(".modal-button-confirm").click(t)},this.setCloseButtonAction=function(t){this.$modal.find(".modal-button-close").click(t)},this.toggleStateButton=function(t){this.$modal.find(".modal-button-"+t).prop("disabled",((t,e)=>!e))}},buildDefaultModal:function(t){return this._buildModal(t,"")},buildDangerModal:function(t){return this._buildModal(t,"modal-danger")},buildWarningModal:function(t){return this._buildModal(t,"modal-warning")},pageAlert:function(t){this.$pageAlert=t,this.setBody=function(t){this.$pageAlert.find(".body-alert").html(t)},this.show=function(t){t.after(this.$pageAlert)}},buildPageAlert:function(t){return _.isObject(t)||(t={}),new this.pageAlert($(ga.tpl.pageAlert(_.extendOwn(_.clone(ga.tpl.tplDefValues.pageAlert),t))))},mapModal:function(t){_.isObject(t)||(t={}),_.extend(t,{modalBody:ga.tpl.mapContainer()});var e=this._buildModal(t);return e.map={},e.$modal.on("shown.bs.modal",(function(i){if(e.map=L.map($(this).find("#modalMap")[0],{center:[0,0],zoom:1}),L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png?{foo}",{foo:"bar"}).addTo(e.map),e.drawnItems=new L.FeatureGroup,_.has(t,"bboxLayer")&&!_.isNull(t.bboxLayer)){var a=t.bboxLayer.split(","),o=[[a[1],a[0]],[a[3],a[2]]];e.drawnLayer=L.rectangle(o),e.drawnLayer.editing.enable(),e.drawnItems.addLayer(e.drawnLayer),e.map.fitBounds(o)}else e.drawnLayer={};e.map.addLayer(e.drawnItems);var n=new L.Control.Draw({draw:{polyline:!1,polygon:!1,circle:!1,marker:!1},edit:{featureGroup:e.drawnItems,edit:!1,remove:!1}});e.map.addControl(n),e.map.on("draw:drawstart",(function(t){e.drawnItems.clearLayers()})),e.map.on("draw:created",(function(t){t.layerType;e.drawnLayer=t.layer,e.drawnLayer.editing.enable(),e.drawnItems.addLayer(e.drawnLayer)}))})),e},initActiveDeactiveWidget:function(){this.__onClick('[data-widget-type="activeDeactiveItem"]',(function(t){ga.widget.activeDeactiveItem($(this))}))},initCrudDeleteWidget:function(){this.__onClick('[data-widget-type="deleteItem"]',(function(t){ga.widget.deleteItem($(this))}))},initCrudDetailWidget:function(){this.__onClick('[data-widget-type="detailItem"]',(function(t){ga.widget.showDetailItem($(this))}))},initSetProjectPanoramicWidget:function(){$(document).on("ifClicked",'[data-widget-type="setProjectPanoramic"]',(function(t){ga.widget.setProjectPanoramic($(this),t)}))},initLinkWidget2Layer:function(){$(document).on("ifChecked",'[data-widget-type="linkWidget2Layer"]',(function(t){ga.widget.linkWidget2Layer($(this))})).on("ifUnchecked",'[data-widget-type="linkWidget2Layer"]',(function(t){ga.widget.linkWidget2Layer($(this),!1)}))},initRadioCheckbox:function(t){_.each(this.__$widgetItem(t,'input[type="checkbox"], input[type="radio"]'),(function(t){const e=$(t).attr("data-icheck-skin")||"green";$(t).iCheck({checkboxClass:"icheckbox_flat-"+e,radioClass:"iradio_flat-"+e})}))},initBootstrapDatepicker:function(t){$.fn.datepicker.dates.en.format="yyyy-mm-dd",$.fn.datepicker.dates.ro.format="dd.mm.yyyy",$.fn.datepicker.dates.se=$.fn.datepicker.dates.sv,this.__$widgetItem(t,".datepicker").datepicker({language:CURRENT_LANGUAGE_CODE})},initBootstrapTimepicker:function(t){this.__$widgetItem(t,".timepicker").timepicker({showMeridian:!1,showInputs:!0})},initBootstrapColorpicker:function(t){this.__$widgetItem(t,".colorpicker").parent().addClass("colorpicker-component").colorpicker()},initSelect2:function(t){this.__$widgetItem(t,".select2").select2()},initBackHistory:function(){$('[data-widget-type="backHistory"]').click((function(){return parent.history.back(),!1}))},initLanguageSelect:function(){function t(t){if(!t.id)return t.text;const e=$('<span><img class="img-flag" /> <span></span></span>');return e.find("span").text(t.text),e.find("img").attr("src",STATIC_BASE_URL+"/img/flags/"+t.element.value.toLowerCase()+".png"),e}$("#language-select").select2({templateResult:t,templateSelection:t})},initAjaxFormWidget:function(){this.__onClick('[data-widget-type="ajaxForm"]',(function(t){ga.widget.ajaxForm($(this))}))},initAjaxFilerWidget:function(){this.__onClick('[data-widget-type="ajaxFiler"]',(function(t){t.preventDefault(),$(this).hasClass("disabled")||ga.widget.ajaxFiler($(this))}))},initAjaxDownload:function(){this.__onClick('[data-widget-type="ajaxDownload"]',(function(t){ga.widget.ajaxDownload($(this))}))},initMapSetExtent:function(){this.__onClick('[data-widget-type="mapSetExtent"]',(function(t){ga.widget.mapSetExtent($(this))}))},showMessageOnLoad:function(t){const e=this.__$widgetItem(t,'[data-widget-type="showMessageOnLoad"]');e.length>0&&ga.widget.showMessageOnLoad(e)},initPushMenu:function(){$("body").on("collapsed.pushMenu",(function(t){$.cookie("g3wadmin_sidebar_status","collapsed",{path:"/"})})).on("expanded.pushMenu",(function(t){$.cookie("g3wadmin_sidebar_status","expanded",{path:"/"})}))},initDataTable:function(t,e){_.isObject(t)&&(e=t,t=void 0);const i=this.__$widgetItem(t,'[data-widget-type="dataTable"]');i.find('[data-widget-type="detailItemDataTable"]').on("click",(function(t){ga.widget.showDetailItemDataTable(a,$(this))})),_.each(ga.ui.before_datatable_callbacks,(function(t){t(i)}));const a=i.DataTable(e)},initNotShowAtrrtibutesTableCheckBox:function(){this.__bindCheckboxAttr('[data-widget-type="noShowAttributesTable"]',"not_show_attributes_table")},initNolegendLayerCheckBox:function(){this.__bindCheckboxAttr('[data-widget-type="noLegendLayer"]',"exclude_from_legend")},initDownloadLayerCheckBox:function(){this.__bindCheckboxAttr('[data-widget-type="downloadLayer"]',"download_layer")},initDownloadLayerXlsCheckBox:function(){this.__bindCheckboxAttr('[data-widget-type="downloadLayerxls"]',"download_layer_xls")},initDownloadLayerGpxCheckBox:function(){this.__bindCheckboxAttr('[data-widget-type="downloadLayergpx"]',"download_layer_gpx")},initDownloadLayerGpkgCheckBox:function(){this.__bindCheckboxAttr('[data-widget-type="downloadLayergpkg"]',"download_layer_gpkg")},initDownloadLayerCsvCheckBox:function(){this.__bindCheckboxAttr('[data-widget-type="downloadLayercsv"]',"download_layer_csv")},initExternalLayerCheckBox:function(){this.__bindCheckboxAttr('[data-widget-type="externalLayer"]',"external")},closeMessages:function(){$("#page_user_messages").find(".alert").delay(4e3).slideUp(500)},initShowWEBServicesWidget:function(){this.__onClick('[data-widget-type="showWEBServices"]',(function(t){ga.widget.showWEBServices($(this))}))},_buildModal:function(t,e=""){return _.isObject(t)||(t={}),t.modalClass=t.modalClass||e,new this.modal($(ga.tpl.dialog(_.extendOwn(_.clone(ga.tpl.tplDefValues.dialog),t))),t)},__$widgetItem:function(t,e){return _.isUndefined(t)?$(e):$(t).find(e)},__bindCheckboxAttr:function(t,e){return $(document).on("ifChanged",t,(function(t){ga.widget.setLayerData($(this),{[e]:t.target.checked?1:0})}))},__bindiCheckAttr:function(t,e){$(document).on("ifChanged",t,(function(t){$(e).iCheck(t.target.checked?"check":"uncheck")}))},__onClick:function(t,e){return $(document).on("click",t,e)}}),
/**
 * @file
 * @author    Walter Lorenzetti <lorenzetti@gis3w.it>
 * @copyright 2016-02-18, Gis3w
 * @license   MPL 2.0
 */
_.extend(g3wadmin.widget,{_deleteItemParams:["delete-url","item-selector","modal-title","delete-method"],_activeDeactiveItemParams:["active-deactive-url","item-selector","modal-title","active-deactive-method","active-deactive-action"],_detailItemParams:["detail-url","modal-title","modal-size"],_showWEBServicesParams:["api-url","modal-title","modal-size"],_detailItemDataTableParams:["detail-url"],_loadHtmlItemParams:["html-url","target-selector"],_ajaxFormParams:["form-url","modal-title","modal-size"],_ajaxUploadParams:["validation-data-item-selector"],_ajaxFilerParams:["action-url","modal-title","file-extensions","on-modal-show","item-plus-form"],_setProjectPanoramic:["ajax-url"],_linkWidget2Layer:["ajax-url"],_setLayerCached:["ajax-url"],_setLayerData:["ajax-url"],_setAjaxDownload:["ajax-url"],_mapSetExtent:["crs"],deleteItem:function(t){try{const e=ga.utils.getDataAttrs(t,this._deleteItemParams);if(_.isUndefined(e["delete-url"]))throw new Error("Attribute data-delete-url not defined");const i=t.parent().find(".pre-delete-message").html(),a=ga.ui.buildDefaultModal({modalTitle:gettext("Delete item"),modalBody:gettext("Are you sure to delete this Item")+"?"+(_.isUndefined(i)?"":i),closeButtonText:"No"});a.setConfirmButtonAction((function(){const t={};ga.utils.addCsfrtokenData(t),$.ajax({method:_.isUndefined(e["delete-method"])?"post":e["delete-method"],url:e["delete-url"],data:t,success:function(t){$(e["item-selector"]).toggle(300,(function(){$(this).remove()})),a.hide()},error:function(t,e,i){ga.widget.showError(ga.utils.buildAjaxErrorMessage(t.status,i))}})})),a.show()}catch(t){this.showError(t.message)}},activeDeactiveItem:function(t){try{const e=ga.utils.getDataAttrs(t,this._activeDeactiveItemParams);if(_.isUndefined(e["active-deactive-url"]))throw new Error("Attribute data-active-deactive-url not defined");const i=_.isUndefined(e["active-deactive-action"])?"activate":e["active-deactive-action"],a=t.parent().find(".pre-active-deactive-message").html(),o=ga.ui.buildDefaultModal({modalTitle:gettext(i.charAt(0).toUpperCase()+i.slice(1)+" item"),modalBody:gettext("Are you sure to "+i+" this Item")+"?"+(_.isUndefined(a)?"":a),closeButtonText:"No"});o.setConfirmButtonAction((function(){const t={};ga.utils.addCsfrtokenData(t),$.ajax({method:_.isUndefined(e["active-deactive-method"])?"post":e["active-decative-method"],url:e["active-deactive-url"],data:t,success:function(t){const i=$(e["item-selector"]),a=i.parents('[data-widget-type="htmlItem"]');i.toggle(300,(function(){$(this).remove()})),o.hide(),$.each(a,(function(){g3wadmin.widget.loadHtmlItem($(this))}))},error:function(t,e,i){ga.widget.showError(ga.utils.buildAjaxErrorMessage(t.status,i))}})})),o.show()}catch(t){this.showError(t.message)}},showDetailItem:function(t){try{const e=ga.utils.getDataAttrs(t,this._detailItemParams);if(_.isUndefined(e["detail-url"]))throw new Error("Attribute data-detail-url not defined");$.ajax({method:"get",url:e["detail-url"],success:function(t){ga.ui.buildDefaultModal({modalTitle:_.isUndefined(e["modal-title"])?gettext("Detail object"):e["modal-title"],modalSize:_.isUndefined(e["modal-size"])?"":e["modal-size"],modalBody:t,closeButtonText:gettext("Close"),confirmButton:!1}).show()},error:function(t,e,i){ga.widget.showError(ga.utils.buildAjaxErrorMessage(t.status,i))}})}catch(t){this.showError(t.message)}},showDetailItemDataTable:function(t,e,i){try{const a=ga.utils.getDataAttrs(e,this._detailItemParams);if(_.isUndefined(a["detail-url"]))throw new Error("Attribute data-detail-url not defined");i=!_.isUndefined(i);const o=e.closest("tr"),n=t.row(o),s=function(){$.ajax({method:"get",url:a["detail-url"],success:function(t){n.child(t).show()},complete:function(t,e){"success"===e&&ga.ui.initRadioCheckbox(n.child())},error:function(t,e,i){ga.widget.showError(ga.utils.buildAjaxErrorMessage(t.status,i))}})};if(i)return void s();n.child.isShown()?(o.removeClass("details"),n.child.hide()):(o.addClass("details"),s())}catch(t){this.showError(t.message)}},loadHtmlItem:function(t){try{const e=ga.utils.getDataAttrs(t,this._loadHtmlItemParams);if(_.isUndefined(e["html-url"]))throw new Error("Attribute data-html-url not defined");$.ajax({method:"get",url:e["html-url"],success:function(t){$(e["target-selector"]).html(t)},complete:function(t,i){"success"===i&&ga.ui.initRadioCheckbox(e["target-selector"])},error:function(t,e,i){ga.widget.showError(ga.utils.buildAjaxErrorMessage(t.status,i))}})}catch(t){this.showError(t.message)}},ajaxForm:function(t){try{const e=ga.utils.getDataAttrs(t,this._ajaxFormParams);if(_.isUndefined(e["form-url"]))throw new Error("Attribute data-form-url not defined");$.ajax({method:"get",url:e["form-url"],success:function(i){const a=ga.currentModal=ga.ui.buildDefaultModal({modalTitle:_.isUndefined(e["modal-title"])?gettext("Form title"):e["modal-title"],modalBody:i,modalSize:_.isUndefined(e["modal-size"])?"":e["modal-size"]});a.data.$evoker=t,a.show();const o=ga.currentForm=new ga.forms.form(a.$modal.find("form"));o.setAction(e["form-url"]),o.on("keypress",(function(t){13===t.keyCode&&t.preventDefault()})),o.setOnSuccesAction((function(){a.hide(),window.location.reload()})),a.setConfirmButtonAction(o.sendData),ga.ui.initRadioCheckbox(a.$modal),ga.ui.initBootstrapDatepicker(a.$modal),ga.ui.initBootstrapTimepicker(a.$modal),ga.ui.initSelect2(a.$modal)},error:function(t,e,i){ga.widget.showError(ga.utils.buildAjaxErrorMessage(t.status,i))}})}catch(t){this.showError(t.message)}},ajaxFiler:function(t){try{const i=ga.utils.getDataAttrs(t,this._ajaxFilerParams);if(_.isUndefined(i["action-url"]))throw new Error("Attribute data-action-url not defined");const a={actionUrl:i["action-url"],plusFormInputs:""};_.isUndefined(i["item-plus-form"])||(a.plusFormInputs='<div id="plus_filer_input">'+$("#"+i["item-plus-form"]).html()+"</div>");const o=ga.ui.buildDefaultModal({confirmButton:!1,closeX:!1,backdrop:"static",modalTitle:_.isUndefined(i["modal-title"])?gettext("Upload file"):i["modal-title"],modalBody:ga.tpl.ajaxFiler(a),onModalShow:!_.isUndefined(i["on-modal-show"])&&i["on-modal-show"]});var e=$(o.$modal.find("#filer_input"));o.setCloseButtonAction((function(t){o.hide();const e=$(o.$modal.find("#filer_input")).prop("jFiler");!_.isNull(e.current_file)&&e.current_file.uploaded&&window.location.reload()})),o.show();const n={};ga.utils.addCsfrtokenData(n);const s=_.isUndefined(i["file-extensions"])?null:i["file-extensions"].split("|");e.filer({changeInput:ga.tpl.ajaxFiler_changeInput({drag_drop_message:gettext("Drag&Drop files here"),browse_button:gettext("Browse Files")}),showThumbs:!0,limit:1,extensions:s,theme:"dragdropbox",captions:{button:"Choose Files",feedback:"Choose files To Upload",feedback2:"files were chosen",drop:"Drop file here to Upload",removeConfirmation:"Are you sure you want to remove this file?",errors:{filesLimit:"Only {{fi-limit}} files are allowed to be uploaded.",filesType:"Only Images are allowed to be uploaded.",filesSize:"{{fi-name}} is too large! Please upload file up to {{fi-fileMaxSize}} MB.",filesSizeAll:"Files you've choosed are too large! Please upload files up to {{fi-maxSize}} MB.",folderUpload:"You are not allowed to upload folders."}},dragDrop:{dragEnter:null,dragLeave:null,drop:null},templates:{box:ga.tpl.ajaxFiler_box(),item:ga.tpl.ajaxFiler_item(),itemAppend:ga.tpl.ajaxFiler_itemAppend(),progressBar:ga.tpl.ajaxFiler_progresBar(),itemAppendToEnd:!1,removeConfirmation:!0,_selectors:{list:".jFiler-items-list",item:".jFiler-item",progressBar:".bar",remove:".jFiler-item-trash-action"}},uploadFile:{url:i["action-url"],data:n,type:"post",enctype:"multipart/form-data",beforeSend:function(){if(!_.isUndefined(i["item-plus-form"])){const t=$("#plus_filer_input").find(":input").serializeArray();for(id in t)arguments[7].data.append(t[id].name,t[id].value);o.toggleStateButton("close")}},success:function(t,e){const a=e.find(".jFiler-jProgressBar").parent();e.find(".jFiler-jProgressBar").fadeOut("slow",(function(){$(ga.tpl.ajaxFiler_successMsg()).hide().appendTo(a).fadeIn("slow")})),e.after(t),_.isUndefined(i["item-plus-form"])||o.toggleStateButton("close")},error:function(t){const e=_.isUndefined(arguments[6].responseJSON)?arguments[6].responseText:arguments[6].responseJSON.errors,a=t.find(".jFiler-jProgressBar").parent();t.find(".jFiler-jProgressBar").fadeOut("slow",(function(){$(ga.tpl.ajaxFiler_errorMsg()).hide().appendTo(a).fadeIn("slow");const i=$('<div class="callout callout-danger"></div>');i.append($("<h4>"+gettext("ERROR")+"</h4>")),i.append($("<p></p>").html(e)),t.after(i)})),_.isUndefined(i["item-plus-form"])||o.toggleStateButton("close")}}})}catch(t){this.showError(t.message)}},addProjectGroup:function(t){try{const e=t.next(".add-links");if(0==e.length)throw new Error("No add add links choices set");ga.ui.buildDefaultModal({modalTitle:"Add a project",modalBody:e.html(),closeButtonText:"No"}).show()}catch(t){this.showError(t.message)}},ajaxUpload:function(t){if(0==t.length)return;ga.utils.getDataAttrs(t,this._ajaxUploadParams);const e={};"ajaxUploadValidation"in window&&(e.validation=window.ajaxUploadValidation),e.callbacks={onSuccess:function(t){var e=$("span:contains("+t.name+")").parents(".box-body").find(".img-thumbnail");e.attr("src",g3wadmin.settings.FILE_FORM_UPLOAD_TEMP_URL+t.id),e.is(":hidden")&&e.show()}},initUploadFields(t[0],e)},showError:function(t){$(".modal,.fade").remove(),ga.ui.buildDangerModal({modalTitle:"ERROR",modalBody:t,confirmButton:!1}).show()},setProjectPanoramic:function(t,e){try{const e=ga.utils.getDataAttrs(t,this._setProjectPanoramic);if(_.isUndefined(e["ajax-url"]))throw new Error("Attribute data-ajax-url not defined");let i=e["ajax-url"];if(t.prop("checked")){const e=i.split("/");e[e.length-2]="reset",i=e.join("/"),t.iCheck("uncheck")}$.ajax({method:"get",url:i,error:function(t,e,i){ga.widget.showError(ga.utils.buildAjaxErrorMessage(t.status,i))}})}catch(e){this.showError(e.message)}},linkWidget2Layer:function(t,e){try{const i=ga.utils.getDataAttrs(t,this._linkWidget2Layer);if(_.isUndefined(i["ajax-url"]))throw new Error("Attribute data-ajax-url not defined");const a={};_.isUndefined(e)||e||(a.unlink="unlink"),$.ajax({method:"get",url:i["ajax-url"],data:a,success:function(t){},error:function(t,e,i){ga.widget.showError(ga.utils.buildAjaxErrorMessage(t.status,i))}})}catch(t){this.showError(t.message)}},setLayerCached:function(t,e){try{const i=ga.utils.getDataAttrs(t,this._setLayerCached);if(_.isUndefined(i["ajax-url"]))throw new Error("Attribute data-ajax-url not defined");$.ajax({method:"get",url:i["ajax-url"]+(_.isUndefined(e)||e?"":NaN),error:function(t,e,i){ga.widget.showError(ga.utils.buildAjaxErrorMessage(t.status,i))}})}catch(t){this.showError(t.message)}},setLayerData:function(t,e){try{var i=ga.utils.getDataAttrs(t,this._setLayerData);if(_.isUndefined(i["ajax-url"]))throw new Error("Attribute data-ajax-url not defined");ga.utils.addCsfrtokenData(e),$.ajax({method:"post",data:e,url:i["ajax-url"],error:function(t,e,i){ga.widget.showError(ga.utils.buildAjaxErrorMessage(t.status,i))}})}catch(t){this.showError(t.message)}},ajaxDownload:function(t){try{const e=ga.utils.getDataAttrs(t,this._setAjaxDownload);if(_.isUndefined(e["ajax-url"]))throw new Error("Attribute data-ajax-url not defined");$.fileDownload(e["ajax-url"]).fail((function(){ga.widget.showError(ga.utils.buildAjaxErrorMessage(500,"File download Failed!"))}))}catch(t){this.showError(t.message)}},showMessageOnLoad:function(t){ga.ui.buildWarningModal({modalTitle:"Warnings!",modalBody:t.html(),closeButtonText:"Close",confirmButton:!1}).show()},mapSetExtent:function(t){try{const e=ga.utils.getDataAttrs(t,this._mapSetExtent);if(_.isUndefined(e.crs))throw new Error("Attribute data-crs not defined");const i=t.parents(".input-group").find("input"),a=i.val()?ga.utils.transformBBoxToWGS84(e.crs,i.val()):null,o=ga.ui.mapModal({bboxLayer:a});o.setConfirmButtonAction((function(t){const a=o.drawnLayer.getBounds();i.val(ga.utils.transformBBoxFromWGS84(e.crs,[a.getWest(),a.getSouth(),a.getEast(),a.getNorth()])),o.hide()})),o.show()}catch(t){this.showError(t.message)}},showWEBServices:function(t){try{const e=ga.utils.getDataAttrs(t,this._showWEBServicesParams);if(_.isUndefined(e["api-url"]))throw new Error("Attribute data-api-url not defined");$.ajax({method:"get",url:e["api-url"],success:function(t){const i=$("<div>");_.map(t.data,(function(t,e){if(i.append($("<h3>").html(e)),"TMS"===e){const e=$("<ul>");$.each(t,(function(){e.append($("<li><i>"+this.name+"</i>: "+this.url+"/{z}/{x}/{y}.png<br/>"+gettext("Access")+": free</li>"))})),i.append(e)}else{const e="free"===t.access?'<i class="fa fa-unlock-alt" style="color: green;"></i> '+t.access:'<i class="fa fa-lock" style="color: red;"></i> '+t.access,a=_.has(t,"alias")?'<br>ALIAS URL:<a href="'+t.alias+'" target="_blank">'+t.alias:"",o='URL:<a href="'+t.url+'" target="_blank">'+t.url+"</a>"+a+"<br>"+gettext("Access")+": "+e;i.append($("<p>").html(o))}}));ga.ui.buildDefaultModal({modalTitle:_.isUndefined(e["modal-title"])?gettext("WEB Services"):e["modal-title"],modalSize:_.isUndefined(e["modal-size"])?"":e["modal-size"],modalBody:i.html(),closeButtonText:gettext("Close"),confirmButton:!1}).show()},error:function(t,e,i){ga.widget.showError(ga.utils.buildAjaxErrorMessage(t.status,i))}})}catch(t){this.showError(t.message)}}}),
/**
 * @file
 * @author    Walter Lorenzetti <lorenzetti@gis3w.it>
 * @copyright 2016-02-18, Gis3w
 * @license   MPL 2.0
 */
_.extend(g3wadmin.utils,{getDataAttrs:function(t,e){const i={};return _.each(e,(function(t){i[t]=this.$item.attr("data-"+t)}),{$item:t,params:i}),i},buildAjaxErrorMessage:function(t,e,i){return ga.tpl.ajaxError(_.extendOwn(ga.tpl.tplDefValues.ajaxError,{textStatus:t,errorMessage:e,moreInfo:i}))},addCsfrtokenData:function(t){_.extend(t,{csrfmiddlewaretoken:$.cookie("csrftoken")})},transformBBoxToWGS84:function(t,e){return this.__transformWGS84BBox(t,e,"inverse")},transformBBoxFromWGS84:function(t,e){return this.__transformWGS84BBox(t,e,"forward")},setEditorWys5Content:function(t,e){(t instanceof jQuery?t:$(t)).data("wysihtml5").editor.setValue(e)},preventBackButtonBrowser:function(t){(_.isUndefined(t)||t)&&(window.location.hash="no-back-button",window.location.hash="Again-No-back-button",window.onhashchange=function(){window.location.hash="no-back-button"},$(window).on("beforeunload",(function(){return!1})))},__transformWGS84BBox(t,e,i){let a;if(_.isArray(e))a=e;else{a=e.split(",");for(let t=0;t<4;t++)a[t]=parseFloat(a[t])}const o=proj4(t)[i]([a[0],a[1]]),n=proj4(t)[i]([a[2],a[3]]);return[o[0],o[1],n[0],n[1]].join()}}),
/**
 * @file
 * @author    Walter Lorenzetti <lorenzetti@gis3w.it>
 * @copyright 2016-02-26, Gis3w
 * @license   MPL 2.0
 */
_.extend(g3wadmin.forms,{INSERT_STATE:0,UPDATE_STATE:1,checkItemsEmpty:function(t){$formElements=t.find(":input");$.each($formElements,(function(t,e){var i=$(e);console.log(i);var a=this.tagName.toLowerCase();switch(console.log(a),a){case"select":default:console.log(i.val());break;case"radio":case"checkbox":console.log(i.attr("checked"))}}))},checkBoxToOpen:function(t){this.checkItemsEmpty(t)},form:function(t){const e=this;this.$form=t,this.on=function(t,i){e.$form.on(t,i)},this.sendData=function(t,i,a,o){e.$form.trigger("preSendForm"),$.ajax({method:_.isUndefined(i)?"post":i,data:_.isUndefined(a)?e.getData():a,contentType:o||"application/x-www-form-urlencoded; charset=UTF-8",url:e.$form.attr("action"),success:function(t){"error"===t.status?e.showErrors(_.has(t,"errors_form")?t.errors_form:void 0):_.isUndefined(e.successAction)||e.successAction(t)},complete:function(t,i){e.$form.trigger("postSendForm")},error:function(t,i,a){_.isUndefined(e.errorAction)?ga.widget.showError(ga.utils.buildAjaxErrorMessage(t.status,a)):e.errorAction(t,a)}})},this.setOnSuccesAction=function(t){this.successAction=t},this.setOnErrorAction=function(t){this.errorAction=t},this.showErrors=function(t){this.$form.find(".has-error").removeClass("has-error"),this.$form.find("span.help-block").remove(),this.$form.find(".error-form-message").removeClass("hidden"),!_.isUndefined(t)&&_.isObject(t)&&_.mapObject(t,(function(t,i){const a=e.$form.find("#div_id_"+i),o=a.find(".controls");a.addClass("has-error"),_.map(t,(function(t){o.append(ga.tpl.ajaxFormFieldError({errorId:"error_id_"+i,errorMessage:t}))}))}))},this.setAction=function(t){this.$form.attr("action",t)},this.getData=function(t){if(_.isUndefined(t))return this.$form.serialize();var e=this.$form.serializeArray(),i={};for(const t in e)i[e[t].name]=e[t].value;return i}}}),$(document).ready((function(){ga.bootstrap()}));