var $m;window.g3wadmin={},_.extend(g3wadmin,{tpl:{},widget:{},ui:{},forms:{},utils:{},currentModal:null,currentForm:null,bootstrap:function(){var t=this;this.ui.initCrudDetailWidget(),this.ui.initCrudDeleteWidget();var e=$('[data-widget-type="htmlItem"]');$.each(e,function(){t.widget.loadHtmlItem($(this))}),$('[data-widget-type="addProjectGroup"]').click(function(e){t.widget.addProjectGroup($(this))}),t.widget.ajaxUpload($('[data-widget-type="ajaxUpload"]'));var a={height:240,toolbar:[["magic",["style"]],["font",["bold","underline","italic","clear"]],["fontsize",["fontsize"]],["color",["color"]],["para",["ul","ol","paragraph"]],["table",["table"]],["insert",["link"]],["view",["fullscreen","codeview","undo","redo","help"]]]};"it"==CURRENT_LANGUAGE_CODE&&(a.lang="it-IT"),$(".wys5").summernote(a),this.ui.initRadioCheckbox(),this.ui.initBootstrapDatepicker(),this.ui.initBootstrapTimepicker(),this.ui.initBootstrapColorpicker(),this.ui.initSelect2(),this.ui.initBackHistory(),this.ui.initAjaxFormWidget(),this.ui.initAjaxFilerWidget(),this.ui.initAjaxDownload(),this.ui.initPushMenu(),this.ui.showMessageOnLoad(),this.ui.initSetProjectPanoramicWidget(),this.ui.initMapSetExtent(),this.ui.initDataTable(),this.ui.closeMessages()}}),window.ga=g3wadmin,_.extend(g3wadmin.tpl,{tplDefValues:{dialog:{modalTitle:gettext("Title"),modalBody:gettext("Content"),modalClass:"",modalSize:"",closeButton:!0,closeX:!0,closeButtonText:gettext("Close"),confirmButton:!0,confirmButtonText:"Ok"},ajaxError:{textStatus:"500",errorMessage:"",moreInfo:null},pageAlert:{status:"success",title:"OK",body:""}},dialog:_.template('    <div class="modal fade" tabindex="-1" role="dialog">        <div class="modal-dialog <%= modalClass %> <%= modalSize %>">        <div class="modal-content">          <div class="modal-header">            <% if(closeX) { %>            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>            <% } %>            <h4 class="modal-title"><%= modalTitle %></h4>          </div>          <div class="modal-body">            <%= modalBody %>          </div>          <div class="modal-footer">            <% if(closeButton) { %>            <button type="button" class="modal-button-close btn btn-default" data-dismiss="modal"><i class="fa fa-close"></i> <%= closeButtonText %></button>            <% } %>            <% if(confirmButton) { %>            <button type="button" class="modal-button-confirm btn btn-success"><i class="fa fa-check"></i> <%= confirmButtonText %></button>            <% } %>          </div>        </div>      </div>    </div>'),ajaxError:_.template("    <h3><%= textStatus %></h3>    <p><%= errorMessage %></p>    <% if(moreInfo) { %>        <p><%= moreInfo %></p>    <% } %>"),ajaxFormFieldError:_.template('    <span id="<%= errorId %>" class="help-block"><strong><%= errorMessage %></strong></span>    '),ajaxFiler:_.template('    <form action="<%= actionUrl %>" method="post" enctype="multipart/form-data">        <%= plusFormInputs %>        <input type="file" name="files[]" id="filer_input" multiple="multiple">    </form>    '),ajaxFiler_changeInput:_.template('    <div class="jFiler-input-dragDrop"><div class="jFiler-input-inner"><div class="jFiler-input-icon"><i class="icon-jfi-cloud-up-o"></i></div><div class="jFiler-input-text"><h3><%= drag_drop_message %></h3> <span style="display:inline-block; margin: 15px 0">or</span></div><a class="jFiler-input-choose-btn blue"><%= browse_button %></a></div></div>    '),ajaxFiler_box:_.template('    <ul class="jFiler-items-list jFiler-items-grid"></ul>    '),ajaxFiler_item:_.template('    <li class="jFiler-item">        <div class="jFiler-item-container">            <div class="jFiler-item-inner">                <div class="jFiler-item-thumb">                    <div class="jFiler-item-status"></div>                    <div class="jFiler-item-info">                        <span class="jFiler-item-title"><b title="{{fi-name}}">{{fi-name | limitTo: 25}}</b></span>                        <span class="jFiler-item-others">{{fi-size2}}</span>                    </div>                    {{fi-image}}                </div>                <div class="jFiler-item-assets jFiler-row">                    <ul class="list-inline pull-left">                        <li>{{fi-progressBar}}</li>                    </ul>                    <ul class="list-inline pull-right">                        <li><a class="icon-jfi-trash jFiler-item-trash-action"></a></li>                    </ul>                </div>            </div>        </div>    </li>    '),ajaxFiler_itemAppend:_.template('    <li class="jFiler-item">        <div class="jFiler-item-container">            <div class="jFiler-item-inner">                <div class="jFiler-item-thumb">                    <div class="jFiler-item-status"></div>                    <div class="jFiler-item-info">                        <span class="jFiler-item-title"><b title="{{fi-name}}">{{fi-name | limitTo: 25}}</b></span>                        <span class="jFiler-item-others">{{fi-size2}}</span>                    </div>                    {{fi-image}}                </div>                <div class="jFiler-item-assets jFiler-row">                    <ul class="list-inline pull-left">                        <li><span class="jFiler-item-others">{{fi-icon}}</span></li>                    </ul>                    <ul class="list-inline pull-right">                        <li><a class="icon-jfi-trash jFiler-item-trash-action"></a></li>                    </ul>                </div>            </div>        </div>    </li>    '),loading_box:_.template('        <div class="overlay">            <i class="fa fa-refresh fa-spin"></i>        </div>        '),ajaxFiler_progresBar:_.template('    <div class="bar"></div>    '),ajaxFiler_successMsg:_.template('    <div class="jFiler-item-others text-success"><i class="icon-jfi-check-circle"></i> Success</div>    '),ajaxFiler_errorMsg:_.template('    <div class="jFiler-item-others text-error"><i class="icon-jfi-minus-circle"></i> Error</div>    '),mapContainer:_.template('    <div id="modalMap" class="modalMap"></div>    '),pageAlert:_.template('    <div class="alert alert-<%= status %> alert-dismissable">        <button type="button" class="close" data-dismiss="alert" aria-hidden="true">Ã—</button>        <h4><i class="icon fa fa-check"></i> <%= title %>!</h4>        <p class="body-alert"><%= body %></p>    </div>    ')}),_.extend(g3wadmin.ui,{modal:function($modal,options){this.$modal=$modal,this.options=options,this.data=new Object,this.$modal.on("hidden.bs.modal",function(e){$(this).remove()}),this.options.onModalShow&&this.$modal.on("shown.bs.modal",eval(this.options.onModalShow)),this.show=function(){var e=!0;if(_.isObject(this.options)&&!_.isUndefined(this.options.backdrop))e=this.options.backdrop;this.$modal.modal({show:!0,backdrop:e})},this.hide=function(){this.$modal.modal("hide")},this.setBody=function(e){this.$modal.find(".modal-body").html(e)},this.setTitle=function(e){this.$modal.find(".modal-title").html(e)},this.setConfirmButtonAction=function(e){this.$modal.find(".modal-button-confirm").click(e)},this.setCloseButtonAction=function(e){this.$modal.find(".modal-button-close").click(e)},this.toggleStateButton=function(e){var t=this.$modal.find(".modal-button-"+e);t.is(":disabled")?t.prop("disabled",!1):t.prop("disabled",!0)}},_buildModal:function(e){var t=$(ga.tpl.dialog(_.extendOwn(_.clone(ga.tpl.tplDefValues.dialog),e)));return new this.modal(t,e)},buildDefaultModal:function(e){return _.isObject(e)||(e={}),e.modalClass="",this._buildModal(e)},buildDangerModal:function(e){return _.isObject(e)||(e={}),e.modalClass="modal-danger",this._buildModal(e)},buildWarningModal:function(e){return _.isObject(e)||(e={}),e.modalClass="modal-warning",this._buildModal(e)},pageAlert:function(e){this.$pageAlert=e,this.setBody=function(e){this.$pageAlert.find(".body-alert").html(e)},this.show=function(e){e.after(this.$pageAlert)}},buildPageAlert:function(e){_.isObject(e)||(e={});var t=$(ga.tpl.pageAlert(_.extendOwn(_.clone(ga.tpl.tplDefValues.pageAlert),e)));return new this.pageAlert(t)},mapModal:function(o){_.isObject(o)||(o={}),_.extend(o,{modalBody:ga.tpl.mapContainer()});var r=this._buildModal(o);o.extent;return r.map={},r.$modal.on("shown.bs.modal",function(e){if(r.map=L.map($(this).find("#modalMap")[0],{center:[0,0],zoom:1}),L.tileLayer("http://{s}.tile.osm.org/{z}/{x}/{y}.png?{foo}",{foo:"bar"}).addTo(r.map),r.drawnItems=new L.FeatureGroup,_.has(o,"bboxLayer")&&!_.isNull(o.bboxLayer)){var t=o.bboxLayer.split(","),a=[[t[1],t[0]],[t[3],t[2]]];r.drawnLayer=L.rectangle(a),r.drawnLayer.editing.enable(),r.drawnItems.addLayer(r.drawnLayer),r.map.fitBounds(a)}else r.drawnLayer={};r.map.addLayer(r.drawnItems);var i=new L.Control.Draw({draw:{polyline:!1,polygon:!1,circle:!1,marker:!1},edit:{featureGroup:r.drawnItems,edit:!1,remove:!1}});r.map.addControl(i),r.map.on("draw:drawstart",function(e){r.drawnItems.clearLayers()}),r.map.on("draw:created",function(e){e.layerType;r.drawnLayer=e.layer,r.drawnLayer.editing.enable(),r.drawnItems.addLayer(r.drawnLayer)})}),r},initCrudDeleteWidget:function(){$(document).on("click",'[data-widget-type="deleteItem"]',function(e){ga.widget.deleteItem($(this))})},initCrudDetailWidget:function(){$(document).on("click",'[data-widget-type="detailItem"]',function(e){ga.widget.showDetailItem($(this))})},initSetProjectPanoramicWidget:function(){$(document).on("ifClicked",'[data-widget-type="setProjectPanoramic"]',function(e){ga.widget.setProjectPanoramic($(this),e)})},initLinkWidget2Layer:function(){$(document).on("ifChecked",'[data-widget-type="linkWidget2Layer"]',function(e){ga.widget.linkWidget2Layer($(this))}).on("ifUnchecked",'[data-widget-type="linkWidget2Layer"]',function(e){ga.widget.linkWidget2Layer($(this),!1)})},initRadioCheckbox:function(e){if(_.isUndefined(e))t=$('input[type="checkbox"], input[type="radio"]');else var t=$(e).find('input[type="checkbox"], input[type="radio"]');t.iCheck({checkboxClass:"icheckbox_flat-green",radioClass:"iradio_flat-green"})},initBootstrapDatepicker:function(e){if(_.isUndefined(e))t=$(".datepicker");else var t=$(e).find(".datepicker");t.datepicker({language:CURRENT_LANGUAGE_CODE})},initBootstrapTimepicker:function(e){if(_.isUndefined(e))t=$(".timepicker");else var t=$(e).find(".timepicker");t.timepicker({showMeridian:!1,showInputs:!0})},initBootstrapColorpicker:function(e){if(_.isUndefined(e))t=$(".colorpicker");else var t=$(e).find(".colorpicker");t.parent().addClass("colorpicker-component").colorpicker()},initSelect2:function(e){if(_.isUndefined(e))t=$(".select2");else var t=$(e).find(".select2");t.select2()},initBackHistory:function(){$('[data-widget-type="backHistory"]').click(function(){return parent.history.back(),!1})},initAjaxFormWidget:function(){$(document).on("click",'[data-widget-type="ajaxForm"]',function(e){ga.widget.ajaxForm($(this))})},initAjaxFilerWidget:function(){$(document).on("click",'[data-widget-type="ajaxFiler"]',function(e){e.preventDefault(),$(this).hasClass("disabled")||ga.widget.ajaxFiler($(this))})},initAjaxDownload:function(){$(document).on("click",'[data-widget-type="ajaxDownload"]',function(e){ga.widget.ajaxDownload($(this))})},initMapSetExtent:function(){$(document).on("click",'[data-widget-type="mapSetExtent"]',function(e){ga.widget.mapSetExtent($(this))})},showMessageOnLoad:function(e){if(_.isUndefined(e))t=$('[data-widget-type="showMessageOnLoad"]');else var t=$(e).find('[data-widget-type="showMessageOnLoad"]');0<t.length&&ga.widget.showMessageOnLoad(t)},initPushMenu:function(){var e=$("body"),t={path:"/"};e.on("collapsed.pushMenu",function(e){$.cookie("g3wadmin_sidebar_status","collapsed",t)}).on("expanded.pushMenu",function(e){$.cookie("g3wadmin_sidebar_status","expanded",t)})},initDataTable:function(e,t){if(_.isObject(e)&&(t=e,e=void 0),_.isUndefined(e))a=$('[data-widget-type="dataTable"]');else var a=$(e).find('[data-widget-type="dataTable"]');a.find('[data-widget-type="detailItemDataTable"]').on("click",function(e){ga.widget.showDetailItemDataTable(i,$(this))}),t||(t={stateSave:!0}),"en"!=CURRENT_LANGUAGE_CODE&&(t.language=DATATABLE_LANGS[CURRENT_LANGUAGE_CODE]);var i=a.DataTable(t)},initNolegendLayerCheckBox:function(){$(document).on("ifChanged",'[data-widget-type="noLegendLayer"]',function(e){var t=$(this),a={exclude_from_legend:e.target.checked?1:0};ga.widget.setLayerData(t,a)})},initDownloadLayerCheckBox:function(){$(document).on("ifChanged",'[data-widget-type="downloadLayer"]',function(e){var t=$(this),a={download_layer:e.target.checked?1:0};ga.widget.setLayerData(t,a)})},initExternalLayerCheckBox:function(){$(document).on("ifChanged",'[data-widget-type="externalLayer"]',function(e){var t=$(this),a={external:e.target.checked?1:0};ga.widget.setLayerData(t,a)})},closeMessages:function(){$("#page_user_messages").find(".alert").delay(4e3).slideUp(500)}}),_.extend(g3wadmin.widget,{_deleteItemParams:["delete-url","item-selector","modal-title","delete-method"],_detailItemParams:["detail-url","modal-title","modal-size"],_detailItemDataTableParams:["detail-url"],_loadHtmlItemParams:["html-url","target-selector"],_ajaxFormParams:["form-url","modal-title","modal-size"],_ajaxUploadParams:["validation-data-item-selector"],_ajaxFilerParams:["action-url","modal-title","file-extensions","on-modal-show","item-plus-form"],_setProjectPanoramic:["ajax-url"],_linkWidget2Layer:["ajax-url"],_setLayerCached:["ajax-url"],_setLayerData:["ajax-url"],_setAjaxDownload:["ajax-url"],_mapSetExtent:["crs"],deleteItem:function(e){try{var t=ga.utils.getDataAttrs(e,this._deleteItemParams);if(_.isUndefined(t["delete-url"]))throw new Error("Attribute data-delete-url not defined");var a=e.parent().find(".pre-delete-message").html(),i=ga.ui.buildDefaultModal({modalTitle:gettext("Delete item"),modalBody:gettext("Are you sure to delete this Item")+"?"+a,closeButtonText:"No"});i.setConfirmButtonAction(function(){var e={};ga.utils.addCsfrtokenData(e),$.ajax({method:_.isUndefined(t["delete-method"])?"post":t["delete-method"],url:t["delete-url"],data:e,success:function(e){$(t["item-selector"]).toggle(300,function(){$(this).remove()}),i.hide()},error:function(e,t,a){ga.widget.showError(ga.utils.buildAjaxErrorMessage(e.status,a))}})}),i.show()}catch(e){this.showError(e.message)}},showDetailItem:function(e){try{var t=ga.utils.getDataAttrs(e,this._detailItemParams);if(_.isUndefined(t["detail-url"]))throw new Error("Attribute data-detail-url not defined");$.ajax({method:"get",url:t["detail-url"],success:function(e){ga.ui.buildDefaultModal({modalTitle:_.isUndefined(t["modal-title"])?gettext("Detail object"):t["modal-title"],modalSize:_.isUndefined(t["modal-size"])?"":t["modal-size"],modalBody:e,closeButtonText:gettext("Close"),confirmButton:!1}).show()},error:function(e,t,a){ga.widget.showError(ga.utils.buildAjaxErrorMessage(e.status,a))}})}catch(e){this.showError(e.message)}},showDetailItemDataTable:function(e,t,a){try{var i=ga.utils.getDataAttrs(t,this._detailItemParams);if(_.isUndefined(i["detail-url"]))throw new Error("Attribute data-detail-url not defined");a=!_.isUndefined(a);var o=t.closest("tr"),r=e.row(o),n=($.inArray(o.attr("id"),[]),function(){$.ajax({method:"get",url:i["detail-url"],success:function(e){r.child(e).show()},complete:function(){"success"==arguments[1]&&ga.ui.initRadioCheckbox(r.child())},error:function(e,t,a){ga.widget.showError(ga.utils.buildAjaxErrorMessage(e.status,a))}})});a?n():r.child.isShown()?(o.removeClass("details"),r.child.hide()):(o.addClass("details"),n())}catch(e){this.showError(e.message)}},loadHtmlItem:function(e){try{var t=ga.utils.getDataAttrs(e,this._loadHtmlItemParams);if(_.isUndefined(t["html-url"]))throw new Error("Attribute data-html-url not defined");$.ajax({method:"get",url:t["html-url"],success:function(e){$(t["target-selector"]).html(e)},complete:function(){"success"==arguments[1]&&ga.ui.initRadioCheckbox(t["target-selector"])},error:function(e,t,a){ga.widget.showError(ga.utils.buildAjaxErrorMessage(e.status,a))}})}catch(e){this.showError(e.message)}},ajaxForm:function(i){try{var o=ga.utils.getDataAttrs(i,this._ajaxFormParams);if(_.isUndefined(o["form-url"]))throw new Error("Attribute data-form-url not defined");$.ajax({method:"get",url:o["form-url"],success:function(e){var t=ga.currentModal=ga.ui.buildDefaultModal({modalTitle:_.isUndefined(o["modal-title"])?gettext("Form title"):o["modal-title"],modalBody:e,modalSize:_.isUndefined(o["modal-size"])?"":o["modal-size"]});t.data.$evoker=i,t.show();var a=ga.currentForm=new ga.forms.form(t.$modal.find("form"));a.setAction(o["form-url"]),a.on("keypress",function(e){13==e.keyCode&&e.preventDefault()}),a.setOnSuccesAction(function(){t.hide(),window.location.reload()}),t.setConfirmButtonAction(a.sendData),ga.ui.initRadioCheckbox(t.$modal),ga.ui.initBootstrapDatepicker(t.$modal),ga.ui.initBootstrapTimepicker(t.$modal),ga.ui.initSelect2(t.$modal)},error:function(e,t,a){ga.widget.showError(ga.utils.buildAjaxErrorMessage(e.status,a))}})}catch(e){this.showError(e.message)}},ajaxFiler:function(e){try{var o=ga.utils.getDataAttrs(e,this._ajaxFilerParams);if(_.isUndefined(o["action-url"]))throw new Error("Attribute data-action-url not defined");var t={actionUrl:o["action-url"],plusFormInputs:""};if(!_.isUndefined(o["item-plus-form"])){var a=$("#"+o["item-plus-form"]);t.plusFormInputs='<div id="plus_filer_input">'+a.html()+"</div>"}var r=ga.ui.buildDefaultModal({confirmButton:!1,closeX:!1,backdrop:"static",modalTitle:_.isUndefined(o["modal-title"])?gettext("Upload file"):o["modal-title"],modalBody:ga.tpl.ajaxFiler(t),onModalShow:!_.isUndefined(o["on-modal-show"])&&o["on-modal-show"]}),i=$(r.$modal.find("#filer_input"));r.setCloseButtonAction(function(e){r.hide();var t=i.prop("jFiler");_.isNull(t.current_file)||t.current_file.uploaded&&window.location.reload()}),r.show();var n={};ga.utils.addCsfrtokenData(n);var s=_.isUndefined(o["file-extensions"])?null:o["file-extensions"].split("|");i.filer({changeInput:ga.tpl.ajaxFiler_changeInput({drag_drop_message:gettext("Drag&Drop files here"),browse_button:gettext("Browse Files")}),showThumbs:!0,limit:1,extensions:s,theme:"dragdropbox",captions:{button:"Choose Files",feedback:"Choose files To Upload",feedback2:"files were chosen",drop:"Drop file here to Upload",removeConfirmation:"Are you sure you want to remove this file?",errors:{filesLimit:"Only {{fi-limit}} files are allowed to be uploaded.",filesType:"Only Images are allowed to be uploaded.",filesSize:"{{fi-name}} is too large! Please upload file up to {{fi-fileMaxSize}} MB.",filesSizeAll:"Files you've choosed are too large! Please upload files up to {{fi-maxSize}} MB.",folderUpload:"You are not allowed to upload folders."}},dragDrop:{dragEnter:null,dragLeave:null,drop:null},templates:{box:ga.tpl.ajaxFiler_box(),item:ga.tpl.ajaxFiler_item(),itemAppend:ga.tpl.ajaxFiler_itemAppend(),progressBar:ga.tpl.ajaxFiler_progresBar(),itemAppendToEnd:!1,removeConfirmation:!0,_selectors:{list:".jFiler-items-list",item:".jFiler-item",progressBar:".bar",remove:".jFiler-item-trash-action"}},uploadFile:{url:o["action-url"],data:n,type:"post",enctype:"multipart/form-data",beforeSend:function(){var e=arguments[7];if(!_.isUndefined(o["item-plus-form"])){var t=$("#plus_filer_input").find(":input").serializeArray();for(idx in t){var a=t[idx];e.data.append(a.name,a.value)}r.toggleStateButton("close")}},success:function(e,t){var a=t.find(".jFiler-jProgressBar").parent();t.find(".jFiler-jProgressBar").fadeOut("slow",function(){$(ga.tpl.ajaxFiler_successMsg()).hide().appendTo(a).fadeIn("slow")}),t.after(e),_.isUndefined(o["item-plus-form"])||r.toggleStateButton("close")},error:function(t){if(_.isUndefined(arguments[6].responseJSON))var a=arguments[6].responseText;else a=arguments[6].responseJSON.errors;var i=t.find(".jFiler-jProgressBar").parent();t.find(".jFiler-jProgressBar").fadeOut("slow",function(){$(ga.tpl.ajaxFiler_errorMsg()).hide().appendTo(i).fadeIn("slow");var e=$('<div class="callout callout-danger"></div>');e.append($("<h4>"+gettext("ERROR")+"</h4>")),e.append($("<p></p>").html(a)),t.after(e)}),_.isUndefined(o["item-plus-form"])||r.toggleStateButton("close")}}})}catch(e){this.showError(e.message)}},addProjectGroup:function(e){try{var t=e.next(".add-links");if(0==t.length)throw new Error("No add add links choices set");ga.ui.buildDefaultModal({modalTitle:"Add a project",modalBody:t.html(),closeButtonText:"No"}).show()}catch(e){this.showError(e.message)}},ajaxUpload:function($item){var params=ga.utils.getDataAttrs($item,this._ajaxUploadParams),options={};"ajaxUploadValidation"in window&&(options.validation=window.ajaxUploadValidation),initUploadFields($item,options);var $uploader=$item.find(".file-uploader-container");$uploader.on("complete",function(e,t,a,i,o){var r=$(this).parents(".box-body").find(".img-thumbnail");r.attr("src",i.path),r.is(":hidden")&&r.show();var n=$(this).parents(".form-group"),s=n.attr("id").substring(7)+"-clear";n.find("input[name="+s+"]").remove()}).on("deleteComplete",function(e,t,a,i){$(this).parents(".box-body").find(".img-thumbnail").hide()}),$.each($uploader,function(i,ele){var $ele=$(ele),data_files=eval($ele.attr("data-files"));if(0<data_files.length){var del_btn=$ele.find(".qq-upload-delete-selector");del_btn.addClass("qq-hide");var $required=$ele.parents(".form-group").find(".requiredField");if(0==$required.length){var new_del_btn=del_btn.clone(!1).removeClass("qq-hide").removeClass("qq-upload-delete-selector");del_btn.parent().append(new_del_btn);var field_name=$ele.parents(".form-group").attr("id").substring(7);new_del_btn.on("click",function(e){var t=$(this).parents(".box-body"),a=$(this).parents(".form-group");t.find(".img-thumbnail").hide();var i=field_name+"-clear";if(0==a.find("input[name="+i+"]").length){var o=$('<input type="hidden" name="'+i+'">');o.val("1"),a.append(o),new_del_btn.addClass("qq-hide")}})}}})},showError:function(e){$(".modal,.fade").remove(),ga.ui.buildDangerModal({modalTitle:"ERROR",modalBody:e,confirmButton:!1}).show()},setProjectPanoramic:function(e,t){try{var a=ga.utils.getDataAttrs(e,this._setProjectPanoramic);if(_.isUndefined(a["ajax-url"]))throw new Error("Attribute data-ajax-url not defined");if(e.prop("checked")){var i=a["ajax-url"].split("/");i[i.length-2]="reset";var o=i.join("/");e.iCheck("uncheck")}else o=a["ajax-url"];$.ajax({method:"get",url:o,error:function(e,t,a){ga.widget.showError(ga.utils.buildAjaxErrorMessage(e.status,a))}})}catch(t){this.showError(t.message)}},linkWidget2Layer:function(e,t){try{var a=ga.utils.getDataAttrs(e,this._linkWidget2Layer);if(_.isUndefined(a["ajax-url"]))throw new Error("Attribute data-ajax-url not defined");var i={};_.isUndefined(t)||t||(i.unlink="unlink"),$.ajax({method:"get",url:a["ajax-url"],data:i,success:function(e){},error:function(e,t,a){ga.widget.showError(ga.utils.buildAjaxErrorMessage(e.status,a))}})}catch(e){this.showError(e.message)}},setLayerCached:function(e,t){try{var a=ga.utils.getDataAttrs(e,this._setLayerCached);if(_.isUndefined(a["ajax-url"]))throw new Error("Attribute data-ajax-url not defined");var i=a["ajax-url"];_.isUndefined(t)||t||(i+="?cached=0"),$.ajax({method:"get",url:i,error:function(e,t,a){ga.widget.showError(ga.utils.buildAjaxErrorMessage(e.status,a))}})}catch(e){this.showError(e.message)}},setLayerData:function(e,t){try{var a=ga.utils.getDataAttrs(e,this._setLayerData);if(_.isUndefined(a["ajax-url"]))throw new Error("Attribute data-ajax-url not defined");ga.utils.addCsfrtokenData(t),$.ajax({method:"post",data:t,url:a["ajax-url"],error:function(e,t,a){ga.widget.showError(ga.utils.buildAjaxErrorMessage(e.status,a))}})}catch(e){this.showError(e.message)}},ajaxDownload:function(e){try{var t=ga.utils.getDataAttrs(e,this._setAjaxDownload);if(_.isUndefined(t["ajax-url"]))throw new Error("Attribute data-ajax-url not defined");$.fileDownload(t["ajax-url"]).fail(function(){ga.widget.showError(ga.utils.buildAjaxErrorMessage(500,"File download Failed!"))})}catch(e){this.showError(e.message)}},showMessageOnLoad:function(e){ga.ui.buildWarningModal({modalTitle:"Warnings!",modalBody:e.html(),closeButtonText:"Close",confirmButton:!1}).show()},mapSetExtent:function(e){try{var i=ga.utils.getDataAttrs(e,this._mapSetExtent);if(_.isUndefined(i.crs))throw new Error("Attribute data-crs not defined");var o=e.parents(".input-group").find("input"),t=null;o.val()&&(t=ga.utils.transformBBoxToWGS84(i.crs,o.val()));var r=ga.ui.mapModal({bboxLayer:t});r.setConfirmButtonAction(function(e){var t=r.drawnLayer.getBounds(),a=[t.getWest(),t.getSouth(),t.getEast(),t.getNorth()];o.val(ga.utils.transformBBoxFromWGS84(i.crs,a)),r.hide()}),r.show()}catch(e){this.showError(e.message)}}}),_.extend(g3wadmin.utils,{getDataAttrs:function(e,t){var a={};return _.each(t,function(e){a[e]=this.$item.attr("data-"+e)},{$item:e,params:a}),a},buildAjaxErrorMessage:function(e,t,a){return ga.tpl.ajaxError(_.extendOwn(ga.tpl.tplDefValues.ajaxError,{textStatus:e,errorMessage:t,moreInfo:a}))},addCsfrtokenData:function(e){_.extend(e,{csrfmiddlewaretoken:$.cookie("csrftoken")})},transformBBoxToWGS84:function(e,t){if(_.isArray(t))var a=t;else{a=t.split(",");for(var i=0;i<4;i++)a[i]=parseFloat(a[i])}var o=proj4(e).inverse([a[0],a[1]]),r=proj4(e).inverse([a[2],a[3]]);return[o[0],o[1],r[0],r[1]].join()},transformBBoxFromWGS84:function(e,t){if(_.isArray(t))var a=t;else{a=t.split(",");for(var i=0;i<4;i++)a[i]=parseFloat(a[i])}var o=proj4(e).forward([a[0],a[1]]),r=proj4(e).forward([a[2],a[3]]);return[o[0],o[1],r[0],r[1]].join()},setEditorWys5Content:function(e,t){e instanceof jQuery?$selector=e:$selector=$(e),$selector.data("wysihtml5").editor.setValue(t)},preventBackButtonBrowser:function(e){_.isUndefined(e)&&(e=!0),e&&(window.location.hash="no-back-button",window.location.hash="Again-No-back-button",window.onhashchange=function(){window.location.hash="no-back-button"},$(window).on("beforeunload",function(){return!1}))}}),_.extend(g3wadmin.forms,{INSERT_STATE:0,UPDATE_STATE:1,checkItemsEmpty:function(e){$formElements=e.find(":input");$.each($formElements,function(e,t){var a=$(t);console.log(a);var i=this.tagName.toLowerCase();switch(console.log(i),i){case"select":console.log(a.val());break;case"radio":case"checkbox":console.log(a.attr("checked"));break;default:console.log(a.val())}})},checkBoxToOpen:function(e){this.checkItemsEmpty(e)},form:function(e){var o=this;this.$form=e;this.on=function(e,t){o.$form.on(e,t)},this.sendData=function(e,t,a){o.$form.trigger("preSendForm"),$.ajax({method:_.isUndefined(t)?"post":t,data:_.isUndefined(a)?o.getData():a,url:o.$form.attr("action"),success:function(e){"error"==e.status?_.has(e,"errors_form")?o.showErrors(e.errors_form):o.showErrors():_.isUndefined(o.successAction)||o.successAction(e)},complete:function(e,t){o.$form.trigger("postSendForm")},error:function(e,t,a){_.isUndefined(o.errorAction)?ga.widget.showError(ga.utils.buildAjaxErrorMessage(e.status,a)):o.errorAction(e,a)}})},this.setOnSuccesAction=function(e){this.successAction=e},this.setOnErrorAction=function(e){this.errorAction=e},this.showErrors=function(e){this.$form.find(".has-error").removeClass("has-error"),this.$form.find("span.help-block").remove(),this.$form.find(".error-form-message").removeClass("hidden"),!_.isUndefined(e)&&_.isObject(e)&&_.mapObject(e,function(e,t){var a=o.$form.find("#div_id_"+t);a.addClass("has-error");var i=a.find(".controls");_.map(e,function(e){i.append(ga.tpl.ajaxFormFieldError({errorId:"error_id_"+t,errorMessage:e}))})})},this.setAction=function(e){this.$form.attr("action",e)},this.getData=function(e){if(_.isUndefined(e))return this.$form.serialize();var t=this.$form.serializeArray(),a={};for(i in t){var o=t[i];a[o.name]=o.value}return a}}}),$(document).ready(function(){ga.bootstrap()});