!function(){var e=window&&window.initConfig&&window.initConfig.group&&window.initConfig.group.plugins;e&&(e.editing=Object.assign(e.editing||{},{version:"3.8.0",hash:"c4351a6",branch:"pr#115_to_3.8.x"}))}(),function n(a,r,o){function s(t,e){if(!r[t]){if(!a[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(l)return l(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}i=r[t]={exports:{}},a[t][0].call(i.exports,function(e){return s(a[t][1][e]||e)},i,i.exports,n,a,r,o)}return r[t].exports}for(var l="function"==typeof require&&require,e=0;e<o.length;e++)s(o[e]);return s}({1:[function(e,t,i){var n=i.cache={};function a(){}i.insert=function(e){if(n[e])return a;n[e]=!0;var t=document.createElement("style");return t.setAttribute("type","text/css"),"textContent"in t?t.textContent=e:t.styleSheet.cssText=e,document.getElementsByTagName("head")[0].appendChild(t),function(){document.getElementsByTagName("head")[0].removeChild(t),n[e]=!1}}},{}],2:[function(e,t,i){var n,a,r;e("vueify/lib/insert-css").insert("summary[data-v-90b32778]{display:list-item;font-weight:700;padding:.5em;cursor:pointer;background-color:rgba(255,255,0,.25);font-size:medium;user-select:none}ul[data-v-90b32778]{list-style:none;padding-left:0}ul>li[data-v-90b32778]{margin-bottom:8px}ins[data-v-90b32778]{background-color:lime;text-decoration-line:none}del[data-v-90b32778]{background-color:tomato}dl[data-v-90b32778]{display:grid;grid-template:auto/.5fr 1fr;margin-bottom:0;word-break:break-all}dt[data-v-90b32778]{background:#fee}dd[data-v-90b32778]{background:#f1f2f4}dd[data-v-90b32778],dt[data-v-90b32778]{margin:0;padding:.3em .5em;border-top:1px solid #fff}");function o(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,i){try{var n=s[e](i),a=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});r(a)}("next")})}}Object.defineProperty(i,"__esModule",{value:!0}),a=e("../utils/areCoordinatesEqual"),r=e("../utils/getFeatureTableFieldValue"),i.default={name:"changes",props:{commits:{type:Object,required:!0},layer:{type:Object,required:!0},relation:{type:Boolean,default:!1}},data:function(){return{features:this.layer.readFeatures(),efeatures:this.layer.readEditingFeatures()}},methods:{getFormattedValue:function(e,t){if(e)return"geometry"===t&&e.get(t)?"("+e.get(t).getFlatCoordinates().length/2+")":(0,r.getFeatureTableFieldValue)({layerId:this.layer.getId(),feature:e,property:t})},getValue:function(e,t){return this.getFormattedValue(this.getFeature(e),t)},getEditingValue:function(e,t){return this.getFormattedValue(this.getEditingFeature(e),t)},hasValue:function(e,t){var i=this.getFeature(e),e=this.getEditingFeature(e);return!(i&&e&&null===i.get(t)&&null===e.get(t)||i&&!e&&null===i.get(t))},getId:function(e){return e.id||e},getEditingFeature:function(e){var t=this.getId(e);return this.efeatures.find(function(e){return t===e.getId()})},getFeature:function(e){var t=this.getId(e);return this.features.find(function(e){return t===e.getId()})},getType:function(e){e=this.getEditingFeature(e)||this.getFeature(e);return e&&e.getGeometry&&e.getGeometry()?e.getGeometry().getType():""},isEdited:function(e,t){var i=this.getFeature(e),n=this.getEditingFeature(e);return![i,n].includes(void 0)&&(this.getType(e)&&"geometry"===t?!(0,a.areCoordinatesEqual)({feature:i,coordinates:n.get(t).getCoordinates()}):n.get(t)!==i.get(t))},getAttrs:function(e){e=this.getEditingFeature(e)||this.getFeature(e);return Object.entries(e?e.getProperties():{}).sort(function(e,t){return e[0]>t[0]})},getLayerById:function(e){return g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").service.getLayerById(e)}},mounted:(n=o(function*(){this.$refs.value.filter(function(e){return!e.textContent}).forEach(function(e){return e.innerHTML="<i><code>&lt;empty&gt;</code></i>"})}),function(){return n.apply(this,arguments)})},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var n=this,e=n.$createElement,a=n._self._c||e;return a("div",[n.relation?a("h4",{directives:[{name:"t-plugin",rawName:"v-t-plugin:pre",value:"editing.messages.commit.header_relation",expression:"'editing.messages.commit.header_relation'",arg:"pre"}],staticClass:"skin-color g3w-long-text",staticStyle:{"font-weight":"bold",margin:"15px 0"}},[n._v(": "+n._s(n.layer.getName()))]):n._e(),n._v(" "),n._l(Object.keys(n.commits).filter(function(e){return n.commits[e].length}),function(e){return[a("h4",{directives:[{name:"t-plugin",rawName:"v-t-plugin:pre",value:"editing.messages.commit."+e,expression:"`editing.messages.commit.${c}`",arg:"pre"}]},[n._v(" ("+n._s(n.commits[e].length)+") ")]),n._v(" "),a("divider"),n._v(" "),a("ul",n._l(n.commits[e],function(i){return a("li",[a("details",[a("summary",[n._v(n._s(n.getType(i))+" #"+n._s(n.getId(i)))]),n._v(" "),n._l(n.getAttrs(i),function(e){var t=e[0];e[1];return[n.hasValue(i,t)?a("dl",[a("dt",[n._v(n._s(t)+":")]),n._v(" "),a("dd",[n.isEdited(i,t)?[a("del",{ref:"value",refInFor:!0},[n._v(n._s(n.getValue(i,t)))]),n._v(" ‚Üê "),a("ins",{ref:"value",refInFor:!0},[n._v(n._s(n.getEditingValue(i,t)))])]:a("span",{ref:"value",refInFor:!0},[n._v(n._s(n.getEditingValue(i,t)||n.getValue(i,t)))]),n._v(" "),"geometry"===t?a("i",[a("code",[n._v("<coords>")])]):n._e()],2)]):n._e()]})],2)])}),0)]}),n._v(" "),n._l(Object.entries(n.commits.relations),function(e){var t=e[0],e=e[1];return a("changes",{attrs:{commits:{add:e.add,update:e.update,delete:e.delete,relations:e.relations},relation:!0,layer:n.getLayerById(t)}})})],2)},e.staticRenderFns=[],e._scopeId="data-v-90b32778"},{"../utils/areCoordinatesEqual":31,"../utils/getFeatureTableFieldValue":42,"vueify/lib/insert-css":1}],3:[function(e,t,i){e("vueify/lib/insert-css").insert(".choose-and-zoom-to-feature[data-v-3c5d6465]{display:flex;flex-direction:column;justify-content:space-between}#editing-layers-choose-feature .editing-choose-feature-radio-input[data-v-3c5d6465]{align-items:center;padding:5px;position:relative;display:flex;justify-content:space-between;border-bottom:1px solid #eee}.ztf[data-v-3c5d6465]{padding-left:3px;font-size:1.3em;cursor:pointer;margin-top:10px}.magic-radio+label[data-v-3c5d6465]{color:transparent}.feature-attributes[data-v-3c5d6465]{overflow-x:auto;display:flex}.feature-attributes>div[data-v-3c5d6465]{display:flex;flex-direction:column;justify-content:space-between;padding:5px}.f-attr[data-v-3c5d6465]{font-weight:700;margin-bottom:10px}.f-val[data-v-3c5d6465]{align-self:start;white-space:nowrap}");Object.defineProperty(i,"__esModule",{value:!0}),n=g3wsdk.gui.GUI,i.default={name:"choosefeature",data:function(){return{feature:this.$options.feature}},methods:{selectFeature:function(e){this.feature.splice(0),this.feature.push(e)},getAttributesFeature:function(e){var i=e.getProperties();return this.$options.attributes.map(function(e){var t=e.label,e=e.name;return{attribute:t,value:i[e]}})},zoomToFeature:function(e){n.getService("map").zoomToFeatures([e],{highlight:!0,duration:1e3})}},mounted:function(){n.closeContent()}},t.exports.__esModule&&(t.exports=t.exports.default);var n,e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var i=this,e=i.$createElement,n=i._self._c||e;return n("div",{attrs:{id:"editing-layers-choose-feature"}},i._l(i.$options.features,function(t,e){return n("div",{staticClass:"editing-choose-feature-radio-input"},[n("section",{staticClass:"choose-and-zoom-to-feature"},[n("div",[n("input",{staticClass:"magic-radio",attrs:{id:"choose_feature_"+e,name:"radio",type:"radio"},on:{click:function(e){return e.stopPropagation(),i.selectFeature(t)}}}),i._v(" "),n("label",{attrs:{for:"choose_feature_"+e}},[i._v("id")])]),i._v(" "),n("div",{staticClass:"ztf skin-color",class:i.g3wtemplate.font.marker,on:{click:function(e){return e.stopPropagation(),i.zoomToFeature(t)}}})]),i._v(" "),n("section",{staticClass:"feature-attributes"},i._l(i.getAttributesFeature(t),function(e){var t=e.attribute,e=e.value;return n("div",[n("span",{staticClass:"f-attr"},[i._v(i._s(t))]),i._v(" "),n("span",{staticClass:"f-val"},[i._v(i._s(e))])])}),0)])}),0)},e.staticRenderFns=[],e._scopeId="data-v-3c5d6465"},{"vueify/lib/insert-css":1}],4:[function(e,t,i){var n,a,r,o,s;e("vueify/lib/insert-css").insert(".g3w-editing-other-layers-features[data-v-0a61c6b7]{overflow:auto}.edit-multi-features[data-v-0a61c6b7]{display:flex;justify-content:flex-end}.edit-multi-features>label[data-v-0a61c6b7]{color:#000}.layer-title[data-v-0a61c6b7]{font-weight:700;font-size:1.2em}.copy-features-for-layer-content[data-v-0a61c6b7]{overflow-x:auto}.ztf[data-v-0a61c6b7]{padding:0 5px 15px;font-size:1.1em;cursor:pointer;margin-right:5px}.GIVE_ME_A_NAME_1[data-v-0a61c6b7]{padding:5px;position:relative;display:flex;align-items:baseline;border-bottom:1px solid #eee}.GIVE_ME_A_NAME_2[data-v-0a61c6b7]{display:flex;flex-direction:column;border-right:1px solid #eee}.GIVE_ME_A_NAME_2 .magic-checkbox+label[data-v-0a61c6b7]{color:#fff}.feature-attributes[data-v-0a61c6b7]{display:flex;flex-direction:column;padding:10px}.f-attr[data-v-0a61c6b7]{font-weight:700;margin-bottom:10px}.f-value[data-v-0a61c6b7]{align-self:start}");function l(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,i){try{var n=s[e](i),a=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});r(a)}("next")})}}Object.defineProperty(i,"__esModule",{value:!0}),a=g3wsdk.constant.G3W_FID,r=g3wsdk.gui.GUI,o=g3wsdk.core.geoutils.getAlphanumericPropertiesFromFeature,s=g3wsdk.core.map.MapLayersStoreRegistry,e=g3wsdk.gui.vue.Mixins.resizeMixin,i.default={name:"Copyfeaturesfromotherlayers",mixins:[e],data:function(){return{selectedFeatures:this.$options.selectedFeatures,disabled:!0,_height:0}},computed:{showEditAttributes:function(){return 1<Object.values(this.$options.layers).reduce(function(e,t){return e+=t.features.length},0)}},methods:{resize:(n=l(function*(){yield this.$nextTick(),this.$data._height=window.innerHeight-200}),function(){return n.apply(this,arguments)}),getAttributesFeature:function(e,t){var t=this.$options.layers[t],i=t.external,n=t.fields;return o(e.getProperties()).filter(function(e){return a!==e}).map(function(t){return{attribute:i?t:n.find(function(e){return e.name===t}).label,value:e.get(t)}})},selectFeature:function(t){this.selectedFeatures.find(function(e){return e===t})?this.selectedFeatures=this.selectedFeatures.filter(function(e){return e!==t}):this.selectedFeatures.push(t),this.disabled=this.selectedFeatures.length<2,this.$options.editAttributes.state=!this.disabled&&this.$options.editAttributes.state},getLayerTitle:function(e){var t=s.getLayerById(e);return t?t.getTitle():r.getService("map").getLayerById(e).get("name")},zoomToFeature:function(e){r.getService("map").zoomToFeatures([e],{highlight:!0,duration:1e3})}},beforeCreate:function(){this.delayType="debounce"},mounted:function(){r.closeContent()}},t.exports.__esModule&&(t.exports=t.exports.default);i="function"==typeof t.exports?t.exports.options:t.exports;i.render=function(){var a=this,e=a.$createElement,n=a._self._c||e;return n("div",{staticClass:"editing-layers-features"},[a.showEditAttributes?n("div",{directives:[{name:"disabled",rawName:"v-disabled",value:a.disabled,expression:"disabled"}],staticClass:"edit-multi-features"},[n("input",{directives:[{name:"model",rawName:"v-model",value:a.$options.editAttributes.state,expression:"$options.editAttributes.state"}],staticClass:"magic-checkbox",attrs:{id:"g3w_edit_attributes_of_select_feature_from_layer",type:"checkbox"},domProps:{checked:Array.isArray(a.$options.editAttributes.state)?-1<a._i(a.$options.editAttributes.state,null):a.$options.editAttributes.state},on:{change:function(e){var t,i=a.$options.editAttributes.state,e=e.target,n=!!e.checked;Array.isArray(i)?(t=a._i(i,null),e.checked?t<0&&a.$set(a.$options.editAttributes,"state",i.concat([null])):-1<t&&a.$set(a.$options.editAttributes,"state",i.slice(0,t).concat(i.slice(t+1)))):a.$set(a.$options.editAttributes,"state",n)}}}),a._v(" "),n("label",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.modal.tools.copyfeaturefromotherlayer.edit_attributes",expression:"'editing.modal.tools.copyfeaturefromotherlayer.edit_attributes'"}],attrs:{for:"g3w_edit_attributes_of_select_feature_from_layer"}})]):a._e(),a._v(" "),n("section",{staticClass:"g3w-editing-other-layers-features",style:{height:a.$data._height+"px"}},a._l(Object.keys(a.$options.layers),function(i){return n("div",[n("div",{staticClass:"layer-title skin-color"},[a._v(a._s(a.getLayerTitle(i)))]),a._v(" "),n("divider"),a._v(" "),n("div",{staticClass:"copy-features-for-layer-content"},a._l(a.$options.layers[i].features,function(t,e){return n("div",{staticClass:"GIVE_ME_A_NAME_1"},[n("div",{staticClass:"GIVE_ME_A_NAME_2"},[n("div",{class:["ztf","skin-color",a.g3wtemplate.font.marker],on:{click:function(e){return e.stopPropagation(),a.zoomToFeature(t)}}}),a._v(" "),n("div",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:"plugins.editing.steps.help.select_elements",expression:"'plugins.editing.steps.help.select_elements'",arg:"right",modifiers:{create:!0}}]},[n("input",{staticClass:"magic-checkbox",attrs:{id:i+"_"+e+"_select_feature_from_layer",type:"checkbox"},on:{click:function(e){return e.stopPropagation(),a.selectFeature(t)}}}),a._v(" "),n("label",{attrs:{for:i+"_"+e+"_select_feature_from_layer"}},[a._v(" "+a._s(t.getId()||0))])])]),a._v(" "),a._l(a.getAttributesFeature(t,i),function(e){var t=e.attribute,e=e.value;return n("div",{staticClass:"feature-attributes"},[n("span",{staticClass:"f-attr"},[a._v(a._s(t))]),a._v(" "),n("span",{staticClass:"f-value"},[a._v(a._s(e))])])})],2)}),0)],1)}),0)])},i.staticRenderFns=[],i._scopeId="data-v-0a61c6b7"},{"vueify/lib/insert-css":1}],5:[function(e,t,i){var n,a,r,o,s,l,u,d,c,f,g,p,y,h;e("vueify/lib/insert-css").insert(".g3w-editing-panel .editing-button .editing-icon{background-color:#3a4448;color:#222d32;font-size:1.8em;padding:10px;margin:5px;width:45px;height:45px;border-radius:30%;text-align:center}.g3w-editing-panel .editing-button.enabled .editing-icon{background-color:#fff;box-shadow:0 0 5px rgba(0,0,0,.7)}.g3w-editing-panel .editing-button{cursor:not-allowed}.g3w-editing-panel .editing-button.enabled{cursor:pointer}.g3w-editing-panel .editbtn{border-radius:30%;padding:10px;display:inline-block;opacity:.4;box-shadow:0 1px 1px 0 rgba(0,0,0,.1),0 1px 4px 0 rgba(0,0,0,.3)}.g3w-editing-panel .editbtn.enabled{opacity:1;cursor:pointer}.g3w-editing-panel .editbtn.enabled.toggled{box-shadow:0 0;background-color:#ddd}\n.g3w-editing-panel[data-v-cb98e6ce]{margin-bottom:50px}#onlineofflinemessage[data-v-cb98e6ce]{margin-bottom:5px;padding:5px;border-radius:3px;background-color:orange;color:#fff;font-weight:700}.commitbar[data-v-cb98e6ce]{display:flex;justify-content:flex-end;margin-bottom:5px}.commitbar>div[data-v-cb98e6ce]:first-of-type{margin-right:auto}#g3w-select-editable-layers-content[data-v-cb98e6ce]{margin-bottom:10px;font-weight:700}#g3w-select-editable-layers-content label[data-v-cb98e6ce]{color:#fff!important}#g3w-select-editable-layers-to-show[data-v-cb98e6ce]{cursor:pointer}");function v(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,i){try{var n=s[e](i),a=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});r(a)}("next")})}}Object.defineProperty(i,"__esModule",{value:!0}),n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var i=t,n=[],a=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!i||n.length!==i);a=!0);}catch(e){t=!0,r=e}finally{try{!a&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=(a=a=e("./Toolbox.vue"))&&a.__esModule?a:{default:a},r=e("../utils/promisify"),f=g3wsdk.gui.GUI,e=g3wsdk.core,g=e.ApplicationState,p=e.ApplicationService,y=g3wsdk.core.catalog.CatalogLayersStoresRegistry,h=g3wsdk.core.data.DataRouterService,i.default={name:"Editing",data:function(){return{state:this.$options.service.state,service:this.$options.service,resourcesurl:this.$options.resourcesurl,showcommitbar:this.$options.showcommitbar,saving:!1,layersInEditing:0,editingButtonsEnabled:!0,selectedlayers:[],editinglayers:Object.entries(g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").getEditableLayers()).map(function(e){var e=n(e,2),t=e[0],e=e[1];return{id:t,name:e.getName(),title:e.getTitle()}}),activetool:null}},components:{toolbox:a.default},transitions:{addremovetransition:"showhide"},methods:{updateFilterLayers:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];0<e.length?(this._selectedlayers=this.selectedlayers,this.selectedlayers=e):(this.selectedlayers=this._selectedlayers,this._selectedlayers=e),$(this.$refs.selectlayers).val(this.selectedlayers).trigger("change")},updateLayersInEditing:function(e){this.layersInEditing+=e?1:-1},undo:function(){this.canUndo&&this.service.undo()},redo:function(){this.canRedo&&this.service.redo()},commit:function(e){var t=this;this.canCommit&&(this.saving=!0,this.service.commit({toolbox:this.service.getToolBoxById(e),modal:!1}).always(function(){return t.saving=!1}))},startToolBox:(c=v(function*(e){var t=this,e=this.service.getToolBoxById(e),i=g.online&&e.getDependencies().find(function(e){return t.service.getToolBoxById(e).isDirty()});i&&(yield this.commit_dirty(i)),e.start()}),function(e){return c.apply(this,arguments)}),stopToolBox:(d=v(function*(e){e=this.service.getToolBoxById(e);try{e.state.editing.history.commit&&(yield(0,r.promisify)(this.service.commit()))}catch(e){}yield e.stop();e=void 0===this.service.getToolBoxes().find(function(e){return e.state.editing.on})&&f.getService("map").getMapControlByType({type:"query"});e&&!e.isToggled()&&e.toggle()}),function(e){return d.apply(this,arguments)}),startTool:(u=v(function*(e,t){var i=this,n=this.service.getToolBoxById(t),a=this.activetool&&t===this.activetool;!a&&this.service.getToolBoxById(n.getDependencies().find(function(e){return e===i.activetool}))&&(yield this.commit_dirty(this.activetool)),a||this.stopTool(this.activetool),this.activetool=t,n.setActiveTool(n.getToolById(e))}),function(e,t){return u.apply(this,arguments)}),stopTool:function(e){e&&this.service.getToolBoxById(e).stopActiveTool()},selectToolBox:(l=v(function*(e){var e=this.service.getToolBoxById(e),t=this.service.getToolBoxes().find(function(e){return e.isSelected()});t&&(t.setSelected(!1),t.clearMessage()),e.setSelected(!0),this.state.toolboxselected=e}),function(e){return l.apply(this,arguments)}),commit_dirty:(s=v(function*(t){var i=this,n=this.service.getToolBoxById(t);try{n.isDirty()&&n.hasDependencies()&&(yield(0,r.promisify)(this.service.commit({toolbox:n})))}catch(e){try{[t].concat(n.getDependencies()).forEach(function(e){var e=i.service.getToolBoxById(e),t=e.getEditor();t.getEditingSource().setFeatures((t.readFeatures()||[]).map(function(e){return e.clone()})),e.getSession().getHistory().clear(),e.stopActiveTool()})}catch(e){}}}),function(e){return s.apply(this,arguments)}),_enableEditingButtons:function(e){this.editingButtonsEnabled=!e},checkOfflineChanges:function(){var s=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.modal,l=void 0===t||t,t=e.unlock,u=void 0!==t&&t;return new Promise(function(i,n){var a,r,o=p.getOfflineItem("EDITING_CHANGES");o&&(a=[],r=[],setTimeout(function(){for(var e in o){r.push(e);var t=s.service.getToolBoxById(e),e=o[e];a.push(s.service.commit({toolbox:t,commitItems:e,modal:l}))}$.when.apply(s.service,a).then(i).fail(function(e){n(e)}).always(function(){u&&r.forEach(function(e){return s.service.getLayerById(e).unlock()}),p.setOfflineItem("EDITING_CHANGES")})},1e3))})}},computed:{canCommit:function(){return"default"===this.state.saveConfig.mode&&this.state.toolboxselected&&this.state.toolboxselected.state.editing.history.commit&&this.editingButtonsEnabled},canUndo:function(){var e=this.state.toolboxselected&&this.state.toolboxselected.state.editing.history.undo&&this.editingButtonsEnabled;return this.service.fireEvent("canUndo",e),e},canRedo:function(){var e=this.state.toolboxselected&&this.state.toolboxselected.state.editing.history.redo&&this.editingButtonsEnabled;return this.service.fireEvent("canRedo",e),e},django_admin_url:function(){return!!p.getConfig().user.is_superuser&&new URL("/django-admin/editing/g3weditingfeaturelock/",initConfig.baseurl)},filemanager_url:function(){return!!p.getConfig().user.is_superuser&&new URL("/filemanager/",initConfig.baseurl)}},watch:{canCommit:function(e){p.registerLeavePage({bool:e})},layersInEditing:function(e){document.getElementsByClassName("close-pane-button")[0].classList[0===e?"remove":"add"]("g3w-disabled")},selectedlayers:function(){var n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],a=0<n.length,r=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing");this.editinglayers.forEach(function(e){var e=e.id,t=r.getToolBoxById(e),i=a&&t.state.editing.history.commit,e=-1!==n.indexOf(e);t.setShow(!a||e),a&&!e&&i&&r.commit({toolbox:t}).always(function(){return t.stop()}),!a||e||i||t.stop()})}},created:function(){var e=this;this._selectedlayers=[],this.appState=g,this.unByKeys=this.unByKeys||[],g.online&&this.checkOfflineChanges({unlock:!0}),this.unByKeys.push({owner:p,setter:"offline",key:p.onafter("offline",function(){})}),this.unByKeys.push({owner:p,setter:"online",key:p.onafter("online",function(){return e.checkOfflineChanges({modal:!1}).catch(function(e){return f.notify.error(e)})})}),f.closeContent(),this.state.open=!1,y.getLayers({EDITABLE:!0}).forEach(function(e){return e.setInEditing(!0)}),f.on("opencontent",this._enableEditingButtons),f.on("closeform",this._enableEditingButtons),f.on("closecontent",this._enableEditingButtons)},beforeDestroy:(o=v(function*(){var i=this,e=(this.service.stop(),this.state.open=!1,y.getLayers({EDITABLE:!0}).forEach(function(e){return e.setInEditing(!1)}),f.off("opencontent",this._enableEditingButtons),f.off("closeform",this._enableEditingButtons),f.off("closecontent",this._enableEditingButtons),this.unByKeys.forEach(function(e){var t=e.owner,i=e.setter,e=e.key;return t.un(i,e)}),this.service.fireEvent("closeeditingpanel"),Object.keys(this.state.featuresOnClose));if(e.length){var n={layers:[],fids:[],formatter:1},e=(e.forEach(function(e){var t=[].concat(function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(i.state.featuresOnClose[e]));t.length&&(e=y.getLayerById(e),n.layers.push(e),n.fids.push(t))}),n.layers.length?h.getData("search:layersfids",{inputs:n,outputs:{title:"plugins.editing.editing_changes",show:{loading:!1}}}):Promise.resolve());try{yield e}catch(e){}}this.state.featuresOnClose={},this.service.getToolBoxes().forEach(function(e){return e.resetDefault()}),this.state.uniqueFieldsValues={};e=f.getService("map").getMapControlByType({type:"query"});e&&!e.isToggled()&&e.toggle()}),function(){return o.apply(this,arguments)})},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"g3w-editing-panel"},[i("bar-loader",{attrs:{loading:t.saving}}),t._v(" "),0<t.layersInEditing?i("helpdiv",{staticStyle:{"font-weight":"bold"},attrs:{message:"plugins.editing.close_editing_panel.message"}}):t._e(),t._v(" "),t.appState.online?t._e():i("div",{attrs:{id:"onlineofflinemessage"}},[i("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.messages.offline",expression:"'editing.messages.offline'"}]})]),t._v(" "),t.showcommitbar?i("div",{directives:[{name:"disabled",rawName:"v-disabled",value:t.saving,expression:"saving"}],staticClass:"commitbar"},[i("div",{class:["editing-button",t.canCommit?"enabled":""],on:{click:function(e){return e.stopPropagation(),t.commit(e)}}},[i("span",{class:["editing-icon",t.g3wtemplate.font.save]})]),t._v(" "),i("div",{class:["editing-button",t.canUndo?"enabled":""],on:{click:function(e){return e.stopPropagation(),t.undo(e)}}},[i("span",{class:["editing-icon",t.g3wtemplate.font["arrow-left"]]})]),t._v(" "),i("div",{class:["editing-button",t.canRedo?"enabled":""],on:{click:function(e){return e.stopPropagation(),t.redo(e)}}},[i("span",{class:["editing-icon",t.g3wtemplate.font["arrow-right"]]})])]):i("div",{staticStyle:{height:"10px"}}),t._v(" "),t.state.showselectlayers&&1<t.state.toolboxes.length?i("div",{staticClass:"skin-color",attrs:{id:"g3w-select-editable-layers-content"}},[i("label",{directives:[{name:"t",rawName:"v-t",value:"Layers",expression:"'Layers'"}],attrs:{for:"g3w-select-editable-layers-to-show"}}),t._v(" "),i("select",{directives:[{name:"select2",rawName:"v-select2",value:"selectedlayers",expression:"'selectedlayers'"}],ref:"selectlayers",attrs:{id:"g3w-select-editable-layers-to-show",multiple:"multiple",clear:"true"}},t._l(t.editinglayers,function(e){return i("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.name))])}),0)]):t._e(),t._v(" "),i("div",{attrs:{id:"toolboxes"}},t._l(t.state.toolboxes,function(e){return i("toolbox",{key:e.id,attrs:{state:e,resourcesurl:t.resourcesurl},on:{setselectedtoolbox:t.selectToolBox,starttoolbox:t.startToolBox,stoptoolbox:t.stopToolBox,setactivetool:t.startTool,stopactivetool:t.stopTool,"on-editing":t.updateLayersInEditing,"update-filter-layers":t.updateFilterLayers}})}),1),t._v(" "),t.django_admin_url?i("p",[i("a",{attrs:{href:t.django_admin_url,target:"_blank"}},[t._v("üîí Locked features")])]):t._e(),t._v(" "),t.filemanager_url?i("p",[i("a",{attrs:{href:t.filemanager_url,target:"_blank"}},[t._v("üìÇ File manager")])]):t._e()],1)},e.staticRenderFns=[],e._scopeId="data-v-cb98e6ce"},{"../utils/promisify":57,"./Toolbox.vue":8,"vueify/lib/insert-css":1}],6:[function(e,t,i){var o,p,y,l,h,v,m,d,s,u,c,_,n,a,f,g,b,w,r,k,S,F,j,D,B,V,U,x,z,E,I,T,C,G,N,P,H,q,W,K,Z,L;e("vueify/lib/insert-css").insert(".g3w-editing-new-relation-vector-type[data-v-112912af]{margin-bottom:5px;font-weight:700}.relation_header_title[data-v-112912af]{font-weight:700;font-size:1.3em;align-items:center}.relation_header_title[data-v-112912af],.relation_header_tools[data-v-112912af]{width:100%;display:flex;background-color:#fff}.g3w-editing-relations-add-link-tools[data-v-112912af]{display:flex;justify-content:flex-end}.relation_vector_tools[data-v-112912af]{display:flex;flex-direction:column;border:2px solid #eee;background-color:#fff;padding:10px}#g3w-select-editable-layers-content[data-v-112912af]{flex-grow:1;display:flex;flex-direction:column}#search-box[data-v-112912af]{margin-right:auto}.relation_body[data-v-112912af]{padding:0}.g3wform-relation-table[data-v-112912af]{width:100%}.close_vector_relation_tool[data-v-112912af]{align-self:self-end}.close_vector_relation_tool>.g3w-icon[data-v-112912af]{font-weight:700;cursor:pointer}.divider[data-v-112912af]{display:block;position:relative;padding:0;margin-bottom:5px;height:0;width:100%;max-height:0;font-size:1px;line-height:0;clear:both;border:none;border-bottom:2px solid #eee}");function R(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function O(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function M(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,i){try{var n=s[e](i),a=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});r(a)}("next")})}}function Y(e){return k.apply(this,arguments)}Object.defineProperty(i,"__esModule",{value:!0}),o=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,n=arguments[t];for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},p=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var i=t,n=[],a=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!i||n.length!==i);a=!0);}catch(e){t=!0,r=e}finally{try{!a&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},y=e("../g3wsdk/workflow/workflow"),l=e("../g3wsdk/workflow/step"),h=e("../utils/setAndUnsetSelectedFeaturesStyle"),v=e("../utils/promisify"),m=e("../utils/getRelationFieldsFromRelation"),d=e("../utils/getLayersDependencyFeatures"),s=e("../utils/getEditingLayerById"),u=e("../utils/convertToGeometry"),c=e("../utils/addTableFeature"),_=e("../utils/updateParentWorkflows"),n=e("../utils/getRelationId"),a=e("../utils/getFeatureTableFieldValue"),f=e("../utils/chooseFeatureFromFeatures"),g=e("../interactions/pickfeaturesinteraction"),b=e("../eventbus"),w=e("../workflows"),U=g3wsdk.core.project.ProjectsRegistry,x=g3wsdk.core.catalog.CatalogLayersStoresRegistry,z=g3wsdk.core.data.DataRouterService,E=g3wsdk.core.geometry.Geometry,I=g3wsdk.core.geoutils.isSameBaseGeometryType,T=g3wsdk.core.i18n.tPlugin,C=g3wsdk.core.layer.Layer,G=g3wsdk.core.layer.features.Feature,N=g3wsdk.core.utils.toRawType,P=g3wsdk.gui.GUI,H=g3wsdk.gui.vue.services.FormService,e=g3wsdk.gui.vue.Mixins,q=e.fieldsMixin,W=e.resizeMixin,e=e.mediaMixin,A=g3wsdk.ol.interactions,K=A.PickFeatureInteraction,Z=A.PickCoordinatesInteraction,Object.entries({Workflow:y.Workflow,Step:l.Step,OpenFormStep:w.OpenFormStep,OpenTableStep:w.OpenTableStep,AddFeatureStep:w.AddFeatureStep,ModifyGeometryVertexStep:w.ModifyGeometryVertexStep,MoveFeatureStep:w.MoveFeatureStep}).forEach(function(e){e=p(e,2);e[0],e[1]}),A="rgb(255,89,0)",L={Point:new ol.style.Style({image:new ol.style.Circle({radius:8,fill:new ol.style.Fill({color:A})})}),MultiPoint:new ol.style.Style({image:new ol.style.Circle({radius:8,fill:new ol.style.Fill({color:A})})}),Linestring:new ol.style.Style({stroke:new ol.style.Stroke({width:8,color:A})}),MultiLinestring:new ol.style.Style({stroke:new ol.style.Stroke({width:8,color:A})}),Polygon:new ol.style.Style({stroke:new ol.style.Stroke({width:8,color:A}),fill:new ol.style.Fill({color:A})}),MultiPolygon:new ol.style.Style({stroke:new ol.style.Stroke({width:8,color:A}),fill:new ol.style.Fill({color:A})})},i.default={mixins:[e,q,W],name:"g3w-relation",data:function(){return{loading:!1,show_vector_tools:!1,disabled:!1,copylayerid:null,copyFeatureLayers:[],active:!1,value:null,placeholdersearch:T("editing.search")+" ...",resourcesurl:P.getResourcesUrl()}},methods:{resize:function(){var e;this.active&&"none"!==this.$el.style.display&&((e=this.$refs.relation_body.querySelector("div.dataTables_scrollBody"))&&(e.style.height=((document.querySelector(".g3wform_body")||{}).offsetHeight||0)-((document.querySelector(".g3wform_footer")||{}).offsetHeight||0)-((this.$refs.relation_header_title||{}).offsetHeight||0)-((this.$refs.relation_header_tools||{}).offsetHeight||0)-((this.$el.querySelector(".dataTables_scrollHead")||{}).offsetHeight||0)-((this.$el.querySelector(".dataTables_paginate.paging_simple_numbers")||{}).offsetHeight||0)-((document.querySelector(".editing-save-all-form")||{}).offsetHeight||0)-((this.isVectorRelation&&this.show_vector_tools&&this.$refs.relation_vector_tools||{}).offsetHeight||0)+"px"),this.relationsTable)&&this.relationsTable.columns.adjust()},copyFeatureFromOtherLayer:function(){var t=this,e=this.copyFeatureLayers.find(function(e){return e.id===t.copylayerid}).external,i=(e?P.getService("map"):x).getLayerById(this.copylayerid),n=e||i.isGeoLayer();this.runAddRelationWorkflow({workflow:n?new this._add_link_workflow.selectandcopy({copyLayer:i,isVector:!0,help:"editing.steps.help.copy",external:e}):void 0,isVector:n})},closeVectorTools:(V=M(function*(){this.show_vector_tools=!1,yield this.$nextTick(),this.resize()}),function(){return V.apply(this,arguments)}),addVectorRelation:function(){this.runAddRelationWorkflow({workflow:new this._add_link_workflow.add,isVector:C.LayerTypes.VECTOR===this._layerType}),this.show_vector_tools=!1},addRelationAndLink:(B=M(function*(){this.isVectorRelation?(this.show_vector_tools=!this.show_vector_tools,yield this.$nextTick(),this.resize()):this.runAddRelationWorkflow({workflow:new this._add_link_workflow.add,isVector:C.LayerTypes.VECTOR===this._layerType})}),function(){return B.apply(this,arguments)}),relationAttributesSubset:function(e){return e.fields.map(function(e){var t=e.label;return{name:e.name,label:t,value:e.value}}).flatMap(function(e){var t=e.name,i=e.label,e=e.value;return Array.isArray(e)?[]:[{name:t,label:i,value:e}]})},getValue:function(e){return e&&"Object"===N(e)?e=e.value:"string"==typeof e&&0===e.indexOf("_new_")&&(e=null),this.value=e},_createDataTable:function(){var e=this;this.relationsTable=$(this.$refs.relationTable).DataTable({autoWidth:!1,columnDefs:[{orderable:!1,targets:[0,1]}],destroy:!0,order:[2,"asc"],pageLength:10,responsive:!0,scrollCollapse:!0,scrollResize:!0,scrollX:!0}),$(".dataTables_filter, .dataTables_length").hide(),$("#filterRelation").on("keyup",function(){e.relationsTable.search($(e).val()).draw()})},destroyTable:function(){this.relationsTable&&(this.relationsTable=this.relationsTable.destroy(),this.relationsTable=null,$("#filterRelation").off())},updateTable:(D=M(function*(){var e=this;this.destroyTable(),yield this.$nextTick(),this._createDataTable(),setTimeout(function(){return e.resize()})}),function(){return D.apply(this,arguments)}),updateNewRelationId:function(){var n=this;this._new_relations_ids.forEach(function(e){var t=e.clientid,i=e.id,e=n.relations.find(function(e){return t===e.id});e&&(e.id=i,(n.tools.find(function(e){return e.find(function(e){return 1<e.state.id.split(t+"_").length})})||[]).forEach(function(e){return e.state.id=e.state.id.replace(t+"_",i+"_")}))})},onCommit:function(e){var e=e.new_relations,e=void 0===e?{}:e,t=(0,s.getEditingLayerById)(this.relation.child);e[t.getId()]&&Array.isArray(e[t.getId()].new)&&(this._new_relations_ids=[].concat(O(this._new_relations_ids||[]),O(e[t.getId()].new.map(function(e){return{clientid:e.clientid,id:e.id}}))))},onInputChange:function(n){var a=this,e=(0,m.getRelationFieldsFromRelation)({layerId:this._relationLayerId,relation:this.relation}),t=e.ownField,e=e.relationField;!1!==(0<this.parent.editable.length&&e.find(function(e){return e===n.name}))&&(this.parent.values[n.name]=n.value,this.relations.map(function(e){return e.fields.find(function(e){return-1!==t.indexOf(e.name)})}).filter(Boolean).forEach(function(e){e.value=a.parent.values[e.name];var t=a.getLayer().getEditingSource().getFeatureById((void 0).id),i=t.clone();t.set(e.name,n.value),t.isNew()||g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").getToolBoxById(a._relationLayerId).getSession().pushUpdate(a._relationLayerId,t,i)}))},getRelationFeatureValue:function(e,t){return(0,a.getFeatureTableFieldValue)({layerId:this._relationLayerId,feature:this.getLayer().getEditingSource().getFeatureById(e),property:t})},enableDOMElements:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];document.querySelectorAll(".editing-save-all-form").forEach(function(e){t&&e.classList.contains("g3w-disabled")&&e.classList.remove("g3w-disabled"),t||e.querySelector(".save-all-icon").classList.contains("g3w-disabled")||e.classList.add("g3w-disabled")}),document.querySelectorAll(".g3w-editing-relations-add-link-tools, .g3wform_footer").forEach(function(e){return e.classList.toggle("g3w-disabled",!t)})},addTools:function(t){var i=this,e=[this.capabilities.includes("change_attr_feature")&&{state:Vue.observable({icon:"editAttributes.png",id:t+"_editattributes",name:"editing.tools.update_feature",enabled:!0,active:!1}),type:"editfeatureattributes"},this.capabilities.includes("delete_feature")&&{state:Vue.observable({icon:"deleteTableRow.png",id:t+"_deletefeature",name:"editing.tools.delete_feature",enabled:!0,active:!1}),type:"deletefeature"},this.capabilities.includes("change_feature")&&C.LayerTypes.VECTOR===this._layerType&&g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").getToolBoxById(this._relationLayerId).getTools().filter(function(e){return E.isPointGeometryType(i.getLayer().getGeometryType())?"movefeature"===e.getId():["movefeature","movevertex"].includes(e.getId())}).map(function(e){return{state:Vue.observable(o({},e,{id:t+"_"+e.id})),type:e.getOperator().type}})].flat().filter(Boolean);return this.tools.push(e),e},startTool:(j=M(function*(t,o){var s=this;try{if(t.state.active=!t.state.active,!t.state.active)return Promise.resolve();this.tools.forEach(function(e){e.forEach(function(e){t.state.id!==e.state.id&&(e.state.active=!1)})}),yield b.VM.$nextTick();var l={},e=new Promise(function(e,t){Object.assign(l,{resolve:e,reject:t})}),i=C.LayerTypes.VECTOR===this._layerType,n=this.relations[o],a=t.state.id.split(n.id+"_")[1],u=this.getLayer().getEditingSource().getFeatureById(n.id),d=this.getLayer().getEditingSource(),r=i&&L[this.getLayer().getGeometryType()],c=this._createWorkflowOptions({features:[u]});if("deletefeature"===a&&((0,h.setAndUnsetSelectedFeaturesStyle)({promise:e,inputs:{features:[u],layer:this.getLayer()},style:r}),P.dialog.confirm(T("editing.messages.delete_feature"),function(e){if(e){y.Workflow.Stack.getCurrent().getSession().pushDelete(s._relationLayerId,u),s.relations.splice(o,1),s.tools.splice(o,1);var i=s._relationLayerId,t=s.parent.layerId,n=u,a=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").state.uniqueFieldsValues[t],r=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").state.uniqueFieldsValues[i];if(void 0===a||void 0===r)return;void 0===a.__uniqueFieldsValuesRelations&&(a.__uniqueFieldsValuesRelations={}),Object.keys(n.getProperties()).forEach(function(e){var t;void 0===a.__uniqueFieldsValuesRelations[i]&&(a.__uniqueFieldsValuesRelations[i]={}),void 0!==r[e]&&((t=new Set(r[e])).delete(n.get(e)),a.__uniqueFieldsValuesRelations[i][e]=t)}),d.removeFeature(u),u.isNew()&&void 0===y.Workflow.Stack._workflows.find(function(e){return 0<e.getSession().state.changes.filter(function(e){e=e.feature;return u.getUid()!==e.getUid()}).length})?y.Workflow.Stack._workflows.filter(function(e){return e.getContextService()instanceof H}).forEach(function(e){return setTimeout(function(){return e.getContextService().state.update=!1})}):(0,_.updateParentWorkflows)(),l.resolve(e)}e||l.reject()})),"editattributes"===a){var f=new y.Workflow({type:"edittablefeature",steps:[new w.OpenFormStep({selectStyle:r})]});try{yield(0,v.promisify)(f.start(c)),this.getLayer().getFieldsWithValues(u,{relation:!0}).forEach(function(t){n.fields.forEach(function(e){e.name===t.name&&(e.value=t.value)})}),l.resolve(!0)}catch(e){l.reject(e)}f.stop()}if(["movevertex","movefeature"].includes(a)&&this.currentRelationFeatureId!==u.getId()&&(this.currentRelationFeatureId=u.getId(),P.getService("map").zoomToFeatures([u])),["movevertex","movefeature"].includes(a)){P.setModal(!1),this.enableDOMElements(!1);var g=new y.Workflow({type:t.type,steps:[new{movevertex:w.ModifyGeometryVertexStep,movefeature:w.MoveFeatureStep}[a]({selectStyle:r})]}),p=b.VM.$watch(function(){return t.state.active},function(e){e||(s.enableDOMElements(!0),P.setModal(!0),g.unbindEscKeyUp(),g.stop(),p(),l.reject(!1))});g.bindEscKeyUp(function(){P.setModal(!0),p(),l.reject(!1)});try{yield(0,v.promisify)(g.start(c)),y.Workflow.Stack.getParents().filter(function(e){return e.getContextService().setUpdate}).forEach(function(e){return e.getContextService().setUpdate(!0,{force:!0})}),l.resolve(!0),setTimeout(function(){return s.startTool(t,o)})}catch(e){l.reject(e)}g.unbindEscKeyUp(),g.stop(),p()}try{yield e}catch(e){return Promise.reject(e)}finally{t.state.active=!1}}catch(e){}}),function(e,t){return j.apply(this,arguments)}),getLayer:function(){return(0,s.getEditingLayerById)(this._relationLayerId)},runAddRelationWorkflow:(F=M(function*(){var a=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.workflow,e=e.isVector,e=void 0!==e&&e,r=(e&&(P.setModal(!1),P.hideContent(!0)),this._createWorkflowOptions()),i=(0,m.getRelationFieldsFromRelation)({layerId:this._relationLayerId,relation:this.relation}),o=i.ownField,n=i.relationField;try{function s(e){var i=e.oIndex,n=e.value;f.forEach(function(e,t){e.set(o[i],n),r.parentFeature.isNew()&&g[t].set(o[i],n),a.getLayer().getEditingSource().updateFeature(e),r.context.session.pushUpdate(a._relationLayerId,e,g[t])})}var l,u,d=yield(0,v.promisify)(t.start(r)),c=(e&&t.bindEscKeyUp(),d.relationFeatures),f=c.newFeatures,g=c.originalFeatures;Object.entries(this.parent.values).forEach(function(e){var e=p(e,2),t=e[0],e=e[1];return s({value:e,oIndex:n.findIndex(function(e){return t===e})})}),r.parentFeature.isNew()&&0<this.parent.editable.length&&(u=r.parentFeature.on("propertychange",function(t){r.parentFeature.isNew()?n.find(t.key)&&s({oIndex:n.findIndex(function(e){return t.key===e}),value:t.target.get(t.key)}):ol.Observable.unByKey(u)})),(l=this.relations).push.apply(l,O((f||[]).map(function(e){return{id:e.getId(),fields:a.getLayer().getFieldsWithValues(e,{relation:!0})}})))}catch(e){e&&e.relationFeatures&&(i=this.relations).push.apply(i,O((e.relationFeatures.newFeatures||[]).map(function(e){return{id:e.getId(),fields:a.getLayer().getFieldsWithValues(e,{relation:!0})}}))),r.context.session.rollbackDependecies([this._relationLayerId])}t.stop(),e&&(t.unbindEscKeyUp(),P.hideContent(!1),P.setModal(!0),setTimeout(function(){return a.resize()}))}),function(){return F.apply(this,arguments)}),linkRelation:(S=M(function*(){function e(){return(0,d.getLayersDependencyFeatures)(n.parent.layerId,{relations:[n.relation],feature:l,operator:"not",filterType:t?"bbox":"fid"})}var n=this,t=(this.disabled=!0,C.LayerTypes.VECTOR===this._layerType),i=new this._add_link_workflow.link(t?{selectStyle:L[this.getLayer().getGeometryType()]}:{}),a=this._createWorkflowOptions(),r=(0,m.getRelationFieldsFromRelation)({layerId:this._relationLayerId,relation:this.relation}),o=r.ownField,s=r.relationField,l=(a.context.excludeFeatures=s.reduce(function(e,t,i){return e[o[i]]=n.parent.values[t],e},{}),t&&P.setModal(!1),y.Workflow.Stack.getCurrent().getCurrentFeature()),r={promise:void 0,showContent:!1},u=(t?(a.context.beforeRun=M(function*(){yield new Promise(function(e){return setTimeout(e)}),yield e()}),i.bindEscKeyUp(),r={promise:i.start(a),showContent:!0},this.enableDOMElements(!1)):yield e(),!1);try{((yield(0,v.promisify)(r.promise||i.start(a))).features||[]).forEach(function(i){var e;void 0===n.relations.find(function(e){return e.id===i.getId()})?(u=u||!0,e=i.clone(),Object.entries(n.parent.values).forEach(function(e){var e=p(e,2),t=e[0],e=e[1];i.set(o[s.findIndex(function(e){return t===e})],e)}),y.Workflow.Stack.getCurrent().getSession().pushUpdate(n._relationLayerId,i,e),n.relations.push({fields:n.getLayer().getFieldsWithValues(i,{relation:!0}),id:i.getId()})):P.notify.warning(T("editing.relation_already_added"))})}catch(e){a.context.session.rollbackDependecies([this._relationLayerId])}t&&this.enableDOMElements(!0),r.showContent&&(P.closeUserMessage(),i.unbindEscKeyUp()),u&&(0,_.updateParentWorkflows)(),i.stop(),this.disabled=!1}),function(){return S.apply(this,arguments)}),unlinkRelation:(k=function(e){return unlinkRelation({layerId:this.layerId,relation:this.relation,relations:this.relations,index:e,dialog:!(1<arguments.length&&void 0!==arguments[1])||arguments[1]})},Y.toString=function(){return k.toString()},Y),_createWorkflowOptions:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=(0,m.getRelationFieldsFromRelation)({layerId:this._relationLayerId,relation:this.relation}),t=Object.entries(this.parent.values);return{parentFeature:y.Workflow.Stack.getCurrent().getCurrentFeature(),context:{session:y.Workflow.Stack.getCurrent().getSession(),excludeFields:i.ownField,fatherValue:t.map(function(e){e=p(e,2);e[0];return e[1]}),fatherField:t.map(function(e){var t=p(e,1)[0];return i.ownField[i.relationField.findIndex(function(e){return t===e})]})},inputs:{features:e.features||[],layer:this.getLayer()}}}},computed:{relationsLength:function(){return this.relations.length},fieldrequired:function(){var t=this;return(0,m.getRelationFieldsFromRelation)({layerId:this._relationLayerId,relation:this.relation}).ownField.some(function(e){return(0,s.getEditingLayerById)(t._relationLayerId).isFieldRequired(e)})},show_add_link:function(){return 0===this.relations.length||"ONE"!==this.relation.type}},watch:{relations:function(e){0===(1<arguments.length&&void 0!==arguments[1]?arguments[1]:[]).length?this.destroyTable():(this.updateNewRelationId(),this.updateTable())},show_vector_tools:function(e){this.enableDOMElements(!e),this.disabled=e}},beforeCreate:function(){this.delayType="debounce"},created:function(){var n,a=this,e=(0,s.getEditingLayerById)(this.relation.child),t=(this._new_relations_ids=[],this.onCommit=this.onCommit.bind(this),g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").on("commit",this.onCommit),this.isVectorRelation=C.LayerTypes.VECTOR===e.getType(),this.isVectorRelation&&(n=e.getGeometryType(),this.copyFeatureLayers=[].concat(O(x.getLayers({QUERYABLE:!0,GEOLAYER:!0}).filter(function(e){return e.getGeometryType&&e.getGeometryType()&&![a.relation.child,a.relation.father].includes(e.getId())&&(e.getGeometryType()===n||I(e.getGeometryType(),n)&&E.isMultiGeometry(n))}).map(function(e){return{id:e.getId(),name:e.getName(),external:!1}})),O(P.getService("map").getExternalLayers().filter(function(e){var e=e.getSource().getFeatures()||[];return!(!e[0]||!e[0].getGeometry())&&(e=e[0].getGeometry().getType(),n===e||I(n,e)&&(E.isMultiGeometry(n)||!E.isMultiGeometry(e)))}).map(function(e){return{id:e.get("id"),name:e.get("name"),external:!0}}))).sort(function(e,t){return e.name.toLowerCase().localeCompare(t.name.toLowerCase())}),this.addExternalLayerKey=P.getService("catalog").onafter("addExternalLayer",function(e){var t,i=e.layer;"vector"===e.type&&(e=P.getService("map").getExternalLayers().find(function(e){return i.id===e.get("id")}))&&(t=e.getSource().getFeatures()||[])[0]&&t[0].getGeometry()&&(t=t[0].getGeometry().getType(),n!==t&&(!I(n,t)||!E.isMultiGeometry(n)&&E.isMultiGeometry(t))||a.copyFeatureLayers.push({id:e.get("id"),name:e.get("name"),external:!0}))})),this.copylayerid=this.copyFeatureLayers.length?this.copyFeatureLayers[0].id:null,this.loadEventuallyRelationValuesForInputs=!1,y.Workflow.Stack.getCurrent().getLayer()),e=(this.currentRelationFeatureId=null,this._relationLayerId=this.relation.child===this.layerId?this.relation.father:this.relation.child,this._layerType=this.getLayer().getType(),(0,m.getRelationFieldsFromRelation)({layerId:this.layerId,relation:this.relation}).ownField),r=e.find(function(e){return t.isPkField(e)}),i=(this.parent={layerId:this.layerId,editable:e.filter(function(e){return t.isEditingFieldEditable(e)}),pk:r,values:e.reduce(function(e,t){var i=y.Workflow.Stack.getCurrent().getCurrentFeature(),n=y.Workflow.Stack.getCurrent().getInputs().fields;return Object.assign(e,R({},t,t===r&&i.isNew()?i.getId():n?n.find(function(e){return t===e.name}).value:i.get(t)))},{})},this.capabilities=t.getEditingCapabilities(),this.tools=[],this);this._add_link_workflow=(R(e={},C.LayerTypes.TABLE,{link:function(){return new y.Workflow(o({},0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},{type:"edittable",backbuttonlabel:"plugins.editing.form.buttons.save_and_back_table",steps:[new w.OpenTableStep]}))},add:function(){return new y.Workflow(o({},0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},{type:"addtablefeature",steps:[new l.Step({help:"editing.steps.help.new",run:c.addTableFeature}),new w.OpenFormStep]}))}}),R(e,C.LayerTypes.VECTOR,{link:function(){return new y.Workflow({type:"linkrelation",steps:[new l.Step(o({},0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},{help:"editing.steps.help.select_feature_to_relation",run:function(n,a){var t,r=this;return $.Deferred((t=M(function*(t){P.setModal(!1);var e=n.layer.getEditingLayer();r._originalLayerStyle=e.getStyle();try{a.beforeRun&&"function"==typeof a.beforeRun&&(yield(0,v.promisify)(a.beforeRun()));var i=e.getSource().getFeatures();a.excludeFeatures&&(i=i.filter(function(n){return Object.entries(a.excludeFeatures).reduce(function(e,t){var t=p(t,2),i=t[0],t=t[1];return e&&n.get(i)!=t},!0)})),r._stopPromise=$.Deferred(),(0,h.setAndUnsetSelectedFeaturesStyle)({promise:r._stopPromise.promise(),inputs:{layer:n.layer,features:i},style:r.selectStyle}),r.addInteraction(new K({layers:[e],features:i}),{picked:function(e){n.features.push(e.feature),P.setModal(!0),t.resolve(n)}})}catch(e){t.reject(e)}}),function(e){return t.apply(this,arguments)})).promise()},stop:function(){return P.setModal(!0),this._originalLayerStyle=null,this._stopPromise&&this._stopPromise.resolve(!0),!0}}))]})},add:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=new w.AddFeatureStep(o({},e,{steps:{draw:{description:"editing.steps.help.draw_new_feature",done:!1}},tools:["snap","measure"]}));return t.on("stop",function(){t.setUserMessageStepDone("draw"),P.closeUserMessage()}),new y.Workflow(o({},e,{type:"addfeature",steps:[t,new w.OpenFormStep(e)],registerEscKeyEvent:!0}))},selectandcopy:function(){var s=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new y.Workflow({type:"selectandcopyfeaturesfromotherlayer",steps:[new l.Step(o({},s,{help:"editing.steps.help.pick_feature",steps:{select:{description:"editing.workflow.steps.selectPoint",done:!1}},run:function(i,r){var o=this;return s.copyLayer?(0,v.$promisify)(M(function*(){var t,n=[],a=i.layer.getGeometryType(),e=(s.isVector&&(yield new Promise((t=M(function*(t){var i;o.addInteraction(s.external?new g.PickFeaturesInteraction({layer:s.copyLayer}):new Z,{picked:(i=M(function*(e){try{n=(0,u.convertToGeometry)((s.external?e:(yield z.getData("query:coordinates",{inputs:{coordinates:e.coordinate,query_point_tolerance:U.getCurrentProject().getQueryPointTolerance(),layerIds:[s.copyLayer.getId()],multilayers:!1},outputs:null})).data[0]||{features:[]}).features,a)}catch(e){}finally{t()}}),function(e){return i.apply(this,arguments)})})}),function(e){return t.apply(this,arguments)}))),void 0);try{e=1<n.length?yield(0,v.promisify)((0,f.chooseFeatureFromFeatures)({features:n,inputs:i})):n[0]}catch(e){}return e?((e=new G({feature:e,properties:i.layer.getEditingFields().filter(function(e){return!e.pk}).map(function(e){return e.name})})).setTemporaryId(),i.features=[e],i.layer.getEditingLayer().getSource().addFeature(e),r.session.pushAdd(i.layer.getId(),e,!1),i):(P.showUserMessage({type:"warning",message:"plugins.editing.messages.no_feature_selected",closable:!1,autoclose:!0}),Promise.reject())})):$.Deferred(function(e){return e.resolve()}).promise()},stop:function(){i.show_vector_tools=!1,this.setUserMessageStepDone("select"),P.closeUserMessage()}})),new w.OpenFormStep(s)],registerEscKeyEvent:!0})}}),e[this._layerType]),this.relations.forEach(function(e){return a.addTools(e.id)});try{g3wsdk.gui.GUI.getCurrentContent().content.getService().getEventBus().$on("changeinput",this.onInputChange.bind(this))}catch(e){}},activated:(r=M(function*(){if(this.isVectorRelation&&(this.mapExtent=P.getService("map").getMapBBOX()),this.show_vector_tools=!1,!this.loadEventuallyRelationValuesForInputs){this.loading=!0;try{yield g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").runEventHandler({type:"show-relation-editing",id:(0,n.getRelationId)({layerId:this.layerId,relation:this.relation}),component:this})}catch(e){}this.loading=!1,this.loadEventuallyRelationValuesForInputs=!0}this.active=!0,yield this.$nextTick(),!this.relationsTable&&0<this.relations.length&&this._createDataTable(),this.resize()}),function(){return r.apply(this,arguments)}),deactivated:function(){this.destroyTable(),this.active=!1},beforeDestroy:function(){this.loadEventuallyRelationValuesForInputs=!0,g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").off("commit",this.onCommit),this.isVectorRelation&&null!==this.currentRelationFeatureId&&(P.getService("map").zoomToExtent(this.mapExtent),this.mapExtent=null),this.addExternalLayerKey&&(P.getService("catalog").un("addExternalLayer",this.addExternalLayerKey),this.addExternalLayerKey=null)}},t.exports.__esModule&&(t.exports=t.exports.default);var A="function"==typeof t.exports?t.exports.options:t.exports;A.render=function(){var n=this,e=n.$createElement,a=n._self._c||e;return a("div",{directives:[{name:"disabled",rawName:"v-disabled",value:n.loading,expression:"loading"}],staticStyle:{"margin-bottom":"5px"}},[a("bar-loader",{attrs:{loading:n.loading}}),n._v(" "),a("div",{ref:"relation_header_title",staticClass:"relation_header_title box-header with-border skin-color"},[a("span",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.edit_relation",expression:"'editing.edit_relation'"}]}),n._v(" "),a("span",{staticStyle:{"margin-left":"2px"}},[n._v(": "+n._s(n.relation.name.toUpperCase()))])]),n._v(" "),a("div",{ref:"relation_header_tools",staticClass:"relation_header_tools box-header with-border"},[a("div",{attrs:{id:"search-box"}},[n.relationsLength?a("input",{staticClass:"form-control",attrs:{type:"text",id:"filterRelation",placeholder:n.placeholdersearch}}):n._e()]),n._v(" "),a("div",{staticClass:"g3w-editing-relations-add-link-tools"},[n.capabilities.includes("change_attr_feature")?a("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:bottom.create",value:"plugins.editing.form.relations.tooltips.link_relation",expression:"'plugins.editing.form.relations.tooltips.link_relation'",arg:"bottom",modifiers:{create:!0}}],staticClass:"g3w-icon add-link",class:[{disabled:!n.show_add_link},n.g3wtemplate.font.link],attrs:{align:"center"},on:{click:function(e){e.stopPropagation(),n.show_add_link&&n.linkRelation()}}}):n._e(),n._v(" "),n.capabilities.includes("add_feature")?a("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:bottom.create",value:"plugins.editing.form.relations.tooltips.add_relation",expression:"'plugins.editing.form.relations.tooltips.add_relation'",arg:"bottom",modifiers:{create:!0}}],staticClass:"g3w-icon add-link pull-right",class:[{disabled:!n.show_add_link},n.g3wtemplate.font.plus],on:{click:function(e){n.show_add_link&&n.addRelationAndLink()}}}):n._e()])]),n._v(" "),n.show_vector_tools?a("section",{ref:"relation_vector_tools",staticClass:"relation_vector_tools"},[a("span",{staticClass:"close_vector_relation_tool",on:{click:function(e){return e.stopPropagation(),n.closeVectorTools(e)}}},[a("i",{staticClass:"g3w-icon skin-color",class:n.g3wtemplate.font.close})]),n._v(" "),a("div",[a("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.relation.draw_new_feature",expression:"'editing.relation.draw_new_feature'"}],staticClass:"g3w-editing-new-relation-vector-type"}),n._v(" "),a("button",{staticClass:"btn skin-button",staticStyle:{width:"100%"},on:{click:function(e){return e.stopPropagation(),n.addVectorRelation(e)}}},[a("i",{class:n.g3wtemplate.font.pencil})])]),n._v(" "),a("section",[a("span",{staticClass:"divider"}),n._v(" "),a("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.relation.draw_or_copy",expression:"'editing.relation.draw_or_copy'"}],staticStyle:{"align-self":"center"}}),n._v(" "),a("span",{staticClass:"divider"}),n._v(" "),a("div",{attrs:{id:"g3w-select-editable-layers-content"}},[a("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.relation.copy_feature_from_other_layer",expression:"'editing.relation.copy_feature_from_other_layer'"}],staticClass:"g3w-editing-new-relation-vector-type"}),n._v(" "),a("select",{directives:[{name:"select2",rawName:"v-select2",value:"copylayerid",expression:"'copylayerid'"}],attrs:{id:"g3w-select-editable-layers-to-copy"}},n._l(n.copyFeatureLayers,function(e){return a("option",{key:e.id,domProps:{value:e.id}},[n._v(n._s(e.name))])}),0),n._v(" "),a("button",{directives:[{name:"disabled",rawName:"v-disabled",value:0===n.copyFeatureLayers.length,expression:"0 === copyFeatureLayers.length"}],staticClass:"btn skin-button",on:{click:function(e){return e.stopPropagation(),n.copyFeatureFromOtherLayer(e)}}},[a("i",{class:n.g3wtemplate.font.clipboard})])])])]):n._e(),n._v(" "),a("div",{directives:[{name:"disabled",rawName:"v-disabled",value:n.disabled,expression:"disabled"}],ref:"relation_body",staticClass:"relation_body box-body"},[0<n.relationsLength&&!n.update?a("table",{ref:"relationTable",staticClass:"table g3wform-relation-table table-striped"},[a("thead",[a("tr",[a("th",{directives:[{name:"t",rawName:"v-t",value:"tools",expression:"'tools'"}]}),n._v(" "),a("th"),n._v(" "),n._l(n.relationAttributesSubset(n.relations[0]),function(e){return a("th",[n._v(n._s(e.label))])})],2)]),n._v(" "),a("tbody",n._l(n.relations,function(t,i){return a("tr",{key:t.id,staticClass:"featurebox-header"},[a("td",[a("div",{staticStyle:{display:"flex"}},n._l(n.tools[i]||n.addTools(n.relations[i].id),function(t){var e;return a("div",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:top.create",value:"plugins."+t.state.name,expression:"`plugins.${tool.state.name}`",arg:"top",modifiers:{create:!0}}],key:t.state.id,class:((e={enabled:!0,toggled:t.state.active})["editbtn "+t.state.id]=!0,e),on:{click:function(e){return e.stopPropagation(),n.startTool(t,i)}}},[a("img",{attrs:{height:"20px",width:"20px",src:n.resourcesurl+"images/"+t.state.icon}})])}),0)]),n._v(" "),a("td",{staticClass:"action-cell"},[!n.fieldrequired&&n.capabilities.includes("change_attr_feature")?a("div",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:"plugins.editing.form.relations.tooltips.unlink_relation",expression:"'plugins.editing.form.relations.tooltips.unlink_relation'",arg:"right",modifiers:{create:!0}}],staticClass:"g3w-mini-relation-icon g3w-icon",class:n.g3wtemplate.font.unlink,attrs:{"aria-hidden":"true"},on:{click:function(e){return e.stopPropagation(),n.unlinkRelation(i)}}}):n._e()]),n._v(" "),n._l(n.relationAttributesSubset(t),function(e){return a("td",[n.isMedia(e.value)&&n.getValue(e.value)?a("div",{staticClass:"preview"},[a("a",{attrs:{href:n.getValue(e.value),target:"_blank"}},[a("div",{staticClass:"previewtype",class:n.getMediaType(e.value.mime_type).type},[a("i",{staticClass:"fa-2x",class:n.g3wtemplate.font[n.getMediaType(e.value.mime_type).type]})])]),n._v(" "),a("div",{staticClass:"filename"},[n._v(n._s(n.getValue(e.value).split("/").pop()))])]):["photo","link"].includes(n.getFieldType(e))?a("a",{attrs:{href:n.getValue(e.value),target:"_blank"}},[n._v(n._s(n.getValue(e.value))+"\n              ")]):a("span",[n._v(n._s(n.getValue(n.getRelationFeatureValue(t.id,e.name))))])])})],2)}),0)]):n._e()])],1)},A.staticRenderFns=[],A._scopeId="data-v-112912af"},{"../eventbus":11,"../g3wsdk/workflow/step":14,"../g3wsdk/workflow/workflow":15,"../interactions/pickfeaturesinteraction":26,"../utils/addTableFeature":30,"../utils/chooseFeatureFromFeatures":34,"../utils/convertToGeometry":36,"../utils/getEditingLayerById":41,"../utils/getFeatureTableFieldValue":42,"../utils/getLayersDependencyFeatures":44,"../utils/getRelationFieldsFromRelation":49,"../utils/getRelationId":50,"../utils/promisify":57,"../utils/setAndUnsetSelectedFeaturesStyle":58,"../utils/updateParentWorkflows":62,"../workflows":63,"vueify/lib/insert-css":1}],7:[function(e,t,i){var n,r,o,s,l,u,a,d,c,f,g,p,y,h,v,m;e("vueify/lib/insert-css").insert(".g3w-editing-table table.dataTable tbody td{padding:3px 5px}\n.editing_table_title[data-v-13f4ce0f]{margin-top:0;margin-bottom:2px;font-size:1.5em;font-weight:700;color:var(--skin-color)}#table-editing-tools[data-v-13f4ce0f]{display:flex;justify-content:space-between}#table-editing-tools i[data-v-13f4ce0f]{margin:5px}#buttons button.btn[data-v-13f4ce0f]{font-weight:700!important;min-width:80px}.table_editing_footer_buttons[data-v-13f4ce0f]{position:absolute;bottom:10px;width:100%;display:flex;justify-content:center}.editing_table_header_content[data-v-13f4ce0f]{display:flex;justify-content:space-between;align-items:baseline}.editing_table_relation_messagge[data-v-13f4ce0f]{margin-bottom:10px;font-size:1.3em;background-color:#f5f5f5;padding:3px;border-radius:3px;font-weight:700}");function _(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,i){try{var n=s[e](i),a=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});r(a)}("next")})}}Object.defineProperty(i,"__esModule",{value:!0}),n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var i=t,n=[],a=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!i||n.length!==i);a=!0);}catch(e){t=!0,r=e}finally{try{!a&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},o=e("../g3wsdk/workflow/step"),s=e("../g3wsdk/workflow/workflow"),l=e("../workflows"),u=e("../utils/cloneFeature"),a=e("../utils/getRelationsInEditing"),d=e("../utils/getFeatureTableFieldValue"),c=e("../utils/addTableFeature"),h=g3wsdk.core.i18n.tPlugin,v=g3wsdk.gui.GUI,e=g3wsdk.gui.vue.Mixins.resizeMixin,m=g3wsdk.gui.vue.Fields.media_field,Object.entries({Workflow:s.Workflow,OpenFormStep:l.OpenFormStep}).forEach(function(e){e=r(e,2);e[0],e[1]}),i.default={name:"Table",mixins:[e],components:{"g3w-media":m},data:function(){return{dataTable:null,show:!0,state:this.$options.service.state}},methods:{showTool:function(t){return void 0!==this.state.capabilities.find(function(e){return e===t})},resize:(y=_(function*(){"none"!==this.$el.style.display&&(yield this.$nextTick(),$("#editing_table  div.dataTables_scrollBody").height($(".content").height()-$(".close-panel-block").outerHeight()-$("#editing_table  div.dataTables_scrollHeadInner").outerHeight()-$(".editing_table_title").outerHeight()-$(".editing_table_header").outerHeight()-$(".editing_table_relation_messagge").outerHeight()-$(".dataTables_length").outerHeight()-$(".dataTables_paginate.paging_simple_numbers").outerHeight()-$(".dataTables_info").outerHeight()-$(".dataTables_filter").outerHeight()-$(".table_editing_footer_buttons").outerHeight()-$("#editing_table .dataTables_paginate.paging_simple_numbers").outerHeight()),this.dataTable)&&this.dataTable.columns.adjust()}),function(){return y.apply(this,arguments)}),showValue:function(t){return!!this.state.headers.find(function(e){return e.name===t})},isMediaField:function(e){for(var t=!1,i=0;i<this.state.headers.length;i++){var n=this.state.headers[i];if(e===n.name&&"media"===n.input.type){t=!0;break}}return t},stop:function(){this.state.promise.reject()},save:function(){var t=this;this.state.isrelation?this.state.promise.resolve({features:(this._linkFeatures||[]).map(function(e){return t.state.features[e]})}):this.state.promise.resolve()},cancel:function(){this.state.promise.reject()},deleteFeature:(p=_(function*(o){var s=this,e=$("#editing_table table tr#"+o),t=this.state.inputs.layer,i=t.getId(),n=t.getChildren().length&&0<(0,a.getRelationsInEditing)({layerId:i,relations:t.getRelations().getArray()}).length;try{yield new Promise(function(a,r){v.dialog.confirm("<h4>"+h("editing.messages.delete_feature")+'</h4>\n              <div style="font-size:1.2em;">'+(n?h("editing.messages.delete_feature_relations"):"")+"</div>",function(e){var t,i,n;(e?(e=s.state.features.findIndex(function(e){return e.getUid()===o}),t=s.state.features[e],i=s.state.context.session,n=s.state.inputs.layer.getId(),s.state.inputs.layer.getEditingSource().removeFeature(t),i.pushDelete(n,t),s.state.rows.splice(e,1),a):r)()})}),this.dataTable.row(e).remove().draw(),yield this.$nextTick()}catch(e){}}),function(e){return p.apply(this,arguments)}),copyFeature:(g=_(function*(n){var a=this;yield new Promise(function(t,e){var i=(0,u.cloneFeature)(a.state.features.find(function(e){return n===e.getUid()}),a.state.inputs.layer.getEditingLayer());a.state.workflow=new s.Workflow({type:"addtablefeature",steps:[new o.Step({help:"editing.steps.help.new",run:c.addTableFeature}),new l.OpenFormStep]}),a.state.inputs.features.push(i),a.state.workflow.start({context:a.state.context,inputs:a.state.inputs}).then(function(e){var i=e.features[e.features.length-1],n={};Object.entries(a.state.rows[0]).forEach(function(e){var e=r(e,2),t=e[0];e[1];n[t]=(0,d.getFeatureTableFieldValue)({layerId:a.state.layerId,feature:i,property:t})}),n.__gis3w_feature_uid=i.getUid(),a.state.rows.push(n),t(n)}).fail(e).always(function(){a.state.workflow.stop()})}),this.show=!1,this.dataTable.destroy(),yield this.$nextTick(),this.show=!0,yield this.$nextTick(),this.setDataTable()}),function(e){return g.apply(this,arguments)}),editFeature:function(t){var n=this,a=this.state.features.findIndex(function(e){return t===e.getUid()}),e=this.state.features[a],i=(this.state.workflow=new s.Workflow({type:"edittablefeature",steps:[new l.OpenFormStep]}),this.state.inputs);i.features.push(e),this.state.workflow.start({context:this.state.context,inputs:i}).then(function(e){var i=e.features[e.features.length-1];Object.entries(n.state.rows[a]).forEach(function(e){var e=r(e,2),t=e[0];e[1];n.state.rows[a][t]=(0,d.getFeatureTableFieldValue)({layerId:n.state.layerId,feature:i,property:t})})}).fail(console.warn).always(function(){return n.state.workflow.stop()})},linkFeature:function(t,e){e.target.checked?this._linkFeatures.push(t):this._linkFeatures=this._linkFeatures.filter(function(e){return e!==t})},getValue:function(e){return e&&"object"===(void 0===e?"undefined":n(e))&&Object===e.constructor?e=e.value:"string"==typeof e&&0===e.indexOf("_new_")&&(e=null),e},setDataTable:function(){this.dataTable=$("#editing_table table").DataTable({columnDefs:[{orderable:!1,targets:0}],order:[1,"asc"],pageLength:10,scrollCollapse:!0,scrollResize:!0,scrollX:!0}),this.resize()}},beforeCreate:function(){this.delayType="debounce",v.disableSideBar(!0),v.showUserMessage({type:"loading",message:"plugins.editing.messages.loading_table_data",autoclose:!1,closable:!1})},mounted:(f=_(function*(){yield this.$nextTick(),this.state.isrelation&&(this._linkFeatures=[]),this.setDataTable(),this.resize(),setTimeout(function(){return v.closeUserMessage()},300)}),function(){return f.apply(this,arguments)}),beforeDestroy:function(){this.cancel(),this._linkFeatures=null,this.dataTable.destroy()}},t.exports.__esModule&&(t.exports=t.exports.default);i="function"==typeof t.exports?t.exports.options:t.exports;i.render=function(){var n=this,e=n.$createElement,a=n._self._c||e;return a("div",{staticClass:"g3w-editing-table",attrs:{id:"editing_table"}},[a("div",{ref:"editing_table_header",staticClass:"editing_table_header"},[a("div",{staticClass:"editing_table_header_content"},[a("h3",{staticClass:"editing_table_title"},[n._v(n._s(n.state.title))])]),n._v(" "),n.state.isrelation?a("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.relation.table.info",expression:"'editing.relation.table.info'"}],staticClass:"editing_table_relation_messagge"}):n._e()]),n._v(" "),n.show?a("table",{staticClass:"display",staticStyle:{width:"100%"}},[a("thead",[a("tr",[n.state.isrelation?n._e():a("th",{staticStyle:{"max-width":"60px"}}),n._v(" "),n.state.isrelation?a("th"):n._e(),n._v(" "),n._l(n.state.headers,function(e){return a("th",[n._v(n._s(e.label))])})],2)]),n._v(" "),a("tbody",n._l(n.state.rows,function(t,i){return a("tr",{key:t.__gis3w_feature_uid,attrs:{id:t.__gis3w_feature_uid}},[n.state.isrelation?n._e():a("td",[a("div",{attrs:{id:"table-editing-tools"}},[a("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:"plugins.editing.table.edit",expression:"'plugins.editing.table.edit'",arg:"right",modifiers:{create:!0}}]},[n.showTool("change_attr_feature")?a("i",{staticClass:"g3w-icon",class:n.g3wtemplate.font.pencil,staticStyle:{color:"#30cce7"},attrs:{"aria-hidden":"true"},on:{click:function(e){return e.stopPropagation(),n.editFeature(t.__gis3w_feature_uid)}}}):n._e()]),n._v(" "),a("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:"plugins.editing.table.copy",expression:"'plugins.editing.table.copy'",arg:"right",modifiers:{create:!0}}]},[n.showTool("add_feature")?a("i",{staticClass:"g3w-icon",class:n.g3wtemplate.font["copy-paste"],staticStyle:{color:"#d98b14",padding:"5px 7px 5px 7px"},attrs:{"aria-hidden":"true"},on:{click:function(e){return e.stopPropagation(),n.copyFeature(t.__gis3w_feature_uid)}}}):n._e()]),n._v(" "),a("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:"plugins.editing.table.delete",expression:"'plugins.editing.table.delete'",arg:"right",modifiers:{create:!0}}]},[n.showTool("delete_feature")?a("i",{staticClass:"g3w-icon",class:n.g3wtemplate.font["trash-o"],staticStyle:{color:"red"},attrs:{"aria-hidden":"true"},on:{click:function(e){return e.stopPropagation(),n.deleteFeature(t.__gis3w_feature_uid)}}}):n._e()])])]),n._v(" "),n.state.isrelation?a("td",[a("input",{staticClass:"magic-checkbox",attrs:{id:"relation__"+i,type:"checkbox"},on:{change:function(e){return n.linkFeature(i,e)}}}),n._v(" "),a("label",{attrs:{for:"relation__"+i}})]):n._e(),n._v(" "),n._l(t,function(e,t){return n.showValue(t)?a("td",{key:t},[n.getValue(e)&&n.isMediaField(t)?a("g3w-media",{attrs:{state:e}}):a("p",[n._v(n._s(n.getValue(e)))])],1):n._e()})],2)}),0)]):n._e(),n._v(" "),a("div",{ref:"table_editing_footer_buttons",staticClass:"table_editing_footer_buttons",attrs:{id:"buttons"}},[a("button",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:n.state.isrelation?"editing.form.buttons.save_and_back":"editing.form.buttons.save",expression:"state.isrelation ? 'editing.form.buttons.save_and_back' : 'editing.form.buttons.save'"}],staticClass:"btn btn-success",staticStyle:{"margin-right":"10px"},on:{click:function(e){return e.stopPropagation(),n.save(e)}}}),n._v(" "),a("button",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.form.buttons.cancel",expression:"'editing.form.buttons.cancel'"}],staticClass:"btn btn-danger",on:{click:function(e){return e.stopPropagation(),n.cancel(e)}}})])])},i.staticRenderFns=[],i._scopeId="data-v-13f4ce0f"},{"../g3wsdk/workflow/step":14,"../g3wsdk/workflow/workflow":15,"../utils/addTableFeature":30,"../utils/cloneFeature":35,"../utils/getFeatureTableFieldValue":42,"../utils/getRelationsInEditing":51,"../workflows":63,"vueify/lib/insert-css":1}],8:[function(e,t,i){var n,a,o,s,r,l;e("vueify/lib/insert-css").insert(".panel.mobile[data-v-c4a84298]{margin-bottom:5px}.panel.mobile .panel-heading[data-v-c4a84298]{display:flex;justify-content:space-between}.panel.mobile .panel-heading .panel-title[data-v-c4a84298]{margin-top:auto;margin-bottom:auto}.panel.mobile .panel-heading .start-editing[data-v-c4a84298]{margin:auto;margin-right:0;padding:6px}.panel.mobile .tools-content .editbtn[data-v-c4a84298]{padding:9px}.panel.mobile .toolbox .panel-body[data-v-c4a84298]{padding:5px!important}.toolbox_help_message[data-v-c4a84298]{font-weight:lighter}.toolbox[data-v-c4a84298]{padding-bottom:5px}.panel[data-v-c4a84298]{border:0!important;margin-bottom:8px}.panel-heading[data-v-c4a84298]{padding:5px 10px;width:100%}.toolboxselected[data-v-c4a84298]{box-shadow:0 0 0 3px var(--skin-color)}.panel:not(.toolboxselected) .info[data-v-c4a84298]{opacity:.4}.panel:not(.toolboxactive) .panel-heading[data-v-c4a84298]{border-radius:3px;filter:grayscale(.8)}.panel:not(.geolayer) .panel-body[data-v-c4a84298]{padding-top:0}.panel.toolboxactive:not(.geolayer) .editbtn.start-editing[data-v-c4a84298]{color:#fff!important}.panel:not(.geolayer) .panel-heading[data-v-c4a84298]{color:#3a4448}.editbtn.start-editing[data-v-c4a84298]{padding:13px;color:currentColor!important;font-size:1.1em;margin:0}.panel-title[data-v-c4a84298]{font-weight:700;word-break:break-word;padding:8px 0;display:inline-block}#toolsoftoolcontainer[data-v-c4a84298]{display:flex;flex-direction:column;margin:5px;padding:5px;border-radius:5px}.info[data-v-c4a84298]{color:#000}.info>i[data-v-c4a84298]{color:#007bff;padding-right:2px}.info+.tools-content[data-v-c4a84298]{margin-top:1em}.filter-by-relation[data-v-c4a84298]{margin-right:5px;cursor:pointer;color:currentColor!important}.tools-content[data-v-c4a84298]{display:flex;flex-wrap:wrap;gap:10px}.message[data-v-c4a84298]{margin-bottom:5px;font-size:1.1em;color:#000;margin-top:5px}.snap-tool[data-v-c4a84298]{display:flex}.snap-tool label>b[data-v-c4a84298]{color:#222d32!important}.tools-of-tool-snap[data-v-c4a84298]{display:flex;width:100%;justify-content:space-between}.tools-of-tool-snap label span[data-v-c4a84298]{color:#222d32!important}.panel-body.disabled[data-v-c4a84298]{opacity:.7}.panel-body.disabled>[data-v-c4a84298]{pointer-events:none}");function u(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,i){try{var n=s[e](i),a=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});r(a)}("next")})}}Object.defineProperty(i,"__esModule",{value:!0}),o=g3wsdk.gui.GUI,s=g3wsdk.core.layer.Layer,r=g3wsdk.ol.utils.getResolutionFromScale,l=void 0,i.default={name:"Toolbox",props:["state","resourcesurl"],data:function(){return{active:!1,helpmessage:null,toggled:{relation:!1,layer:!1},snapAll:!1}},computed:{editDisabled:function(){return this.state.loading&&!this.state.startstopediting},hasRelations:function(){return 0<this.state.editing.dependencies.length},loading:function(){return this.state.loading||this.state.changingtools},canEdit:function(){return this.state.editing.canEdit},father:function(){return this.state.editing.father&&!!this.state.editing.dependencies.length},showtoolsoftool:function(){return 0<this.state.toolsoftool.length},isLayerReady:function(){return this.state.layer.state.editing.ready},toolboxCursor:function(){return this.isLayerReady&&this.canEdit?void 0:"url("+this.resourcesurl+"cursors/mZoomIn.svg), zoom-in"}},methods:{select:function(){this.isLayerReady&&!this.state.selected&&this.$emit("setselectedtoolbox",this.state.id)},fitZoomToScale:function(e){var t;this.state.selected&&!this.canEdit&&(t=o.getService("map")).goToRes(t.getCenter(),r(this.state._constraints.scale,o.getService("map").getMapUnits()))},toggleEditing:function(){this.select(),this.toggled.layer=!(this.state.editing.on||this.toggled.layer),this.toggled.layer&&this.state.layer.state.editing.ready&&!this.state.loading&&this.$emit(this.state.editing.on?"stoptoolbox":"starttoolbox",this.state.id),this.toggled.layer||this.$emit("stoptoolbox",this.state.id)},toggleTool:function(e){void 0===e?this.$emit("stopactivetool",this.state.id):this.$emit("setactivetool",e,this.state.id),this.select()},toggleFilterByRelation:function(){this.toggled.relation=!this.toggled.relation,this.$emit("update-filter-layers",this.toggled.relation?[this.state.id].concat(function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(this.state.editing.dependencies)):[])},_initSnap:function(){var a=this,r=(this.state.toolsoftool||[]).find(function(e){return"snap"===e.type});r&&(this.snapFeatures=new ol.Collection,this.snapEvents=[],this.snapToolboxes=[],this.snapUnwatches=[],this.$watch(function(){return r.options.checked},function(){return a.activeSnapInteraction()}),this.$watch(function(){return r.options.checkedAll},function(){return a.activeSnapInteraction()}),this.$watch(function(){return r.options.active},function(){r.options.active?a.activeSnapInteraction():l&&o.getService("map").removeInteraction(l)}),g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").getLayers().filter(function(e){return s.LayerTypes.VECTOR===e.getType()}).forEach(function(e){var t,i=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").getToolBoxById(e.getId()),n=i.getLayer().getEditingSource();a.snapFeatures.extend(n.readFeatures()),a.snapEvents.push({source:n,olKey:n.getFeaturesCollection().on("add",function(e){return a.addSnapFeatures([e.element])}),settersAndKeys:{addFeatures:n.onbefore("addFeatures",a.addSnapFeatures),addFeature:n.onbefore("addFeature",a.addSnapFeatures),clear:n.onbefore("clear",function(){n.readFeatures().forEach(function(e){return a.snapFeatures.remove(e)})})}}),r.options.layerId!==e.getId()&&(t=i.getState().editing,a.snapUnwatches.push(a.$watch(function(){return t.on},a.setShowSnapAll)),a.snapToolboxes.push(t))}),this.setShowSnapAll())},_unloadSnap:function(){if(l)try{this.snapEvents.forEach(function(t){Object.keys(t.settersAndKeys).forEach(function(e){t.source.un(e,t.settersAndKeys[e])}),ol.Observable.unByKey(t.olKey)}),this.snapUnwatches.forEach(function(e){return e()}),l=null,this.snapUnwatches=null,this.snapToolboxes=null,this.snapEvents=null}catch(e){}},addSnapFeatures:function(e){this.snapFeatures.extend(e)},setShowSnapAll:function(){var e=(this.state.toolsoftool||[]).find(function(e){return"snap"===e.type});e&&(this.snapAll=!!this.snapToolboxes.find(function(e){return e.on}),e.options.checkedAll=!!e.options.showSnapAll&&e.options.checkedAll)},activeSnapInteraction:function(){var e=o.getService("map"),t=(this.state.toolsoftool||[]).find(function(e){return"snap"===e.type});l&&e.removeInteraction(l),l=null,(t.options.checked||t.options.checkedAll)&&t.options.active&&(l=new ol.interaction.Snap({source:!t.options.checkedAll&&t.options.checked&&t.options.source,features:t.options.checkedAll&&this.snapFeatures}),e.addInteraction(l))}},watch:{"state.activetool":(a=u(function*(e){yield this.$nextTick(),this.helpmessage=e&&(e.messages.help||e.name)}),function(e){return a.apply(this,arguments)}),"state.editing.on":function(e){this.$emit("on-editing",e)},"state.toolsoftool":function(e,t){e.length?this._initSnap():(t.filter(function(e){return"measure"===e.type}).forEach(function(e){return e.options.onChange(!1)}),this._unloadSnap())}},created:function(){this.$emit("canEdit",{id:this.state.id})},mounted:(n=u(function*(){yield this.$nextTick()}),function(){return n.apply(this,arguments)}),beforeDestroy:function(){this._unloadSnap()}},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var r=this,e=r.$createElement,i=r._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:r.state.show,expression:"state.show"}],staticClass:"toolbox",attrs:{id:"id_toolbox_"+r.state.id}},[i("div",{staticClass:"panel",class:{mobile:r.isMobile(),toolboxselected:r.state.selected,toolboxactive:r.state.editing.on&&r.canEdit,geolayer:r.state.layer.isGeoLayer()},on:{click:function(e){return e.stopPropagation(),r.select(e)}}},[i("div",{directives:[{name:"show",rawName:"v-show",value:!r.isLayerReady,expression:"!isLayerReady"}],staticClass:"bar-loader"}),r._v(" "),r.state.toolboxheader?i("div",{staticClass:"panel-heading container",style:{background:r.state.color}},[r.father?i("i",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:"plugins.editing.tooltip.filter_by_relation",expression:"'plugins.editing.tooltip.filter_by_relation'",arg:"right",modifiers:{create:!0}}],class:"filter-by-relation "+r.g3wtemplate.font.relation,on:{click:r.toggleFilterByRelation}}):r._e(),r._v(" "),i("span",{staticClass:"panel-title"},[r._v(r._s(r.state.title))]),r._v(" "),i("i",{directives:[{name:"disabled",rawName:"v-disabled",value:r.editDisabled,expression:"editDisabled"},{name:"t-tooltip",rawName:"v-t-tooltip:left.create",value:"plugins.editing.tooltip.edit_layer",expression:"'plugins.editing.tooltip.edit_layer'",arg:"left",modifiers:{create:!0}}],staticClass:"start-editing editbtn skin-tooltip-left",class:((e={"pull-right":!r.isMobile(),enabled:r.isLayerReady,"g3w-icon-toggled":r.state.editing.on})[r.g3wtemplate.font[r.state.editing.on||r.toggled.layer?"checkmark":"pencil"]]=!0,e),on:{click:function(e){return e.stopPropagation(),r.toggleEditing(e)}}})]):r._e(),r._v(" "),i("bar-loader",{attrs:{loading:r.loading}}),r._v(" "),r.state.changingtools||!r.state.editing.on&&!r.toggled.layer?r._e():i("div",{class:{"panel-body":!0,disabled:!r.isLayerReady||!r.canEdit},style:{cursor:r.toolboxCursor},on:{click:r.fitZoomToScale}},[r.state.layer.isGeoLayer()?r._e():i("div",{staticClass:"info"},[i("i",{class:r.g3wtemplate.font.info}),r._v(" "),i("span",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.messages.toolbox_has_no_geometry",expression:"'editing.messages.toolbox_has_no_geometry'"}]}),r._v(" "),i("divider")],1),r._v(" "),r.hasRelations?i("div",{staticClass:"info"},[i("i",{class:r.g3wtemplate.font.info}),r._v(" "),i("span",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.messages.toolbox_has_relation",expression:"'editing.messages.toolbox_has_relation'"}]}),r._v(" "),i("divider")],1):r._e(),r._v(" "),r.state.message?i("div",{staticStyle:{color:"#000"}},[i("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:r.state.message,expression:"state.message"}],staticClass:"text-justify"}),r._v(" "),i("divider")],1):r._e(),r._v(" "),i("div",{staticClass:"tools-content"},r._l(r.state.tools,function(t){var e;return t.visible?i("div",{key:t.id,class:((e={enabled:t.enabled,toggled:t.active})["editbtn "+t.id]=!0,e),on:{click:function(e){e.preventDefault(),e.stopPropagation(),t.enabled&&r.toggleTool(t.active?void 0:t.id)}}},[i("img",{directives:[{name:"t-title",rawName:"v-t-title:plugin",value:""+t.name,expression:"`${tool.name}`",arg:"plugin"}],attrs:{height:"25",width:"25",src:r.resourcesurl+"images/"+t.icon}})]):r._e()}),0),r._v(" "),i("div",{staticClass:"message",attrs:{id:"id_toolbox_messages_"+r.state.id}},[i("transition",{attrs:{name:"fade"}},[r.showtoolsoftool?i("div",{attrs:{id:"toolsoftoolcontainer"}},[r._l(r.state.toolsoftool,function(a){return["measure"===a.type?i("div",{staticClass:"snap-tool"},[i("input",{directives:[{name:"model",rawName:"v-model",value:a.options.checked,expression:"tool.options.checked"}],staticClass:"magic-checkbox snap_tools_of_tools",attrs:{id:"g3w_editing_show_measure_tool",type:"checkbox"},domProps:{checked:Array.isArray(a.options.checked)?-1<r._i(a.options.checked,null):a.options.checked},on:{change:[function(e){var t,i=a.options.checked,e=e.target,n=!!e.checked;Array.isArray(i)?(t=r._i(i,null),e.checked?t<0&&r.$set(a.options,"checked",i.concat([null])):-1<t&&r.$set(a.options,"checked",i.slice(0,t).concat(i.slice(t+1)))):r.$set(a.options,"checked",n)},function(){return a.options.onChange(a.options.checked)}]}}),r._v(" "),i("label",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:"plugins.editing.toolsoftool.measure",expression:"'plugins.editing.toolsoftool.measure'",arg:"right",modifiers:{create:!0}}],attrs:{for:"g3w_editing_show_measure_tool"}},[i("b",{class:r.g3wtemplate.font.measure})])]):"snap"===a.type?i("div",{staticClass:"tools-of-tool-snap"},[i("input",{directives:[{name:"model",rawName:"v-model",value:a.options.checked,expression:"tool.options.checked"}],staticClass:"magic-checkbox snap_tools_of_tools",attrs:{type:"checkbox",id:"snap_"+r.state.id},domProps:{checked:Array.isArray(a.options.checked)?-1<r._i(a.options.checked,null):a.options.checked},on:{change:function(e){var t,i=a.options.checked,e=e.target,n=!!e.checked;Array.isArray(i)?(t=r._i(i,null),e.checked?t<0&&r.$set(a.options,"checked",i.concat([null])):-1<t&&r.$set(a.options,"checked",i.slice(0,t).concat(i.slice(t+1)))):r.$set(a.options,"checked",n)}}}),r._v(" "),i("label",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:"plugins.editing.toolsoftool.snap",expression:" 'plugins.editing.toolsoftool.snap'",arg:"right",modifiers:{create:!0}}],attrs:{for:"snap_"+r.state.id}},[i("span",{class:r.g3wtemplate.font.magnete})]),r._v(" "),r.snapAll?i("input",{directives:[{name:"model",rawName:"v-model",value:a.options.checkedAll,expression:"tool.options.checkedAll"}],staticClass:"magic-checkbox snap_tools_of_tools",attrs:{type:"checkbox",id:"snap_all_"+r.state.id},domProps:{checked:Array.isArray(a.options.checkedAll)?-1<r._i(a.options.checkedAll,null):a.options.checkedAll},on:{change:function(e){var t,i=a.options.checkedAll,e=e.target,n=!!e.checked;Array.isArray(i)?(t=r._i(i,null),e.checked?t<0&&r.$set(a.options,"checkedAll",i.concat([null])):-1<t&&r.$set(a.options,"checkedAll",i.slice(0,t).concat(i.slice(t+1)))):r.$set(a.options,"checkedAll",n)}}}):r._e(),r._v(" "),r.snapAll?i("label",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:left.create",value:"plugins.editing.toolsoftool.snapall",expression:"'plugins.editing.toolsoftool.snapall'",arg:"left",modifiers:{create:!0}}],attrs:{for:"snap_all_"+r.state.id}},[i("span",{class:r.g3wtemplate.font.magnete}),r._v(" "),i("b",{class:r.g3wtemplate.font.layers})]):r._e()]):r._e(),r._v(" "),i("divider")]})],2):r._e()]),r._v(" "),r.helpmessage?i("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:r.helpmessage,expression:"helpmessage"}],staticClass:"toolbox_help_message"}):r._e()],1)])],1)])},e.staticRenderFns=[],e._scopeId="data-v-c4a84298"},{"vueify/lib/insert-css":1}],9:[function(e,t,i){e("vueify/lib/insert-css").insert(".steps-list[data-v-8a452b86]{align-self:flex-start;list-style:none;padding:10px;margin-bottom:0}li[data-v-8a452b86]{margin-bottom:5px}li.done[data-v-8a452b86]{font-weight:700;color:green}li.done>.description[data-v-8a452b86]{font-weight:700}.dynamic-step[data-v-8a452b86]{padding:10px;font-size:1.2em}.button-step[data-v-8a452b86]{display:inline-flex;align-items:center}.button-step[data-v-8a452b86],button.btn-success[data-v-8a452b86]{font-weight:700;align-self:normal}");Object.defineProperty(i,"__esModule",{value:!0}),i.default={data:function(){return{steps:{}}},methods:{completeStep:function(e){e.done=!0,e.buttonnext.done()}}},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var i=this,e=i.$createElement,n=i._self._c||e;return n("ul",{staticClass:"steps-list"},i._l(i.steps,function(t,e){return n("li",{key:e,class:{done:t.done},style:{display:t.buttonnext&&"inline-flex"}},[t.buttonnext?n("span",{staticClass:"button-step"},[n("span",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:t.description,expression:"step.description"}],staticClass:"description"}),i._v(" "),t.dynamic?n("span",{staticClass:"dynamic-step"},[i._v(i._s(t.dynamic))]):i._e(),i._v(" "),n("button",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.workflow.next",expression:"'editing.workflow.next'"}],class:"btn btn-success"+(t.buttonnext.disabled?" g3w-disabled":""),on:{click:function(e){return i.completeStep(t)}}})]):[n("i",{class:i.g3wtemplate.getFontClass(t.done?"success":"empty-circle")}),i._v(" "),n("span",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:t.description,expression:"step.description"}]})]],2)}),0)},e.staticRenderFns=[],e._scopeId="data-v-8a452b86"},{"vueify/lib/insert-css":1}],10:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.Session=i.ChangesManager=void 0;var f="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}i.Flow=o;var a=e("../../utils/promisify");function r(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,i){try{var n=s[e](i),a=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});r(a)}("next")})}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(){l(t,[{key:"addTask",value:function(e){this.tasks.push(e)}},{key:"run",value:function(){for(var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this.tasks.length;)(e?this.tasks.pop():this.tasks.shift())()}},{key:"flush",value:function(){return this.tasks.splice(0)}},{key:"getLength",value:function(){return this.tasks.length}},{key:"clear",value:function(){this.run(),this.tasks=[]}}]);var e=t;function t(){u(this,t),this.tasks=[]}var i,n=[],a=0,r=null,o=void 0,s=void 0;this.queques={end:new e,micro:new e},this.start=function(e){return o=$.Deferred(),i=(s=e).getInputs(),r=e.getContext(),(n=e.getSteps())&&n.length&&this.runStep(n[0],i,r),o.promise()},this.runStep=function(e,t){var i=this,n=(s.setMessages({help:e.state.help}),this.queques.micro.getLength());e.run(t,r,this.queques).then(function(e){n&&i.queques.micro.run(),i.onDone(e)}).fail(function(e){return i.onError(e)})},this.onDone=function(e){++a===n.length?(a=0,o.resolve(e)):this.runStep(n[a],e)},this.onError=function(e){a=0,this.clearQueques(),o.reject(e)},this.stop=function(){var e=$.Deferred();return n[a].isRunning()&&n[a].stop(),this.clearQueques(),0<a?(a=0,e.reject()):e.resolve(),e.promise()},this.clearQueques=function(){this.queques.micro.clear(),this.queques.end.clear()},g3wsdk.core.utils.base(this)}g3wsdk.core.utils.inherit(o,g3wsdk.core.G3WObject);var s=i.ChangesManager={Actions:{add:{fnc:"addFeature",opposite:"delete"},delete:{fnc:"removeFeature",opposite:"add"},update:{fnc:"updateFeature",opposite:"update"}},execute:function(t,e,i){var n,a=void 0;e.forEach(function(e){a=e.feature,i&&a[s.Actions[a.getState()].opposite](),n=s.Actions[a.getState()].fnc,t[n](a)})}},d=i.Session=function(e){var t=c;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);function c(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=(u(this,c),function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,e)));return i.setters={start:function(){var t,i=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return $.Deferred((t=r(function*(t){try{var e=yield(0,a.promisify)(i._editor.start(n));i.state.started=!0,t.resolve(e)}catch(e){t.reject(e)}}),function(e){return t.apply(this,arguments)})).promise()},stop:function(){var t,e=this;return $.Deferred((t=r(function*(t){if(!(e.state.started||e.state.getfeatures))return t.resolve();try{yield(0,a.promisify)(e._editor.stop()),e.clear(),t.resolve()}catch(e){t.reject(e)}}),function(e){return t.apply(this,arguments)})).promise()},getFeatures:function(){var t,i=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return $.Deferred((t=r(function*(t){if(i._allfeatures)return t.resolve([]);i._allfeatures=!n.filter;try{var e=yield(0,a.promisify)(i._editor.getFeatures(n));i.state.getfeatures=!0,t.resolve(e)}catch(e){t.reject(e)}}),function(e){return t.apply(this,arguments)})).promise()},saveChangesOnServer:function(e){}},i.state={id:e.id,started:!1,getfeatures:!1,maxSteps:10,current:null,changes:[]},i._states=[],i._constrains={commit:!1,undo:!1,redo:!1},i._editor=e.editor,i._history={id:i.state.id,state:new Proxy({},{get:function(e,t){return i._constrains[t]}}),add:i.__add.bind(i),getRelationStates:i.__getRelationStates.bind(i),insertState:i.__insertState.bind(i),removeState:i.deleteState.bind(i),removeStates:i.removeChangesFromHistory.bind(i),insertStates:i.__insertStates.bind(i),undo:i.__undo.bind(i),clear:i.clearHistory.bind(i),redo:i.__redo.bind(i),setItemsFeatureIds:i.__setItemsFeatureIds.bind(i),getState:i.__getState.bind(i),getFirstState:i.__getFirstState.bind(i),getLastState:i.getLastHistoryState.bind(i),getCurrentState:i.__getCurrentState.bind(i),getCurrentStateIndex:i.__getCurrentStateIndex.bind(i),canCommit:i.__canCommit.bind(i),canUndo:i.__canUndo.bind(i),canRedo:i.__canRedo.bind(i),commit:i.__commit.bind(i)},i.register(),i}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e),l(c,[{key:"_checkSessionItems",value:function(t,e,i){var n={own:[],dependencies:{}};return e.forEach(function(e){Array.isArray(e)&&(e=e[i]),(t===e.layerId?n:(n.dependencies[e.layerId]=n.dependencies[e.layerId]||{own:[],dependencies:{}},n.dependencies[e.layerId])).own.push(e)}),n}},{key:"getId",value:function(){return this.state.id}},{key:"getLastHistoryState",value:function(){return this._states.length?this._states[this._states.length-1]:null}},{key:"getLastStateId",value:function(){return this.getLastHistoryState().id}},{key:"deleteState",value:function(t){var e=this._states.findIndex(function(e){return e.id===t});this.state.current===t&&(this.state.current=1<this._states.length?this._states[e-1].id:null),this._states.splice(e,1)}},{key:"register",value:function(){c.Registry.register(this)}},{key:"unregister",value:function(){c.Registry.unregister(this.getId())}},{key:"isStarted",value:function(){return this.state.started}},{key:"getEditor",value:function(){return this._editor}},{key:"setEditor",value:function(e){this._editor=e}},{key:"save",value:function(){var e,t=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=$.Deferred();return this.state.changes.length?(e=i.id||Date.now(),this._history.add(e,this.state.changes).then(function(){t.state.changes=[],n.resolve(e)})):n.resolve(null),n.promise()}},{key:"updateTemporaryChanges",value:function(t){this.state.changes.forEach(function(e){return e.feature.setProperties(t.getProperties())})}},{key:"pushAdd",value:function(e,t){var i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],n=e===this.getId()?this._editor:c.Registry.getSession(e).getEditor(),i=(i&&(n.getLayer().getEditingNotEditableFields()||[]).forEach(function(e){return t.unset([e])}),t.clone());return this.push({layerId:e,feature:i.add()}),i}},{key:"pushDelete",value:function(e,t){return this.push({layerId:e,feature:t.delete()}),t}},{key:"pushUpdate",value:function(t,i,e){var n=i.isNew(),a=n&&this.state.changes.findIndex(function(e){return t===e.layerId&&e.feature.getId()===i.getId()});n&&0<=a?((n=i.clone()).add(),this.state.changes[a].feature=n):this.push({layerId:t,feature:i.update()},{layerId:t,feature:e.update()})}},{key:"removeChangesFromHistory",value:function(){var t=this;((0<arguments.length&&void 0!==arguments[0]?arguments[0]:[])||[]).forEach(function(e){return t.deleteState(e)})}},{key:"moveRelationStatesOwnSession",value:function(){var e,t={};for(e in this.getCommitItems().relations){var i=this._history.getRelationStates(e);c.Registry.getSession(e)._history.insertStates(i),t[e]=i.map(function(e){return e.id})}return t}},{key:"push",value:function(e,t){this.state.changes.push(t?[t,e]:e)}},{key:"revert",value:function(){var e=this,t=$.Deferred();return this._editor.revert().then(function(){e.clearHistory(),t.resolve()}),t.promise()}},{key:"rollback",value:function(t){var i,n;return t?this._editor.rollback(t):(i=$.Deferred(),n=this.getId(),t={own:[],dependencies:{}},this.state.changes.forEach(function(e){e=Array.isArray(e)?e[0]:e;e.layerId===n?t.own.push(e):(t.dependencies[e.layerId]||(t.dependencies[e.layerId]=[]),t.dependencies[e.layerId].unshift(e))}),this._editor.rollback(t.own).then(function(){for(var e in t.dependencies)c.Registry.getSession(e).rollback(t.dependencies[e]);i.resolve(t.dependencies)}),this.state.changes=[],i.promise())}},{key:"rollbackDependecies",value:function(){var e=this;(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(t){var i=[];e.state.changes=e.state.changes.filter(function(e){if(e.layerId===t)return i.push(e),!1}),i.length&&c.Registry.getSession(t).rollback(i)})}},{key:"undo",value:function(e){return e=e||this._history.undo(),this._editor.setChanges(e.own,!0),this._history.canCommit(),e.dependencies}},{key:"redo",value:function(e){return e=e||this._history.redo(),this._editor.setChanges(e.own,!0),this._history.canCommit(),e.dependencies}},{key:"getCommitItems",value:function(){var e,i=this,t=this._history.commit(),n=this.getId(),r=void 0,o=void 0,a={add:[],update:[],delete:[],relations:{}};for(e in t){var s,l=!1,u=t[e],o=e!==n?(l=!0,s=(s=c.Registry.getSession(e))?s.getEditor().getLockIds():[],a.relations[e]={lockids:s,add:[],update:[],delete:[],relations:{}},a.relations[e]):a;u.forEach(function(e){r=e.getState();var t=new ol.format.GeoJSON;if("delete"===r)e.isNew()||o.delete.push(e.getId());else{var i,n=t.writeFeatureObject(e),a=e.getProperties();for(i in n.properties)n.properties[i]&&"object"===f(n.properties[i])&&n.properties[i].constructor===Object&&(n.properties[i]=n.properties[i].value),void 0===n.properties[i]&&a[i]&&(n.properties[i]=a[i]);o[e.isNew()?"add":e.getState()].push(n)}}),l&&0===o.add.length&&0===o.update.length&&0===o.delete.length&&delete a.relations[e]}var d=Object.keys(a.relations||{});return d.filter(function(t){return void 0===i._editor.getLayer().getRelations().getArray().find(function(e){return t===e.getChild()})}).map(function(e){return a.relations[c.Registry.getSession(e).getEditor().getLayer().getRelations().getArray().find(function(e){return-1!==d.indexOf(e.getFather())}).getFather()].relations[e]=a.relations[e],e}).forEach(function(e){return delete a.relations[e]}),a}},{key:"set3DGeometryType",value:function(){var t,i=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=e.layerId,n=void 0===n?this.getId():n,a=e.commitItems,r=a.relations,e=MapLayersStoresRegistry.getLayerById(n).getEditingLayer();e&&g3wsdk.core.layer.Layer.LayerTypes.VECTOR===e.getType()&&(t=e.getGeometryType(),g3wsdk.core.geoutils.Geometry.is3DGeometry(t))&&["add","update"].forEach(function(e){return a[e].forEach(function(e){return e.geometry.type=t})}),Object.keys(r).forEach(function(e){return i.set3DGeometryType({layerId:e,commitItems:r[e]})})}},{key:"commit",value:function(){var a=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.ids,t=void 0===t?null:t,i=e.items,n=e.relations,n=void 0===n||n,e=e.__esPromise,r=void 0!==e&&e,o=$.Deferred(),s=void 0;return t?(s=this._history.commit(t),this.clearHistory(t)):(s=i||this.getCommitItems(this._history.commit()),n||(s.relations={}),this._editor.commit(s).then(function(e){if(e&&e.result){var t,i=e.response.new_relations,n=void 0===i?{}:i;for(t in n)c.Registry.getSession(t).getEditor().applyCommitResponse({response:n[t],result:!0});a.clearHistory(),a.saveChangesOnServer(s),r?o.resolve({commit:s,response:e}):o.resolve(s,e)}else o.reject(e)}).fail(function(e){return o.reject(e)})),o.promise()}},{key:"clear",value:function(){this._allfeatures=!1,this.state.started=!1,this.state.getfeatures=!1,this.clearHistory()}},{key:"getHistory",value:function(){return this._history}},{key:"clearHistory",value:function(i){var n=this;i?this._states.forEach(function(e,t){-1!==i.indexOf(e.id)&&(n.state.current&&n.state.current===e.id()&&n._history.undo(),n._states.splice(t,1))}):(this._states=[],this.state.current=null,this._constrains.commit=!1,this._constrains.redo=!1,this._constrains.undo=!1)}},{key:"__add",value:function(e,t){var i=this,n=$.Deferred();return null===this.state.current?this._states=[{id:e,items:t}]:(0<this._states.length&&this.state.current<this.getLastStateId()&&(this._states=this._states.filter(function(e){return e.id<=i.state.current})),this._states.push({id:e,items:t})),this.state.current=e,this._history.canUndo(),this._history.canCommit(),this._history.canRedo(),n.resolve(e),n.promise()}},{key:"__getRelationStates",value:function(t){(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).clear;for(var e=[],i=0;i<this._states.length;i++){var n=this._states[i],a=n.items.filter(function(e){return(Array.isArray(e)?e[0]:e).layerId===t});0<a.length&&e.push({id:n.id,items:a})}return e}},{key:"__insertState",value:function(e){for(var t=e.id,i=this._states.length,n=0;n<this._states.length;n++){var a=this._states[n];if(a.id>t){i=n;break}if(a.id===t){i=-1;break}}-1<i&&(this.state.current<t&&(this.state.current=t),this._states.splice(i,0,e))}},{key:"__insertStates",value:function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=0;t<e.length;t++)this._history.insertState(e[t]);this._history.canCommit()}},{key:"__undo",value:function(){var i=this,n=void 0;return this.state.current===this._history.getFirstState().id?(this.state.current=null,n=this._states[0].items):this._states.find(function(e,t){if(e.id===i.state.current)return n=i._states[t].items,i.state.current=i._states[t-1].id,!0}),n=this._checkSessionItems(this._history.id,n,0),this._history.canUndo(),this._history.canCommit(),this._history.canRedo(),n}},{key:"__redo",value:function(){var i=this,n=void 0;return this.state.current?this._states.find(function(e,t){if(i.state.current===e.id)return i.state.current=i._states[t+1].id,n=i._states[t+1].items,!0}):(n=this._states[0].items,this.state.current=this._states[0].id),n=this._checkSessionItems(this._history.id,n,1),this._history.canUndo(),this._history.canCommit(),this._history.canRedo(),n}},{key:"__setItemsFeatureIds",value:function(){var e=this;(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(t){e._states.forEach(function(e){e.items.forEach(function(e){e=e.feature.getId()===t.clientid&&e.feature;e&&e.setId(t.id)})})})}},{key:"__getState",value:function(t){return this._states.find(function(e){return e.id===t})}},{key:"__getFirstState",value:function(){return this._states.length?this._states[0]:null}},{key:"__getCurrentState",value:function(){var t=this,e=null;return e=this.state.current&&this._states.length?this._states.find(function(e){return t.state.current===e.id}):e}},{key:"__getCurrentStateIndex",value:function(){var i=this,n=null;return this.state.current&&this._states.length&&this._states.forEach(function(e,t){if(i.state.current===e.id)return n=t,!1}),n}},{key:"__canCommit",value:function(){var e,t=this._history.commit(),i=!1;for(e in t)var n=t[e],i=i||0<n.length;return this._constrains.commit=i,this._constrains.commit}},{key:"__canUndo",value:function(){var e=this._states.length-1-this._history.getCurrentStateIndex();return this._constrains.undo=null!==this.state.current&&this.state.maxSteps>e,this._constrains.undo}},{key:"__canRedo",value:function(){return this._constrains.redo=this.getLastHistoryState()&&this.getLastStateId()!=this.state.current||null===this.state.current&&0<this._states.length,this._constrains.redo}},{key:"__commit",value:function(){var t=this,a={};return this._states.filter(function(e){return e.id<=t.state.current}).forEach(function(e){e.items.forEach(function(i){var e,t,n=!0;Array.isArray(i)&&(i=i[1]),a[i.layerId]&&a[i.layerId].forEach(function(e,t){if(e.getUid()===i.feature.getUid())return i.feature.isNew()&&!e.isDeleted()&&i.feature.isUpdated()?((e=i.feature.clone()).add(),a[i.layerId][t]=e):i.feature.isNew()&&i.feature.isDeleted()?a[i.layerId].splice(t,1):(i.feature.isUpdated()||i.feature.isDeleted())&&(a[i.layerId][t]=i.feature),n=!1}),n&&(e=i.feature,t=i.layerId,!e.isNew()&&e.isAdded()||(a[t]||(a[t]=[]),a[t].push(e)))})}),a}}]),c}(g3wsdk.core.G3WObject),c={};d.Registry={_sessions:c,register:function(e){c[e.getId()]=e},unregister:function(e){delete c[e]},getSession:function(e){return c[e]},setSession:function(e,t){c[e]=t},getSessions:function(){return c},clear:function(){Object.keys(c).forEach(d.Registry.unregister)}}},{"../../utils/promisify":64}],11:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n=i.VM=new Vue;i.default={VM:n}},{}],12:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var i=t,n=[],a=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!i||n.length!==i);a=!0);}catch(e){t=!0,r=e}finally{try{!a&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var s=e("../../toolboxes/toolbox"),l=e("../../utils/promisify");function u(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function d(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,i){try{var n=s[e](i),a=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});r(a)}("next")})}}var e=g3wsdk.core,c=e.ApplicationState,r=e.G3WObject,e=g3wsdk.core.layer.features,f=e.FeaturesStore,g=e.OlFeaturesStore,p=g3wsdk.core.layer.Layer,e=function(){var e=n,t=r;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,i=n;if(t instanceof i)return(t=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this))).setters={save:function(){this._layer.save()},addFeature:function(e){this._featuresstore.addFeature(e)},updateFeature:function(e){this._featuresstore.updateFeature(e)},deleteFeature:function(e){this._featuresstore.deleteFeature(e)},setFeatures:function(){this._featuresstore.setFeatures(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[])},getFeatures:function(){var t,a=this,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return!c.online||this._allfeatures?$.Deferred(function(e){return e.resolve()}):(0,l.$promisify)((t=d(function*(e){var t=!0,i=(r.filter||{}).bbox,n=i&&p.LayerTypes.VECTOR===a._layer.getType();if(n&&null===a._filter.bbox?(a._filter.bbox=i,t=!0):n&&((n=ol.extent.containsExtent(a._filter.bbox,i))||(a._filter.bbox=ol.extent.extend(a._filter.bbox,i)),t=!n),t)return i=yield(0,l.promisify)(a._layer.getFeatures(r)),a._featuresstore.addFeatures((i||[]).map(function(e){return e.clone()})),a._allfeatures=!r.filter,i}),function(e){return t.apply(this,arguments)}))}},t._filter={bbox:null},t._allfeatures=!1,t._layer=e.layer,t._featuresstore=new(p.LayerTypes.TABLE===t._layer.getType()?f:g),t._started=!1,t;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t),a(n,[{key:"getEditingSource",value:function(){return this._featuresstore}},{key:"getSource",value:function(){this._layer.getSource()}},{key:"setChanges",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],i=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n={add:{fnc:"addFeature",opposite:"delete"},delete:{fnc:"removeFeature",opposite:"add"},update:{fnc:"updateFeature",opposite:"update"}};e.forEach(function(e){i&&e.feature[n[e.feature.getState()].opposite](),t._featuresstore[n[e.feature.getState()].fnc](e.feature)})}},{key:"getLayer",value:function(){return this._layer}},{key:"setLayer",value:function(e){return this._layer=e}},{key:"rollback",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return(0,l.$promisify)(function(){return e.setChanges(t,!0)})}},{key:"applyCommitResponse",value:function(){var e,r=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];t&&t.result&&(t.response.new.forEach(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.clientid,i=e.id,e=e.properties,t=r._featuresstore.getFeatureById(t);t.setId(i),t.setProperties(e),n.forEach(function(e){Object.entries(e).forEach(function(e){var t,i,e=o(e,2),n=e[0],e=e[1],e=void 0===e?{}:e,a=e.fatherField.find(function(e){return r._layer.isPkField(e)});a&&(t=e.childField[e.fatherField.indexOf(a)],i=s.ToolBox.get(n).getSession().getEditor().getEditingSource(),(e.ids||[]).forEach(function(e){e=i.getFeatureById(e);e&&e.set(t.name,t.value)}))})})}),(e=this.readEditingFeatures()).forEach(function(e){return e.clearState()}),this._layer.setFeatures([].concat(u(e))),this.addLockIds(t.response.new_lockids))}},{key:"addLockIds",value:function(e){this._layer.getSource().addLockIds(e)}},{key:"getLockIds",value:function(){return this._layer.getSource().getLockIds()}},{key:"commit",value:function(a){var r=this;return(0,l.$promisify)(d(function*(){var e=[],t=(a.add.length&&(e=Object.keys(a.relations).map(function(e){var t,i,n=r._layer.getRelations().getRelationByFatherChildren(r._layer.getId(),e);return t={},i=e,e={ids:[].concat(u(a.relations[e].add.map(function(e){return e.id})),u(a.relations[e].update.map(function(e){return e.id}))),fatherField:n.getFatherField(),childField:n.getChildField()},i in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t})),yield(0,l.promisify)(r._layer.commit(a)));return r.applyCommitResponse(t,e),t}))}},{key:"start",value:function(){var t=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return(0,l.$promisify)(d(function*(){var e=yield(0,l.promisify)(t.getFeatures(i));return t._started=!0,e}))}},{key:"readFeatures",value:function(){return this._layer.readFeatures()}},{key:"readEditingFeatures",value:function(){return this._featuresstore.readFeatures()}},{key:"stop",value:function(){var t=this;return(0,l.$promisify)(d(function*(){var e=yield(0,l.promisify)(t._layer.unlock());return t.clear(),e}))}},{key:"isStarted",value:function(){return this._started}},{key:"clear",value:function(){this._started=!1,this._filter.bbox=null,this._allfeatures=!1,this._featuresstore.clear(),this._layer.getFeaturesStore().clear(),this._layer.getType()===p.LayerTypes.VECTOR&&this._layer.resetEditingSource(this._featuresstore.getFeaturesCollection())}}]),n}();i.default=e},{"../../toolboxes/toolbox":27,"../../utils/promisify":57}],13:[function(e,t,i){var n=e("./editing/editor"),n=(n=n)&&n.__esModule?n:{default:n},a=e("./workflow/step"),r=e("../deprecated"),e=e("./workflow/workflow");window.g3wsdk.core.editing||window.g3wsdk.core.workflow||window.g3wsdk.constant.DEFAULT_EDITING_CAPABILITIES||g3wsdk.version,window.g3wsdk.core.editing={Session:r.Session,SessionsRegistry:r.Session.Registry,Editor:n.default,ChangesManager:r.ChangesManager},window.g3wsdk.constant.DEFAULT_EDITING_CAPABILITIES=["add_feature","change_feature","change_attr_feature","delete_feature"],window.g3wsdk.core.workflow={Task:a.Step,Step:a.Step,Flow:r.Flow,Workflow:e.Workflow,WorkflowsStack:e.Workflow.Stack}},{"../deprecated":10,"./editing/editor":12,"./workflow/step":14,"./workflow/workflow":15}],14:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.Step=void 0;var a=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var i=t,n=[],a=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!i||n.length!==i);a=!0);}catch(e){t=!0,r=e}finally{try{!a&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=e("../../utils/promisify");function s(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,i){try{var n=s[e](i),a=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});r(a)}("next")})}}var l=g3wsdk.core.G3WObject,u=g3wsdk.core.geoutils.Geometry.isPointGeometryType,d=g3wsdk.core.layer.Layer,c=g3wsdk.gui.GUI;(i.Step=function(){var e=n,t=l;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,i=n;if(t instanceof i)return(t=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this)))._options=e,t._run=(e.run||t.run||s(function*(){return!0})).bind(t),t._stop=(e.stop||t.stop||s(function*(){return!0})).bind(t),t._inputs=e.inputs||null,t._context=e.context||null,t._outputs=e.outputs||null,t.state={id:e.id||null,name:e.name||null,help:e.help||null,running:!1,error:null,message:e.message||null,usermessagesteps:{}},t.registerEscKeyEvent(e.escKeyPressEventHandler),t.selectStyle=e.selectStyle,e.steps&&t.setSteps(e.steps),e.onRun&&t.on("run",e.onRun),e.onStop&&t.on("run",e.onStop),e.tools&&(t._tools=e.tools),t;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t),r(n,[{key:"setInputs",value:function(e){this._inputs=this.inputs=e}},{key:"getInputs",value:function(){return this._inputs}},{key:"setContext",value:function(e){return this._context=this.context=e}},{key:"getContext",value:function(){return this.context}},{key:"panic",value:function(){}},{key:"setRoot",value:function(e){this.state.root=e}},{key:"getUserMessageSteps",value:function(){return this.state.usermessagesteps}},{key:"setUserMessageSteps",value:function(){this.state.usermessagesteps=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}}},{key:"setUserMessageStepDone",value:function(e){e&&(this.state.usermessagesteps[e].done=!0)}},{key:"addInteraction",value:function(i){var e=this,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return c.getService("map").addInteraction(i),Object.entries(t).forEach(function(e){var e=a(e,2),t=e[0],e=e[1];return i.on(t,e)}),this.on("stop",function(){return e.removeInteraction(i)}),i}},{key:"removeInteraction",value:function(e){setTimeout(function(){return c.getService("map").removeInteraction(e)})}},{key:"getEditingType",value:function(){return null}},{key:"registerPointerMoveCursor",value:function(){c.getService("map").getMap().on("pointermove",this._pointerMoveCursor)}},{key:"unregisterPointerMoveCursor",value:function(){c.getService("map").getMap().un("pointermove",this._pointerMoveCursor)}},{key:"_pointerMoveCursor",value:function(e){this.getTargetElement().style.cursor=this.forEachFeatureAtPixel(e.pixel,function(){return!0})?"pointer":""}},{key:"setSteps",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this._steps=e,this.setUserMessageSteps(e)}},{key:"getSteps",value:function(){return this._steps}},{key:"getMap",value:function(){return c.getService("map").getMap()}},{key:"disableSidebar",value:function(){this._isContentChild||c.disableSideBar(!(0<arguments.length&&void 0!==arguments[0])||arguments[0])}},{key:"fireEvent",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").fireEvent(e,t)}},{key:"saveSingle",value:function(e,t){t.session.save().then(function(){return g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").saveChange()})}},{key:"cancelSingle",value:function(e,t){t.session.rollback()}},{key:"escKeyUpHandler",value:function(e){"Escape"===e.key&&e.data.callback({task:e.data.task})}},{key:"unbindEscKeyUp",value:function(){$(document).unbind("keyup",this.escKeyUpHandler)}},{key:"bindEscKeyUp",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){};$(document).on("keyup",{callback:e,task:this},this.escKeyUpHandler)}},{key:"registerEscKeyEvent",value:function(e){var t=this;e&&(this.on("run",function(){return t.bindEscKeyUp(e)}),this.on("stop",function(){return t.unbindEscKeyUp()}))}},{key:"__run",value:function(n,a){var r=this;return(0,o.$promisify)(s(function*(){r.setInputs(n),r.setContext(a);var e,t=r,i={snap:{type:"snap",options:{checkedAll:!1,checked:!1,active:!0,run:function(e){e=e.layer;this.active=!0,this.layerId=e.getId(),this.source=e.getEditingLayer().getSource()},stop:function(){this.active=!1}}},measure:{type:"measure",options:{checked:!1,run:function(){var e=this;setTimeout(function(){e.onChange(e.checked)})},stop:function(){t.removeMeasureInteraction(),this.onChange(!1)},onChange:function(e){this.checked=e,t[e?"addMeasureInteraction":"removeMeasureInteraction"]()}}}};r._tools&&0===r._workflow._toolsoftool.length&&(e=r._workflow._toolsoftool).push.apply(e,function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(r._tools.filter(function(e){return"measure"!==e||d.LayerTypes.VECTOR===n.layer.getType()&&!u(n.layer.getGeometryType())}).map(function(e){return i[e]}))),r._tools&&(r._workflow._toolsoftool.forEach(function(e){return e.options.run({layer:n.layer})}),r._workflow.emit("settoolsoftool",r._workflow._toolsoftool)),r.emit("run",{inputs:n,context:a});try{return r.state.running=!0,yield(0,o.promisify)(r._run(n,a))}catch(e){return r.state.error=e,Promise.reject(e)}finally{r.__stop()}}))}},{key:"__stop",value:function(){this._stop(this._inputs,this._context),this.state.running=!1,this._workflow&&this._workflow._toolsoftool.forEach(function(e){return e.options.stop()}),this.emit("stop")}},{key:"getId",value:function(){return this.state.id}},{key:"getName",value:function(){return this.state.name}},{key:"getHelp",value:function(){return this.state.help}},{key:"getError",value:function(){return this.state.error}},{key:"getMessage",value:function(){return this.state.message}},{key:"isRunning",value:function(){return this.state.running}},{key:"getTask",value:function(){return this}},{key:"setOutputs",value:function(e){this._outputs=e}},{key:"getOutputs",value:function(){return this._outputs}},{key:"setToolsOfTools",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];this._workflow=e,this._tools=t}}]),n}()).MESSAGES={help:null}},{"../../utils/promisify":57}],15:[function(o,e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.Workflow=void 0;var s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,n=arguments[t];for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},n=function(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),e};function a(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var l=o("./step"),u=o("../../utils/promisify");function d(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,i){try{var n=s[e](i),a=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});r(a)}("next")})}}var c=g3wsdk.gui.GUI,f=g3wsdk.core.G3WObject,i=t.Workflow=function(){var i,e=r,t=f;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);function r(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,i=r;if(t instanceof i)return(t=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(r.__proto__||Object.getPrototypeOf(r)).call(this)))._type=void 0!==e.type?e.type:null,t._options=e,t._promise=null,t._inputs=void 0!==e.inputs?e.inputs:null,t._context=void 0!==e.context?e.context:null,t._steps=e.steps||[],t._child=null,t._stackIndex=null,t.runOnce=e.runOnce||!1,t._messages=l.Step.MESSAGES,t._userMessageSteps={},0<t._steps.length&&t.setUserMessagesSteps(t._steps),t.backbuttonlabel=void 0!==e.backbuttonlabel?e.backbuttonlabel:null,t.helpMessage=e.helpMessage?{help:e.helpMessage}:null,t._toolsoftool=[],!0===e.registerEscKeyEvent&&t.registerEscKeyEvent(),t._stepIndex=0,t;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t),n(r,[{key:"setUserMessagesSteps",value:function(e){this._userMessageSteps=e.reduce(function(e,t){return s({},e,t.getUserMessageSteps()||{})},{})}},{key:"isType",value:function(e){var t=this;return Array.isArray(e)?Boolean(e.find(function(e){return e===t._type})):e===this._type}},{key:"getContextService",value:function(){return this.getContext().service}},{key:"setContextService",value:function(e){this.getContext().service=e}},{key:"getStackIndex",value:function(){return this._stackIndex}},{key:"addChild",value:function(e){this._child?this._child.addChild(e):this._child=e}},{key:"removeChild",value:function(){this._child&&r.Stack.removeAt(this._child.getStackIndex()),this._child=null}},{key:"setInput",value:function(e){var t=e.key,e=e.value;this._inputs[t]=e}},{key:"getInputs",value:function(){return this._inputs}},{key:"setContext",value:function(e){this._context=e}},{key:"getContext",value:function(){return this._context}},{key:"addStep",value:function(e){this._steps.push(e)}},{key:"setSteps",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];this._steps=e,this.setUserMessagesSteps(e)}},{key:"getSteps",value:function(){return this._steps}},{key:"getStep",value:function(e){return this._steps[e]}},{key:"setMessages",value:function(e){Object.assign(this._messages,e)}},{key:"getMessages",value:function(){return this._messages}},{key:"clearMessages",value:function(){this._messages.help=null,Object.keys(this._userMessageSteps).length&&this.clearUserMessagesSteps()}},{key:"getLastStep",value:function(){return this._steps.length?this._steps[this._steps.length-1]:null}},{key:"getRunningStep",value:function(){return this._steps.find(function(e){return e.isRunning()})}},{key:"reject",value:function(){this._promise&&this._promise.reject(),this.emit("reject")}},{key:"resolve",value:function(){this._promise&&this._promise.resolve()}},{key:"runStep",value:(i=d(function*(e,t){try{this.setMessages({help:e.state.help});var i=yield(0,u.promisify)(e.__run(t,this.getContext()));return this._stepIndex++,this._stepIndex===this.getSteps().length?(this._stepIndex=0,i):this.runStep(this.getSteps()[this._stepIndex],i)}catch(e){return this._stepIndex=0,Promise.reject(e)}}),function(e,t){return i.apply(this,arguments)})},{key:"start",value:function(){var t,n=this,a=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return $.Deferred((t=d(function*(t){n._promise=t,n._inputs=a.inputs,n._context=a.context||{};!n._context.isChild&&1&&r.Stack.getLength()&&r.Stack.getCurrent()!==n&&r.Stack.getCurrent().addChild(n),n._stackIndex=r.Stack.push(n),n._steps=a.steps||n._steps,(n._steps||[]).forEach(function(e){return e._workflow=n});var i=Object.keys(n._userMessageSteps).length;i&&c.showUserMessage({title:"plugins.editing.workflow.title.steps",type:"tool",position:"left",size:"small",closable:!1,hooks:{body:s({},o("../../components/UserMessage.vue"),{data:function(){return{steps:n._userMessageSteps}}})}}),n.emit("start");try{var e=yield n.runStep(n.getSteps()[n._stepIndex],n.getInputs());i?setTimeout(function(){n.clearUserMessagesSteps(),t.resolve(e)},500):t.resolve(e)}catch(e){i&&n.clearUserMessagesSteps(),t.reject(e)}n.runOnce&&n.stop()}),function(e){return t.apply(this,arguments)})).promise()}},{key:"stop",value:function(){var t,e=this;return $.Deferred((t=d(function*(t){e._promise=null;try{e._child&&(yield(0,u.promisify)(e._child.stop()))}catch(e){}e.removeChild(),r.Stack.removeAt(e.getStackIndex());try{if(e.getSteps()[e._stepIndex].isRunning()&&(e.clearMessages(),e.getSteps()[e._stepIndex].__stop()),0<e._stepIndex)return e._stepIndex=0,t.reject(),Promise.reject();t.resolve()}catch(e){t.reject(e)}e.emit("stop")}),function(e){return t.apply(this,arguments)})).promise()}},{key:"clearUserMessagesSteps",value:function(){var t=this;Object.keys(this._userMessageSteps).forEach(function(e){e=t._userMessageSteps[e];e.done=!1,e.buttonnext&&(e.buttonnext.disabled=!0)}),c.closeUserMessage()}},{key:"setBackButtonLabel",value:function(){this.backbuttonlabel=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null}},{key:"getBackButtonLabel",value:function(){return this.backbuttonlabel}},{key:"addToolsOfTools",value:function(e){var t=e.step,e=e.tools;t.setToolsOfTools(this,void 0===e?[]:e)}},{key:"setHelpMessage",value:function(e){this.helpMessage={help:e}}},{key:"getHelpMessage",value:function(){return this.helpMessage}},{key:"getFeatures",value:function(){return this.getInputs().features}},{key:"startFromLastStep",value:function(e){return this.setSteps([this.getSteps().pop()]),this.start(e)}},{key:"getCurrentFeature",value:function(){var e=this.getFeatures();return e[e.length-1]}},{key:"getLayer",value:function(){return this.getInputs().layer}},{key:"getSession",value:function(){return this.getContext().session}},{key:"escKeyUpHandler",value:function(e){27===e.keyCode&&(e.data.workflow.reject(),e.data.callback())}},{key:"unbindEscKeyUp",value:function(){$(document).unbind("keyup",this.escKeyUpHandler)}},{key:"bindEscKeyUp",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){};$(document).on("keyup",{workflow:this,callback:e},this.escKeyUpHandler)}},{key:"registerEscKeyEvent",value:function(e){var t=this;this.on("start",function(){return t.bindEscKeyUp(e)}),this.on("stop",function(){return t.unbindEscKeyUp()})}}]),r}(),r=[];i.Stack={_workflows:r,push:function(e){return r.includes(e)?r.indexOf(e):r.push(e)-1},getParent:function(){return r.slice(-2)[0]},getParents:function(){return r.slice(0,-1)},pop:function(){return r.pop()},getLength:function(){return r.length},getFirst:function(){return r[0]},getCurrent:function(){return i.Stack.getLast()},getLast:function(){return r.slice(-1)[0]},removeAt:function(e){r.splice(e,1)},insertAt:function(e,t){r[e]=t},getAt:function(e){return r[e]},clear:function(){for(;r.length;)r.pop().stop()}}},{"../../components/UserMessage.vue":9,"../../utils/promisify":57,"./step":14}],16:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={close_editing_panel:{message:"To close editing form need to exit from editing layer"},errors:{no_layers:"Es tritt ein Fehler auf. Es ist nicht m√∂glich, Layer zu bearbeiten",some_layers:"Es tritt ein Fehler auf: Es ist nicht m√∂glich, einige Layer zu bearbeiten"},search:"Suche",editing_changes:"√Ñnderungen bearbeiten",editing_data:"Layer bearbeiten",editing_attributes:"Attribute bearbeiten",relations:"Relationen",edit_relation:"Relation bearbeiten",back_to_relations:"Zur√ºck zu Relationen",no_relations_found:"Keine Relationen gefunden",relation_data:"Relationsdaten",relation_already_added:"Relation bereits hinzugef√ºgt",list_of_relations_feature:"Liste der Relations-Features ",tooltip:{edit_layer:"Layer bearbeiten"},toolbox:{title:"bearbeiten"},table:{edit:"Feature bearbeiten",copy:"Kopie erstellen",delete:"Feature l√∂schen"},tools:{copy:"Features kopieren",pastefeaturesfromotherlayers:"Paste features from other layer",addpart:"Teil zu Multipart hinzuf√ºgen",deletepart:"Teil aus Multipart l√∂schen",merge:"Feature aufl√∂sen",split:"Feature trennen",add_feature:"Feature hinzuf√ºgen",delete_feature:"Feature l√∂schen",move_feature:"Feature verschieben",update_vertex:"Feature vertex aktualisieren",update_feature:"Feature-Attribut aktualisieren",update_multi_features:"Attribute ausgew√§hlter Features aktualisieren",copyfeaturefromexternallayer:"Create Feature from added layer"},toolsoftool:{measure:"Messung anzeigen",snap:"Snap Layer",snapall:"Snap auf alle Layer"},steps:{help:{select_elements:"Features ausw√§hlen",select_element:"Feature ausw√§hlen",copy:"Neue Kopie der ausgew√§hlten Features erstellen",merge:"Features aufl√∂sen",split:"Feature trennen",new:"Neues Feature erstellen",edit_table:"Features der Tabelle bearbeiten",draw_new_feature:"Feature auf Karte zeichnen",action_confirm:"Aktion best√§tigen",double_click_delete:"Zu l√∂schendes Feature auf der Karte ausw√§hlen",edit_feature_vertex:"√Ñndern oder Hinzuf√ºgen eines Eckpunktes auf dem ausgew√§hlten Feature",move:"Ausgew√§hltes Feature verschieben",select_feature_to_relation:"Feature ausw√§hlen, welches die Relation verkn√ºpft",show_edit_feature_form:"Feature-Formular zum Bearbeiten von Attributen anzeigen",pick_feature:"Zu √§nderndes Feature auf der Karte ausw√§hlen",insert_attributes_feature:"Attribute des Features einf√ºgen"}},workflow:{steps:{select:"Zum Ausw√§hlen auf ein Feature klicken",draw_part:"Neues Teil zeichnen",draw_geometry:"Geometrie zeichnen",merge:"Feature zum Aufl√∂sen ausw√§hlen",selectSHIFT:"Features ausw√§hlen indem ein Rechteck mit SHIFT gezeichnet wird",selectDrawBox:"Features ausw√§hlen, indem man ein Rechteck mit zwei gegen√ºberliegenden Eckpunkten zeichnet",selectDrawBoxAtLeast2Feature:"Mindestens Features ausw√§hlen, indem man ein Rechteck mit zwei gegen√ºberliegenden Eckpunkten zeichnet",selectPoint:"Zum Ausw√§hlen auf ein Feature klicken",selectPointSHIFT:"Features ausw√§hlen, indem ein Rechteck mit SHIFT gezeichnet wird (Multifeatures) oder auf ein Feature klicken",selectMultiPointSHIFT:"Features ausw√§hlen, indem man ein Rechteck zeichnet und SHIFT dr√ºckt oder auf ein Feature klickt",selectMultiPointSHIFTAtLeast2Feature:"Mindestens 2 Features ausw√§hlen und mit SHIFT ein Rechteck zeichnen oder auf ein Feature klicken",copyCTRL:"Kopieren ausgew√§hlter Features mit CTRL+C",selectStartVertex:"Start-Eckpunkt der ausgew√§hlten Features ausw√§hlen",selectToPaste:"Den Punkt ausw√§hlen, an dem die ausgew√§hlten Features eingef√ºgt werden sollen",draw_split_line:"Eine Linie zeichnen, um das ausgew√§hlte Feature zu teilen"},title:{steps:"Schritte"},next:"Weiter"},messages:{featureslockbyotheruser:"Einige Geometrien/Datens√§tze k√∂nnen nicht bearbeitet werden, da sie von anderen Benutzern bearbeitet werden",splitted:"Getrennt",nosplittedfeature:"Feature nicht getrennt",press_esc:"Mit ESC zur√ºck",online:"Wieder ONLINE. Jetzt kann man die √Ñnderungen in der Datenbank speichern",offline:"OFFLINE. Alle √Ñnderungen werden lokal gespeichert",delete_feature:"Soll das ausgew√§hlte Feature gel√∂scht werden?",delete_feature_relations:"Wenn ein Feature Verkn√ºpfungen beinhaltet, werden diese Relationen verwaist. Wir schlagen vor, diese Relationen zu behandeln, bevor das Feature gel√∂scht wird",unlink_relation:"Soll die Verkn√ºpfung aufgehoben werden?",commit_feature:"Zusammenfassung der √Ñnderungen",toolbox_has_relation:"Diese Ebene ist Teil einer Beziehung",saved:"Daten erfolgreich gespeichert",saved_local:"Daten erfolgreich lokal gespeichert",loading_data:"Daten laden",saving:"Daten werden gespeichert. Bitte warten ...",constraints:{enable_editing:"Bitte zoomen Sie hinein, um die Editier-Tools zu aktivieren \nAktivierungsskala bei 1:"},pdf:"Dokumentenvorschau nicht verf√ºgbar. Bitte hier klicken ",commit:{header:"Die folgende Liste zeigt alle zu √ºbernehmenden √Ñnderungen.",header_relation:"Relation",header_add:"<b>Hinzufgef√ºgt</b> Die Anzahl der hinzugef√ºgten Features anzeigen",header_update_delete:"<b>Bearbeitet</b> und <b>Gel√∂scht</b> Die Liste der Feature-ID anzeigen",add:"Hinzugef√ºgt",delete:"Gel√∂scht",update:"Bearbeitet"},loading_table_data:"Datentabelle wird erstellt. Bitte warten ...",copy_and_paste_from_other_layer_mandatory_fields:"Vor dem Speichern m√ºssen alle Pflichtfelder des eingegebenen features ausgef√ºllt werden",no_feature_selected:"Keine feature ausgew√§hlt",select_min_2_features:"Select at least 2 features"},relation:{table:{info:"<div>W√§hlen Sie Relationen aus, um sie mit dem aktuellen Feature zu verkn√ºpfen.</div>"},draw_new_feature:"Zeichnen Sie eine neue feature",draw_or_copy:"oder",copy_feature_from_other_layer:"Kopieren Sie feature aus einer anderen layer"},form:{relations:{tooltips:{back_to_father:"Zur√ºck zur Bearbeitung des Vaters",add_relation:"Neue Relation erstellen und verkn√ºpfen",link_relation:"Eine Relation zu diesem Feature herstellen",open_relation_tools:"Relationstools anzeigen",unlink_relation:"Relation trennen"}},buttons:{save:"Einf√ºgung/Bearbeiten",save_and_back:"Speichern und zur√ºck",save_and_back_table:"Speichern und zur√ºck",cancel:"√Ñnderungen ignorieren"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Select feature/s",edit_attributes:"Edit attributes of pasted features in multiple mode"},copyfeaturefromprojectlayer:{title:"Select one feature"}}}}},{}],17:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={close_editing_panel:{message:"To close editing form need to exit from editing layer"},errors:{no_layers:"An error occurs. It's no possible to edit layers",some_layers:"An error occurs: It's no possible to edit some layers",editing_multiple_relations:"Editing multiple relationships is not currently supported"},search:"Search",editing_changes:"Editing Changes",editing_data:"Editing Layers",editing_attributes:"Editing attributes",relations:"Relations",edit_relation:"Edit relation",back_to_relations:"Back to Relations",no_relations_found:"No relations found",relation_data:"Relation data",relation_already_added:"Relation already added",list_of_relations_feature:"List of relations feature ",tooltip:{edit_layer:"Edit Layer",filter_by_relation:"Filter layers by relation"},toolbox:{title:"Edit"},table:{edit:"Edit feature",copy:"Create a copy",delete:"Delete feature"},tools:{copy:"Copy features",pastefeaturesfromotherlayers:"Paste features from other layer",addpart:"Add part to multipart",deletepart:"Delete part from multipart",merge:"Dissolve features",split:"Split Feature",add_feature:"Add feature",delete_feature:"Delete feature",move_feature:"Move feature",update_vertex:"Update feature vertex",update_feature:"Update feature attribute",update_multi_features:"Update attributes of selected features",copyfeaturefromexternallayer:"Create Feature from added layer"},toolsoftool:{measure:"Show measure",snap:"Snap layer",snapall:"Snap to all layers"},steps:{help:{select_elements:"Select features",select_element:"Select feature",copy:"Create new copy of selected features",merge:"Dissolve features",split:"Split Feature",new:"Create new feature",edit_table:"Edit table features",draw_new_feature:"Draw feature on map",action_confirm:"Confirm action",double_click_delete:"Select feature on map to delete",edit_feature_vertex:"Modify or add a vertex on selected feature",move:"Move selected feature",select_feature_to_relation:"Select feature that you bind relation",show_edit_feature_form:"Show feature form to edit attributes",pick_feature:"Select feature on map to modify",insert_attributes_feature:"Insert attributes of the feature"}},workflow:{steps:{select:"Click on feature to select",draw_part:"Draw new part",draw_geometry:"Draw geometry",merge:"Select featurewhere dissolve",selectSHIFT:"Select features drawing a rectangle pressing SHIFT",selectDrawBox:"Select features drawing a rectangle by two point of opposite corners",selectDrawBoxAtLeast2Feature:"Select at least features drawing a rectangle by two point of opposite corners",selectPoint:"Click on feature to select",selectPointSHIFT:"Select features drawing a rectangle pressing SHIFT (multifeatures) or click on one feature",selectMultiPointSHIFT:"Select features drawing a rectangle pressing SHIFT or click on feature",selectMultiPointSHIFTAtLeast2Feature:"Select at least 2 features drawing a rectangle pressing SHIFT or click on feature",copyCTRL:"Copy selected features using CTRL+C",selectStartVertex:"Select starting vertex of selected features",selectToPaste:"Select the point where paste the features selected",draw_split_line:"Draw a line to split selected feature"},title:{steps:"Steps"},next:"Next"},messages:{featureslockbyotheruser:"Some geometries/records are not editable because in editing by other user",splitted:"Splitted",nosplittedfeature:"Feature not spitted",press_esc:"Press ESC to back",online:"Back ONLINE. Now you can save your changes on database",offline:"You are OFFLINE. All changes are saved locally",delete_feature:"Do you want delete selected feature ?",delete_feature_relations:"If feature has bindings relations, these relations become orphans. We suggest to handle these relations before detele this feature",unlink_relation:"Do you want unlink relation?",commit_feature:"Summary of changes",toolbox_has_no_geometry:"this layer has no geometry",toolbox_has_relation:"this layer is part of a relation",saved:"Data saved successfully",saved_local:"Data saved locally successfully",loading_data:"Loading data",saving:"Saving data. Please wait ...",constraints:{enable_editing:"Please Zoom In to enable editing tools \nActivation scale at 1:"},pdf:"Document preview not available. Please click here ",commit:{header:"The following list show all changes to commit.",header_relation:"Relation",header_add:"<b>Added</b> show the number of features added",header_update_delete:"<b>Modified</b> and <b>Deleted</b> show the list of features id",add:"Added",delete:"Deleted",update:"Updated"},loading_table_data:"Building Data Table. Please wait ...",copy_and_paste_from_other_layer_mandatory_fields:"It is necessary to fill in any mandatory fields on the features pasted before saving",no_feature_selected:"No feature selected",select_min_2_features:"Select at least 2 features"},relation:{table:{info:"<div>Select relations to link it to current editing feature.</div>"},draw_new_feature:"Draw new feature",draw_or_copy:"or",copy_feature_from_other_layer:"Copy feature from other layer"},form:{relations:{tooltips:{back_to_father:"Back to edit father",add_relation:"Create and link new relation",link_relation:"Join a relation to this feature",open_relation_tools:"Show relation tools",unlink_relation:"Unlink relation"}},buttons:{save:"Insert/Edit",save_and_back:"Save and Back",save_and_back_table:"Save and Back",cancel:"Ignore Changes"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Select feature/s",edit_attributes:"Edit attributes of pasted features in multiple mode"},copyfeaturefromprojectlayer:{title:"Select a feature"}}}}},{}],18:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={close_editing_panel:{message:"To close editing form need to exit from editing layer"},errors:{no_layers:"Tapahtui virhe. Tasoja ei ole mahdollista muokata.",some_layers:"Tapahtui virhe. Jotkin tasot eiv√§t ole muokattavissa."},search:"Haku",editing_changes:"Editing Changes",editing_data:"Muokataan tasoja",editing_attributes:"Muokataan attribuutteja",relations:"Relaatiot",edit_relation:"Muokkaa relaatiota",back_to_relations:"Takaisin relaatioihin",no_relations_found:"Relaatioita ei l√∂ytynyt",relation_data:"Relaation tiedot",relation_already_added:"Relaatio on jo lis√§tty",list_of_relations_feature:"Lista relaation ominaisuuksista",tooltip:{edit_layer:"Muokkaa tasoa"},toolbox:{title:"Muokkaa"},table:{edit:"Muokkaa ominaisuutta",copy:"Luo kopio",delete:"Poista ominaisuus"},tools:{copy:"Kopio ominaisuuksia",pastefeaturesfromotherlayers:"Paste features from other layer",addpart:"Lis√§√§ osa",deletepart:"Poista osa",merge:"Yhdist√§ ominaisuudet",split:"Leikkaa ominaisuus",add_feature:"Lis√§√§ ominaisuus",delete_feature:"Poista ominaisuus",move_feature:"Siirr√§ ominaisuutta",update_vertex:"P√§ivit√§ pisteen ominaisuutta",update_feature:"P√§ivit√§ ominaisuus",update_multi_features:"Muokkaa valittujen ominaisuuksien attribuutteja",copyfeaturefromexternallayer:"Create Feature from added layer"},toolsoftool:{measure:"Show measure",snap:"Snap layer",snapall:"Snap to all layers"},steps:{help:{select_elements:"Valitse ominaisuudet",select_element:"Valitse ominaisuus",copy:"Luo kopio valituista ominaisuuksista",merge:"Yhdist√§ ominaisuudet",split:"Leikkaa ominaisuus",new:"Luo uusi ominaisuus",edit_table:"Muuta taulun ominaisuuksia",draw_new_feature:"Piirr√§ ominaisuus kartalle",action_confirm:"Hyv√§ksy toiminto",double_click_delete:"Valitse poistettava ominaisuus kartalta",edit_feature_vertex:"Muuta pistett√§ tai lis√§√§ piste valittuun ominaisuuteen",move:"Siirr√§ valittu ominaisuus",select_feature_to_relation:"Valitse relaatio",show_edit_feature_form:"N√§yt√§ ominaisuuslomake muokataksesi attribuutteja",pick_feature:"Valitse muokattava ominaisuus kartalta",insert_attributes_feature:"Lis√§√§ ominaisuuden attribuutit"}},workflow:{steps:{select:"Valitse ominaisuus",draw_part:"Piirr√§ uusi osa",merge:"Valitse ominaisuus yhdist√§√§ksesi",draw_geometry:"Piirr√§ geometria",selectSHIFT:"Paina SHIFT, jos haluat valita kohteita suorakulmiovalinnalla.",selectDrawBox:"Piirr√§ suorakulmio, jonka si√§lt√§ kohteet valitaan ",selectDrawBoxAtLeast2Feature:"Piirr√§ suorakulmio, jonka si√§lt√§ kohteet v√§hint√§√§n 2 valitaan ",selectPoint:"Valitse ominaisuus",selectPointSHIFT:"Paina SHIFT, jos haluat valita ominaisuuksia suorakulmiovalinnalla, tai valitse yksitt√§inen ominaisuus.",selectMultiPointSHIFT:"Paina SHIFT, jos haluat valita ominaisuuksia suorakulmiovalinnalla, tai valitse yksitt√§inen ominaisuus.",selectMultiPointSHIFTAtLeast2Feature:"Paina SHIFT, jos haluat valita v√§hint√§√§n 2 ominaisuuksia suorakulmiovalinnalla, tai valitse yksitt√§inen ominaisuus.",copyCTRL:"CTRL+C, voit kopioida valitut ominaisuudet.",selectStartVertex:"Osoita valittujen ominaisuuksien alkupiste.",selectToPaste:"Valitse kohta, johon liit√§t valitut ominaisuudet.",draw_split_line:"Piirr√§ viiva, jonka mukaan valittu ominaisuus jaetaan."},title:{steps:"Vaiheet"},next:"Seuraava"},messages:{featureslockbyotheruser:"Some features are locked by another user",splitted:"Jaettu",nosplittedfeature:"Ominaisuutta ei jaettu",press_esc:"Paina ESC palataksesi",online:"Yhteys muodostettu. Muutokset voidaan tallentaa tietokantaan.",offline:"Olet offline-tilassa. Muutokset tallennetaan paikallisesti",delete_feature:"Haluatko poistaa valitun ominaisuuden?",delete_feature_relations:"Mik√§li ominaisuudella on sitovia relaatioita, n√§ist√§ relaatiosta tulee orpoja. Suosittelemme k√§sittelem√§√§n n√§m√§ relaatiot ennen poistamista",unlink_relation:"Haluatko poistaa relaation?",commit_feature:"Yhteenveto muutoksista",toolbox_has_relation:"t√§m√§ kerros on osa relaatiota",saved:"Tiedot tallennettu onnistuneesti",saved_local:"Tiedot on tallennettu onnistuneesti paikallisesti.",loading_data:"Ladataan tietoja",saving:"Tallentaan tietoja. Odota...",constraints:{enable_editing:"L√§henn√§ ottaaksesi muokkausty√∂kalut k√§ytt√∂√∂n \nAktivointi mittakaava 1:"},pdf:"Dokumentin esikatselu ei ole saatavilla. Paina t√§st√§ ",commit:{header:"Seuraava luettelo n√§ytt√§√§ kaikki muutokset.",header_relation:"Relation",header_add:"<b>Lis√§tty</b> n√§yt√§ lis√§ttyjen ominaisuuksien lukum√§√§r√§",header_update_delete:"<b>Muokattu</b> ja <b>Poistettu</b> N√§yt√§ list√§ ominaisuuksien id:st√§",add:"Lis√§tty",delete:"Poistettu",update:"Muokattu"},loading_table_data:"Building Data Table. Please wait ...",copy_and_paste_from_other_layer_mandatory_fields:"It is necessary to fill in any mandatory fields on the features pasted before saving",no_feature_selected:"No feature selected",select_min_2_features:"Select at least 2 features"},relation:{table:{info:"<div>Valitse relaatiota linkitt√§√§ksesi ne muokattavaan ominaisuuteen.</div>"},draw_new_feature:"Draw new feature",draw_or_copy:"or",copy_feature_from_other_layer:"Copy feature from other layer"},form:{relations:{tooltips:{back_to_father:"Back to edit father",add_relation:"Luo ja linkit√§ uusi relaatio",link_relation:"Liit√§ relaatio t√§h√§n ominaisuuteen",open_relation_tools:"N√§yt√§ relaatioty√∂kalut",unlink_relation:"Poista relaatio"}},buttons:{save:"Lis√§√§/muokkaa",save_and_back:"Tallenna ja palaa",save_and_back_table:"Tallenna ja palaa",cancel:"Peruuta"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Select feature/s",edit_attributes:"Edit attributes of pasted features in multiple mode"},copyfeaturefromprojectlayer:{title:"Select a feature"}}}}},{}],19:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={close_editing_panel:{message:"To close editing form need to exit from editing layer"},errors:{no_layers:"Une erreur s'est produite lors du chargement des layers dans l'√©dition.",some_layers:"Une erreur s'est produite lors du chargement de certaines layers dans l'√©dition."},search:"Recherche",editing_changes:"Editing Changes",editing_data:"Modifier les donnes",editing_attributes:"Modifier les attributs",relations:"Relations",edit_relation:"Modifier la relation",back_to_relations:"Retour aux relations",no_relations_found:"Il n'y a pas de relations",relation_data:"Donn√©es sur les relations",relation_already_added:"Relation d√©j√† pr√©sente",list_of_relations_feature:"Lister les relations de la fonctionnalit√©",tooltip:{edit_layer:"Modifier le layer"},toolbox:{title:"Modifier"},table:{edit:"Modifier fonctionnalit√©s",copy:"Cr√©er une copie",delete:"Supprimer la fonctionnalit√©"},tools:{copy:"Copier les fonctionnalit√©s",pastefeaturesfromotherlayers:"Paste features from other layer",addpart:"Ajouter une pi√®ce √† la g√©om√©trie",deletepart:"Supprimer la partie de la g√©om√©trie",merge:"Dissoudre les fonctionnalit√©s",split:"Couper la fonctionnalit√©",add_feature:"Ajouter une fonctionnalit√©",delete_feature:"Supprimer la fonctionnalit√©",move_feature:"D√©placez la fonctionnalit√©",update_vertex:"Mettre √† jour les sommets des fonctionnalit√©s",update_feature:"Modifier les attributs des fonctionnalit√©s",update_multi_features:"Modifier les attributs des fonctionnalit√©s s√©lectionn√©es",copyfeaturefromexternallayer:"Create Feature from added layer"},toolsoftool:{measure:"Show measure",snap:"Snap layer",snapall:"Snap to all layers"},steps:{help:{select_elements:"S√©lectionner les fonctionnalit√©s",select_element:"S√©lectionner une fonctionnalit√©",copy:"Cr√©er une copie des fonctionnalit√©s s√©lectionn√©es",merge:"Dissoudre les fonctionnalit√©s",split:"Couper la fonctionnalit√©",new:"Cr√©er une nouvelle fonctionnalit√©",edit_table:"Modifier les fonctionnalit√©s de la table",draw_new_feature:"Dessiner une fonctionnalit√© sur la carte",action_confirm:"Confirmer l'action",double_click_delete:"S√©lectionner la fonctionnalit√© sur la carte √† supprimer",edit_feature_vertex:"Modifier ou ajouter un sommet √† la fonctionnalit√© s√©lectionn√©e",move:"D√©placer la fonctionnalit√© s√©lectionn√©e",select_feature_to_relation:"S√©lectionner la fonctionnalit√© que vous souhaitez mettre en relation",show_edit_feature_form:"Afficher le formulaire de la fonctionnalit√© permettant de modifier les attributs",pick_feature:"S√©lectionner l'√©l√©ment de la carte √† modifier",insert_attributes_feature:"Ins√©rer les attributs de la fonctionnalit√©"}},workflow:{steps:{select:"Cliquer sur la fonctionnalit√© √† s√©lectionner",draw_part:"Dessiner la nouvelle partie",draw_geometry:"Dessiner la g√©om√©trie",merge:"S√©lectionner la fonction √† introduire en fondu",selectPoint:"Cliquer sur la fonctionnalit√© pour la s√©lectionner",selectSHIFT:"S√©lectionner des fonctionnalit√©s en maintenant la touche SHIFT enfonc√©e",selectDrawBox:"S√©lectionner les fonctionnalit√©s en dessinant un rectangle par la cr√©ation des deux points de la diagonale",selectDrawBoxAtLeast2Feature:"S√©lectionner au moins 2 fonctionnalit√©s en dessinant un rectangle par la cr√©ation des deux points de la diagonale",selectPointSHIFT:"S√©lectionner des caract√©ristiques en maintenant la touche SHIFT enfonc√©e (multi-s√©lection) ou en cliquant sur une seule caract√©ristique",selectMultiPointSHIFT:"S√©lectionner des fonctionnalit√©s en maintenant la touche SHIFT appuy√©e ou en cliquant sur la fonctionnalit√© individuelle",selectMultiPointSHIFTAtLeast2Feature:"S√©lectionner au moins 2 fonctionnalit√©s en maintenant la touche SHIFT appuy√©e ou en cliquant sur la fonctionnalit√© individuelle",copyCTRL:"Copier les fonctionnalit√©s s√©lectionn√©es avec CTRL+C",selectStartVertex:"S√©lectionner le sommet de d√©part des fonctionnalit√©s choisies",selectToPaste:"S√©lectionner le point o√π les fonctionnalit√©s s√©lectionn√©es seront coll√©es",draw_split_line:"Tracez une ligne pour couper la fonctionnalit√© s√©lectionn√©e"},title:{steps:"√âtapes"},next:"Suivant"},messages:{featureslockbyotheruser:"Certaines g√©om√©tries/enregistrements ne sont pas modifiables car ils ont √©t√© modifi√©s par un autre utilisateur",splitted:"Fonctionnalit√©(s) divis√©(es)",nosplittedfeature:"La (les) fonctionnalit√©(s) n‚Äôa (n'ont) pas √©t√© divis√©(es)",press_esc:"Appuyez sur ESC pour revenir",online:"Vous √™tes √† nouveau EN LIGNE. Vous pouvez enregistrer les modifications de fa√ßon permanente",offline:"Vous √™tes HORS LIGNE. Toutes les modifications seront enregistr√©es temporairement en local",delete_feature:"Voulez-vous supprimer la fonctionnalit√© s√©lectionn√©e ?",delete_feature_relations:"La suppression d'une fonctionnalit√© avec des relations associ√©es laissera ces relations orphelines. Il est recommand√© de g√©rer ces relations avant de supprimer la fonctionnalit√©",unlink_relation:"Voulez-vous d√©tacher la relation ?",commit_feature:"Sommaire des changements",toolbox_has_relation:"cette couche fait partie d'une relation",saved:"Les donn√©es ont √©t√© enregistr√©es correctement",saved_local:"Les donn√©es ont √©t√© correctement sauvegard√©es localement",loading_data:"Chargement des donn√©es",saving:"Sauvegarde des donn√©es. Veuillez patienter ...",constraints:{enable_editing:"Augmenter le niveau de zoom pour permettre l'√©dition \nEchelle de d√©clenchement 1 :"},pdf:"Aper√ßu du document non disponible. Cliquez ici ",commit:{header:"La liste ci-dessous montre toutes les modifications qui seront enregistr√©es.",header_relation:"Relation",header_add:"<b>Ajouts</b> indique le nombre de fonctionnalit√©s ajout√©es",header_update_delete:"<b>Modifi√©</b> e <b>Supprim√©</b> liste les ids",add:"Ajout√©",delete:"Supprim√©",update:"Modifi√©"},loading_table_data:"Building Data Table. Please wait ...",copy_and_paste_from_other_layer_mandatory_fields:"Avant d'enregistrer, il est n√©cessaire de remplir tous les champs obligatoires du features saisi",no_feature_selected:"Aucune feature s√©lectionn√©e",select_min_2_features:"Select at least 2 features"},relation:{table:{info:"<div>S√©lectionner les relations pour les associer √† l'√©l√©ment en cours d'√©dition.</div>"},draw_new_feature:"Dessiner une nouvelle feature",draw_or_copy:"ou",copy_feature_from_other_layer:"Copier feature d'une autre layer"},form:{relations:{tooltips:{back_to_father:"Back to edit father",add_relation:"Cr√©er et ajouter une nouvelle relation",link_relation:"Associer une relation existante √† cette fonctionnalit√©",open_relation_tools:"Outils de relation ouverte",unlink_relation:"Annuler la relation"}},buttons:{save:"Ins√©rer/Modifier",save_and_back:"Sauvegarder et retourner au parent",save_and_back_table:"Sauvegarder et et revenir en arri√®re",cancel:"Ignorer modifications"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Select feature/s",edit_attributes:"Edit attributes of pasted features in multiple mode"},copyfeaturefromprojectlayer:{title:"Select a feature"}}}}},{}],20:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n=d(e("./it")),a=d(e("./en")),r=d(e("./fi")),o=d(e("./se")),s=d(e("./fr")),l=d(e("./de")),u=d(e("./ro")),e=d(e("./pl"));function d(e){return e&&e.__esModule?e:{default:e}}i.default={it:n.default,en:a.default,fi:r.default,se:o.default,fr:s.default,de:l.default,ro:u.default,pl:e.default}},{"./de":16,"./en":17,"./fi":18,"./fr":19,"./it":21,"./pl":22,"./ro":23,"./se":24}],21:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={close_editing_panel:{message:"Per terminare clicca su ogni segno di spunta"},errors:{no_layers:"Si √® verificato un errore nel caricamento dei layers in editing.",some_layers:"Si √® verificato un errore nel caricamento di alcuni layers in editing",editing_multiple_relations:"Le modifica di relazioni multiple non √® attualmente supportata"},search:"Cerca",editing_changes:"Modifiche Editing",editing_data:"Modifica dati",editing_attributes:"Edita attributi",relations:"Relazioni",edit_relation:"Edita relazione",back_to_relations:"Ritorna alle Relazioni",no_relations_found:"Non ci sono relazioni",relation_data:"Dati relativi alla relazione",relation_already_added:"Relazione gi√† presente",list_of_relations_feature:"Elenco Relazioni della feature ",tooltip:{edit_layer:"Modifica livello",filter_by_relation:"Filtra i livelli per relazione"},toolbox:{title:"Edita"},table:{edit:"Edita feature",copy:"Crea una copia",delete:"Cancella feature"},tools:{copy:"Copia elementi",pastefeaturesfromotherlayers:"Incolla elemento da altro livello",addpart:"Aggiungi parte alla geometria",deletepart:"Cancella parte dalla geometria",merge:"Dissolvi elementi",split:"Dividi elementi",add_feature:"Aggiungi elemento",delete_feature:"Elimina elemento",move_feature:"Muovi elemento",update_vertex:"Aggiorna vertici elemento",update_feature:"Modifica attributi elemento",update_multi_features:"Modifica gli attributi degli elementi selezionati",copyfeaturefromexternallayer:"Crea elemento da un livello esterno"},toolsoftool:{measure:"Visualizza misura",snap:"Snap sul layer",snapall:"Snap su tutti i layer"},steps:{help:{select_elements:"Seleziona le geometrie",select_element:"Seleziona l'elemento",copy:"Crea una copia degli elementi selezionati",merge:"Dissolvi elementi",split:"Dvidi elemento",new:"Crea un nuovo elemento",edit_table:"Modifica gli elementi della tabella",draw_new_feature:"Disegna la nuova geometria",action_confirm:"Conferma azione",double_click_delete:"Seleziona la geometria sulla mappa da cancellare",edit_feature_vertex:"Modifica o aggiungi un vertice alla geometria selezionata",move:"Muovi la geometria selezionata",select_feature_to_relation:"Seleziona la geometria che vuoi mettere in relazione",show_edit_feature_form:"Mostra il modulo per modificare gli attributi del'elemento",pick_feature:"Seleziona la geometria da modificare dalla mappa",insert_attributes_feature:"Inserisci gli attributi dell'elemento"}},workflow:{steps:{select:"Seleziona una geometria",draw_part:"Disegna il nuovo elemento da aggiungere alla geometria",draw_geometry:"Disegna la geometria",merge:"Seleziona la geometria su cui dissolvere",selectPoint:"Clicca sulla geometria per selezionarla",selectSHIFT:"Seleziona le geometrie tenedo premuto il tasto SHIFT",selectDrawBox:"Seleziona le geometrie disegnando un rettangolo mediante la creazione dei due punti della diagonale",selectDrawBoxAtLeast2Feature:"Seleziona almeno 2 geometrie disegnando un rettangolo mediante la creazione dei due punti della diagonale",selectPointSHIFT:"Seleziona le geometrie <br><sub><code>MAIUSC+DRAG</code> seleziona pi√π elementi in un area</sub>",selectMultiPointSHIFT:"Seleziona le geometrie <br><sub><code>SHIFT+DRAG</code> seleziona pi√π elementi in un area</sub>",selectMultiPointSHIFTAtLeast2Feature:"Seleziona almeno 2 geometrie <br><sub><code>SHIFT+DRAG</code> seleziona pi√π elementi in un area</sub>",copyCTRL:"Copia le geometrie selezionate con CTRL+C",selectStartVertex:"Seleziona il vertice di partenza",selectToPaste:"Seleziona il punto dove verranno incollate le geometrie",draw_split_line:"Disegna una linea per dividere la geometria selezionata"},title:{steps:"Passi"},next:"Avanti"},messages:{featureslockbyotheruser:"Ci sono alcune geometrie/records non editabili perch√® in modifica da altri utenti",splitted:"Feature(s) splittata(e)",nosplittedfeature:"La(e) feature(s) non √® stata splittata",press_esc:"Premi ESC per tornare indietro",online:"Ora sei di nuovo ONLINE. Puoi slavare le modifiche in modo permanente",offline:"Sei OFFLINE. Tutte le modifiche saranno salvate temporaneamente in locale",delete_feature:"Vuoi eliminare l'elemento selezionato?",delete_feature_relations:"Cancellando una feature con relazioni associate, tale relazioni rimarranno orfane. Si consiglia di gestire tali relazioni prima di cancellare la feature",unlink_relation:"Vuoi staccare la relazione?",commit_feature:"Riepilogo modifiche",toolbox_has_no_geometry:"questo livello non ha geometria",toolbox_has_relation:"questo livello fa parte di una relazione",saved:"I dati sono stati salvati correttamente",saved_local:"I dati sono stati salvati correttamente in locale",loading_data:"Caricamento dati",saving:"Salvataggio dati in corso. Attendere ...",constraints:{enable_editing:"Ingrandisci per modificare \nScala di attivazione 1:"},pdf:"Anteprima del documento non disponibile. Clicca qui ",commit:{header:"La lista sotto riporta tutte le modifiche che verranno salvate.",header_relation:"Relazione",header_add:"<b>Aggiunte</b> riporta il numero delle features aggiunte",header_update_delete:"<b>Modificate</b> e <b>Cancellate</b> riporta la lista degli id",add:"Aggiunte",delete:"Cancellate",update:"Aggiornate"},loading_table_data:"Costruzione tabella dati in corso. Attendere ...",copy_and_paste_from_other_layer_mandatory_fields:"Necessario compilare eventuali campi obbligatori sulle features incollate prima del salvataggio",no_feature_selected:"Nessuna feature selezionata",select_min_2_features:"Seleziona come minimo due features"},relation:{table:{info:"<div>Seleziona le relazioni per associarle alla feature in editing.</div>"},draw_new_feature:"Disegna nuova geometria",draw_or_copy:"oppure",copy_feature_from_other_layer:"Copia geometria da altro layer"},form:{relations:{tooltips:{back_to_father:"Torna ad editare il padre",add_relation:"Crea ed aggiungi nuova relazione",link_relation:"Associa una relazione esistente a questa feature",open_relation_tools:"Apri strumenti relatione",unlink_relation:"Annulla relazione"}},buttons:{save:"Inserisci/Modifica",save_table:"Modifica",save_and_back:"Salva e torna al padre",save_and_back_table:"Salva e torna indietro",cancel:"Ignora Modifiche"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Seleziona feature/s",edit_attributes:"Edita attributi delle features in multiple mode"},copyfeaturefromprojectlayer:{title:"Seleziona una feature"}}}}},{}],22:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={errors:{no_layers:"An error occurs. It's no possible to edit layers",some_layers:"An error occurs: It's no possible to edit some layers"},search:"Search",editing_changes:"Editing Changes",editing_data:"Editing Layers",editing_attributes:"Editing attributes",relations:"Relations",edit_relation:"Edit relation",back_to_relations:"Back to Relations",no_relations_found:"No relations found",relation_data:"Relation data",relation_already_added:"Relation already added",list_of_relations_feature:"List of relations feature ",tooltip:{edit_layer:"Edit Layer"},toolbox:{title:"Edit"},table:{edit:"Edit feature",copy:"Create a copy",delete:"Delete feature"},tools:{copy:"Copy features",pastefeaturesfromotherlayers:"Paste features from other layer",addpart:"Add part to multipart",deletepart:"Delete part from multipart",merge:"Dissolve features",split:"Split Feature",add_feature:"Add feature",delete_feature:"Delete feature",move_feature:"Move feature",update_vertex:"Update feature vertex",update_feature:"Update feature attribute",update_multi_features:"Update attributes of selected features",copyfeaturefromexternallayer:"Create Feature from added layer"},toolsoftool:{measure:"Show measure",snap:"Snap layer",snapall:"Snap to all layers"},steps:{help:{select_elements:"Select features",select_element:"Select feature",copy:"Create new copy of selected features",merge:"Dissolve features",split:"Split Feature",new:"Create new feature",edit_table:"Edit table features",draw_new_feature:"Draw feature on map",action_confirm:"Confirm action",double_click_delete:"Select feature on map to delete",edit_feature_vertex:"Modify or add a vertex on selected feature",move:"Move selected feature",select_feature_to_relation:"Select feature that you bind relation",show_edit_feature_form:"Show feature form to edit attributes",pick_feature:"Select feature on map to modify",insert_attributes_feature:"Insert attributes of the feature"}},workflow:{steps:{select:"Click on feature to select",draw_part:"Draw new part",merge:"Select featurewhere dissolve",selectSHIFT:"Select features drawing a rectangle pressing SHIFT",selectDrawBox:"Select features drawing a rectangle by two point of opposite corners",selectDrawBoxAtLeast2Feature:"Select at least features drawing a rectangle by two point of opposite corners",selectPoint:"Click on feature to select",selectPointSHIFT:"Select features drawing a rectangle pressing SHIFT (multifeatures) or click on one feature",selectMultiPointSHIFT:"Select features drawing a rectangle pressing SHIFT or click on feature",selectMultiPointSHIFTAtLeast2Feature:"Select at least 2 features drawing a rectangle pressing SHIFT or click on feature",copyCTRL:"Copy selected features using CTRL+C",selectStartVertex:"Select starting vertex of selected features",selectToPaste:"Select the point where paste the features selected",draw_split_line:"Draw a line to split selected feature"},title:{steps:"Steps"},next:"Next"},messages:{featureslockbyotheruser:"Some geometries/records are not editable because in editing by other user",splitted:"Splitted",nosplittedfeature:"Feature not spitted",press_esc:"Press ESC to back",online:"Back ONLINE. Now you can save your changes on database",offline:"You are OFFLINE. All changes are saved locally",delete_feature:"Do you want delete selected feature ?",delete_feature_relations:"If feature has bindings relations, these relations become orphans. We suggest to handle these relations before detele this feature",unlink_relation:"Do you want unlink relation?",commit_feature:"Do you want to save the changes",toolbox_has_relation:"this layer is part of a relation",saved:"Data saved successfully",saved_local:"Data saved locally successfully",loading_data:"Loading data",saving:"Saving data. Please wait ...",constraints:{enable_editing:"Please Zoom In to enable editing tools \nActivation scale at 1:"},pdf:"Document preview not available. Please click here ",commit:{header:"The following list show all changes to commit.",header_add:"<b>Added</b> show the number of features added",header_update_delete:"<b>Modified</b> and <b>Deleted</b> show the list of features id",add:"Added(n. features)",delete:"Deleted(id)",update:"Modified(id)"},loading_table_data:"Building Data Table. Please wait ...",copy_and_paste_from_other_layer_mandatory_fields:"It is necessary to fill in any mandatory fields on the features pasted before saving",no_feature_selected:"No feature selected",select_min_2_features:"Select at least 2 features"},relation:{table:{info:"<div>Select relations to link it to current editing feature.</div>"},draw_new_feature:"Draw new feature",draw_or_copy:"or",copy_feature_from_other_layer:"Copy feature from other layer"},form:{relations:{tooltips:{back_to_father:"Back to edit father",add_relation:"Create and link new relation",link_relation:"Join a relation to this feature",open_relation_tools:"Show relation tools",unlink_relation:"Unlink relation"}},buttons:{save:"Insert/Edit",save_and_back:"Save and Back",save_and_back_table:"Save and Back",cancel:"Ignore Changes"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Select feature/s",edit_attributes:"Edit attributes of pasted features in multiple mode"},copyfeaturefromprojectlayer:{title:"Select a feature"}}}}},{}],23:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={close_editing_panel:{message:"To close editing form need to exit from editing layer"},errors:{no_layers:"Avem o eroare. Straturile nu sunt editabile",some_layers:"Avem o eroare: Anumite straturi nu se pot edita"},search:"CautƒÉ",editing_changes:"Modificare schimbƒÉri",editing_data:"Modificare straturi",editing_attributes:"Modificare atribute",relations:"Rela»õii",edit_relation:"ModificƒÉ rela»õia",back_to_relations:"√énapoi la Rela»õii",no_relations_found:"Nu am gƒÉsit rela»õii",relation_data:"Date rela»õii",relation_already_added:"Rela»õie adƒÉugatƒÉ deja",list_of_relations_feature:"Lista rela»õii entitatea ",tooltip:{edit_layer:"ModificƒÉ strat"},toolbox:{title:"ModificƒÉ"},table:{edit:"ModificƒÉ entitate",copy:"CreeazƒÉ o copie",delete:"EliminƒÉ entitatea"},tools:{copy:"CopiazƒÉ entitƒÉ»õile",pastefeaturesfromotherlayers:"Paste features from other layer",addpart:"AdaugƒÉ o parte la multiparte",deletepart:"EliminƒÉ partea din multiparte",merge:"Dizolvare entitƒÉ»õi",split:"Divizare Entitate",add_feature:"AdaugƒÉ entitate",delete_feature:"Eliminare entitate",move_feature:"MutƒÉ entitate",update_vertex:"ActualizeazƒÉ vertec»ôii entitƒÉ»õii",update_feature:"ActualizeazƒÉ atributul entitƒÉ»õii",update_multi_features:"ActualizeazƒÉ atributele entitƒÉ»õilor selectate",copyfeaturefromexternallayer:"Create Feature from added layer"},toolsoftool:{measure:"AratƒÉ mƒÉsurƒÉtorile",snap:"Acro»ôare strat",snapall:"Acro»ôare pe toate straturile"},steps:{help:{select_elements:"SelecteazƒÉ entitƒÉ»õi",select_element:"SelecteazƒÉ entitate",copy:"CreeazƒÉ o nouƒÉ copie a entitƒÉ»õilor selectate",merge:"DizolvƒÉ entitƒÉ»õile",split:"Divizare Entitate",new:"CreeazƒÉ o entitate",edit_table:"ModificƒÉ entitƒÉ»õile tabelare",draw_new_feature:"DeseneazƒÉ entitate pe hartƒÉ",action_confirm:"ConfirmƒÉ ac»õiunea",double_click_delete:"SelecteazƒÉ entitatea de eliminat din hartƒÉ",edit_feature_vertex:"ModificƒÉ sau adaugƒÉ un vertex la entitatea selectatƒÉ",move:"MutƒÉ entitatea selectatƒÉ",select_feature_to_relation:"SelecteazƒÉ entitate pentru rela»õionare",show_edit_feature_form:"AratƒÉ formularul entitƒÉ»õii pentru modificƒÉri",pick_feature:"SelecteazƒÉ entitƒÉ»õile de modificat din hartƒÉ",insert_attributes_feature:"InsereazƒÉ atributele entitƒÉ»õii"}},workflow:{steps:{select:"Click pe entitate pentru a o selecta",draw_part:"DeseneazƒÉ o parte nouƒÉ",draw_geometry:"Desena»õi geometria",merge:"SelecteazƒÉ partea de dizolvat",selectSHIFT:"SelecteazƒÉ entitƒÉ»õi prin desen triunghi apƒÉs√¢nd SHIFT",selectDrawBox:"SelecteazƒÉ entitƒÉ»õi desen√¢nd un dreptunghi prin douƒÉ puncte opuse",selectDrawBoxAtLeast2Feature:"SelecteazƒÉ cel pu»õin 2 entitƒÉ»õi prin desenul unui dreptunghi",selectPoint:"Click pe entitate pentru selectare",selectPointSHIFT:"SelecteazƒÉ entitƒÉ»õi prin desen dreptunghi apƒÉs√¢nd SHIFT (multientitƒÉ»õi) sau prin click pe entitate",selectMultiPointSHIFT:"SelecteazƒÉ entitƒÉ»õi prin desen dreptunghi apƒÉs√¢nd SHIFT sau prin click pe entitate",selectMultiPointSHIFTAtLeast2Feature:"SelecteazƒÉ cel pu»õin 2 entitƒÉ»õi prin desen dreptunghi apƒÉs√¢nd SHIFT sau prin click pe entitate",copyCTRL:"CopiazƒÉ entitƒÉ»õile selectate folosint CTRL+C",selectStartVertex:"SelecteazƒÉ vertexul de start a entitƒÉ»õilor selectate",selectToPaste:"SelecteazƒÉ punctul unde sƒÉ lipim entitƒÉ»õile selectate",draw_split_line:"DeseneazƒÉ o linie pentru a diviza entitatea selectatƒÉ"},title:{steps:"Pa»ôi"},next:"UrmƒÉtorul"},messages:{featureslockbyotheruser:"Unele geometrii/√ÆnregistrƒÉri nu sunt editabile deoarece sunt editate de cƒÉtre alt utilizator",splitted:"Divizat",nosplittedfeature:"Entitate nedivizatƒÉ",press_esc:"ESC pentru √Ænapoi",online:"√énapoi ONLINE. Acum se pot salva schimbƒÉrile",offline:"OFFLINE. SchimbƒÉrile sunt salvate local",delete_feature:"»òterg entitatea selectatƒÉ?",delete_feature_relations:"DacƒÉ entitatea are rela»õii care trimit la ea, acele rela»õii devin orfane. SugerƒÉm sƒÉ vƒÉ ocupa»õi de acele elemente √Ænainte sƒÉ elimina»õi aceastƒÉ entitate.",unlink_relation:"Dore»ôti sƒÉ elimina»õi legƒÉtura cu rela»õia?",commit_feature:"Rezumatul modificƒÉrilor",toolbox_has_relation:"acest strat face parte dintr-o rela»õie",saved:"Datele sunt salvate",saved_local:"Datele s-au salvat local",loading_data:"Datele se √ÆncarcƒÉ.",saving:"SalvƒÉm datele. A»ôtepta»õi ...",constraints:{enable_editing:"Pentru a activa Modificare face»õi zoom la \nScara de activare 1:"},pdf:"Previzualizarea documentului nu este disponibilƒÉ. Click aici ",commit:{header:"Lista cu toate modificƒÉrile.",header_relation:"Relation",header_add:"<b>AdƒÉugate</b> aratƒÉ nr. de entitƒÉ»õi adƒÉugate",header_update_delete:"<b>Modificate</b> »ôi <b>»òterse</b> aratƒÉ lista de id-uri de entitƒÉ»õi",add:"AdƒÉugate",delete:"Eliminate",update:"Modificate"},loading_table_data:"√éncƒÉrcƒÉm tabelul de date ...",copy_and_paste_from_other_layer_mandatory_fields:"√énainte de a salva, este necesar sƒÉ completa»õi toate c√¢mpurile obligatorii ale entitƒÉ»õi introduse",no_feature_selected:"Nicio feature selectatƒÉ",select_min_2_features:"Select at least 2 features"},relation:{table:{info:"<div>SelecteazƒÉ rela»õiile pentru a face legƒÉtura cu entitatea curentƒÉ.</div>"},draw_new_feature:"Desena»õi o nouƒÉ feature",draw_or_copy:"sau",copy_feature_from_other_layer:"Copia»õi feature dintr-un alt layer"},form:{relations:{tooltips:{back_to_father:"√énapoi la modificƒÉrile entitƒÉ»õii pƒÉrinte",add_relation:"CreeazƒÉ »ôi fƒÉ legƒÉtura unei rela»õii noi",link_relation:"LeagƒÉ o rela»õie de entitate",open_relation_tools:"AratƒÉ instrumentele pentru rela»õii",unlink_relation:"EliminƒÉ legƒÉtura la rela»õie"}},buttons:{save:"Insera»õi/Edita»õi",save_and_back:"SalveazƒÉ »ôi dƒÉ √Ænapoi",save_and_back_table:"SalveazƒÉ »ôi dƒÉ √Ænapoi",cancel:"Ignora»õi modificƒÉrile"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Select feature/s",edit_attributes:"Edit attributes of pasted features in multiple mode"},copyfeaturefromprojectlayer:{title:"Select a feature"}}}}},{}],24:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={close_editing_panel:{message:"To close editing form need to exit from editing layer"},errors:{no_layers:"Ett fel uppstod. Niv√•erna kan inte redigeras.",some_layers:"Ett fel uppstod. Vissa niv√•er kan inte redigeras."},search:"S√∂kning",editing_changes:"Editing Changes",editing_data:"Niv√•erna redigeras",editing_attributes:"Attributen redigeras",relations:"Relationer",edit_relation:"Redigera relationen",back_to_relations:"Tillbaka till relationerna",no_relations_found:"Inga relationer hittades",relation_data:"Relationsuppgifter",relation_already_added:"Relationen har redan lagts till",list_of_relations_feature:"Lista p√• relationens egenskaper",tooltip:{edit_layer:"Redigera niv√•n"},toolbox:{title:"Redigera"},table:{edit:"Redigera egenskap",copy:"Skapa en kopia",delete:"Ta bort egenskap"},tools:{copy:"Kopiera egenskaper",pastefeaturesfromotherlayers:"Paste features from other layer",addpart:"L√§gg till del",deletepart:"Ta bort del",merge:"Sl√• samman egenskaper",split:"Dela upp egenskap",add_feature:"L√§gg till egenskap",delete_feature:"Ta bort egenskap",move_feature:"Flytta egenskap",update_vertex:"Uppdatera punktens egenskap",update_feature:"Uppdatera egenskap",update_multi_features:"√Ñndra attributen f√∂r de valda funktionerna",copyfeaturefromexternallayer:"Create Feature from added layer"},toolsoftool:{measure:"Show measure",snap:"Snap layer",snapall:"Snap to all layers"},steps:{help:{select_elements:"V√§lj egenskaper",select_element:"V√§lj egenskapalitse ominaisuus",copy:"Skapa kopia av valda egenskaper",merge:"Sl√• samman egenskaper",split:"Dela upp egenskap",new:"Skapa ny egenskap",edit_table:"√Ñndra egenskaper i tabellen",draw_new_feature:"Piirr√§ ominaisuus kartalle",action_confirm:"Godk√§nn funktionen",double_click_delete:"V√§lj funktionen som du vill ta bort p√• kartan",edit_feature_vertex:"√Ñndra punkten eller l√§gg till punkten till den valda egenskapen",move:"Flytta den valda egenskapen",select_feature_to_relation:"V√§lj relation",show_edit_feature_form:"Visa egenskapsformul√§ret f√∂r redigering av attribut",pick_feature:"V√§lj funktion p√• kartan f√∂r att √§ndras",insert_attributes_feature:"L√§gg till egenskapens attribut"}},workflow:{steps:{select:"V√§lj egenskap",draw_part:"Rita ny del",draw_geometry:"Rita geometri",merge:"V√§lj egenskap att sl√• samman",selectSHIFT:"Tryck SHIFT, om du vill v√§lja objekt med hj√§lp av rektangel.",selectDrawBox:"Rita upp den rektangel inom vilken objekten v√§ljs ",selectDrawBoxAtLeast2Feature:"Rita rektangeln inom vilken minst tv√• objekt √§r markerade ",selectPoint:"V√§lj egenskap",selectPointSHIFT:"Tryck SHIFT, om du vill v√§lja objekt med hj√§lp av rektangel, eller v√§lj en enskild egenskap.",selectMultiPointSHIFT:"Tryck SHIFT, om du vill v√§lja objekt med hj√§lp av rektangel, eller v√§lj en enskild egenskap.",selectMultiPointSHIFTAtLeast2Feature:"Tryck p√• SKIFT f√∂r att v√§lja minst tv√• objekt med en rektangel eller v√§lj en enda egenskap. ",copyCTRL:"CTRL+C, du kan kopiera valda egenskaper.",selectStartVertex:"Visa startpunkten f√∂r valda egenskaper.",selectToPaste:"V√§lj punkt till vilken de valda egenskaperna ska fogas.",draw_split_line:"Rita en linje enligt vilken den valda egenskapen ska uppdelas."},title:{steps:"Skeden"},next:"N√§sta"},messages:{featureslockbyotheruser:"Jotkut geometriat/tietueet eiv√§t ole muokattavissa, koska muut k√§ytt√§j√§t muokkaavat niit√§",splitted:"Uppdelad",nosplittedfeature:"Egenskapen har inte delats upp",press_esc:"Tryck ESC f√∂r att g√• tillbaka",online:"F√∂rbindelsen har uppr√§ttats. √Ñndringar kan sparas i databasen.",offline:"Du √§r i offline-l√§ge. √Ñndringarna sparas lokalt",delete_feature:"Vill du ta bort den valda egenskapen?",delete_feature_relations:"Om egenskapen saknar bindande relationer blir dessa relationer f√∂r√§ldral√∂sa. Vi rekommenderar att du behandlar dessa relationer innan du l√§mnar programmet",unlink_relation:"Vill du ta bort relationen?",commit_feature:"Sammanfattning av √§ndringar",toolbox_has_relation:"detta lager √§r en del av en relation",saved:"Uppgifterna sparades",saved_local:"Uppgifterna sparades lokalt.",loading_data:"Uppgifterna laddas",saving:"Uppgifterna sparas. V√§nta...",constraints:{enable_editing:"Zooma in f√∂r att b√∂rja anv√§nda redigeringsverktyg \nAktivering skala 1:"},pdf:"F√∂rhandsgranskning av dokument √§r inte tillg√§nglig. Tryck h√§r",commit:{header:"F√∂ljande lista visar alla √§ndringar.",header_relation:"Relation",header_add:"<b>Tillagda</b> visar antalet egenskaper som lagts till",header_update_delete:"<b>Redigerad</b> och <b>Borttagen</b> Visa en lista p√• egenskapernas id",add:"har lagts till",delete:"Borttagen",update:"Redigerad"},loading_table_data:"Building Data Table. Please wait ...",copy_and_paste_from_other_layer_mandatory_fields:"It is necessary to fill in any mandatory fields on the features pasted before saving",no_feature_selected:"No feature selected",select_min_2_features:"Select at least 2 features"},relation:{table:{info:"<div>V√§lj relation f√∂r l√§nkning till egenskap som ska redigeras.</div>"},draw_new_feature:"Draw new feature",draw_or_copy:"or",copy_feature_from_other_layer:"Copy feature from other layer"},form:{relations:{tooltips:{back_to_father:"Back to edit father",add_relation:"Skapa och l√§nka ny relation",link_relation:"Foga relationen till denna egenskap",open_relation_tools:"Visa relationsverktyg",unlink_relation:"Ta bort relation"}},buttons:{save:"Infoga/Redigera",save_and_back:"Spara och g√• tillbaka",save_and_back_table:"Spara och g√• tillbaka",cancel:"Ignorera √§ndringar"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Select feature/s",edit_attributes:"Edit attributes of pasted features in multiple mode"},copyfeaturefromprojectlayer:{title:"Select a feature"}}}}},{}],25:[function(F,i,a){var x=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,n=arguments[t];for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},c=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var e,f=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var i=t,n=[],a=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!i||n.length!==i);a=!0);}catch(e){t=!0,r=e}finally{try{!a&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},E=(e=R(function*(){return Promise.allSettled(Object.entries(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).flatMap(function(e){var t,i,n,e=f(e,2),a=e[0],e=e[1],r=e.add,o=e.delete,s=e.update,e=e.relations,e=void 0===e?{}:e,l=(0,y.getEditingLayerById)(a).getEditingSource(),u=0<l.readFeatures().length;return[].concat(L((u&&r||[]).map((n=R(function*(e){e=e.id;l.removeFeature(l.getFeatureById(e))}),function(e){return n.apply(this,arguments)}))),L((u&&s||[]).map((i=R(function*(e){var e=e.id,t=yield(0,d.getProjectLayerFeatureById)({layerId:a,fid:e}),e=l.getFeatureById(e);e.setProperties(t.properties),e.setGeometry(t.geometry)}),function(e){return i.apply(this,arguments)}))),L(o.map((t=R(function*(e){var t=yield(0,d.getProjectLayerFeatureById)({layerId:a,fid:e}),i=new ol.Feature({geometry:t.geometry});i.setProperties(t.properties),i.setId(e),l.addFeature(new k({feature:i}))}),function(e){return t.apply(this,arguments)}))),[E(e)])}))}),function(){return e.apply(this,arguments)}),t=(F("./g3wsdk"),F("./i18n")),g=(t=t)&&t.__esModule?t:{default:t},I=F("./g3wsdk/workflow/workflow"),T=F("./g3wsdk/workflow/step"),C=F("./utils/promisify"),p=F("./utils/createFeature"),d=F("./utils/getProjectLayerFeatureById"),y=F("./utils/getEditingLayerById"),P=F("./utils/setAndUnsetSelectedFeaturesStyle"),v=F("./utils/addPartToMultigeometries"),m=F("./workflows"),h=F("./toolboxes/toolbox");function L(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function R(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,i){try{var n=s[e](i),a=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});r(a)}("next")})}}var _=g3wsdk.constant.G3W_FID,t=g3wsdk.core,O=t.ApplicationState,M=t.ApplicationService,b=g3wsdk.core.catalog.CatalogLayersStoresRegistry,t=g3wsdk.core.i18n,A=t.t,j=t.tPlugin,t=g3wsdk.core.layer,D=t.Layer,w=t.LayersStore,k=g3wsdk.core.layer.features.Feature,S=g3wsdk.core.map.MapLayersStoreRegistry,t=g3wsdk.core.plugin,B=t.Plugin,V=t.PluginService,U=g3wsdk.core.utils.noop,z=g3wsdk.gui.GUI,N=g3wsdk.gui.vue.Panel,H=g3wsdk.core.errors.parsers.Server,G=g3wsdk.core.geometry.Geometry,t=g3wsdk.ol.utils,q=t.getScaleFromResolution,W=t.getResolutionFromScale;Object.entries({Workflow:I.Workflow,OpenFormStep:m.OpenFormStep,AddFeatureStep:m.AddFeatureStep,ToolBox:h.ToolBox}).forEach(function(e){e=f(e,2);e[0],e[1]}),new(function(){var t,i,e,n,a,r,o,s,l=d,u=B;if("function"!=typeof u&&null!==u)throw new TypeError("Super expression must either be null or a function, not "+typeof u);function d(){var t;if(this instanceof d)return(t=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(d.__proto__||Object.getPrototypeOf(d)).call(this,{name:"editing",i18n:g.default,fontClasses:[{name:"measure",className:"fas fa-ruler-combined"},{name:"magnete",className:"fas fa-magnet"},{name:"clipboard",className:"fas fa-clipboard"}]}))).state={open:!1,toolboxes:[],_toolboxes:[],toolboxselected:null,showselectlayers:!0,message:null,relations:[],sessions:{},layers_in_error:!1,formComponents:{},subscribers:{},constraints:{toolboxes:{},showToolboxesExcluded:!0},featuresOnClose:{},uniqueFieldsValues:{},saveConfig:{mode:"default",modal:!1,messages:void 0,cb:{done:function(){},error:function(){}}},editableLayers:{},events:{"start-editing":{},"show-relation-editing":{},layer:{start_editing:{before:{},after:{}}}},show_errors:!1,editFeatureKey:void 0,panel:null,currentLayout:M.getCurrentLayoutName(),unwatchLayout:(new Vue).$watch(function(){return O.gui.layout.__current},function(e){return t.state.currentLayout=e!==t.getName()?e:t.state.currentLayout}),onMapControlToggled:function(e){e=e.target;e.isToggled()&&e.isClickMap()&&t.state.toolboxselected&&t.state.toolboxselected.getActiveTool()&&t.state.toolboxselected.stopActiveTool()}},t.setService(Object.assign(new V,{state:t.state,config:t.config,getSession:t.getSession.bind(t),getFeature:t.getFeature.bind(t),subscribe:t.subscribe.bind(t),unsubscribe:t.unsubscribe.bind(t),fireEvent:t.fireEvent.bind(t),undo:t.undo.bind(t),redo:t.redo.bind(t),getEditingLayer:t.getEditingLayer.bind(t),addToolBox:t.addToolBox.bind(t),runEventHandler:t.runEventHandler.bind(t),resetDefault:t.resetDefault.bind(t),resetAPIDefault:t.resetAPIDefault.bind(t),getLayers:t.getLayers.bind(t),getLayerById:t.getLayerById.bind(t),getToolBoxById:t.getToolBoxById.bind(t),getSessionById:t.getSessionById.bind(t),setApplicationEditingConstraints:t.setApplicationEditingConstraints.bind(t),getToolBoxes:t.getToolBoxes.bind(t),getEditableLayers:t.getEditableLayers.bind(t),stop:t.stop.bind(t),saveChange:t.saveChange.bind(t),commit:t.commit.bind(t),undoRedoLayerUniqueFieldValues:t.undoRedoLayerUniqueFieldValues.bind(t),undoRedoRelationUniqueFieldValues:t.undoRedoRelationUniqueFieldValues.bind(t),stopEditing:t.stopEditing.bind(t),startEditing:t.startEditing.bind(t),addLayerFeature:t.addLayerFeature.bind(t)})),z.getService("map").on("mapcontrol:toggled",t.state.onMapControlToggled),t._init(),t;throw new TypeError("Cannot call a class as a function")}return l.prototype=Object.create(u&&u.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),u&&(Object.setPrototypeOf?Object.setPrototypeOf(l,u):l.__proto__=u),c(d,[{key:"_init",value:(s=R(function*(){var i,d=this;b.getLayers({EDITABLE:!0}).length&&(this.setHookLoading({loading:!0}),this.service.setApi({api:{getSession:this.getSession.bind(this),getFeature:this.getFeature.bind(this),subscribe:this.subscribe.bind(this),unsubscribe:this.unsubscribe.bind(this),getToolBoxById:this.getToolBoxById.bind(this),addNewFeature:p.createFeature,commitChanges:this.commit.bind(this),setApplicationEditingConstraints:this.setApplicationEditingConstraints.bind(this),getMapService:function(){return z.getService("map")},updateLayerFeature:U,deleteLayerFeature:U,addLayerFeature:this.addLayerFeature.bind(this),hidePanel:this.hideEditingPanel.bind(this),resetDefault:this.resetAPIDefault.bind(this),startEditing:this.startEditing.bind(this),stopEditing:this.stopEditing.bind(this),showPanel:this.showPanel.bind(this),setSaveConfig:this.setSaveConfig.bind(this),addFormComponents:this.addFormComponents.bind(this)}}),S.addLayersStore(new w({id:"editing",queryable:!1})),this.state.editableLayers={},this.state._toolboxes=[],this.state.toolboxes=[],(yield Promise.allSettled(b.getLayers({EDITABLE:!0}).map(function(e){return e.getLayerForEditing({vectorurl:d.config.vectorurl,project_type:d.config.project_type})}))).forEach(function(e){var u;"fulfilled"!==e.status?d.state.layers_in_error=!0:(u=e.value,(d.state.editableLayers[u.getId()]=u).getEditingFields().filter(function(e){return e.input&&"select_autocomplete"===e.input.type&&!e.input.options.filter_expression&&!e.input.options.usecompleter}).forEach(function(l){return["start-editing","show-relation-editing"].forEach(function(e){var t=u.getId();d.state.events[e][t]=d.state.events[e][t]||[],d.state.events[e][t].push(R(function*(){var t=l.input.options,e=(t.loading.state="loading",t.values=[],t.layer_id&&b.getLayerById(t.layer_id)),i=-1<[void 0,null].indexOf(t.filter_fields||[])||0===(t.filter_fields||[]).length;try{if(t.relation_reference&&i){var n,a=yield u.getFilterData({fformatter:l.name});if(a&&a.data)return(n=t.values).push.apply(n,L(a.data.map(function(e){var e=f(e,2),t=e[0];return{key:e[1],value:t}}))),t.loading.state="ready",d.fireEvent("autocomplete",{field:l,data:[a.data]}),t.values}if(e){var r,o=yield(0,C.promisify)(e.getDataTable({ordering:t.key}));if(o&&o.features)return(r=t.values).push.apply(r,L((o.features||[]).map(function(e){return{key:e.properties[t.key],value:e.properties[t.value]}}))),t.loading.state="ready",d.fireEvent("autocomplete",{field:l,features:o.features}),t.values}var s=[];return t.loading.state="ready",d.fireEvent("autocomplete",{field:l,features:s}),s}catch(e){return t.loading.state="error",Promise.reject(e)}}))})}),d.state.sessions[u.getId()]=null)}),i=0,this.getLayers().forEach(function(e){var t=e.getId();b.getLayerById(t).getRelations().getArray().filter(function(e){return"ONE"===e.getType()&&t===e.getFather()}).forEach(function(t){var i=void 0!==d.getLayerById(t.getChild());d.getLayerById(t.getFather()).getEditingFields().filter(function(e){return e.vectorjoin_id&&e.vectorjoin_id===t.getId()}).forEach(function(e){e.editable=e.editable&&i})}),e.getColor()||e.setColor(e.isGeoLayer()?["#C43C39","#d95f02","#91522D","#7F9801","#0B2637","#8D5A99","#85B66F","#8D2307","#2B83BA","#7D8B8F","#E8718D","#1E434C","#9B4F07","#1b9e77","#FF9E17","#7570b3","#204B24","#9795A3","#C94F44","#7B9F35","#373276","#882D61","#AA9039","#F38F3A","#712333","#3B3A73","#9E5165","#A51E22","#261326","#e4572e","#29335c","#f3a712","#669bbc","#eb6841","#4f372d","#cc2a36","#00a0b0","#00b159","#f37735","#ffc425"][i++%40]:"#fff")}),S.getLayersStore("editing").addLayers(this.getLayers()),this.getLayers().forEach(function(e){return d.addToolBox(new h.ToolBox(e,[].concat(L(e.getChildren()),L(e.getFathers())).filter(function(e){return d.getLayerById(e)})))}),yield z.isReady(),this._setupGUI(),this.setHookLoading({loading:!1}),this.setApi(this.service.getApi()),this.setReady(!0))}),function(){return s.apply(this,arguments)})},{key:"_setupGUI",value:(o=R(function*(){var h=this;this.registerPlugin(this.config.gid)&&!1!==this.config.visible&&(this.state.editFeatureKey=z.getService("queryresults").onafter("editFeature",R(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layer,e=e.feature,i=e.attributes[_]||e.id;if(void 0!==i){h.getToolBoxes().forEach(function(e){return e.setShow(t.id===e.getId())}),h.showEditingPanel(),h.state.showselectlayers=!1,h.subscribe("closeeditingpanel",function(){return{once:h.state.showselectlayers=!0}});var e=h.getToolBoxById(t.id),n=(e.setSelected(!0),e.getSession()),a=e.getEditingConstraints().scale,r=void 0;try{a&&(o=z.getService("map").getMapUnits(),s=z.getService("map").getMap(),a<parseInt(q(s.getView().getResolution(),z.getService("map").getMapUnits())))&&s.getView().setResolution(W(a,o)),yield(0,C.promisify)(e.start({filter:{fids:i}}));var o,s,l,u,d,c,f=e.getLayer(),g=f.getEditingLayer().getSource(),p=D.LayerTypes.VECTOR===f.getType(),y=(p?g.getFeatures():g.readFeatures()).find(function(e){return i==e.getId()});y&&((l=y.getGeometry())&&z.getService("map").zoomToGeometry(l),e.setSelected(!0),h.state.toolboxselected=e,(u=p&&!l&&e.getTools().find(function(e){return"addPart"===e.getId()}))&&!G.isMultiGeometry(f.getGeometryType())&&(u.visible=!0),u&&(d=u.getOperator(),c=new I.Workflow({type:"drawgeometry",helpMessage:"editing.workflow.steps.draw_geometry",runOnce:!0,steps:[new m.AddFeatureStep({add:!1,steps:{addfeature:{description:"editing.workflow.steps.draw_geometry"}},onRun:function(e){var t=e.inputs;e.context;c.emit("settoolsoftool",[{type:"snap",options:{layerId:t.layer.getId(),source:t.layer.getEditingLayer().getSource(),active:!0}},{type:"measure",options:{active:!1}}]),c.emit("active",["snap"])},onStop:function(){return c.emit("deactive",["snap","measure"])}}),new T.Step({run:v.addPartToMultigeometries})],registerEscKeyEvent:!0}),u.setOperator(c),h.subscribe("closeeditingpanel",function(){u.setOperator(d),u.visible=G.isMultiGeometry(f.getGeometryType())})),r=new I.Workflow({type:"editnopickmapfeatureattributes",runOnce:!0,helpMessage:"editing.tools.update_feature",steps:[new m.OpenFormStep]}),yield(0,C.promisify)(r.start({inputs:{layer:f,features:[y]},context:{session:n}})),yield(0,C.promisify)(n.save()),h.saveChange())}catch(e){n.rollback()}finally{r.stop()}}})),this.config.name=this.config.name||"plugins.editing.editing_data",this.addToolGroup({position:0,title:"EDITING"}),this.addTools({action:this.showEditingPanel,offline:!1,icon:"pencil"},{position:0,title:"EDITING"}))}),function(){return o.apply(this,arguments)})},{key:"getSession",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).layerId;return this.getToolBoxById(e).getSession()}},{key:"getFeature",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).layerId;return this.getToolBoxById(e).getActiveTool().getLayer().features[0]}},{key:"subscribe",value:function(e,t){return this.state.subscribers[e]||(this.state.subscribers[e]=[]),this.state.subscribers[e].find(function(e){return t===e})||this.state.subscribers[e].push(t),t}},{key:"unsubscribe",value:function(e,t){this.state.subscribers[e]=this.state.subscribers[e].filter(function(e){return t!==e})}},{key:"fireEvent",value:(r=R(function*(i){var n=this,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};this.state.subscribers[i]&&this.state.subscribers[i].forEach(function(e){var t=e(a);t&&t.once&&n.unsubscribe(i,e)})}),function(e){return r.apply(this,arguments)})},{key:"undo",value:function(){var i=this,e=this.state.toolboxselected.getSession(),t=e.getId(),n=e.getLastHistoryState().items,t=(this.undoRedoLayerUniqueFieldValues({layerId:t,sessionItems:n,action:"undo"}),e.undo());this.undoRedoRelationUniqueFieldValues({relationSessionItems:t,action:"undo"}),Object.entries(t).forEach(function(e){var e=f(e,2),t=e[0],e=e[1];i.getToolBoxById(t).getSession().undo(e)})}},{key:"redo",value:function(){var i=this,e=this.state.toolboxselected.getSession(),t=e.getId(),n=e.getLastHistoryState().items,t=(this.undoRedoLayerUniqueFieldValues({layerId:t,sessionItems:n,action:"redo"}),e.redo());this.undoRedoRelationUniqueFieldValues({relationSessionItems:t,action:"redo"}),Object.entries(t).forEach(function(e){var e=f(e,2),t=e[0],e=e[1];i.getToolBoxById(t).getSession().redo(e)})}},{key:"getEditingLayer",value:function(e){return this.state.editableLayers[e].getEditingLayer()}},{key:"addToolBox",value:function(e){this.state._toolboxes.push(e),this.state.sessions[e.getId()]=e.getSession(),this.state.toolboxes.push(e.state)}},{key:"runEventHandler",value:(a=R(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.type,e=e.id;this.state.events[t]&&this.state.events[t][e]&&(yield Promise.allSettled(this.state.events[t][e].map(function(e){return e()})))}),function(){return a.apply(this,arguments)})},{key:"resetDefault",value:function(){this.state.saveConfig={mode:"default",modal:!1,messages:void 0,cb:{done:function(){},error:function(){}}},z.getService("map").disableClickMapControls(!1)}},{key:"resetAPIDefault",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.plugin,t=void 0===t||t,e=e.toolboxes;void 0!==e&&!e||this.getToolBoxes().forEach(function(e){return e.resetDefault()}),t&&this.resetDefault()}},{key:"getLayers",value:function(){return Object.values(this.state.editableLayers)}},{key:"getLayerById",value:function(e){return this.state.editableLayers[e]}},{key:"getToolBoxById",value:function(t){return this.state._toolboxes.find(function(e){return t===e.getId()})}},{key:"getSessionById",value:function(e){return this.state.sessions[e]}},{key:"setApplicationEditingConstraints",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{showToolboxesExcluded:!0,toolboxes:{}},i=(this.state.constraints=x({},this.state.constraints,e),e.toolboxes),e=e.showToolboxesExcluded,n=Object.keys(i);!1===e&&this.state.toolboxes.forEach(function(e){return e.show=-1!==n.indexOf(e.id)}),n.forEach(function(e){return t.getToolBoxById(e).setEditingConstraints(i[e])})}},{key:"getToolBoxes",value:function(){return this.state._toolboxes}},{key:"getEditableLayers",value:function(){return this.state.editableLayers}},{key:"stop",value:(n=R(function*(){var t=this,i=[];this.state._toolboxes.forEach(function(e){e.getSession().getHistory().state.commit&&i.push(t.commit({toolbox:e,modal:!0}))});try{yield(0,C.promisify)($.when.apply(this,i))}catch(e){}this.state._toolboxes.forEach(function(e){return e.stop()}),this.state.toolboxselected=null,this.state.message=null,z.getService("map").refreshMap()}),function(){return n.apply(this,arguments)})},{key:"saveChange",value:(e=R(function*(){if("autosave"===this.state.saveConfig.mode)return this.commit({modal:!1})}),function(){return e.apply(this,arguments)})},{key:"commit",value:function(){var c=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},f=e.toolbox,g=e.commitItems,t=e.modal,p=void 0===t||t,t=e.close,y=void 0!==t&&t,h=Object.assign({success:{message:"plugins.editing.messages.saved",autoclose:!0},error:{}},this.state.saveConfig.messages||{}),v=(f=f||this.state.toolboxselected).getLayer(),m=g,g=g||f.getSession().getCommitItems(),_=O.online,b=[].concat(L(g.add||[]),L(g.delete||[]),L(g.update||[]),L(Object.keys(g.relations||{}))).length,w=void 0,k=void 0,S=void 0;return(0,C.$promisify)(R(function*(){var e,t,i;if(b)try{if(p){w=new I.Workflow({type:"commitfeatures",steps:[new T.Step({run:function(i){var n=this;return $.Deferred(function(e){var t=z.dialog.dialog({message:i.message,title:j("editing.messages.commit_feature")+': "'+i.layer.getName()+'"',buttons:x({SAVE:{className:"btn-success",callback:function(){e.resolve(i)},label:A("save")},CANCEL:{className:"btn-danger",callback:function(){e.reject({cancel:!0})},label:A(i.close?"exitnosave":"annul")}},i.close?{CLOSEMODAL:{className:"btn-primary",callback:function(){t.modal("hide")},label:A("annul")}}:{})});i.features&&(0,P.setAndUnsetSelectedFeaturesStyle)({promise:e.promise(),inputs:i,style:n.selectStyle})}).promise()}})]});try{yield(0,C.promisify)(w.start({inputs:{close:y,layer:v,message:new(Vue.extend(F("./components/Changes.vue")))({propsData:{commits:g,layer:v}}).$mount().$el}})),yield(0,C.promisify)(w.stop())}catch(e){if(e&&e.cancel)return Promise.reject(e);S=!0}_&&(k=z.dialog.dialog({message:'<h4 class="text-center">\n                          <i style="margin-right: 5px;" class='+z.getFontClass("spinner")+"></i>"+j("editing.messages.saving")+"\n                        </h4>",closeButton:!1}))}var l=!_&&(e={},i=f.getSession().getId(),t=g,i in e?Object.defineProperty(e,i,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[i]=t,e),u=!_&&M.getOfflineItem("EDITING_CHANGES"),n=(Object.keys(u||{}).forEach(function(e){var i,n,t,a=Object.keys(l)[0],r=null,o=(l[e]?r=l:l[a].relations[e]&&(r=l[a].relations),!r&&Object.keys(u[e].relations||{})),s=!r&&0<o.length,o=!r&&s&&o.includes(a);(r||o)&&(n=r||l,t=r?u:u[e].relations,n[i=r?e:a].add=[].concat(L(n[i].add),L(n[i].add)),n[i].delete=[].concat(L(n[i].delete),L(n[i].delete)),(t[i].update||[]).filter(function(t){return!n[i].update.find(function(e){return e.id===t.id})}).forEach(function(e){return n[i].update.unshift(e)}),(t[i].lockids||[]).filter(function(t){return!n[i].lockids.find(function(e){return e.featureid===t.featureid})}).forEach(function(e){return n[i].update.unshift(e)})),o&&(u[e].relations[a]=l[a],l=u),r||s||(l[e]=u[e])}),_||(z.showUserMessage({type:"success",message:"plugins.editing.messages.saved_local",autoclose:!0}),f.getSession().clearHistory()),_?yield(0,C.promisify)(f.getSession().commit({items:m||g,__esPromise:!0})):{}),a=n.commit,r=n.response,o=_&&a,s=o&&r.result,d=(s&&h&&h.success&&(k&&k.modal("hide"),z.showUserMessage({type:"success",message:h.success.message||"plugins.editing.messages.saved",duration:2e3,autoclose:void 0===h.success.autoclose||h.success.autoclose})),s&&D.LayerTypes.VECTOR===v.getType()&&z.getService("map").refreshMap({force:!0}),_&&c.state.saveConfig.cb.done(f),s&&f.getId());if(d&&(c.state.featuresOnClose[d]=c.state.featuresOnClose[d]||new Set,[].concat(L(r.response.new.map(function(e){return e.id})),L(a.update.map(function(e){return e.id}))).forEach(function(e){return c.state.featuresOnClose[d].add(e)})),s&&c.emit("commit",r.response),o&&!s)throw S=!0,r}catch(e){if(k&&k.modal("hide"),p)try{yield E(g.relations)}catch(e){}return(S||p)&&(i=_?h.error.message||new H({error:e.errors||e||{}}).parse({type:"String"}):e,z.showUserMessage({type:"alert",message:i,textMessage:!_||!h.error.message,autoclose:!!_&&void 0!==h.error.autoclose&&h.error.autoclose}),c.state.saveConfig.cb.error(f,i)),Promise.reject(f)}else z.showUserMessage({type:"info",message:"Nothing to save",autoclose:!0,closable:!1});return f}))}},{key:"undoRedoLayerUniqueFieldValues",value:function(e){var r=this,o=e.layerId,t=e.sessionItems,t=void 0===t?[]:t,s=e.action;void 0!==this.state.uniqueFieldsValues[o]&&t.forEach(function(a){Object.keys(r.state.uniqueFieldsValues[o]).forEach(function(e){var t,i=void 0,n=void 0;n=Array.isArray(a)?(i=(t=a[1].feature.get(e)!=a[0].feature.get(e))?("undo"===s?a[1]:a[0]).feature.get(e):void 0,t?("undo"===s?a[0]:a[1]).feature.get(e):void 0):(i="add"===a.feature.getState()?a.feature.get(e):void 0,"delete"===a.feature.getState()?a.feature.get(e):void 0),void 0!==i&&r.state.uniqueFieldsValues[o][e].delete(i),void 0!==n&&r.state.uniqueFieldsValues[o][e].add(n)})})}},{key:"undoRedoRelationUniqueFieldValues",value:function(e){var n=this,t=e.relationSessionItems,a=e.action;Object.entries(t).forEach(function(e){var e=f(e,2),t=e[0],e=e[1],i=e.own,e=e.dependencies;n.undoRedoLayerUniqueFieldValues({layerId:t,sessionItems:i,action:a}),n.undoRedoRelationUniqueFieldValues({relationSessionItems:e,action:a})})}},{key:"stopEditing",value:(i=R(function*(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return(0,C.promisify)(this.getToolBoxById(e).stop(t))}),function(e){return i.apply(this,arguments)})},{key:"startEditing",value:(t=R(function*(e){var t,i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=(i.selected=void 0===i.selected||i.selected,i.showselectlayers=void 0===i.showselectlayers||i.showselectlayers,i.disablemapcontrols=void 0!==i.disablemapcontrols&&i.showselectlayers,this.getToolBoxById(e));return this.state.showselectlayers=i.showselectlayers,n?(n.setSelected(i.selected),i.selected&&(this.state.toolboxselected=n),i.title&&n.setTitle(i.title),t=yield(0,C.promisify)(n.start(i)),i.disablemapcontrols&&z.getService("map").disableClickMapControls(!0),t?{toolbox:n,data:t}:n):Promise.reject()}),function(e){return t.apply(this,arguments)})},{key:"addLayerFeature",value:function(){var s=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},l=e.layerId,u=e.feature;return void 0===u||void 0===l?Promise.reject():new Promise(function(e,t){function i(e){return o.stop(),a.stop(),e()}var n=s.getLayerById(l),a=s.getSessionById(l),r=n.getEditingFields().filter(function(e){return!(e.pk&&!e.editable)}),o=(a.start({filter:{nofeatures:!0,nofeatures_field:r[0].name},editing:!0}),new I.Workflow({type:"addfeature",steps:[new m.OpenFormStep({push:!0,showgoback:!1,saveAll:!1})]}));try{r.forEach(function(e){void 0===u.get(e.name)&&u.set(e.name,null)}),(u=new k({feature:u,properties:r.map(function(e){return e.name})})).setTemporaryId(),a.pushAdd(l,u,!1),n.getEditingLayer().getSource().addFeature(u),o.start({inputs:{layer:n,features:[u]},context:{session:a}}).then(function(){a.save(),s.commit({modal:!1,toolbox:s.getToolBoxById(l)}).then(function(){return i(e)}).fail(function(){return i(t)})}).fail(function(){return i(t)})}catch(e){t()}})}},{key:"setSaveConfig",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.mode,i=e.cb,n=e.modal,e=e.messages;Object.assign(this.state.saveConfig,{mode:void 0===t?"default":t,modal:void 0!==n&&n,messages:e,cb:x({},this.state.saveConfig.cb,void 0===i?{}:i)})}},{key:"addFormComponents",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layerId,e=e.components;this.state.formComponents[t]=(this.state.formComponents[t]||[]).concat(void 0===e?[]:e)}},{key:"showPanel",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};t.toolboxes&&Array.isArray(t.toolboxes)&&this.getToolBoxes().forEach(function(e){return e.setShow(-1!==t.toolboxes.indexOf(e.getId()))}),this.showEditingPanel(t)}},{key:"showEditingPanel",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return 0<this.getLayers().length?(this.state.panel=new N(x({},e,{id:"editing-panel",title:e.title||"plugins.editing.editing_data",internalPanel:new(Vue.extend(F("./components/Editing.vue")))({service:this,resourcesurl:e.resourcesUrl||z.getResourcesUrl(),showcommitbar:void 0===e.showcommitbar||e.showcommitbar})})),z.showPanel(this.state.panel),!this.state.show_errors&&this.state.layers_in_error&&(z.showUserMessage({type:"warning",message:"plugins.editing.errors.some_layers",closable:!0}),this.state.show_errors=!0)):z.showUserMessage({type:"alert",message:"plugins.editing.errors.no_layers"}),this.state.panel}},{key:"hideEditingPanel",value:function(){null!==this.state.panel&&(z.closePanel(),this.state.panel=null)}},{key:"unload",value:function(){this.hideEditingPanel(),this.config.visible&&this.removeTools(),this.state.unwatchLayout(),S.removeLayersStore(S.getLayersStore("editing")),h.ToolBox.clear(),z.getService("map").off("mapcontrol:toggled",this.state.onMapControlToggled),z.getService("queryresults").un("editFeature",this.state.editFeatureKey)}},{key:"setCurrentLayout",value:function(){M.setCurrentLayout(this.getName())}},{key:"resetCurrentLayout",value:function(){M.setCurrentLayout(this.state.currentLayout)}},{key:"getActiveTool",value:function(){return this.getToolBoxes().filter(function(e){return e.getActiveTool()})[0]}}]),d}())},{"./components/Changes.vue":2,"./components/Editing.vue":5,"./g3wsdk":13,"./g3wsdk/workflow/step":14,"./g3wsdk/workflow/workflow":15,"./i18n":20,"./toolboxes/toolbox":27,"./utils/addPartToMultigeometries":28,"./utils/createFeature":38,"./utils/getEditingLayerById":41,"./utils/getProjectLayerFeatureById":47,"./utils/promisify":57,"./utils/setAndUnsetSelectedFeaturesStyle":58,"./workflows":63}],26:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});i.PickFeaturesInteraction=function(e){var t=r;if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);function r(){var i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=this,t=r;if(!(e instanceof t))throw new TypeError("Cannot call a class as a function");function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.pixel;return e.map.getFeaturesAtPixel(t,{layerFilter:function(e){return e===i.layer},hitTolerance:isMobile&&isMobile.any?10:0})}var a=[],e=this,t=(r.__proto__||Object.getPrototypeOf(r)).call(this,{handleDownEvent:function(e){return a=n(e)},handleUpEvent:function(e){return a&&a.length&&this.dispatchEvent({type:"picked",features:a,coordinate:e.coordinate,layer:i.layer}),!0},handleMoveEvent:function(e){e.map.getTargetElement().style.cursor=n(e)?"pointer":""}});if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}return t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e),r}(ol.interaction.Pointer)},{}],27:[function(v,a,e){Object.defineProperty(e,"__esModule",{value:!0}),e.ToolBox=void 0;var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var m=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var i=t,n=[],a=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!i||n.length!==i);a=!0);}catch(e){t=!0,r=e}finally{try{!a&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},_=v("../g3wsdk/workflow/workflow"),b=v("../g3wsdk/workflow/step"),s=v("../utils/createEditingDataOptions"),g=v("../utils/setLayerUniqueFieldValues"),w=v("../utils/getRelationsInEditing"),k=v("../utils/getRelationId"),S=v("../utils/setAndUnsetSelectedFeaturesStyle"),F=v("../utils/chooseFeature"),x=v("../utils/cloneFeature"),E=v("../utils/evaluateExpressionFields"),I=v("../utils/getNotEditableFieldsNoPkValues"),T=v("../utils/getDeltaXY"),C=v("../utils/chooseFeatureFromFeatures"),P=v("../utils/convertToGeometry"),L=v("../utils/getProjectLayerFeatureById"),H=v("../utils/addTableFeature"),q=v("../utils/getRelationFieldsFromRelation"),W=v("../utils/getLayersDependencyFeatures"),K=v("../utils/getEditingLayerById"),Z=v("../utils/getRelationsInEditingByFeature"),Y=v("../utils/isPointOnVertex"),X=v("../utils/handleSplitFeature"),J=v("../utils/addPartToMultigeometries"),l=v("../utils/checkSessionItems"),R=v("../utils/promisify"),Q=v("../utils/unlinkRelation"),O=v("../workflows");v("../eventbus");function M(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function A(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,i){try{var n=s[e](i),a=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});r(a)}("next")})}}Object.entries({Workflow:_.Workflow,OpenFormStep:O.OpenFormStep,SelectElementsStep:O.SelectElementsStep,PickFeatureStep:O.PickFeatureStep,MoveFeatureStep:O.MoveFeatureStep,ModifyGeometryVertexStep:O.ModifyGeometryVertexStep,OpenTableStep:O.OpenTableStep,AddFeatureStep:O.AddFeatureStep}).forEach(function(e){e=m(e,2);e[0],e[1]});var ee=g3wsdk.constant.G3W_FID,t=g3wsdk.core,j=t.ApplicationState,D=t.G3WObject,B=g3wsdk.core.catalog.CatalogLayersStoresRegistry,V=g3wsdk.core.geometry.Geometry,t=g3wsdk.core.geoutils,te=t.dissolve,U=t.isSameBaseGeometryType,ie=t.multiGeometryToSingleGeometries,ne=t.singleGeometriesToMultiGeometry,ae=t.splitFeatures,re=g3wsdk.core.geoutils.Geometry.removeZValueToOLFeatureGeometry,z=g3wsdk.core.i18n.tPlugin,G=g3wsdk.core.layer.Layer,oe=g3wsdk.core.layer.features.Feature,t=g3wsdk.core.utils,u=t.debounce,d=t.toRawType,N=g3wsdk.gui.GUI,t=g3wsdk.ol.utils,f=t.getScaleFromResolution,p=t.getResolutionFromScale,i=e.ToolBox=function(){var n,e,t,i,a=y,r=D;if("function"!=typeof r&&null!==r)throw new TypeError("Super expression must either be null or a function, not "+typeof r);function y(e){var r,t,i,n,a,o,h,s,l,u,d,c=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],f=this,g=y;if(f instanceof g)return r=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(y.__proto__||Object.getPrototypeOf(y)).call(this)),g=(f=[void 0,G.LayerTypes.VECTOR].includes(e.getType()))&&e.getGeometryType(),a=f&&V.isPointGeometryType(g),t=f&&V.isLineGeometryType(g),i=f&&V.isPolygonGeometryType(g),n=G.LayerTypes.TABLE===e.getType(),g=g&&V.isMultiGeometry(g),a=f&&(a?"Point":t?"Line":"Polygon"),r._start=!1,o=e.getEditingFields().filter(function(e){return e.input&&"unique"===e.input.type}).reduce(function(e,t){return e[t.name]=t,e},{}),r.uniqueFields=Object.keys(o).length?o:null,r.constraints={filter:null,show:null,tools:[]},r._constrains={commit:!1,undo:!1,redo:!1},r._states=[],r._history={id:e.getId(),state:new Proxy({},{get:function(e,t){return r._constrains[t]}}),add:r.__add.bind(r),undo:r.__undo.bind(r),clear:r.__clearHistory.bind(r),redo:r.__redo.bind(r),getState:r.__getState.bind(r),getLastState:r.__getLastHistoryState.bind(r),commit:r.__commit.bind(r)},r._session=Object.assign(new D({setters:{start:function(){return(0,R.$promisify)(r.__startSession(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}))},stop:function(){return(0,R.$promisify)(r.__stopSession())},getFeatures:function(){return(0,R.$promisify)(r.__getFeatures(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}))},saveChangesOnServer:function(e){return r.__saveChangesOnServer(e)}}}),{_history:r._history,state:new Proxy({},{get:function(e,t){return r.state.editing.session[t]}}),getId:function(){return e.getId()},getLastHistoryState:r.__getLastHistoryState.bind(r),isStarted:r.__isStarted.bind(r),getHistory:r.__getHistory.bind(r),getEditor:r.__getEditor.bind(r),push:r.__push.bind(r),pushDelete:r.__pushDelete.bind(r),save:r.__save.bind(r),pushAdd:r.__pushAdd.bind(r),pushUpdate:r.__pushUpdate.bind(r),rollback:r.__rollback.bind(r),rollbackDependecies:r.__rollbackDependecies.bind(r),undo:r.__undoSession.bind(r),redo:r.__redoSession.bind(r),getCommitItems:r.__getCommitItems.bind(r),commit:r.save.bind(r),clear:r.__clearSession.bind(r),clearHistory:r.__clearHistory.bind(r)}),y._sessions[e.getId()]=r,o=e.getEditingCapabilities()||[],r.state={layer:e,id:e.getId(),changingtools:!1,show:!0,color:e.getColor()||"blue",title:" "+e.getTitle()||"Edit Layer",customTitle:!1,loading:!1,enabled:!1,toolboxheader:!0,startstopediting:!0,message:null,toolmessages:{help:null},toolsoftool:[],selected:!1,activetool:null,editing:{session:{id:new Proxy({},{get:function(){return r.state.id}}),started:!1,getfeatures:!1,current:null,changes:[]},history:r._history.state,on:!1,dependencies:c,relations:Object.values(e.isFather()&&c.length?e.getRelations().getRelations():{}),father:e.isFather(),canEdit:!0},_unregisterStartSettersEventsKey:[],_getFeaturesOption:{},_layerType:e.getType()||G.LayerTypes.VECTOR,_enabledtools:void 0,_disabledtools:void 0,_constraints:e.getEditingConstrains()||{},_tools:[f&&o.includes("add_feature")&&{id:"addfeature",type:["add_feature"],name:"editing.tools.add_feature",icon:"add"+a+".png",op:new _.Workflow({layer:e,type:"addfeature",steps:[new O.AddFeatureStep({layer:e,tools:["snap","measure"]}),new O.OpenFormStep({layer:e})]})},f&&o.includes("change_attr_feature")&&{id:"editattributes",type:["change_attr_feature"],name:"editing.tools.update_feature",icon:"editAttributes.png",op:new _.Workflow({layer:e,helpMessage:"editing.tools.update_feature",type:"editfeatureattributes",steps:[new O.PickFeatureStep,new b.Step({run:F.chooseFeature}),new O.OpenFormStep]})},f&&o.includes("delete_feature")&&{id:"deletefeature",type:["delete_feature"],name:"editing.tools.delete_feature",icon:"delete"+a+".png",op:new _.Workflow({layer:e,type:"deletefeature",steps:[new O.PickFeatureStep,new b.Step({run:F.chooseFeature}),new b.Step({help:"editing.steps.help.double_click_delete",run:function(i,a){return(0,R.$promisify)(A(function*(){var n=i.layer.getId(),e=i.features[0],t=(0,w.getRelationsInEditing)({layerId:n,relations:i.layer.getRelations()?i.layer.getRelations().getArray():[]}).filter(function(t){return(0,K.getEditingLayerById)((0,k.getRelationId)({layerId:n,relation:t})).getEditingFields().filter(function(e){return(0,q.getRelationFieldsFromRelation)({relation:t,layerId:(0,k.getRelationId)({layerId:n,relation:t})}).ownField.includes(e.name)}).every(function(e){return!e.validate.required})});return 0<t.length&&(yield(0,W.getLayersDependencyFeatures)(n,{feature:e,relations:t})),i.features=[e],(0,Z.getRelationsInEditingByFeature)({layerId:n,relations:t,feature:e}).forEach(function(e){var t=e.relation,i=e.relations;i.forEach(function(e){return(0,Q.unlinkRelation)({layerId:n,relation:t,relations:i,index:0,dialog:!1})})}),a.session.pushDelete(n,e),i}))}}),new b.Step({run:function(o){var e=this;return $.Deferred(function(i){var n=o.layer.getEditingLayer(),a=o.features[0],r=o.layer.getId();N.dialog.confirm("<h4>"+z("editing.messages.delete_feature")+'</h4><div style="font-size:1.2em;">'+(o.layer.getChildren().length&&(0,w.getRelationsInEditing)({layerId:r,relations:o.layer.getRelations().getArray()}).length?z("editing.messages.delete_feature_relations"):"")+"</div>",function(e){var t;e?(n.getSource().removeFeature(a),(t=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").state.uniqueFieldsValues[r])&&Object.keys(a.getProperties()).filter(function(e){return void 0!==t[e]}).forEach(function(e){return t[e].delete(a.get(e))}),i.resolve(o)):i.reject(o)}),o.features&&(0,S.setAndUnsetSelectedFeaturesStyle)({promise:i.promise(),inputs:o,style:e.selectStyle})}).promise()}})]})},(t||i)&&o.includes("change_feature")&&{id:"movevertex",type:["change_feature"],name:"editing.tools.update_vertex",icon:"moveVertex.png",op:new _.Workflow({layer:e,type:"modifygeometryvertex",helpMessage:"editing.tools.update_vertex",steps:[new O.PickFeatureStep({layer:e}),new b.Step({run:F.chooseFeature}),new O.ModifyGeometryVertexStep({tools:["snap","measure"]})]})},f&&o.includes("change_attr_feature")&&{id:"editmultiattributes",type:["change_attr_feature"],name:"editing.tools.update_multi_features",icon:"multiEditAttributes.png",op:new _.Workflow({layer:e,type:"editmultiattributes",helpMessage:"editing.tools.update_multi_features",registerEscKeyEvent:!0,runOnce:!0,steps:[new O.SelectElementsStep({type:"multiple",steps:{select:{description:"editing.workflow.steps."+(j.ismobile?"selectDrawBoxAtLeast2Feature":"selectMultiPointSHIFTAtLeast2Feature"),buttonnext:{disabled:!0,condition:function(e){e=e.features;return(void 0===e?[]:e).length<2},done:function(){_.Workflow.Stack.getCurrent().clearUserMessagesSteps()}},dynamic:0,done:!1}}}),new O.OpenFormStep({multi:!0})]})},f&&o.includes("change_feature")&&{id:"movefeature",type:["change_feature"],name:"editing.tools.move_feature",icon:"move"+a+".png",op:new _.Workflow({layer:e,type:"movefeature",helpMessage:"editing.tools.move_feature",steps:[new O.PickFeatureStep,new b.Step({run:F.chooseFeature}),new O.MoveFeatureStep]})},f&&o.includes("add_feature")&&{id:"copyfeaturesfromotherlayer",type:["add_feature"],name:"editing.tools.pastefeaturesfromotherlayers",icon:"pasteFeaturesFromOtherLayers.png",enable:(c=N.getService("map"),s=e.getId(),l=e.getGeometryType(),u=c.defaultsLayers.selectionLayer.getSource(),d={bool:!1,tool:void 0},function(e){var t=e.bool,e=e.tool;return d.tool=void 0===e?{}:e,d.bool=t,u[t?"on":"un"]("addfeature",p),u[t?"on":"un"]("removefeature",p),p()}),op:(h=new O.OpenFormStep({layer:e,help:"editing.steps.help.copy"}),new _.Workflow({layer:e,type:"copyfeaturesfromotherlayer",runOnce:!0,steps:[new b.Step({layer:e,help:"editing.steps.help.draw_new_feature",run:function(i,e){var t,n=this,a=$.Deferred(),s=i.layer,r=s.getGeometryType(),l=s.getId(),u=s.getEditingFields().filter(function(e){return!e.pk}),d=e.session,c=s.getEditingLayer().getSource(),e=(0,P.convertToGeometry)(N.getService("map").defaultsLayers.selectionLayer.getSource().getFeatures().filter(function(e){return e.__layerId!==l}),r),f=[],o={},g=((e||[]).forEach(function(e){var t;void 0===o[e.__layerId]&&(t=!B.getLayerById(e.__layerId),o[e.__layerId]={external:t,fields:!t&&B.getLayerById(e.__layerId).getFields(),features:[]}),o[e.__layerId].features.push(e)}),Vue.observable({state:!1})),p=new(Vue.extend(v("../components/CopyFeaturesFromOtherLayers.vue")))({layers:o,selectedFeatures:f,editAttributes:g}),r=p.$mount().$el,y=N.showModalDialog({title:z("editing.modal.tools.copyfeaturefromotherlayer.title"),className:"modal-left",closeButton:!1,message:r,buttons:{cancel:{label:"Cancel",className:"btn-danger",callback:function(){a.reject()}},ok:{label:"Ok",className:"btn-success",callback:(t=A(function*(){var r=[],o=!1,t=[];f.forEach(function(e){B.getLayerById(e.__layerId)?t.push((0,L.getProjectLayerFeatureById)({layerId:e.__layerId,fid:e.get(ee)})):t.push({properties:e.getProperties()})}),(yield Promise.allSettled(t)).forEach(function(e,t){var i,n=e.status,a=e.value;"fulfilled"===n&&(e=f[t],o=void 0!==u.find(function(e){var t=e.name,e=e.validate.required;return void 0===a.properties[t]&&(void 0!==e&&e)}),i=new oe({feature:e,properties:u.map(function(e){return e.name})}),u.forEach(function(e){e=e.name;void 0===i.get(e)&&i.set(e,null)}),s.getEditingNotEditableFields().find(function(e){s.isPkField(e)&&i.set(e,null)}),re({feature:i}),i.setTemporaryId(),c.addFeature(i),r.push(i),d.pushAdd(l,i,!1))}),1<r.length&&(g.state&&h?h.updateMulti(!0):o&&N.showUserMessage({type:"warning",message:"plugins.editing.messages.copy_and_paste_from_other_layer_mandatory_fields",autoclose:!0,duration:2e3})),r.forEach(function(e){i.features.push(e),n.fireEvent("addfeature",e)}),p.$destroy(),a.resolve(i)}),function(){return t.apply(this,arguments)})}}});return y.find("button.btn-success").prop("disabled",!0),p.$watch("selectedFeatures",function(e){return y.find("button.btn-success").prop("disabled",0===e.length)}),a.promise()}}),h],registerEscKeyEvent:!0}))},f&&o.includes("add_feature")&&{id:"copyfeatures",type:["add_feature"],name:"editing.tools.copy",icon:"copy"+a+".png",op:new _.Workflow({layer:e,type:"copyfeatures",runOnce:!0,steps:[new O.SelectElementsStep({layer:e,help:"editing.steps.help.copy",type:j.ismobile?"single":"multiple",steps:{select:{description:"editing.workflow.steps."+(j.ismobile?"selectPoint":"selectPointSHIFT"),done:!1}}},!0),0<=e.getGeometryType().indexOf("Point")?void 0:new b.Step({layer:e,help:"editing.steps.help.select",steps:{from:{description:"editing.workflow.steps.selectStartVertex",done:!1}},run:function(i){var n=this;return this._stopPromise=this._stopPromise,$.Deferred(function(t){if(!i.features.length)return t.reject("no feature");n._stopPromise=$.Deferred(),(0,S.setAndUnsetSelectedFeaturesStyle)({promise:n._stopPromise,inputs:i,style:n.selectStyle}),n.addInteraction(new ol.interaction.Draw({type:"Point",condition:function(t){return i.features.some(function(e){return(0,Y.isPointOnVertex)({feature:e,coordinates:t.coordinate})})}}),{drawend:function(e){i.coordinates=e.feature.getGeometry().getCoordinates(),n.setUserMessageStepDone("from"),t.resolve(i)}}),n.addInteraction(new ol.interaction.Snap({edge:!1,features:new ol.Collection(i.features)}))}).promise()},stop:function(){this._stopPromise.resolve(!0)}}),new b.Step({layer:e,help:"editing.steps.help.select_vertex_to_paste",steps:{to:{description:"editing.workflow.steps.selectToPaste",done:!1}},run:function(p,y){var h=this;return $.Deferred(function(s){var l=p.layer,u=p.features,d=p.coordinates,c=l.getEditingLayer().getSource(),f=l.getId(),g=y.session;(0,S.setAndUnsetSelectedFeaturesStyle)({promise:s,inputs:p,style:h.selectStyle}),h.addInteraction(new ol.interaction.Draw({type:"Point",features:new ol.Collection}),{drawend:function(e){for(var e=e.feature.getGeometry().getCoordinates(),e=m(e,2),i=e[0],n=e[1],a=d?(0,T.getDeltaXY)({x:i,y:n,coordinates:d}):null,t=u.length,r=[],o=0;o<t;o++)!function(e){var t=(0,x.cloneFeature)(u[e],l);a?t.getGeometry().translate(a.x,a.y):(e=t.getGeometry().getCoordinates(),e=(0,T.getDeltaXY)({x:i,y:n,coordinates:e}),t.getGeometry().translate(e.x,e.y)),l.getEditingMediaFields({}).forEach(function(e){return t.set(e,null)}),r.push((0,E.evaluateExpressionFields)({inputs:p,context:y,feature:t}))}(o);Promise.allSettled(r).then(function(e){return e.forEach(function(e){e.status;var e=e.value,t=(0,I.getNotEditableFieldsNoPkValues)({layer:l,feature:e}),i=g.pushAdd(f,e);Object.entries(t).length&&Object.entries(t).forEach(function(e){var e=m(e,2),t=e[0],e=e[1];return i.set(t,e)}),c.addFeature(i),p.features.push(i)})}).finally(function(){h.setUserMessageStepDone("to"),s.resolve(p)})}}),h.addInteraction(new ol.interaction.Snap({source:c,edge:!1}))}).promise()}})].filter(Boolean),registerEscKeyEvent:!0})},f&&o.includes("add_feature")&&o.includes("change_feature")&&{id:"addPart",type:["add_feature","change_feature"],name:"editing.tools.addpart",icon:"addPart.png",visible:g,op:new _.Workflow({layer:e,type:"addparttomultigeometries",helpMessage:"editing.tools.addpart",runOnce:!0,steps:[new O.PickFeatureStep({steps:{select:{description:"editing.workflow.steps.select",done:!1}}}),new b.Step({run:F.chooseFeature,help:"editing.steps.help.select_element"}),new O.AddFeatureStep({layer:e,help:"editing.steps.help.select_element",add:!1,steps:{addfeature:{description:"editing.workflow.steps.draw_part",done:!1}},tools:["snap","measure"]}),new b.Step({layer:e,help:"editing.steps.help.select_element",run:J.addPartToMultigeometries})],registerEscKeyEvent:!0})},f&&o.includes("change_feature")&&{id:"deletePart",type:["change_feature"],name:"editing.tools.deletepart",icon:"deletePart.png",visible:g,op:new _.Workflow({layer:e,type:"deletepartfrommultigeometries",steps:[new O.PickFeatureStep,new b.Step({run:F.chooseFeature}),new b.Step({layer:e,run:function(f,g){var p=this;return $.Deferred(function(i){var e=f.layer,n=f.layer.getEditingLayer(),a=e.getId(),r=g.session,e=f.features,t=f.coordinate,o=e[0],s=o.clone(),e=o.getGeometry(),e=ie(e),l=new ol.source.Vector({features:e.map(function(e){return new ol.Feature(e)})}),u=p.getMap(),d=u.getPixelFromCoordinate(t),c=new ol.layer.Vector({source:l,style:n.getStyle()});u.addLayer(c),u.once("postrender",function(){var t=!1;u.forEachFeatureAtPixel(d,function(e){t||(l.removeFeature(e),l.getFeatures().length?(e=ne(l.getFeatures().map(function(e){return e.getGeometry()})),o.setGeometry(e),(0,E.evaluateExpressionFields)({inputs:f,context:g,feature:o}).finally(function(){r.pushUpdate(a,o,s),i.resolve(f)})):(n.getSource().removeFeature(o),r.pushDelete(a,o),i.resolve(f)),t=!0)},{layerFilter:function(e){return e===c},hitTolerance:1}),u.removeLayer(c),c=null})}).promise()}})],helpMessage:"editing.tools.deletepart"})},(t||i)&&o.includes("change_feature")&&{id:"splitfeature",type:["change_feature"],name:"editing.tools.split",icon:"splitFeatures.png",op:new _.Workflow({layer:e,type:"splitfeature",runOnce:!0,steps:[new O.SelectElementsStep({layer:e,help:"editing.steps.help.split",type:j.ismobile?"single":"multiple",steps:{select:{description:"editing.workflow.steps."+(j.ismobile?"selectPoint":"selectPointSHIFT"),done:!1}}},!0),new b.Step({layer:e,help:"",steps:{draw_line:{description:"editing.workflow.steps.draw_split_line",done:!1}},run:function(r,o){var t,s=this,l=(this._stopPromise=this._stopPromise,$.Deferred()),e=r.layer.getEditingLayer().getSource();return this._stopPromise=$.Deferred(),(0,S.setAndUnsetSelectedFeaturesStyle)({promise:this._stopPromise,inputs:r,style:this.selectStyle}),this.addInteraction(new ol.interaction.Draw({type:"LineString",features:new ol.Collection,freehandCondition:ol.events.condition.never}),{drawend:(t=A(function*(e){for(var i=!1,n=ae({splitfeature:e.feature,features:r.features}),t=n.length,a=0;a<t;a++)yield*function*(t){1<n[t].geometries.length&&(i=!0,yield(0,X.handleSplitFeature)({feature:r.features.find(function(e){return e.getUid()===n[t].uid}),context:o,splittedGeometries:n[t].geometries,inputs:r,session:o.session}))}(a);i?N.showUserMessage({type:"success",message:"plugins.editing.messages.splitted",autoclose:!0}):N.showUserMessage({type:"warning",message:"plugins.editing.messages.nosplittedfeature",autoclose:!0}),s._stopPromise.resolve(!0),yield new Promise(function(e){return setTimeout(e,1e3)}),l[i?"resolve":"reject"](r)}),function(e){return t.apply(this,arguments)})}),this.addInteraction(new ol.interaction.Snap({source:e,edge:!0})),l.promise()}})],registerEscKeyEvent:!0})},(t||i)&&o.includes("change_feature")&&{id:"mergefeatures",type:["change_feature"],name:"editing.tools.merge",icon:"mergeFeatures.png",op:new _.Workflow({layer:e,type:"mergefeatures",runOnce:!0,steps:[new O.SelectElementsStep({layer:e,type:"bbox",help:"editing.steps.help.merge",steps:{select:{description:"editing.workflow.steps."+(j.ismobile?"selectDrawBox":"selectSHIFT"),done:!1}}},!0),new b.Step({layer:e,help:"editing.steps.help.merge",steps:{choose:{description:"editing.workflow.steps.merge",done:!1}},run:function(l,u){return $.Deferred(function(n){var t,e=l.layer,a=l.features,r=e.getEditingLayer().getSource(),o=e.getId(),s=u.session;a.length<2?(N.showUserMessage({type:"warning",message:"plugins.editing.messages.select_min_2_features",autoclose:!0}),n.reject()):(0,C.chooseFeatureFromFeatures)({features:a,inputs:l}).then((t=A(function*(t){var e=a.findIndex(function(e){return t===e}),i=t.clone(),e=te({features:a,index:e});if(e){try{yield(0,E.evaluateExpressionFields)({inputs:l,context:u,feature:e})}catch(e){}s.pushUpdate(o,e,i),a.filter(function(e){return e!==t}).forEach(function(e){s.pushDelete(o,e),r.removeFeature(e)}),l.features=[t],n.resolve(l)}else N.showUserMessage({type:"warning",message:"plugins.editing.messages.no_feature_selected",autoclose:!0}),n.reject()}),function(e){return t.apply(this,arguments)})).catch(function(){n.reject()})}).promise()}})],registerEscKeyEvent:!0})},(t||i)&&o.includes("add_feature")&&{id:"copyfeaturefromexternallayer",type:["add_feature"],name:"editing.tools.copyfeaturefromexternallayer",icon:"copyPolygonFromFeature.png",visible:function(t){function i(e){return!(e="VECTOR"===e.getType()&&e.getSource().getFeatures())||!e.length||U(e[0].getGeometry().getType(),a)}var n=N.getService("map"),a=r.getLayer().getGeometryType();return n.onbefore("loadExternalLayer",function(e){return!t.visible&&(t.visible=i(e))}),n.onafter("unloadExternalLayer",function(e){e=t.visible&&"VECTOR"===e.getType()&&e.getSource().getFeatures();e&&e.length&&U(e[0].getGeometry().getType(),a)&&(t.visible=n.getExternalLayers().find(function(e){return void 0!==i(e)}))}),!1},op:new _.Workflow({layer:e,type:"addfeaturefrommapvectorlayers",runOnce:!0,steps:[new O.SelectElementsStep({layer:e,type:"external",help:"editing.steps.help.copy"},!1),new O.OpenFormStep({layer:e,help:"editing.steps.help.copy"})],registerEscKeyEvent:!0})},n&&o.includes("add_feature")&&{id:"addfeature",type:["add_feature"],name:"editing.tools.add_feature",icon:"addTableRow.png",op:new _.Workflow({layer:e,type:"addtablefeature",steps:[new b.Step({help:"editing.steps.help.new",run:H.addTableFeature}),new O.OpenFormStep]})},n&&o.includes("delete_feature")&&o.includes("change_attr_feature")&&{id:"edittable",type:["delete_feature","change_attr_feature"],name:"editing.tools.update_feature",icon:"editAttributes.png",op:new _.Workflow({layer:e,type:"edittable",backbuttonlabel:"plugins.editing.form.buttons.save_and_back_table",runOnce:!0,steps:[new O.OpenTableStep]})}].filter(Boolean).map(function(e){return Object.assign(new D,e)})},r.state._tools.forEach(function(n){Object.assign(n,{disabledtoolsoftools:[],enabled:!1,active:!1,message:null,messages:n.op.getMessages(),visible:n.visible instanceof Function?n.visible(n):void 0===n.visible||n.visible,state:new Proxy({},{get:function(e,t){return n[t]},set:function(e,t,i){return n[t]=i,!0}}),start:r._startTool.bind(r,n),stop:r._stopTool.bind(r,n),getId:function(){return n.id},getOperator:function(){return n.op},setOperator:function(e){return n.op=e}})}),Object.assign(r.state,{tools:r.state._tools,originalState:{title:r.state.title,toolsoftool:[].concat(M(r.state.toolsoftool))}}),r.originalState=r.state.originalState,r.uniqueFields&&(r.getFieldUniqueValuesFromServer(),r._resetOnSaveChangesOnServer=!0),r._getFeaturesEvent={event:null,fnc:null},r.messages={constraint:{scale:(""+z("editing.messages.constraints.enable_editing")+r.state._constraints.scale).toUpperCase()}},r.startResolve=null,r._olStartKeysEvent=[],r.unwatches=[],r;throw new TypeError("Cannot call a class as a function");function p(){var e=d.bool&&0<u.getFeatures().filter(function(e){var t=e.getGeometry()&&e.getGeometry().getType();return e.__layerId!==s&&U(l,t)&&(l===t||V.isMultiGeometry(l)||!V.isMultiGeometry(t))}).length;return d.tool.enabled=e}}return a.prototype=Object.create(r&&r.prototype,{constructor:{value:a,enumerable:!1,writable:!0,configurable:!0}}),r&&(Object.setPrototypeOf?Object.setPrototypeOf(a,r):a.__proto__=r),o(y,[{key:"_stopSessionChildren",value:function(t){var i=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing"),e=i.getLayerById(t);(0,w.getRelationsInEditing)({layerId:t,relations:e.getRelations()?e.getRelations().getArray():[]}).filter(function(e){return e.getFather()===t}).forEach(function(e){e=(0,k.getRelationId)({layerId:t,relation:e});i.getToolBoxById(e).inEditing()||i.state.sessions[e].stop()})}},{key:"getState",value:function(){return this.state}},{key:"setShow",value:function(){this.state.show=!(0<arguments.length&&void 0!==arguments[0])||arguments[0]}},{key:"getLayer",value:function(){return this.state.layer}},{key:"isFather",value:function(){return this.state.editing.father}},{key:"getDependencies",value:function(){return this.state.editing.dependencies}},{key:"hasDependencies",value:function(){return 0<this.state.editing.dependencies.length}},{key:"getFieldUniqueValuesFromServer",value:function(){var i=this,e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).reset,n=void 0!==e&&e;this.state.layer.getWidgetData({type:"unique",fields:Object.values(this.uniqueFields).map(function(e){return e.name}).join()}).then(function(e){Object.entries(e.data).forEach(function(e){var e=m(e,2),t=e[0],e=e[1];n&&i.uniqueFields[t].input.options.values.splice(0),e.forEach(function(e){return i.uniqueFields[t].input.options.values.push(e)})})}).fail(console.warn)}},{key:"setFeaturesOptions",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).filter;e?(e.nofeatures&&(e.nofeatures_field=e.nofeatures_field||this.state.layer.getEditingFields()[0].name),this.state._getFeaturesOption={filter:e,editing:!0,registerEvents:!1},e.constraint&&(this.constraintFeatureFilter=e)):this.state._getFeaturesOption=(0,s.createEditingDataOptions)(G.LayerTypes.TABLE===this.state._layerType?"all":"bbox",{layerId:this.getId()})}},{key:"setEditingConstraints",value:function(){var t=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Object.keys(i).forEach(function(e){return t.constraints[e]=i[e]})}},{key:"_handleScaleConstraint",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],i=N.getService("map").getMap(),n=(this.state.editing.canEdit=f(i.getView().getResolution())<=this.state._constraints.scale,this._start||this.startResolve),a=!t&&this.state.selected&&!this.state.editing.canEdit,r=N.getService("map").getCurrentToggledMapControl();r&&r.cursorClass&&(t||n)&&r.setMouseCursor(!a),i.getViewport().classList.toggle("ol-zoom-in",a),!t&&this.state.selected&&n?(this.state.editing.canEdit&&this.startResolve&&this.startResolve(),setTimeout(function(){return N.setModal(!e.state.editing.canEdit,e.messages.constraint.scale)})):N.setModal(!1)}},{key:"start",value:function(){var t,c=this,f=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return $.Deferred((t=A(function*(i){function e(e){return t.apply(this,arguments)}var t,n=c.getId(),a=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").state.constraints.toolboxes[n],r=f.toolboxheader,r=void 0===r||r,o=f.startstopediting,o=void 0===o||o,s=f.changingtools,l=f.tools,u=f.filter,d=(c.state.changingtools=void 0!==s&&s,l&&c.setEnablesDisablesTools(l),c.state.toolboxheader=r,c.state.startstopediting=o,u=a&&a.filter||c.constraints.filter||u,c.state.layer.getFeaturesStore().onceafter("featuresLockedByOtherUser",function(){N.showUserMessage({type:"warning",subtitle:c.state.layer.getName().toUpperCase(),message:"plugins.editing.messages.featureslockbyotheruser"})})),s=(c.state._unregisterStartSettersEventsKey.push(function(){return c.state.layer.getFeaturesStore().un("featuresLockedByOtherUser",d)}),c.state._constraints.scale&&(yield new Promise(function(e){c.startResolve=e,c._handleScaleConstraint();var t=N.getService("map");c._olStartKeysEvent.push(t.getMap().on("click",function(e){c.state.selected&&!c.state.editing.canEdit&&t.goToRes(e.coordinate,p(c.state._constraints.scale,N.getService("map").getMapUnits()))})),c.state.editing.canEdit&&e()})),c.startResolve=null,c.setFeaturesOptions({filter:u}),t=A(function*(e){c.emit("start-editing"),yield(0,g.setLayerUniqueFieldValues)(c.getId()),yield g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").runEventHandler({type:"start-editing",id:n});try{var t=yield(0,R.promisify)(e);c.stopLoading(),c.setEditing(!0),yield g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").runEventHandler({type:"get-features-editing",id:n,options:{features:t}}),i.resolve({features:t})}catch(e){N.notify.error(e.message),yield g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").runEventHandler({type:"error-editing",id:n,error:e}),c.stop(),c.stopLoading(),i.reject(e)}}),!!c.__isStarted()),l=j.ismobile&&N.getService("map").isMapHidden()&&G.LayerTypes.VECTOR===c.state._layerType;!s&&l&&(c.setEditing(!0),N.getService("map").onceafter("setHidden",function(){setTimeout(function(){c._start=!0,c.startLoading(),c.setFeaturesOptions({filter:u}),c._session.start(c.state._getFeaturesOption).then(e).fail(function(){return c.setEditing(!1)})},300)})),s||l||(c._start=!0,c.startLoading(),c._session.start(c.state._getFeaturesOption).then(e)),s&&!c._start&&(c.startLoading(),c._session.getFeatures(c.state._getFeaturesOption).then(e),c._start=!0),s&&c.setEditing(!0)}),function(e){return t.apply(this,arguments)})).promise()}},{key:"startLoading",value:function(){this.state.loading=!0}},{key:"stopLoading",value:function(){this.state.loading=!1}},{key:"stop",value:function(){var e=this;return(0,R.$promisify)(A(function*(){if(e.disableCanEditEvent&&e.disableCanEditEvent(),e.state._unregisterStartSettersEventsKey.forEach(function(e){return e()}),e.state._unregisterStartSettersEventsKey=[],e._olStartKeysEvent.forEach(function(e){return ol.Observable.unByKey(e)}),e._olStartKeysEvent.splice(0),e.unwatches.forEach(function(e){return e()}),e.unwatches.splice(0),e.startResolve=null,e._start=!1,e.state.editing.on=!1,e.state._constraints.scale&&e._handleScaleConstraint(!0),!!!e.__isStarted())return!0;if(j.online){var t=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing"),i=e.state.id;if(0<t.getLayerById(i).getFathers().filter(function(e){e=t.getToolBoxById(e);if(e&&e.inEditing()&&e.isDirty())return Object.keys(e.getSession().getCommitItems()||{}).find(function(e){return i===e})}).length)e.stopActiveTool(),e.enableTools(!1),e.clearToolboxMessages(),G.LayerTypes.VECTOR===e.state._layerType&&N.getService("map").getMap().un(e._getFeaturesEvent.event,e._getFeaturesEvent.fnc),e._stopSessionChildren(e.state.id),g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").state.uniqueFieldsValues[e.getId()]={};else try{return yield(0,R.promisify)(e._session.stop()),e.state.enabled=!1,e.stopLoading(),e.state._getFeaturesOption={},e.stopActiveTool(),e.enableTools(!1),e.clearToolboxMessages(),e.emit("stop-editing"),g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").state.uniqueFieldsValues[e.getId()]={},!0}catch(e){return Promise.reject(e)}}}))}},{key:"save",value:function(){var a=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.ids,t=void 0===t?null:t,i=e.items,n=e.relations,n=void 0===n||n,e=e.__esPromise,r=void 0!==e&&e,o=$.Deferred(),s=void 0;return t?(s=this.__commit(t),this.__clearHistory(t)):(s=i||this.__getCommitItems(this.__commit()),n||(s.relations={}),this.state.layer.getEditor().commit(s).then(function(e){if(e&&e.result){var t,i=e.response.new_relations,n=void 0===i?{}:i;for(t in n)y.get(t).getSession().getEditor().applyCommitResponse({response:n[t],result:!0});a.__clearHistory(),a._session.saveChangesOnServer(s),r?o.resolve({commit:s,response:e}):o.resolve(s,e)}else o.reject(e)}).fail(function(e){return o.reject(e)})),o.promise()}},{key:"getEditingConstraints",value:function(){return this.state._constraints}},{key:"canEdit",value:function(){return this.state.editing.canEdit}},{key:"setMessage",value:function(e){this.state.message=e}},{key:"getMessage",value:function(){return this.state.message}},{key:"clearMessage",value:function(){this.setMessage(null)}},{key:"clearToolboxMessages",value:function(){this.state.toolmessages.help=null,this.clearMessage()}},{key:"getId",value:function(){return this.state.id}},{key:"getTitle",value:function(){return this.state.title}},{key:"setTitle",value:function(e){this.state.customTitle=!0,this.state.title=e}},{key:"getColor",value:function(){return this.state.color}},{key:"setEditing",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.setEnable(e),this.state.editing.on=e,this.enableTools(e)}},{key:"inEditing",value:function(){return this.state.editing.on}},{key:"isEnabled",value:function(){return this.state.enabled}},{key:"setEnable",value:function(){return this.state.enabled=0<arguments.length&&void 0!==arguments[0]&&arguments[0],this.state.enabled}},{key:"isLoading",value:function(){return this.state.loading}},{key:"isDirty",value:function(){return this.state.editing.history.commit}},{key:"isSelected",value:function(){return this.state.selected}},{key:"setSelected",value:function(){var e,t=this;this.state.selected=0<arguments.length&&void 0!==arguments[0]&&arguments[0],this.state._constraints.scale&&(e=N.getService("map").getMap(),this._handleScaleConstraint(),this._start&&this.state.canEdit&&e.dispatchEvent({type:this._getFeaturesEvent.event,target:e}),this.state.selected&&!this.keyChangeResolution&&(this.keyChangeResolution=e.getView().on("change:resolution",function(){return t._handleScaleConstraint()})),!this.state.selected)&&this.keyChangeResolution&&(ol.Observable.unByKey(this.keyChangeResolution),this.keyChangeResolution=null)}},{key:"getTools",value:function(){return this.state._tools}},{key:"getToolById",value:function(t){return this.state._tools.find(function(e){return t===e.getId()})}},{key:"setEnableTool",value:function(t){this.state._tools.find(function(e){return e.getId()===t}).state.enabled=!0}},{key:"setAddEnableTools",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.tools,i=void 0===t?{}:t,t=e.options,e=(void 0===t?{editing_constraints:!0}:t).editing_constraints,n=void 0!==e&&e;this.setEnablesDisablesTools({enabled:this.state._tools.filter(function(e){return n?e.type.includes("add_feature"):["addfeature","editattributes","movefeature","movevertex"].includes(e.getId())}).map(function(e){return{id:e.getId(),options:i[e.getId()]}})}),this.enableTools(!0)}},{key:"setUpdateEnableTools",value:function(e){var t=e.tools,i=void 0===t?{}:t,t=e.excludetools,n=void 0===t?[]:t,t=e.options,e=(void 0===t?{editing_constraints:!0}:t).editing_constraints,a=void 0!==e&&e,r=["editattributes","movefeature","movevertex"],t=this.state._tools.filter(function(e){return-1===n.indexOf(e.getId())&&(a?e.type.find(function(e){return"change_feature"===e||"change_attr_feature"===e}):-1!==r.indexOf(e.getId()))}).map(function(e){e=e.getId();return{id:e,options:i[e]}});this.setEnablesDisablesTools({enabled:t}),this.enableTools(!0)}},{key:"setEnablesDisablesTools",value:function(e){var t,a,r=this;e&&(this.state.changingtools=!0,t=e.enabled,e=void 0===(e=e.disabled)?[]:e,a=(t=void 0===t?[]:t).length?[]:this.state._tools.map(function(e){return e.getId()}),t.forEach(function(e){var t,i=e.id,e=e.options,e=void 0===e?{}:e,n=r.getToolById(i);n&&(t=void 0!==(t=e.active)&&t,n.messages=e.messages||n.messages,n.visible=void 0===e.visible||e.visible,n.enabled=void 0!==e.enabled&&e.enabled,n.disabledtoolsoftools=void 0!==e.disabledtoolsoftools?e.disabledtoolsoftools:[],n.visible&&a.push(i),t&&r.setActiveTool(n),void 0===r.state._enabledtools&&(r.state._enabledtools=[]),r.state._enabledtools.push(n))}),e.forEach(function(e){var t=e.id;e.options;r.getToolById(t)&&(void 0===r.state._disabledtools&&(r.state._disabledtools=[]),r.state._disabledtools.push(t),a.push(t))}),this.state._tools.forEach(function(e){return!a.includes(e.getId())&&(e.visible=!1)}),this.state.changingtools=!1)}},{key:"enableTools",value:function(){var i=0<arguments.length&&void 0!==arguments[0]&&arguments[0],e=this.state._enabledtools||this.state._tools,n=this.state._disabledtools||[];e.forEach(function(e){var t=void 0!==e.enable?e.enable:i;e.enabled=i&&n.length?-1===n.indexOf(e.getId()):"Boolean"===d(t)?t:t({bool:i,tool:e}),i||(e.active=i)})}},{key:"setActiveTool",value:function(i){var n=this;return(0,R.$promisify)(A(function*(){try{yield(0,R.promisify)(n.stopActiveTool(i)),n.state.toolsoftool.splice(0);var e=(n.state.activetool=i).getOperator(),t=(e&&(e.once("settoolsoftool",function(e){var t;return(t=n.state.toolsoftool).push.apply(t,M((e||[]).filter(function(e){return!i.disabledtoolsoftools.includes(e.type)})))}),e.once("start",function(t){return n.state.toolsoftool.forEach(function(e){return(t||[]).includes(e.type)&&(e.options.active=!0)})}),e.once("stop",function(e){return n._deactivetools(i,e)}),e.once("reject",function(e){return n._deactivetools(i,e)})),i.start(),n.state.activetool.getOperator().getHelpMessage()||n.state.activetool.getOperator().getRunningStep()?n.state.activetool.messages:null);n.state.toolmessages.help=t&&t.help||null}catch(e){}}))}},{key:"_deactivetools",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];e===this.state.activetool&&(this.state.activetool=null,this.state.toolsoftool.splice(0)),this.state.toolsoftool.forEach(function(e){return t.includes(e.type)&&(e.options.active=!1)})}},{key:"getActiveTool",value:function(){return this.state.activetool}},{key:"stopActiveTool",value:function(t){var i=this;return(0,R.$promisify)(A(function*(){var e=i.getActiveTool();if(!t||e&&t!==e)try{e&&(e.removeAllListeners(),yield(0,R.promisify)(e.stop(!0))),i.state.toolsoftool.splice(0),i.state.toolmessages.help=null,i.state.activetool=null}catch(e){}else t.removeAllListeners()}))}},{key:"getSession",value:function(){return this._session}},{key:"getEditor",value:function(){return this.state.layer.getEditor()}},{key:"resetDefault",value:function(){this.state.title=this.state.originalState.title,this.state.toolboxheader=!0,this.state.startstopediting=!0,this.constraints={filter:null,show:null,tools:[]},this.state._enabledtools&&(this.state._enabledtools=void 0,this.enableTools(),this.state._tools.forEach(function(e){e.visible=!0,e.enabled=!1,e.messages=e.op.getMessages(),e.disabledtoolsoftools=[]})),this.state._disabledtools=null,this.setShow(!0)}},{key:"__add",value:function(e,t){var i=this,n=$.Deferred();return null===this.state.editing.session.current?this._states=[{id:e,items:t}]:(0<this._states.length&&this.state.editing.session.current<this._states.at(-1).id&&(this._states=this._states.filter(function(e){return e.id<=i.state.editing.session.current})),this._states.push({id:e,items:t})),this.state.editing.session.current=e,this.__canUndo(),this.__canCommit(),this.__canRedo(),n.resolve(e),n.promise()}},{key:"__undo",value:function(){var i=this,n=void 0;return this.state.editing.session.current===this._states[0].id?(this.state.editing.session.current=null,n=this._states[0].items):this._states.find(function(e,t){if(e.id===i.state.editing.session.current)return n=i._states[t].items,i.state.editing.session.current=i._states[t-1].id,!0}),n=(0,l.checkSessionItems)(this._history.id,n,0),this.__canUndo(),this.__canCommit(),this.__canRedo(),n}},{key:"__redo",value:function(){var i=this,n=void 0;return this.state.editing.session.current?this._states.find(function(e,t){if(i.state.editing.session.current===e.id)return i.state.editing.session.current=i._states[t+1].id,n=i._states[t+1].items,!0}):(n=this._states[0].items,this.state.editing.session.current=this._states[0].id),n=(0,l.checkSessionItems)(this._history.id,n,1),this.__canUndo(),this.__canCommit(),this.__canRedo(),n}},{key:"__getState",value:function(t){return this._states.find(function(e){return e.id===t})}},{key:"__canCommit",value:function(){var e,t=this.__commit(),i=!1;for(e in t)var n=t[e],i=i||0<n.length;return this._constrains.commit=i,this._constrains.commit}},{key:"__canUndo",value:function(){var i=this,n=null,e=(this.state.editing.session.current&&this._states.length&&this._states.forEach(function(e,t){if(i.state.editing.session.current===e.id)return n=t,!1}),this._states.length-1-n);return this._constrains.undo=null!==this.state.editing.session.current&&e<10,this._constrains.undo}},{key:"__canRedo",value:function(){return this._constrains.redo=this._states.at(-1)&&this._states.at(-1).id!=this.state.editing.session.current||null===this.state.editing.session.current&&0<this._states.length,this._constrains.redo}},{key:"__commit",value:function(){var t=this,a={};return this._states.filter(function(e){return e.id<=t.state.editing.session.current}).forEach(function(e){e.items.forEach(function(i){var e,t,n=!0;Array.isArray(i)&&(i=i[1]),a[i.layerId]&&a[i.layerId].forEach(function(e,t){if(e.getUid()===i.feature.getUid())return i.feature.isNew()&&!e.isDeleted()&&i.feature.isUpdated()?((e=i.feature.clone()).add(),a[i.layerId][t]=e):i.feature.isNew()&&i.feature.isDeleted()?a[i.layerId].splice(t,1):(i.feature.isUpdated()||i.feature.isDeleted())&&(a[i.layerId][t]=i.feature),n=!1}),n&&(e=i.feature,t=i.layerId,!e.isNew()&&e.isAdded()||(a[t]||(a[t]=[]),a[t].push(e)))})}),a}},{key:"__getLastHistoryState",value:function(){return this._states.at(-1)||null}},{key:"__isStarted",value:function(){return this.state.editing.session.started}},{key:"__getHistory",value:function(){return this._history}},{key:"__getEditor",value:function(){return this.state.layer.getEditor()}},{key:"__push",value:function(e,t){this.state.editing.session.changes.push(t?[t,e]:e)}},{key:"__pushDelete",value:function(e,t){return this.__push({layerId:e,feature:t.delete()}),t}},{key:"__save",value:function(){var t=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return(0,R.$promisify)(A(function*(){var e;return t.state.editing.session.changes.length?(e=i.id||Date.now(),yield(0,R.promisify)(t.__add(e,t.state.editing.session.changes)),t.state.editing.session.changes=[],e):null}))}},{key:"__pushAdd",value:function(e,t){var i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],n=(e===this.state.layer.getId()?this.state.layer:y.get(e).getSession()).getEditor(),i=(i&&(n.getLayer().getEditingNotEditableFields()||[]).forEach(function(e){return t.unset([e])}),t.clone());return this.__push({layerId:e,feature:i.add()}),i}},{key:"__pushUpdate",value:function(t,i,e){var n=i.isNew(),a=n&&this.state.editing.session.changes.findIndex(function(e){return t===e.layerId&&e.feature.getId()===i.getId()});n&&0<=a?((n=i.clone()).add(),this.state.editing.session.changes[a].feature=n):this.__push({layerId:t,feature:i.update()},{layerId:t,feature:e.update()})}},{key:"__rollback",value:function(i){var n=this;return i?this.state.layer.getEditor().rollback(i):(0,R.$promisify)(A(function*(){var t=n.state.layer.getId();i={own:[],dependencies:{}},n.state.editing.session.changes.forEach(function(e){e=Array.isArray(e)?e[0]:e;e.layerId===t?i.own.push(e):(i.dependencies[e.layerId]=i.dependencies[e.layerId]||[],i.dependencies[e.layerId].unshift(e))});try{for(var e in yield(0,R.promisify)(n.state.layer.getEditor().rollback(i.own)),i.dependencies)y.get(e).getSession().rollback(i.dependencies[e]);return i.dependencies}catch(e){}finally{n.state.editing.session.changes=[]}}))}},{key:"__rollbackDependecies",value:function(){var e=this;(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(t){var i=[];e.state.editing.session.changes=e.state.editing.session.changes.filter(function(e){if(e.layerId===t)return i.push(e),!1}),i.length&&y.get(t).getSession().rollback(i)})}},{key:"__undoSession",value:function(e){return e=e||this.__undo(),this.state.layer.getEditor().setChanges(e.own,!0),this.__canCommit(),e.dependencies}},{key:"__redoSession",value:function(e){return e=e||this.__redo(),this.state.layer.getEditor().setChanges(e.own,!0),this.__canCommit(),e.dependencies}},{key:"__getCommitItems",value:function(){var e,i=this,t=this.__commit(),n=this.state.layer.getId(),r=void 0,o=void 0,a={add:[],update:[],delete:[],relations:{}};for(e in t){var s,l=!1,u=t[e],o=e!==n?(l=!0,s=(s=y.get(e).getSession())?s.getEditor().getLockIds():[],a.relations[e]={lockids:s,add:[],update:[],delete:[],relations:{}},a.relations[e]):a;u.forEach(function(e){r=e.getState();var t=new ol.format.GeoJSON;if("delete"===r)e.isNew()||o.delete.push(e.getId());else{var i,n=t.writeFeatureObject(e),a=e.getProperties();for(i in n.properties)n.properties[i]&&"object"===c(n.properties[i])&&n.properties[i].constructor===Object&&(n.properties[i]=n.properties[i].value),void 0===n.properties[i]&&a[i]&&(n.properties[i]=a[i]);o[e.isNew()?"add":e.getState()].push(n)}}),l&&0===o.add.length&&0===o.update.length&&0===o.delete.length&&delete a.relations[e]}var d=Object.keys(a.relations||{});return d.filter(function(t){return void 0===i.state.layer.getEditor().getLayer().getRelations().getArray().find(function(e){return t===e.getChild()})}).map(function(e){return a.relations[y.get(e).getSession().getEditor().getLayer().getRelations().getArray().find(function(e){return-1!==d.indexOf(e.getFather())}).getFather()].relations[e]=a.relations[e],e}).forEach(function(e){return delete a.relations[e]}),a}},{key:"__clearSession",value:function(){this._allfeatures=!1,this.state.editing.session.started=!1,this.state.editing.session.getfeatures=!1,this.__clearHistory()}},{key:"__clearHistory",value:function(i){var n=this;i?this._states.forEach(function(e,t){-1!==i.indexOf(e.id)&&(n.state.editing.session.current&&n.state.editing.session.current===e.id()&&n.__undo(),n._states.splice(t,1))}):(this._states=[],this.state.editing.session.current=null,this._constrains.commit=!1,this._constrains.redo=!1,this._constrains.undo=!1)}},{key:"__startSession",value:(i=A(function*(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};try{var i=yield(0,R.promisify)(this.state.layer.getEditor().start(e));return this.state.editing.session.started=!0,i}catch(e){return Promise.reject(e)}finally{if(!e.registerEvents)return;this.state._getFeaturesOption=e,G.LayerTypes.VECTOR===this.state._layerType&&this.state._getFeaturesOption.filter.bbox&&(this._getFeaturesEvent.event="moveend",this._getFeaturesEvent.fnc=u(function(){j.online&&t.state.editing.canEdit&&t.state.selected&&0===N.getContentLength()&&(t.state._getFeaturesOption.filter.bbox=N.getService("map").getMapBBOX(),t.state.loading=!0,t._session.getFeatures(t.state._getFeaturesOption).then(function(e){return e.then(function(){return t.state.loading=!1})}))},300),this._olStartKeysEvent.push(N.getService("map").getMap().on("moveend",this._getFeaturesEvent.fnc)),N.getContentLength())&&N.once("closecontent",function(){var e=N.getService("map").getMap();setTimeout(function(){e.dispatchEvent({type:t._getFeaturesEvent.event,target:e})})})}}),function(){return i.apply(this,arguments)})},{key:"__stopSession",value:(t=A(function*(){try{(this.state.editing.session.started||this.state.editing.session.getfeatures)&&(yield(0,R.promisify)(this.state.layer.getEditor().stop()),this.__clearSession())}catch(e){return Promise.reject(e)}finally{if(!this.inEditing())return;j.online&&this._stopSessionChildren(this.state.id),this.state._getFeaturesOption.registerEvents&&G.LayerTypes.VECTOR===this.state._layerType&&N.getService("map").getMap().un(this._getFeaturesEvent.event,this._getFeaturesEvent.fnc)}}),function(){return t.apply(this,arguments)})},{key:"__getFeatures",value:(e=A(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this._allfeatures?[]:(this._allfeatures=!e.filter,e=yield(0,R.promisify)(this.state.layer.getEditor().getFeatures(e)),this.state.editing.session.getfeatures=!0,e)}),function(){return e.apply(this,arguments)})},{key:"__saveChangesOnServer",value:function(e){this._resetOnSaveChangesOnServer&&this.getFieldUniqueValuesFromServer({reset:!0})}},{key:"_startTool",value:function(e){var t=this;e.getOperator()&&(e.active=!0,setTimeout(A(function*(){return yield t._startOp(e,{inputs:{layer:t.getLayer(),features:[]},context:{session:t._session}},!!N.getService("map").isMapHidden())})))}},{key:"_startOp",value:(n=A(function*(e,t,i){t.inputs.features=[],i&&N.hideSidebar();try{yield(0,R.promisify)(e.op.start(t)),yield(0,R.promisify)(this._session.save()),g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").saveChange()}catch(e){i&&N.showSidebar(),this._session.rollback()}finally{e.getOperator().runOnce||G.LayerTypes.TABLE===this.getLayer().getType()?e.stop():yield this._startOp(e,t,i)}}),function(e,t,i){return n.apply(this,arguments)})},{key:"_stopTool",value:function(e){var t=this,i=1<arguments.length&&void 0!==arguments[1]&&arguments[1];return(0,R.$promisify)(A(function*(){if(e.getOperator())try{yield(0,R.promisify)(e.getOperator().stop(i))}catch(e){t._session.rollback()}finally{e.active=!1,e.emit("stop",{session:t._session})}else e.emit("stop",{session:t._session})}))}}]),y}();i._sessions={},i.get=function(e){return i._sessions[e]},i.clear=function(){return Object.keys(sessions).forEach(function(e){return delete i._sessions[e]})}},{"../components/CopyFeaturesFromOtherLayers.vue":4,"../eventbus":11,"../g3wsdk/workflow/step":14,"../g3wsdk/workflow/workflow":15,"../utils/addPartToMultigeometries":28,"../utils/addTableFeature":30,"../utils/checkSessionItems":32,"../utils/chooseFeature":33,"../utils/chooseFeatureFromFeatures":34,"../utils/cloneFeature":35,"../utils/convertToGeometry":36,"../utils/createEditingDataOptions":37,"../utils/evaluateExpressionFields":39,"../utils/getDeltaXY":40,"../utils/getEditingLayerById":41,"../utils/getLayersDependencyFeatures":44,"../utils/getNotEditableFieldsNoPkValues":45,"../utils/getProjectLayerFeatureById":47,"../utils/getRelationFieldsFromRelation":49,"../utils/getRelationId":50,"../utils/getRelationsInEditing":51,"../utils/getRelationsInEditingByFeature":52,"../utils/handleSplitFeature":54,"../utils/isPointOnVertex":55,"../utils/promisify":57,"../utils/setAndUnsetSelectedFeaturesStyle":58,"../utils/setLayerUniqueFieldValues":60,"../utils/unlinkRelation":61,"../workflows":63}],28:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.addPartToMultigeometries=function(a,r){return(0,n.$promisify)(function(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,i){try{var n=s[e](i),a=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});r(a)}("next")})}}(function*(){var e,t=a.layer.getId(),i=void 0,n=void 0;1<a.features.length?(e=(i=a.features[0]).getGeometry(),n=i.clone(),e.setCoordinates([].concat(s(e.getCoordinates()),s(a.features[1].getGeometry().getCoordinates())))):(n=(i=a.layer.getEditingLayer().getSource().getFeatures()[0]).clone(),i.setGeometry(a.features[0].getGeometry()));try{yield(0,o.evaluateExpressionFields)({inputs:a,context:r,feature:i})}catch(e){}return r.session.pushUpdate(t,i,n),a.features=[i],a}))};var o=e("../utils/evaluateExpressionFields"),n=e("./promisify");function s(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}},{"../utils/evaluateExpressionFields":39,"./promisify":57}],29:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.addRemoveToMultipleSelectFeatures=function(e,i,n,a){(e||[]).forEach(function(e){var t=n.indexOf(e);t<0?(a._originalStyle=(0,r.setFeaturesSelectedStyle)([e]),n.push(e)):(n.splice(t,1),e.setStyle(a._originalStyle)),i.features=n});var e=a.getSteps(),t=e.select.buttonnext;t.disabled=t.condition?t.condition({features:n}):0===n.length,void 0!==e.select.dynamic&&(e.select.dynamic=n.length)};var r=e("../utils/setFeaturesSelectedStyle")},{"../utils/setFeaturesSelectedStyle":59}],30:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.addTableFeature=function(t,i){var e=0<t.features.length?t.features[t.features.length-1]:t.layer.createNewFeature();return e.setTemporaryId(),t.layer.getEditingLayer().getEditingSource().addFeature(e),i.session.pushAdd(t.layer.getId(),e,!1),t.features.push(e),this.getContext().get_default_value=!0,$.Deferred(function(e){return e.resolve(t,i)}).promise()}},{}],31:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.areCoordinatesEqual=function(e){function n(e,t){return g3wsdk.core.geoutils.areCoordinatesEqual(e,t)}var t=e.feature,a=e.coordinates,i=t.getGeometry(),e=i.getType();switch(e){case"Polygon":case"MultiLineString":return a=_.flatMap(a),_.flatMap(i.getCoordinates()).every(function(e,t){return n(e,a[t])});case"LineString":case"MultiPoint":return i.getCoordinates().every(function(e,t){return n(e,a[t])});case"MultiPolygon":return a.length!==i.getPolygons().length?!1:i.getPolygons().some(function(e,t){var i=_.flatMap(a[t]);return _.flatMap(e.getCoordinates()).every(function(e,t){return n(e,i[t])})});case"Point":return n(a,i.getCoordinates());default:return!1}}},{}],32:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.checkSessionItems=function(t,e,i){var n={own:[],dependencies:{}};return e.forEach(function(e){Array.isArray(e)&&(e=e[i]),(t===e.layerId?n:(n.dependencies[e.layerId]=n.dependencies[e.layerId]||{own:[],dependencies:{}},n.dependencies[e.layerId])).own.push(e)}),n}},{}],33:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.chooseFeature=function(t){return(0,a.$promisify)(function(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,i){try{var n=s[e](i),a=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});r(a)}("next")})}}(function*(){try{var e;return 1!==t.features.length&&(e=yield(0,n.chooseFeatureFromFeatures)({features:t.features,inputs:t}),t.features=[e]),t}catch(e){return Promise.reject(e)}}))};var n=e("../utils/chooseFeatureFromFeatures"),a=e("../utils/promisify")},{"../utils/chooseFeatureFromFeatures":34,"../utils/promisify":57}],34:[function(s,e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.chooseFeatureFromFeatures=function(e){var t=e.features,r=void 0===t?[]:t,o=e.inputs;return new Promise(function(e,t){var i=[],n=new(Vue.extend(s("../components/ChooseFeatureToEdit.vue")))({features:Array.isArray(r)?r:[],feature:i,attributes:o.layer.getEditingFields().map(function(e){return{name:e.name,label:e.label}})}),a=g3wsdk.gui.GUI.showModalDialog({title:l("editing.modal.tools.copyfeaturefromprojectlayer.title"),className:"modal-left",closeButton:!1,message:n.$mount().$el,buttons:{cancel:{label:"Cancel",className:"btn-danger",callback:function(){t()}},ok:{label:"Ok",className:"btn-success",callback:function(){e(i[0])}}}});a.find("button.btn-success").prop("disabled",!0),n.$watch("feature",function(e){return a.find("button.btn-success").prop("disabled",null===e)})})};var l=g3wsdk.core.i18n.tPlugin},{"../components/ChooseFeatureToEdit.vue":3}],35:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.cloneFeature=function(e,t){e=e.cloneNew(),t=t&&t.getEditingFields().find(function(e){return e.pk});t&&!1===t.editable&&e.set(t.name,null);return e}},{}],36:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.convertToGeometry=function(e,i){return(e||[]).flatMap(function(e){var t=e.getGeometry()&&e.getGeometry().getType();return t&&!r(i)?o({feature:e}):t&&r(i)&&s({feature:e,geometryType:i}),i===t?e:!n(t,i)||!l(i)&&l(t)?[]:((t=e.clone()).__layerId=e.__layerId,t.setGeometry(a(e.getGeometry(),i)),t)})};var i=g3wsdk.core.geoutils,n=i.isSameBaseGeometryType,a=i.convertSingleMultiGeometry,i=g3wsdk.core.geoutils.Geometry,r=i.is3DGeometry,o=i.removeZValueToOLFeatureGeometry,s=i.addZValueToOLFeatureGeometry,l=g3wsdk.core.geometry.Geometry.isMultiGeometry},{}],37:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.createEditingDataOptions=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"all",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=void 0;switch(e){case"all":i=void 0;break;case"bbox":i={bbox:n.getService("map").getMapBBOX()};break;case"field":i={field:{field:t.field,type:"editing"}};break;case"fid":"not"!==t.operator&&(i={fid:{fid:t.feature.getId(),layer:{id:t.layerId},type:"editing",relation:t.relation.state,formatter:0}});break;case"1:1":i={field:t.relation.getChildField()[0]+"|eq|"+t.feature.get(t.relation.getFatherField()[0]),type:"editing"}}return{registerEvents:!0,editing:!0,filter:i}};var n=g3wsdk.gui.GUI},{}],38:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.createFeature=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=new a;t.geometry&&i.setGeometry(new ol.geom[t.geometry.type](t.geometry.coordinates));i.setProperties(t.properties),i.setTemporaryId();var t=this.getToolBoxById(e),n=t.getLayer().getEditingLayer(),t=t.getSession();return n.getSource().addFeature(i),t.pushAdd(e,i,!1),i};var a=g3wsdk.core.layer.features.Feature},{}],39:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.evaluateExpressionFields=void 0;i.evaluateExpressionFields=(n=u(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=e.inputs,t=e.context,o=e.feature,s=[];return r.layer.getFieldsWithValues(o,{exclude:t.excludeFields,get_default_value:void 0!==t.get_default_value&&t.get_default_value}).forEach(function(i){var n,a;i.input.options.default_expression&&(i.input.options.default_expression.apply_on_update||o.isNew())&&s.push(new Promise((n=u(function*(e,t){try{yield g3wsdk.core.input.inputService.handleDefaultExpressionFormInput({field:i,feature:o,qgs_layer_id:r.layer.getId(),parentData:(0,l.getParentFormData)()}),o.set(i.name,i.value),e(o)}catch(e){t(e)}}),function(e,t){return n.apply(this,arguments)}))),i.input.options.filter_expression&&s.push(new Promise((a=u(function*(e,t){try{yield g3wsdk.core.input.inputService.handleFilterExpressionFormInput({field:i,feature:o,qgs_layer_id:r.layer.getId(),parentData:(0,l.getParentFormData)()}),o.set(i.name,i.value),e(o)}catch(e){t(e)}}),function(e,t){return a.apply(this,arguments)})))}),yield Promise.allSettled(s),o}),function(){return n.apply(this,arguments)});var n,l=e("./getParentFormData");function u(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,i){try{var n=s[e](i),a=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});r(a)}("next")})}}},{"./getParentFormData":46}],40:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.getDeltaXY=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.x,i=e.y,e=function e(t){return Array.isArray(t[0])?e(t[0]):{x:t[0],y:t[1]}}(e.coordinates);return{x:t-e.x,y:i-e.y}}},{}],41:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.getEditingLayerById=function(e){return g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").getLayerById(e)}},{}],42:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.getFeatureTableFieldValue=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layerId,i=e.feature,e=e.property,t=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").getLayerById(t).config.editing.fields,n=i.get(e),i=null!==n&&(t.filter(function(e){return["select_autocomplete","select"].includes(e.input.type)})||[]).reduce(function(e,t){return e[t.name]=t.input.options.values,e},{}),t=i&&i[e]&&i[e].find(function(e){return n==e.value});return t?t.key:n}},{}],43:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var f=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var i=t,n=[],a=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!i||n.length!==i);a=!0);}catch(e){t=!0,r=e}finally{try{!a&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},g=(i.getFormFields=function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=t.inputs,i=t.context,n=t.feature,a=t.isChild,o=void 0!==a&&a,a=t.multi,s=!1,l=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing"),u=g.Workflow.Stack.getFirst().getInputs().layer.getId(),d=r.layer.getId(),c=[],t=r.layer.getFieldsWithValues(n,{exclude:i.excludeFields,get_default_value:void 0!==i.get_default_value&&i.get_default_value});return t.forEach(function(e){e.validate.unique&&e.editable&&(s=!0,c.push({field:e,_value:n.get(e.name)}))}),c.forEach(function(e){var t=e._value,i=e.field,e=void 0,n=o&&l.state.uniqueFieldsValues[u]&&l.state.uniqueFieldsValues[u].__uniqueFieldsValuesRelations,a=n&&void 0!==n&&void 0!==n[d]&&void 0!==n[d][i.name];o&&a&&(e=n[d][i.name]),(e=o&&a?e:l.state.uniqueFieldsValues[d]?l.state.uniqueFieldsValues[d][i.name]:[]).forEach(function(e){i.validate.exclude_values.add(-1===[null,void 0].indexOf(e)?""+e:e)}),r.features.forEach(function(e){e=e.get(i.name);-1===[null,void 0].indexOf(e)&&i.validate.exclude_values.add(""+e)}),i.validate.exclude_values.delete(t)}),s&&(e=function(){c.forEach(function(e){var t,i,n=e._value,e=e.field;n!==e.value&&((t=o&&l.state.uniqueFieldsValues[u])&&(t.__uniqueFieldsValuesRelations=t.__uniqueFieldsValuesRelations||{},t.__uniqueFieldsValuesRelations[d]=t.__uniqueFieldsValuesRelations[d]||{},(i=new Set(l.state.uniqueFieldsValues[d][e.name])).delete(n),i.add(e.value),t.__uniqueFieldsValuesRelations[d][e.name]=i),!t)&&l.state.uniqueFieldsValues[d]&&void 0!==l.state.uniqueFieldsValues[d][e.name]&&((i=l.state.uniqueFieldsValues[d][e.name]).delete(n),i.add(e.value))});var e=!1===o&&l.state.uniqueFieldsValues[d]&&l.state.uniqueFieldsValues[d].__uniqueFieldsValuesRelations;return e&&void 0!==e&&(Object.keys(e).forEach(function(i){Object.entries(e[i]).forEach(function(e){var e=f(e,2),t=e[0],e=e[1];l.state.uniqueFieldsValues[i][t]=e})}),l.state.uniqueFieldsValues[d])&&delete l.state.uniqueFieldsValues[d].__uniqueFieldsValuesRelations,{once:!0}},l.subscribe("savedfeature_"+d,e),l.subscribe("closeform_"+d,function(){return l.unsubscribe("savedfeature_"+d,e),l.state.uniqueFieldsValues[d]&&delete l.state.uniqueFieldsValues[d].__uniqueFieldsValuesRelations,{once:!0}})),p(t,a)},e("../g3wsdk/workflow/workflow"));function p(e,t){return e=t?e.map(function(e){e=JSON.parse(JSON.stringify(e));return e.value=null,e.forceNull=!0,e.validate.required=!1,e}).filter(function(e){return!e.pk}):e}},{"../g3wsdk/workflow/workflow":15}],44:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.getLayersDependencyFeatures=void 0;i.getLayersDependencyFeatures=(n=r(function*(u){var t,d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},c=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing"),e=c.getLayerById(u),e=d.relations||e.getChildren().length&&e.getRelations()&&(0,a.getRelationsInEditing)({layerId:u,relations:e.getRelations().getArray().filter(function(e){return e.getFather()===u})})||[],i=void 0;try{i=yield Promise.all(e.map((t=r(function*(e){e.setLoading?e.setLoading(!0):e.loading=!0;var t=(0,p.getRelationId)({layerId:u,relation:e}),i=(d.relation=e,d.layerId=u,d.filterType="ONE"===(e.getType?e.getType():e.type)?"1:1":d.filterType,d.filterType||"fid"),i=(0,y.createEditingDataOptions)(i,d),n=c.state.sessions[t],a=h.online&&n,r=c.getToolBoxById(t),e=(d.operator=void 0!==d.operator?d.operator:"eq",(0,g.getRelationFieldsFromRelation)({layerId:t,relation:e})),o=e.ownField,e=e.relationField,s=c.getLayerById(u).readEditingFeatures(),l=e.map(function(e){return d.feature.get(e)}),e=(!h.online||!n||n.isStarted())&&"eq"===d.operator&&o.every(function(t,i){return s.find(function(e){return l[i]==e.get(t)})});r.startLoading();try{a&&!n.isStarted()?yield(0,f.promisify)(n.start(i)):a&&!e&&(yield(0,f.promisify)(n.getFeatures(i)))}catch(e){try{yield(0,f.promisify)(e)}catch(e){}}return r.stopLoading(),t}),function(e){return t.apply(this,arguments)})))}catch(e){}return e.forEach(function(e){e.setLoading?e.setLoading(!1):e.loading=!1}),i}),function(e){return n.apply(this,arguments)});var n,f=e("../utils/promisify"),g=e("../utils/getRelationFieldsFromRelation"),p=e("../utils/getRelationId"),a=e("../utils/getRelationsInEditing"),y=e("../utils/createEditingDataOptions");function r(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,i){try{var n=s[e](i),a=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});r(a)}("next")})}}var h=g3wsdk.core.ApplicationState},{"../utils/createEditingDataOptions":37,"../utils/getRelationFieldsFromRelation":49,"../utils/getRelationId":50,"../utils/getRelationsInEditing":51,"../utils/promisify":57}],45:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.getNotEditableFieldsNoPkValues=function(e){var i=e.layer,n=e.feature;return i.getEditingNotEditableFields().reduce(function(e,t){return e[t]=i.isPkField(t)?null:n.get(t),e},{})}},{}],46:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.getParentFormData=function(){var e,t,i,n;if(1<a.Workflow.Stack.getLength())return i=a.Workflow.Stack.getParent().getInputs(),e=i.features,t=i.layer,i=i.fields,i=void 0===i?[]:i,n=e[e.length-1].clone(),i.forEach(function(e){var t=e.name,e=e.value;n.set(t,e)}),{feature:n,qgs_layer_id:t.getId()}};var a=e("../g3wsdk/workflow/workflow")},{"../g3wsdk/workflow/workflow":15}],47:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n,a;i.getProjectLayerFeatureById=(n=function*(e){var t=e.layerId,e=e.fid,i=void 0;try{var n=yield r.get({url:s.getLayerById(t).getUrl("data"),params:{fids:e}}),a=o(n);0<a.length&&(i=a[0])}catch(e){}return i},a=function(){var s=n.apply(this,arguments);return new Promise(function(r,o){return function t(e,i){try{var n=s[e](i),a=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});r(a)}("next")})},function(e){return a.apply(this,arguments)});var r=g3wsdk.core.utils.XHR,o=g3wsdk.core.geoutils.getFeaturesFromResponseVectorApi,s=g3wsdk.core.catalog.CatalogLayersStoresRegistry},{}],48:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.getRelation1_1ChildFeature=void 0;i.getRelation1_1ChildFeature=(n=function*(e){var t,i,n=e.relation,a=e.fatherFormRelationField,e=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing"),r=n.getFather(),o=n.getChild(),s=n.getChildField()[0],l=!1,u=e.getLayerById(o).getEditingSource().readFeatures().find(function(e){return a.value===e.get(s)});if(void 0===(u=void 0===u&&(i=(t=e.getLayerById(o).getFeaturesStore()).oncebefore("featuresLockedByOtherUser",function(e){return u=e[0]}),yield(0,f.getLayersDependencyFeatures)(r,{feature:new ol.Feature(function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i;return e}({},a.name,a.value)),relations:[n]}),t.un("featuresLockedByOtherUser",i),void 0===u)?e.getLayerById(o).getEditingSource().readFeatures().find(function(e){return a.value===e.get(s)}):u))try{var d=g.getLayerById(o),c=(yield p.getData("search:features",{inputs:{layer:d,formatter:0,filter:g3wsdk.core.utils.createFilterFormInputs({layer:d,search_endpoint:"api",inputs:[{attribute:s,value:a.value}]}),search_endpoint:"api"},outputs:!1})).data;c&&c[0]&&1===c[0].features.length&&(l=!0,u=c[0].features[0])}catch(e){}return{feature:u,locked:l}},a=function(){var s=n.apply(this,arguments);return new Promise(function(r,o){return function t(e,i){try{var n=s[e](i),a=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});r(a)}("next")})},function(e){return a.apply(this,arguments)});var n,a,f=e("../utils/getLayersDependencyFeatures");var g=g3wsdk.core.catalog.CatalogLayersStoresRegistry,p=g3wsdk.core.data.DataRouterService},{"../utils/getLayersDependencyFeatures":44}],49:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.getRelationFieldsFromRelation=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layerId,e=e.relation,t=(e.getChild?e.getChild():e.child)!==t,i=e.getFatherField?e.getFatherField():e.fatherField,e=e.getChildField?e.getChildField():e.childField;return{ownField:t?i:e,relationField:t?e:i}}},{}],50:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.getRelationId=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layerId,e=e.relation,i=e.getFather?e.getFather():e.father,e=e.getChild?e.getChild():e.child;return t===i?e:i}},{}],51:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.getRelationsInEditing=function(e){var t=e.layerId,e=e.relations;return(void 0===e?[]:e).filter(function(e){return g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").getToolBoxById((0,n.getRelationId)({layerId:t,relation:e}))})};var n=e("../utils/getRelationId")},{"../utils/getRelationId":50}],52:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.getRelationsInEditingByFeature=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},s=e.layerId,t=e.relations,t=void 0===t?[]:t,l=e.feature,u=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing"),d=[],c=void 0;return t.forEach(function(e){var t,i,n,a,r=e.getChild?e.getChild():e.child,o=e.getFatherField?e.getFatherField():e.fatherField,o=r===s?o:r;u.getLayerById(o)&&(t=u.getToolBoxById(o).getLayer(),i=u.getLayerById(e.getFather?e.getFather():e.father),r=(0,f.getRelationFieldsFromRelation)({layerId:o,relation:e}),n=r.ownField,a=r.relationField.map(function(e){return l.isNew()&&i.isPkField(e)?l.getId():l.get(e)}),c={relation:e.getState(),relations:u.getLayerById(o).readEditingFeatures().filter(function(i){return n.every(function(e,t){return i.get(e)==a[t]})}).map(function(e){return{fields:t.getFieldsWithValues(e,{relation:!0}),id:e.getId()}}),validate:{valid:!0}},d.push(c))}),d};var f=e("../utils/getRelationFieldsFromRelation")},{"../utils/getRelationFieldsFromRelation":49}],53:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n;i.handleRelation1_1LayerFields=(n=a(function*(){var c,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},f=e.layerId,t=e.features,g=void 0===t?[]:t,t=e.fields,p=void 0===t?[]:t,y=e.task;0!==g.length&&(c=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing"),t=h.getLayerById(f).getRelations().getArray().filter(function(e){return"ONE"===e.getType()}).map(function(d){return new Promise((t=a(function*(e){var t,i,n,a,r,o,s,l,u;f===d.getFather()&&(t=d.getFatherField()[0],null!==(i=g[0].get(t))&&(n=d.getChild(),a=d.getChildField()[0],r=c.getLayerById(n).getEditingSource(),o=s=void 0,s=r.readFeatures().find(function(e){return e.get(a)===i}),l=void 0!==c.getLayerById(d.getFather()).getEditingFields().filter(function(e){return e.vectorjoin_id&&e.vectorjoin_id===d.getId()}).find(function(e){var t=e.name;return p.find(function(e){return t==e.name}).update}),u=void 0===s,l)&&(u?((s=new g3wsdk.core.layer.features.Feature).setTemporaryId(),h.getLayerById(n).getEditingFields().forEach(function(e){return s.set(e.name,null)}),s.set(a,p.find(function(e){return t===e.name}).value),r.addFeature(s),o=s):s&&(o=s.clone()),s))&&(c.getLayerById(d.getFather()).getEditingFields().filter(function(e){return e.vectorjoin_id&&e.vectorjoin_id===d.getId()&&e.editable}).forEach(function(e){return o.set(e.name.replace(d.getPrefix(),""),g[0].get(e.name))}),u?(c.getLayerById(f).isPkField(t)&&s.set(a,g[0].getId()),y.getContext().session.pushAdd(n,o,!1)):(r.updateFeature(o),y.getContext().session.pushUpdate(n,o,s))),e()}),function(e){return t.apply(this,arguments)}));var t}),yield Promise.allSettled(t))}),function(){return n.apply(this,arguments)});function a(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,i){try{var n=s[e](i),a=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});r(a)}("next")})}}var h=g3wsdk.core.catalog.CatalogLayersStoresRegistry},{}],54:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.handleSplitFeature=void 0;var n,a,p=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var i=t,n=[],a=!0,t=!1,r=void 0;try{for(var o,s=e[Symbol.iterator]();!(a=(o=s.next()).done)&&(n.push(o.value),!i||n.length!==i);a=!0);}catch(e){t=!0,r=e}finally{try{!a&&s.return&&s.return()}finally{if(t)throw r}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},y=(i.handleSplitFeature=(n=function*(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=e.feature,a=e.inputs,r=e.context,e=e.splittedGeometries,t=void 0===e?[]:e,o=[],s=a.layer,l=r.session,u=s.getEditingLayer().getSource(),d=s.getId(),c=n.clone(),i=(a.features=t.length?[]:a.features,t.length),f=0;f<i;f++){var g=t[f];if(0===f){n.setGeometry(g);try{yield(0,h.evaluateExpressionFields)({inputs:a,context:r,feature:n})}catch(e){}l.pushUpdate(d,n,c)}else yield*function*(){var t=(0,y.cloneFeature)(c,s);t.setGeometry(g),s.getEditingMediaFields({}).forEach(function(e){return t.set(e,null)}),(n=new m({feature:t})).setTemporaryId();try{yield(0,h.evaluateExpressionFields)({inputs:a,context:r,feature:n})}catch(e){}var i,e=(0,v.getNotEditableFieldsNoPkValues)({layer:s,feature:n});Object.entries(e).length?(i=l.pushAdd(d,n),Object.entries(e).forEach(function(e){var e=p(e,2),t=e[0],e=e[1];return i.set(t,e)}),o.push(i),u.addFeature(i)):(o.push(l.pushAdd(d,n)),u.addFeature(n))}();a.features.push(n)}return o},a=function(){var s=n.apply(this,arguments);return new Promise(function(r,o){return function t(e,i){try{var n=s[e](i),a=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});r(a)}("next")})},function(){return a.apply(this,arguments)}),e("../utils/cloneFeature")),h=e("../utils/evaluateExpressionFields"),v=e("../utils/getNotEditableFieldsNoPkValues");var m=g3wsdk.core.layer.features.Feature},{"../utils/cloneFeature":35,"../utils/evaluateExpressionFields":39,"../utils/getNotEditableFieldsNoPkValues":45}],55:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.isPointOnVertex=function(e){function t(e){return g3wsdk.core.geoutils.areCoordinatesEqual(n,e)}var i=e.feature,n=e.coordinates,a=i.getGeometry(),e=a.getType();switch(e){case"Polygon":case"MultiLineString":return _.flatMap(a.getCoordinates()).some(t);case"LineString":case"MultiPoint":return a.getCoordinates().some(t);case"MultiPolygon":return a.getPolygons().some(function(e){return _.flatMap(e.getCoordinates()).some(t)});case"Point":return g3wsdk.core.geoutils.areCoordinatesEqual(n,a.getCoordinates());default:return!1}}},{}],56:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.listenRelation1_1FieldChange=void 0;var n,d="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=(i.listenRelation1_1FieldChange=(n=g(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layerId,e=e.fields,l=void 0===e?[]:e,n=[],u=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing"),e=p.getLayerById(t).getRelations().getArray().filter(function(e){return"ONE"===e.getType()}),i=!0,t=!1,a=void 0;try{for(var r,o=e[Symbol.iterator]();!(i=(r=o.next()).done);i=!0){var s=yield*function*(a){var e=a.getChild(),t=a.getFatherField(),r={},o=l.find(function(e){return t.includes(e.name)});if(!o||!u.getLayerById(e))return{v:void 0};var i,s=u.getLayerById(a.getFather()).getEditingFields().filter(function(e){return e.vectorjoin_id&&e.vectorjoin_id===a.getId()}).reduce(function(e,t){var i=l.find(function(e){return e.name===t.name});return e[i.name]=i.editable,e},{});o.input.options.loading.state="loading",r[o.value]=yield(0,f.getRelation1_1ChildFeature)({relation:a,fatherFormRelationField:o}),o.input.options.loading.state=null,r[o.value].locked&&Object.keys(s).forEach(function(t){return l.find(function(e){return t===e.name}).editable=!1}),n.push(c.VM.$watch(function(){return o.value},(i=g(function*(e){if(e){if(o.editable=!1,o.input.options.loading.state="loading",void 0===r[o.value])try{r[o.value]=yield(0,f.getRelation1_1ChildFeature)({relation:a,fatherFormRelationField:o})}catch(e){}var e,i=(e=r[o.value]).feature,n=e.locked;Object.keys(s).forEach(function(t){var e=l.find(function(e){return t===e.name});e.editable=!n&&s[t],e.value=i?i.get(e.name.replace(a.getPrefix(),"")):null})}o.input.options.loading.state=null,o.editable=!0}),function(e){return i.apply(this,arguments)})))}(r.value);if("object"===(void 0===s?"undefined":d(s)))return s.v}}catch(e){t=!0,a=e}finally{try{!i&&o.return&&o.return()}finally{if(t)throw a}}return n}),function(){return n.apply(this,arguments)}),e("../eventbus")),f=e("./getRelation1_1ChildFeature");function g(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,i){try{var n=s[e](i),a=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});r(a)}("next")})}}var p=g3wsdk.core.catalog.CatalogLayersStoresRegistry},{"../eventbus":11,"./getRelation1_1ChildFeature":48}],57:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.promisify=function(i){if(i instanceof Promise)return i;return i&&i.then?new Promise(function(e,t){return i.then(e).fail(t)}):(void 0,Promise.reject("not a promise"))},i.$promisify=function(i){if(void 0===i)return $.Deferred(function(e){return e.reject("not a promise")}).promise();if(i.always)return i;return $.Deferred(function(){e=function*(t){try{t.resolve(yield i instanceof Promise?i:i())}catch(e){t.reject(e)}};var e,t=function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,i){try{var n=s[e](i),a=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});r(a)}("next")})};return function(e){return t.apply(this,arguments)}}()).promise()}},{}],58:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.setAndUnsetSelectedFeaturesStyle=function(){function e(){var t=(0,l.setFeaturesSelectedStyle)(r,a);(0,s.promisify)(i).finally(function(){r.flat().forEach(function(e){return e.setStyle(t)})})}var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=t.promise,n=t.inputs,a=t.style,t=n.layer,n=n.features,r=void 0===n?[]:n,n=u.LayerTypes.VECTOR===t.getType(),t=o.Workflow.Stack.getLength();n&&t?setTimeout(e):n&&e()};var o=e("../g3wsdk/workflow/workflow"),s=e("../utils/promisify"),l=e("../utils/setFeaturesSelectedStyle"),u=g3wsdk.core.layer.Layer},{"../g3wsdk/workflow/workflow":15,"../utils/promisify":57,"../utils/setFeaturesSelectedStyle":59}],59:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.setFeaturesSelectedStyle=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1];{var i,n,a;if(0<e.length)return e=e.flat(),i=function(e){return{originalStyle:e.getStyle(),selectedStyle:e.getGeometry()?g3wsdk.core.geoutils.createSelectedStyle({geometryType:e.getGeometry().getType()}):e.getStyle()}}(e[0]),n=i.originalStyle,a=i.selectedStyle,e.forEach(function(e){return e.setStyle(t||a)}),n}}},{}],60:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n,a;i.setLayerUniqueFieldValues=(n=function*(i){var n=g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing"),e=[],a=r.getLayerById(i);return a.getEditingFields().forEach(function(t){t.validate.unique&&void 0===(n.state.uniqueFieldsValues[i]?n.state.uniqueFieldsValues[i][t.name]:[])&&e.push(a.getFilterData({unique:t.name}).then(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];void 0===n.state.uniqueFieldsValues[i]&&(n.state.uniqueFieldsValues[i]={}),n.state.uniqueFieldsValues[i][t.name]=new Set(e)}))}),yield Promise.allSettled(e),n.state.uniqueFieldsValues[i]},a=function(){var s=n.apply(this,arguments);return new Promise(function(r,o){return function t(e,i){try{var n=s[e](i),a=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});r(a)}("next")})},function(e){return a.apply(this,arguments)});var r=g3wsdk.core.catalog.CatalogLayersStoresRegistry},{}],61:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.unlinkRelation=function(e){var a=e.layerId,r=e.relation,o=e.relations,s=e.index,e=e.dialog,i=void 0===e||e;return $.Deferred(function(n){function t(){var e=a===r.child?r.father:r.child,t=(0,c.getEditingLayerById)(e).getEditingSource().getFeatureById(o[s].id),i=t.clone();(0,u.getRelationFieldsFromRelation)({relation:r,layerId:e}).ownField.forEach(function(e){return t.set(e,null)}),l.Workflow.Stack.getCurrent().getSession().pushUpdate(e,t,i),o.splice(s,1),(0,d.updateParentWorkflows)(),n.resolve(!0)}i?f.dialog.confirm(g("editing.messages.unlink_relation"),function(e){return e?t():n.reject(!1)}):t()}).promise()};var l=e("../g3wsdk/workflow/workflow"),u=e("../utils/getRelationFieldsFromRelation"),d=e("../utils/updateParentWorkflows"),c=e("../utils/getEditingLayerById"),f=g3wsdk.gui.GUI,g=g3wsdk.core.i18n.tPlugin},{"../g3wsdk/workflow/workflow":15,"../utils/getEditingLayerById":41,"../utils/getRelationFieldsFromRelation":49,"../utils/updateParentWorkflows":62}],62:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.updateParentWorkflows=function(){(n.Workflow.Stack.getParents()||[n.Workflow.Stack.getCurrent()]).forEach(function(e){return e.getContextService()&&e.getContextService().setUpdate(!0,{force:!0})})};var n=e("../g3wsdk/workflow/workflow")},{"../g3wsdk/workflow/workflow":15}],63:[function(f,j,e){Object.defineProperty(e,"__esModule",{value:!0}),e.SelectElementsStep=e.PickFeatureStep=e.OpenTableStep=e.OpenFormStep=e.MoveFeatureStep=e.ModifyGeometryVertexStep=e.AddFeatureStep=void 0;var t=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,n=arguments[t];for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},i=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var y=f("../utils/evaluateExpressionFields"),g=f("../utils/getParentFormData"),h=f("../utils/setFeaturesSelectedStyle"),p=f("../utils/setAndUnsetSelectedFeaturesStyle"),v=f("../utils/getFormFields"),m=f("../utils/chooseFeatureFromFeatures"),_=f("../utils/handleRelation1_1LayerFields"),b=f("../utils/listenRelation1_1FieldChange"),w=f("../utils/getLayersDependencyFeatures"),D=f("../utils/getEditingLayerById"),B=f("../utils/setLayerUniqueFieldValues"),V=f("../utils/getRelationsInEditingByFeature"),U=f("../utils/getFeatureTableFieldValue"),k=f("../utils/addRemoveToMultipleSelectFeatures"),z=f("../utils/promisify"),S=f("../interactions/pickfeaturesinteraction"),F=f("../g3wsdk/workflow/workflow"),a=f("../g3wsdk/workflow/step");function s(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}function x(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function E(e){return function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,i){try{var n=s[e](i),a=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});r(a)}("next")})}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function l(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var u=g3wsdk.core,G=u.G3WObject,I=u.ApplicationState,d=g3wsdk.core.geometry.Geometry,u=g3wsdk.core.geoutils,N=u.convertSingleMultiGeometry,H=u.isSameBaseGeometryType,q=g3wsdk.core.geoutils.Geometry.removeZValueToOLFeatureGeometry,W=g3wsdk.core.layer.Layer,T=g3wsdk.core.layer.features.Feature,C=g3wsdk.gui.GUI,K=g3wsdk.gui.vue.Component,Z=g3wsdk.gui.vue.services.FormService,u=g3wsdk.ol.interactions.measure,Y=u.AreaInteraction,X=u.LengthInteraction,u=g3wsdk.ol.utils,J=u.createMeasureTooltip,Q=u.removeMeasureTooltip;e.AddFeatureStep=(l(c,a.Step),i(c,[{key:"run",value:function(i,n){var a,r,o,s=this,l=(this._stopPromise=$.Deferred(),$.Deferred()),u=i.layer.getId();return W.LayerTypes.VECTOR===i.layer.getType()&&((0,p.setAndUnsetSelectedFeaturesStyle)({promise:this._stopPromise,inputs:i,style:this.selectStyle}),a=i.layer.getEditingGeometryType(),this.geometryType=d.getOLGeometry(a),r=i.layer.getEditingLayer().getSource(),o=i.layer.getEditingFields(),this.drawInteraction=this.addInteraction(new ol.interaction.Draw({type:this.geometryType,source:new ol.source.Vector,condition:this._options.condition||function(){return!0},freehandCondition:ol.events.condition.never,finishCondition:this._options.finishCondition||function(){return!0}}),{drawstart:function(e){e=e.feature;s.drawingFeature=e,document.addEventListener("keydown",s._delKeyRemoveLastPoint)},drawend:function(t){var e=void 0;s._add?(o.forEach(function(e){return t.feature.set(e.name,null)}),(e=new T({feature:t.feature})).setTemporaryId(),r.addFeature(e),n.session.pushAdd(u,e,!1)):e=t.feature,e=d.addZValueToOLFeatureGeometry({feature:e,geometryType:a}),i.features.push(e),s.getContext().get_default_value=!0,s.fireEvent("addfeature",e),l.resolve(i)}}),this.drawInteraction.setActive(!0)),l.promise()}},{key:"addMeasureInteraction",value:function(){var e=d.isLineGeometryType(this.geometryType),t=d.isPolygonGeometryType(this.geometryType);(e||t)&&(this.measureInteraction=this.addInteraction(new(e?X:Y)({projection:C.getService("map").getProjection(),drawColor:"transparent",feature:this.drawingFeature})),this.measureInteraction.setActive(!0))}},{key:"removeMeasureInteraction",value:function(){this.measureInteraction&&(this.measureInteraction.clear(),this.removeInteraction(this.measureInteraction),this.measureInteraction=null)}},{key:"removeLastPoint",value:function(){try{this.drawInteraction&&this.drawInteraction.removeLastPoint()}catch(e){}}},{key:"stop",value:function(){return this.removeInteraction(this.drawInteraction),this.removeMeasureInteraction(),this.drawInteraction=null,this.drawingFeature=null,document.removeEventListener("keydown",this._delKeyRemoveLastPoint),this._stopPromise.resolve(!0),!0}}]),c);function c(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(r(this,c),e.help="editing.steps.help.draw_new_feature",o(this,(c.__proto__||Object.getPrototypeOf(c)).call(this,e)));return t._add=void 0===e.add||e.add,t.drawInteraction,t.measeureInteraction,t.drawingFeature,t._snap=!1!==e.snap,t._stopPromise,t._delKeyRemoveLastPoint=function(e){return 46===e.keyCode&&t.removeLastPoint()},t}e.ModifyGeometryVertexStep=(l(P,a.Step),i(P,[{key:"run",value:function(i,n){var a,r=void 0,o=$.Deferred(),s=i.layer.getId(),e=this._feature=i.features[0];return this._originalStyle=i.layer.getEditingLayer().getStyle(),e.setStyle(function(){return[new ol.style.Style({image:new ol.style.Circle({radius:5,fill:null,stroke:new ol.style.Stroke({color:"orange",width:2})}),geometry:function(e){return new ol.geom.MultiPoint((d.isPolygonGeometryType(i.layer.getGeometryType())&&d.isMultiGeometry(i.layer.getGeometryType())?e.getGeometry().getCoordinates()[0]:e.getGeometry().getCoordinates())[0])}}),new ol.style.Style({stroke:new ol.style.Stroke({color:"yellow",width:4})})]}),this._modifyInteraction=this.addInteraction(new ol.interaction.Modify({features:new ol.Collection(i.features),deleteCondition:this._options.deleteCondition}),{modifystart:function(e){r=e.features.getArray()[0].clone()},modifyend:function(e){var t=e.features.getArray()[0];t.getGeometry().getExtent()!==r.getGeometry().getExtent()&&(0,y.evaluateExpressionFields)({inputs:i,context:n,feature:t}).finally(function(){a=t.clone(),n.session.pushUpdate(s,a,r),i.features.push(a),o.resolve(i)})}}),o.promise()}},{key:"addMeasureInteraction",value:function(){var t=this;this._modifyInteraction.on("modifystart",function(e){t.tooltip=J({map:t.getMap(),feature:e.features.getArray()[0]})})}},{key:"removeMeasureInteraction",value:function(){this.tooltip&&Q(t({map:this.getMap()},this.tooltip)),this.tooltip=null}},{key:"stop",value:function(){return this._feature.setStyle(this._originalStyle),!0}}]),P);function P(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=(r(this,P),e.snap=void 0===e.snap||e.snap,e.help="editing.steps.help.edit_feature_vertex",o(this,(P.__proto__||Object.getPrototypeOf(P)).call(this,e)));return e._originalStyle=null,e._feature=null,e.tooltip,e}e.MoveFeatureStep=(l(L,a.Step),i(L,[{key:"run",value:function(o,s){var l=this;return this.promise=$.Deferred(),$.Deferred(function(i){var n=o.layer.getId(),a=null,r=(l.changeKey=null,!1);(0,p.setAndUnsetSelectedFeaturesStyle)({promise:l.promise,inputs:o,style:l.selectStyle}),l.addInteraction(new ol.interaction.Translate({features:new ol.Collection(o.features),hitTolerance:isMobile&&isMobile.any?10:0}),{translatestart:function(e){e=e.features.getArray()[0];l.changeKey=e.once("change",function(){return r=!0}),a=e.clone()},translateend:function(e){ol.Observable.unByKey(l.changeKey);var t=e.features.getArray()[0];r?(0,y.evaluateExpressionFields)({inputs:o,context:s,feature:t}).finally(function(){s.session.pushUpdate(n,t.clone(),a),i.resolve(o)}):i.resolve(o)}})}).promise()}},{key:"stop",value:function(){this.promise.resolve(),this.changeKey=null}}]),L);function L(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=(r(this,L),e.help="editing.steps.help.move",o(this,(L.__proto__||Object.getPrototypeOf(L)).call(this,e)));return e.drawInteraction=null,e.promise,e}e.OpenFormStep=(l(R,a.Step),i(R,[{key:"updateMulti",value:function(){this._multi=0<arguments.length&&void 0!==arguments[0]&&arguments[0]}},{key:"run",value:function(u,d){var t,c=this;return $.Deferred((t=E(function*(e){var t,i,n,a,r,o,s,l;c.promise=e,c._isContentChild=1<F.Workflow.Stack.getLength(),c.layerId=u.layer.getId(),C.setLoadingContent(!1),C.getService("map").disableClickMapControls(!0),(0,p.setAndUnsetSelectedFeaturesStyle)({promise:e,inputs:u,style:c.selectStyle}),!c._multi&&Array.isArray(u.features[u.features.length-1])?e.resolve():(g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").setCurrentLayout(),t=u.layer.getName(),c._features=c._multi?u.features:[u.features[u.features.length-1]],c._originalFeatures=c._features.map(function(e){return e.clone()}),c._isContentChild&&(d.fatherValue=d.fatherValue||[],(d.fatherField||[]).forEach(function(e,t){c._features[0].set(e,d.fatherValue[t]),c._originalFeatures[0].set(e,d.fatherValue[t])})),i=(0,v.getFormFields)({inputs:u,context:d,feature:c._features[0],isChild:c._isContentChild,multi:c._multi}),F.Workflow.Stack.getCurrent().setInput({key:"fields",value:i}),n=!c._multi&&u.features&&u.features[u.features.length-1],a=!c._multi&&u.layer.getId(),n&&!n.isNew()&&u.layer.getLayerEditingFormStructure()&&(yield(0,w.getLayersDependencyFeatures)(u.layer.getId(),{relations:u.layer.getRelations().getArray().filter(function(e){return u.layer.getId()===e.getFather()&&(0,D.getEditingLayerById)(e.getChild())&&"ONE"!==e.getType()}),feature:n,filterType:"fid"})),(r=C.showForm({feature:c._originalFeatures[0],title:"plugins.editing.editing_attributes",name:t,crumb:{title:t},id:"form_"+t,dataid:t,layer:u.layer,isnew:!(1<c._originalFeatures.length)&&c._originalFeatures[0].isNew(),parentData:(0,g.getParentFormData)(),fields:i,context_inputs:!c._multi&&{context:d,inputs:u},formStructure:u.layer.hasFormStructure()&&u.layer.getLayerEditingFormStructure()||void 0,modal:!0,push:c._options.push||c._isContentChild,showgoback:void 0!==c._options.showgoback?c._options.showgoback:!c._isContentChild,headerComponent:c._saveAll&&{template:'\n            <section class="editing-save-all-form">\n              <bar-loader :loading="loading"/>\n              <div\n                class = "editing-button"\n                style = "background-color: #fff; display: flex; justify-content: flex-end; width: 100%;"\n              >\n                <span\n                  class               = "save-all-icon"\n                  v-disabled          = "disabled"\n                  @click.stop.prevent = "saveAll"\n                >\n                  <i\n                    class  = "skin-color"\n                    :class = "g3wtemplate.font[\'save\']"\n                    style  = "font-size: 1.8em; padding: 5px; border-radius: 5px; cursor: pointer; box-shadow: 0 3px 5px rgba(0,0,0,0.5); margin: 5px;"\n                  ></i>\n                </span>\n              </div>\n            </section>',name:"Saveall",props:{update:{type:Boolean},valid:{type:Boolean}},data:function(){return{loading:!1,enabled:F.Workflow.Stack._workflows.slice(0,F.Workflow.Stack.getLength()-1).every(function(e){e=(e.getContext().service instanceof Z?e.getContext().service.getState():{}).valid;return e||void 0===e})}},computed:{disabled:function(){return!this.enabled||!(this.valid&&this.update)}},methods:{saveAll:(s=E(function*(){this.loading=!0,yield Promise.allSettled([].concat(x(F.Workflow.Stack._workflows)).reverse().filter(function(e){return"function"==typeof e.getLastStep()._saveAll}).map(function(r){return new Promise((i=E(function*(e,t){var i,n=r.getLastStep(),a=r.getContext().service.state.fields.filter(function(e){return!n._multi||null!==e.value});if(0!==a.length)return yield F.Workflow.Stack.getCurrent().getContextService().saveDefaultExpressionFieldsNotDependencies(),n._features.forEach(function(e){return n.getInputs().layer.setFieldsWithValues(e,a)}),i=n._features.map(function(e){return e.clone()}),n._isContentChild&&(n.getInputs().relationFeatures={newFeatures:i,originalFeatures:n._originalFeatures}),yield n.fireEvent("saveform",{newFeatures:i,originalFeatures:n._originalFeatures}),i.forEach(function(e,t){return n.getContext().session.pushUpdate(n.layerId,e,n._originalFeatures[t])}),yield(0,_.handleRelation1_1LayerFields)({layerId:n.layerId,features:i,fields:a,task:n}),n.fireEvent("savedfeature",i),n.fireEvent("savedfeature_"+n.layerId,i),n.getContext().session.save(),e()}),function(e,t){return i.apply(this,arguments)}));var i}));try{yield(0,z.promisify)(g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").service.commit({modal:!1})),F.Workflow.Stack._workflows.forEach(function(e){return e.getContext().service.setUpdate(!1,{force:!1})})}catch(e){}this.loading=!1}),function(){return s.apply(this,arguments)})}},buttons:[{id:"save",title:c._isContentChild?F.Workflow.Stack.getParent().getBackButtonLabel()||"plugins.editing.form.buttons.save_and_back":"plugins.editing.form.buttons.save",type:"save",class:"btn-success",cbk:(o=E(function*(t){var i;0===(t=c._multi?t.filter(function(e){return null!==e.value}):t).length?C.setModal(!1):(i=[],C.setLoadingContent(!0),C.disableContent(!0),yield F.Workflow.Stack.getCurrent().getContextService().saveDefaultExpressionFieldsNotDependencies(),C.setLoadingContent(!1),C.disableContent(!1),c._features.forEach(function(e){u.layer.setFieldsWithValues(e,t),i.push(e.clone())}),c._isContentChild&&(u.relationFeatures={newFeatures:i,originalFeatures:c._originalFeatures}),yield c.fireEvent("saveform",{newFeatures:i,originalFeatures:c._originalFeatures}),i.forEach(function(e,t){return d.session.pushUpdate(c.layerId,e,c._originalFeatures[t])}),yield(0,_.handleRelation1_1LayerFields)({layerId:c.layerId,features:i,fields:t,task:c}),C.setModal(!1),c.fireEvent("savedfeature",i),c.fireEvent("savedfeature_"+c.layerId,i),c._isContentChild&&F.Workflow.Stack.getParents().forEach(function(e){return e.getContextService().setUpdate(!0,{force:!0})})),e.resolve(u)}),function(e){return o.apply(this,arguments)})},{id:"cancel",title:"plugins.editing.form.buttons.cancel",type:"cancel",class:"btn-danger",eventButtons:{update:{false:{id:"close",title:"close",type:"cancel",class:"btn-danger"}}},cbk:function(){c._isContentChild||(C.setModal(!1),c.fireEvent("cancelform",u.features)),e.reject(u)}}]})).handleRelation=(l=E(function*(e){c._multi?C.showUserMessage({type:"info",message:"plugins.editing.errors.editing_multiple_relations",duration:3e3,autoclose:!0}):(C.setLoadingContent(!0),yield(0,B.setLayerUniqueFieldValues)(u.layer.getRelationById(e.relation.name).getChild()),r.setCurrentComponentById(e.relation.name),C.setLoadingContent(!1))}),function(e){return l.apply(this,arguments)}),r.addComponents([].concat(x(g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").state.formComponents[a]||[]),x((0,V.getRelationsInEditingByFeature)({layerId:a,relations:c._multi?[]:u.layer.getRelations().getArray().filter(function(e){return"ONE"!==e.getType()&&e.getFather()===a}),feature:!c._multi&&u.features[u.features.length-1]}).map(function(e){var t=e.relation,i=e.relations;return{title:"plugins.editing.edit_relation",name:t.name,id:t.id,header:!1,component:Vue.extend({mixins:[f("../components/FormRelation.vue")],name:"relation_"+Date.now(),data:function(){return{layerId:a,relation:t,relations:i}}})}})))),c.fireEvent("openform",{layerId:c.layerId,session:d.session,feature:c._originalFeature,formService:r}),F.Workflow.Stack.getCurrent()&&F.Workflow.Stack.getCurrent().setContextService(r),(0,b.listenRelation1_1FieldChange)({layerId:c.layerId,fields:i}).then(function(e){return c._unwatchs=e}),c.disableSidebar(!0))}),function(e){return t.apply(this,arguments)})).promise()}},{key:"stop",value:function(){this.disableSidebar(!1);var e=!1===this._isContentChild||2===F.Workflow.Stack.getLength()&&F.Workflow.Stack.getParent().isType("edittable"),e=(e&&C.getService("map").disableClickMapControls(!1),e&&F.Workflow.Stack.getCurrent().getContextService());e&&!1===this._isContentChild&&e.setUpdate(!1,{force:!1}),C.closeForm({pop:this.push||this._isContentChild}),g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").resetCurrentLayout(),this.fireEvent("closeform"),this.fireEvent("closeform_"+this.layerId),this.layerId=null,this.promise=null,this._unwatchs.forEach(function(e){return e()}),this._unwatchs=[]}}]),R);function R(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(r(this,R),e.help="editing.steps.help.insert_attributes_feature",o(this,(R.__proto__||Object.getPrototypeOf(R)).call(this,e)));return t._saveAll=!1===e.saveAll?e.saveAll:E(function*(){}),t._multi=e.multi||!1,t.layerId,t._isContentChild=!1,t._features,t._originalFeatures,t.promise,t._unwatchs=[],t}e.OpenTableStep=(l(O,a.Step),i(O,[{key:"run",value:function(n,a){g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").setCurrentLayout();var e=$.Deferred(),t=(this._isContentChild=1<F.Workflow.Stack.getLength(),n.layer.readEditingFeatures()||[]),r=(n.layer.getEditingFields()||[]).filter(function(e){return!t.length||Object.keys(t[0].getProperties()).includes(e.name)}),i=(this._isContentChild=1<F.Workflow.Stack.getLength(),this._isContentChild&&a.excludeFields||[]),o=Object.assign(new G,{state:{inputs:n,context:a,promise:e,headers:r,features:t,rows:0<t.length?(0<i.length?t.filter(function(n){return!i.reduce(function(e,t,i){return e&&a.fatherValue[i]===""+n.get(t)},!0)}):t).map(function(i){return r.map(function(e){return e.name}).reduce(function(e,t){return Object.assign(e,(s(e={},t,(0,U.getFeatureTableFieldValue)({layerId:n.layer.getId(),feature:i,property:t})),s(e,"__gis3w_feature_uid",i.getUid()),e))},{})}):t,title:""+n.layer.getName()||"Link relation",isrelation:this._isContentChild,capabilities:n.layer.getEditingCapabilities(),layerId:n.layer.getId(),workflow:null}});return C.showContent({content:new K({title:""+n.layer.getName(),push:this._isContentChild,service:o,state:o.state,internalComponent:new(Vue.extend(f("../components/Table.vue")))({service:o})}),push:this._isContentChild,showgoback:!1,closable:!1}),e.promise()}},{key:"stop",value:function(){this.disableSidebar(!1),C[this._isContentChild?"popContent":"closeContent"](),g3wsdk.core.plugin.PluginsRegistry.getPlugin("editing").resetCurrentLayout()}}]),O);function O(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return r(this,O),e.help="editing.steps.help.edit_table",o(this,(O.__proto__||Object.getPrototypeOf(O)).call(this,e))}e.PickFeatureStep=(l(M,a.Step),i(M,[{key:"run",value:function(i){var n=this;return $.Deferred(function(t){n.addInteraction(new S.PickFeaturesInteraction({layer:i.layer.getEditingLayer()}),{picked:function(e){0===i.features.length&&(i.features=e.features,i.coordinate=e.coordinate),(0,p.setAndUnsetSelectedFeaturesStyle)({promise:t,inputs:i,style:n.selectStyle}),n._steps&&n.setUserMessageStepDone("select"),t.resolve(i)}})})}}]),M);function M(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return r(this,M),e.help="editing.steps.help.pick_feature",e.highlight=e.highlight||!1,e.multi=e.multi||!1,o(this,(M.__proto__||Object.getPrototypeOf(M)).call(this,e))}e.SelectElementsStep=(l(A,a.Step),i(A,[{key:"run",value:function(u,d){var c=this,f=u.layer,g=this._options.type||"bbox",p="multiple"===g&&!!this._steps.select.buttonnext;return $.Deferred(function(e){var t,i,a,r,o,s,l=e,n=(p&&(t=c._steps.select.buttonnext.done,c._steps.select.buttonnext.done=function(){t&&t instanceof Function&&t(),l.resolve(u)}),{});["single","multiple"].includes(g)&&(n.single=new S.PickFeaturesInteraction({layer:f.getEditingLayer()}),n.single.on("picked",(i=E(function*(e){var e=e.features,t=void 0;if(1<e.length)try{t=yield(0,m.chooseFeatureFromFeatures)({features:e,inputs:c.getInputs()})}catch(e){}else t=e[0];t&&(u.features=[t],p?(0,k.addRemoveToMultipleSelectFeatures)([t],u,c.multipleselectfeatures,c):(c._originalStyle=(0,h.setFeaturesSelectedStyle)(u.features),c._steps&&c.setUserMessageStepDone("select"),l.resolve(u)))}),function(e){return i.apply(this,arguments)}))),["multiple","bbox"].includes(g)&&I.ismobile&&(c._vectorLayer=new ol.layer.Vector({source:new ol.source.Vector({})}),c.getMap().addLayer(c._vectorLayer),n.multi=new ol.interaction.Draw({type:"Circle",source:c._vectorLayer.getSource(),geometryFunction:ol.interaction.Draw.createBox()}),n.multi.on("drawend",function(e){e=f.getEditingLayer().getSource().getFeaturesInExtent(e.feature.getGeometry().getExtent());p?(0,k.addRemoveToMultipleSelectFeatures)(e,u,c.multipleselectfeatures,c):0<e.length?(u.features=e,c._originalStyle=(0,h.setFeaturesSelectedStyle)(e),c._steps&&c.setUserMessageStepDone("select"),setTimeout(function(){return l.resolve(u)},500)):l.reject()})),["multiple","bbox"].includes(g)&&!I.ismobile&&(n.dragbox=new ol.interaction.DragBox({condition:ol.events.condition.shiftKeyOnly}),n.dragbox.on("boxend",function(){var t=[],e=n.dragbox.getGeometry().getExtent();f.getEditingLayer().getSource().forEachFeatureIntersectingExtent(e,function(e){t.push(e)}),p?(0,k.addRemoveToMultipleSelectFeatures)(t,u,c.multipleselectfeatures,c):0<t.length?(u.features=t,c._originalStyle=(0,h.setFeaturesSelectedStyle)(t),c._steps&&c.setUserMessageStepDone("select"),l.resolve(u)):l.reject()})),"external"===g&&(a=f.getGeometryType(),r=f.getId(),o=f.getEditingLayer().getSource(),s=c.getContext().session,n.external=new S.PickFeaturesInteraction({layers:C.getService("map").getExternalLayers().filter(function(e){e="VECTOR"==e.getType()&&e.getSource().getFeatures();return!(0<e.length)||H(e[0].getGeometry().getType(),a)})}),n.external.on("picked",function(t){var e,i,n;0<t.features.length?(e=f.getEditingFields(),i=t.features[0].getGeometry(),a!==i.getType()&&t.feature.setGeometry(N(i,a)),n=new T({feature:t.feature,properties:e.map(function(e){return!e.pk&&"media"!==e.input.type&&void 0!==t.feature.get(e.name)||t.feature.set(e.name,null),e.name})}),(0,y.evaluateExpressionFields)({inputs:u,context:d,feature:n}).finally(function(){q({feature:n}),n.setTemporaryId(),o.addFeature(n),s.pushAdd(r,n,!1),u.features.push(n),l.resolve(u)})):l.reject()})),Object.values(n).forEach(function(e){return c.addInteraction(e)}),(e=c._selectInteractions).push.apply(e,x(Object.values(n)))}).promise()}},{key:"stop",value:function(){var t=this;this._selectInteractions.forEach(function(e){return t.removeInteraction(e)}),this._vectorLayer&&this.getMap().removeLayer(this._vectorLayer),this.getInputs().features.forEach(function(e){return e.setStyle(t._originalStyle)}),this._originalStyle=null,this._vectorLayer=null,this._selectInteractions=[],this.multipleselectfeatures=[]}}]),A);function A(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],i=(r(this,A),e.help=e.help||"editing.steps.help.select_elements",o(this,(A.__proto__||Object.getPrototypeOf(A)).call(this,e)));return i._selectInteractions=[],i.multipleselectfeatures=[],i._originalStyle,i._vectorLayer,t&&i.on("run",function(){i.emit("next-step",g3wsdk.core.i18n.tPlugin("editing.steps.help.select_elements"))}),i}},{"../components/FormRelation.vue":6,"../components/Table.vue":7,"../g3wsdk/workflow/step":14,"../g3wsdk/workflow/workflow":15,"../interactions/pickfeaturesinteraction":26,"../utils/addRemoveToMultipleSelectFeatures":29,"../utils/chooseFeatureFromFeatures":34,"../utils/evaluateExpressionFields":39,"../utils/getEditingLayerById":41,"../utils/getFeatureTableFieldValue":42,"../utils/getFormFields":43,"../utils/getLayersDependencyFeatures":44,"../utils/getParentFormData":46,"../utils/getRelationsInEditingByFeature":52,"../utils/handleRelation1_1LayerFields":53,"../utils/listenRelation1_1FieldChange":56,"../utils/promisify":57,"../utils/setAndUnsetSelectedFeaturesStyle":58,"../utils/setFeaturesSelectedStyle":59,"../utils/setLayerUniqueFieldValues":60}],64:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.promisify=function(i){if(i instanceof Promise)return i;return i&&i.then?new Promise(function(e,t){i.then(e).fail(t)}):(void 0,Promise.reject("not a promise"))},i.$promisify=function(i){if(void 0===i)return $.Deferred(function(e){return e.reject("not a promise")}).promise();if(i.always)return i;return $.Deferred(function(){e=function*(t){try{t.resolve(yield i instanceof Promise?i:i())}catch(e){t.reject(e)}};var e,t=function(){var s=e.apply(this,arguments);return new Promise(function(r,o){return function t(e,i){try{var n=s[e](i),a=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(a).then(function(e){t("next",e)},function(e){t("throw",e)});r(a)}("next")})};return function(e){return t.apply(this,arguments)}}()).promise()}},{}]},{},[25]);
//# sourceMappingURL=../g3w-client/src/plugins/editing/plugin.js.map
