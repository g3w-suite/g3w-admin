!function(){var e=window&&window.initConfig&&window.initConfig.group&&window.initConfig.group.plugins;e&&(e.editing=Object.assign(e.editing||{},{version:"3.8.0-alpha.1",hash:"f91d0ff",branch:"fix_vector_relations"}))}(),function n(r,a,o){function s(t,e){if(!a[t]){if(!r[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(l)return l(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}i=a[t]={exports:{}},r[t][0].call(i.exports,function(e){return s(r[t][1][e]||e)},i,i.exports,n,r,a,o)}return a[t].exports}for(var l="function"==typeof require&&require,e=0;e<o.length;e++)s(o[e]);return s}({1:[function(e,t,i){var n=i.cache={};function r(){}i.insert=function(e){if(n[e])return r;n[e]=!0;var t=document.createElement("style");return t.setAttribute("type","text/css"),"textContent"in t?t.textContent=e:t.styleSheet.cssText=e,document.getElementsByTagName("head")[0].appendChild(t),function(){document.getElementsByTagName("head")[0].removeChild(t),n[e]=!1}}},{}],2:[function(e,t,i){e("vueify/lib/insert-css").insert(".choose-and-zoom-to-feature[data-v-3c5d6465]{display:flex;flex-direction:column;justify-content:space-between}#editing-layers-choose-feature .editing-choose-feature-radio-input[data-v-3c5d6465]{align-items:center;padding:5px;position:relative;display:flex;justify-content:space-between;border-bottom:1px solid #eee}");Object.defineProperty(i,"__esModule",{value:!0}),n=g3wsdk.gui.GUI,i.default={name:"choosefeature",data:function(){return{feature:this.$options.feature}},methods:{selectFeature:function(e){this.feature.splice(0),this.feature.push(e)},getAttributesFeature:function(e){var i=e.getProperties();return this.$options.attributes.map(function(e){var t=e.label,e=e.name;return{attribute:t,value:i[e]}})},zoomToFeature:function(e){n.getService("map").zoomToFeatures([e],{highlight:!0,duration:1e3})}},mounted:function(){n.closeContent()}},t.exports.__esModule&&(t.exports=t.exports.default);var n,e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var i=this,e=i.$createElement,n=i._self._c||e;return n("div",{attrs:{id:"editing-layers-choose-feature"}},i._l(i.$options.features,function(t,e){return n("div",{staticClass:"editing-choose-feature-radio-input"},[n("section",{staticClass:"choose-and-zoom-to-feature"},[n("div",[n("input",{staticClass:"magic-radio",attrs:{id:"choose_feature_"+e,name:"radio",type:"radio"},on:{click:function(e){return e.stopPropagation(),i.selectFeature(t)}}}),i._v(" "),n("label",{staticStyle:{color:"transparent"},attrs:{for:"choose_feature_"+e}},[i._v("id\n        ")])]),i._v(" "),n("div",{staticClass:"skin-color",class:i.g3wtemplate.font.marker,staticStyle:{"padding-left":"3px","font-size":"1.3em",cursor:"pointer","margin-top":"10px"},on:{click:function(e){return e.stopPropagation(),i.zoomToFeature(t)}}})]),i._v(" "),n("section",{staticStyle:{"overflow-x":"auto",display:"flex"}},i._l(i.getAttributesFeature(t),function(e){var t=e.attribute,e=e.value;return n("div",{staticStyle:{display:"flex","flex-direction":"column","justify-content":"space-between",padding:"5px"}},[n("span",{staticStyle:{"font-weight":"bold","margin-bottom":"10px"}},[i._v(i._s(t))]),i._v(" "),n("span",{staticStyle:{"align-self":"start","white-space":"nowrap"}},[i._v(i._s(e))])])}),0)])}),0)},e.staticRenderFns=[],e._scopeId="data-v-3c5d6465"},{"vueify/lib/insert-css":1}],3:[function(e,t,i){e("vueify/lib/insert-css").insert(".g3w-editing-other-layers-features[data-v-0a61c6b7]{overflow:auto}");Object.defineProperty(i,"__esModule",{value:!0}),r=g3wsdk.constant.G3W_FID,n=g3wsdk.gui.GUI,a=g3wsdk.core.geoutils.getAlphanumericPropertiesFromFeature,o=g3wsdk.core.map.MapLayersStoreRegistry,e=g3wsdk.gui.vue.Mixins.resizeMixin,i.default={name:"Copyfeaturesfromotherlayers",mixins:[e],data:function(){return{selectedFeatures:this.$options.selectedFeatures,disabled:!0,_height:0}},computed:{showEditAttributes:function(){return 1<Object.values(this.$options.layers).reduce(function(e,t){t=t.features;return e+=t.length},0)}},methods:{resize:function(){var e=this;this.$nextTick(function(){return e.$data._height=window.innerHeight-200})},getAttributesFeature:function(e,t){var t=this.$options.layers[t],i=t.external,n=t.fields;return a(e.getProperties()).filter(function(e){return e!==r}).map(function(t){return{attribute:i?t:n.find(function(e){return e.name===t}).label,value:e.get(t)}})},selectFeature:function(t){this.selectedFeatures.find(function(e){return e===t})?this.selectedFeatures=this.selectedFeatures.filter(function(e){return e!==t}):this.selectedFeatures.push(t),this.disabled=this.selectedFeatures.length<2,this.$options.editAttributes.state=!this.disabled&&this.$options.editAttributes.state},getLayerTitle:function(e){var t=o.getLayerById(e);return t?t.getTitle():n.getService("map").getLayerById(e).get("name")},zoomToFeature:function(e){n.getService("map").zoomToFeatures([e],{highlight:!0,duration:1e3})}},beforeCreate:function(){this.delayType="debounce"},mounted:function(){n.closeContent()}},t.exports.__esModule&&(t.exports=t.exports.default);var r,n,a,o,i="function"==typeof t.exports?t.exports.options:t.exports;i.render=function(){var r=this,e=r.$createElement,n=r._self._c||e;return n("div",{staticClass:"editing-layers-features"},[r.showEditAttributes?n("div",{directives:[{name:"disabled",rawName:"v-disabled",value:r.disabled,expression:"disabled"}],staticStyle:{display:"flex","justify-content":"flex-end"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:r.$options.editAttributes.state,expression:"$options.editAttributes.state"}],staticClass:"magic-checkbox",attrs:{id:"g3w_edit_attributes_of_select_feature_from_layer",type:"checkbox"},domProps:{checked:Array.isArray(r.$options.editAttributes.state)?-1<r._i(r.$options.editAttributes.state,null):r.$options.editAttributes.state},on:{change:function(e){var t,i=r.$options.editAttributes.state,e=e.target,n=!!e.checked;Array.isArray(i)?(t=r._i(i,null),e.checked?t<0&&r.$set(r.$options.editAttributes,"state",i.concat([null])):-1<t&&r.$set(r.$options.editAttributes,"state",i.slice(0,t).concat(i.slice(t+1)))):r.$set(r.$options.editAttributes,"state",n)}}}),r._v(" "),n("label",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.modal.tools.copyfeaturefromotherlayer.edit_attributes",expression:"'editing.modal.tools.copyfeaturefromotherlayer.edit_attributes'"}],staticStyle:{color:"#000000"},attrs:{for:"g3w_edit_attributes_of_select_feature_from_layer"}})]):r._e(),r._v(" "),n("section",{staticClass:"g3w-editing-other-layers-features",style:{height:r.$data._height+"px"}},r._l(Object.keys(r.$options.layers),function(i){return n("div",[n("div",{staticClass:"skin-color",staticStyle:{"font-weight":"bold","font-size":"1.2em"}},[r._v(r._s(r.getLayerTitle(i)))]),r._v(" "),n("divider"),r._v(" "),n("div",{staticClass:"copy-features-for-layer-content",staticStyle:{"overflow-x":"auto"}},r._l(r.$options.layers[i].features,function(t,e){return n("div",{staticStyle:{padding:"5px",position:"relative",display:"flex","align-items":"baseline","border-bottom":"1px solid #eee"}},[n("div",{staticStyle:{display:"flex","flex-direction":"column","border-right":"1px solid #eee"}},[n("div",{staticClass:"skin-color",class:r.g3wtemplate.font.marker,staticStyle:{padding:"0 5px 15px 5px","font-size":"1.1em",cursor:"pointer","margin-right":"5px"},on:{click:function(e){return e.stopPropagation(),r.zoomToFeature(t)}}}),r._v(" "),n("div",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:"plugins.editing.steps.help.select_elements",expression:"'plugins.editing.steps.help.select_elements'",arg:"right",modifiers:{create:!0}}]},[n("input",{staticClass:"magic-checkbox",attrs:{id:i+"_"+e+"_select_feature_from_layer",type:"checkbox"},on:{click:function(e){return e.stopPropagation(),r.selectFeature(t)}}}),r._v(" "),n("label",{staticStyle:{color:"#FFF"},attrs:{for:i+"_"+e+"_select_feature_from_layer"}},[r._v(" "+r._s(t.getId()||0)+"\n                  ")])])]),r._v(" "),r._l(r.getAttributesFeature(t,i),function(e){var t=e.attribute,e=e.value;return n("div",{staticStyle:{display:"flex","flex-direction":"column",padding:"10px"}},[n("span",{staticStyle:{"font-weight":"bold","margin-bottom":"10px"}},[r._v(r._s(t))]),r._v(" "),n("span",{staticStyle:{"align-self":"start"}},[r._v(r._s(e))])])})],2)}),0)],1)}),0)])},i.staticRenderFns=[],i._scopeId="data-v-0a61c6b7"},{"vueify/lib/insert-css":1}],4:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),n=g3wsdk.constant.G3W_FID,r=g3wsdk.gui.GUI,a=g3wsdk.core.geoutils.getAlphanumericPropertiesFromFeature,o=g3wsdk.core.map.MapLayersStoreRegistry,i.default={name:"Copyfeaturesfromotherlayers",data:function(){return{features:this.$options.features,selectfeature:null,selectedFeatures:this.$options.selectedFeatures}},methods:{getAttributesFeature:function(e){var i=this.$options.fields;return a(e.getProperties()).filter(function(e){return e!==n}).map(function(t){return{attribute:i?i.find(function(e){return e.name===t}).label:t,value:e.get(t)}})},getLayerTitle:function(e){return o.getLayerById(e).getTitle()},zoomToFeature:function(e){r.getService("map").zoomToFeatures([e],{highlight:!0,duration:1e3})}},watch:{selectfeature:function(e){this.selectedFeatures.splice(0,1,e)}}},t.exports.__esModule&&(t.exports=t.exports.default);var n,r,a,o,i="function"==typeof t.exports?t.exports.options:t.exports;i.render=function(){var i=this,e=i.$createElement,n=i._self._c||e;return n("div",{staticClass:"editing-layers-features"},[n("div",{staticClass:"copy-features-for-layer-content",staticStyle:{"overflow-x":"auto"}},i._l(i.features,function(t,e){return n("div",{staticStyle:{padding:"5px",position:"relative",display:"flex","align-items":"baseline","border-bottom":"1px solid #eee"}},[n("div",{staticStyle:{display:"flex","flex-direction":"column","border-right":"1px solid #eee"}},[n("div",{staticClass:"skin-color",class:i.g3wtemplate.font.marker,staticStyle:{padding:"0 5px 15px 5px","font-size":"1.1em",cursor:"pointer","margin-right":"5px"},on:{click:function(e){return e.stopPropagation(),i.zoomToFeature(t)}}}),i._v(" "),n("div",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:"plugins.editing.steps.help.select_elements",expression:"'plugins.editing.steps.help.select_elements'",arg:"right",modifiers:{create:!0}}]},[n("input",{directives:[{name:"model",rawName:"v-model",value:i.selectfeature,expression:"selectfeature"}],staticClass:"magic-radio",attrs:{id:i.layerId+"_"+e+"_select_feature_from_layer",name:"radio",type:"radio"},domProps:{value:t,checked:i._q(i.selectfeature,t)},on:{change:function(e){i.selectfeature=t}}}),i._v(" "),n("label",{staticStyle:{color:"#FFF"},attrs:{for:i.layerId+"_"+e+"_select_feature_from_layer"}},[i._v(i._s(e))])])]),i._v(" "),i._l(i.getAttributesFeature(t),function(e){var t=e.attribute,e=e.value;return n("div",{staticStyle:{display:"flex","flex-direction":"column",padding:"10px"}},[n("span",{staticStyle:{"font-weight":"bold","margin-bottom":"10px"}},[i._v(i._s(t))]),i._v(" "),n("span",{staticStyle:{"align-self":"start"}},[i._v(i._s(e))])])})],2)}),0)])},i.staticRenderFns=[]},{}],5:[function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function r(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}Object.defineProperty(i,"__esModule",{value:!0}),a=n(e("./Toolbox.vue")),e=n(e("./SelectEditingLayers.vue")),l=g3wsdk.gui.GUI,u=g3wsdk.core.ApplicationState,i.default={name:"Editing",data:function(){return{saving:!1,layersInEditing:0}},components:{toolbox:a.default,selectlayers:e.default},transitions:{addremovetransition:"showhide"},methods:{updateLayersInEditing:function(e){this.layersInEditing+=e?1:-1},undo:function(){this.$options.service.undo()},redo:function(){this.$options.service.redo()},commit:function(e){var t=this;this.saving=!0,this.$options.service.commit({toolbox:this.$options.service.getToolBoxById(e),modal:!1}).always(function(){return t.saving=!1})},saveAll:function(){},startToolBox:(s=r(function*(e){var t=this,e=this._getToolBoxById(e);if(u.online&&e.canEdit()){var i=e.getDependencies().find(function(e){return t._getToolBoxById(e).isDirty()});if(i)try{yield this.$options.service.commitDirtyToolBoxes(i)}catch(e){}e.start()}}),function(e){return s.apply(this,arguments)}),stopToolBox:function(e){var t=this._getToolBoxById(e);t.state.editing.history.commit?this.$options.service.commit().always(function(){return t.stop()}):t.stop()},saveToolBox:function(e){this._getToolBoxById(e).save()},_setActiveToolOfToolbooxSelected:function(e,t){var i=this._getToolBoxById(t);this.state.toolboxidactivetool=t,i.setActiveTool(i.getToolById(e))},startActiveTool:function(t,i){var n=this;this.state.toolboxidactivetool&&i!==this.state.toolboxidactivetool?this._checkDirtyToolBoxes(this.state.toolboxidactivetool).then(function(e){e&&e.stopActiveTool(),n._setActiveToolOfToolbooxSelected(t,i)}):this._setActiveToolOfToolbooxSelected(t,i)},stopActiveTool:function(e){this._getToolBoxById(e).stopActiveTool()},setSelectedToolbox:(o=r(function*(e){var e=this._getToolBoxById(e),t=this.$options.service.getToolBoxes().find(function(e){return e.isSelected()});t&&(t.setSelected(!1),t.clearMessage()),e.setSelected(!0),this.state.toolboxselected=e}),function(e){return o.apply(this,arguments)}),_checkDirtyToolBoxes:function(e){return this.$options.service.commitDirtyToolBoxes(e)},_getToolBoxById:function(e){return this.$options.service.getToolBoxById(e)},_enableEditingButtons:function(e){this.editingButtonsEnabled=!e}},computed:{message:function(){return""},canCommit:function(){return"default"===this.$options.service.getSaveConfig().mode&&this.state.toolboxselected&&this.state.toolboxselected.state.editing.history.commit&&this.editingButtonsEnabled},canUndo:function(){var e=this.state.toolboxselected&&this.state.toolboxselected.state.editing.history.undo&&this.editingButtonsEnabled;return this.$options.service.fireEvent("canUndo",e),e},canRedo:function(){var e=this.state.toolboxselected&&this.state.toolboxselected.state.editing.history.redo&&this.editingButtonsEnabled;return this.$options.service.fireEvent("canRedo",e),e}},watch:{canCommit:function(e){this.$options.service.registerLeavePage(e)},layersInEditing:function(e){document.getElementsByClassName("close-pane-button")[0].classList[0===e?"remove":"add"]("g3w-disabled")}},created:function(){this.appState=u,this.$options.service.registerOnLineOffLineEvent(),l.closeContent(),this.$options.service.setOpenEditingPanel(!0),l.on("opencontent",this._enableEditingButtons),l.on("closeform",this._enableEditingButtons),l.on("closecontent",this._enableEditingButtons)},beforeDestroy:function(){this.$options.service.setOpenEditingPanel(!1),l.off("opencontent",this._enableEditingButtons),l.off("closeform",this._enableEditingButtons),l.off("closecontent",this._enableEditingButtons),this.$options.service.unregisterOnLineOffLineEvent(),this.$options.service.fireEvent("closeeditingpanel"),this.$options.service.onCloseEditingPanel(),this.$options.service.clearAllLayersUniqueFieldsValues()}},t.exports.__esModule&&(t.exports=t.exports.default);var a,o,s,l,u,i="function"==typeof t.exports?t.exports.options:t.exports;i.render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"g3w-editing-panel"},[i("bar-loader",{attrs:{loading:t.saving}}),t._v(" "),0<t.layersInEditing?i("helpdiv",{staticStyle:{"font-weight":"bold"},attrs:{message:"plugins.editing.close_editing_panel.message"}}):t._e(),t._v(" "),t.appState.online?t._e():i("div",{staticStyle:{"margin-bottom":"5px",padding:"5px","border-radius":"3px","background-color":"orange",color:"white","font-weight":"bold"},attrs:{id:"onlineofflinemessage"}},[i("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.messages.offline",expression:"'editing.messages.offline'"}]})]),t._v(" "),t.showcommitbar?i("div",{directives:[{name:"disabled",rawName:"v-disabled",value:t.saving,expression:"saving"}],staticStyle:{display:"flex","justify-content":"flex-end","margin-bottom":"5px"}},[i("div",{staticClass:"editing-button",class:{enabled:t.canCommit},staticStyle:{"margin-right":"auto"},on:{click:function(e){e.stopPropagation(),t.canCommit&&t.commit()}}},[i("span",{staticClass:"editing-icon",class:t.g3wtemplate.font.save})]),t._v(" "),i("div",{staticClass:"editing-button",class:{enabled:t.canUndo},on:{click:function(e){e.stopPropagation(),t.canUndo&&t.undo()}}},[i("span",{staticClass:"editing-icon",class:t.g3wtemplate.font["arrow-left"]})]),t._v(" "),i("div",{staticClass:"editing-button",class:{enabled:t.canRedo},on:{click:function(e){e.stopPropagation(),t.canRedo&&t.redo()}}},[i("span",{staticClass:"editing-icon",class:t.g3wtemplate.font["arrow-right"]})])]):i("div",{staticStyle:{height:"10px"}}),t._v(" "),t.state.showselectlayers&&1<t.state.toolboxes.length?i("selectlayers"):t._e(),t._v(" "),i("div",{attrs:{id:"toolboxes"}},t._l(t.state.toolboxes,function(e){return i("toolbox",{key:e.id,attrs:{state:e,resourcesurl:t.resourcesurl},on:{setselectedtoolbox:t.setSelectedToolbox,starttoolbox:t.startToolBox,stoptoolbox:t.stopToolBox,savetoolbox:t.saveToolBox,setactivetool:t.startActiveTool,stopactivetool:t.stopActiveTool,"on-editing":t.updateLayersInEditing}})}),1)],1)},i.staticRenderFns=[]},{"./SelectEditingLayers.vue":7,"./Toolbox.vue":10}],6:[function(n,e,t){var i,r,a,o,s,l,u,d,c,f,p,h,g;n("vueify/lib/insert-css").insert(".g3w-editing-new-relation-vector-type[data-v-112912af]{margin-bottom:5px;font-weight:700}.relation_header_title[data-v-112912af]{font-weight:700;font-size:1.3em;align-items:center}.relation_header_title[data-v-112912af],.relation_header_tools[data-v-112912af]{width:100%;display:flex;background-color:#fff}.g3w-editing-relations-add-link-tools[data-v-112912af]{display:flex;justify-content:flex-end}.relation_vector_tools[data-v-112912af]{display:flex;flex-direction:column;border:2px solid #eee;background-color:#fff;padding:10px}#g3w-select-editable-layers-content[data-v-112912af]{flex-grow:1;display:flex;flex-direction:column}#search-box[data-v-112912af]{margin-right:auto}.relation_body[data-v-112912af]{padding:0}.g3wform-relation-table[data-v-112912af]{width:100%}.close_vector_relation_tool[data-v-112912af]{align-self:self-end}.close_vector_relation_tool>.g3w-icon[data-v-112912af]{font-weight:700;cursor:pointer}.divider[data-v-112912af]{display:block;position:relative;padding:0;margin-bottom:5px;height:0;width:100%;max-height:0;font-size:1px;line-height:0;clear:both;border:none;border-bottom:2px solid #eee}");function y(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function v(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}Object.defineProperty(t,"__esModule",{value:!0}),l=g3wsdk.core.i18n.tPlugin,u=g3wsdk.core.utils.toRawType,d=g3wsdk.core.layer.Layer,c=g3wsdk.gui.GUI,f=g3wsdk.gui.vue.Mixins,p=f.fieldsMixin,h=f.resizeMixin,f=f.mediaMixin,g=n("../services/relationservice"),t.default={mixins:[f,p,h],name:"g3w-relation",data:function(){return{loading:!1,show_vector_tools:!1,disabled:!1,copylayerid:null,copyFeatureLayers:[],active:!1,value:null,placeholdersearch:l("editing.search")+" ..."}},methods:{resize:function(){var e;this.active&&"none"!==this.$el.style.display&&((e=this.$refs.relation_body.querySelector("div.dataTables_scrollBody"))&&(e.style.height=((document.querySelector(".g3wform_body")||{}).offsetHeight||0)-((document.querySelector(".g3wform_footer")||{}).offsetHeight||0)-((this.$refs.relation_header_title||{}).offsetHeight||0)-((this.$refs.relation_header_tools||{}).offsetHeight||0)-((this.$el.querySelector(".dataTables_scrollHead")||{}).offsetHeight||0)-((this.$el.querySelector(".dataTables_paginate.paging_simple_numbers")||{}).offsetHeight||0)-((document.querySelector(".editing-save-all-form")||{}).offsetHeight||0)-((this.isVectorRelation&&this.show_vector_tools&&this.$refs.relation_vector_tools||{}).offsetHeight||0)+"px"),this.relationsTable)&&this.relationsTable.columns.adjust()},copyFeatureFromOtherLayer:function(){var t=this,e=n("../services/editingservice"),i=this.copyFeatureLayers.find(function(e){return e.id===t.copylayerid});this._service.addRelationFromOtherLayer({layer:i.external?e.getMapService().getLayerById(this.copylayerid):e.getProjectLayerById(this.copylayerid),external:i.external})},closeVectorTools:(s=v(function*(){this.show_vector_tools=!1,yield this.$nextTick(),this.resize()}),function(){return s.apply(this,arguments)}),addVectorRelation:function(){this._service.addRelation(),this.show_vector_tools=!1},linkRelation:(o=v(function*(){this.disabled=!0,yield this._service.linkRelation(),this.disabled=!1}),function(){return o.apply(this,arguments)}),addRelationAndLink:(a=v(function*(){this.isVectorRelation?(this.show_vector_tools=!this.show_vector_tools,yield this.$nextTick(),this.resize()):this._service.addRelation()}),function(){return a.apply(this,arguments)}),startTool:function(e,t){this._service.startTool(e,t).then(function(){}).catch(console.warn)},relationAttributesSubset:function(e){return e.fields.map(function(e){var t=e.label;return{name:e.name,label:t,value:e.value}}).flatMap(function(e){var t=e.name,i=e.label,e=e.value;return Array.isArray(e)?[]:[{name:t,label:i,value:e}]})},getValue:function(e){return e&&"Object"===u(e)?e=e.value:"string"==typeof e&&0===e.indexOf("_new_")&&(e=null),this.value=e},_createDataTable:function(){var e=this;this.relationsTable=$(this.$refs.relationTable).DataTable({scrollX:!0,order:[2,"asc"],destroy:!0,scrollResize:!0,scrollCollapse:!0,responsive:!0,pageLength:10,columnDefs:[{orderable:!1,targets:[0,1]}],autoWidth:!1}),$(".dataTables_filter, .dataTables_length").hide(),$("#filterRelation").on("keyup",function(){e.relationsTable.search($(e).val()).draw()})},destroyTable:function(){this.relationsTable&&(this.relationsTable=this.relationsTable.destroy(),this.relationsTable=null,$("#filterRelation").off())},updateTable:(r=v(function*(){var e=this;this.destroyTable(),yield this.$nextTick(),this._createDataTable(),setTimeout(function(){return e.resize()})}),function(){return r.apply(this,arguments)}),updateNewRelationId:function(){var n=this;this._new_relations_ids.forEach(function(e){var t=e.clientid,i=e.id,e=n.relations.find(function(e){return t===e.id});e&&(e.id=i,(n._service.tools.find(function(e){return e.find(function(e){return 1<e.state.id.split(t+"_").length})})||[]).forEach(function(e){return e.state.id=e.state.id.replace(t+"_",i+"_")}))})},listenNewCommitRelations:function(e){var e=e.new_relations,e=void 0===e?{}:e,t=n("../services/editingservice").getLayerById(this.relation.child);e[t.getId()]&&Array.isArray(e[t.getId()].new)&&(this._new_relations_ids=[].concat(y(this._new_relations_ids||[]),y(e[t.getId()].new.map(function(e){return{clientid:e.clientid,id:e.id}}))))},updateExternalKeyValueRelations:function(n){var r=this,a=this._service.getEditingService(),e=a._getRelationFieldsFromRelation({layerId:this._service._relationLayerId,relation:this._service.relation}),t=e.ownField,e=e.relationField;!1!==(0<this._service.parent.editable.length&&e.find(function(e){return e===n.name}))&&(this._service.parent.values[n.name]=n.value,this._service.relations.map(function(e){return e.fields.find(function(e){return-1!==t.indexOf(e.name)})}).filter(Boolean).forEach(function(e){e.value=r._service.parent.values[e.name];var t=r._service.getLayer().getEditingSource().getFeatureById((void 0).id),i=t.clone();t.set(e.name,n.value),t.isNew()||a.getToolBoxById(r._service._relationLayerId).getSession().pushUpdate(r._service._relationLayerId,t,i)}))},getRelationFeatureValue:function(e,t){return this._service.getEditingService().getFeatureTableFieldValue({layerId:this._service._relationLayerId,feature:this._service.getLayer().getEditingSource().getFeatureById(e),property:t})}},computed:{relationsLength:function(){return this.relations.length},fieldrequired:function(){var t=this,i=this._service.getEditingService();return i._getRelationFieldsFromRelation({layerId:this._service._relationLayerId,relation:this._service.relation}).ownField.some(function(e){return i.isFieldRequired(t._service._relationLayerId,e)})},show_add_link:function(){return 0===this.relations.length||"ONE"!==this.relation.type}},watch:{relations:function(e){0===(1<arguments.length&&void 0!==arguments[1]?arguments[1]:[]).length?this.destroyTable():(this.updateNewRelationId(),this.updateTable())},show_vector_tools:function(e){this._service.enableDOMElements(!e),this.disabled=e}},beforeCreate:function(){this.delayType="debounce"},created:function(){var e=n("../services/editingservice"),t=e.getLayerById(this.relation.child);this._new_relations_ids=[],this.listenNewCommitRelations=this.listenNewCommitRelations.bind(this),e.on("commit",this.listenNewCommitRelations),this.isVectorRelation=d.LayerTypes.VECTOR===t.getType(),this.isVectorRelation&&(this.copyFeatureLayers=[].concat(y((e.getProjectLayersWithSameGeometryOfLayer(t,{exclude:[this.relation.father]})||[]).map(function(e){return{id:e.getId(),name:e.getName(),external:!1}})),y((e.getExternalLayersWithSameGeometryOfLayer(t)||[]).map(function(e){return{id:e.get("id"),name:e.get("name"),external:!0}}))).sort(function(e,t){return e.name.toLowerCase().localeCompare(t.name.toLowerCase())})),this.copylayerid=this.copyFeatureLayers.length?this.copyFeatureLayers[0].id:null,this.loadEventuallyRelationValuesForInputs=!1,this._service=new g(this.layerId,{relation:this.relation,relations:this.relations}),this.capabilities=this._service.getEditingCapabilities(),this.formeventbus.$on("changeinput",this.updateExternalKeyValueRelations.bind(this))},activated:(i=v(function*(){var e=n("../services/editingservice");if(this.isVectorRelation&&(this.mapExtent=c.getService("map").getMapBBOX()),this.show_vector_tools=!1,!this.loadEventuallyRelationValuesForInputs){this.loading=!0;try{yield e.runEventHandler({type:"show-relation-editing",id:e._getRelationId({layerId:this.layerId,relation:this.relation}),component:this})}catch(e){}this.loading=!1,this.loadEventuallyRelationValuesForInputs=!0}this.active=!0,yield this.$nextTick(),!this.relationsTable&&0<this.relations.length&&this._createDataTable(),this.resize()}),function(){return i.apply(this,arguments)}),deactivated:function(){this.destroyTable(),this.active=!1},beforeDestroy:function(){var e=n("../services/editingservice");this.loadEventuallyRelationValuesForInputs=!0,e.off("commit",this.listenNewCommitRelations),this.isVectorRelation&&null!==this._service.currentRelationFeatureId&&(c.getService("map").zoomToExtent(this.mapExtent),this.mapExtent=null)}},e.exports.__esModule&&(e.exports=e.exports.default);t="function"==typeof e.exports?e.exports.options:e.exports;t.render=function(){var n=this,e=n.$createElement,r=n._self._c||e;return r("div",{directives:[{name:"disabled",rawName:"v-disabled",value:n.loading,expression:"loading"}],staticStyle:{"margin-bottom":"5px"}},[r("bar-loader",{attrs:{loading:n.loading}}),n._v(" "),r("div",{ref:"relation_header_title",staticClass:"relation_header_title box-header with-border skin-color"},[r("span",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.edit_relation",expression:"'editing.edit_relation'"}]}),n._v(" "),r("span",{staticStyle:{"margin-left":"2px"}},[n._v(": "+n._s(n.relation.name.toUpperCase()))])]),n._v(" "),r("div",{ref:"relation_header_tools",staticClass:"relation_header_tools box-header with-border"},[r("div",{attrs:{id:"search-box"}},[n.relationsLength?r("input",{staticClass:"form-control",attrs:{type:"text",id:"filterRelation",placeholder:n.placeholdersearch}}):n._e()]),n._v(" "),r("div",{staticClass:"g3w-editing-relations-add-link-tools"},[n.capabilities.includes("change_attr_feature")?r("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:bottom.create",value:"plugins.editing.form.relations.tooltips.link_relation",expression:"'plugins.editing.form.relations.tooltips.link_relation'",arg:"bottom",modifiers:{create:!0}}],staticClass:"g3w-icon add-link",class:[{disabled:!n.show_add_link},n.g3wtemplate.font.link],attrs:{align:"center"},on:{click:function(e){e.stopPropagation(),n.show_add_link&&n.linkRelation()}}}):n._e(),n._v(" "),n.capabilities.includes("add_feature")?r("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:bottom.create",value:"plugins.editing.form.relations.tooltips.add_relation",expression:"'plugins.editing.form.relations.tooltips.add_relation'",arg:"bottom",modifiers:{create:!0}}],staticClass:"g3w-icon add-link pull-right",class:[{disabled:!n.show_add_link},n.g3wtemplate.font.plus],on:{click:function(e){n.show_add_link&&n.addRelationAndLink()}}}):n._e()])]),n._v(" "),n.show_vector_tools?r("section",{ref:"relation_vector_tools",staticClass:"relation_vector_tools"},[r("span",{staticClass:"close_vector_relation_tool",on:{click:function(e){return e.stopPropagation(),n.closeVectorTools(e)}}},[r("i",{staticClass:"g3w-icon skin-color",class:n.g3wtemplate.font.close})]),n._v(" "),r("div",[r("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.relation.draw_new_feature",expression:"'editing.relation.draw_new_feature'"}],staticClass:"g3w-editing-new-relation-vector-type"}),n._v(" "),r("button",{staticClass:"btn skin-button",staticStyle:{width:"100%"},on:{click:function(e){return e.stopPropagation(),n.addVectorRelation(e)}}},[r("i",{class:n.g3wtemplate.font.pencil})])]),n._v(" "),0<n.copyFeatureLayers.length?r("section",[r("span",{staticClass:"divider"}),n._v(" "),r("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.relation.draw_or_copy",expression:"'editing.relation.draw_or_copy'"}],staticStyle:{"align-self":"center"}}),n._v(" "),r("span",{staticClass:"divider"}),n._v(" "),r("div",{attrs:{id:"g3w-select-editable-layers-content"}},[r("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.relation.copy_feature_from_other_layer",expression:"'editing.relation.copy_feature_from_other_layer'"}],staticClass:"g3w-editing-new-relation-vector-type"}),n._v(" "),r("select",{directives:[{name:"select2",rawName:"v-select2",value:"copylayerid",expression:"'copylayerid'"}],attrs:{id:"g3w-select-editable-layers-to-copy"}},n._l(n.copyFeatureLayers,function(e){return r("option",{key:e.id,domProps:{value:e.id}},[n._v(n._s(e.name))])}),0),n._v(" "),r("button",{staticClass:"btn skin-button",on:{click:function(e){return e.stopPropagation(),n.copyFeatureFromOtherLayer(e)}}},[r("i",{class:n.g3wtemplate.font.clipboard})])])]):n._e()]):n._e(),n._v(" "),r("div",{directives:[{name:"disabled",rawName:"v-disabled",value:n.disabled,expression:"disabled"}],ref:"relation_body",staticClass:"relation_body box-body"},[0<n.relationsLength&&!n.update?r("table",{ref:"relationTable",staticClass:"table g3wform-relation-table table-striped"},[r("thead",[r("tr",[r("th",{directives:[{name:"t",rawName:"v-t",value:"tools",expression:"'tools'"}]}),n._v(" "),r("th"),n._v(" "),n._l(n.relationAttributesSubset(n.relations[0]),function(e){return r("th",[n._v(n._s(e.label))])})],2)]),n._v(" "),r("tbody",n._l(n.relations,function(t,i){return r("tr",{key:t.id,staticClass:"featurebox-header"},[r("td",[r("div",{staticStyle:{display:"flex"}},n._l(n._service.getTools(i),function(t){return r("div",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:top.create",value:"plugins."+t.state.name,expression:"`plugins.${tool.state.name}`",arg:"top",modifiers:{create:!0}}],key:t.state.id,staticClass:"editbtn enabled",class:{toggled:t.state.active},on:{click:function(e){return e.stopPropagation(),n.startTool(t,i)}}},[r("img",{attrs:{height:"20px",width:"20px",src:n.resourcesurl+"images/"+t.state.icon}})])}),0)]),n._v(" "),r("td",{staticClass:"action-cell"},[!n.fieldrequired&&n.capabilities.includes("change_attr_feature")?r("div",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:"plugins.editing.form.relations.tooltips.unlink_relation",expression:"'plugins.editing.form.relations.tooltips.unlink_relation'",arg:"right",modifiers:{create:!0}}],staticClass:"g3w-mini-relation-icon g3w-icon",class:n.g3wtemplate.font.unlink,attrs:{"aria-hidden":"true"},on:{click:function(e){return e.stopPropagation(),n._service.unlinkRelation(i)}}}):n._e()]),n._v(" "),n._l(n.relationAttributesSubset(t),function(e){return r("td",[n.isMedia(e.value)&&n.getValue(e.value)?r("div",{staticClass:"preview"},[r("a",{attrs:{href:n.getValue(e.value),target:"_blank"}},[r("div",{staticClass:"previewtype",class:n.getMediaType(e.value.mime_type).type},[r("i",{staticClass:"fa-2x",class:n.g3wtemplate.font[n.getMediaType(e.value.mime_type).type]})])]),n._v(" "),r("div",{staticClass:"filename"},[n._v(n._s(n.getValue(e.value).split("/").pop()))])]):["photo","link"].includes(n.getFieldType(e))?r("a",{attrs:{href:n.getValue(e.value),target:"_blank"}},[n._v(n._s(n.getValue(e.value))+"\n              ")]):r("span",[n._v(n._s(n.getValue(n.getRelationFeatureValue(t.id,e.name))))])])})],2)}),0)]):n._e()])],1)},t.staticRenderFns=[],t._scopeId="data-v-112912af"},{"../services/editingservice":42,"../services/relationservice":43,"vueify/lib/insert-css":1}],7:[function(e,t,i){e("vueify/lib/insert-css").insert("#g3w-select-editable-layers-content[data-v-45d7f042]{margin-bottom:10px;font-weight:700}#g3w-select-editable-layers-content label[data-v-45d7f042]{color:#fff!important}#g3w-select-editable-layers-to-show[data-v-45d7f042]{cursor:pointer}");Object.defineProperty(i,"__esModule",{value:!0}),n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var i=t,n=[],r=!0,t=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!i||n.length!==i);r=!0);}catch(e){t=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(t)throw a}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=e("../services/editingservice"),i.default={name:"Selecteditinglayers",data:function(){return{selectedlayers:[],editinglayers:Object.entries(a.getEditableLayers()).map(function(e){var e=n(e,2),t=e[0],e=e[1];return{id:t,name:e.getName(),title:e.getTitle()}})}},watch:{selectedlayers:function(n){var r=0<n.length;this.editinglayers.forEach(function(e){var e=e.id,t=a.getToolBoxById(e),i=r&&t.state.editing.history.commit,e=-1!==n.indexOf(e);t.setShow(!r||e),r&&!e&&i&&a.commit({toolbox:t}).always(function(){return t.stop()}),!r||e||i||t.stop()})}}},t.exports.__esModule&&(t.exports=t.exports.default);var n,a,e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"skin-color",attrs:{id:"g3w-select-editable-layers-content"}},[i("label",{directives:[{name:"t",rawName:"v-t",value:"Layers",expression:"'Layers'"}],attrs:{for:"g3w-select-editable-layers-to-show"}}),t._v(" "),i("select",{directives:[{name:"select2",rawName:"v-select2",value:"selectedlayers",expression:"'selectedlayers'"}],attrs:{id:"g3w-select-editable-layers-to-show",multiple:"multiple",clear:"true"}},t._l(t.editinglayers,function(e){return i("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.name))])}),0)])},e.staticRenderFns=[],e._scopeId="data-v-45d7f042"},{"../services/editingservice":42,"vueify/lib/insert-css":1}],8:[function(e,t,i){var n,r,a,o,s;e("vueify/lib/insert-css").insert("#table-editing-tools[data-v-13f4ce0f]{display:flex;justify-content:space-between}#table-editing-tools i[data-v-13f4ce0f]{margin:5px}.table_editing_footer_buttons[data-v-13f4ce0f]{position:absolute;bottom:10px;width:100%;display:flex;justify-content:center}.editing_table_header_content[data-v-13f4ce0f]{display:flex;justify-content:space-between;align-items:baseline}.editing_table_relation_messagge[data-v-13f4ce0f]{font-weight:700}");function l(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}Object.defineProperty(i,"__esModule",{value:!0}),n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e=g3wsdk.gui.vue.Mixins.resizeMixin,s=g3wsdk.gui.vue.Fields.media_field,i.default={name:"Table",mixins:[e],components:{"g3w-media":s},data:function(){return{state:this.dataTable=null,show:!0}},methods:{showTool:function(t){return void 0!==this.state.capabilities.find(function(e){return e===t})},resize:(o=l(function*(){"none"!==this.$el.style.display&&(yield this.$nextTick(),$("#editing_table  div.dataTables_scrollBody").height($(".content").height()-$(".close-panel-block").outerHeight()-$("#editing_table  div.dataTables_scrollHeadInner").outerHeight()-$(".editing_table_title").outerHeight()-$(".editing_table_header").outerHeight()-$(".editing_table_relation_messagge").outerHeight()-$(".dataTables_length").outerHeight()-$(".dataTables_paginate.paging_simple_numbers").outerHeight()-$(".dataTables_info").outerHeight()-$(".dataTables_filter").outerHeight()-$(".table_editing_footer_buttons").outerHeight()-$("#editing_table .dataTables_paginate.paging_simple_numbers").outerHeight()),this.dataTable)&&this.dataTable.columns.adjust()}),function(){return o.apply(this,arguments)}),showValue:function(t){return!!this.state.headers.find(function(e){return e.name===t})},isMediaField:function(e){return this.$options.service.isMediaField(e)},stop:function(){this.$options.service.cancel()},save:function(){this.state.isrelation?this.$options.service.linkFeatures(this._linkFeatures):this.$options.service.save()},cancel:function(){this.$options.service.cancel()},deleteFeature:(a=l(function*(e){var t=this,i=$("#editing_table table tr#"+e);this.$options.service.deleteFeature(e).then(l(function*(){t.dataTable.row(i).remove().draw(),yield t.$nextTick()})).catch(function(){})}),function(e){return a.apply(this,arguments)}),copyFeature:function(e){var t,i=this;this.$options.service.copyFeature(e).then((t=l(function*(e){i.show=!1,i.dataTable.destroy(),yield i.$nextTick(),i.show=!0,yield i.$nextTick(),i.setDataTable()}),function(e){return t.apply(this,arguments)}))},editFeature:function(e){this.$options.service.editFeature(e)},linkFeature:function(t,e){e.target.checked?this._linkFeatures.push(t):this._linkFeatures=this._linkFeatures.filter(function(e){return e!==t})},_setLayout:function(){return this.$options.service._setLayout()},getValue:function(e){return e&&"object"===(void 0===e?"undefined":n(e))&&Object===e.constructor?e=e.value:"string"==typeof e&&0===e.indexOf("_new_")&&(e=null),e},setDataTable:function(){this.dataTable=$("#editing_table table").DataTable({pageLength:10,scrollX:!0,scrollCollapse:!0,scrollResize:!0,order:[1,"asc"],columnDefs:[{orderable:!1,targets:0}]}),this.resize()}},watch:{"state.features":function(e){}},beforeCreate:function(){this.delayType="debounce"},mounted:(r=l(function*(){yield this.$nextTick(),this.state.isrelation&&(this._linkFeatures=[]),this.setDataTable(),$("#table-editing-tools i").tooltip(),this.$options.service.emit("ready"),this.resize()}),function(){return r.apply(this,arguments)}),beforeDestroy:function(){this._linkFeatures&&(this._linkFeatures=null),this.dataTable.destroy()}},t.exports.__esModule&&(t.exports=t.exports.default);i="function"==typeof t.exports?t.exports.options:t.exports;i.render=function(){var n=this,e=n.$createElement,r=n._self._c||e;return r("div",{staticClass:"g3w-editing-table",attrs:{id:"editing_table"}},[r("div",{ref:"editing_table_header",staticClass:"editing_table_header"},[r("div",{staticClass:"editing_table_header_content"},[r("h3",{staticClass:"editing_table_title"},[n._v(n._s(n.state.title))])]),n._v(" "),n.state.isrelation?r("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.relation.table.info",expression:"'editing.relation.table.info'"}],staticClass:"editing_table_relation_messagge"}):n._e()]),n._v(" "),n.show?r("table",{staticClass:"display",staticStyle:{width:"100%"}},[r("thead",[r("tr",[n.state.isrelation?n._e():r("th",{staticStyle:{"max-width":"60px"}}),n._v(" "),n.state.isrelation?r("th"):n._e(),n._v(" "),n._l(n.state.headers,function(e){return r("th",[n._v(n._s(e.label))])})],2)]),n._v(" "),r("tbody",n._l(n.state.features,function(t,i){return r("tr",{key:t.__gis3w_feature_uid,attrs:{id:t.__gis3w_feature_uid}},[n.state.isrelation?n._e():r("td",[r("div",{attrs:{id:"table-editing-tools"}},[n.showTool("change_attr_feature")?r("i",{directives:[{name:"t-title",rawName:"v-t-title:plugin",value:"editing.table.edit",expression:"'editing.table.edit'",arg:"plugin"}],staticClass:"g3w-icon skin-tooltip-right",class:n.g3wtemplate.font.pencil,staticStyle:{color:"#30cce7"},attrs:{"data-placement":"right","aria-hidden":"true"},on:{click:function(e){return e.stopPropagation(),n.editFeature(t.__gis3w_feature_uid)}}}):n._e(),n._v(" "),n.showTool("add_feature")?r("i",{directives:[{name:"t-title",rawName:"v-t-title:plugin",value:"editing.table.copy",expression:"'editing.table.copy'",arg:"plugin"}],staticClass:"g3w-icon skin-tooltip-right",class:n.g3wtemplate.font["copy-paste"],staticStyle:{color:"#d98b14",padding:"5px 7px 5px 7px"},attrs:{"data-placement":"right","aria-hidden":"true"},on:{click:function(e){return e.stopPropagation(),n.copyFeature(t.__gis3w_feature_uid)}}}):n._e(),n._v(" "),n.showTool("delete_feature")?r("i",{directives:[{name:"t-title",rawName:"v-t-title:plugin",value:"editing.table.delete",expression:"'editing.table.delete'",arg:"plugin"}],staticClass:"g3w-icon skin-tooltip-right",class:n.g3wtemplate.font["trash-o"],staticStyle:{color:"red"},attrs:{"data-placement":"right","aria-hidden":"true"},on:{click:function(e){return e.stopPropagation(),n.deleteFeature(t.__gis3w_feature_uid)}}}):n._e()])]),n._v(" "),n.state.isrelation?r("td",[r("input",{staticClass:"magic-checkbox",attrs:{id:"relation__"+i,type:"checkbox"},on:{change:function(e){return n.linkFeature(i,e)}}}),n._v(" "),r("label",{attrs:{for:"relation__"+i}})]):n._e(),n._v(" "),n._l(t,function(e,t){return n.showValue(t)?r("td",{key:t},[n.getValue(e)&&n.isMediaField(t)?r("g3w-media",{attrs:{state:e}}):r("p",[n._v(n._s(n.getValue(e)))])],1):n._e()})],2)}),0)]):n._e(),n._v(" "),r("div",{ref:"table_editing_footer_buttons",staticClass:"table_editing_footer_buttons",attrs:{id:"buttons"}},[r("button",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:n.state.isrelation?"editing.form.buttons.save_and_back":"editing.form.buttons.save",expression:"state.isrelation ? 'editing.form.buttons.save_and_back' : 'editing.form.buttons.save'"}],staticClass:"btn btn-success",staticStyle:{"margin-right":"10px"},on:{click:function(e){return e.stopPropagation(),n.save(e)}}}),n._v(" "),r("button",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.form.buttons.cancel",expression:"'editing.form.buttons.cancel'"}],staticClass:"btn btn-danger",on:{click:function(e){return e.stopPropagation(),n.cancel(e)}}})])])},i.staticRenderFns=[],i._scopeId="data-v-13f4ce0f"},{"vueify/lib/insert-css":1}],9:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={name:"Tool",props:["state","resourcesurl"],data:function(){return{}},methods:{toggletool:function(){this.state.active?this.$emit("stopactivetool"):this.$emit("setactivetool",this.state.id)}}},t.exports.__esModule&&(t.exports=t.exports.default);i="function"==typeof t.exports?t.exports.options:t.exports;i.render=function(){var t=this,e=t.$createElement,e=t._self._c||e;return t.state.visible?e("div",{staticClass:"editbtn",class:{enabled:t.state.enabled,toggled:t.state.active},on:{click:function(e){e.preventDefault(),e.stopPropagation(),t.state.enabled&&t.toggletool()}}},[e("img",{directives:[{name:"t-title",rawName:"v-t-title:plugin",value:""+t.state.name,expression:"`${state.name}`",arg:"plugin"}],attrs:{height:"25",width:"25",src:t.resourcesurl+"images/"+t.state.icon}})]):t._e()},i.staticRenderFns=[]},{}],10:[function(e,t,i){var n,r,a;e("vueify/lib/insert-css").insert(".toolbox[data-v-c4a84298]{padding-bottom:5px}.panel:not(.toolboxselected) .has-relations[data-v-c4a84298]{opacity:.4}");function o(e){return e&&e.__esModule?e:{default:e}}function s(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}Object.defineProperty(i,"__esModule",{value:!0}),a=o(e("./Tool.vue")),e=o(e("./ToolsOfTool.vue")),i.default={name:"Toolbox",props:["state","resourcesurl"],data:function(){return{active:!1,currenttoolhelpmessage:null}},components:{tool:a.default,toolsoftool:e.default},computed:{editDisabled:function(){return this.state.loading&&!this.state.startstopediting},hasRelations:function(){return 0<this.state.editing.dependencies.length},loading:function(){return this.state.loading||this.state.changingtools},toolsrow1:function(){return this.state.tools.filter(function(e){return 1===e.row})},toolsrow2:function(){return this.state.tools.filter(function(e){return 2===e.row})},toolsrow3:function(){return this.state.tools.filter(function(e){return 3===e.row})},canEdit:function(){return this.state.editing.canEdit},father:function(){return this.state.editing.father&&!!this.state.editing.dependencies.length},showtoolsoftool:function(){return!!this.state.toolsoftool.length},isLayerReady:function(){return this.state.layerstate.editing.ready}},methods:{select:function(){this.isLayerReady&&!this.state.selected&&this.$emit("setselectedtoolbox",this.state.id)},toggleEditing:function(){this.select(),this.state.layerstate.editing.ready&&!this.state.loading&&this.$emit(this.state.editing.on?"stoptoolbox":"starttoolbox",this.state.id)},saveEdits:function(){this.$emit("savetoolbox",this.state.id)},stopActiveTool:function(){this.$emit("stopactivetool",this.state.id),this.select()},setActiveTool:function(e){this.$emit("setactivetool",e,this.state.id),this.select()}},watch:{"state.activetool":(r=s(function*(e){yield this.$nextTick(),this.currenttoolhelpmessage=e&&e.getHelpMessage()}),function(e){return r.apply(this,arguments)}),"state.editing.on":function(e){this.$emit("on-editing",e)}},created:function(){this.edit_layer_tooltip="editing.tooltip.edit_layer",this.$emit("canEdit",{id:this.state.id})},mounted:(n=s(function*(){yield this.$nextTick(),$(this.$refs.editingbutton).tooltip()}),function(){return n.apply(this,arguments)})},t.exports.__esModule&&(t.exports=t.exports.default);i="function"==typeof t.exports?t.exports.options:t.exports;i.render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.state.show,expression:"state.show"}],staticClass:"toolbox"},[i("div",{class:{disableddiv:!t.isLayerReady||!t.canEdit},attrs:{id:"id_toolbox_"+t.state.id}},[i("div",{staticClass:"panel",class:{mobile:t.isMobile(),toolboxselected:t.state.selected},staticStyle:{"margin-bottom":"8px"},on:{click:function(e){return e.stopPropagation(),t.select(e)}}},[i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isLayerReady,expression:"!isLayerReady"}],staticClass:"bar-loader"}),t._v(" "),t.state.toolboxheader?i("div",{staticClass:"panel-heading container",staticStyle:{width:"100%"},style:{background:t.state.color}},[t.father?i("div",{staticClass:"pull-left enabled dropdown",staticStyle:{"margin-right":"5px",cursor:"pointer"}},[i("span",{class:t.g3wtemplate.font.relation}),t._v(" "),i("div",{staticClass:"dropdown-content skin-background-color",staticStyle:{padding:"5px","border-radius":"3px"}},t._l(t.state.editing.dependencies,function(e){return i("div",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(e))])}),0)]):t._e(),t._v(" "),i("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin:pre",value:"editing.toolbox.title",expression:"'editing.toolbox.title'",arg:"pre"}],staticClass:"panel-title",class:[t.father?"col-md-6":"col-md-8"]},[t._v(t._s(t.state.title))]),t._v(" "),i("div",{directives:[{name:"disabled",rawName:"v-disabled",value:t.editDisabled,expression:"editDisabled"},{name:"t-title",rawName:"v-t-title:plugin",value:t.edit_layer_tooltip,expression:"edit_layer_tooltip",arg:"plugin"}],ref:"editingbutton",staticClass:"start-editing editbtn skin-tooltip-left",class:{"pull-right":!t.isMobile(),enabled:t.isLayerReady,"g3w-icon-toggled":t.state.editing.on},attrs:{"data-placement":"left","data-toggle":"tooltip"},on:{click:function(e){return e.stopPropagation(),t.toggleEditing(e)}}},[i("span",{class:t.g3wtemplate.font.pencil,staticStyle:{"font-size":"1.1em",padding:"5px"}})])]):t._e(),t._v(" "),i("bar-loader",{attrs:{loading:t.loading}}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.state.changingtools,expression:"!state.changingtools"}],staticClass:"panel-body"},[t.hasRelations?i("div",{staticClass:"has-relations",staticStyle:{color:"#000000"}},[i("span",{class:t.g3wtemplate.font.info,staticStyle:{color:"#007bff","padding-right":"2px"}}),t._v(" "),i("span",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.messages.toolbox_has_relation",expression:"'editing.messages.toolbox_has_relation'"}]}),t._v(" "),i("divider")],1):t._e(),t._v(" "),t.state.message?i("div",{staticStyle:{color:"#000"}},[i("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:t.state.message,expression:"state.message"}],staticClass:"text-justify"}),t._v(" "),i("divider")],1):t._e(),t._v(" "),i("div",{staticClass:"tools-content row1",staticStyle:{display:"flex","flex-wrap":"wrap"}},t._l(t.toolsrow1,function(e){return i("tool",{key:e.id,attrs:{state:e,resourcesurl:t.resourcesurl},on:{stopactivetool:t.stopActiveTool,setactivetool:t.setActiveTool}})}),1),t._v(" "),i("div",{staticClass:"tools-content row2",staticStyle:{display:"flex","flex-wrap":"wrap"}},t._l(t.toolsrow2,function(e){return i("tool",{key:e.id,attrs:{state:e,resourcesurl:t.resourcesurl},on:{stopactivetool:t.stopActiveTool,setactivetool:t.setActiveTool}})}),1),t._v(" "),i("div",{staticClass:"tools-content row3",staticStyle:{display:"flex","flex-wrap":"wrap"}},t._l(t.toolsrow3,function(e){return i("tool",{key:e.id,attrs:{state:e,resourcesurl:t.resourcesurl},on:{stopactivetool:t.stopActiveTool,setactivetool:t.setActiveTool}})}),1),t._v(" "),i("div",{staticClass:"message",staticStyle:{"margin-top":"5px"},attrs:{id:"id_toolbox_messages_"+t.state.id}},[i("transition",{attrs:{name:"fade"}},[t.showtoolsoftool?i("toolsoftool",{attrs:{tools:t.state.toolsoftool}}):t._e()],1),t._v(" "),t.currenttoolhelpmessage?i("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:t.currenttoolhelpmessage,expression:"currenttoolhelpmessage"}],staticClass:"toolbox_help_message"}):t._e()],1)])],1)])])},i.staticRenderFns=[],i._scopeId="data-v-c4a84298"},{"./Tool.vue":9,"./ToolsOfTool.vue":11,"vueify/lib/insert-css":1}],11:[function(e,t,i){var n;e("vueify/lib/insert-css").insert("#toolsoftoolcontainer[data-v-21f6c16a]{display:flex;flex-direction:column;margin:5px;padding:5px;border-radius:5px}");function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(i,"__esModule",{value:!0}),n=r(e("./ToolsOfToolSnap.vue")),e=r(e("./ToolsOfToolMeasure.vue")),i.default={name:"Toolsoftool",props:["tools"],components:{snap:n.default,measure:e.default},data:function(){return{}}},t.exports.__esModule&&(t.exports=t.exports.default);i="function"==typeof t.exports?t.exports.options:t.exports;i.render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{display:"flex","flex-direction":"column",margin:"5px",padding:"5px","border-radius":"5px"},attrs:{id:"toolsoftoolcontainer"}},[t._l(t.tools,function(e){return[i(e.type,{tag:"component",attrs:{options:e.options}}),t._v(" "),i("divider")]})],2)},i.staticRenderFns=[],i._scopeId="data-v-21f6c16a"},{"./ToolsOfToolMeasure.vue":12,"./ToolsOfToolSnap.vue":13,"vueify/lib/insert-css":1}],12:[function(e,t,i){e("vueify/lib/insert-css").insert("label span[data-v-0b8314c3]{color:#222d32!important}");Object.defineProperty(i,"__esModule",{value:!0}),i.default={name:"measure",props:["options"],data:function(){return{checked:this.options.checked}},watch:{checked:function(e){this.options.onChange(e)}},beforeDestroy:function(){this.options.onBeforeDestroy()}},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var r=this,e=r.$createElement,e=r._self._c||e;return e("div",{staticStyle:{display:"flex"}},[e("input",{directives:[{name:"model",rawName:"v-model",value:r.checked,expression:"checked"}],staticClass:"magic-checkbox snap_tools_of_tools",attrs:{id:"g3w_editing_show_measure_tool",type:"checkbox"},domProps:{checked:Array.isArray(r.checked)?-1<r._i(r.checked,null):r.checked},on:{change:function(e){var t,i=r.checked,e=e.target,n=!!e.checked;Array.isArray(i)?(t=r._i(i,null),e.checked?t<0&&(r.checked=i.concat([null])):-1<t&&(r.checked=i.slice(0,t).concat(i.slice(t+1)))):r.checked=n}}}),r._v(" "),e("label",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:"plugins.editing.toolsoftool.measure",expression:"'plugins.editing.toolsoftool.measure'",arg:"right",modifiers:{create:!0}}],attrs:{for:"g3w_editing_show_measure_tool"}},[e("span",{class:r.g3wtemplate.font.measure,staticStyle:{"font-weight":"bold"}})])])},e.staticRenderFns=[],e._scopeId="data-v-0b8314c3"},{"vueify/lib/insert-css":1}],13:[function(e,t,i){e("vueify/lib/insert-css").insert("label span[data-v-66af2696]{color:#222d32!important}");Object.defineProperty(i,"__esModule",{value:!0}),s=g3wsdk.gui.GUI,a=g3wsdk.core.layer.Layer,n=s.getService("map"),o=e("../services/editingservice"),r=void 0,i.default={name:"snap",props:["options"],data:function(){return{id:"snap_"+Date.now(),idAll:"snap_"+Date.now()+"_all",checked:!1,checkedAll:!1,showSnapAll:!1}},computed:{add:function(){return(this.checked||this.checkedAll)&&this.options.active}},methods:{addFeatures:function(e){this.features.extend(e)},addFeature:function(e){this.addFeatures([e])},removeFeatures:function(e){var t=this;e.forEach(function(e){return t.features.remove(e)})},setShowSnapAll:function(){this.showSnapAll=!!this.vectorToolboxesEditingState.find(function(e){return e.on}),this.checkedAll=!!this.showSnapAll&&this.checkedAll},activeSnapInteraction:function(){r&&n.removeInteraction(r),r=null,this.add&&(r=new ol.interaction.Snap({source:!this.checkedAll&&this.checked&&this.options.source,features:this.checkedAll&&this.features}),n.addInteraction(r))},enableSnapInteraction:function(e){e?this.activeSnapInteraction():r&&n.removeInteraction(r)}},watch:{checked:function(e){this.options.checked=e,this.activeSnapInteraction()},checkedAll:function(e){this.options.checkedAll=e,this.activeSnapInteraction()},"options.active":function(e){this.enableSnapInteraction(e)}},created:function(){var r=this;this.features=new ol.Collection,this.sourcesAndEventsKeys=[],this.vectorToolboxesEditingState=[],this.unwatches=[],o.getLayers().forEach(function(e){var t,i,n=e.getId();a.LayerTypes.VECTOR===e.getType()&&(e=o.getToolBoxById(n),t=e.getLayer().getEditingSource(),r.features.extend(t.readFeatures()),r.sourcesAndEventsKeys.push({source:t,olKey:t.getFeaturesCollection().on("add",function(e){return r.addFeature(e.element)}),settersAndKeys:{addFeatures:t.onbefore("addFeatures",r.addFeatures),addFeature:t.onbefore("addFeature",r.addFeatures),clear:t.onbefore("clear",function(){r.removeFeatures(t.readFeatures())})}}),r.options.layerId!==n)&&(i=e.getState().editing,r.unwatches.push(r.$watch(function(){return i.on},r.setShowSnapAll)),r.vectorToolboxesEditingState.push(i))}),this.setShowSnapAll()},beforeDestroy:function(){this.sourcesAndEventsKeys.forEach(function(t){Object.keys(t.settersAndKeys).forEach(function(e){t.source.un(e,t.settersAndKeys[e])}),ol.Observable.unByKey(t.olKey)}),this.unwatches.forEach(function(e){return e()}),r=null,this.unwatches=null,this.vectorToolboxesEditingState=null,this.sourcesAndEventsKeys=null}},t.exports.__esModule&&(t.exports=t.exports.default);var a,n,o,r,s="function"==typeof t.exports?t.exports.options:t.exports;s.render=function(){var r=this,e=r.$createElement,e=r._self._c||e;return e("div",{staticStyle:{display:"flex",width:"100%","justify-content":"space-between"}},[e("input",{directives:[{name:"model",rawName:"v-model",value:r.checked,expression:"checked"}],staticClass:"magic-checkbox snap_tools_of_tools",attrs:{type:"checkbox",id:r.id},domProps:{checked:Array.isArray(r.checked)?-1<r._i(r.checked,null):r.checked},on:{change:function(e){var t,i=r.checked,e=e.target,n=!!e.checked;Array.isArray(i)?(t=r._i(i,null),e.checked?t<0&&(r.checked=i.concat([null])):-1<t&&(r.checked=i.slice(0,t).concat(i.slice(t+1)))):r.checked=n}}}),r._v(" "),e("label",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:"plugins.editing.toolsoftool.snap",expression:"'plugins.editing.toolsoftool.snap'",arg:"right",modifiers:{create:!0}}],attrs:{for:r.id}},[e("span",{class:r.g3wtemplate.font.magnete})]),r._v(" "),r.showSnapAll?[e("input",{directives:[{name:"model",rawName:"v-model",value:r.checkedAll,expression:"checkedAll"}],staticClass:"magic-checkbox snap_tools_of_tools",attrs:{type:"checkbox",id:r.idAll},domProps:{checked:Array.isArray(r.checkedAll)?-1<r._i(r.checkedAll,null):r.checkedAll},on:{change:function(e){var t,i=r.checkedAll,e=e.target,n=!!e.checked;Array.isArray(i)?(t=r._i(i,null),e.checked?t<0&&(r.checkedAll=i.concat([null])):-1<t&&(r.checkedAll=i.slice(0,t).concat(i.slice(t+1)))):r.checkedAll=n}}}),r._v(" "),e("label",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:left.create",value:"plugins.editing.toolsoftool.snapall",expression:"'plugins.editing.toolsoftool.snapall'",arg:"left",modifiers:{create:!0}}],attrs:{for:r.idAll}},[e("span",{class:r.g3wtemplate.font.magnete}),r._v(" "),e("span",{class:r.g3wtemplate.font.layers,staticStyle:{"font-weight":"bold"}})])]:r._e()],2)},s.staticRenderFns=[],s._scopeId="data-v-66af2696"},{"../services/editingservice":42,"vueify/lib/insert-css":1}],14:[function(e,t,i){function a(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}Object.defineProperty(i,"__esModule",{value:!0}),i.default=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).steps,t=void 0===e?{}:e;return{data:function(){return{steps:t,currentStep:0}},watch:{steps:{handler:function(e){var i=this;Object.values(e).find(function(e,t){if(!e.done)return i.currentStep=t,!0})},deep:!1}},render:function(n){var r=this;return n("ul",{style:{alignSelf:"flex-start",listStyle:"none",padding:(s.ismobile?5:10)+"px !important",marginBottom:0}},Object.values(this.steps).map(function(e,t){var i={current:!e.done&&t===r.currentStep,done:e.done,todo:!e.done&&t!==r.currentStep};return n("li",{style:{fontWeight:e.done||!e.done&&t===r.currentStep?"bold":null,marginBottom:"5px",color:e.done&&"green",display:e.buttonnext&&"inline-flex"}},[n("i",{style:{marginRight:"5px",fontWeight:e.done&&"bold"},class:(a(t={},o.getFontClass("arrow-right"),i.current),a(t,o.getFontClass("empty-circle"),i.todo),a(t,o.getFontClass("success"),i.done),t)}),n("span",{directives:[{name:e.directive,value:e.description}],style:{display:e.buttonnext?"inline-flex":"inline",flexDirection:e.buttonnext&&"row-reverse"}}),void 0!==e.dynamic&&n("span",{style:{alignSelf:"center",padding:"3px"}},e.dynamic),e.buttonnext&&n("button",{on:{click:function(){e.done=!0,e.buttonnext.done()}},directives:[{name:"t-plugin",value:"editing.workflow.next"}],style:{fontWeight:"bold"},class:{btn:!0,"btn-success":!0,"g3w-disabled":e.buttonnext.disabled}})])}))}}};var o=g3wsdk.gui.GUI,s=g3wsdk.core.ApplicationState},{}],15:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={close_editing_panel:{message:"To close editing form need to exit from editing layer"},errors:{no_layers:"Es tritt ein Fehler auf. Es ist nicht möglich, Layer zu bearbeiten",some_layers:"Es tritt ein Fehler auf: Es ist nicht möglich, einige Layer zu bearbeiten"},search:"Suche",editing_changes:"Änderungen bearbeiten",editing_data:"Layer bearbeiten",editing_attributes:"Attribute bearbeiten",relations:"Relationen",edit_relation:"Relation bearbeiten",back_to_relations:"Zurück zu Relationen",no_relations_found:"Keine Relationen gefunden",relation_data:"Relationsdaten",relation_already_added:"Relation bereits hinzugefügt",list_of_relations_feature:"Liste der Relations-Features ",tooltip:{edit_layer:"Layer bearbeiten"},toolbox:{title:"bearbeiten"},table:{edit:"Feature bearbeiten",copy:"Kopie erstellen",delete:"Feature löschen"},tools:{copy:"Features kopieren",pastefeaturesfromotherlayers:"Paste features from other layer",addpart:"Teil zu Multipart hinzufügen",deletepart:"Teil aus Multipart löschen",merge:"Feature auflösen",split:"Feature trennen",add_feature:"Feature hinzufügen",delete_feature:"Feature löschen",move_feature:"Feature verschieben",update_vertex:"Feature vertex aktualisieren",update_feature:"Feature-Attribut aktualisieren",update_multi_features:"Attribute ausgewählter Features aktualisieren",copyfeaturefromexternallayer:"Create Feature from added layer"},toolsoftool:{measure:"Messung anzeigen",snap:"Snap Layer",snapall:"Snap auf alle Layer"},steps:{help:{select_elements:"Features auswählen",select_element:"Feature auswählen",copy:"Neue Kopie der ausgewählten Features erstellen",merge:"Features auflösen",split:"Feature trennen",new:"Neues Feature erstellen",edit_table:"Features der Tabelle bearbeiten",draw_new_feature:"Feature auf Karte zeichnen",action_confirm:"Aktion bestätigen",double_click_delete:"Zu löschendes Feature auf der Karte auswählen",edit_feature_vertex:"Ändern oder Hinzufügen eines Eckpunktes auf dem ausgewählten Feature",move:"Ausgewähltes Feature verschieben",select_feature_to_relation:"Feature auswählen, welches die Relation verknüpft",show_edit_feature_form:"Feature-Formular zum Bearbeiten von Attributen anzeigen",pick_feature:"Zu änderndes Feature auf der Karte auswählen",insert_attributes_feature:"Attribute des Features einfügen"}},workflow:{steps:{select:"Zum Auswählen auf ein Feature klicken",draw_part:"Neues Teil zeichnen",merge:"Feature zum Auflösen auswählen",selectSHIFT:"Features auswählen indem ein Rechteck mit SHIFT gezeichnet wird",selectDrawBox:"Features auswählen, indem man ein Rechteck mit zwei gegenüberliegenden Eckpunkten zeichnet",selectDrawBoxAtLeast2Feature:"Mindestens Features auswählen, indem man ein Rechteck mit zwei gegenüberliegenden Eckpunkten zeichnet",selectPoint:"Zum Auswählen auf ein Feature klicken",selectPointSHIFT:"Features auswählen, indem ein Rechteck mit SHIFT gezeichnet wird (Multifeatures) oder auf ein Feature klicken",selectMultiPointSHIFT:"Features auswählen, indem man ein Rechteck zeichnet und SHIFT drückt oder auf ein Feature klickt",selectMultiPointSHIFTAtLeast2Feature:"Mindestens 2 Features auswählen und mit SHIFT ein Rechteck zeichnen oder auf ein Feature klicken",copyCTRL:"Kopieren ausgewählter Features mit CTRL+C",selectStartVertex:"Start-Eckpunkt der ausgewählten Features auswählen",selectToPaste:"Den Punkt auswählen, an dem die ausgewählten Features eingefügt werden sollen",draw_split_line:"Eine Linie zeichnen, um das ausgewählte Feature zu teilen"},title:{steps:"Schritte"},next:"Weiter"},messages:{featureslockbyotheruser:"Einige Geometrien/Datensätze können nicht bearbeitet werden, da sie von anderen Benutzern bearbeitet werden",splitted:"Getrennt",nosplittedfeature:"Feature nicht getrennt",press_esc:"Mit ESC zurück",online:"Wieder ONLINE. Jetzt kann man die Änderungen in der Datenbank speichern",offline:"OFFLINE. Alle Änderungen werden lokal gespeichert",delete_feature:"Soll das ausgewählte Feature gelöscht werden?",delete_feature_relations:"Wenn ein Feature Verknüpfungen beinhaltet, werden diese Relationen verwaist. Wir schlagen vor, diese Relationen zu behandeln, bevor das Feature gelöscht wird",unlink_relation:"Soll die Verknüpfung aufgehoben werden?",commit_feature:"Änderungen speichern?",toolbox_has_relation:"Diese Ebene ist Teil einer Beziehung",saved:"Daten erfolgreich gespeichert",saved_local:"Daten erfolgreich lokal gespeichert",loading_data:"Daten laden",saving:"Daten werden gespeichert. Bitte warten ...",constraints:{enable_editing:"Bitte zoomen Sie hinein, um die Editier-Tools zu aktivieren \nAktivierungsskala bei 1:"},pdf:"Dokumentenvorschau nicht verfügbar. Bitte hier klicken ",commit:{header:"Die folgende Liste zeigt alle zu übernehmenden Änderungen.",header_add:"<b>Hinzufgefügt</b> Die Anzahl der hinzugefügten Features anzeigen",header_update_delete:"<b>Bearbeitet</b> und <b>Gelöscht</b> Die Liste der Feature-ID anzeigen",add:"Hinzugefügt(n. Features)",delete:"Gelöscht(id)",update:"Bearbeitet(id)"},loading_table_data:"Datentabelle wird erstellt. Bitte warten ...",copy_and_paste_from_other_layer_mandatory_fields:"Vor dem Speichern müssen alle Pflichtfelder des eingegebenen features ausgefüllt werden",no_feature_selected:"Keine feature ausgewählt",select_min_2_features:"Select at least 2 features"},relation:{table:{info:"<div>Wählen Sie Relationen aus, um sie mit dem aktuellen Feature zu verknüpfen.</div>"},draw_new_feature:"Zeichnen Sie eine neue feature",draw_or_copy:"oder",copy_feature_from_other_layer:"Kopieren Sie feature aus einer anderen layer"},form:{relations:{tooltips:{back_to_father:"Zurück zur Bearbeitung des Vaters",add_relation:"Neue Relation erstellen und verknüpfen",link_relation:"Eine Relation zu diesem Feature herstellen",open_relation_tools:"Relationstools anzeigen",unlink_relation:"Relation trennen"}},buttons:{save:"Einfügung/Bearbeiten",save_and_back:"Speichern und zurück",save_and_back_table:"Speichern und zurück",cancel:"Änderungen ignorieren"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Select feature/s",edit_attributes:"Edit attributes of pasted features in multiple mode"},copyfeaturefromprojectlayer:{title:"Select one feature"}}}}},{}],16:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={close_editing_panel:{message:"To close editing form need to exit from editing layer"},errors:{no_layers:"An error occurs. It's no possible to edit layers",some_layers:"An error occurs: It's no possible to edit some layers"},search:"Search",editing_changes:"Editing Changes",editing_data:"Editing Layers",editing_attributes:"Editing attributes",relations:"Relations",edit_relation:"Edit relation",back_to_relations:"Back to Relations",no_relations_found:"No relations found",relation_data:"Relation data",relation_already_added:"Relation already added",list_of_relations_feature:"List of relations feature ",tooltip:{edit_layer:"Edit Layer"},toolbox:{title:"Edit"},table:{edit:"Edit feature",copy:"Create a copy",delete:"Delete feature"},tools:{copy:"Copy features",pastefeaturesfromotherlayers:"Paste features from other layer",addpart:"Add part to multipart",deletepart:"Delete part from multipart",merge:"Dissolve features",split:"Split Feature",add_feature:"Add feature",delete_feature:"Delete feature",move_feature:"Move feature",update_vertex:"Update feature vertex",update_feature:"Update feature attribute",update_multi_features:"Update attributes of selected features",copyfeaturefromexternallayer:"Create Feature from added layer"},toolsoftool:{measure:"Show measure",snap:"Snap layer",snapall:"Snap to all layers"},steps:{help:{select_elements:"Select features",select_element:"Select feature",copy:"Create new copy of selected features",merge:"Dissolve features",split:"Split Feature",new:"Create new feature",edit_table:"Edit table features",draw_new_feature:"Draw feature on map",action_confirm:"Confirm action",double_click_delete:"Select feature on map to delete",edit_feature_vertex:"Modify or add a vertex on selected feature",move:"Move selected feature",select_feature_to_relation:"Select feature that you bind relation",show_edit_feature_form:"Show feature form to edit attributes",pick_feature:"Select feature on map to modify",insert_attributes_feature:"Insert attributes of the feature"}},workflow:{steps:{select:"Click on feature to select",draw_part:"Draw new part",merge:"Select featurewhere dissolve",selectSHIFT:"Select features drawing a rectangle pressing SHIFT",selectDrawBox:"Select features drawing a rectangle by two point of opposite corners",selectDrawBoxAtLeast2Feature:"Select at least features drawing a rectangle by two point of opposite corners",selectPoint:"Click on feature to select",selectPointSHIFT:"Select features drawing a rectangle pressing SHIFT (multifeatures) or click on one feature",selectMultiPointSHIFT:"Select features drawing a rectangle pressing SHIFT or click on feature",selectMultiPointSHIFTAtLeast2Feature:"Select at least 2 features drawing a rectangle pressing SHIFT or click on feature",copyCTRL:"Copy selected features using CTRL+C",selectStartVertex:"Select starting vertex of selected features",selectToPaste:"Select the point where paste the features selected",draw_split_line:"Draw a line to split selected feature"},title:{steps:"Steps"},next:"Next"},messages:{featureslockbyotheruser:"Some geometries/records are not editable because in editing by other user",splitted:"Splitted",nosplittedfeature:"Feature not spitted",press_esc:"Press ESC to back",online:"Back ONLINE. Now you can save your changes on database",offline:"You are OFFLINE. All changes are saved locally",delete_feature:"Do you want delete selected feature ?",delete_feature_relations:"If feature has bindings relations, these relations become orphans. We suggest to handle these relations before detele this feature",unlink_relation:"Do you want unlink relation?",commit_feature:"Do you want to save the changes",toolbox_has_relation:"this layer is part of a relation",saved:"Data saved successfully",saved_local:"Data saved locally successfully",loading_data:"Loading data",saving:"Saving data. Please wait ...",constraints:{enable_editing:"Please Zoom In to enable editing tools \nActivation scale at 1:"},pdf:"Document preview not available. Please click here ",commit:{header:"The following list show all changes to commit.",header_add:"<b>Added</b> show the number of features added",header_update_delete:"<b>Modified</b> and <b>Deleted</b> show the list of features id",add:"Added(n. features)",delete:"Deleted(id)",update:"Modified(id)"},loading_table_data:"Building Data Table. Please wait ...",copy_and_paste_from_other_layer_mandatory_fields:"It is necessary to fill in any mandatory fields on the features pasted before saving",no_feature_selected:"No feature selected",select_min_2_features:"Select at least 2 features"},relation:{table:{info:"<div>Select relations to link it to current editing feature.</div>"},draw_new_feature:"Draw new feature",draw_or_copy:"or",copy_feature_from_other_layer:"Copy feature from other layer"},form:{relations:{tooltips:{back_to_father:"Back to edit father",add_relation:"Create and link new relation",link_relation:"Join a relation to this feature",open_relation_tools:"Show relation tools",unlink_relation:"Unlink relation"}},buttons:{save:"Insert/Edit",save_and_back:"Save and Back",save_and_back_table:"Save and Back",cancel:"Ignore Changes"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Select feature/s",edit_attributes:"Edit attributes of pasted features in multiple mode"},copyfeaturefromprojectlayer:{title:"Select a feature"}}}}},{}],17:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={close_editing_panel:{message:"To close editing form need to exit from editing layer"},errors:{no_layers:"Tapahtui virhe. Tasoja ei ole mahdollista muokata.",some_layers:"Tapahtui virhe. Jotkin tasot eivät ole muokattavissa."},search:"Haku",editing_changes:"Editing Changes",editing_data:"Muokataan tasoja",editing_attributes:"Muokataan attribuutteja",relations:"Relaatiot",edit_relation:"Muokkaa relaatiota",back_to_relations:"Takaisin relaatioihin",no_relations_found:"Relaatioita ei löytynyt",relation_data:"Relaation tiedot",relation_already_added:"Relaatio on jo lisätty",list_of_relations_feature:"Lista relaation ominaisuuksista",tooltip:{edit_layer:"Muokkaa tasoa"},toolbox:{title:"Muokkaa"},table:{edit:"Muokkaa ominaisuutta",copy:"Luo kopio",delete:"Poista ominaisuus"},tools:{copy:"Kopio ominaisuuksia",pastefeaturesfromotherlayers:"Paste features from other layer",addpart:"Lisää osa",deletepart:"Poista osa",merge:"Yhdistä ominaisuudet",split:"Leikkaa ominaisuus",add_feature:"Lisää ominaisuus",delete_feature:"Poista ominaisuus",move_feature:"Siirrä ominaisuutta",update_vertex:"Päivitä pisteen ominaisuutta",update_feature:"Päivitä ominaisuus",update_multi_features:"Muokkaa valittujen ominaisuuksien attribuutteja",copyfeaturefromexternallayer:"Create Feature from added layer"},toolsoftool:{measure:"Show measure",snap:"Snap layer",snapall:"Snap to all layers"},steps:{help:{select_elements:"Valitse ominaisuudet",select_element:"Valitse ominaisuus",copy:"Luo kopio valituista ominaisuuksista",merge:"Yhdistä ominaisuudet",split:"Leikkaa ominaisuus",new:"Luo uusi ominaisuus",edit_table:"Muuta taulun ominaisuuksia",draw_new_feature:"Piirrä ominaisuus kartalle",action_confirm:"Hyväksy toiminto",double_click_delete:"Valitse poistettava ominaisuus kartalta",edit_feature_vertex:"Muuta pistettä tai lisää piste valittuun ominaisuuteen",move:"Siirrä valittu ominaisuus",select_feature_to_relation:"Valitse relaatio",show_edit_feature_form:"Näytä ominaisuuslomake muokataksesi attribuutteja",pick_feature:"Valitse muokattava ominaisuus kartalta",insert_attributes_feature:"Lisää ominaisuuden attribuutit"}},workflow:{steps:{select:"Valitse ominaisuus",draw_part:"Piirrä uusi osa",merge:"Valitse ominaisuus yhdistääksesi",selectSHIFT:"Paina SHIFT, jos haluat valita kohteita suorakulmiovalinnalla.",selectDrawBox:"Piirrä suorakulmio, jonka siältä kohteet valitaan ",selectDrawBoxAtLeast2Feature:"Piirrä suorakulmio, jonka siältä kohteet vähintään 2 valitaan ",selectPoint:"Valitse ominaisuus",selectPointSHIFT:"Paina SHIFT, jos haluat valita ominaisuuksia suorakulmiovalinnalla, tai valitse yksittäinen ominaisuus.",selectMultiPointSHIFT:"Paina SHIFT, jos haluat valita ominaisuuksia suorakulmiovalinnalla, tai valitse yksittäinen ominaisuus.",selectMultiPointSHIFTAtLeast2Feature:"Paina SHIFT, jos haluat valita vähintään 2 ominaisuuksia suorakulmiovalinnalla, tai valitse yksittäinen ominaisuus.",copyCTRL:"CTRL+C, voit kopioida valitut ominaisuudet.",selectStartVertex:"Osoita valittujen ominaisuuksien alkupiste.",selectToPaste:"Valitse kohta, johon liität valitut ominaisuudet.",draw_split_line:"Piirrä viiva, jonka mukaan valittu ominaisuus jaetaan."},title:{steps:"Vaiheet"},next:"Seuraava"},messages:{featureslockbyotheruser:"Some features are locked by another user",splitted:"Jaettu",nosplittedfeature:"Ominaisuutta ei jaettu",press_esc:"Paina ESC palataksesi",online:"Yhteys muodostettu. Muutokset voidaan tallentaa tietokantaan.",offline:"Olet offline-tilassa. Muutokset tallennetaan paikallisesti",delete_feature:"Haluatko poistaa valitun ominaisuuden?",delete_feature_relations:"Mikäli ominaisuudella on sitovia relaatioita, näistä relaatiosta tulee orpoja. Suosittelemme käsittelemään nämä relaatiot ennen poistamista",unlink_relation:"Haluatko poistaa relaation?",commit_feature:"Tallennetaanko muutokset?",toolbox_has_relation:"tämä kerros on osa relaatiota",saved:"Tiedot tallennettu onnistuneesti",saved_local:"Tiedot on tallennettu onnistuneesti paikallisesti.",loading_data:"Ladataan tietoja",saving:"Tallentaan tietoja. Odota...",constraints:{enable_editing:"Lähennä ottaaksesi muokkaustyökalut käyttöön \nAktivointi mittakaava 1:"},pdf:"Dokumentin esikatselu ei ole saatavilla. Paina tästä ",commit:{header:"Seuraava luettelo näyttää kaikki muutokset.",header_add:"<b>Lisätty</b> näytä lisättyjen ominaisuuksien lukumäärä",header_update_delete:"<b>Muokattu</b> ja <b>Poistettu</b> Näytä listä ominaisuuksien id:stä",add:"Lisätty(n. ominaisuutta)",delete:"Poistettu(id)",update:"Muokattu(id)"},loading_table_data:"Building Data Table. Please wait ...",copy_and_paste_from_other_layer_mandatory_fields:"It is necessary to fill in any mandatory fields on the features pasted before saving",no_feature_selected:"No feature selected",select_min_2_features:"Select at least 2 features"},relation:{table:{info:"<div>Valitse relaatiota linkittääksesi ne muokattavaan ominaisuuteen.</div>"},draw_new_feature:"Draw new feature",draw_or_copy:"or",copy_feature_from_other_layer:"Copy feature from other layer"},form:{relations:{tooltips:{back_to_father:"Back to edit father",add_relation:"Luo ja linkitä uusi relaatio",link_relation:"Liitä relaatio tähän ominaisuuteen",open_relation_tools:"Näytä relaatiotyökalut",unlink_relation:"Poista relaatio"}},buttons:{save:"Lisää/muokkaa",save_and_back:"Tallenna ja palaa",save_and_back_table:"Tallenna ja palaa",cancel:"Peruuta"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Select feature/s",edit_attributes:"Edit attributes of pasted features in multiple mode"},copyfeaturefromprojectlayer:{title:"Select a feature"}}}}},{}],18:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={close_editing_panel:{message:"To close editing form need to exit from editing layer"},errors:{no_layers:"Une erreur s'est produite lors du chargement des layers dans l'édition.",some_layers:"Une erreur s'est produite lors du chargement de certaines layers dans l'édition."},search:"Recherche",editing_changes:"Editing Changes",editing_data:"Modifier les donnes",editing_attributes:"Modifier les attributs",relations:"Relations",edit_relation:"Modifier la relation",back_to_relations:"Retour aux relations",no_relations_found:"Il n'y a pas de relations",relation_data:"Données sur les relations",relation_already_added:"Relation déjà présente",list_of_relations_feature:"Lister les relations de la fonctionnalité",tooltip:{edit_layer:"Modifier le layer"},toolbox:{title:"Modifier"},table:{edit:"Modifier fonctionnalités",copy:"Créer une copie",delete:"Supprimer la fonctionnalité"},tools:{copy:"Copier les fonctionnalités",pastefeaturesfromotherlayers:"Paste features from other layer",addpart:"Ajouter une pièce à la géométrie",deletepart:"Supprimer la partie de la géométrie",merge:"Dissoudre les fonctionnalités",split:"Couper la fonctionnalité",add_feature:"Ajouter une fonctionnalité",delete_feature:"Supprimer la fonctionnalité",move_feature:"Déplacez la fonctionnalité",update_vertex:"Mettre à jour les sommets des fonctionnalités",update_feature:"Modifier les attributs des fonctionnalités",update_multi_features:"Modifier les attributs des fonctionnalités sélectionnées",copyfeaturefromexternallayer:"Create Feature from added layer"},toolsoftool:{measure:"Show measure",snap:"Snap layer",snapall:"Snap to all layers"},steps:{help:{select_elements:"Sélectionner les fonctionnalités",select_element:"Sélectionner une fonctionnalité",copy:"Créer une copie des fonctionnalités sélectionnées",merge:"Dissoudre les fonctionnalités",split:"Couper la fonctionnalité",new:"Créer une nouvelle fonctionnalité",edit_table:"Modifier les fonctionnalités de la table",draw_new_feature:"Dessiner une fonctionnalité sur la carte",action_confirm:"Confirmer l'action",double_click_delete:"Sélectionner la fonctionnalité sur la carte à supprimer",edit_feature_vertex:"Modifier ou ajouter un sommet à la fonctionnalité sélectionnée",move:"Déplacer la fonctionnalité sélectionnée",select_feature_to_relation:"Sélectionner la fonctionnalité que vous souhaitez mettre en relation",show_edit_feature_form:"Afficher le formulaire de la fonctionnalité permettant de modifier les attributs",pick_feature:"Sélectionner l'élément de la carte à modifier",insert_attributes_feature:"Insérer les attributs de la fonctionnalité"}},workflow:{steps:{select:"Cliquer sur la fonctionnalité à sélectionner",draw_part:"Dessiner la nouvelle partie",merge:"Sélectionner la fonction à introduire en fondu",selectPoint:"Cliquer sur la fonctionnalité pour la sélectionner",selectSHIFT:"Sélectionner des fonctionnalités en maintenant la touche SHIFT enfoncée",selectDrawBox:"Sélectionner les fonctionnalités en dessinant un rectangle par la création des deux points de la diagonale",selectDrawBoxAtLeast2Feature:"Sélectionner au moins 2 fonctionnalités en dessinant un rectangle par la création des deux points de la diagonale",selectPointSHIFT:"Sélectionner des caractéristiques en maintenant la touche SHIFT enfoncée (multi-sélection) ou en cliquant sur une seule caractéristique",selectMultiPointSHIFT:"Sélectionner des fonctionnalités en maintenant la touche SHIFT appuyée ou en cliquant sur la fonctionnalité individuelle",selectMultiPointSHIFTAtLeast2Feature:"Sélectionner au moins 2 fonctionnalités en maintenant la touche SHIFT appuyée ou en cliquant sur la fonctionnalité individuelle",copyCTRL:"Copier les fonctionnalités sélectionnées avec CTRL+C",selectStartVertex:"Sélectionner le sommet de départ des fonctionnalités choisies",selectToPaste:"Sélectionner le point où les fonctionnalités sélectionnées seront collées",draw_split_line:"Tracez une ligne pour couper la fonctionnalité sélectionnée"},title:{steps:"Étapes"},next:"Suivant"},messages:{featureslockbyotheruser:"Certaines géométries/enregistrements ne sont pas modifiables car ils ont été modifiés par un autre utilisateur",splitted:"Fonctionnalité(s) divisé(es)",nosplittedfeature:"La (les) fonctionnalité(s) n’a (n'ont) pas été divisé(es)",press_esc:"Appuyez sur ESC pour revenir",online:"Vous êtes à nouveau EN LIGNE. Vous pouvez enregistrer les modifications de façon permanente",offline:"Vous êtes HORS LIGNE. Toutes les modifications seront enregistrées temporairement en local",delete_feature:"Voulez-vous supprimer la fonctionnalité sélectionnée ?",delete_feature_relations:"La suppression d'une fonctionnalité avec des relations associées laissera ces relations orphelines. Il est recommandé de gérer ces relations avant de supprimer la fonctionnalité",unlink_relation:"Voulez-vous détacher la relation ?",commit_feature:"Voulez-vous enregistrer définitivement les changements ?",toolbox_has_relation:"cette couche fait partie d'une relation",saved:"Les données ont été enregistrées correctement",saved_local:"Les données ont été correctement sauvegardées localement",loading_data:"Chargement des données",saving:"Sauvegarde des données. Veuillez patienter ...",constraints:{enable_editing:"Augmenter le niveau de zoom pour permettre l'édition \nEchelle de déclenchement 1 :"},pdf:"Aperçu du document non disponible. Cliquez ici ",commit:{header:"La liste ci-dessous montre toutes les modifications qui seront enregistrées.",header_add:"<b>Ajouts</b> indique le nombre de fonctionnalités ajoutées",header_update_delete:"<b>Modifié</b> e <b>Supprimé</b> liste les ids",add:"Ajouté (n. fonctionnalités)",delete:"Supprimé(id)",update:"Modifié(id)"},loading_table_data:"Building Data Table. Please wait ...",copy_and_paste_from_other_layer_mandatory_fields:"Avant d'enregistrer, il est nécessaire de remplir tous les champs obligatoires du features saisi",no_feature_selected:"Aucune feature sélectionnée",select_min_2_features:"Select at least 2 features"},relation:{table:{info:"<div>Sélectionner les relations pour les associer à l'élément en cours d'édition.</div>"},draw_new_feature:"Dessiner une nouvelle feature",draw_or_copy:"ou",copy_feature_from_other_layer:"Copier feature d'une autre layer"},form:{relations:{tooltips:{back_to_father:"Back to edit father",add_relation:"Créer et ajouter une nouvelle relation",link_relation:"Associer une relation existante à cette fonctionnalité",open_relation_tools:"Outils de relation ouverte",unlink_relation:"Annuler la relation"}},buttons:{save:"Insérer/Modifier",save_and_back:"Sauvegarder et retourner au parent",save_and_back_table:"Sauvegarder et et revenir en arrière",cancel:"Ignorer modifications"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Select feature/s",edit_attributes:"Edit attributes of pasted features in multiple mode"},copyfeaturefromprojectlayer:{title:"Select a feature"}}}}},{}],19:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n=u(e("./it")),r=u(e("./en")),a=u(e("./fi")),o=u(e("./se")),s=u(e("./fr")),l=u(e("./de")),e=u(e("./ro"));function u(e){return e&&e.__esModule?e:{default:e}}i.default={it:n.default,en:r.default,fi:a.default,se:o.default,fr:s.default,de:l.default,ro:e.default}},{"./de":15,"./en":16,"./fi":17,"./fr":18,"./it":20,"./ro":21,"./se":22}],20:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={close_editing_panel:{message:"Uscire dall'editing per chiudere il form"},errors:{no_layers:"Si è verificato un errore nel caricamento dei layers in editing.",some_layers:"Si è verificato un errore nel caricamento di alcuni layers in editing"},search:"Cerca",editing_changes:"Modifiche Editing",editing_data:"Edita Dati",editing_attributes:"Edita attributi",relations:"Relazioni",edit_relation:"Edita relazione",back_to_relations:"Ritorna alle Relazioni",no_relations_found:"Non ci sono relazioni",relation_data:"Dati relativi alla relazione",relation_already_added:"Relazione già presente",list_of_relations_feature:"Elenco Relazioni della feature ",tooltip:{edit_layer:"Modifica Layer"},toolbox:{title:"Edita"},table:{edit:"Edita feature",copy:"Crea una copia",delete:"Cancella feature"},tools:{copy:"Copia features",pastefeaturesfromotherlayers:"Incolla features da altro layer",addpart:"Aggiungi parte alla geometria",deletepart:"Cancella parte dalla geometria",merge:"Dissolvi features",split:"Taglia Feature",add_feature:"Aggiungi feature",delete_feature:"Elimina feature",move_feature:"Muovi feature",update_vertex:"Aggiorna vertici feature",update_feature:"Modifica attributi feature",update_multi_features:"Modifica gli attributi delle features selezionate",copyfeaturefromexternallayer:"Crea feature dal layer aggiunto"},toolsoftool:{measure:"Visualizza misura",snap:"Snap sul layer",snapall:"Snap su tutti i layer"},steps:{help:{select_elements:"Seleziona le features",select_element:"Seleziona la feature",copy:"Crea una copia delle feature selezionate",merge:"Dissolvi features",split:"Taglia Feature",new:"Creo una nuova feature",edit_table:"Edita le features della tabella",draw_new_feature:"Disegna sulla mappa la feature",action_confirm:"Conferma azione",double_click_delete:"Seleziona la feature sulla mappa da cancellare",edit_feature_vertex:"Modifica o aggiungi un vertice alla feature selezionata",move:"Muovi la feature selezionata",select_feature_to_relation:"Seleziona la feature che vuoi mettere in relazione",show_edit_feature_form:"Mostra il form della feature per poter editare gli attributi",pick_feature:"Seleziona la feature sulla mappa da modificare",insert_attributes_feature:"Inserisci gli attributi della feature"}},workflow:{steps:{select:"Clicca sulla feature da selezionare",draw_part:"Disegna la nuova parte",merge:"Seleziona la feature su cui dissolvere",selectPoint:"Clicca sulla feature per selezionarla",selectSHIFT:"Seleziona le features tenedo premuto il tasto SHIFT",selectDrawBox:"Seleziona le features disegnando un rettangolo mediante la creazione dei due punti della diagonale",selectDrawBoxAtLeast2Feature:"Seleziona almeno 2 features disegnando un rettangolo mediante la creazione dei due punti della diagonale",selectPointSHIFT:"Seleziona le features tenedo premuto il tasto SHIFT (multiselezione) oppure cliccando sulla singola feature",selectMultiPointSHIFT:"Seleziona le features tenedo premuto il tasto SHIFT oppure cliccando sulla singola feature",selectMultiPointSHIFTAtLeast2Feature:"Seleziona almeno 2 features tenedo premuto il tasto SHIFT oppure cliccando sulla singola feature",copyCTRL:"Copia le features selezionate con CTRL+C",selectStartVertex:"Seleziona il vertice di partenza delle feature selezionate",selectToPaste:"Seleziona il punto dove verranno incollate le features selezionate",draw_split_line:"Disegna una linea per tagliare la feature selezionata"},title:{steps:"Passi"},next:"Avanti"},messages:{featureslockbyotheruser:"Ci sono alcune geometrie/records non editabili perchè in modifica da altri utenti",splitted:"Feature(s) splittata(e)",nosplittedfeature:"La(e) feature(s) non è stata splittata",press_esc:"Premi ESC per tornare indietro",online:"Ora sei di nuovo ONLINE. Puoi slavare le modifiche in modo permanente",offline:"Sei OFFLINE. Tutte le modifiche saranno salvate temporaneamente in locale",delete_feature:"Vuoi eliminare l'elemento selezionato?",delete_feature_relations:"Cancellando una feature con relazioni associate, tale relazioni rimarranno orfane. Si consiglia di gestire tali relazioni prima di cancellare la feature",unlink_relation:"Vuoi staccare la relazione?",commit_feature:"Vuoi salvare definitivamente le modifiche",toolbox_has_relation:"questo livello fa parte di una relazione",saved:"I dati sono stati salvati correttamente",saved_local:"I dati sono stati salvati correttamente in locale",loading_data:"Caricamento dati",saving:"Salvataggio dati in corso. Attendere ...",constraints:{enable_editing:"Aumentare il livello di zoom per abilitare l'editing \nScala di attivazione 1:"},pdf:"Anteprima del documento non disponibile. Clicca qui ",commit:{header:"La lista sotto riporta tutte le modifiche che verranno salvate.",header_add:"<b>Aggiunte</b> riporta il numero delle features aggiunte",header_update_delete:"<b>Modificate</b> e <b>Cancellate</b> riporta la lista degli id",add:"Aggiunte (n. features)",delete:"Cancellate(id)",update:"Modificate(id)"},loading_table_data:"Costruzione tabella dati in corso. Attendere ...",copy_and_paste_from_other_layer_mandatory_fields:"Necessario compilare eventuali campi obbligatori sulle features incollate prima del salvataggio",no_feature_selected:"Nessuna feature selezionata",select_min_2_features:"Seleziona come minimo due features"},relation:{table:{info:"<div>Seleziona le relazioni per associarle alla feature in editing.</div>"},draw_new_feature:"Disegna nuova geometria",draw_or_copy:"oppure",copy_feature_from_other_layer:"Copia geometria da altro layer"},form:{relations:{tooltips:{back_to_father:"Torna ad editare il padre",add_relation:"Crea ed aggiungi nuova relazione",link_relation:"Associa una relazione esistente a questa feature",open_relation_tools:"Apri strumenti relatione",unlink_relation:"Annulla relazione"}},buttons:{save:"Inserisci/Modifica",save_table:"Modifica",save_and_back:"Salva e torna al padre",save_and_back_table:"Salva e torna indietro",cancel:"Ignora Modifiche"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Seleziona feature/s",edit_attributes:"Edita attributi delle features in multiple mode"},copyfeaturefromprojectlayer:{title:"Seleziona una feature"}}}}},{}],21:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={close_editing_panel:{message:"To close editing form need to exit from editing layer"},errors:{no_layers:"Avem o eroare. Straturile nu sunt editabile",some_layers:"Avem o eroare: Anumite straturi nu se pot edita"},search:"Caută",editing_changes:"Modificare schimbări",editing_data:"Modificare straturi",editing_attributes:"Modificare atribute",relations:"Relații",edit_relation:"Modifică relația",back_to_relations:"Înapoi la Relații",no_relations_found:"Nu am găsit relații",relation_data:"Date relații",relation_already_added:"Relație adăugată deja",list_of_relations_feature:"Lista relații entitatea ",tooltip:{edit_layer:"Modifică strat"},toolbox:{title:"Modifică"},table:{edit:"Modifică entitate",copy:"Creează o copie",delete:"Elimină entitatea"},tools:{copy:"Copiază entitățile",pastefeaturesfromotherlayers:"Paste features from other layer",addpart:"Adaugă o parte la multiparte",deletepart:"Elimină partea din multiparte",merge:"Dizolvare entități",split:"Divizare Entitate",add_feature:"Adaugă entitate",delete_feature:"Eliminare entitate",move_feature:"Mută entitate",update_vertex:"Actualizează vertecșii entității",update_feature:"Actualizează atributul entității",update_multi_features:"Actualizează atributele entităților selectate",copyfeaturefromexternallayer:"Create Feature from added layer"},toolsoftool:{measure:"Arată măsurătorile",snap:"Acroșare strat",snapall:"Acroșare pe toate straturile"},steps:{help:{select_elements:"Selectează entități",select_element:"Selectează entitate",copy:"Creează o nouă copie a entităților selectate",merge:"Dizolvă entitățile",split:"Divizare Entitate",new:"Creează o entitate",edit_table:"Modifică entitățile tabelare",draw_new_feature:"Desenează entitate pe hartă",action_confirm:"Confirmă acțiunea",double_click_delete:"Selectează entitatea de eliminat din hartă",edit_feature_vertex:"Modifică sau adaugă un vertex la entitatea selectată",move:"Mută entitatea selectată",select_feature_to_relation:"Selectează entitate pentru relaționare",show_edit_feature_form:"Arată formularul entității pentru modificări",pick_feature:"Selectează entitățile de modificat din hartă",insert_attributes_feature:"Inserează atributele entității"}},workflow:{steps:{select:"Click pe entitate pentru a o selecta",draw_part:"Desenează o parte nouă",merge:"Selectează partea de dizolvat",selectSHIFT:"Selectează entități prin desen triunghi apăsând SHIFT",selectDrawBox:"Selectează entități desenând un dreptunghi prin două puncte opuse",selectDrawBoxAtLeast2Feature:"Selectează cel puțin 2 entități prin desenul unui dreptunghi",selectPoint:"Click pe entitate pentru selectare",selectPointSHIFT:"Selectează entități prin desen dreptunghi apăsând SHIFT (multientități) sau prin click pe entitate",selectMultiPointSHIFT:"Selectează entități prin desen dreptunghi apăsând SHIFT sau prin click pe entitate",selectMultiPointSHIFTAtLeast2Feature:"Selectează cel puțin 2 entități prin desen dreptunghi apăsând SHIFT sau prin click pe entitate",copyCTRL:"Copiază entitățile selectate folosint CTRL+C",selectStartVertex:"Selectează vertexul de start a entităților selectate",selectToPaste:"Selectează punctul unde să lipim entitățile selectate",draw_split_line:"Desenează o linie pentru a diviza entitatea selectată"},title:{steps:"Pași"},next:"Următorul"},messages:{featureslockbyotheruser:"Unele geometrii/înregistrări nu sunt editabile deoarece sunt editate de către alt utilizator",splitted:"Divizat",nosplittedfeature:"Entitate nedivizată",press_esc:"ESC pentru înapoi",online:"Înapoi ONLINE. Acum se pot salva schimbările",offline:"OFFLINE. Schimbările sunt salvate local",delete_feature:"Șterg entitatea selectată?",delete_feature_relations:"Dacă entitatea are relații care trimit la ea, acele relații devin orfane. Sugerăm să vă ocupați de acele elemente înainte să eliminați această entitate.",unlink_relation:"Dorești să eliminați legătura cu relația?",commit_feature:"Salvăm?",toolbox_has_relation:"acest strat face parte dintr-o relație",saved:"Datele sunt salvate",saved_local:"Datele s-au salvat local",loading_data:"Datele se încarcă.",saving:"Salvăm datele. Așteptați ...",constraints:{enable_editing:"Pentru a activa Modificare faceți zoom la \nScara de activare 1:"},pdf:"Previzualizarea documentului nu este disponibilă. Click aici ",commit:{header:"Lista cu toate modificările.",header_add:"<b>Adăugate</b> arată nr. de entități adăugate",header_update_delete:"<b>Modificate</b> și <b>Șterse</b> arată lista de id-uri de entități",add:"Adăugate(n. entități)",delete:"Eliminate(id)",update:"Modificate(id)"},loading_table_data:"Încărcăm tabelul de date ...",copy_and_paste_from_other_layer_mandatory_fields:"Înainte de a salva, este necesar să completați toate câmpurile obligatorii ale entități introduse",no_feature_selected:"Nicio feature selectată",select_min_2_features:"Select at least 2 features"},relation:{table:{info:"<div>Selectează relațiile pentru a face legătura cu entitatea curentă.</div>"},draw_new_feature:"Desenați o nouă feature",draw_or_copy:"sau",copy_feature_from_other_layer:"Copiați feature dintr-un alt layer"},form:{relations:{tooltips:{back_to_father:"Înapoi la modificările entității părinte",add_relation:"Creează și fă legătura unei relații noi",link_relation:"Leagă o relație de entitate",open_relation_tools:"Arată instrumentele pentru relații",unlink_relation:"Elimină legătura la relație"}},buttons:{save:"Inserați/Editați",save_and_back:"Salvează și dă înapoi",save_and_back_table:"Salvează și dă înapoi",cancel:"Ignorați modificările"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Select feature/s",edit_attributes:"Edit attributes of pasted features in multiple mode"},copyfeaturefromprojectlayer:{title:"Select a feature"}}}}},{}],22:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={close_editing_panel:{message:"To close editing form need to exit from editing layer"},errors:{no_layers:"Ett fel uppstod. Nivåerna kan inte redigeras.",some_layers:"Ett fel uppstod. Vissa nivåer kan inte redigeras."},search:"Sökning",editing_changes:"Editing Changes",editing_data:"Nivåerna redigeras",editing_attributes:"Attributen redigeras",relations:"Relationer",edit_relation:"Redigera relationen",back_to_relations:"Tillbaka till relationerna",no_relations_found:"Inga relationer hittades",relation_data:"Relationsuppgifter",relation_already_added:"Relationen har redan lagts till",list_of_relations_feature:"Lista på relationens egenskaper",tooltip:{edit_layer:"Redigera nivån"},toolbox:{title:"Redigera"},table:{edit:"Redigera egenskap",copy:"Skapa en kopia",delete:"Ta bort egenskap"},tools:{copy:"Kopiera egenskaper",pastefeaturesfromotherlayers:"Paste features from other layer",addpart:"Lägg till del",deletepart:"Ta bort del",merge:"Slå samman egenskaper",split:"Dela upp egenskap",add_feature:"Lägg till egenskap",delete_feature:"Ta bort egenskap",move_feature:"Flytta egenskap",update_vertex:"Uppdatera punktens egenskap",update_feature:"Uppdatera egenskap",update_multi_features:"Ändra attributen för de valda funktionerna",copyfeaturefromexternallayer:"Create Feature from added layer"},toolsoftool:{measure:"Show measure",snap:"Snap layer",snapall:"Snap to all layers"},steps:{help:{select_elements:"Välj egenskaper",select_element:"Välj egenskapalitse ominaisuus",copy:"Skapa kopia av valda egenskaper",merge:"Slå samman egenskaper",split:"Dela upp egenskap",new:"Skapa ny egenskap",edit_table:"Ändra egenskaper i tabellen",draw_new_feature:"Piirrä ominaisuus kartalle",action_confirm:"Godkänn funktionen",double_click_delete:"Välj funktionen som du vill ta bort på kartan",edit_feature_vertex:"Ändra punkten eller lägg till punkten till den valda egenskapen",move:"Flytta den valda egenskapen",select_feature_to_relation:"Välj relation",show_edit_feature_form:"Visa egenskapsformuläret för redigering av attribut",pick_feature:"Välj funktion på kartan för att ändras",insert_attributes_feature:"Lägg till egenskapens attribut"}},workflow:{steps:{select:"Välj egenskap",draw_part:"Rita ny del",merge:"Välj egenskap att slå samman",selectSHIFT:"Tryck SHIFT, om du vill välja objekt med hjälp av rektangel.",selectDrawBox:"Rita upp den rektangel inom vilken objekten väljs ",selectDrawBoxAtLeast2Feature:"Rita rektangeln inom vilken minst två objekt är markerade ",selectPoint:"Välj egenskap",selectPointSHIFT:"Tryck SHIFT, om du vill välja objekt med hjälp av rektangel, eller välj en enskild egenskap.",selectMultiPointSHIFT:"Tryck SHIFT, om du vill välja objekt med hjälp av rektangel, eller välj en enskild egenskap.",selectMultiPointSHIFTAtLeast2Feature:"Tryck på SKIFT för att välja minst två objekt med en rektangel eller välj en enda egenskap. ",copyCTRL:"CTRL+C, du kan kopiera valda egenskaper.",selectStartVertex:"Visa startpunkten för valda egenskaper.",selectToPaste:"Välj punkt till vilken de valda egenskaperna ska fogas.",draw_split_line:"Rita en linje enligt vilken den valda egenskapen ska uppdelas."},title:{steps:"Skeden"},next:"Nästa"},messages:{featureslockbyotheruser:"Jotkut geometriat/tietueet eivät ole muokattavissa, koska muut käyttäjät muokkaavat niitä",splitted:"Uppdelad",nosplittedfeature:"Egenskapen har inte delats upp",press_esc:"Tryck ESC för att gå tillbaka",online:"Förbindelsen har upprättats. Ändringar kan sparas i databasen.",offline:"Du är i offline-läge. Ändringarna sparas lokalt",delete_feature:"Vill du ta bort den valda egenskapen?",delete_feature_relations:"Om egenskapen saknar bindande relationer blir dessa relationer föräldralösa. Vi rekommenderar att du behandlar dessa relationer innan du lämnar programmet",unlink_relation:"Vill du ta bort relationen?",commit_feature:"Ska ändringarna sparas?",toolbox_has_relation:"detta lager är en del av en relation",saved:"Uppgifterna sparades",saved_local:"Uppgifterna sparades lokalt.",loading_data:"Uppgifterna laddas",saving:"Uppgifterna sparas. Vänta...",constraints:{enable_editing:"Zooma in för att börja använda redigeringsverktyg \nAktivering skala 1:"},pdf:"Förhandsgranskning av dokument är inte tillgänglig. Tryck här",commit:{header:"Följande lista visar alla ändringar.",header_add:"<b>Tillagda</b> visar antalet egenskaper som lagts till",header_update_delete:"<b>Redigerad</b> och <b>Borttagen</b> Visa en lista på egenskapernas id",add:"(n. egenskaper) har lagts till",delete:"Borttagen (id)",update:"Redigerad(id)"},loading_table_data:"Building Data Table. Please wait ...",copy_and_paste_from_other_layer_mandatory_fields:"It is necessary to fill in any mandatory fields on the features pasted before saving",no_feature_selected:"No feature selected",select_min_2_features:"Select at least 2 features"},relation:{table:{info:"<div>Välj relation för länkning till egenskap som ska redigeras.</div>"},draw_new_feature:"Draw new feature",draw_or_copy:"or",copy_feature_from_other_layer:"Copy feature from other layer"},form:{relations:{tooltips:{back_to_father:"Back to edit father",add_relation:"Skapa och länka ny relation",link_relation:"Foga relationen till denna egenskap",open_relation_tools:"Visa relationsverktyg",unlink_relation:"Ta bort relation"}},buttons:{save:"Infoga/Redigera",save_and_back:"Spara och gå tillbaka",save_and_back_table:"Spara och gå tillbaka",cancel:"Ignorera ändringar"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Select feature/s",edit_attributes:"Edit attributes of pasted features in multiple mode"},copyfeaturefromprojectlayer:{title:"Select a feature"}}}}},{}],23:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var e=e("./i18n"),e=(e=e)&&e.__esModule?e:{default:e};i.default={i18n:e.default}},{"./i18n":19}],24:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n=i.VM=new Vue;i.default={VM:n}},{}],25:[function(i,e,t){function l(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}var n=g3wsdk.core.utils,u=n.base,n=n.inherit,d=g3wsdk.gui.GUI,r=g3wsdk.gui.vue.FormComponent,c=i("./editingformservice");function a(){var n=this,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=(u(this,r),i("../services/editingservice")),o=r.context_inputs||null,s=r.layer.getId(),e=r.layer.getLayerEditingFormStructure(),t=o&&o.inputs&&o.inputs.features&&o.inputs.features[o.inputs.features.length-1];e&&t&&(t.isNew()?Promise.resolve():a.getLayersDependencyFeatures(s,{relations:r.layer.getRelations().getArray().filter(function(e){return s===e.getFather()&&a.getLayerById(e.getChild())&&"ONE"!==e.getType()}),feature:t,filterType:"fid"})).then(function(){o.formEventBus=n.getService().getEventBus();var t,e=new c(o).buildRelationComponents(),i=a.getFormComponentsById(s);0<i.length&&n.addFormComponents(i),0<e.length&&n.addFormComponents(e),n.getService().handleRelation=(t=l(function*(e){e=e.relation;d.setLoadingContent(!0),yield a.setLayerUniqueFieldValues(r.layer.getRelationById(e.name).getChild()),this.setCurrentComponentById(e.name),d.setLoadingContent(!1)}),function(e){return t.apply(this,arguments)})})}n(a,r),e.exports=a},{"../services/editingservice":42,"./editingformservice":26}],26:[function(r,e,t){var s=g3wsdk.gui.GUI,l=r("../components/FormRelation.vue");e.exports=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=r("../services/editingservice"),i=(this.state={relations:[]},e.inputs||{}),n=i.layer,i=i.features,a=(this._formEventBus=e.formEventBus||null,n.getId()),o=n.getRelations().getArray().filter(function(e){return"ONE"!==e.getType()&&e.getFather()===a}),o=t.getRelationsInEditing({layerId:a,relations:o,feature:i[i.length-1]});this.hasRelations=function(){return 0<o.length},this.buildRelationComponents=function(){var n=this,r=[];return o.forEach(function(e){var t=e.relation,i=e.relations,e=Vue.extend({mixins:[l],name:"relation_"+Date.now(),methods:{getService:function(){return n._relationsService}},data:function(){return{layerId:a,relation:t,relations:i,resourcesurl:s.getResourcesUrl(),formeventbus:n._formEventBus}}});r.push({title:"plugins.editing.edit_relation",name:t.name,id:t.id,header:!1,component:e})}),r}}},{"../components/FormRelation.vue":6,"../services/editingservice":42}],27:[function(e,t,i){function a(){this.execute=function(t,e,i){var n,r=void 0;e.forEach(function(e){r=e.feature,i&&r[a.Actions[r.getState()].opposite](),n=a.Actions[r.getState()].fnc,t[n](r)})}}Object.defineProperty(i,"__esModule",{value:!0}),a.Actions={add:{fnc:"addFeature",opposite:"delete"},delete:{fnc:"removeFeature",opposite:"add"},update:{fnc:"updateFeature",opposite:"update"}},i.default=new a},{}],28:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var i=t,n=[],r=!0,t=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!i||n.length!==i);r=!0);}catch(e){t=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(t)throw a}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=r(e("./changesmanager")),a=r(e("./sessionsregistry"));function r(e){return e&&e.__esModule?e:{default:e}}function s(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}var e=g3wsdk.core.utils,l=e.base,e=e.inherit,u=g3wsdk.core,d=u.ApplicationState,u=u.G3WObject,c=g3wsdk.core.layer.features,f=c.FeaturesStore,p=c.OlFeaturesStore,h=g3wsdk.core.layer.Layer;function g(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.setters={save:this._save,addFeature:this._addFeature,updateFeature:this._updateFeature,deleteFeature:this._deleteFeature,setFeatures:this._setFeatures,getFeatures:this._getFeatures},l(this),this._filter={bbox:null},this._allfeatures=!1,this._layer=e.layer,this._featuresstore=new(h.LayerTypes.TABLE===this._layer.getType()?f:p),this._started=!1,this._noteditablefileds=this._layer.getEditingNotEditableFields()||[]}e(g,u);c=g.prototype;c._canDoGetFeaturesRequest=function(){var e=((0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).filter||{}).bbox,t=e&&h.LayerTypes.VECTOR===this._layer.getType();return t&&null===this._filter.bbox?(this._filter.bbox=e,!0):!t||((t=ol.extent.containsExtent(this._filter.bbox,e))||(this._filter.bbox=ol.extent.extend(this._filter.bbox,e)),!t)},c.getEditingSource=function(){return this._featuresstore},c.getSource=function(){this._layer.getSource()},c._applyChanges=function(){n.default.execute(this._featuresstore,0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],!(1<arguments.length&&void 0!==arguments[1])||arguments[1])},c.setChanges=function(e,t){this._applyChanges(e,t)},c.getLayer=function(){return this._layer},c.setLayer=function(e){return this._layer=e},c.removeNotEditablePropriertiesFromFeature=function(t){this._noteditablefileds.forEach(function(e){return t.unset([e])})},c._cloneFeatures=function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).map(function(e){return e.clone()})},c._addFeaturesFromServer=function(){this._featuresstore.addFeatures(this._cloneFeatures(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]))},c._doGetFeaturesRequest=function(){return!(!d.online||this._allfeatures)&&this._canDoGetFeaturesRequest(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})},c._getFeatures=function(){var t=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=$.Deferred();return this._doGetFeaturesRequest(i)?this._layer.getFeatures(i).then(function(e){e.then(function(e){return t._addFeaturesFromServer(e),t._allfeatures=!i.filter,n.resolve(e)}).fail(n.reject)}).fail(n.reject):n.resolve(),n.promise()},c.revert=function(){var e=$.Deferred();return this._featuresstore.setFeatures(this._cloneFeatures(this._layer.readFeatures())),e.resolve(),e.promise()},c.rollback=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=$.Deferred();return this._applyChanges(e,!0),t.resolve(),t.promise()},c.applyChangesToNewRelationsAfterCommit=function(e){var t,i=void 0,n=void 0,r=void 0;for(t in e)i=this.getLayerById(t),(r=(n=this.getEditingLayer(t).getEditingSource()).readFeatures()).forEach(function(e){return e.clearState()}),i.getSource().setFeatures(r),i.applyCommitResponse({response:e[t],result:!0}),n.setFeatures(i.getSource().readFeatures())},c.setFieldValueToRelationField=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layerId,i=e.ids,i=void 0===i?[]:i,n=e.field,r=a.default.getSession(t).getEditor().getEditingSource();i.forEach(function(e){e=r.getFeatureById(e);e&&e.set(n.name,n.value)})},c.applyCommitResponse=function(){var e,a=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[];t&&t.result&&(e=t.response.new,t=t.response.new_lockids,e.forEach(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=e.clientid,r=e.id,e=e.properties,t=a._featuresstore.getFeatureById(n);t.setId(r),t.setProperties(e),i.forEach(function(e){Object.entries(e).forEach(function(e){var e=o(e,2),t=e[0],e=e[1],e=void 0===e?{}:e,i=e.fatherField.find(function(e){return a._layer.isPkField(e)});i&&a.setFieldValueToRelationField({layerId:t,ids:e.ids,field:e.childField[e.fatherField.indexOf(i)],values:[n,r]})})})}),(e=this.readEditingFeatures()).forEach(function(e){return e.clearState()}),this._layer.setFeatures([].concat(s(e))),this.addLockIds(t))},c.addLockIds=function(e){this._layer.getSource().addLockIds(e)},c.getLockIds=function(){return this._layer.getSource().getLockIds()},c.commit=function(r){var a=this,t=$.Deferred(),i=[];return r.add.length&&(i=Object.keys(r.relations).map(function(e){var t,i,n=a._layer.getRelations().getRelationByFatherChildren(a._layer.getId(),e);return t={},i=e,e={ids:[].concat(s(r.relations[e].add.map(function(e){return e.id})),s(r.relations[e].update.map(function(e){return e.id}))),fatherField:n.getFatherField(),childField:n.getChildField()},i in t?Object.defineProperty(t,i,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[i]=e,t})),this._layer.commit(r).then(function(e){e.then(function(e){a.applyCommitResponse(e,i),t.resolve(e)}).fail(function(e){return t.reject(e)})}).fail(function(e){return t.reject(e)}),t.promise()},c.start=function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=$.Deferred();return this.getFeatures(e).then(function(e){e.then(function(e){i.resolve(e),t._started=!0}).fail(i.reject)}).fail(i.reject),i.promise()},c._addFeature=function(e){this._featuresstore.addFeature(e)},c._deleteFeature=function(e){this._featuresstore.deleteFeature(e)},c._updateFeature=function(e){this._featuresstore.updateFeature(e)},c._setFeatures=function(){this._featuresstore.setFeatures(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[])},c.readFeatures=function(){return this._layer.readFeatures()},c.readEditingFeatures=function(){return this._featuresstore.readFeatures()},c.stop=function(){var t=this,i=$.Deferred();return this._layer.unlock().then(function(e){t.clear(),i.resolve(e)}).fail(i.reject),i.promise()},c._save=function(){this._layer.save()},c.isStarted=function(){return this._started},c.clear=function(){this._started=!1,this._filter.bbox=null,this._allfeatures=!1,this._featuresstore.clear(),this._layer.getFeaturesStore().clear(),this._layer.getType()===h.LayerTypes.VECTOR&&this._layer.resetEditingSource(this._featuresstore.getFeaturesCollection())},i.default=g},{"./changesmanager":27,"./sessionsregistry":31}],29:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n=g3wsdk.core.utils,r=n.base;function a(){this.id=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).id,r(this),this._maxSteps=10,this._states=[],this.state={commit:!1,undo:!1,redo:!1},this._current=null}(0,n.inherit)(a,g3wsdk.core.G3WObject);n=a.prototype;n.add=function(e,t){var i=this,n=$.Deferred();return null===this._current?this._states=[{id:e,items:t}]:(0<this._states.length&&this._current<this.getLastState().id&&(this._states=this._states.filter(function(e){return e.id<=i._current})),this._states.push({id:e,items:t})),this._current=e,this._setState(),n.resolve(e),n.promise()},n.getRelationStates=function(t){(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).clear;for(var e=[],i=0;i<this._states.length;i++){var n=this._states[i],r=n.items.filter(function(e){return(Array.isArray(e)?e[0]:e).layerId===t});0<r.length&&e.push({id:n.id,items:r})}return e},n.insertState=function(e){for(var t=e.id,i=this._states.length,n=0;n<this._states.length;n++){var r=this._states[n];if(r.id>t){i=n;break}if(r.id===t){i=-1;break}}-1<i&&(this._current<t&&(this._current=t),this._states.splice(i,0,e))},n.removeState=function(e){for(var t=void 0,i=0;i<this._states.length;i++)if(this._states[i].id===e){t=i;break}this._current===e&&(this._current=1<this._states.length?this._states[t-1].id:null),this._states.splice(t,1)},n.removeStates=function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=0;t<e.length;t++){var i=e[t];this.removeState(i)}},n.insertStates=function(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=0;t<e.length;t++)this.insertState(e[t]);this.canCommit()},n._setState=function(){this.canUndo(),this.canCommit(),this.canRedo()},n._checkItems=function(e,t){var i=this,n={own:[],dependencies:{}};return e.forEach(function(e){Array.isArray(e)&&(e=e[t]),(i.id===e.layerId?n:(n.dependencies[e.layerId]||(n.dependencies[e.layerId]={own:[],dependencies:{}}),n.dependencies[e.layerId])).own.push(e)}),n},n.undo=function(){var i=this,n=void 0;return this._current===this.getFirstState().id?(this._current=null,n=this._states[0].items):this._states.find(function(e,t){if(e.id===i._current)return n=i._states[t].items,i._current=i._states[t-1].id,!0}),n=this._checkItems(n,0),this._setState(),n},n.redo=function(){var i=this,n=void 0;return this._current?this._states.find(function(e,t){if(i._current===e.id)return i._current=i._states[t+1].id,n=i._states[t+1].items,!0}):(n=this._states[0].items,this._current=this._states[0].id),n=this._checkItems(n,1),this._setState(),n},n.setItemsFeatureIds=function(){var n=this;(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(e){var t=e.id,i=e.clientid;n._states.forEach(function(e){e.items.forEach(function(e){e=e.feature.getId()===i&&e.feature;e&&e.setId(t)})})})},n.clear=function(i){var n=this;i?this._states.forEach(function(e,t){-1!==i.indexOf(e.id)&&(n._current&&n._current===e.id()&&n.undo(),n._states.splice(t,1))}):this._clearAll()},n._clearAll=function(){this._states=[],this._current=null,this.state.commit=!1,this.state.redo=!1,this.state.undo=!1},n.getState=function(t){return this._states.find(function(e){return e.id===t})},n.getFirstState=function(){return this._states.length?this._states[0]:null},n.getLastState=function(){var e=this._states.length;return e?this._states[e-1]:null},n.getCurrentState=function(){var t=this,e=null;return e=this._current&&this._states.length?this._states.find(function(e){return t._current===e.id}):e},n.getCurrentStateIndex=function(){var i=this,n=null;return this._current&&this._states.length&&this._states.forEach(function(e,t){if(i._current===e.id)return n=t,!1}),n},n.canCommit=function(){var e,t=this.commit(),i=!1;for(e in t)var n=t[e],i=i||0<n.length;return this.state.commit=i,this.state.commit},n.canUndo=function(){var e=this._states.length-1-this.getCurrentStateIndex();return this.state.undo=null!==this._current&&this._maxSteps>e,this.state.undo},n.canRedo=function(){return this.state.redo=this.getLastState()&&this.getLastState().id!=this._current||null===this._current&&0<this._states.length,this.state.redo},n._getStatesToCommit=function(){var t=this;return this._states.filter(function(e){return e.id<=t._current})},n.commit=function(){var r={};return this._getStatesToCommit().forEach(function(e){e.items.forEach(function(i){var e,t,n=!0;Array.isArray(i)&&(i=i[1]),r[i.layerId]&&r[i.layerId].forEach(function(e,t){if(e.getUid()===i.feature.getUid())return i.feature.isNew()&&!e.isDeleted()&&i.feature.isUpdated()?((e=i.feature.clone()).add(),r[i.layerId][t]=e):i.feature.isNew()&&i.feature.isDeleted()?r[i.layerId].splice(t,1):(i.feature.isUpdated()||i.feature.isDeleted())&&(r[i.layerId][t]=i.feature),n=!1}),n&&(e=i.feature,t=i.layerId,!e.isNew()&&e.isAdded()||(r[t]||(r[t]=[]),r[t].push(e)))})}),r},i.default=a},{}],30:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f=r(e("./sessionsregistry")),n=r(e("./history"));function r(e){return e&&e.__esModule?e:{default:e}}var e=g3wsdk.core.utils,a=e.base,e=e.inherit,o=g3wsdk.core.G3WObject,s=g3wsdk.core.layer.Layer,l=g3wsdk.core.geoutils.Geometry.is3DGeometry;function u(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.setters={start:function(){return this._start(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})},getFeatures:function(){return this._getFeatures(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})},stop:function(){return this._stop()},saveChangesOnServer:function(e){}},a(this,e),this.state={id:e.id,started:!1,getfeatures:!1},this._editor=e.editor,this._history=new n.default({id:this.state.id}),this._temporarychanges=[],this.register()}e(u,o);e=u.prototype;e.getId=function(){return this.state.id},e.getLastHistoryState=function(){return this._history.getLastState()},e.getLastStateId=function(){return this._history.getLastState().id},e.deleteState=function(e){this._history.removeState(e)},e.register=function(){f.default.register(this)},e.unregister=function(){f.default.unregister(this.getId())},e._start=function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=$.Deferred();return this._editor.start(e).then(function(e){t.state.started=!0,i.resolve(e)}).fail(function(e){i.reject(e)}),i.promise()},e._getFeatures=function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=$.Deferred();return this._allfeatures?i.resolve([]):(this._allfeatures=!e.filter,this._editor.getFeatures(e).then(function(e){e.then(function(e){t.state.getfeatures=!0,i.resolve(e)}).fail(function(e){return i.reject(e)})})),i.promise()},e.isStarted=function(){return this.state.started},e.getEditor=function(){return this._editor},e.setEditor=function(e){this._editor=e},e.save=function(){var e,t=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=$.Deferred();return this._temporarychanges.length?(e=i.id||Date.now(),this._history.add(e,this._temporarychanges).then(function(){t._temporarychanges=[],n.resolve(e)})):n.resolve(null),n.promise()},e.updateTemporaryChanges=function(t){this._temporarychanges.forEach(function(e){return e.feature.setProperties(t.getProperties())})},e.pushAdd=function(e,t){var i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],n=e===this.getId()?this._editor:f.default.getSession(e).getEditor(),i=(i&&n.removeNotEditablePropriertiesFromFeature(t),t.clone());return this.push({layerId:e,feature:i.add()}),i},e.pushDelete=function(e,t){return this.push({layerId:e,feature:t.delete()}),t},e.pushUpdate=function(t,i,e){if(i.isNew()){var n,r=this._temporarychanges.findIndex(function(e){return t===e.layerId&&e.feature.getId()===i.getId()});if(-1!==r)return(n=i.clone()).add(),void(this._temporarychanges[r].feature=n)}this.push({layerId:t,feature:i.update()},{layerId:t,feature:e.update()})},e.removeChangesFromHistory=function(){this._history.removeStates(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[])},e.moveRelationStatesOwnSession=function(){var e,t={};for(e in this.getCommitItems().relations){var i=this._history.getRelationStates(e);f.default.getSession(e)._history.insertStates(i),t[e]=i.map(function(e){return e.id})}return t},e.push=function(e,t){this._temporarychanges.push(t?[t,e]:e)},e.revert=function(){var e=this,t=$.Deferred();return this._editor.revert().then(function(){e._history.clear(),t.resolve()}),t.promise()},e._filterChanges=function(){var t=this.getId(),i={own:[],dependencies:{}};return this._temporarychanges.forEach(function(e){e=Array.isArray(e)?e[0]:e;e.layerId===t?i.own.push(e):(i.dependencies[e.layerId]||(i.dependencies[e.layerId]=[]),i.dependencies[e.layerId].unshift(e))}),i},e.rollback=function(e){var i,n;return e?this._editor.rollback(e):(i=$.Deferred(),n=this._filterChanges(),this._editor.rollback(n.own).then(function(){var e,t=n.dependencies;for(e in t)f.default.getSession(e).rollback(t[e]);i.resolve(t)}),this._temporarychanges=[],i.promise())},e.rollbackDependecies=function(){var e=this;(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(t){var i=[];e._temporarychanges=e._temporarychanges.filter(function(e){if(e.layerId===t)return i.push(e),!1}),i.length&&f.default.getSession(t).rollback(i)})},e.undo=function(e){return e=e||this._history.undo(),this._editor.setChanges(e.own,!0),this._history.canCommit(),e.dependencies},e.redo=function(e){return e=e||this._history.redo(),this._editor.setChanges(e.own,!0),this._history.canCommit(),e.dependencies},e._serializeCommit=function(e){var t,i=this,n=this.getId(),a=void 0,o=void 0,r={add:[],update:[],delete:[],relations:{}};for(t in e){var s,l=!1,u=e[t],o=t!==n?(l=!0,s=(s=f.default.getSession(t))?s.getEditor().getLockIds():[],r.relations[t]={lockids:s,add:[],update:[],delete:[],relations:{}},r.relations[t]):r;u.forEach(function(e){a=e.getState();var t=new ol.format.GeoJSON;if("delete"===a)e.isNew()||o.delete.push(e.getId());else{var i,n=t.writeFeatureObject(e),r=e.getProperties();for(i in n.properties)n.properties[i]&&"object"===c(n.properties[i])&&n.properties[i].constructor===Object&&(n.properties[i]=n.properties[i].value),void 0===n.properties[i]&&r[i]&&(n.properties[i]=r[i]);o[e.isNew()?"add":e.getState()].push(n)}}),l&&0===o.add.length&&0===o.update.length&&0===o.delete.length&&delete r.relations[t]}var d=Object.keys(r.relations||{});return d.filter(function(t){return void 0===i._editor.getLayer().getRelations().getArray().find(function(e){return t===e.getChild()})}).map(function(e){return r.relations[f.default.getSession(e).getEditor().getLayer().getRelations().getArray().find(function(e){return-1!==d.indexOf(e.getFather())}).getFather()].relations[e]=r.relations[e],e}).forEach(function(e){return delete r.relations[e]}),r},e.getCommitItems=function(){return this._serializeCommit(this._history.commit())},e.set3DGeometryType=function(){var t,i=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=e.layerId,n=void 0===n?this.getId():n,r=e.commitItems,a=r.relations,e=MapLayersStoresRegistry.getLayerById(n).getEditingLayer();e&&s.LayerTypes.VECTOR===e.getType()&&(t=e.getGeometryType(),l(t))&&["add","update"].forEach(function(e){return r[e].forEach(function(e){return e.geometry.type=t})}),Object.keys(a).forEach(function(e){return i.set3DGeometryType({layerId:e,commitItems:a[e]})})},e.commit=function(){var r=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.ids,t=void 0===t?null:t,i=e.items,e=e.relations,e=void 0===e||e,a=$.Deferred(),o=void 0;return t?(o=this._history.commit(t),this._history.clear(t)):(o=i||this._serializeCommit(this._history.commit()),e||(o.relations={}),this._editor.commit(o).then(function(e){if(e&&e.result){var t,i=e.response.new_relations,n=void 0===i?{}:i;for(t in n)f.default.getSession(t).getEditor().applyCommitResponse({response:n[t],result:!0});r._history.clear(),r.saveChangesOnServer(o),a.resolve(o,e)}else a.reject(e)}).fail(function(e){return a.reject(e)})),a.promise()},e._canStop=function(){return this.state.started||this.state.getfeatures},e._stop=function(){var e=this,t=$.Deferred();return this._canStop()?this._editor.stop().then(function(){e.clear(),t.resolve()}).fail(function(e){return t.reject(e)}):t.resolve(),t.promise()},e.clear=function(){this._allfeatures=!1,this.state.started=!1,this.state.getfeatures=!1,this.clearHistory()},e.getHistory=function(){return this._history},e.clearHistory=function(){this._history.clear()},i.default=u},{"./history":29,"./sessionsregistry":31}],31:[function(e,t,i){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(i,"__esModule",{value:!0});(function(e,t,i){t&&n(e.prototype,t),i&&n(e,i)})(a,[{key:"register",value:function(e){var t=e.getId();this._sessions[t]=e}},{key:"unregister",value:function(e){delete this._sessions[e]}},{key:"getSession",value:function(e){return this._sessions[e]}},{key:"setSession",value:function(e,t){this._sessions[e]=t}},{key:"getSessions",value:function(){return this._sessions}},{key:"clear",value:function(){this._sessions={}}}]);var r=a;function a(){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this._sessions={}}i.default=new r},{}],32:[function(e,t,i){var n=c(e("./editing/editor")),r=c(e("./editing/changesmanager")),a=c(e("./editing/sessionsregistry")),o=c(e("./editing/session")),s=c(e("./workflow/task")),l=c(e("./workflow/step")),u=c(e("./workflow/flow")),d=c(e("./workflow/workflow")),e=c(e("./workflow/stack"));function c(e){return e&&e.__esModule?e:{default:e}}window.g3wsdk.core.editing||window.g3wsdk.core.workflow||window.g3wsdk.constant.DEFAULT_EDITING_CAPABILITIES||g3wsdk.version,window.g3wsdk.core.editing={Session:o.default,SessionsRegistry:a.default,Editor:n.default,ChangesManager:r.default},window.g3wsdk.constant.DEFAULT_EDITING_CAPABILITIES=["add_feature","change_feature","change_attr_feature","delete_feature"],window.g3wsdk.core.workflow={Task:s.default,Step:l.default,Flow:u.default,Workflow:d.default,WorkflowsStack:e.default}},{"./editing/changesmanager":27,"./editing/editor":28,"./editing/session":30,"./editing/sessionsregistry":31,"./workflow/flow":33,"./workflow/stack":35,"./workflow/step":36,"./workflow/task":37,"./workflow/workflow":38}],33:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var e=e("./queque"),s=(e=e)&&e.__esModule?e:{default:e};var e=g3wsdk.core.G3WObject,n=g3wsdk.core.utils,l=n.base;function r(){var t,i=[],n=0,r=null,a=void 0,o=void 0;this.queques={end:new s.default,micro:new s.default},this.start=function(e){return a=$.Deferred(),t=(o=e).getInputs(),r=e.getContext(),(i=e.getSteps())&&i.length&&this.runStep(i[0],t,r),a.promise()},this.runStep=function(e,t){var i=this,n=(o.setMessages({help:e.state.help}),this.queques.micro.getLength());e.run(t,r,this.queques).then(function(e){n&&i.queques.micro.run(),i.onDone(e)}).fail(function(e){return i.onError(e)})},this.onDone=function(e){++n===i.length?(n=0,a.resolve(e)):this.runStep(i[n],e)},this.onError=function(e){n=0,this.clearQueques(),a.reject(e)},this.stop=function(){var e=$.Deferred();return i[n].isRunning()&&i[n].stop(),this.clearQueques(),0<n?(n=0,e.reject()):e.resolve(),e.promise()},l(this)}(0,n.inherit)(r,e),r.prototype.clearQueques=function(){this.queques.micro.clear(),this.queques.end.clear()},i.default=r},{"./queque":34}],34:[function(e,t,i){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function r(){if(!(this instanceof r))throw new TypeError("Cannot call a class as a function");this.tasks=[]}Object.defineProperty(i,"__esModule",{value:!0}),function(e,t,i){t&&n(e.prototype,t),i&&n(e,i)}(r,[{key:"addTask",value:function(e){this.tasks.push(e)}},{key:"run",value:function(){for(var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this.tasks.length;)(e?this.tasks.pop():this.tasks.shift())()}},{key:"flush",value:function(){return this.tasks.splice(0)}},{key:"getLength",value:function(){return this.tasks.length}},{key:"clear",value:function(){this.run(),this.tasks=[]}}]),i.default=r},{}],35:[function(e,t,i){function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}Object.defineProperty(i,"__esModule",{value:!0});(function(e,t,i){t&&n(e.prototype,t),i&&n(e,i)})(a,[{key:"push",value:function(e){return-1===this._workflows.indexOf(e)?this._workflows.push(e)-1:this._workflows.indexOf(e)}},{key:"getParent",value:function(){var e=this._getCurrentIndex();return 0<e&&this._workflows[e-1]}},{key:"getParents",value:function(){var e=this._getCurrentIndex();return 0<e&&this._workflows.slice(0,e)}},{key:"pop",value:function(){return this._workflows.pop()}},{key:"getLength",value:function(){return this._workflows.length}},{key:"_getCurrentIndex",value:function(){var t=this.getCurrent();return this._workflows.findIndex(function(e){return e===t})}},{key:"getCurrent",value:function(){return this.getLast()}},{key:"getLast",value:function(){var e=this._workflows.length;return e?this._workflows[e-1]:null}},{key:"getFirst",value:function(){return this._workflows[0]}},{key:"removeAt",value:function(e){this._workflows.splice(e,1)}},{key:"getAt",value:function(e){return this._workflows[e]}},{key:"insertAt",value:function(e,t){this._workflows[e]=t}},{key:"clear",value:function(){for(;this._workflows.length;)this.pop().stop()}}]);var r=a;function a(){if(!(this instanceof a))throw new TypeError("Cannot call a class as a function");this._workflows=[]}i.default=new r},{}],36:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n=g3wsdk.core.G3WObject,r=g3wsdk.core.utils,o=r.base;function a(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(o(this),e.inputs),i=e.context,i=void 0===i?null:i,n=e.task,n=void 0===n?null:n,r=e.outputs,r=void 0===r?null:r,a=e.escKeyPressEventHandler;this._inputs=void 0===t?null:t,this._context=i,this._task=n,this._outputs=r,this.state={id:e.id||null,name:e.name||null,help:e.help||null,running:!1,error:null,message:e.message||null},a&&this.registerEscKeyEvent(a)}(0,r.inherit)(a,n);r=a.prototype;r.escKeyUpHandler=function(e){"Escape"===e.key&&e.data.callback({task:e.data.task})},r.unbindEscKeyUp=function(){$(document).unbind("keyup",this.escKeyUpHandler)},r.bindEscKeyUp=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){};$(document).on("keyup",{callback:e,task:this.getTask()},this.escKeyUpHandler)},r.registerEscKeyEvent=function(e){var t=this;this.on("run",function(){return t.bindEscKeyUp(e)}),this.on("stop",function(){return t.unbindEscKeyUp()})},r.run=function(e,t,i){var n=this,r=$.Deferred();if(this.emit("run",{inputs:e,context:t}),this._task)try{this.state.running=!0,this._task.setInputs(e),this._task.setContext(t),this._task.run(e,t,i).then(function(e){n.stop(),r.resolve(e)}).fail(function(e){n.stop(),r.reject(e)})}catch(e){this.state.error=e,this.state.error="Problem ..",this.stop(),r.reject(e)}return r.promise()},r.stop=function(){this._task.stop(this._inputs,this._context),this.state.running=!1,this.emit("stop"),this._task.setInputs(null),this._task.setContext(null)},r.revert=function(){this._task&&this._task.revert&&this._task.revert()},r.panic=function(){this._task&&this._task.panic&&this._task.panic()},r.getId=function(){return this.state.id},r.getName=function(){return this.state.name},r.getHelp=function(){return this.state.help},r.getError=function(){return this.state.error},r.getMessage=function(){return this.state.message},r.isRunning=function(){return this.state.running},r.setInputs=function(e){this._inputs=e},r.getInputs=function(){return this._inputs},r.setTask=function(e){this._task=e},r.getTask=function(){return this._task},r.setOutputs=function(e){this._outputs=e},r.getOutputs=function(){return this._outputs},a.MESSAGES={help:null},i.default=a},{}],37:[function(i,e,t){Object.defineProperty(t,"__esModule",{value:!0});var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var a=g3wsdk.core.G3WObject,o=g3wsdk.core.utils,s=o.base,o=o.inherit,l=g3wsdk.gui.GUI;function u(){s(this,0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}),this.state={usermessagesteps:{}}}o(u,a);o=u.prototype;o.setInputs=function(e){this.inputs=e},o.getInputs=function(){return this.inputs},o.setContext=function(e){return this.context=e},o.getContext=function(){return this.context},o.revert=function(){},o.panic=function(){},o.stop=function(){},o.run=function(){},o.setRoot=function(e){this.state.root=e},o.getUserMessageSteps=function(){return this.state.usermessagesteps},o.setUserMessageSteps=function(){this.state.usermessagesteps=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}},o.setUserMessageStepDone=function(e){e&&(this.state.usermessagesteps[e].done=!0)},t.default=u,t.EditingTask=function(){var e=n,t=u;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,i=n;if(t instanceof i)return(t=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e))).selectStyle=e.selectStyle,t._mapService=l.getService("map"),t.addInteraction=function(e){this._mapService.addInteraction(e)},t.removeInteraction=function(e){var t=this;setTimeout(function(){return t._mapService.removeInteraction(e)})},t;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t),r(n,[{key:"getEditingType",value:function(){return null}},{key:"registerPointerMoveCursor",value:function(){this._mapService.getMap().on("pointermove",this._pointerMoveCursor)}},{key:"unregisterPointerMoveCursor",value:function(){this._mapService.getMap().un("pointermove",this._pointerMoveCursor)}},{key:"_pointerMoveCursor",value:function(e){this.getTargetElement().style.cursor=this.forEachFeatureAtPixel(e.pixel,function(){return!0})?"pointer":""}},{key:"setSteps",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this._steps=e,this.setUserMessageSteps(e)}},{key:"getSteps",value:function(){return this._steps}},{key:"getMapService",value:function(){return this._mapService}},{key:"getMap",value:function(){return this._mapService.getMap()}},{key:"disableSidebar",value:function(){this._isContentChild||l.disableSideBar(!(0<arguments.length&&void 0!==arguments[0])||arguments[0])}},{key:"getEditingService",value:function(){return i("../../services/editingservice")}},{key:"fireEvent",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return this.getEditingService().fireEvent(e,t)}},{key:"run",value:function(e,t){}},{key:"stop",value:function(){}},{key:"saveSingle",value:function(e,t){var i=this;t.session.save().then(function(){return i.getEditingService().saveChange()})}},{key:"cancelSingle",value:function(e,t){t.session.rollback()}},{key:"setContextGetDefaultValue",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this.getContext().get_default_value=e}}]),n}()},{"../../services/editingservice":42}],38:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.EditingWorkflow=void 0;var r=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var l=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,n=arguments[t];for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},u=s(e("./flow")),a=s(e("./stack")),d=s(e("./step")),o=s(e("../../components/UserMessageSteps"));function s(e){return e&&e.__esModule?e:{default:e}}var c=g3wsdk.gui.GUI,e=g3wsdk.core.G3WObject,f=g3wsdk.core.utils,p=f.base,h=f.inherit,g=f.resolve,y=g3wsdk.core.geoutils.Geometry.isPointGeometryType,v=g3wsdk.core.layer.Layer;function _(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.type,t=void 0===t?null:t,i=e.inputs,i=void 0===i?null:i,n=e.context,n=void 0===n?null:n,r=e.flow,r=void 0===r?new u.default:r,a=e.steps,a=void 0===a?[]:a,o=e.runOnce,o=void 0!==o&&o,s=e.backbuttonlabel,s=void 0===s?null:s;p(this),this._type=t,this._options=e,this._promise=null,this._inputs=i,this._context=n,this._flow=r,this._steps=a,this._child=null,this._stackIndex=null,this.runOnce=o,this._messages=d.default.MESSAGES,this._userMessageSteps=this._steps.reduce(function(e,t){return l({},e,t.getTask().getUserMessageSteps()||{})},{}),this.backbuttonlabel=s}h(_,e);f=_.prototype;f.isType=function(e){var t=this;return Array.isArray(e)?Boolean(e.find(function(e){return e===t._type})):e===this._type},f.getContextService=function(){return this.getContext().service},f.setContextService=function(e){this.getContext().service=e},f.getStackIndex=function(){return this._stackIndex},f.addChild=function(e){this._child?this._child.addChild(e):this._child=e},f.removeChild=function(){this._child&&a.default.removeAt(this._child.getStackIndex()),this._child=null},f.setInput=function(e){var t=e.key,e=e.value;this._inputs[t]=e},f._setInputs=function(e){this._inputs=e},f.getInputs=function(){return this._inputs},f.setContext=function(e){this._context=e},f.getContext=function(){return this._context},f.getFlow=function(){return this._flow},f.setFlow=function(e){this._flow=e},f.addStep=function(e){this._steps.push(e)},f.setSteps=function(e){this._steps=e},f.getSteps=function(){return this._steps},f.getStep=function(e){return this._steps[e]},f.setMessages=function(e){Object.assign(this._messages,e)},f.getMessages=function(){return this._messages},f.clearMessages=function(){this._messages.help=null,this._isThereUserMessaggeSteps()&&this.clearUserMessagesSteps()},f.getLastStep=function(){return this._steps.length?this._steps[this._steps.length-1]:null},f.getRunningStep=function(){return this._steps.find(function(e){return e.isRunning()})},f._stopChild=function(){return this._child?this._child.stop():g()},f._isThereUserMessaggeSteps=function(){return Object.keys(this._userMessageSteps).length},f.reject=function(){this._promise&&this._promise.reject()},f.resolve=function(){this._promise&&this._promise.resolve()},f.start=function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=$.Deferred();this._promise=i,this._inputs=e.inputs,this._context=e.context||{};!this._context.isChild&&1&&a.default.getLength()&&a.default.getCurrent()!==this&&a.default.getCurrent().addChild(this),this._stackIndex=a.default.push(this),this._flow=e.flow||this._flow,this._steps=e.steps||this._steps;var n=this._isThereUserMessaggeSteps();return n&&c.showUserMessage({title:"plugins.editing.workflow.title.steps",type:"tool",position:"left",size:"small",closable:!1,hooks:{body:(0,o.default)({steps:this._userMessageSteps})}}),this._flow.start(this).then(function(e){n?setTimeout(function(){t.clearUserMessagesSteps(),i.resolve(e)},500):i.resolve(e)}).fail(function(e){n&&t.clearUserMessagesSteps(),i.reject(e)}).always(function(){t.runOnce&&t.stop()}),this.emit("start"),i.promise()},f.stop=function(){var e=this,t=$.Deferred();return this._promise=null,this._stopChild().always(function(){e.removeChild(),a.default.removeAt(e.getStackIndex()),e._flow.stop().then(t.resolve).fail(t.reject).always(function(){return e.clearMessages()})}),this.emit("stop"),t.promise()},f.clearUserMessagesSteps=function(){this._resetUserMessaggeStepsDone(),c.closeUserMessage()},f._resetUserMessaggeStepsDone=function(){var t=this;Object.keys(this._userMessageSteps).forEach(function(e){e=t._userMessageSteps[e];e.done=!1,e.buttonnext&&(e.buttonnext.disabled=!0)})},f.setBackButtonLabel=function(){this.backbuttonlabel=0<arguments.length&&void 0!==arguments[0]?arguments[0]:null},f.getBackButtonLabel=function(){return this.backbuttonlabel},i.default=_,i.EditingWorkflow=function(){var e=n,t=_;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this,i=n;if(t instanceof i)return(t=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(n.__proto__||Object.getPrototypeOf(n)).call(this,e))).helpMessage=e.helpMessage?{help:e.helpMessage}:null,t._toolsoftool=[],!0===e.registerEscKeyEvent&&t.registerEscKeyEvent(),t;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t),r(n,[{key:"addToolsOfTools",value:function(e){var i=this,t=e.step,e=e.tools,n=void 0===e?[]:e,r={snap:{type:"snap",options:{checkedAll:!1,checked:!1,active:!0,run:function(e){e=e.layer;this.active=!0,this.layerId=e.getId(),this.source=e.getEditingLayer().getSource()},stop:function(){this.active=!1}}},measure:{type:"measure",options:{checked:!1,run:function(){var e=this;setTimeout(function(){e.onChange(e.checked)})},stop:function(){t.getTask().removeMeasureInteraction()},onChange:function(e){this.checked=e,t.getTask()[e?"addMeasureInteraction":"removeMeasureInteraction"]()},onBeforeDestroy:function(){this.onChange(!1)}}}};t.on("run",function(e){var t=e.inputs;e.context;0===i._toolsoftool.length&&n.forEach(function(e){"measure"===e&&(v.LayerTypes.VECTOR!==t.layer.getType()||y(t.layer.getGeometryType()))||i._toolsoftool.push(r[e])}),i._toolsoftool.forEach(function(e){return e.options.run({layer:t.layer})}),i.emit("settoolsoftool",i._toolsoftool)}),t.on("stop",function(){i._toolsoftool.forEach(function(e){return e.options.stop()})})}},{key:"setHelpMessage",value:function(e){this.helpMessage={help:e}}},{key:"getHelpMessage",value:function(){return this.helpMessage}},{key:"getFeatures",value:function(){return this.getInputs().features}},{key:"startFromLastStep",value:function(e){return this.setSteps([this.getSteps().pop()]),this.start(e)}},{key:"getCurrentFeature",value:function(){var e=this.getFeatures();return e[e.length-1]}},{key:"getLayer",value:function(){return this.getInputs().layer}},{key:"getSession",value:function(){return this.getContext().session}},{key:"escKeyUpHandler",value:function(e){27===e.keyCode&&(e.data.workflow.reject(),e.data.callback())}},{key:"unbindEscKeyUp",value:function(){$(document).unbind("keyup",this.escKeyUpHandler)}},{key:"bindEscKeyUp",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){};$(document).on("keyup",{workflow:this,callback:e},this.escKeyUpHandler)}},{key:"registerEscKeyEvent",value:function(e){var t=this;this.on("start",function(){return t.bindEscKeyUp(e)}),this.on("stop",function(){return t.unbindEscKeyUp()})}}]),n}()},{"../../components/UserMessageSteps":14,"./flow":33,"./stack":35,"./step":36}],39:[function(e,t,i){e("./g3wsdk");var n=e("./config"),r=(n=n)&&n.__esModule?n:{default:n};function a(){var e=this,t=(o(this,{name:"editing",i18n:r.default.i18n,service:u,fontClasses:[{name:"measure",className:"fas fa-ruler-combined"},{name:"magnete",className:"fas fa-magnet"},{name:"clipboard",className:"fas fa-clipboard"}]}),{position:0,title:"EDITING"}),i={some_layers:!1};this.panel=null,this.service.loadPlugin()&&(this.setHookLoading({loading:!0}),this.service.once("ready",function(){e.registerPlugin(e.config.gid)&&(l.isready?e.setupGui():l.on("ready",e.setupGui.bind(e))),e.setHookLoading({loading:!1}),e.setApi(e.service.getApi()),e.setReady(!0)}),this.service.init(this.config)),this.setupGui=function(){if(!1===this.config.visible)return!1;this.config.name=this.config.name||"plugins.editing.editing_data",this.addToolGroup(t),this.addTools({action:this.showEditingPanel,offline:!1,icon:"pencil"},t)},this.showEditingPanel=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return 0<this.service.getLayers().length?(this.panel=new d(e),l.showPanel(this.panel),!i.some_layers&&this.service.getLayersInError()&&(l.showUserMessage({type:"warning",message:"plugins.editing.errors.some_layers",closable:!0}),i.some_layers=!0)):l.showUserMessage({type:"alert",message:"plugins.editing.errors.no_layers"}),this.panel},this.hideEditingPanel=function(){null!==this.panel&&(l.closePanel(),this.panel=null)},this.unload=function(){this.hideEditingPanel(),this.config.visible&&this.removeTools(),this.service.clear()}}var n=g3wsdk.core.utils,o=n.base,n=n.inherit,s=g3wsdk.core.plugin.Plugin,l=g3wsdk.gui.GUI,u=e("./services/editingservice"),d=e("./panel");n(a,s),new a},{"./config":23,"./g3wsdk":32,"./panel":41,"./services/editingservice":42}],40:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});function n(e,t,i,n){this.type=e,this.features=n,this.coordinate=t,this.layer=i}var r="picked",i=i.PickFeaturesInteraction=function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};ol.interaction.Pointer.call(this,{handleDownEvent:e.handleDownEvent_,handleUpEvent:e.handleUpEvent_,handleMoveEvent:e.handleMoveEvent_}),this.layer=t.layer,this.pickedFeatures=[]};ol.inherits(i,ol.interaction.Pointer),i.handleDownEvent_=function(e){return this.pickedFeatures=this.featuresAtPixel(e),this.pickedFeatures},i.handleUpEvent_=function(e){return this.pickedFeatures&&this.pickedFeatures.length&&this.dispatchEvent(new n(r,e.coordinate,this.layer,this.pickedFeatures)),!0},i.prototype.featuresAtPixel=function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=e.pixel;return e.map.getFeaturesAtPixel(i,{layerFilter:function(e){return e===t.layer},hitTolerance:isMobile&&isMobile.any?10:0})},i.handleMoveEvent_=function(e){var t=e.map.getTargetElement(),e=this.featuresAtPixel(e);t.style.cursor=e?"pointer":""},i.prototype.shouldStopEvent=function(){return!1},i.prototype.setMap=function(e){e||(this.getMap().getTargetElement().style.cursor=""),ol.interaction.Pointer.prototype.setMap.call(this,e)}},{}],41:[function(e,t,i){var n=e("./components/Editing.vue"),r=(n=n)&&n.__esModule?n:{default:n};var n=g3wsdk.core.utils,a=n.base,o=n.inherit,s=n.merge,l=g3wsdk.gui.GUI,n=g3wsdk.gui.vue.Component,u=e("./services/editingservice");function d(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=(t.id="editing-panel",t.title=t.title||"plugins.editing.editing_data",t.name="Editing Layer",t.toolboxes=t.toolboxes||null,t.showcommitbar=void 0===t.showcommitbar||t.showcommitbar,a(this,t),this.vueComponent=r.default,this.name=void 0!==t.name?t.name:"Editing data",s(this,t),this._resourcesUrl=t.resourcesUrl||l.getResourcesUrl(),this._service=t.service||u,Vue.extend(this.vueComponent));this.internalComponent=new i({service:this._service,data:function(){return{state:e._service.state,resourcesurl:e._resourcesUrl,showcommitbar:t.showcommitbar,editingButtonsEnabled:!0}}}),this.mount=function(e){return a(this,"mount",e,!0)},this.unmount=function(){var e=this,t=$.Deferred();return this._service.stop().finally(function(){e.unmount=function(){a(this,"unmount").then(function(){return t.resolve()})},e.unmount()}),t.promise()}}o(d,n),t.exports=d},{"./components/Editing.vue":5,"./services/editingservice":42}],42:[function(e,t,r){var c=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,n=arguments[t];for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},f=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var p=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var i=t,n=[],r=!0,t=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!i||n.length!==i);r=!0);}catch(e){t=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(t)throw a}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},h=e("../g3wsdk/workflow/workflow"),g=e("../utils/promisify"),y=e("../workflows");function v(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function m(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}Object.entries({EditingWorkflow:h.EditingWorkflow,OpenFormStep:y.OpenFormStep,ConfirmStep:y.ConfirmStep}).forEach(function(e){e=p(e,2);e[0],e[1]});var b=g3wsdk.constant.G3W_FID,i=g3wsdk.core,w=i.ApplicationState,k=i.ApplicationService,F=g3wsdk.core.data.DataRouterService,i=g3wsdk.core.utils,S=i.XHR,x=i.noop,E=g3wsdk.core.geometry.Geometry,i=g3wsdk.core.geoutils,I=i.getFeaturesFromResponseVectorApi,T=i.isSameBaseGeometryType,C=g3wsdk.core.workflow.WorkflowsStack,L=g3wsdk.core.plugin.PluginService,P=g3wsdk.core.editing.SessionsRegistry,O=g3wsdk.core.catalog.CatalogLayersStoresRegistry,M=g3wsdk.core.map.MapLayersStoreRegistry,i=g3wsdk.core.layer,A=i.Layer,R=i.LayersStore,j=g3wsdk.core.layer.features.Feature,D=g3wsdk.gui.GUI,B=g3wsdk.core.errors.parsers.Server,V=g3wsdk.core.i18n.tPlugin,i=g3wsdk.ol.utils,U=i.getScaleFromResolution,G=i.getResolutionFromScale,q=e("../toolboxes/toolbox"),z="mapcontrol:toggled",N={CHANGES:"EDITING_CHANGES"};t.exports=new(function(){var t,i,e,n,r,a,o,s,l=d,u=L;if("function"!=typeof u&&null!==u)throw new TypeError("Super expression must either be null or a function, not "+typeof u);function d(){var t;if(this instanceof d)return(t=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(d.__proto__||Object.getPrototypeOf(d)).call(this))).EDITING_FIELDS_TYPE=["unique"],t._sessions={},t.constraints={},t._vectorUrl,t._projectType,t._unByKeys=[],t.setterKeys=[],t._events={layer:{start_editing:{before:{},after:{}}}},t.layersUniqueFieldsValues={},t.saveConfig={mode:"default",modal:!1,messages:void 0,cb:{done:void 0,error:void 0}},t.applicationEditingConstraints={toolboxes:{},showToolboxesExcluded:!0},t.state={open:!1,toolboxes:[],toolboxselected:null,toolboxidactivetool:null,showselectlayers:!0,message:null,relations:[]},t.loadLayersFeaturesToResultWhenCloseEditing={},t._layers_in_error=!1,t._mapService=D.getService("map"),t.mapControlToggleEventHandler=function(e){e.target.isToggled()&&e.target.isClickMap()&&t.state.toolboxselected&&t.state.toolboxselected.getActiveTool()&&t.state.toolboxselected.stopActiveTool()},t._mapService.on(z,t.mapControlToggleEventHandler),t._formComponents={},t._subscribers={},t;throw new TypeError("Cannot call a class as a function")}return l.prototype=Object.create(u&&u.prototype,{constructor:{value:l,enumerable:!1,writable:!0,configurable:!0}}),u&&(Object.setPrototypeOf?Object.setPrototypeOf(l,u):l.__proto__=u),f(d,[{key:"init",value:function(){var i=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=(this._vectorUrl=e.vectorurl,this._projectType=e.project_type,this._layersstore=new R({id:"editing",queryable:!1}),M.addLayersStore(this._layersstore),this.config=e,this._editableLayers={},this._toolboxes=[],this.state.toolboxes=[],this._getEditableLayersFromCatalog()),t=[],n=!0,r=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value;t.push(l.getLayerForEditing({vectorurl:this._vectorUrl,project_type:this._projectType}))}}catch(e){r=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw a}}Promise.allSettled(t).then(function(e){e.forEach(function(e){var t;"fulfilled"===e.status?(t=e.value.getId(),i._editableLayers[t]=e.value,i._attachLayerWidgetsEvent(e.value),i._sessions[t]=null):i._layers_in_error=!0}),i._ready()})}},{key:"_ready",value:function(){this.setRelations1_1FieldsEditable(),this.setLayersColor(),this._layersstore.addLayers(this.getLayers());var e=!0,t=!1,i=void 0;try{for(var n,r=this.getLayers()[Symbol.iterator]();!(e=(n=r.next()).done);e=!0){var a=n.value;this.addToolBox(q.create(a))}}catch(e){t=!0,i=e}finally{try{!e&&r.return&&r.return()}finally{if(t)throw i}}this._createToolBoxDependencies(),this.setApi({api:{getSession:this.getSession.bind(this),getFeature:this.getFeature.bind(this),subscribe:this.subscribe.bind(this),unsubscribe:this.unsubscribe.bind(this),getToolBoxById:this.getToolBoxById.bind(this),setSaveConfig:this.setSaveConfig.bind(this),addNewFeature:this.addNewFeature.bind(this),addFormComponents:this.addFormComponents.bind(this),commitChanges:this.commit.bind(this),setApplicationEditingConstraints:this.setApplicationEditingConstraints.bind(this),getMapService:this.getMapService.bind(this),updateLayerFeature:x,deleteLayerFeature:x,addLayerFeature:this.addLayerFeature.bind(this),showPanel:this.showPanel.bind(this),hidePanel:this.hidePanel.bind(this),resetDefault:this.resetAPIDefault.bind(this),startEditing:this.startEditing.bind(this),stopEditing:this.stopEditing.bind(this)}}),this.registerResultEditingAction(),this.emit("ready")}},{key:"getAppState",value:function(){return w}},{key:"getFormComponentsById",value:function(e){return this._formComponents[e]||[]}},{key:"getFormComponents",value:function(){return this._formComponents}},{key:"addFormComponents",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layerId,e=e.components,i=void 0===e?[]:e;this._formComponents[t]||(this._formComponents[t]=[]);for(var n=0;n<i.length;n++)this._formComponents[t].push(i[n])}},{key:"getSession",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).layerId;return this.getToolBoxById(e).getSession()}},{key:"getFeature",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).layerId;return this.getToolBoxById(e).getActiveTool().getFeature()}},{key:"subscribe",value:function(e,t){return this._subscribers[e]||(this._subscribers[e]=[]),this._subscribers[e].find(function(e){return e===t})||this._subscribers[e].push(t),t}},{key:"unsubscribe",value:function(e,t){this._subscribers[e]=this._subscribers[e].filter(function(e){return e!==t})}},{key:"setRelations1_1FieldsEditable",value:function(){var n=this;this.getLayers().forEach(function(e){var i=e.getId();n.getRelation1_1ByLayerId(i).forEach(function(e){var t;i===e.getFather()&&(t=void 0!==n.getLayerById(e.getChild()),n.getRelation1_1EditingLayerFieldsReferredToChildRelation(e).forEach(function(e){e.editable=e.editable&&t}))})})}},{key:"getRelation1_1EditingLayerFieldsReferredToChildRelation",value:function(t){return this.getLayerById(t.getFather()).getEditingFields().filter(function(e){return e.vectorjoin_id&&e.vectorjoin_id===t.getId()})}},{key:"getRelation1_1ByLayerId",value:function(e){return O.getLayerById(e).getRelations().getArray().filter(function(e){return"ONE"===e.getType()})}},{key:"setShowSelectLayers",value:function(){this.state.showselectlayers=!(0<arguments.length&&void 0!==arguments[0])||arguments[0]}},{key:"registerResultEditingAction",value:function(){var i=this,e=D.getService("queryresults");this.setterKeys.push({setter:"editFeature",key:e.onafter("editFeature",function(e){var t=e.layer,e=e.feature;i.editResultLayerFeature({layer:t,feature:e})})})}},{key:"unregisterResultEditingAction",value:function(){var i=D.getService("queryresults");this.setterKeys.forEach(function(e){var t=e.setter,e=e.key;return i.un(t,e)})}},{key:"editResultLayerFeature",value:(s=m(function*(){var n=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layer,e=e.feature,i=e.attributes[b],r=(this.getToolBoxes().forEach(function(e){return e.setShow(e.getId()===t.id)}),this.getPlugin().showEditingPanel(),this.getToolBoxById(t.id)),a=r.getEditingConstraints().scale,e=e.geometry&&void 0!==a,o=void 0;try{yield(0,g.promisify)(r.start({filter:{fids:i}}));var s,l,u=r.getLayer(),d=u.getEditingLayer().getSource(),c=(u.getType()===A.LayerTypes.VECTOR?d.getFeatures():d.readFeatures()).find(function(e){return e.getId()==i});c&&((s=c.getGeometry())&&this._mapService.zoomToGeometry(s),s&&e&&this._mapService.getMap().once("moveend",function(){var e=n._mapService.getMapUnits(),t=n._mapService.getMap(),i=parseInt(U(t.getView().getResolution(),e));a<i&&t.getView().setResolution(G(a,e)),r.setSelected(!0)}),s&&!e&&r.setSelected(!0),s||r.setSelected(!0),o=r.getSession(),this.setSelectedToolbox(r),l=new h.EditingWorkflow({type:"editnopickmapfeatureattributes",helpMessage:"editing.tools.update_feature",steps:[new y.OpenFormStep],runOnce:!0}),yield(0,g.promisify)(l.start({inputs:{layer:u,features:[c]},context:{session:o}})),yield(0,g.promisify)(o.save()),this.saveChange())}catch(e){o&&o.rollback()}}),function(){return s.apply(this,arguments)})},{key:"disableMapControlsConflict",value:function(){this._mapService.disableClickMapControls(!(0<arguments.length&&void 0!==arguments[0])||arguments[0])}},{key:"setSelectedToolbox",value:function(e){this.state.toolboxselected=e}},{key:"getToolboxSelected",value:function(){return this.state.toolboxselected}},{key:"addNewFeature",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=new j,t=(t.geometry&&i.setGeometry(new ol.geom[t.geometry.type](t.geometry.coordinates)),i.setProperties(t.properties),i.setTemporaryId(),this.getToolBoxById(e)),n=t.getLayer().getEditingLayer(),t=t.getSession();return n.getSource().addFeature(i),t.pushAdd(e,i,!1),i}},{key:"getLayersInError",value:function(){return this._layers_in_error}},{key:"getMapService",value:function(){return this._mapService}},{key:"_initOffLineItems",value:function(){for(var e in N)this.getOfflineItem(N[e])||k.setOfflineItem(N[e])}},{key:"_handleOfflineChangesBeforeSave",value:function(e){function t(e){var i=e.layerId,n=e.current,e=e.previous;n[i].add=[].concat(v(e[i].add),v(n[i].add)),n[i].delete=[].concat(v(e[i].delete),v(n[i].delete)),e[i].update.forEach(function(e){var t=e.id;n[i].update.find(function(e){return e.id===t})||n[i].update.unshift(e)}),(e[i].lockids||[]).forEach(function(e){var t=e.featureid;n[i].lockids.find(function(e){return e.featureid===t})||n[i].update.unshift(e)})}var i,n=k.getOfflineItem(N.CHANGES);for(i in n){var r,a=e[i]?e:e[Object.keys(e)[0]].relations[i]?e[Object.keys(e)[0]].relations:null;a?t({layerId:i,current:a,previous:n}):(a=Object.keys(e)[0],(r=Object.keys(n[i].relations)).length?-1!==r.indexOf(a)&&(t({layerId:a,current:e,previous:n[i].relations}),n[i].relations[a]=e[a],e=n):e[i]=n[i])}return e}},{key:"saveOfflineItem",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.id,e=e.data;return t===N.CHANGES&&(e=this._handleOfflineChangesBeforeSave(e)),k.setOfflineItem(t,e)}},{key:"setOfflineItem",value:function(e,t){k.setOfflineItem(e,t)}},{key:"getOfflineItem",value:function(e){return k.getOfflineItem(e)}},{key:"checkOfflineChanges",value:function(){var s=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.modal,l=void 0===t||t,t=e.unlock,u=void 0!==t&&t;return new Promise(function(i,n){var r,a,o=k.getOfflineItem(N.CHANGES);o&&(r=[],a=[],setTimeout(function(){for(var e in o){a.push(e);var t=s.getToolBoxById(e),e=o[e];r.push(s.commit({toolbox:t,commitItems:e,modal:l}))}$.when.apply(s,r).then(function(){return i()}).fail(function(e){return n(e)}).always(function(){u&&a.forEach(function(e){s.getLayerById(e).unlock()}),s.setOfflineItem(N.CHANGES)})},1e3))})}},{key:"registerOnLineOffLineEvent",value:function(){var e=this,t=(w.online&&this.checkOfflineChanges({unlock:!0}),k.onafter("offline",function(){})),i=k.onafter("online",function(){e.checkOfflineChanges({modal:!1}).then(function(){}).catch(function(e){return D.notify.error(e)})});this._unByKeys.push({owner:k,setter:"offline",key:t}),this._unByKeys.push({owner:k,setter:"online",key:i})}},{key:"unregisterOnLineOffLineEvent",value:function(){this.unregisterSettersEvents(["online","offline"])}},{key:"unregisterSettersEvents",value:function(){this._unByKeys.forEach(function(e){var t=e.owner,i=e.setter,e=e.key;t.un(i,e)})}},{key:"fireEvent",value:function(i){var n=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(e){n._subscribers[i]&&n._subscribers[i].forEach(function(e){var t=e(r);t&&t.once&&n.unsubscribe(i,e)}),e()})}},{key:"activeQueryInfo",value:function(){this._mapService.activeMapControl("query")}},{key:"setLayersColor",value:function(){var e=["#C43C39","#d95f02","#91522D","#7F9801","#0B2637","#8D5A99","#85B66F","#8D2307","#2B83BA","#7D8B8F","#E8718D","#1E434C","#9B4F07","#1b9e77","#FF9E17","#7570b3","#204B24","#9795A3","#C94F44","#7B9F35","#373276","#882D61","#AA9039","#F38F3A","#712333","#3B3A73","#9E5165","#A51E22","#261326","#e4572e","#29335c","#f3a712","#669bbc","#eb6841","#4f372d","#cc2a36","#00a0b0","#00b159","#f37735","#ffc425"],t=!0,i=!1,n=void 0;try{for(var r,a=this.getLayers()[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var o=r.value;o.getColor()||o.setColor(e.splice(0,1)[0])}}catch(e){i=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw n}}}},{key:"_layerChildrenRelationInEditing",value:function(e){var t=this;return e.getChildren().filter(function(e){return t.getLayerById(e)})}},{key:"undo",value:function(){var e=this.state.toolboxselected.getSession(),t=e.getId(),i=e.getLastHistoryState().items,t=(this.undoRedoLayerUniqueFieldValues({layerId:t,sessionItems:i,action:"undo"}),e.undo());this.undoRedoRelationUniqueFieldValues({relationSessionItems:t,action:"undo"}),this.undoRelations(t)}},{key:"undoRelations",value:function(e){var i=this;Object.entries(e).forEach(function(e){var e=p(e,2),t=e[0],e=e[1];i.getToolBoxById(t).getSession().undo(e)})}},{key:"rollbackRelations",value:function(e){var i=this;Object.entries(e).forEach(function(e){var e=p(e,2),t=e[0],e=e[1];i.getToolBoxById(t).getSession().rollback(e)})}},{key:"redo",value:function(){var e=this.state.toolboxselected.getSession(),t=e.getId(),i=e.getLastHistoryState().items,t=(this.undoRedoLayerUniqueFieldValues({layerId:t,sessionItems:i,action:"redo"}),e.redo());this.undoRedoRelationUniqueFieldValues({relationSessionItems:t,action:"redo"}),this.redoRelations(t)}},{key:"redoRelations",value:function(e){var i=this;Object.entries(e).forEach(function(e){var e=p(e,2),t=e[0],e=e[1];i.getToolBoxById(t).getSession().redo(e)})}},{key:"getEditingLayer",value:function(e){return this._editableLayers[e].getEditingLayer()}},{key:"addToolBox",value:function(e){this._toolboxes.push(e),this._sessions[e.getId()]=e.getSession(),this.state.toolboxes.push(e.state)}},{key:"setOpenEditingPanel",value:function(t){this.state.open=t,this._getEditableLayersFromCatalog().forEach(function(e){return e.setInEditing(t)})}},{key:"addEvent",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.type,i=e.id,e=e.fnc;this._events[t]||(this._events[t]={}),this._events[t][i]||(this._events[t][i]=[]),this._events[t][i].push(e)}},{key:"addEvents",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=e.types,i=void 0===i?[]:i,n=e.id,r=e.fnc;i.forEach(function(e){return t.addEvent({type:e,id:n,fnc:r})})}},{key:"runEventHandler",value:(o=m(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.type,e=e.id;yield this._events[t]&&this._events[t][e]&&Promise.allSettled(this._events[t][e].map(function(e){return e()}))}),function(){return o.apply(this,arguments)})},{key:"setSaveConfig",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.mode,i=e.cb,i=void 0===i?{}:i,n=e.modal,n=void 0!==n&&n,e=e.messages;this.saveConfig.mode=void 0===t?"default":t,this.saveConfig.modal=n,this.saveConfig.messages=e,this.saveConfig.cb=c({},this.saveConfig.cb,i)}},{key:"getSaveConfig",value:function(){return this.saveConfig}},{key:"resetDefault",value:function(){this.saveConfig={mode:"default",modal:!1,messages:null,cb:{done:null,error:null}},this.disableMapControlsConflict(!1)}},{key:"resetAPIDefault",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.plugin,t=void 0===t||t,e=e.toolboxes;void 0!==e&&!e||this.getToolBoxes().forEach(function(e){e.resetDefault()}),t&&this.resetDefault()}},{key:"_attachLayerWidgetsEvent",value:function(c){for(var n=this,f=c.getEditingFields(),e=0;e<f.length;e++)!function(e){var r,a,t,i,o,s,l,u,d=f[e];!d.input||"select_autocomplete"!==d.input.type||d.input.options.filter_expression||(e=d.input.options,r=e.key,e.values,a=e.value,t=e.usecompleter,i=e.layer_id,o=e.loading,e.relation_id,s=e.relation_reference,e=e.filter_fields,l=void 0===e?[]:e,u=n,t)||n.addEvents({types:["start-editing","show-relation-editing"],id:c.getId(),fnc:function(){return new Promise(function(n,t){var e;o.state="loading",d.input.options.values=[],s&&(-1<[void 0,null].indexOf(l)||0===l.length)?c.getFilterData({fformatter:d.name}).then(function(e){e&&e.data&&(e.data.forEach(function(e){var e=p(e,2),t=e[0],e=e[1];d.input.options.values.push({key:e,value:t})}),o.state="ready",u.fireEvent("autocomplete",{field:d,data:[e.data]}),n(d.input.options.values))}).catch(function(e){o.state="error",t(e)}):i?(e=O.getLayerById(i))&&e.getDataTable({ordering:r}).then(function(e){if(e&&e.features){for(var t=e.features,i=0;i<t.length;i++)d.input.options.values.push({key:t[i].properties[r],value:t[i].properties[a]});o.state="ready",u.fireEvent("autocomplete",{field:d,features:t}),n(d.input.options.values)}}).fail(function(e){o.state="error",t(e)}):(e=[],o.state="ready",u.fireEvent("autocomplete",{field:d,features:e}),n(e))})}})}(e)}},{key:"_createToolBoxDependencies",value:function(){var a=this;this._toolboxes.forEach(function(e){var t=e.getLayer();if(e.setFather(t.isFather()),e.state.editing.dependencies=a._getToolBoxEditingDependencies(t),t.isFather()&&e.hasDependencies()){var i,n=t.getRelations().getRelations();for(i in n){var r=n[i];e.addRelation(r)}}})}},{key:"isFieldRequired",value:function(e,t){return this.getLayerById(e).isFieldRequired(t)}},{key:"_getToolBoxEditingDependencies",value:function(e){var t=this;return[].concat(v(e.getChildren()),v(e.getFathers())).filter(function(e){return void 0!==t.getLayerById(e)})}},{key:"_hasEditingDependencies",value:function(e){return 0<this._getToolBoxEditingDependencies(e).length}},{key:"handleToolboxDependencies",value:function(e){var t=this;e.isFather()&&this.getLayersDependencyFeatures(e.getId()),e.getDependencies().forEach(function(e){t.getToolBoxById(e).setEditing(!1)})}},{key:"_getEditableLayersFromCatalog",value:function(){return O.getLayers({EDITABLE:!0})}},{key:"getLayers",value:function(){return Object.values(this._editableLayers)}},{key:"getCurrentWorkflow",value:function(){return C.getCurrent()}},{key:"getCurrentWorkflowData",value:function(){var e=C.getCurrent();return{session:e.getSession(),inputs:e.getInputs(),context:e.getContext(),feature:e.getCurrentFeature(),layer:e.getLayer()}}},{key:"getRelationsAttributesByFeature",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layerId,i=e.relation,e=e.feature,n=this.getToolBoxById(t).getLayer();return this.getRelationsByFeature({layerId:t,relation:i,feature:e}).map(function(e){return{fields:n.getFieldsWithValues(e,{relation:!0}),id:e.getId()}})}},{key:"_getRelationLayerId",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layerId,e=e.relation,i=e.getChild?e.getChild():e.child,e=e.getFatherField?e.getFatherField():e.fatherField;return i===t?e:i}},{key:"getRelationsByFeature",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layerId,i=e.relation,n=e.feature,r=this.getLayerById(i.getFather?i.getFather():i.father),e=this._getRelationFieldsFromRelation({layerId:t,relation:i}),a=e.ownField,o=e.relationField.map(function(e){return n.isNew()&&r.isPkField(e)?n.getId():n.get(e)});return this._getFeaturesByLayerId(t).filter(function(i){return a.every(function(e,t){return i.get(e)==o[t]})})}},{key:"registerLeavePage",value:function(e){k.registerLeavePage({bool:e})}},{key:"loadPlugin",value:function(){return this._load=!!this._getEditableLayersFromCatalog().length}},{key:"getLayerById",value:function(e){return this._editableLayers[e]}},{key:"beforeEditingStart",value:function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).layer;this._checkLayerWidgets(e)}},{key:"afterEditingStart",value:function(){(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).layer}},{key:"getToolBoxById",value:function(t){return this._toolboxes.find(function(e){return e.getId()===t})}},{key:"getSessionById",value:function(e){return this._sessions[e]}},{key:"setApplicationEditingConstraints",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{showToolboxesExcluded:!0,toolboxes:{}},i=(this.applicationEditingConstraints=c({},this.applicationEditingConstraints,e),e.toolboxes),e=e.showToolboxesExcluded,n=Object.keys(i);!1===e&&this.state.toolboxes.forEach(function(e){return e.show=-1!==n.indexOf(e.id)}),n.forEach(function(e){return t.getToolBoxById(e).setEditingConstraints(i[e])})}},{key:"getApplicationEditingConstraints",value:function(){return this.applicationEditingConstraints}},{key:"getApplicationEditingConstraintById",value:function(e){return this.applicationEditingConstraints.toolboxes[e]}},{key:"getToolBoxes",value:function(){return this._toolboxes}},{key:"getEditableLayers",value:function(){return this._editableLayers}},{key:"getEditableLayersId",value:function(){return Object.keys(this.getEditableLayers())}},{key:"_cancelOrSave",value:function(){return resolve()}},{key:"stop",value:function(){var n=this;return new Promise(function(e,t){var i=[];n._toolboxes.forEach(function(e){e.getSession().getHistory().state.commit&&i.push(n.commit({toolbox:e,modal:!0}))}),$.when.apply(n,i).always(function(){n._toolboxes.forEach(function(e){return e.stop()}),n.clearState(),n._mapService.refreshMap(),e()})})}},{key:"clear",value:function(){M.removeLayersStore(this._layersstore),P.clear(),this._mapService.off(z,this.mapControlToggleEventHandler),this.unregisterResultEditingAction()}},{key:"clearState",value:function(){this.state.toolboxselected=null,this.state.toolboxidactivetool=null,this.state.message=null}},{key:"getRelationsInEditing",value:function(){var i=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=e.layerId,t=e.relations,t=void 0===t?[]:t,r=e.feature,a=[],o=void 0;return t.forEach(function(e){var t=i._getRelationLayerId({layerId:n,relation:e});i.getLayerById(t)&&(o={relation:e.getState(),relations:i.getRelationsAttributesByFeature({layerId:t,relation:e,feature:r}),validate:{valid:!0}},a.push(o))}),a}},{key:"_filterRelationsInEditing",value:function(e){var t=this,i=e.layerId,e=e.relations;return(void 0===e?[]:e).filter(function(e){return t.getToolBoxById(t._getRelationId({layerId:i,relation:e}))})}},{key:"stopToolboxesChildren",value:function(t){var i=this,e=this.getLayerById(t);this._filterRelationsInEditing({relations:e.getRelations()?e.getRelations().getArray():[],layerId:t}).filter(function(e){return e.getFather()===t}).forEach(function(e){e=i._getRelationId({layerId:t,relation:e});i.getToolBoxById(e).inEditing()&&i.getToolBoxById(e).stop()})}},{key:"stopSessionChildren",value:function(t){var i=this,e=this.getLayerById(t);this._filterRelationsInEditing({relations:e.getRelations()?e.getRelations().getArray():[],layerId:t}).filter(function(e){return e.getFather()===t}).forEach(function(e){e=i._getRelationId({layerId:t,relation:e});i.getToolBoxById(e).inEditing()||i._sessions[e].stop()})}},{key:"fathersInEditing",value:function(t){var i=this;return this.getLayerById(t).getFathers().filter(function(e){var e=i.getToolBoxById(e);if(e&&e.inEditing()&&e.isDirty())return e=e.getSession().getCommitItems().relations,Object.keys(void 0===e?{}:e).find(function(e){return t===e})})}},{key:"_getRelationFieldsFromRelation",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layerId,e=e.relation,t=(e.getChild?e.getChild():e.child)!==t,i=e.getFatherField?e.getFatherField():e.fatherField,e=e.getChildField?e.getChildField():e.childField;return{ownField:t?i:e,relationField:t?e:i}}},{key:"createEditingDataOptions",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"all",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=void 0;switch(e){case"all":i=void 0;break;case"bbox":i={bbox:this._mapService.getMapBBOX()};break;case"field":i={field:{field:t.field,type:"editing"}};break;case"fid":"not"!==t.operator&&(i={fid:{fid:t.feature.getId(),layer:{id:t.layerId},type:"editing",relation:t.relation.state,formatter:0}});break;case"1:1":i={field:t.relation.getChildField()[0]+"|eq|"+t.feature.get(t.relation.getFatherField()[0]),type:"editing"}}return{registerEvents:!0,editing:!0,filter:i}}},{key:"_getFeaturesByLayerId",value:function(e){return this.getLayerById(e).readEditingFeatures()}},{key:"getLayersDependencyFeaturesFromSource",value:function(){var a=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},o=e.layerId,s=e.relation,l=e.feature,e=e.operator,u=void 0===e?"eq":e;return new Promise(function(e){if("eq"!==u)return e(!1);var t=a._getRelationFieldsFromRelation({layerId:o,relation:s}),i=t.ownField,t=t.relationField,n=a._getFeaturesByLayerId(o),r=t.map(function(e){return l.get(e)});e(i.every(function(t,i){return n.find(function(e){return e.get(t)==r[i]})}))})}},{key:"_getRelationId",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layerId,e=e.relation,i=e.getFather?e.getFather():e.father,e=e.getChild?e.getChild():e.child;return i===t?e:i}},{key:"getLayersDependencyFeatures",value:(a=m(function*(l){var u=this,d=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},e=this.getLayerById(l),e=d.relations||e.getChildren().length&&e.getRelations()&&this._filterRelationsInEditing({layerId:l,relations:e.getRelations().getArray().filter(function(e){return e.getFather()===l})})||[],t=void 0;try{t=yield Promise.all(e.map(function(i){i.setLoading?i.setLoading(!0):i.loading=!0;var t,n=u._getRelationId({layerId:l,relation:i}),e=(d.relation=i,d.layerId=l,d.filterType="ONE"===(i.getType?i.getType():i.type)?"1:1":d.filterType,d.filterType||"fid"),r=u.createEditingDataOptions(e,d),a=u._sessions[n],o=w.online&&a,s=u.getToolBoxById(n);return new Promise((t=m(function*(e){var t=(!w.online||!a||a.isStarted())&&(yield(0,g.promisify)(u.getLayersDependencyFeaturesFromSource({layerId:n,relation:i,feature:d.feature,operator:d.operator})));s.startLoading();try{o&&!a.isStarted()?yield(0,g.promisify)(a.start(r)):o&&!t&&(yield(0,g.promisify)(a.getFeatures(r)))}catch(e){try{yield(0,g.promisify)(e)}catch(e){}}s.stopLoading(),e(n)}),function(e){return t.apply(this,arguments)}))}))}catch(e){}return e.forEach(function(e){e.setLoading?e.setLoading(!1):e.loading=!1}),t}),function(e){return a.apply(this,arguments)})},{key:"commitDirtyToolBoxes",value:function(n){var r=this;return new Promise(function(e,t){var i=r.getToolBoxById(n);i.isDirty()&&i.hasDependencies()?r.commit({toolbox:i}).then(function(){e(i)}).fail(function(){i.revert().then(function(){i.getDependencies().forEach(function(e){-1!==r.getLayerById(e).getChildren().indexOf(e)&&r.getToolBoxById(e).revert()})}),t(i)}):e(i)})}},{key:"_createCommitMessage",value:function(e){function i(e,t,i){var n={},r=(n[""+V("editing.messages.commit.add")]=e.length,n[""+V("editing.messages.commit.update")]="["+t.map(function(e){return e.id}).join(",")+"]",n[""+V("editing.messages.commit.delete")]="["+i.join(",")+"]","<h4>"+V("editing.messages.commit.header")+"</h4>"),r=(r+="<h5>"+V("editing.messages.commit.header_add")+"</h5>")+("<h5>"+V("editing.messages.commit.header_update_delete")+"</h5>")+"<ul style='border-bottom-color: #f4f4f4;'>";return Object.entries(n).forEach(function(e){var e=p(e,2),t=e[0],e=e[1];r+="<li>"+t+" : "+e+" </li>"}),r+="</ul>"}var n="";return n+=i(e.add,e.update,e.delete),_.isEmpty(e.relations)||(n=(n+="<div style='height:1px; background:#f4f4f4;border-bottom:1px solid #f4f4f4;'></div>")+"<div style='margin-left: 40%'><h4>"+V("editing.relations")+"</h4></div>",Object.entries(e.relations).forEach(function(e){var e=p(e,2),t=e[0],e=e[1];n=(n+="<div><span style='font-weight: bold'>"+t+"</span></div>")+i(e.add,e.update,e.delete)})),n}},{key:"showCommitModalWindow",value:function(e){var l=this,r=e.layer,a=e.commitItems,o=e.close,s=e.commitPromise,u={success:{message:"plugins.editing.messages.saved",autoclose:!0},error:{}};return new Promise(function(t,i){var n,e=new h.EditingWorkflow({type:"commitfeatures",steps:[new y.ConfirmStep({type:"commit"})]});e.start({inputs:{layer:r,message:l._createCommitMessage(a),close:o}}).then(function(){var e=D.dialog.dialog({message:'<h4 class="text-center"><i style="margin-right: 5px;" class='+D.getFontClass("spinner")+"></i>"+V("editing.messages.saving")+"</h4>",closeButton:!1});t(u),s.always(function(){return e.modal("hide")})}).fail((n=m(function*(e){var s=[];(function o(){Object.entries(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).forEach(function(e){var e=p(e,2),t=e[0],e=e[1],i=e.add,n=e.delete,r=e.update,e=e.relations,e=void 0===e?{}:e,a=l.getLayerById(t).getEditingSource();0<a.readFeatures().length&&(i.forEach(function(e){e=e.id;a.removeFeature(a.getFeatureById(e))}),r.forEach(function(e){var n=e.id;s.push(new Promise(function(i,e){l.getProjectLayerFeatureById({layerId:t,fid:n}).then(function(e){var t=a.getFeatureById(n);t.setProperties(e.properties),t.setGeometry(e.geometry),i()}).catch(e)}))})),n.forEach(function(n){s.push(new Promise(function(i,e){l.getProjectLayerFeatureById({layerId:t,fid:n}).then(function(e){var t=new ol.Feature({geometry:e.geometry});t.setProperties(e.properties),t.setId(n),a.addFeature(new j({feature:t})),i()}).catch(e)}))}),o(e)})})(a.relations),yield Promise.allSettled(s),i(e)}),function(e){return n.apply(this,arguments)})).always(function(){return e.stop()})})}},{key:"saveChange",value:(r=m(function*(){if("autosave"===this.saveConfig.mode)return this.commit({modal:!1})}),function(){return r.apply(this,arguments)})},{key:"addLayersFeaturesToShowOnResult",value:function(e){var t=this,i=e.layerId,e=e.fids,e=void 0===e?[]:e;void 0===this.loadLayersFeaturesToResultWhenCloseEditing[i]&&(this.loadLayersFeaturesToResultWhenCloseEditing[i]=new Set),e.forEach(function(e){return t.loadLayersFeaturesToResultWhenCloseEditing[i].add(e)})}},{key:"onCloseEditingPanel",value:(n=m(function*(){yield this.showChangesToResult(),this.getToolBoxes().forEach(function(e){return e.resetDefault()})}),function(){return n.apply(this,arguments)})},{key:"showChangesToResult",value:(e=m(function*(){var i=this,e=Object.keys(this.loadLayersFeaturesToResultWhenCloseEditing);if(e.length){var n={layers:[],fids:[],formatter:1},e=(e.forEach(function(e){var t=[].concat(v(i.loadLayersFeaturesToResultWhenCloseEditing[e]));t.length&&(e=O.getLayerById(e),n.layers.push(e),n.fids.push(t))}),n.layers.length?F.getData("search:layersfids",{inputs:n,outputs:{title:"plugins.editing.editing_changes",show:{loading:!1}}}):Promise.resolve());try{yield e}catch(e){}}this.loadLayersFeaturesToResultWhenCloseEditing={}}),function(){return e.apply(this,arguments)})},{key:"commit",value:function(){var a=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},o=e.toolbox,n=e.commitItems,t=e.modal,t=void 0===t||t,e=e.close,e=void 0!==e&&e,s=$.Deferred(),i=s.promise(),r=this.saveConfig,l=r.cb,u=void 0===l?{}:l,l=r.messages,r=void 0===l?{success:{},error:{}}:l,d=(o=o||this.state.toolboxselected).getSession(),l=o.getLayer(),c=l.getType(),f=n,p=(n=n||d.getCommitItems()).add,h=n.delete,h=void 0===h?[]:h,g=n.update,g=void 0===g?[]:g,y=n.relations,y=void 0===y?{}:y;return 0===[].concat(v(void 0===p?[]:p),v(h),v(g),v(Object.keys(y))).length?(D.showUserMessage({type:"info",message:"Nothing to save",autoclose:!0,closable:!1}),s.resolve(o),s.promise()):((t?this.showCommitModalWindow({layer:l,commitItems:n,close:e,commitPromise:i}):Promise.resolve(r)).then(function(r){var e,t,i;w.online?d.commit({items:f||n}).then(function(e,t){var i,n;w.online&&(t.result?(n=(i=r.success).autoclose,i=i.message,r&&r.success&&D.showUserMessage({type:"success",message:void 0===i?"plugins.editing.messages.saved":i,duration:3e3,autoclose:void 0===n||n}),c===A.LayerTypes.VECTOR&&a._mapService.refreshMap({force:!0}),u.done&&u.done instanceof Function&&u.done(o),a.addLayersFeaturesToShowOnResult({layerId:o.getId(),fids:[].concat(v(t.response.new.map(function(e){return e.id})),v(e.update.map(function(e){return e.id})))}),a.emit("commit",t.response)):(i=new B({error:t.errors}).parse({type:"String"}),e=(n=r.error).autoclose,t=n.message,D.showUserMessage({type:"alert",message:t||i,textMessage:!t,autoclose:void 0!==e&&e}),u.error&&u.error instanceof Function&&u.error(o,t||i)),s.resolve(o))}).fail(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=new B({error:e.errors||e}).parse({type:"String"}),t=r.error,i=t.autoclose,t=t.message;D.showUserMessage({type:"alert",message:t||e,textMessage:!t,autoclose:void 0!==i&&i}),s.reject(o),u.error&&u.error instanceof Function&&u.error(o,t||e)}):a.saveOfflineItem({data:(e={},t=d.getId(),i=n,t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e),id:N.CHANGES}).then(function(){D.showUserMessage({type:"success",message:"plugins.editing.messages.saved_local",autoclose:!0}),d.clearHistory(),s.resolve(o)}).catch(function(e){D.showUserMessage({type:"alert",message:e,textMessage:!0}),s.reject(o)})}).catch(function(e){s.reject(o)}),i)}},{key:"clearAllLayersUniqueFieldsValues",value:function(){this.layersUniqueFieldsValues={}}},{key:"clearLayerUniqueFieldsValues",value:function(e){this.layersUniqueFieldsValues[e]={}}},{key:"removeLayerUniqueFieldValuesFromFeature",value:function(e){var t=e.layerId,i=e.feature,n=this.layersUniqueFieldsValues[t];n&&Object.keys(i.getProperties()).filter(function(e){return void 0!==n[e]}).forEach(function(e){return n[e].delete(i.get(e))})}},{key:"removeRelationLayerUniqueFieldValuesFromFeature",value:function(e){var i=e.layerId,t=e.relationLayerId,n=e.feature,r=this.layersUniqueFieldsValues[t],a=this.layersUniqueFieldsValues[i];void 0!==r&&void 0!==a&&(void 0===r.__uniqueFieldsValuesRelations&&(r.__uniqueFieldsValuesRelations={}),Object.keys(n.getProperties()).forEach(function(e){var t;void 0===r.__uniqueFieldsValuesRelations[i]&&(r.__uniqueFieldsValuesRelations[i]={}),void 0!==a[e]&&((t=new Set(a[e])).delete(n.get(e)),r.__uniqueFieldsValuesRelations[i][e]=t)}))}},{key:"setLayerUniqueFieldValues",value:(i=m(function*(i){var n=this,e=[],r=O.getLayerById(i);return r.getEditingFields().forEach(function(t){t.validate.unique&&void 0===n.getLayerUniqueFieldValues({layerId:i,field:t})&&e.push(r.getFilterData({unique:t.name}).then(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];void 0===n.layersUniqueFieldsValues[i]&&(n.layersUniqueFieldsValues[i]={}),n.layersUniqueFieldsValues[i][t.name]=new Set(e)}))}),yield Promise.allSettled(e),this.layersUniqueFieldsValues[i]}),function(e){return i.apply(this,arguments)})},{key:"saveTemporaryRelationsUniqueFieldsValues",value:function(e){var n=this,t=this.layersUniqueFieldsValues[e]&&this.layersUniqueFieldsValues[e].__uniqueFieldsValuesRelations;void 0!==t&&(Object.keys(t).forEach(function(i){Object.entries(t[i]).forEach(function(e){var e=p(e,2),t=e[0],e=e[1];n.layersUniqueFieldsValues[i][t]=e})}),this.clearTemporaryRelationsUniqueFieldsValues(e))}},{key:"clearTemporaryRelationsUniqueFieldsValues",value:function(e){this.layersUniqueFieldsValues[e]&&delete this.layersUniqueFieldsValues[e].__uniqueFieldsValuesRelations}},{key:"getLayerUniqueFieldValues",value:function(e){var t=e.layerId,e=e.field;return this.layersUniqueFieldsValues[t]?this.layersUniqueFieldsValues[t][e.name]:[]}},{key:"getChildLayerUniqueFieldValues",value:function(e){var t=e.layerId,i=e.relationLayerId,e=e.field,i=this.layersUniqueFieldsValues[i]&&this.layersUniqueFieldsValues[i].__uniqueFieldsValuesRelations;return void 0!==i&&void 0!==i[t]&&void 0!==i[t][e.name]?i[t][e.name]:this.getLayerUniqueFieldValues({layerId:t,field:e})}},{key:"changeLayerUniqueFieldValues",value:function(e){var t=e.layerId,i=e.field,n=e.oldValue,e=e.newValue;void 0!==this.layersUniqueFieldsValues[t]&&void 0!==this.layersUniqueFieldsValues[t][i.name]&&((t=this.layersUniqueFieldsValues[t][i.name]).delete(n),t.add(e))}},{key:"changeRelationLayerUniqueFieldValues",value:function(e){var t,i=e.layerId,n=e.relationLayerId,r=e.field,a=e.oldValue,e=e.newValue,n=this.layersUniqueFieldsValues[n];void 0!==n&&(void 0===n.__uniqueFieldsValuesRelations&&(n.__uniqueFieldsValuesRelations={}),void 0===n.__uniqueFieldsValuesRelations[i]&&(n.__uniqueFieldsValuesRelations[i]={}),(t=new Set(this.layersUniqueFieldsValues[i][r.name])).delete(a),t.add(e),n.__uniqueFieldsValuesRelations[i][r.name]=t)}},{key:"addLayerUniqueFieldValue",value:function(e){var t=e.layerId,i=e.field,e=e.value;this.layersUniqueFieldsValues[t][i.name].add(e)}},{key:"deleteLayerUniqueFieldValue",value:function(e){var t=e.layerId,i=e.field,e=e.value;this.layersUniqueFieldsValues[t][i.name].delete(e)}},{key:"undoRedoLayerUniqueFieldValues",value:function(e){var a=this,o=e.layerId,t=e.sessionItems,t=void 0===t?[]:t,s=e.action;void 0!==this.layersUniqueFieldsValues[o]&&t.forEach(function(r){Object.keys(a.layersUniqueFieldsValues[o]).forEach(function(e){var t,i=void 0,n=void 0;n=Array.isArray(r)?(i=(t=r[1].feature.get(e)!=r[0].feature.get(e))?("undo"===s?r[1]:r[0]).feature.get(e):void 0,t?("undo"===s?r[0]:r[1]).feature.get(e):void 0):(i="add"===r.feature.getState()?r.feature.get(e):void 0,"delete"===r.feature.getState()?r.feature.get(e):void 0),void 0!==i&&a.deleteLayerUniqueFieldValue({layerId:o,field:{name:e},value:i}),void 0!==n&&a.addLayerUniqueFieldValue({layerId:o,field:{name:e},value:n})})})}},{key:"undoRedoRelationUniqueFieldValues",value:function(e){var n=this,t=e.relationSessionItems,r=e.action;Object.entries(t).forEach(function(e){var e=p(e,2),t=e[0],e=e[1],i=e.own,e=e.dependencies;n.undoRedoLayerUniqueFieldValues({layerId:t,sessionItems:i,action:r}),n.undoRedoRelationUniqueFieldValues({relationSessionItems:e,action:r})})}},{key:"getProjectLayerById",value:function(e){return O.getLayerById(e)}},{key:"getProjectLayerFeatureById",value:(t=m(function*(e){var t=e.layerId,e=e.fid,i=void 0;try{var n=yield S.get({url:this.getProjectLayerById(t).getUrl("data"),params:{fids:e}}),r=I(n);0<r.length&&(i=r[0])}catch(e){}return i}),function(e){return t.apply(this,arguments)})},{key:"getProjectLayersWithSameGeometryOfLayer",value:function(e){var t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{exclude:[]}).exclude,i=void 0===t?[]:t,n=e.getGeometryType();return O.getLayers().filter(function(e){return e.isGeoLayer()&&e.getGeometryType&&e.getGeometryType()&&-1===i.indexOf(e.getId())&&(e.getGeometryType()===n||T(e.getGeometryType(),n)&&E.isMultiGeometry(n))})}},{key:"getExternalLayersWithSameGeometryOfLayer",value:function(e){var t=e.getGeometryType();return this._mapService.getExternalLayers().filter(function(e){var e=e.getSource().getFeatures();return!(!(e&&0<e.length)||e&&e[0]&&!e[0].getGeometry())&&(e=e[0].getGeometry().getType(),t===e||T(t,e))})}},{key:"getFeatureTableFieldValue",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layerId,i=e.feature,e=e.property,t=this.getLayerById(t).config.editing.fields,n=i.get(e),i=null!==n&&(t.filter(function(e){return["select_autocomplete","select"].includes(e.input.type)})||[]).reduce(function(e,t){return e[t.name]=t.input.options.values,e},{}),t=i&&i[e]&&i[e].find(function(e){return n==e.value});return t?t.key:n}},{key:"showPanel",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};t.toolboxes&&Array.isArray(t.toolboxes)&&this.getToolBoxes().forEach(function(e){return e.setShow(-1!==t.toolboxes.indexOf(e.getId()))}),this.getPlugin().showEditingPanel(t)}},{key:"hidePanel",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.getPlugin().hideEditingPanel(e)}},{key:"startEditing",value:function(n){var r=this,a=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return a.selected=void 0===a.selected||a.selected,a.showselectlayers=void 0===a.showselectlayers||a.showselectlayers,a.disablemapcontrols=void 0!==a.disablemapcontrols&&a.showselectlayers,new Promise(function(t,e){var i=r.getToolBoxById(n);if(r.setShowSelectLayers(a.showselectlayers),!i)return e();i.setSelected(a.selected),a.selected&&r.setSelectedToolbox(i),a.title&&i.setTitle(a.title),i.start(a).then(function(e){a.disablemapcontrols&&r.disableMapControlsConflict(!0),t(e?{toolbox:i,data:e}:i)}).fail(e)})}},{key:"stopEditing",value:function(i){var n=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(e,t){n.getToolBoxById(i).stop(r).then(e).fail(t)})}},{key:"addLayerFeature",value:function(){var s=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},l=e.layerId,u=e.feature;return void 0===u||void 0===l?Promise.reject():new Promise(function(e,t){function i(e){return o.stop(),r.stop(),e()}var n=s.getLayerById(l),r=s.getSessionById(l),a=n.getEditingFields().filter(function(e){return!(e.pk&&!e.editable)}),o=(r.start({filter:{nofeatures:!0,nofeatures_field:a[0].name},editing:!0}),new h.EditingWorkflow({type:"addfeature",steps:[new y.OpenFormStep({push:!0,showgoback:!1,saveAll:!1})]}));try{a.forEach(function(e){void 0===u.get(e.name)&&u.set(e.name,null)}),(u=new j({feature:u,properties:a.map(function(e){return e.name})})).setTemporaryId(),r.pushAdd(l,u,!1),n.getEditingLayer().getSource().addFeature(u),o.start({inputs:{layer:n,features:[u]},context:{session:r}}).then(function(){r.save(),s.commit({modal:!1,toolbox:s.getToolBoxById(l)}).then(function(){return i(e)}).fail(function(){return i(t)})}).fail(function(){return i(t)})}catch(e){t()}})}}]),d}())},{"../g3wsdk/workflow/workflow":38,"../toolboxes/toolbox":46,"../utils/promisify":60,"../workflows":64}],43:[function(e,t,i){var h=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var i=t,n=[],r=!0,t=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!i||n.length!==i);r=!0);}catch(e){t=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(t)throw a}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},s=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,n=arguments[t];for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},n=function(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),e};function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var g=e("../g3wsdk/workflow/workflow"),y=e("../utils/setAndUnsetSelectedFeaturesStyle"),v=e("../utils/promisify"),_=e("../eventbus"),m=e("../workflows");function b(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function d(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}function l(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}var a,o,u,w=g3wsdk.gui.GUI,k=g3wsdk.core.i18n.tPlugin,F=g3wsdk.core.layer.Layer,S=g3wsdk.core.workflow.WorkflowsStack,c=g3wsdk.core.geometry.Geometry,x=g3wsdk.gui.vue.services.FormService,f="rgb(255,89,0)",E={Point:new ol.style.Style({image:new ol.style.Circle({radius:8,fill:new ol.style.Fill({color:f})})}),MultiPoint:new ol.style.Style({image:new ol.style.Circle({radius:8,fill:new ol.style.Fill({color:f})})}),Linestring:new ol.style.Style({stroke:new ol.style.Stroke({width:8,color:f})}),MultiLinestring:new ol.style.Style({stroke:new ol.style.Stroke({width:8,color:f})}),Polygon:new ol.style.Style({stroke:new ol.style.Stroke({width:8,color:f}),fill:new ol.style.Fill({color:f})}),MultiPolygon:new ol.style.Style({stroke:new ol.style.Stroke({width:8,color:f}),fill:new ol.style.Fill({color:f})})};function p(e){var r=this,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=this,n=p;if(!(i instanceof n))throw new TypeError("Cannot call a class as a function");var a=this.getEditingService().getCurrentWorkflow().getLayer();this.relation=t.relation,this.relations=t.relations,this.currentRelationFeatureId=null,this._relationLayerId=this.relation.child===e?this.relation.father:this.relation.child,this._layerType=this.getLayer().getType();var i=this.getEditingService()._getRelationFieldsFromRelation({layerId:e,relation:this.relation}).ownField,o=i.find(function(e){return a.isPkField(e)});this.parent={layerId:e,editable:i.filter(function(e){return a.isEditingFieldEditable(e)}),pk:o,values:i.reduce(function(e,t){var i=r.getEditingService().getCurrentWorkflow().getCurrentFeature(),n=r.getEditingService().getCurrentWorkflow().getInputs().fields;return e[t]=t===o&&i.isNew()?i.getId():n?n.find(function(e){return t===e.name}).value:i.get(t),e},{})},this.capabilities=a.getEditingCapabilities(),this.tools=[],this._add_link_workflow=(l(n={},F.LayerTypes.TABLE,{link:function(){return new g.EditingWorkflow(s({},0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},{type:"edittable",backbuttonlabel:"plugins.editing.form.buttons.save_and_back_table",steps:[new m.OpenTableStep]}))},add:function(){return new g.EditingWorkflow(s({},0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},{type:"addtablefeature",steps:[new m.AddTableFeatureStep,new m.OpenFormStep]}))}}),l(n,F.LayerTypes.VECTOR,{link:function(){return new g.EditingWorkflow({type:"linkrelation",steps:[new m.LinkRelationStep(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})]})},add:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=new g.EditingWorkflow(s({},e,{type:"addfeature",steps:[new m.AddFeatureStep(e),new m.OpenFormStep(e)]}));return e.addToolsOfTools({step:e.getStep(0),tools:["snap","measure"]}),e},selectandcopy:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new g.EditingWorkflow({type:"selectandcopyfeaturesfromotherlayer",steps:[new m.PickProjectLayerFeaturesStep(e),new m.CopyFeaturesFromOtherProjectLayerStep(e),new m.OpenFormStep(e)],registerEscKeyEvent:!0})}}),n[this._layerType]),this.relations.forEach(function(e){return r.addTools(e.id)})}t.exports=(n(p,[{key:"enableDOMElements",value:function(){var t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];document.querySelectorAll(".editing-save-all-form").forEach(function(e){t&&e.classList.contains("g3w-disabled")&&e.classList.remove("g3w-disabled"),t||e.querySelector(".save-all-icon").classList.contains("g3w-disabled")||e.classList.add("g3w-disabled")}),document.querySelectorAll(".g3w-editing-relations-add-link-tools, .g3wform_footer").forEach(function(e){return e.classList.toggle("g3w-disabled",!t)})}},{key:"getEditingCapabilities",value:function(){return this.capabilities}},{key:"addTools",value:function(t){var i=this,e=[this.capabilities.includes("change_attr_feature")&&{state:Vue.observable({icon:"editAttributes.png",id:t+"_editattributes",name:"editing.tools.update_feature",enabled:!0,active:!1}),type:"editfeatureattributes"},this.capabilities.includes("delete_feature")&&{state:Vue.observable({icon:"deleteTableRow.png",id:t+"_deletefeature",name:"editing.tools.delete_feature",enabled:!0,active:!1}),type:"deletefeature"},this.capabilities.includes("change_feature")&&F.LayerTypes.VECTOR===this._layerType&&this.getEditingService().getToolBoxById(this._relationLayerId).getTools().filter(function(e){return c.isPointGeometryType(i.getLayer().getGeometryType())?"movefeature"===e.getId():["movefeature","movevertex"].includes(e.getId())}).map(function(e){return{state:Vue.observable(s({},e.state,{id:t+"_"+e.state.id})),type:e.getOperator().type}})].flat().filter(Boolean);return this.tools.push(e),e}},{key:"getTools",value:function(e){return this.tools[e]||this.addTools(this.relations[e].id)}},{key:"startTool",value:(u=d(function*(t,i){var n=this;if(t.state.active=!t.state.active,!t.state.active)return Promise.resolve();this.tools.forEach(function(e){e.forEach(function(e){t.state.id!==e.state.id&&(e.state.active=!1)})}),yield _.VM.$nextTick();var r={},e=new Promise(function(e,t){Object.assign(r,{resolve:e,reject:t})}),a=F.LayerTypes.VECTOR===this._layerType,o=this.relations[i],s=t.state.id.split(o.id+"_")[1],l=this.getLayer().getEditingSource().getFeatureById(o.id),u=this.getLayer().getEditingSource(),a=a&&E[this.getLayer().getGeometryType()],d=this._createWorkflowOptions({features:[l]});if("deletefeature"===s&&((0,y.setAndUnsetSelectedFeaturesStyle)({promise:e,inputs:{features:[l],layer:this.getLayer()},style:a}),w.dialog.confirm(k("editing.messages.delete_feature"),function(e){e&&(n.getEditingService().getCurrentWorkflowData().session.pushDelete(n._relationLayerId,l),n.relations.splice(i,1),n.tools.splice(i,1),n.getEditingService().removeRelationLayerUniqueFieldValuesFromFeature({layerId:n._relationLayerId,relationLayerId:n.parent.layerId,feature:l}),u.removeFeature(l),l.isNew()&&void 0===S._workflows.find(function(e){return 0<e.getSession()._temporarychanges.filter(function(e){e=e.feature;return l.getUid()!==e.getUid()}).length})?S._workflows.filter(function(e){return e.getContextService()instanceof x}).forEach(function(e){return setTimeout(function(){return e.getContextService().state.update=!1})}):n.updateParentWorkflows(),r.resolve(e)),e||r.reject()})),"editattributes"===s){var c=new g.EditingWorkflow({type:"edittablefeature",steps:[new m.OpenFormStep({selectStyle:a})]});try{yield(0,v.promisify)(c.start(d)),this.getLayer().getFieldsWithValues(l,{relation:!0}).forEach(function(t){o.fields.forEach(function(e){e.name===t.name&&(e.value=t.value)})}),r.resolve(!0)}catch(e){r.reject(e)}c.stop()}if(["movevertex","movefeature"].includes(s)&&this.currentRelationFeatureId!==l.getId()&&(this.currentRelationFeatureId=l.getId(),w.getService("map").zoomToFeatures([l])),["movevertex","movefeature"].includes(s)){w.setModal(!1),this.enableDOMElements(!1);var f=new g.EditingWorkflow({type:t.type,steps:[new{movevertex:m.ModifyGeometryVertexStep,movefeature:m.MoveFeatureStep}[s]({selectStyle:a})]}),p=_.VM.$watch(function(){return t.state.active},function(e){e||(n.enableDOMElements(!0),w.setModal(!0),f.unbindEscKeyUp(),f.stop(),p(),r.reject(!1))});f.bindEscKeyUp(function(){w.setModal(!0),p(),r.reject(!1)});try{yield(0,v.promisify)(f.start(d)),S.getParents().filter(function(e){return e.getContextService().setUpdate}).forEach(function(e){return e.getContextService().setUpdate(!0,{force:!0})}),r.resolve(!0),setTimeout(function(){return n.startTool(t,i)})}catch(e){r.reject(e)}f.unbindEscKeyUp(),f.stop(),p()}try{yield e}catch(e){return Promise.reject(e)}finally{t.state.active=!1}}),function(e,t){return u.apply(this,arguments)})},{key:"updateParentWorkflows",value:function(){(S.getParents()||[this.getEditingService().getCurrentWorkflow()]).forEach(function(e){e.getContextService()&&e.getContextService().setUpdate(!0,{force:!0})})}},{key:"getLayer",value:function(){return this.getEditingService().getLayerById(this._relationLayerId)}},{key:"getEditingLayer",value:function(){return this.getEditingService().getEditingLayer(this._relationLayerId)}},{key:"getEditingService",value:function(){return e("./editingservice")}},{key:"addRelationFromOtherLayer",value:function(e){var t=e.layer,e=e.external,i=void 0,n=!1;(e||t.isGeoLayer())&&(i=new this._add_link_workflow.selectandcopy({copyLayer:t,isVector:n=!0,external:e,help:"editing.steps.help.copy"})),this.runAddRelationWorkflow({workflow:i,isVector:n})}},{key:"addRelation",value:function(){this.runAddRelationWorkflow({workflow:new this._add_link_workflow.add,isVector:F.LayerTypes.VECTOR===this._layerType})}},{key:"runAddRelationWorkflow",value:(o=d(function*(){var r=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.workflow,e=e.isVector,e=void 0!==e&&e,a=(e&&(w.setModal(!1),w.hideContent(!0)),this._createWorkflowOptions()),i=this.getEditingService()._getRelationFieldsFromRelation({layerId:this._relationLayerId,relation:this.relation}),o=i.ownField,n=i.relationField;try{function s(e){var i=e.oIndex,n=e.value;f.forEach(function(e,t){e.set(o[i],n),a.parentFeature.isNew()&&p[t].set(o[i],n),r.getLayer().getEditingSource().updateFeature(e),a.context.session.pushUpdate(r._relationLayerId,e,p[t])})}var l,u,d=yield(0,v.promisify)(t.start(a)),c=(e&&t.bindEscKeyUp(),d.relationFeatures),f=c.newFeatures,p=c.originalFeatures;Object.entries(this.parent.values).forEach(function(e){var e=h(e,2),t=e[0],e=e[1];s({oIndex:n.findIndex(function(e){return t===e}),value:e})}),a.parentFeature.isNew()&&0<this.parent.editable.length&&(u=a.parentFeature.on("propertychange",function(t){a.parentFeature.isNew()?n.find(t.key)&&s({oIndex:n.findIndex(function(e){return t.key===e}),value:t.target.get(t.key)}):ol.Observable.unByKey(u)})),(l=this.relations).push.apply(l,b((f||[]).map(function(e){return{id:e.getId(),fields:r.getLayer().getFieldsWithValues(e,{relation:!0})}})))}catch(e){e&&e.relationFeatures&&(i=this.relations).push.apply(i,b((e.relationFeatures.newFeatures||[]).map(function(e){return{id:e.getId(),fields:r.getLayer().getFieldsWithValues(e,{relation:!0})}}))),a.context.session.rollbackDependecies([this._relationLayerId])}t.stop(),e&&(t.unbindEscKeyUp(),w.hideContent(!1),w.setModal(!0))}),function(){return o.apply(this,arguments)})},{key:"linkRelation",value:(a=d(function*(){var n=this,e=F.LayerTypes.VECTOR===this._layerType,t=new this._add_link_workflow.link(e?{selectStyle:E[this.getLayer().getGeometryType()]}:{}),i=this._createWorkflowOptions(),r=this.getEditingService()._getRelationFieldsFromRelation({layerId:this._relationLayerId,relation:this.relation}),a=r.ownField,o=r.relationField;i.context.excludeFeatures=o.reduce(function(e,t,i){return e[a[i]]=n.parent.values[t],e},{}),e&&w.setModal(!1);function s(){return n.getEditingService().getLayersDependencyFeatures(n.parent.layerId,{relations:[n.relation],feature:l,operator:"not",filterType:e?"bbox":"fid"})}var l=this.getEditingService().getCurrentWorkflowData().feature,r={promise:void 0,showContent:!1},u=(e?(i.context.beforeRun=d(function*(){yield new Promise(function(e){return setTimeout(e)}),yield s()}),t.bindEscKeyUp(),r={promise:t.start(i),showContent:!0},this.enableDOMElements(!1)):yield s(),!1);try{((yield(0,v.promisify)(r.promise||t.start(i))).features||[]).forEach(function(i){var e;void 0===n.relations.find(function(e){return e.id===i.getId()})?(u=u||!0,e=i.clone(),Object.entries(n.parent.values).forEach(function(e){var e=h(e,2),t=e[0],e=e[1];i.set(a[o.findIndex(function(e){return t===e})],e)}),n.getEditingService().getCurrentWorkflowData().session.pushUpdate(n._relationLayerId,i,e),n.relations.push({fields:n.getLayer().getFieldsWithValues(i,{relation:!0}),id:i.getId()})):w.notify.warning(k("editing.relation_already_added"))})}catch(e){i.context.session.rollbackDependecies([this._relationLayerId])}e&&this.enableDOMElements(!0),r.showContent&&(w.closeUserMessage(),t.unbindEscKeyUp()),u&&this.updateParentWorkflows(),t.stop()}),function(){return a.apply(this,arguments)})},{key:"unlinkRelation",value:function(i){function t(){var e=n.relations[i],t=n.getLayer().getEditingSource().getFeatureById(e.id),e=t.clone();a.forEach(function(e){return t.set(e,null)}),n.getEditingService().getCurrentWorkflowData().session.pushUpdate(n._relationLayerId,t,e),n.relations.splice(i,1),n.updateParentWorkflows(),r.resolve(!0)}var n=this,e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],r=$.Deferred(),a=this.getEditingService()._getRelationFieldsFromRelation({layerId:this._relationLayerId,relation:this.relation}).ownField;return e?w.dialog.confirm(k("editing.messages.unlink_relation"),function(e){e?t():r.reject(!1)}):t(),r.promise()}},{key:"_createWorkflowOptions",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=this.getEditingService()._getRelationFieldsFromRelation({layerId:this._relationLayerId,relation:this.relation}),t=this.getEditingService().getCurrentWorkflowData(),n=Object.entries(this.parent.values);return{parentFeature:t.feature,context:{session:t.session,excludeFields:i.ownField,fatherValue:n.map(function(e){e=h(e,2);e[0];return e[1]}),fatherField:n.map(function(e){var t=h(e,1)[0];return i.ownField[i.relationField.findIndex(function(e){return t===e})]})},inputs:{features:e.features||[],layer:this.getLayer()}}}}]),p)},{"../eventbus":24,"../g3wsdk/workflow/workflow":38,"../utils/promisify":60,"../utils/setAndUnsetSelectedFeaturesStyle":61,"../workflows":64,"./editingservice":42}],44:[function(l,e,t){var i=function(e,t,i){return t&&n(e.prototype,t),i&&n(e,i),e};function n(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var o=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var i=t,n=[],r=!0,t=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!i||n.length!==i);r=!0);}catch(e){t=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(t)throw a}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},s=l("../g3wsdk/workflow/workflow"),u=l("../utils/cloneFeature"),d=l("../workflows");Object.entries({cloneFeature:u.cloneFeature,EditingWorkflow:s.EditingWorkflow,OpenFormStep:d.OpenFormStep,AddTableFeatureStep:d.AddTableFeatureStep}).forEach(function(e){e=o(e,2);e[0],e[1]});var r=g3wsdk.core.utils,c=(r.base,r.inherit,g3wsdk.core.G3WObject),f=g3wsdk.gui.GUI,p=g3wsdk.core.i18n.tPlugin;e.exports=function(){var e=a,t=c;if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);function a(){var e,t,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=this,r=a;if(n instanceof r)return(n=function(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}(this,(a.__proto__||Object.getPrototypeOf(a)).call(this)))._features=i.features||[],n._promise=i.promise,n._context=i.context,n._inputs=i.inputs,n._layerId=i.inputs.layer.getId(),n._fatherValue=i.fatherValue,n._workflow=null,n._deleteFeaturesIndexes=[],n._isrelation=i.isrelation||!1,r=i.capabilities,e=i.headers,t=i.title,i=i.push,n.state={headers:void 0===e?[]:e,features:[],title:void 0===t?"Link relation":t,isrelation:i,capabilities:r},n.init(),n;throw new TypeError("Cannot call a class as a function")}return e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t),i(a,[{key:"init",value:function(){var t,e,i,n=this,r=l("./editingservice");0<this._features.length&&(i=this._features[0],t=Object.keys(i.getProperties()),this.state.headers=this.state.headers.filter(function(e){return-1!==t.indexOf(e.name)}),e=this.state.headers.map(function(e){return e.name}),i=this._features,this.state.features=i.map(function(t){var i={};return e.forEach(function(e){i[e]=r.getFeatureTableFieldValue({layerId:n._layerId,feature:t,property:e})}),i.__gis3w_feature_uid=t.getUid(),i}))}},{key:"isMediaField",value:function(e){for(var t=!1,i=0;i<this.state.headers.length;i++){var n=this.state.headers[i];if(n.name===e&&"media"===n.input.type){t=!0;break}}return t}},{key:"save",value:function(){this._promise.resolve()}},{key:"cancel",value:function(){this._promise.reject()}},{key:"deleteFeature",value:function(o){var s=this,e=l("./editingservice"),t=this._inputs.layer,i=t.getId(),n=t.getChildren().length&&0<e._filterRelationsInEditing({layerId:i,relations:t.getRelations().getArray()}).length;return new Promise(function(r,a){f.dialog.confirm("<h4>"+p("editing.messages.delete_feature")+'</h4>\n        <div style="font-size:1.2em;">'+(n?p("editing.messages.delete_feature_relations"):"")+"</div>",function(e){var t,i,n;(e?(e=s._features.findIndex(function(e){return e.getUid()===o}),t=s._features[e],i=s._context.session,n=s._inputs.layer.getId(),s._inputs.layer.getEditingSource().removeFeature(t),i.pushDelete(n,t),s.state.features.splice(e,1),r):a)()})})}},{key:"copyFeature",value:function(n){var r=this,a=l("./editingservice");return new Promise(function(t,e){var i=(0,u.cloneFeature)(r._features.find(function(e){return e.getUid()===n}),r._inputs.layer.getEditingLayer());r._workflow=new s.EditingWorkflow({type:"addtablefeature",steps:[new d.AddTableFeatureStep,new d.OpenFormStep]}),r._inputs.features.push(i),r._workflow.start({context:r._context,inputs:r._inputs}).then(function(e){var i=e.features[e.features.length-1],n={};Object.entries(r.state.features[0]).forEach(function(e){var e=o(e,2),t=e[0];e[1];n[t]=a.getFeatureTableFieldValue({layerId:r._layerId,feature:i,property:t})}),n.__gis3w_feature_uid=i.getUid(),r.state.features.push(n),t(n)}).fail(e).always(function(){r._workflow.stop()})})}},{key:"editFeature",value:function(t){var n=this,r=l("./editingservice"),a=this._features.findIndex(function(e){return e.getUid()===t}),e=this._features[a],i=(this._workflow=new s.EditingWorkflow({type:"edittablefeature",steps:[new d.OpenFormStep]}),this._inputs);i.features.push(e),this._workflow.start({context:this._context,inputs:i}).then(function(e){var i=e.features[e.features.length-1];Object.entries(n.state.features[a]).forEach(function(e){var e=o(e,2),t=e[0];e[1];n.state.features[a][t]=r.getFeatureTableFieldValue({layerId:n._layerId,feature:i,property:t})})}).fail(console.warn).always(function(){return n._workflow.stop()})}},{key:"linkFeatures",value:function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];this._promise.resolve({features:e.map(function(e){return t._features[e]})})}},{key:"linkFeature",value:function(e){this._promise.resolve({features:[this._features[e]]})}}]),a}()},{"../g3wsdk/workflow/workflow":38,"../utils/cloneFeature":49,"../workflows":64,"./editingservice":42}],45:[function(f,e,t){var i=g3wsdk.core.utils,p=i.base,i=i.inherit,r=g3wsdk.gui.GUI,n=g3wsdk.core.G3WObject,a=g3wsdk.core.layer.Layer;function o(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=(p(this),this.editingService=f("../services/editingservice"),t.name),n=t.row,r=t.id,a=t.icon,o=t.session,s=t.layer,l=t.once,l=void 0!==l&&l,u=t.type,u=void 0===u?[]:u,d=t.visible,d=void 0===d||d,c=t.conditions,c=void 0===c?{}:c;this._options=null,this._session=o,this._layer=s,this._op=new t.op({layer:s}),this._once=l,this.type=u,this.conditions=c,this.disabledtoolsoftools=[],this.state={id:r,name:i,enabled:!1,visible:d instanceof Function?d(e):d,active:!1,icon:a,message:null,row:n||1,messages:this._op.getMessages()}}i(o,n);i=o.prototype;i.setOptions=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.messages,i=e.enabled,i=void 0!==i&&i,n=e.visible,n=void 0===n||n,e=e.disabledtoolsoftools,e=void 0===e?[]:e;this.state.messages=t||this.state.messages,this.state.visible=n,this.state.enabled=i,this.disabledtoolsoftools=e},i.getLayer=function(){return this._layer},i.getType=function(){return this.type},i.getFeature=function(){return this._options.inputs.features[0]},i.createOperatorOptions=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{features:[]}).features;return{inputs:{layer:this._layer,features:void 0===e?[]:e},context:{session:this._session}}},i.start=function(){function t(e){i._op.once("settoolsoftool",function(e){(e=e.filter(function(e){return!i.disabledtoolsoftools.includes(e.type)})).length&&i.emit("settoolsoftool",e)}),i._op.once("active",function(e){return i.emit("active",e)}),i._op.once("deactive",function(e){return i.emit("deactive",e)}),e.inputs.features=[],n&&r.hideSidebar(),i._op.start(e).then(function(){i._session.save().then(function(){return i.editingService.saveChange()})}).fail(function(){n&&r.showSidebar(),i._session.rollback().then(function(){})}).always(function(){i._once||a.LayerTypes.TABLE===i._layer.getType()?i.stop():t(e)})}var i=this,n=0<arguments.length&&void 0!==arguments[0]&&arguments[0],e=this.createOperatorOptions();this._options=e;this._op&&(this.state.active=!0,setTimeout(function(){t(e)}))},i.stop=function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],i=$.Deferred();return this._op?this._op.stop(t).then(function(){}).fail(function(){return e._session.rollback()}).always(function(){e._options=null,e.state.active=!1,e.emit("stop",{session:e._session}),i.resolve()}):(this.emit("stop",{session:this._session}),i.resolve()),i.promise()},i.getState=function(){return this.state},i.setState=function(e){this.state=e},i.getId=function(){return this.state.id},i.setId=function(e){this.state.id=e},i.getName=function(){return this.state.name},i.setActive=function(){this.state.active=0<arguments.length&&void 0!==arguments[0]&&arguments[0]},i.isActive=function(){return this.state.active},i.getIcon=function(){return this.state.icon},i.setIcon=function(e){this.state.icon=e},i.setEnabled=function(){this.state.enabled=0<arguments.length&&void 0!==arguments[0]&&arguments[0]},i.isEnabled=function(){return this.state.enabled},i.setVisible=function(){this.state.visible=!(0<arguments.length&&void 0!==arguments[0])||arguments[0]},i.isVisible=function(){return this.state.visible},i.getOperator=function(){return this._op},i.getSession=function(){return this._session},i.setSession=function(e){this._session=e},i.clear=function(){this.state.enabled=!1,this.state.active=!1},i.getMessage=function(){var e=this.getOperator();return e.getHelpMessage()||e.getRunningStep()?this.state.messages:null},i.getHelpMessage=function(){return this.state.messages.help||this.getName()},i.setMessage=function(e){this.state.message=e},i.clearMessage=function(){this.state.message=null},i.resetDefault=function(){this.state.visible=!0,this.state.enabled=!1,this.state.messages=this._op.getMessages(),this.disabledtoolsoftools=[]},e.exports=o},{"../services/editingservice":42}],46:[function(i,e,t){var h=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,n=arguments[t];for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var i=t,n=[],r=!0,t=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!i||n.length!==i);r=!0);}catch(e){t=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(t)throw a}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},g=i("../g3wsdk/workflow/workflow"),y=i("../workflows");function v(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}var _=i("../toolboxes/tool"),n=(Object.entries({EditingWorkflow:g.EditingWorkflow,OpenFormStep:y.OpenFormStep,ConfirmStep:y.ConfirmStep,CopyFeaturesFromOtherLayerStep:y.CopyFeaturesFromOtherLayerStep,SelectElementsStep:y.SelectElementsStep,PickFeatureStep:y.PickFeatureStep,ChooseFeatureStep:y.ChooseFeatureStep,AddPartToMultigeometriesStep:y.AddPartToMultigeometriesStep,GetVertexStep:y.GetVertexStep,MoveElementsStep:y.MoveElementsStep,DeletePartFromMultigeometriesStep:y.DeletePartFromMultigeometriesStep,MergeFeaturesStep:y.MergeFeaturesStep,SplitFeatureStep:y.SplitFeatureStep,MoveFeatureStep:y.MoveFeatureStep,ModifyGeometryVertexStep:y.ModifyGeometryVertexStep,Tool:_,AddTableFeatureStep:y.AddTableFeatureStep,OpenTableStep:y.OpenTableStep,AddFeatureStep:y.AddFeatureStep}).forEach(function(e){e=r(e,2);e[0],e[1]}),g3wsdk.core),m=n.ApplicationState,n=n.G3WObject,a=g3wsdk.core.utils,o=a.base,s=a.inherit,l=a.debounce,u=a.toRawType,b=g3wsdk.gui.GUI,d=g3wsdk.core.i18n.tPlugin,w=g3wsdk.core.layer.Layer,c=g3wsdk.core.editing.Session,f=g3wsdk.ol.utils.getScaleFromResolution,k=g3wsdk.core.geometry.Geometry,F=g3wsdk.core.geoutils.isSameBaseGeometryType;function S(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};o(this),this.editingService=i("../services/editingservice"),this._mapService=b.getService("map"),this._start=!1,this._constraints=e.constraints||{},this._layer=e.layer,this.uniqueFields=this.getUniqueFieldsType(this._layer.getEditingFields()),this._layerType=e.type||w.LayerTypes.VECTOR,this._loadedExtent=null,this._tools=e.tools,this._getFeaturesOption={},this.constraints={filter:null,show:null,tools:[]},this._session=new c({id:e.id,editor:this._layer.getEditor()}),this._getFeaturesOption={},this._enabledtools,this._disabledtools,this.uniqueFields&&(this.getFieldUniqueValuesFromServer(),this._session.onafter("saveChangesOnServer",function(){t._resetUniqueValues()})),this.state={id:e.id,changingtools:!1,show:!0,color:e.color||"blue",title:e.title||"Edit Layer",customTitle:!1,loading:!1,enabled:!1,toolboxheader:!0,startstopediting:!0,message:null,toolmessages:{help:null},toolsoftool:[],tools:this._tools.map(function(e){return e.getState()}),selected:!1,activetool:null,editing:{session:this._session.state,history:this._session.getHistory().state,on:!1,dependencies:[],relations:[],father:!1,canEdit:!0},layerstate:this._layer.state},this.originalState={title:this.state.title,toolsoftool:[].concat(function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(this.state.toolsoftool))},this._unregisterStartSettersEventsKey=[],this._tools.forEach(function(e){return e.setSession(t._session)}),this._session.onafter("stop",function(){t.inEditing()&&(m.online&&t.editingService.stopSessionChildren(t.state.id),t._getFeaturesOption.registerEvents)&&t._unregisterGetFeaturesEvent()}),this._session.onafter("start",function(e){e.registerEvents&&(t._getFeaturesEvent={event:null,fnc:null},t._getFeaturesOption=e,t._registerGetFeaturesEvent(t._getFeaturesOption),w.LayerTypes.VECTOR===e.type)&&b.getContentLength()&&b.once("closecontent",function(){setTimeout(function(){t._mapService.getMap().dispatchEvent(t._getFeaturesEvent.event)})})})}s(S,n);a=S.prototype;a.getState=function(){return this.state},a.setShow=function(){this.state.show=!(0<arguments.length&&void 0!==arguments[0])||arguments[0]},a.getLayer=function(){return this._layer},a.setFather=function(e){this.state.editing.father=e},a.isFather=function(){return this.state.editing.father},a.addRelations=function(){var t=this;(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).forEach(function(e){return t.addRelation(e)})},a.revert=function(){return this._session.revert()},a.addRelation=function(e){this.state.editing.relations.push(e)},a.getDependencies=function(){return this.state.editing.dependencies},a.hasDependencies=function(){return 0<this.state.editing.dependencies.length},a.addDependencies=function(e){var t=this;e.forEach(function(e){return t.addDependency(e)})},a.addDependency=function(e){this.state.editing.dependencies.push(e)},a.getFieldUniqueValuesFromServer=function(){var i=this,e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).reset,n=void 0!==e&&e;this._layer.getWidgetData({type:"unique",fields:Object.values(this.uniqueFields).map(function(e){return e.name}).join()}).then(function(e){Object.entries(e.data).forEach(function(e){var e=r(e,2),t=e[0],e=e[1];n&&i.uniqueFields[t].input.options.values.splice(0),e.forEach(function(e){return i.uniqueFields[t].input.options.values.push(e)})})}).fail(console.warn)},a.getUniqueFieldsType=function(e){var t={},i=!1;return e.forEach(function(e){e.input&&"unique"===e.input.type&&(t[e.name]=e,i=!0)}),i&&t||null},a._resetUniqueValues=function(){this.getFieldUniqueValuesFromServer({reset:!0})},a.isVectorLayer=function(){return w.LayerTypes.VECTOR===this._layerType},a.setFeaturesOptions=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).filter;e?(e.nofeatures&&(e.nofeatures_field=e.nofeatures_field||this._layer.getEditingFields()[0].name),this._getFeaturesOption={filter:e,editing:!0,registerEvents:!1},e.constraint&&this.setConstraintFeaturesFilter(e)):this._getFeaturesOption=this.editingService.createEditingDataOptions(w.LayerTypes.TABLE===this._layerType?"all":"bbox",{layerId:this.getId()})},a.setEditingConstraints=function(){var t=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Object.keys(i).forEach(function(e){return t.constraints[e]=i[e]})},a.setLayerUniqueFieldValues=v(function*(){yield this.editingService.setLayerUniqueFieldValues(this.getId())}),a.clearLayerUniqueFieldsValues=function(){this.editingService.clearLayerUniqueFieldsValues(this.getId())},a.start=function(){function e(e){n.emit(o),n.setLayerUniqueFieldValues().then(v(function*(){var t,i;yield n.editingService.runEventHandler({type:o,id:a}),e.then((i=v(function*(e){n.stopLoading(),n.setEditing(!0),yield n.editingService.runEventHandler({type:"get-features-editing",id:a,options:{features:e}}),r.resolve({features:e})}),function(e){return i.apply(this,arguments)})).fail((t=v(function*(e){b.notify.error(e.message),yield n.editingService.runEventHandler({type:"error-editing",id:a,error:e}),n.stop(),n.stopLoading(),r.reject(e)}),function(e){return t.apply(this,arguments)}))}))}var n=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=$.Deferred(),a=this.getId(),i=this.editingService.getApplicationEditingConstraintById(a),o="start-editing",s=t.toolboxheader,s=void 0===s||s,l=t.startstopediting,l=void 0===l||l,u=(t.showtools,t.changingtools),d=t.tools,c=t.filter,f=(this.state.changingtools=void 0!==u&&u,d&&this.setEnablesDisablesTools(d),this.state.toolboxheader=s,this.state.startstopediting=l,c=i&&i.filter||this.constraints.filter||c,this.setFeaturesOptions({filter:c}),"featuresLockedByOtherUser"),p=this._layer.getFeaturesStore().onceafter(f,function(){b.showUserMessage({type:"warning",subtitle:n._layer.getName().toUpperCase(),message:"plugins.editing.messages.featureslockbyotheruser"})});this._unregisterStartSettersEventsKey.push(function(){return n._layer.getFeaturesStore().un(f,p)});return this._session&&(this._session.isStarted()?(this._start||(this.startLoading(),this._session.getFeatures(this._getFeaturesOption).then(e),this._start=!0),this.setEditing(!0)):m.ismobile&&this._mapService.isMapHidden()&&w.LayerTypes.VECTOR===this._layerType?(this.setEditing(!0),b.getService("map").onceafter("setHidden",function(){setTimeout(function(){n._start=!0,n.startLoading(),n.setFeaturesOptions({filter:c}),n._session.start(n._getFeaturesOption).then(e).fail(function(){return n.setEditing(!1)})},300)})):(this._start=!0,this.startLoading(),this._session.start(this._getFeaturesOption).then(e))),r.promise()},a.startLoading=function(){this.state.loading=!0},a.stopLoading=function(){this.state.loading=!1},a.getFeaturesOption=function(){return this._getFeaturesOption},a.stop=function(){var t=this,i=$.Deferred();return this.disableCanEditEvent&&this.disableCanEditEvent(),this._unregisterStartSettersEventsKey.forEach(function(e){return e()}),this._unregisterStartSettersEventsKey=[],this._session&&this._session.isStarted()?m.online&&(0<this.editingService.fathersInEditing(this.state.id).length?(this.stopActiveTool(),this.state.editing.on=!1,this.enableTools(!1),this.clearToolboxMessages(),this._unregisterGetFeaturesEvent(),this.editingService.stopSessionChildren(this.state.id),this.setSelected(!1),this.clearLayerUniqueFieldsValues()):this._session.stop().then(function(e){e.then(function(){t._start=!1,t.state.editing.on=!1,t.state.enabled=!1,t.stopLoading(),t._getFeaturesOption={},t.stopActiveTool(),t.enableTools(!1),t.clearToolboxMessages(),t.setSelected(!1),t.emit("stop-editing"),t.clearLayerUniqueFieldsValues(),i.resolve(!0)})}).fail(function(e){return i.reject(e)}).always(function(){return t.setSelected(!1)})):(this.setSelected(!1),i.resolve(!0)),i.promise()},a.save=function(){this._session.commit()},a._unregisterGetFeaturesEvent=function(){this._layerType===w.LayerTypes.VECTOR&&this._mapService.getMap().un(this._getFeaturesEvent.event,this._getFeaturesEvent.fnc)},a._registerGetFeaturesEvent=function(){var t=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this._layerType===w.LayerTypes.VECTOR&&i.filter.bbox&&(this._getFeaturesEvent.event="moveend",this._getFeaturesEvent.fnc=l(function(){var e=t.state.editing.canEdit;t._layer.getEditingLayer().setVisible(e),m.online&&e&&0===b.getContentLength()&&(i.filter.bbox=t._mapService.getMapBBOX(),t.state.loading=!0,t._session.getFeatures(i).then(function(e){e.then(function(){return t.state.loading=!1})}))},300),this._mapService.getMap().on("moveend",this._getFeaturesEvent.fnc))},a.setConstraintFeaturesFilter=function(e){this.constraintFeatureFilter=e},a.getEditingConstraints=function(){return this._constraints},a.getEditingConstraint=function(e){return this.getEditingConstraints()[e]},a.canEdit=function(){return this.state.editing.canEdit},a._canEdit=function(){var t,i,e,n=this;this._constraints.scale&&(t=this._constraints.scale,i=(""+d("editing.messages.constraints.enable_editing")+t).toUpperCase(),this.state.editing.canEdit=f(this._mapService.getMap().getView().getResolution())<=t,b.setModal(!this.state.editing.canEdit,i),e=function(e){n.state.editing.canEdit=f(e.target.getResolution())<=t,b.setModal(!n.state.editing.canEdit,i)},this._mapService.getMap().getView().on("change:resolution",e),this.disableCanEditEvent=function(){b.setModal(!1),n._mapService.getMap().getView().un("change:resolution",e)})},a._disableCanEdit=function(){this.state.editing.canEdit=!0,this.disableCanEditEvent&&this.disableCanEditEvent()},a.setMessage=function(e){this.state.message=e},a.getMessage=function(){return this.state.message},a.clearMessage=function(){this.setMessage(null)},a.clearToolboxMessages=function(){this.clearToolMessage(),this.clearMessage()},a.getId=function(){return this.state.id},a.setId=function(e){this.state.id=e},a.getTitle=function(){return this.state.title},a.setTitle=function(e){this.state.customTitle=!0,this.state.title=e},a.getColor=function(){return this.state.color},a.setEditing=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.setEnable(e),this.state.editing.on=e,this.enableTools(e)},a.inEditing=function(){return this.state.editing.on},a.isEnabled=function(){return this.state.enabled},a.setEnable=function(){return this.state.enabled=0<arguments.length&&void 0!==arguments[0]&&arguments[0],this.state.enabled},a.isLoading=function(){return this.state.loading},a.isDirty=function(){return this.state.editing.history.commit},a.isSelected=function(){return this.state.selected},a.setSelected=function(){this.state.selected=0<arguments.length&&void 0!==arguments[0]&&arguments[0],this.state.selected?this._canEdit():this._disableCanEdit()},a.getTools=function(){return this._tools},a.getToolById=function(t){return this._tools.find(function(e){return t===e.getId()})},a.setEnableTool=function(t){this._tools.find(function(e){return e.getId()===t}).setEnabled(!0)},a.setAddEnableTools=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.tools,i=void 0===t?{}:t,t=e.options,e=(void 0===t?{editing_constraints:!0}:t).editing_constraints,n=void 0!==e&&e,r=["addfeature","editattributes","movefeature","movevertex"],t=this._tools.filter(function(e){return n?e.getType().find(function(e){return"add_feature"===e}):-1!==r.indexOf(e.getId())}).map(function(e){e=e.getId();return{id:e,options:i[e]}});this.setEnablesDisablesTools({enabled:t}),this.enableTools(!0)},a.setUpdateEnableTools=function(e){var t=e.tools,i=void 0===t?{}:t,t=e.excludetools,n=void 0===t?[]:t,t=e.options,e=(void 0===t?{editing_constraints:!0}:t).editing_constraints,r=void 0!==e&&e,a=["editattributes","movefeature","movevertex"],t=this._tools.filter(function(e){return-1===n.indexOf(e.getId())&&(r?e.getType().find(function(e){return"change_feature"===e||"change_attr_feature"===e}):-1!==a.indexOf(e.getId()))}).map(function(e){e=e.getId();return{id:e,options:i[e]}});this.setEnablesDisablesTools({enabled:t}),this.enableTools(!0)},a.setDeleteEnableTools=function(){},a.setEnablesDisablesTools=function(e){var t,r,a=this;e&&(this.state.changingtools=!0,t=e.enabled,e=void 0===(e=e.disabled)?[]:e,r=(t=void 0===t?[]:t).length?[]:this._tools.map(function(e){return e.getId()}),t.forEach(function(e){var t,i=e.id,e=e.options,e=void 0===e?{}:e,n=a.getToolById(i);n&&(t=void 0!==(t=e.active)&&t,n.setOptions(e),n.isVisible()&&r.push(i),t&&a.setActiveTool(n),void 0===a._enabledtools&&(a._enabledtools=[]),a._enabledtools.push(n))}),e.forEach(function(e){var t=e.id;e.options;a.getToolById(t)&&(void 0===a._disabledtools&&(a._disabledtools=[]),a._disabledtools.push(t),r.push(t))}),this._tools.forEach(function(e){return!r.includes(e.getId())&&e.setVisible(!1)}),this.state.changingtools=!1)},a.enableTools=function(){var i=0<arguments.length&&void 0!==arguments[0]&&arguments[0],e=this._enabledtools||this._tools,n=this._disabledtools||[];e.forEach(function(e){var t=e.conditions.enabled,t=void 0===t?i:t,t=i&&n.length?-1===n.indexOf(e.getId()):"Boolean"===u(t)?t:t({bool:i,tool:e});e.setEnabled(t),i||e.setActive(i)})},a.setActiveTool=function(t){var n=this;this.stopActiveTool(t).then(function(){n.clearToolsOfTool(),(n.state.activetool=t).once("settoolsoftool",function(e){return e.forEach(function(e){return n.state.toolsoftool.push(e)})});function e(t,i){n.state.toolsoftool.forEach(function(e){-1!==t.indexOf(e.type)&&(e.options.active=i)})}t.on("active",function(){return e(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],!0)}),t.on("deactive",function(){return e(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],!1)}),t.start(n._mapService.isMapHidden()),n.setToolMessage(n.getToolMessage())})},a.clearToolsOfTool=function(){this.state.toolsoftool.splice(0)},a.getActiveTool=function(){return this.state.activetool},a.restartActiveTool=function(){var e=this.getActiveTool();this.stopActiveTool(),this.setActiveTool(e)},a.stopActiveTool=function(e){var t=this,i=$.Deferred(),n=this.getActiveTool();return n&&e!==n?(n.removeAllListeners(),n.stop(!0).then(function(){t.clearToolsOfTool(),t.clearToolMessage(),t.state.activetool=null,setTimeout(i.resolve)})):(e&&e.removeAllListeners(),i.resolve()),i.promise()},a.clearToolMessage=function(){this.state.toolmessages.help=null},a.getToolMessage=function(){return this.getActiveTool().getMessage()},a.setToolMessage=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.state.toolmessages.help=e&&e.help||null},a.getSession=function(){return this._session},a.getEditor=function(){return this._editor},a.setEditor=function(e){this._editor=e},a.hasChildren=function(){return this._layer.hasChildren()},a.hasFathers=function(){return this._layer.hasFathers()},a.hasRelations=function(){return this._layer.hasRelations()},a.resetDefault=function(){this.state.title=this.originalState.title,this.state.toolboxheader=!0,this.state.startstopediting=!0,this.constraints={filter:null,show:null,tools:[]},this._enabledtools&&(this._enabledtools=void 0,this.enableTools(),this._tools.forEach(function(e){return e.resetDefault()})),this._disabledtools=null,this.setShow(!0)},S.create=function(e){var i,n,r,a,t=e.getEditingCapabilities(),o=e.getType(),s=void 0===o||w.LayerTypes.VECTOR===o,l=s&&e.getGeometryType(),u=s&&k.isPointGeometryType(l),d=s&&k.isLineGeometryType(l),c=s&&k.isPolygonGeometryType(l),f=w.LayerTypes.TABLE===o,l=l&&k.isMultiGeometry(l),u=s&&(u?"Point":d?"Line":"Polygon");return new S({id:e.getId(),color:e.getColor(),type:o,layer:e,lngTitle:"editing.toolbox.title",title:" "+e.getTitle(),constraints:e.getEditingConstrains(),tools:[s&&{id:"addfeature",type:["add_feature"],name:"editing.tools.add_feature",icon:"add"+u+".png",layer:e,row:1,op:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=new g.EditingWorkflow(h({},e,{type:"addfeature",steps:[new y.AddFeatureStep(e),new y.OpenFormStep(e)]}));return e.addToolsOfTools({step:e.getStep(0),tools:["snap","measure"]}),e}},s&&{id:"editattributes",type:["change_attr_feature"],name:"editing.tools.update_feature",icon:"editAttributes.png",layer:e,row:1,op:function(){return new g.EditingWorkflow(h({},0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},{helpMessage:"editing.tools.update_feature",type:"editfeatureattributes",steps:[new y.PickFeatureStep,new y.ChooseFeatureStep,new y.OpenFormStep]}))}},s&&{id:"deletefeature",type:["delete_feature"],name:"editing.tools.delete_feature",icon:"delete"+u+".png",layer:e,row:1,op:function(){return new g.EditingWorkflow(h({},0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},{type:"deletefeature",steps:[new y.PickFeatureStep,new y.ChooseFeatureStep,new y.DeleteFeatureStep,new y.ConfirmStep({type:"delete"})]}))}},(d||c)&&{id:"movevertex",type:["change_feature"],name:"editing.tools.update_vertex",icon:"moveVertex.png",layer:e,row:1,op:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=new g.EditingWorkflow(h({},e,{type:"modifygeometryvertex",helpMessage:"editing.tools.update_vertex",steps:[new y.PickFeatureStep(e),new y.ChooseFeatureStep,new y.ModifyGeometryVertexStep]}));return e.addToolsOfTools({step:e.getStep(2),tools:["snap","measure"]}),e}},s&&{id:"editmultiattributes",type:["change_attr_feature"],name:"editing.tools.update_multi_features",icon:"multiEditAttributes.png",layer:e,row:2,once:!0,op:function(){return new g.EditingWorkflow(h({},0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},{type:"editmultiattributes",helpMessage:"editing.tools.update_multi_features",registerEscKeyEvent:!0,steps:[new y.SelectElementsStep({type:"multiple",steps:{select:{description:"editing.workflow.steps."+(m.ismobile?"selectDrawBoxAtLeast2Feature":"selectMultiPointSHIFTAtLeast2Feature"),buttonnext:{disabled:!0,condition:function(e){e=e.features;return(void 0===e?[]:e).length<2},done:function(){}},directive:"t-plugin",dynamic:0,done:!1}}}),new y.OpenFormStep({multi:!0})]}))}},s&&{id:"movefeature",type:["change_feature"],name:"editing.tools.move_feature",icon:"move"+u+".png",layer:e,row:2,op:function(){return new g.EditingWorkflow(h({},0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},{type:"movefeature",helpMessage:"editing.tools.move_feature",steps:[new y.PickFeatureStep,new y.ChooseFeatureStep,new y.MoveFeatureStep]}))}},s&&{id:"copyfeaturesfromotherlayer",type:["add_feature"],name:"editing.tools.pastefeaturesfromotherlayers",icon:"pasteFeaturesFromOtherLayers.png",layer:e,once:!0,conditions:{enabled:(o=b.getService("map"),i=e.getId(),n=e.getGeometryType(),r=o.defaultsLayers.selectionLayer.getSource(),a={bool:!1,tool:void 0},function(e){var t=e.bool,e=e.tool;return a.tool=void 0===e?{}:e,r[(a.bool=t)?"on":"un"]("addfeature",p),r[t?"on":"un"]("removefeature",p),p()})},row:2,op:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=new y.OpenFormStep(h({},e,{help:"editing.steps.help.copy"}));return new g.EditingWorkflow(h({},e,{type:"copyfeaturesfromotherlayer",steps:[new y.CopyFeaturesFromOtherLayerStep(h({},e,{help:"editing.steps.help.copy",openFormTask:t.getTask()})),t],registerEscKeyEvent:!0}))}},s&&{id:"copyfeatures",type:["add_feature"],name:"editing.tools.copy",icon:"copy"+u+".png",layer:e,once:!0,row:2,op:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new g.EditingWorkflow(h({},e,{type:"copyfeatures",steps:[new y.SelectElementsStep(h({},e,{help:"editing.steps.help.copy",type:m.ismobile?"single":"multiple",steps:{select:{description:"editing.workflow.steps."+(m.ismobile?"selectPoint":"selectPointSHIFT"),directive:"t-plugin",done:!1}}}),!0),0<=e.layer.getGeometryType().indexOf("Point")?void 0:new y.GetVertexStep(h({},e,{help:"editing.steps.help.copy",steps:{from:{description:"editing.workflow.steps.selectStartVertex",directive:"t-plugin",done:!1}}}),!0),new y.MoveElementsStep(h({},e,{help:"editing.steps.help.copy",steps:{to:{description:"editing.workflow.steps.selectToPaste",directive:"t-plugin",done:!1}}}),!0)].filter(Boolean),registerEscKeyEvent:!0}))}},s&&l&&{id:"addPart",type:["add_feature","change_feature"],name:"editing.tools.addpart",icon:"addPart.png",layer:e,once:!0,row:3,op:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=new g.EditingWorkflow(h({},e,{type:"addparttomultigeometries",helpMessage:"editing.tools.addpart",steps:[new y.PickFeatureStep({steps:{select:{description:"editing.workflow.steps.select",directive:"t-plugin",done:!1}}}),new y.ChooseFeatureStep({help:"editing.steps.help.select_element"}),new y.AddFeatureStep(h({},e,{help:"editing.steps.help.select_element",add:!1,steps:{addfeature:{description:"editing.workflow.steps.draw_part",directive:"t-plugin",done:!1}},onRun:function(e){var t=e.inputs;e.context;i.emit("settoolsoftool",[{type:"snap",options:{layerId:t.layer.getId(),source:t.layer.getEditingLayer().getSource(),active:!0}}]),i.emit("active",["snap"])},onStop:function(){i.emit("deactive",["snap"])}})),new y.AddPartToMultigeometriesStep(h({},e,{help:"editing.steps.help.select_element"}))],registerEscKeyEvent:!0}));return i}},s&&l&&{id:"deletePart",type:["change_feature"],name:"editing.tools.deletepart",icon:"deletePart.png",layer:e,row:3,op:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new g.EditingWorkflow(h({},e,{type:"deletepartfrommultigeometries",steps:[new y.PickFeatureStep,new y.ChooseFeatureStep,new y.DeletePartFromMultigeometriesStep(e)],helpMessage:"editing.tools.deletepart"}))}},(d||c)&&{id:"splitfeature",type:["change_feature"],name:"editing.tools.split",icon:"splitFeatures.png",layer:e,row:3,once:!0,op:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new g.EditingWorkflow(h({},e,{type:"splitfeature",steps:[new y.SelectElementsStep(h({},e,{help:"editing.steps.help.split",type:m.ismobile?"single":"multiple",steps:{select:{description:"editing.workflow.steps."+(m.ismobile?"selectPoint":"selectPointSHIFT"),directive:"t-plugin",done:!1}}}),!0),new y.SplitFeatureStep(h({},e,{help:"editing.steps.help.split",steps:{draw_line:{description:"editing.workflow.steps.draw_split_line",directive:"t-plugin",done:!1}}}),!0)],registerEscKeyEvent:!0}))}},(d||c)&&{id:"mergefeatures",type:["change_feature"],name:"editing.tools.merge",icon:"mergeFeatures.png",layer:e,row:3,once:!0,op:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new g.EditingWorkflow(h({},e,{type:"mergefeatures",steps:[new y.SelectElementsStep(h({},e,{type:"bbox",help:"editing.steps.help.merge",steps:{select:{description:"editing.workflow.steps."+(m.ismobile?"selectDrawBox":"selectSHIFT"),directive:"t-plugin",done:!1}}}),!0),new y.MergeFeaturesStep(h({},e,{help:"editing.steps.help.merge",steps:{choose:{description:"editing.workflow.steps.merge",directive:"t-plugin",done:!1}}}),!0)],registerEscKeyEvent:!0}))}},(d||c)&&{id:"copyfeaturefromexternallayer",type:["add_feature"],name:"editing.tools.copyfeaturefromexternallayer",icon:"copyPolygonFromFeature.png",layer:e,row:3,once:!0,visible:function(t){function i(e){return!(e="VECTOR"===e.getType()&&e.getSource().getFeatures())||!e.length||F(e[0].getGeometry().getType(),r)}var n=b.getService("map"),r=t.getLayer().getGeometryType();return n.onbefore("loadExternalLayer",function(e){return!t.isVisible()&&t.setVisible(i(e))}),n.onafter("unloadExternalLayer",function(e){e=t.isVisible()&&"VECTOR"===e.getType()&&e.getSource().getFeatures();e&&e.length&&F(e[0].getGeometry().getType(),r)&&t.setVisible(n.getExternalLayers().find(function(e){return void 0!==i(e)}))}),!1},op:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return new g.EditingWorkflow(h({},e,{type:"addfeaturefrommapvectorlayers",steps:[new y.SelectElementsStep(h({},e,{type:"external",help:"editing.steps.help.copy"}),!1),new y.OpenFormStep(h({},e,{help:"editing.steps.help.copy"}))],registerEscKeyEvent:!0}))}},f&&{id:"addfeature",type:["add_feature"],name:"editing.tools.add_feature",icon:"addTableRow.png",layer:e,op:function(){return new g.EditingWorkflow(h({},0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},{type:"addtablefeature",steps:[new y.AddTableFeatureStep,new y.OpenFormStep]}))}},f&&{id:"edittable",type:["delete_feature","change_attr_feature"],name:"editing.tools.update_feature",icon:"editAttributes.png",layer:e,once:!0,op:function(){return new g.EditingWorkflow(h({type:"edittable"},0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},{backbuttonlabel:"plugins.editing.form.buttons.save_and_back_table",steps:[new y.OpenTableStep]}))}}].filter(function(e){return!(!e||t&&0<!e.type.filter(function(e){return t.includes(e)}).length||(t&&(e.row=1),0))}).map(function(e){return new _(e)})});function p(){var e=a.bool&&0<r.getFeatures().filter(function(e){var t=e.getGeometry()&&e.getGeometry().getType();return e.__layerId!==i&&F(n,t)&&(n===t||k.isMultiGeometry(n)||!k.isMultiGeometry(t))}).length;return a.tool.setEnabled(e),e}},e.exports=S},{"../g3wsdk/workflow/workflow":38,"../services/editingservice":42,"../toolboxes/tool":45,"../workflows":64}],47:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.areCoordinatesEqual=function(e){function t(e){return g3wsdk.core.geoutils.areCoordinatesEqual(n,e)}var i=e.feature,n=e.coordinates,r=i.getGeometry(),e=r.getType();switch(e){case"Polygon":case"MultiLineString":return _.flatMap(r.getCoordinates()).some(t);case"LineString":case"MultiPoint":return r.getCoordinates().some(t);case"MultiPolygon":return r.getPolygons().some(function(e){return _.flatMap(e.getCoordinates()).some(t)});case"Point":return g3wsdk.core.geoutils.areCoordinatesEqual(n,r.getCoordinates());default:return!1}}},{}],48:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.chooseFeatureFromFeatures=function(e){var t=e.features,o=void 0===t?[]:t,s=e.inputs;return new Promise(function(e,t){var i=[],n=new(Vue.extend(l.default))({features:Array.isArray(o)?o:[],feature:i,attributes:s.layer.getEditingFields().map(function(e){return{name:e.name,label:e.label}})}),r=n.$mount().$el,a=g3wsdk.gui.GUI.showModalDialog({title:u("editing.modal.tools.copyfeaturefromprojectlayer.title"),className:"modal-left",closeButton:!1,message:r,buttons:{cancel:{label:"Cancel",className:"btn-danger",callback:function(){t()}},ok:{label:"Ok",className:"btn-success",callback:function(){e(i[0])}}}});a.find("button.btn-success").prop("disabled",!0),n.$watch("feature",function(e){return a.find("button.btn-success").prop("disabled",null===e)})})};var i=e("../components/ChooseFeatureToEdit.vue"),l=(e=i)&&e.__esModule?e:{default:e};var u=g3wsdk.core.i18n.tPlugin},{"../components/ChooseFeatureToEdit.vue":2}],49:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.cloneFeature=function(e,t){e=e.cloneNew(),t=t&&t.getEditingFields().find(function(e){return e.pk});t&&!1===t.editable&&e.set(t.name,null);return e}},{}],50:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.convertFeaturesGeometryToGeometryTypeOfLayer=function(e){var t=e.features,t=void 0===t?[]:t,i=e.geometryType,n=[];return t.forEach(function(e){var t=e.getGeometry()&&e.getGeometry().getType();i===t?n.push(e):!g3wsdk.core.geoutils.isSameBaseGeometryType(t,i)||!g3wsdk.core.geometry.Geometry.isMultiGeometry(i)&&g3wsdk.core.geometry.Geometry.isMultiGeometry(t)||((t=e.clone()).__layerId=e.__layerId,t.setGeometry(g3wsdk.core.geoutils.convertSingleMultiGeometry(e.getGeometry(),i)),n.push(t))}),n}},{}],51:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.evaluateExpressionFields=void 0;i.evaluateExpressionFields=(n=u(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=e.inputs,t=e.context,o=e.feature,s=[];return a.layer.getFieldsWithValues(o,{exclude:t.excludeFields,get_default_value:void 0!==t.get_default_value&&t.get_default_value}).forEach(function(i){var n,r;i.input.options.default_expression&&(i.input.options.default_expression.apply_on_update||o.isNew())&&s.push(new Promise((n=u(function*(e,t){try{yield g3wsdk.core.input.inputService.handleDefaultExpressionFormInput({field:i,feature:o,qgs_layer_id:a.layer.getId(),parentData:(0,l.getParentFormData)()}),o.set(i.name,i.value),e(o)}catch(e){t(e)}}),function(e,t){return n.apply(this,arguments)}))),i.input.options.filter_expression&&s.push(new Promise((r=u(function*(e,t){try{yield g3wsdk.core.input.inputService.handleFilterExpressionFormInput({field:i,feature:o,qgs_layer_id:a.layer.getId(),parentData:(0,l.getParentFormData)()}),o.set(i.name,i.value),e(o)}catch(e){t(e)}}),function(e,t){return r.apply(this,arguments)})))}),yield Promise.allSettled(s),o}),function(){return n.apply(this,arguments)});var n,l=e("./getParentFormData");function u(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}},{"./getParentFormData":56}],52:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.getChildFieldNameFromRelation1_1=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.relation,e=e.field;return t.getPrefix()?e.name.split(t.getPrefix())[1]:e.name}},{}],53:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.getFeaturesFromSelectionFeatures=function(e){var t=e.layerId,e=e.geometryType;return(0,n.convertFeaturesGeometryToGeometryTypeOfLayer)({geometryType:e,features:g3wsdk.gui.GUI.getService("map").defaultsLayers.selectionLayer.getSource().getFeatures().filter(function(e){return e.__layerId!==t})})};var n=e("./convertFeaturesGeometryToGeometryTypeOfLayer")},{"./convertFeaturesGeometryToGeometryTypeOfLayer":50}],54:[function(c,e,t){Object.defineProperty(t,"__esModule",{value:!0});var i,n;t.getFormFields=(i=function*(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=t.inputs,i=t.context,r=t.feature,t=t.isChild,a=void 0!==t&&t,o=!1,s=c("../services/editingservice"),l=g3wsdk.core.workflow.WorkflowsStack.getFirst().getInputs().layer.getId(),u=n.layer.getId(),d=[],t=n.layer.getFieldsWithValues(r,{exclude:i.excludeFields,get_default_value:void 0!==i.get_default_value&&i.get_default_value});return t.forEach(function(e){e.validate.unique&&e.editable&&(o=!0,d.push({field:e,_value:r.get(e.name)}))}),d.forEach(function(e){var t=e._value,i=e.field;(a?s.getChildLayerUniqueFieldValues({layerId:u,relationLayerId:l,field:i}):s.getLayerUniqueFieldValues({layerId:u,field:i})).forEach(function(e){i.validate.exclude_values.add(-1===[null,void 0].indexOf(e)?""+e:e)}),n.features.forEach(function(e){e=e.get(i.name);-1===[null,void 0].indexOf(e)&&i.validate.exclude_values.add(""+e)}),i.validate.exclude_values.delete(t)}),o&&(s.subscribe("savedfeature_"+u,e=function(){return d.forEach(function(e){var t=e._value,e=e.field;t!==e.value&&(a?s.changeRelationLayerUniqueFieldValues({layerId:u,relationLayerId:l,field:e,oldValue:t,newValueconvertSingleMultiGeometry:e.value}):s.changeLayerUniqueFieldValues({layerId:u,field:e,oldValue:t,newValue:e.value}))}),!1===a&&s.saveTemporaryRelationsUniqueFieldsValues(u),{once:!0}}),s.subscribe("closeform_"+u,function(){return s.unsubscribe("savedfeature_"+u,e),s.clearTemporaryRelationsUniqueFieldsValues(u),{once:!0}})),t},n=function(){var s=i.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})},function(){return n.apply(this,arguments)})},{"../services/editingservice":42}],55:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.getNotEditableFieldsNoPkValues=function(e){var i=e.layer,n=e.feature;return i.getEditingNotEditableFields().reduce(function(e,t){return e[t]=i.isPkField(t)?null:n.get(t),e},{})}},{}],56:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.getParentFormData=function(){var e,t,i,n;if(1<g3wsdk.core.workflow.WorkflowsStack.getLength())return i=g3wsdk.core.workflow.WorkflowsStack.getParent().getInputs(),e=i.features,t=i.layer,i=i.fields,i=void 0===i?[]:i,n=e[e.length-1].clone(),i.forEach(function(e){var t=e.name,e=e.value;n.set(t,e)}),{feature:n,qgs_layer_id:t.getId()}}},{}],57:[function(f,e,t){Object.defineProperty(t,"__esModule",{value:!0});var i,n;t.getRelation1_1ChildFeature=(i=function*(e){var t,i,n=e.relation,r=e.fatherFormRelationField,e=f("../services/editingservice"),a=n.getFather(),o=n.getChild(),s=n.getChildField()[0],l=!1,u=e.getLayerById(o).getEditingSource().readFeatures().find(function(e){return e.get(s)===r.value});if(void 0===(u=void 0===u&&(i=(t=e.getLayerById(o).getFeaturesStore()).oncebefore("featuresLockedByOtherUser",function(e){u=e[0]}),yield e.getLayersDependencyFeatures(a,{feature:new ol.Feature(function(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i;return e}({},r.name,r.value)),relations:[n]}),t.un("featuresLockedByOtherUser",i),void 0===u)?e.getLayerById(o).getEditingSource().readFeatures().find(function(e){return e.get(s)===r.value}):u))try{var d=e.getProjectLayerById(o),c=(yield g3wsdk.core.data.DataRouterService.getData("search:features",{inputs:{layer:d,formatter:0,filter:g3wsdk.core.utils.createFilterFormInputs({layer:d,search_endpoint:"api",inputs:[{attribute:s,value:r.value}]}),search_endpoint:"api"},outputs:!1})).data;c&&c[0]&&1===c[0].features.length&&(l=!0,u=c[0].features[0])}catch(e){}return{feature:u,locked:l}},n=function(){var s=i.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})},function(e){return n.apply(this,arguments)})},{"../services/editingservice":42}],58:[function(i,e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.handleRelation1_1LayerFields=void 0;t.handleRelation1_1LayerFields=(n=r(function*(){var c,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},f=e.layerId,t=e.features,p=void 0===t?[]:t,t=e.fields,h=void 0===t?[]:t,g=e.task;0!==p.length&&(t=(c=i("../services/editingservice")).getRelation1_1ByLayerId(f).map(function(d){return new Promise((t=r(function*(e){var t,i,n,r,a,o,s,l,u;f===d.getFather()&&(t=d.getFatherField()[0],null!==(i=p[0].get(t))&&(n=d.getChild(),r=d.getChildField()[0],a=c.getLayerById(n).getEditingSource(),o=s=void 0,s=a.readFeatures().find(function(e){return e.get(r)===i}),l=void 0!==c.getRelation1_1EditingLayerFieldsReferredToChildRelation(d).find(function(e){var t=e.name;return h.find(function(e){return e.name==t}).update}),u=void 0===s,l)&&(u?((s=new g3wsdk.core.layer.features.Feature).setTemporaryId(),c.getProjectLayerById(n).getEditingFields().forEach(function(e){return s.set(e.name,null)}),s.set(r,h.find(function(e){return t===e.name}).value),a.addFeature(s),o=s):s&&(o=s.clone()),s))&&(c.getRelation1_1EditingLayerFieldsReferredToChildRelation(d).filter(function(e){return e.editable}).forEach(function(e){return o.set((0,y.getChildFieldNameFromRelation1_1)({relation:d,field:e}),p[0].get(e.name))}),u?(c.getLayerById(f).isPkField(t)&&s.set(r,p[0].getId()),g.getContext().session.pushAdd(n,o,!1)):(a.updateFeature(o),g.getContext().session.pushUpdate(n,o,s))),e()}),function(e){return t.apply(this,arguments)}));var t}),yield Promise.allSettled(t))}),function(){return n.apply(this,arguments)});var n,y=i("./getChildFieldNameFromRelation1_1");function r(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}},{"../services/editingservice":42,"./getChildFieldNameFromRelation1_1":52}],59:[function(d,e,t){Object.defineProperty(t,"__esModule",{value:!0}),t.listenRelation1_1FieldChange=void 0;var i,c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f=(t.listenRelation1_1FieldChange=(i=g(function*(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.layerId,t=t.fields,l=void 0===t?[]:t,n=[],u=d("../services/editingservice"),i=!0,t=!1,r=void 0;try{for(var a,o=u.getRelation1_1ByLayerId(e)[Symbol.iterator]();!(i=(a=o.next()).done);i=!0){var s=yield*function*(r){var e=r.getChild(),t=r.getFatherField(),a={},o=l.find(function(e){return t.includes(e.name)});if(!o||!u.getLayerById(e))return{v:void 0};var i,s=u.getRelation1_1EditingLayerFieldsReferredToChildRelation(r).reduce(function(e,t){var i=l.find(function(e){return e.name===t.name});return e[i.name]=i.editable,e},{});o.input.options.loading.state="loading",a[o.value]=yield(0,p.getRelation1_1ChildFeature)({relation:r,fatherFormRelationField:o}),o.input.options.loading.state=null,a[o.value].locked&&Object.keys(s).forEach(function(t){return l.find(function(e){return e.name===t}).editable=!1}),n.push(f.VM.$watch(function(){return o.value},(i=g(function*(e){if(e){if(o.editable=!1,o.input.options.loading.state="loading",void 0===a[o.value])try{a[o.value]=yield(0,p.getRelation1_1ChildFeature)({relation:r,fatherFormRelationField:o})}catch(e){}var e,i=(e=a[o.value]).feature,n=e.locked;Object.keys(s).forEach(function(t){var e=l.find(function(e){return e.name===t});e.editable=!n&&s[t],e.value=i?i.get((0,h.getChildFieldNameFromRelation1_1)({relation:r,field:e})):null})}o.input.options.loading.state=null,o.editable=!0}),function(e){return i.apply(this,arguments)})))}(a.value);if("object"===(void 0===s?"undefined":c(s)))return s.v}}catch(e){t=!0,r=e}finally{try{!i&&o.return&&o.return()}finally{if(t)throw r}}return n}),function(){return i.apply(this,arguments)}),d("../eventbus")),p=d("./getRelation1_1ChildFeature"),h=d("./getChildFieldNameFromRelation1_1");function g(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}},{"../eventbus":24,"../services/editingservice":42,"./getChildFieldNameFromRelation1_1":52,"./getRelation1_1ChildFeature":57}],60:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.promisify=function(i){if(i instanceof Promise)return i;return new Promise(function(e,t){i.then(e).fail(t)})}},{}],61:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.setAndUnsetSelectedFeaturesStyle=function(){function e(){var t=(0,s.setFeaturesSelectedStyle)(a,r);(0,o.promisify)(i).finally(function(){a.flat().forEach(function(e){return e.setStyle(t)})})}var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=t.promise,n=t.inputs,r=t.style,t=n.layer,n=n.features,a=void 0===n?[]:n,n=u.LayerTypes.VECTOR===t.getType(),t=l.getLength();n&&t?setTimeout(function(){e()}):n&&e()};var o=e("../utils/promisify"),s=e("../utils/setFeaturesSelectedStyle"),l=g3wsdk.core.workflow.WorkflowsStack,u=g3wsdk.core.layer.Layer},{"../utils/promisify":60,"../utils/setFeaturesSelectedStyle":62}],62:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.setFeaturesSelectedStyle=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],t=arguments[1];{var i,n,r;if(0<e.length)return e=e.flat(),i=function(e){return{originalStyle:e.getStyle(),selectedStyle:g3wsdk.core.geoutils.createSelectedStyle({geometryType:e.getGeometry().getType()})}}(e[0]),n=i.originalStyle,r=i.selectedStyle,e.forEach(function(e){return e.setStyle(t||r)}),n}}},{}],63:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.setNullMediaFields=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layer,i=e.feature;t.getEditingMediaFields({}).forEach(function(e){return i.set(e,null)})}},{}],64:[function(d,j,e){Object.defineProperty(e,"__esModule",{value:!0}),e.SplitFeatureStep=e.SelectElementsStep=e.PickProjectLayerFeaturesStep=e.PickFeatureStep=e.OpenTableStep=e.OpenFormStep=e.MoveFeatureStep=e.MoveElementsStep=e.ModifyGeometryVertexStep=e.MergeFeaturesStep=e.LinkRelationStep=e.GetVertexStep=e.DeletePartFromMultigeometriesStep=e.DeleteFeatureStep=e.CopyFeaturesFromOtherProjectLayerStep=e.CopyFeaturesFromOtherLayerStep=e.ConfirmStep=e.ChooseFeatureStep=e.AddPartToMultigeometriesStep=e.AddFeatureStep=e.AddTableFeatureStep=void 0;var D=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,n=arguments[t];for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},B=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var i=t,n=[],r=!0,t=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!i||n.length!==i);r=!0);}catch(e){t=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(t)throw a}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},t=function(e,t,i){return t&&V(e.prototype,t),i&&V(e,i),e};function V(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}var U=d("../utils/cloneFeature"),G=d("../utils/areCoordinatesEqual"),m=d("../utils/evaluateExpressionFields"),z=d("../utils/getParentFormData"),N=d("../utils/setFeaturesSelectedStyle"),b=d("../utils/setAndUnsetSelectedFeaturesStyle"),q=d("../utils/getFormFields"),H=d("../utils/convertFeaturesGeometryToGeometryTypeOfLayer"),W=d("../utils/setNullMediaFields"),K=d("../utils/getNotEditableFieldsNoPkValues"),Z=d("../utils/getFeaturesFromSelectionFeatures"),X=d("../utils/chooseFeatureFromFeatures"),J=d("../utils/handleRelation1_1LayerFields"),Y=d("../utils/listenRelation1_1FieldChange"),Q=ne(d("../components/CopyFeaturesFromOtherLayers.vue")),ee=ne(d("../components/CopyFeaturesFromOtherProjectLayer.vue")),te=ne(d("../components/Table.vue")),ie=d("../interactions/pickfeaturesinteraction"),i=d("../g3wsdk/workflow/task");function ne(e){return e&&e.__esModule?e:{default:e}}function y(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}function re(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function s(e,t){if(e)return!t||"object"!=typeof t&&"function"!=typeof t?e:t;throw new ReferenceError("this hasn't been initialised - super() hasn't been called")}function n(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var ae=g3wsdk.core.ApplicationState,c=g3wsdk.core.geometry.Geometry,r=g3wsdk.core.geoutils,oe=r.convertSingleMultiGeometry,se=r.isSameBaseGeometryType,le=r.multiGeometryToSingleGeometries,ue=r.singleGeometriesToMultiGeometry,de=r.dissolve,ce=r.splitFeatures,fe=g3wsdk.core.geoutils.Geometry.removeZValueToOLFeatureGeometry,pe=g3wsdk.core.layer.Layer,he=g3wsdk.core.layer.features.Feature,ge=g3wsdk.core.project.ProjectsRegistry,v=g3wsdk.gui.GUI,r=g3wsdk.core.workflow,l=r.Step,f=r.WorkflowsStack,r=g3wsdk.core.i18n,ye=r.t,ve=r.tPlugin,_e=g3wsdk.core.data.DataRouterService,r=g3wsdk.ol.interactions.measure,me=r.AreaInteraction,be=r.LengthInteraction,r=g3wsdk.ol.interactions,we=r.PickFeatureInteraction,ke=r.PickCoordinatesInteraction,r=g3wsdk.ol.utils,Fe=r.createMeasureTooltip,Se=r.removeMeasureTooltip,xe=g3wsdk.constant.G3W_FID,Ee=g3wsdk.core.catalog.CatalogLayersStoresRegistry,r=g3wsdk.gui.vue.Component,Ie=g3wsdk.gui.vue.services.FormService,Te=d("../form/editingform");e.AddTableFeatureStep=(n(a,i.EditingTask),t(a,[{key:"run",value:function(e,t){var i=$.Deferred(),n=0<e.features.length?e.features[e.features.length-1]:e.layer.createNewFeature();return n.setTemporaryId(),e.layer.getEditingLayer().getEditingSource().addFeature(n),t.session.pushAdd(e.layer.getId(),n,!1),e.features.push(n),this.setContextGetDefaultValue(!0),i.resolve(e,t),i.promise()}}]),a);function a(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(o(this,a),e.help="editing.steps.help.new",s(this,(a.__proto__||Object.getPrototypeOf(a)).call(this,e)));return s(e.task=t,new l(e))}e.AddFeatureStep=(n(u,i.EditingTask),t(u,[{key:"run",value:function(i,e){var n,r,a,o=this,s=(this._stopPromise=$.Deferred(),$.Deferred()),t=i.layer,l=t.getEditingLayer(),u=e.session,d=t.getId();return pe.LayerTypes.VECTOR===t.getType()&&((0,b.setAndUnsetSelectedFeaturesStyle)({promise:this._stopPromise,inputs:i,style:this.selectStyle}),n=t.getEditingGeometryType(),this.geometryType=c.getOLGeometry(n),r=l.getSource(),a=t.getEditingFields(),e=new ol.source.Vector,this.drawInteraction=new ol.interaction.Draw({type:this.geometryType,source:e,condition:this._condition,freehandCondition:ol.events.condition.never,finishCondition:this._finishCondition}),this.addInteraction(this.drawInteraction),this.drawInteraction.setActive(!0),this.drawInteraction.on("drawstart",function(e){e=e.feature;o.drawingFeature=e,document.addEventListener("keydown",o._delKeyRemoveLastPoint)}),this.drawInteraction.on("drawend",function(t){var e=void 0;o._add?(a.forEach(function(e){t.feature.set(e.name,null)}),(e=new he({feature:t.feature})).setTemporaryId(),r.addFeature(e),u.pushAdd(d,e,!1)):e=t.feature,e=c.addZValueToOLFeatureGeometry({feature:e,geometryType:n}),i.features.push(e),o.setContextGetDefaultValue(!0),o.fireEvent("addfeature",e),s.resolve(i)})),s.promise()}},{key:"addMeasureInteraction",value:function(){var e={projection:this.getMapService().getProjection(),drawColor:"transparent",feature:this.drawingFeature};c.isLineGeometryType(this.geometryType)?this.measureInteraction=new be(e):c.isPolygonGeometryType(this.geometryType)&&(this.measureInteraction=new me(e)),this.measureInteraction&&(this.measureInteraction.setActive(!0),this.addInteraction(this.measureInteraction))}},{key:"removeMeasureInteraction",value:function(){this.measureInteraction&&(this.measureInteraction.clear(),this.removeInteraction(this.measureInteraction),this.measureInteraction=null)}},{key:"removeLastPoint",value:function(){if(this.drawInteraction)try{this.drawInteraction.removeLastPoint()}catch(e){}}},{key:"stop",value:function(){return this.removeInteraction(this.drawInteraction),this.removeMeasureInteraction(),this.drawInteraction=null,this.drawingFeature=null,document.removeEventListener("keydown",this._delKeyRemoveLastPoint),this._stopPromise.resolve(!0),!0}}]),u);function u(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(o(this,u),e.help="editing.steps.help.draw_new_feature",s(this,(u.__proto__||Object.getPrototypeOf(u)).call(this,e))),i=(t._add=void 0===e.add||e.add,t._busy=!1,t.drawInteraction,t.measeureInteraction,t.drawingFeature,t._snap=!1!==e.snap,t._finishCondition=e.finishCondition||function(){return!0},t._condition=e.condition||function(){return!0},t._stopPromise,t._delKeyRemoveLastPoint=function(e){return 46===e.keyCode&&t.removeLastPoint()},e.task=t,new l(e));return e.steps&&t.setSteps(e.steps),e.onRun&&t.on("run",e.onRun),e.onStop&&t.on("run",e.onStop),s(t,i)}e.AddPartToMultigeometriesStep=(n(p,i.EditingTask),t(p,[{key:"run",value:function(e,t){var i=$.Deferred(),n=e.layer.getId(),r=e.features[0],a=r.getGeometry(),o=r.clone();return a.setCoordinates([].concat(re(a.getCoordinates()),re(e.features[1].getGeometry().getCoordinates()))),(0,m.evaluateExpressionFields)({inputs:e,context:t,feature:r}).finally(function(){t.session.pushUpdate(n,r,o),e.features=[r],i.resolve(e)}),i.promise()}}]),p);function p(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(o(this,p),s(this,(p.__proto__||Object.getPrototypeOf(p)).call(this,e)));return s(e.task=t,new l(e))}e.ChooseFeatureStep=(n(h,i.EditingTask),t(h,[{key:"run",value:function(t){var i=$.Deferred();return 1===t.features.length?i.resolve(t):(0,X.chooseFeatureFromFeatures)({features:t.features,inputs:t}).then(function(e){t.features=[e],i.resolve(t)}).catch(function(e){i.reject(e)}),i.promise()}},{key:"stop",value:function(){return!0}}]),h);function h(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(o(this,h),s(this,(h.__proto__||Object.getPrototypeOf(h)).call(this,e)));return s(e.task=t,new l(e))}var Ce={delete:{fnc:function(t){var i=d("../services/editingservice"),n=$.Deferred(),e=t.layer,r=e.getEditingLayer(),a=t.features[0],o=e.getId(),e=e.getChildren().length&&0<i._filterRelationsInEditing({layerId:o,relations:e.getRelations().getArray()}).length;return v.dialog.confirm("<h4>"+ve("editing.messages.delete_feature")+'</h4>\n                  <div style="font-size:1.2em;">'+(e?ve("editing.messages.delete_feature_relations"):"")+"</div>",function(e){e?(r.getSource().removeFeature(a),i.removeLayerUniqueFieldValuesFromFeature({layerId:o,feature:a}),n.resolve(t)):n.reject(t)}),n.promise()}},commit:{fnc:function(e){var t=$.Deferred(),i=e.close,n={SAVE:{label:ye("save"),className:"btn-success",callback:function(){t.resolve(e)}},CANCEL:{label:ye(i?"exitnosave":"annul"),className:"btn-danger",callback:function(){t.reject()}}},r=(i&&(n.CLOSEMODAL={label:ye("annul"),className:"btn-primary",callback:function(){r.modal("hide")}}),v.dialog.dialog({message:e.message,title:ve("editing.messages.commit_feature")+" "+e.layer.getName()+"?",buttons:n}));return t.promise()}}};e.ConfirmStep=(n(g,i.EditingTask),t(g,[{key:"run",value:function(e,t){t=this._dialog.fnc(e,t);return e.features&&(0,b.setAndUnsetSelectedFeaturesStyle)({promise:t,inputs:e,style:this.selectStyle}),t}},{key:"stop",value:function(){return!0}}]),g);function g(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(o(this,g),s(this,(g.__proto__||Object.getPrototypeOf(g)).call(this,e)));return t._dialog=Ce[e.type||"default"],s(e.task=t,new l(e))}e.CopyFeaturesFromOtherLayerStep=(n(_,i.EditingTask),t(_,[{key:"run",value:function(i,e){var t,n=this,r=$.Deferred(),s=i.layer,a=s.getGeometryType(),l=s.getId(),u=s.getEditingFields().filter(function(e){return!e.pk}),d=e.session,c=s.getEditingLayer().getSource(),e=(0,Z.getFeaturesFromSelectionFeatures)({layerId:l,geometryType:a}),f=[],o={},p=((e||[]).forEach(function(e){var t;void 0===o[e.__layerId]&&(t=!Ee.getLayerById(e.__layerId),o[e.__layerId]={external:t,fields:!t&&Ee.getLayerById(e.__layerId).getFields(),features:[]}),o[e.__layerId].features.push(e)}),Vue.observable({state:!1})),h=new(Vue.extend(Q.default))({layers:o,selectedFeatures:f,editAttributes:p}),a=h.$mount().$el,g=v.showModalDialog({title:ve("editing.modal.tools.copyfeaturefromotherlayer.title"),className:"modal-left",closeButton:!1,message:a,buttons:{cancel:{label:"Cancel",className:"btn-danger",callback:function(){r.reject()}},ok:{label:"Ok",className:"btn-success",callback:(t=y(function*(){var a=[],o=!1,t=[];f.forEach(function(e){n.getEditingService().getProjectLayerById(e.__layerId)?t.push(n.getEditingService().getProjectLayerFeatureById({layerId:e.__layerId,fid:e.get(xe)})):t.push({properties:e.getProperties()})}),(yield Promise.allSettled(t)).forEach(function(e,t){var i,n=e.status,r=e.value;"fulfilled"===n&&(e=f[t],o=void 0!==u.find(function(e){var t=e.name,e=e.validate.required;return void 0===r.properties[t]&&(void 0!==e&&e)}),i=new he({feature:e,properties:u.map(function(e){return e.name})}),u.forEach(function(e){e=e.name;void 0===i.get(e)&&i.set(e,null)}),s.getEditingNotEditableFields().find(function(e){s.isPkField(e)&&i.set(e,null)}),fe({feature:i}),i.setTemporaryId(),c.addFeature(i),a.push(i),d.pushAdd(l,i,!1))}),1<a.length&&(p.state&&n.openFormTask?n.openFormTask.updateMulti(!0):o&&v.showUserMessage({type:"warning",message:"plugins.editing.messages.copy_and_paste_from_other_layer_mandatory_fields",autoclose:!0,duration:2e3})),a.forEach(function(e){i.features.push(e),n.fireEvent("addfeature",e)}),h.$destroy(),r.resolve(i)}),function(){return t.apply(this,arguments)})}}});return g.find("button.btn-success").prop("disabled",!0),h.$watch("selectedFeatures",function(e){return g.find("button.btn-success").prop("disabled",0===e.length)}),r.promise()}},{key:"stop",value:function(){return!0}}]),_);function _(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(o(this,_),e.help="editing.steps.help.draw_new_feature",s(this,(_.__proto__||Object.getPrototypeOf(_)).call(this,e)));return t.openFormTask=e.openFormTask,s(e.task=t,new l(e))}e.CopyFeaturesFromOtherProjectLayerStep=(n(w,i.EditingTask),t(w,[{key:"run",value:function(n,e){var t,o=this,s=$.Deferred(),i=n.features,l=n.layer,u=l.getId(),d=l.getEditingFields().filter(function(e){return!e.pk}),c=e.session,f=l.getEditingLayer().getSource(),p=[],e=new(Vue.extend(ee.default))({fields:this.external?null:Ee.getLayerById(this.copyLayer.getId()).getFields(),features:void 0!==i?i:[],selectedFeatures:p}),i=e.$mount().$el,r=v.showModalDialog({title:ve("editing.modal.tools.copyfeaturefromprojectlayer.title"),className:"modal-left",closeButton:!1,message:i,buttons:{cancel:{label:"Cancel",className:"btn-danger",callback:function(){s.reject()}},ok:{label:"Ok",className:"btn-success",callback:(t=y(function*(){var e=[],r=!1;if(p.length){function t(n){d.forEach(function(e){var t=e.name,e=e.validate.required,i=n[t]||null;r=r||null===i&&(void 0!==e&&e),a.set(t,i)});var t=new he({feature:a,properties:d.map(function(e){return e.name})});l.getEditingNotEditableFields().find(function(e){l.isPkField(e)&&t.set(e,null)}),fe({feature:t}),t.setTemporaryId(),f.addFeature(t),e.push(t),c.pushAdd(u,t,!1)}var a=p[0];if(o.isVector)if(o.external)t(a.getProperties());else try{var i=yield o.getEditingService().getProjectLayerFeatureById({layerId:o.copyLayer.getId(),fid:a.get(xe)});i&&t(i.properties)}catch(e){}}e.length&&1===e.length?n.features.push(e[0]):(r&&v.showUserMessage({type:"warning",message:"plugins.editing.messages.copy_and_paste_from_other_layer_mandatory_fields",autoclose:!0,duration:2e3}),n.features.push(e)),e.forEach(function(e){return o.fireEvent("addfeature",e)}),s.resolve(n)}),function(){return t.apply(this,arguments)})}}});return r.find("button.btn-success").prop("disabled",!0),e.$watch("selectedFeatures",function(e){return r.find("button.btn-success").prop("disabled",0===e.length)}),s.promise()}},{key:"stop",value:function(){return!0}}]),w);function w(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(o(this,w),e.help="editing.steps.help.draw_new_feature",s(this,(w.__proto__||Object.getPrototypeOf(w)).call(this,e)));return t.copyLayer=e.copyLayer,t.external=e.external,t.isVector=e.isVector,s(e.task=t,new l(e))}e.DeleteFeatureStep=(n(k,i.EditingTask),t(k,[{key:"run",value:function(t,e){var r=d("../services/editingservice"),a=d("../services/relationservice"),i=$.Deferred(),n=t.layer,o=n.getId(),s=e.session,l=t.features[0],u=r._filterRelationsInEditing({layerId:o,relations:n.getRelations()?n.getRelations().getArray():[]}).filter(function(e){var t=r._getRelationId({layerId:o,relation:e}),i=r.getLayerById(t),n=r._getRelationFieldsFromRelation({layerId:t,relation:e}).ownField;return i.getEditingFields().filter(function(e){return n.includes(e.name)}).every(function(e){return!e.validate.required})});return(0<u.length?r.getLayersDependencyFeatures(o,{feature:l,relations:u}):Promise.resolve()).then(function(){var e=r.getRelationsInEditing({layerId:o,relations:u,feature:l});t.features=[l],e.forEach(function(e){for(var t=e.relation,e=e.relations,i=new a(o,{relation:t,relations:e}),n=e.length,r=0;r<n;r++)i.unlinkRelation(0,!1)}),s.pushDelete(o,l),i.resolve(t)}),i.promise()}},{key:"stop",value:function(){return Promise.resolve(!0)}}]),k);function k(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(o(this,k),e.help="editing.steps.help.double_click_delete",s(this,(k.__proto__||Object.getPrototypeOf(k)).call(this,e)));return t.drawInteraction=null,t._selectInteraction=null,s(e.task=t,new l(e))}e.DeletePartFromMultigeometriesStep=(n(F,i.EditingTask),t(F,[{key:"run",value:function(i,n){var r=$.Deferred(),e=i.layer,a=i.layer.getEditingLayer(),o=e.getId(),s=n.session,e=i.features,t=i.coordinate,l=e[0],u=l.clone(),e=l.getGeometry(),e=le(e),d=new ol.source.Vector({features:e.map(function(e){return new ol.Feature(e)})}),c=this.getMap(),f=c.getPixelFromCoordinate(t),p=new ol.layer.Vector({source:d,style:a.getStyle()});return c.addLayer(p),c.once("postrender",function(){var t=!1;c.forEachFeatureAtPixel(f,function(e){t||(d.removeFeature(e),d.getFeatures().length?(e=ue(d.getFeatures().map(function(e){return e.getGeometry()})),l.setGeometry(e),(0,m.evaluateExpressionFields)({inputs:i,context:n,feature:l}).finally(function(){s.pushUpdate(o,l,u),r.resolve(i)})):(a.getSource().removeFeature(l),s.pushDelete(o,l),r.resolve(i)),t=!0)},{layerFilter:function(e){return e===p},hitTolerance:1}),c.removeLayer(p),p=null}),r.promise()}}]),F);function F(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(o(this,F),s(this,(F.__proto__||Object.getPrototypeOf(F)).call(this,e)));return t.pickFeatureInteraction=null,s(e.task=t,new l(e))}e.GetVertexStep=(n(S,i.EditingTask),t(S,[{key:"run",value:function(t){var i=this,n=$.Deferred(),r=t.features;if(r.length)return this._stopPromise=$.Deferred(),(0,b.setAndUnsetSelectedFeaturesStyle)({promise:this._stopPromise,inputs:t,style:this.selectStyle}),this._snapIteraction=new ol.interaction.Snap({features:new ol.Collection(r),edge:!1}),this._drawIteraction=new ol.interaction.Draw({type:"Point",condition:function(e){var t=e.coordinate;return!!r.find(function(e){return(0,G.areCoordinatesEqual)({feature:e,coordinates:t})})}}),this._drawIteraction.on("drawend",function(e){t.coordinates=e.feature.getGeometry().getCoordinates(),i.setUserMessageStepDone("from"),n.resolve(t)}),this.addInteraction(this._drawIteraction),this.addInteraction(this._snapIteraction),n.promise()}},{key:"stop",value:function(){this.removeInteraction(this._drawIteraction),this.removeInteraction(this._snapIteraction),this._snapIteraction=null,this._drawIteraction=null,this._stopPromise.resolve(!0)}}]),S);function S(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(o(this,S),e.help="editing.steps.help.select",s(this,(S.__proto__||Object.getPrototypeOf(S)).call(this,e))),i=(t._drawInteraction,t._snapIteraction,t._stopPromise,e.task=t,new l(e));return e.steps&&t.setSteps(e.steps),s(t,i)}e.LinkRelationStep=(n(x,i.EditingTask),t(x,[{key:"run",value:function(t,e){var i=this,n=(v.setModal(!1),$.Deferred()),r=t.layer.getEditingLayer(),a=(this._originalLayerStyle=r.getStyle(),e.beforeRun&&"function"==typeof e.beforeRun?e.beforeRun():Promise.resolve()),o=e.excludeFeatures;return a.then(function(){var e=r.getSource().getFeatures();o&&(e=e.filter(function(n){return Object.entries(o).reduce(function(e,t){var t=B(t,2),i=t[0],t=t[1];return e&&n.get(i)!=t},!0)})),i._stopPromise=$.Deferred(),(0,b.setAndUnsetSelectedFeaturesStyle)({promise:i._stopPromise.promise(),inputs:{layer:t.layer,features:e},style:i.selectStyle}),i.pickFeatureInteraction=new we({layers:[r],features:e}),i.addInteraction(i.pickFeatureInteraction),i.pickFeatureInteraction.on("picked",function(e){e=e.feature;t.features.push(e),v.setModal(!0),n.resolve(t)})}).catch(function(e){n.reject(e)}),n.promise()}},{key:"stop",value:function(){return v.setModal(!0),this.removeInteraction(this.pickFeatureInteraction),this.pickFeatureInteraction=null,this._originalLayerStyle=null,this._stopPromise&&this._stopPromise.resolve(!0),!0}}]),x);function x(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(o(this,x),e.help="editing.steps.help.select_feature_to_relation",s(this,(x.__proto__||Object.getPrototypeOf(x)).call(this,e)));return s(e.task=t,new l(e))}e.MergeFeaturesStep=(n(E,i.EditingTask),t(E,[{key:"run",value:function(n,r){var t,a=$.Deferred(),e=n.layer,o=n.features,s=e.getEditingLayer().getSource(),l=e.getId(),u=r.session;return o.length<2?(v.showUserMessage({type:"warning",message:"plugins.editing.messages.select_min_2_features",autoclose:!0}),a.reject()):(0,X.chooseFeatureFromFeatures)({features:o,inputs:n}).then((t=y(function*(t){var e=o.findIndex(function(e){return t===e}),i=t.clone(),e=de({features:o,index:e});if(e){try{yield(0,m.evaluateExpressionFields)({inputs:n,context:r,feature:e})}catch(e){}u.pushUpdate(l,e,i),o.filter(function(e){return e!==t}).forEach(function(e){u.pushDelete(l,e),s.removeFeature(e)}),n.features=[t],a.resolve(n)}else v.showUserMessage({type:"warning",message:"plugins.editing.messages.no_feature_selected",autoclose:!0}),a.reject()}),function(e){return t.apply(this,arguments)})).catch(function(){a.reject()}),a.promise()}},{key:"stop",value:function(){this.removeInteraction(this._pickInteraction)}}]),E);function E(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(o(this,E),e.help="editing.steps.help.merge",s(this,(E.__proto__||Object.getPrototypeOf(E)).call(this,e))),i=(e.task=t,new l(e));return e.steps&&t.setSteps(e.steps),s(t,i)}e.ModifyGeometryVertexStep=(n(I,i.EditingTask),t(I,[{key:"run",value:function(i,n){var r,a=void 0,o=$.Deferred(),t=i.layer,e=t.getEditingLayer(),s=n.session,l=t.getId(),u=this._feature=i.features[0],e=(this._originalStyle=e.getStyle(),this.deleteVertexKey,u.setStyle(function(){var e=new ol.style.Circle({radius:5,fill:null,stroke:new ol.style.Stroke({color:"orange",width:2})});return[new ol.style.Style({image:e,geometry:function(e){return new ol.geom.MultiPoint((c.isPolygonGeometryType(t.getGeometryType())&&c.isMultiGeometry(t.getGeometryType())?e.getGeometry().getCoordinates()[0]:e.getGeometry().getCoordinates())[0])}}),new ol.style.Style({stroke:new ol.style.Stroke({color:"yellow",width:4})})]}),new ol.Collection(i.features));return this._modifyInteraction=new ol.interaction.Modify({features:e,deleteCondition:this._deleteCondition}),this._modifyInteraction.on("modifystart",function(e){e=e.features.getArray()[0];a=e.clone()}),this.addInteraction(this._modifyInteraction),this._modifyInteraction.on("modifyend",function(e){var t=e.features.getArray()[0];t.getGeometry().getExtent()!==a.getGeometry().getExtent()&&(0,m.evaluateExpressionFields)({inputs:i,context:n,feature:t}).finally(function(){r=t.clone(),s.pushUpdate(l,r,a),i.features.push(r),o.resolve(i)})}),o.promise()}},{key:"addMeasureInteraction",value:function(){var t=this,i=this.getMap();this._modifyInteraction.on("modifystart",function(e){e=e.features.getArray()[0];t.tooltip=Fe({map:i,feature:e})})}},{key:"removeMeasureInteraction",value:function(){var e=this.getMap();this.tooltip&&Se(D({map:e},this.tooltip)),this.tooltip=null}},{key:"stop",value:function(){return this._feature.setStyle(this._originalStyle),this.removeInteraction(this._modifyInteraction),!0}}]),I);function I(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(o(this,I),e.snap=void 0===e.snap||e.snap,e.help="editing.steps.help.edit_feature_vertex",s(this,(I.__proto__||Object.getPrototypeOf(I)).call(this,e)));return t.drawInteraction=null,t._originalStyle=null,t._feature=null,t._deleteCondition=e.deleteCondition,t.tooltip,s(e.task=t,new l(e))}e.MoveElementsStep=(n(T,i.EditingTask),t(T,[{key:"getDeltaXY",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.x,i=e.y,e=function e(t){return Array.isArray(t[0])?e(t[0]):{x:t[0],y:t[1]}}(e.coordinates);return{x:t-e.x,y:i-e.y}}},{key:"run",value:function(u,d){var c=this,f=$.Deferred(),p=u.layer,h=u.features,g=u.coordinates,y=p.getEditingLayer().getSource(),v=p.getId(),_=d.session;return(0,b.setAndUnsetSelectedFeaturesStyle)({promise:f,inputs:u,style:this.selectStyle}),this._snapIteraction=new ol.interaction.Snap({source:y,edge:!1}),this._drawInteraction=new ol.interaction.Draw({type:"Point",features:new ol.Collection}),this._drawInteraction.on("drawend",function(e){for(var e=e.feature.getGeometry().getCoordinates(),e=B(e,2),t=e[0],i=e[1],n=g?c.getDeltaXY({x:t,y:i,coordinates:g}):null,r=h.length,a=[],o=0;o<r;o++){var s,l=(0,U.cloneFeature)(h[o],p);n?l.getGeometry().translate(n.x,n.y):(s=l.getGeometry().getCoordinates(),s=c.getDeltaXY({x:t,y:i,coordinates:s}),l.getGeometry().translate(s.x,s.y)),(0,W.setNullMediaFields)({feature:l,layer:p}),a.push((0,m.evaluateExpressionFields)({inputs:u,context:d,feature:l}))}Promise.allSettled(a).then(function(e){return e.forEach(function(e){e.status;var e=e.value,t=(0,K.getNotEditableFieldsNoPkValues)({layer:p,feature:e}),i=_.pushAdd(v,e);Object.entries(t).length&&Object.entries(t).forEach(function(e){var e=B(e,2),t=e[0],e=e[1];return i.set(t,e)}),y.addFeature(i),u.features.push(i)})}).finally(function(){c._steps.to.done=!0,f.resolve(u)})}),this.addInteraction(this._drawInteraction),this.addInteraction(this._snapIteraction),f.promise()}},{key:"stop",value:function(){return this.removeInteraction(this._drawInteraction),this.removeInteraction(this._snapIteraction),this._drawInteraction=null,!(this._snapIteraction=null)}}]),T);function T(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(o(this,T),e.help="editing.steps.help.select_vertex_to_paste",s(this,(T.__proto__||Object.getPrototypeOf(T)).call(this,e))),i=(e.task=t,new l(e));return e.steps&&t.setSteps(e.steps),s(t,i)}e.MoveFeatureStep=(n(C,i.EditingTask),t(C,[{key:"run",value:function(i,n){var r=this,a=(this.promise=$.Deferred(),$.Deferred()),e=i.layer,o=n.session,s=e.getId(),e=new ol.Collection(i.features),l=null,u=(this.changeKey=null,!1);return(0,b.setAndUnsetSelectedFeaturesStyle)({promise:this.promise,inputs:i,style:this.selectStyle}),this._translateInteraction=new ol.interaction.Translate({features:e,hitTolerance:isMobile&&isMobile.any?10:0}),this.addInteraction(this._translateInteraction),this._translateInteraction.on("translatestart",function(e){e=e.features.getArray()[0];r.changeKey=e.once("change",function(){return u=!0}),l=e.clone()}),this._translateInteraction.on("translateend",function(e){ol.Observable.unByKey(r.changeKey);var t=e.features.getArray()[0];u?(0,m.evaluateExpressionFields)({inputs:i,context:n,feature:t}).finally(function(){var e=t.clone();o.pushUpdate(s,e,l),a.resolve(i)}):a.resolve(i)}),a.promise()}},{key:"stop",value:function(){this.promise.resolve(),this.removeInteraction(this._translateInteraction),this._translateInteraction=null,this.changeKey=null}}]),C);function C(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(o(this,C),e.help="editing.steps.help.move",s(this,(C.__proto__||Object.getPrototypeOf(C)).call(this,e)));return t.drawInteraction=null,t.promise,s(e.task=t,new l(e))}var Le,Pe;e.OpenFormStep=(n(L,i.EditingTask),t(L,[{key:"updateMulti",value:function(){this._multi=0<arguments.length&&void 0!==arguments[0]&&arguments[0]}},{key:"saveAll",value:(Pe=y(function*(t){var i,n=this,r=this.getContext().session;if((t=this._multi?t.filter(function(e){return null!==e.value}):t).length)return yield f.getCurrent().getContextService().saveDefaultExpressionFieldsNotDependencies(),i=[],this._features.forEach(function(e){n._originalLayer.setFieldsWithValues(e,t),i.push(e.clone())}),this._isContentChild&&(this.getInputs().relationFeatures={newFeatures:i,originalFeatures:this._originalFeatures}),yield this.fireEvent("saveform",{newFeatures:i,originalFeatures:this._originalFeatures}),i.forEach(function(e,t){return r.pushUpdate(n.layerId,e,n._originalFeatures[t])}),yield(0,J.handleRelation1_1LayerFields)({layerId:this.layerId,features:i,fields:t,task:this}),this.fireEvent("savedfeature",i),this.fireEvent("savedfeature_"+this.layerId,i),r.save(),{promise:this.promise}}),function(e){return Pe.apply(this,arguments)})},{key:"run",value:function(e,t){var i=$.Deferred(),n=e.layer,r=e.features;return this.promise=i,this._isContentChild=1<f.getLength(),this.layerId=n.getId(),v.setLoadingContent(!1),this.getEditingService().disableMapControlsConflict(!0),(0,b.setAndUnsetSelectedFeaturesStyle)({promise:i,inputs:e,style:this.selectStyle}),!this._multi&&Array.isArray(r[r.length-1])?i.resolve():this.startForm({inputs:e,context:t,promise:i}),i.promise()}},{key:"startForm",value:(Le=y(function*(e){var i,t,n,r=this,a=e.inputs,o=e.context,s=e.promise,l=this.getEditingService(),u=(l.setCurrentLayout(),this._originalLayer=a.layer,this._editingLayer=this._originalLayer.getEditingLayer(),this._layerName=this._originalLayer.getName(),this._features=this._multi?a.features:[a.features[a.features.length-1]],this._originalFeatures=this._features.map(function(e){return e.clone()}),this._features[0]),e=(this._isContentChild&&(e=o.fatherValue,i=void 0===e?[]:e,(void 0===(e=o.fatherField)?[]:e).forEach(function(e,t){u.set(e,i[t]),r._originalFeatures[0].set(e,i[t])})),this._fields=yield(0,q.getFormFields)({inputs:a,context:o,feature:u,isChild:this._isContentChild}),this._multi&&(this._fields=this._fields.map(function(e){e=JSON.parse(JSON.stringify(e));return e.value=null,e.forceNull=!0,e.validate.required=!1,e}).filter(function(e){return!e.pk})),f.getCurrent().setInput({key:"fields",value:this._fields}),v.showForm({feature:this._originalFeatures[0],formComponent:Te,title:"plugins.editing.editing_attributes",name:this._layerName,crumb:{title:this._layerName},id:"form_"+this._layerName,dataid:this._layerName,layer:this._originalLayer,isnew:!(1<this._originalFeatures.length)&&this._originalFeatures[0].isNew(),parentData:(0,z.getParentFormData)(),fields:this._fields,context_inputs:!this._multi&&this._edit_relations&&{context:o,inputs:a},formStructure:this._originalLayer.hasFormStructure()&&this._originalLayer.getEditorFormStructure().length?this._originalLayer.getEditorFormStructure():void 0,modal:!0,push:this.push||this._isContentChild,showgoback:void 0!==this.showgoback?this.showgoback:!this._isContentChild,headerComponent:this._saveAll&&{template:'\n          <section class="editing-save-all-form">\n            <bar-loader :loading="loading"/>\n            <div\n              class = "editing-button"\n              style = "background-color: #fff; display: flex; justify-content: flex-end; width: 100%;"\n            >\n              <span\n                class               = "save-all-icon"\n                v-disabled          = "disabled"\n                @click.stop.prevent = "save"\n              >\n                <i\n                  class  = "skin-color"\n                  :class = "g3wtemplate.font[\'save\']"\n                  style  = "font-size: 1.8em; padding: 5px; border-radius: 5px; cursor: pointer; box-shadow: 0 3px 5px rgba(0,0,0,0.5); margin: 5px;"\n                ></i>\n              </span>\n            </div>\n          </section>',name:"Saveall",props:{update:{type:Boolean},valid:{type:Boolean}},data:function(){return{loading:!1,enabled:!0}},computed:{disabled:function(){return!this.enabled||!(this.valid&&this.update)}},methods:{save:(n=y(function*(){var e=this;this.loading=!0,yield Promise.allSettled([].concat(re(f._workflows)).reverse().filter(function(e){return"function"==typeof e.getLastStep().getTask().saveAll}).map(function(e){return e.getLastStep().getTask().saveAll(e.getContext().service.state.fields)})),l.commit({modal:!1}).then(function(){f._workflows.forEach(function(e){return e.getContext().service.setUpdate(!1,{force:!1})})}).fail(function(e){}).always(function(){e.loading=!1})}),function(){return n.apply(this,arguments)})},created:function(){f.getLength()<2||(this.enabled=f._workflows.slice(0,f.getLength()-1).reduce(function(e,t){t=t.getContext().service,t=(t instanceof Ie?t.getState():{}).valid;return e&&(void 0===t||t)},!0))}},buttons:[{id:"save",title:this._isContentChild?f.getParent().getBackButtonLabel()||"plugins.editing.form.buttons.save_and_back":"plugins.editing.form.buttons.save",type:"save",class:"btn-success",cbk:(t=y(function*(t){var i;(t=r._multi?t.filter(function(e){return null!==e.value}):t).length?(i=[],v.setLoadingContent(!0),v.disableContent(!0),yield f.getCurrent().getContextService().saveDefaultExpressionFieldsNotDependencies(),v.setLoadingContent(!1),v.disableContent(!1),r._features.forEach(function(e){r._originalLayer.setFieldsWithValues(e,t),i.push(e.clone())}),r._isContentChild&&(a.relationFeatures={newFeatures:i,originalFeatures:r._originalFeatures}),r.fireEvent("saveform",{newFeatures:i,originalFeatures:r._originalFeatures}).then(y(function*(){i.forEach(function(e,t){return o.session.pushUpdate(r.layerId,e,r._originalFeatures[t])}),yield(0,J.handleRelation1_1LayerFields)({layerId:r.layerId,features:i,fields:t,task:r}),v.setModal(!1),r.fireEvent("savedfeature",i),r.fireEvent("savedfeature_"+r.layerId,i),r._isContentChild&&f.getParents().forEach(function(e){return e.getContextService().setUpdate(!0,{force:!0})}),s.resolve(a)}))):(v.setModal(!1),s.resolve(a))}),function(e){return t.apply(this,arguments)})},{id:"cancel",title:"plugins.editing.form.buttons.cancel",type:"cancel",class:"btn-danger",eventButtons:{update:{false:{id:"close",title:"close",type:"cancel",class:"btn-danger"}}},cbk:function(){r._isContentChild||(v.setModal(!1),r.fireEvent("cancelform",a.features)),s.reject(a)}}]}));this.fireEvent("openform",{layerId:this.layerId,session:o.session,feature:this._originalFeature,formService:e}),f.getCurrent()&&f.getCurrent().setContextService(e),this._unwatchs=yield(0,Y.listenRelation1_1FieldChange)({layerId:this.layerId,fields:this._fields}),this.disableSidebar(!0)}),function(e){return Le.apply(this,arguments)})},{key:"stop",value:function(){this.disableSidebar(!1);var e=this.getEditingService(),t=!1===this._isContentChild||2===f.getLength()&&f.getParent().isType("edittable"),t=(t&&e.disableMapControlsConflict(!1),t&&f.getCurrent().getContextService());t&&!1===this._isContentChild&&t.setUpdate(!1,{force:!1}),v.closeForm({pop:this.push||this._isContentChild}),e.resetCurrentLayout(),this.fireEvent("closeform"),this.fireEvent("closeform_"+this.layerId),this.layerId=null,this.promise=null,this._unwatchs.forEach(function(e){return e()}),this._unwatchs=[]}}]),L);function L(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(o(this,L),e.help="editing.steps.help.insert_attributes_feature",e.push),t=void 0!==t&&t,i=e.saveAll,i=void 0===i||i,n=e.multi,n=void 0!==n&&n,r=e.showgoback,a=s(this,(L.__proto__||Object.getPrototypeOf(L)).call(this,e));return a.showgoback=r,a.push=t,a._saveAll=i,a._multi=n,a._edit_relations=void 0===e.edit_relations||e._edit_relations,a.layerId,a._isContentChild=!1,a._features,a._originalLayer,a._editingLayer,a._layerName,a._originalFeatures,a._fields,a.promise,a._unwatchs=[],s(e.task=a,new l(e))}function Oe(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=d("../services/tableservice"),n=(g3wsdk.core.utils.base(this),t.service||new i(D({},t))),i=(this.setService(n),new Me({service:n}));this.setInternalComponent(i),i.state=n.state,n.once("ready",function(){return e.emit("ready")}),this.unmount=function(){return n.cancel(),g3wsdk.core.utils.base(this,"unmount")}}var Me=Vue.extend(te.default);g3wsdk.core.utils.inherit(Oe,r),e.OpenTableStep=(n(P,i.EditingTask),t(P,[{key:"run",value:function(e,r){var t=this,i=(this.getEditingService().setCurrentLayout(),$.Deferred()),n=e.layer,a=n.getName(),o=n.getEditingFields(),s=(this._isContentChild=1<f.getLength(),this._isContentChild&&r.excludeFields||[]),l=n.getEditingCapabilities(),n=n.getEditingLayer().readEditingFeatures(),u=(0<s.length&&0<n.length&&(n=n.filter(function(n){return!s.reduce(function(e,t,i){return e&&r.fatherValue[i]===""+n.get(t)},!0)})),new Oe({title:""+a,features:n,promise:i,push:this._isContentChild,headers:o,context:r,inputs:e,capabilities:l,fatherValue:r.fatherValue}));return v.disableSideBar(!0),v.showUserMessage({type:"loading",message:"plugins.editing.messages.loading_table_data",autoclose:!1,closable:!1}),setTimeout(function(){u.once("ready",function(){return setTimeout(function(){v.closeUserMessage()})}),v.showContent({content:u,push:t._isContentChild,showgoback:!1,closable:!1})},300),i.promise()}},{key:"stop",value:function(){this.disableSidebar(!1),v[this._isContentChild?"popContent":"closeContent"](),this.getEditingService().resetCurrentLayout()}}]),P);function P(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(o(this,P),e.help="editing.steps.help.edit_table",s(this,(P.__proto__||Object.getPrototypeOf(P)).call(this,e)));return s(e.task=t,new l(e))}e.PickFeatureStep=(n(O,i.EditingTask),t(O,[{key:"run",value:function(i,e){var n=this,r=$.Deferred(),t=i.layer.getEditingLayer();return this.pickFeatureInteraction=new ie.PickFeaturesInteraction({layer:t}),this.addInteraction(this.pickFeatureInteraction),this.pickFeatureInteraction.on("picked",function(e){var t=e.features,e=e.coordinate;0===i.features.length&&(i.features=t,i.coordinate=e),(0,b.setAndUnsetSelectedFeaturesStyle)({promise:r,inputs:i,style:n.selectStyle}),n._steps&&n.setUserMessageStepDone("select"),r.resolve(i)}),r.promise()}},{key:"stop",value:function(){return this.removeInteraction(this.pickFeatureInteraction),!(this.pickFeatureInteraction=null)}}]),O);function O(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(o(this,O),e.help="editing.steps.help.pick_feature",s(this,(O.__proto__||Object.getPrototypeOf(O)).call(this,e))),i=(t._options={highlight:e.highlight||!1,multi:e.multi||!1},t.pickFeatureInteraction=null,t._busy=!1,t._tools=e.tools||[],e.task=t,new l(e));return e.steps&&t.setSteps(e.steps),s(t,i)}var Ae;e.PickProjectLayerFeaturesStep=(n(M,i.EditingTask),t(M,[{key:"run",value:function(e,t){var i=$.Deferred();return this.copyLayer&&this.getFeaturesFromLayer({inputs:e,promise:i}),i.promise()}},{key:"getFeaturesFromLayer",value:(Ae=y(function*(){var i,a=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.inputs,o=e.promise,s=[],l=t.layer.getGeometryType();yield new Promise((i=y(function*(n,e){var r,t;a.isVector&&(a.external?(a.pickInteraction=new ie.PickFeaturesInteraction({layer:a.copyLayer}),a.addInteraction(a.pickInteraction),a.pickInteraction.on("picked",function(e){e=e.features;s=(0,H.convertFeaturesGeometryToGeometryTypeOfLayer)({features:e,geometryType:l}),n()})):(a.pickInteraction=new ke,a.addInteraction(a.pickInteraction),r=ge.getCurrentProject(),a.pickInteraction.once("picked",(t=y(function*(e){e=e.coordinate;try{var t=(yield _e.getData("query:coordinates",{inputs:{coordinates:e,query_point_tolerance:r.getQueryPointTolerance(),layerIds:[a.copyLayer.getId()],multilayers:!1},outputs:null})).data,i=void 0===t?[]:t;i.length&&(s=(0,H.convertFeaturesGeometryToGeometryTypeOfLayer)({features:i[0].features,geometryType:l}))}catch(e){o.reject(e)}finally{n()}}),function(e){return t.apply(this,arguments)}))))}),function(e,t){return i.apply(this,arguments)})),s.length?(t.features=s,o.resolve(t)):(v.showUserMessage({type:"warning",message:"plugins.editing.messages.no_feature_selected",closable:!1,autoclose:!0}),o.reject())}),function(){return Ae.apply(this,arguments)})},{key:"stop",value:function(){return this.removeInteraction(this.pickInteraction),!(this.pickInteraction=null)}}]),M);function M(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(o(this,M),e.help="editing.steps.help.pick_feature",s(this,(M.__proto__||Object.getPrototypeOf(M)).call(this,e)));return t.copyLayer=e.copyLayer,t.external=e.external,t.isVector=e.isVector,t.pickInteraction=null,s(e.task=t,new l(e))}e.SelectElementsStep=(n(A,i.EditingTask),t(A,[{key:"addSingleSelectInteraction",value:function(){var t,i=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=e.layer,r=e.inputs,a=e.promise,e=e.buttonnext,o=void 0!==e&&e,e=new ie.PickFeaturesInteraction({layer:n.getEditingLayer()});e.on("picked",(t=y(function*(e){var e=e.features,t=void 0;if(1<e.length)try{t=yield(0,X.chooseFeatureFromFeatures)({features:e,inputs:i.getInputs()})}catch(e){}else t=e[0];t&&(r.features=e=[t],o?i.addRemoveToMultipleSelectFeatures([t],r):(i._originalStyle=(0,N.setFeaturesSelectedStyle)(e),i._steps&&i.setUserMessageStepDone("select"),a.resolve(r)))}),function(e){return t.apply(this,arguments)})),this._selectInteractions.push(e),this.addInteraction(e)}},{key:"addExternalSelectInteraction",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=e.layer,a=e.inputs,o=e.context,s=e.promise,l=(e.buttonnext,r.getGeometryType()),u=r.getId(),d=r.getEditingLayer().getSource(),c=this.getContext().session,e=this.getMapService().getExternalLayers().filter(function(e){var t=!0;return"VECTOR"==e.getType()&&0<(e=e.getSource().getFeatures()).length&&(e=e[0].getGeometry().getType(),t=se(e,l)),t}),e=new ie.PickFeaturesInteraction({layers:e});e.on("picked",function(t){var e,i,n;0<t.features.length?(e=r.getEditingFields(),(i=t.features[0].getGeometry()).getType()!==l&&t.feature.setGeometry(oe(i,l)),n=new he({feature:t.feature,properties:e.map(function(e){return"media"!==e.input.type&&void 0!==t.feature.get(e.name)&&!e.pk||t.feature.set(e.name,null),e.name})}),(0,m.evaluateExpressionFields)({inputs:a,context:o,feature:n}).finally(function(){fe({feature:n}),n.setTemporaryId(),d.addFeature(n),c.pushAdd(u,n,!1),a.features.push(n),s.resolve(a)})):s.reject()}),this._selectInteractions.push(e),this.addInteraction(e)}},{key:"addRemoveToMultipleSelectFeatures",value:function(){var i=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],n=arguments[1];e.forEach(function(e){var t=i.multipleselectfeatures.indexOf(e);t<0?(i._originalStyle=(0,N.setFeaturesSelectedStyle)([e]),i.multipleselectfeatures.push(e)):(i.multipleselectfeatures.splice(t,1),e.setStyle(i._originalStyle)),n.features=i.multipleselectfeatures}),this._steps.select.buttonnext.disabled=this._steps.select.buttonnext.condition?this._steps.select.buttonnext.condition({features:this.multipleselectfeatures}):0===this.multipleselectfeatures.length,void 0!==this._steps.select.dynamic&&(this._steps.select.dynamic=this.multipleselectfeatures.length)}},{key:"addMultipleSelectInteraction",value:function(){var e,n=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=t.layer,a=t.inputs,o=t.promise,t=t.buttonnext,s=void 0!==t&&t,l=void 0;ae.ismobile?(t=ol.interaction.Draw.createBox(),e=new ol.source.Vector({}),this._vectorLayer=new ol.layer.Vector({source:e}),this.getMap().addLayer(this._vectorLayer),(l=new ol.interaction.Draw({type:"Circle",source:e,geometryFunction:t})).on("drawend",function(e){e=e.feature.getGeometry().getExtent(),e=r.getEditingLayer().getSource().getFeaturesInExtent(e);s?n.addRemoveToMultipleSelectFeatures(e,a):0<e.length?(a.features=e,n._originalStyle=(0,N.setFeaturesSelectedStyle)(e),n._steps&&n.setUserMessageStepDone("select"),setTimeout(function(){return o.resolve(a)},500)):o.reject()})):(l=new ol.interaction.DragBox({condition:ol.events.condition.shiftKeyOnly})).on("boxend",function(e){var t=[],i=l.getGeometry().getExtent();r.getEditingLayer().getSource().forEachFeatureIntersectingExtent(i,function(e){t.push(e)}),s?n.addRemoveToMultipleSelectFeatures(t,a):0<t.length?(a.features=t,n._originalStyle=(0,N.setFeaturesSelectedStyle)(t),n._steps&&n.setUserMessageStepDone("select"),o.resolve(a)):o.reject()}),this._selectInteractions.push(l),this.addInteraction(l)}},{key:"run",value:function(e,t){var i=e.layer,n=$.Deferred();switch(this._type){case"single":this.addSingleSelectInteraction({layer:i,inputs:e,promise:n});break;case"multiple":var r=!!this._steps.select.buttonnext;r&&(this._steps.select.buttonnext.done=function(){return n.resolve(e)}),this.addSingleSelectInteraction({layer:i,inputs:e,promise:n,buttonnext:r}),this.addMultipleSelectInteraction({layer:i,inputs:e,promise:n,buttonnext:r});break;case"bbox":this.addMultipleSelectInteraction({layer:i,inputs:e,promise:n});break;case"external":this.addExternalSelectInteraction({layer:i,inputs:e,context:t,promise:n})}return n.promise()}},{key:"stop",value:function(){var t=this;this._selectInteractions.forEach(function(e){return t.removeInteraction(e)}),this._vectorLayer&&this.getMap().removeLayer(this._vectorLayer),this.getInputs().features.forEach(function(e){return e.setStyle(t._originalStyle)}),this._originalStyle=null,this._vectorLayer=null,this._selectInteractions=[],this.multipleselectfeatures=[]}}]),A);function A(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],i=(o(this,A),e.help=e.help||"editing.steps.help.select_elements",s(this,(A.__proto__||Object.getPrototypeOf(A)).call(this,e))),n=(i._type=e.type||"bbox",i._selectInteractions=[],i.multipleselectfeatures=[],i._originalStyle,i._vectorLayer,e.task=i,new l(e));return t&&n.on("run",function(){n.emit("next-step",g3wsdk.core.i18n.tPlugin("editing.steps.help.select_elements"))}),e.steps&&i.setSteps(e.steps),s(i,n)}var Re;e.SplitFeatureStep=(n(R,i.EditingTask),t(R,[{key:"run",value:function(a,o){var t,s=this,l=$.Deferred(),e=a.layer,u=a.features,e=e.getEditingLayer().getSource(),d=o.session;return this._snapIteraction=new ol.interaction.Snap({source:e,edge:!0}),this._stopPromise=$.Deferred(),(0,b.setAndUnsetSelectedFeaturesStyle)({promise:this._stopPromise,inputs:a,style:this.selectStyle}),this._drawInteraction=new ol.interaction.Draw({type:"LineString",features:new ol.Collection,freehandCondition:ol.events.condition.never}),this._drawInteraction.on("drawend",(t=y(function*(e){for(var e=e.feature,n=!1,r=ce({splitfeature:e,features:u}),t=r.length,i=0;i<t;i++)yield*function*(e){var t,e=r[e],i=e.uid,e=e.geometries;1<e.length&&(n=!0,t=u.find(function(e){return e.getUid()===i}),yield s._handleSplitFeature({feature:t,context:o,splittedGeometries:e,inputs:a,session:d}))}(i);n?(v.showUserMessage({type:"success",message:"plugins.editing.messages.splitted",autoclose:!0}),l.resolve(a)):(v.showUserMessage({type:"warning",message:"plugins.editing.messages.nosplittedfeature",autoclose:!0}),l.reject())}),function(e){return t.apply(this,arguments)})),this.addInteraction(this._drawInteraction),this.addInteraction(this._snapIteraction),l.promise()}},{key:"_handleSplitFeature",value:(Re=y(function*(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.feature,i=e.inputs,n=e.context,e=e.splittedGeometries,r=void 0===e?[]:e,a=[],o=i.layer,s=n.session,l=o.getEditingLayer().getSource(),u=o.getId(),d=t.clone(),c=(i.features=r.length?[]:i.features,r.length),f=0;f<c;f++){var p=r[f];if(0===f){t.setGeometry(p);try{yield(0,m.evaluateExpressionFields)({inputs:i,context:n,feature:t})}catch(e){}s.pushUpdate(u,t,d)}else{var h=(0,U.cloneFeature)(d,o);h.setGeometry(p),(0,W.setNullMediaFields)({layer:o,feature:h}),(t=new he({feature:h})).setTemporaryId();try{yield(0,m.evaluateExpressionFields)({inputs:i,context:n,feature:t})}catch(e){}var g=(0,K.getNotEditableFieldsNoPkValues)({layer:o,feature:t});Object.entries(g).length?function(){var i=s.pushAdd(u,t);Object.entries(g).forEach(function(e){var e=B(e,2),t=e[0],e=e[1];return i.set(t,e)}),a.push(i),l.addFeature(i)}():(a.push(s.pushAdd(u,t)),l.addFeature(t))}i.features.push(t)}return a}),function(){return Re.apply(this,arguments)})},{key:"stop",value:function(){this.removeInteraction(this._drawInteraction),this.removeInteraction(this._snapIteraction),this._drawInteraction=null,this._snapIteraction=null,this._stopPromise.resolve(!0)}}]),R);function R(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(o(this,R),e.help="",s(this,(R.__proto__||Object.getPrototypeOf(R)).call(this,e))),i=(t._stopPromise,e.task=t,new l(e));return e.steps&&t.setSteps(e.steps),s(t,i)}},{"../components/CopyFeaturesFromOtherLayers.vue":3,"../components/CopyFeaturesFromOtherProjectLayer.vue":4,"../components/Table.vue":8,"../form/editingform":25,"../g3wsdk/workflow/task":37,"../interactions/pickfeaturesinteraction":40,"../services/editingservice":42,"../services/relationservice":43,"../services/tableservice":44,"../utils/areCoordinatesEqual":47,"../utils/chooseFeatureFromFeatures":48,"../utils/cloneFeature":49,"../utils/convertFeaturesGeometryToGeometryTypeOfLayer":50,"../utils/evaluateExpressionFields":51,"../utils/getFeaturesFromSelectionFeatures":53,"../utils/getFormFields":54,"../utils/getNotEditableFieldsNoPkValues":55,"../utils/getParentFormData":56,"../utils/handleRelation1_1LayerFields":58,"../utils/listenRelation1_1FieldChange":59,"../utils/setAndUnsetSelectedFeaturesStyle":61,"../utils/setFeaturesSelectedStyle":62,"../utils/setNullMediaFields":63}]},{},[39]);
//# sourceMappingURL=../g3w-client/src/plugins/editing/plugin.js.map
