!function(){var e=window&&window.initConfig&&window.initConfig.group&&window.initConfig.group.plugins;e&&(e.editing=Object.assign(e.editing||{},{version:"3.7.8",hash:"undefined",branch:"HEAD"}))}(),function n(r,a,o){function s(t,e){if(!a[t]){if(!r[t]){var i="function"==typeof require&&require;if(!e&&i)return i(t,!0);if(l)return l(t,!0);throw(e=new Error("Cannot find module '"+t+"'")).code="MODULE_NOT_FOUND",e}i=a[t]={exports:{}},r[t][0].call(i.exports,function(e){return s(r[t][1][e]||e)},i,i.exports,n,r,a,o)}return a[t].exports}for(var l="function"==typeof require&&require,e=0;e<o.length;e++)s(o[e]);return s}({1:[function(e,t,i){var n=i.cache={};function r(){}i.insert=function(e){if(n[e])return r;n[e]=!0;var t=document.createElement("style");return t.setAttribute("type","text/css"),"textContent"in t?t.textContent=e:t.styleSheet.cssText=e,document.getElementsByTagName("head")[0].appendChild(t),function(){document.getElementsByTagName("head")[0].removeChild(t),n[e]=!1}}},{}],2:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var d=e("../workflows/easyaddfeatureworkflow"),c=g3wsdk.core.layer.features.Feature;i.default=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},u=e.service;e.plugin;this.addFormComponents=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layerId,e=e.components;u.addFormComponents({layerId:t,components:void 0===e?[]:e})},this.getEditableLayersId=function(){return Object.keys(u.getEditableLayers())},this.getSession=function(){return u.getSession(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})},this.getFeature=function(){return u.getFeature(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})},this.subscribe=function(e,t){return u.subscribe(e,t)},this.unsubscribe=function(e,t){return u.unsubscribe(e,t)},this.showPanel=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.toolboxes;t&&Array.isArray(t)&&u.getToolBoxes().forEach(function(e){return e.setShow(-1!==t.indexOf(e.getId()))}),u.getPlugin().showEditingPanel(e)},this.hidePanel=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};u.getPlugin().hideEditingPanel(e)},this.getToolBoxById=function(e){return u.getToolBoxById(e)},this.startEditing=function(n){var r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return r.selected=void 0===r.selected||r.selected,r.showselectlayers=void 0===r.showselectlayers||r.showselectlayers,r.disablemapcontrols=void 0!==r.disablemapcontrols&&r.showselectlayers,new Promise(function(t,e){var i=u.getToolBoxById(n);if(u.setShowSelectLayers(r.showselectlayers),!i)return e();i.setSelected(r.selected),r.selected&&u.setSelectedToolbox(i),r.title&&i.setTitle(r.title),i.start(r).then(function(e){r.disablemapcontrols&&u.disableMapControlsConflict(!0),t(e?{toolbox:i,data:e}:i)}).fail(e)})},this.setSaveConfig=function(){u.setSaveConfig(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})},this.addNewFeature=function(e){return u.addNewFeature(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{})},this.stopEditing=function(i){var n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(e,t){u.getToolBoxById(i).stop(n).then(e).fail(t)})},this.commitChanges=function(){return u.commit(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})},this.resetDefault=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.plugin,t=void 0===t||t,e=e.toolboxes;void 0!==e&&!e||u.getToolBoxes().forEach(function(e){e.resetDefault()}),t&&u.resetDefault()},this.setApplicationEditingConstraints=function(){u.setApplicationEditingConstraints(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})},this.getMapService=function(){return u.getMapService()},this.addLayerFeature=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},s=e.layerId,l=e.feature;return new Promise(function(e,t){if(void 0===l||void 0===s)t();else{function i(){o.stop(),r.stop()}var n=u.getLayerById(s),r=u.getSessionById(s),a=n.getEditingFields().filter(function(e){return!(e.pk&&!e.editable)}),o=(r.start({filter:{nofeatures:!0,nofeatures_field:a[0].name},editing:!0}),new d({push:!0,showgoback:!1,saveAll:!1}));try{a.forEach(function(e){void 0===l.get(e.name)&&l.set(e.name,null)}),(l=new c({feature:l,properties:a.map(function(e){return e.name})})).setTemporaryId(),r.pushAdd(s,l,!1),n.getEditingLayer().getSource().addFeature(l),o.start({inputs:{layer:n,features:[l]},context:{session:r}}).then(function(){r.save(),u.commit({toolbox:u.getToolBoxById(s),modal:!1}).then(function(){i(),e()}).fail(function(){i(),t()})}).fail(function(){i(),t()})}catch(e){t()}}})},this.updateLayerFeature=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.layerId,e.featureId,e.type},this.deleteLayerFeature=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.layerId,e.featureId}}},{"../workflows/easyaddfeatureworkflow":48}],3:[function(e,t,i){e("vueify/lib/insert-css").insert(".choose-and-zoom-to-feature[data-v-3c5d6465]{display:flex;flex-direction:column;justify-content:space-between}#editing-layers-choose-feature .editing-choose-feature-radio-input[data-v-3c5d6465]{align-items:center;padding:5px;position:relative;display:flex;justify-content:space-between;border-bottom:1px solid #eee}");Object.defineProperty(i,"__esModule",{value:!0}),n=g3wsdk.gui.GUI,i.default={name:"choosefeature",data:function(){return{feature:this.$options.feature}},methods:{selectFeature:function(e){this.feature.splice(0),this.feature.push(e)},getAttributesFeature:function(e){var i=e.getProperties();return this.$options.attributes.map(function(e){var t=e.label,e=e.name;return{attribute:t,value:i[e]}})},zoomToFeature:function(e){n.getService("map").zoomToFeatures([e],{highlight:!0,duration:1e3})}},mounted:function(){n.closeContent()}},t.exports.__esModule&&(t.exports=t.exports.default);var n,e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var i=this,e=i.$createElement,n=i._self._c||e;return n("div",{attrs:{id:"editing-layers-choose-feature"}},i._l(i.$options.features,function(t,e){return n("div",{staticClass:"editing-choose-feature-radio-input"},[n("section",{staticClass:"choose-and-zoom-to-feature"},[n("div",[n("input",{staticClass:"magic-radio",attrs:{id:"choose_feature_"+e,name:"radio",type:"radio"},on:{click:function(e){return e.stopPropagation(),i.selectFeature(t)}}}),i._v(" "),n("label",{staticStyle:{color:"transparent"},attrs:{for:"choose_feature_"+e}},[i._v("id\n        ")])]),i._v(" "),n("div",{staticClass:"skin-color",class:i.g3wtemplate.font.marker,staticStyle:{"padding-left":"3px","font-size":"1.3em",cursor:"pointer","margin-top":"10px"},on:{click:function(e){return e.stopPropagation(),i.zoomToFeature(t)}}})]),i._v(" "),n("section",{staticStyle:{"overflow-x":"auto",display:"flex"}},i._l(i.getAttributesFeature(t),function(e){var t=e.attribute,e=e.value;return n("div",{staticStyle:{display:"flex","flex-direction":"column","justify-content":"space-between",padding:"5px"}},[n("span",{staticStyle:{"font-weight":"bold","margin-bottom":"10px"}},[i._v(i._s(t))]),i._v(" "),n("span",{staticStyle:{"align-self":"start","white-space":"nowrap"}},[i._v(i._s(e))])])}),0)])}),0)},e.staticRenderFns=[],e._scopeId="data-v-3c5d6465"},{"vueify/lib/insert-css":1}],4:[function(e,t,i){e("vueify/lib/insert-css").insert(".g3w-editing-other-layers-features[data-v-0a61c6b7]{overflow:auto}");Object.defineProperty(i,"__esModule",{value:!0}),r=g3wsdk.constant.G3W_FID,n=g3wsdk.gui.GUI,a=g3wsdk.core.geoutils.getAlphanumericPropertiesFromFeature,o=g3wsdk.core.map.MapLayersStoreRegistry,e=g3wsdk.gui.vue.Mixins.resizeMixin,i.default={name:"Copyfeaturesfromotherlayers",mixins:[e],data:function(){return{selectedFeatures:this.$options.selectedFeatures,disabled:!0,_height:0}},computed:{showEditAttributes:function(){return 1<Object.values(this.$options.layers).reduce(function(e,t){t=t.features;return e+=t.length},0)}},methods:{resize:function(){var e=this;this.$nextTick(function(){return e.$data._height=window.innerHeight-200})},getAttributesFeature:function(e,t){var t=this.$options.layers[t],i=t.external,n=t.fields;return a(e.getProperties()).filter(function(e){return e!==r}).map(function(t){return{attribute:i?t:n.find(function(e){return e.name===t}).label,value:e.get(t)}})},selectFeature:function(t){this.selectedFeatures.find(function(e){return e===t})?this.selectedFeatures=this.selectedFeatures.filter(function(e){return e!==t}):this.selectedFeatures.push(t),this.disabled=this.selectedFeatures.length<2,this.$options.editAttributes.state=!this.disabled&&this.$options.editAttributes.state},getLayerTitle:function(e){var t=o.getLayerById(e);return t?t.getTitle():n.getService("map").getLayerById(e).get("name")},zoomToFeature:function(e){n.getService("map").zoomToFeatures([e],{highlight:!0,duration:1e3})}},beforeCreate:function(){this.delayType="debounce"},mounted:function(){n.closeContent()}},t.exports.__esModule&&(t.exports=t.exports.default);var r,n,a,o,i="function"==typeof t.exports?t.exports.options:t.exports;i.render=function(){var r=this,e=r.$createElement,n=r._self._c||e;return n("div",{staticClass:"editing-layers-features"},[r.showEditAttributes?n("div",{directives:[{name:"disabled",rawName:"v-disabled",value:r.disabled,expression:"disabled"}],staticStyle:{display:"flex","justify-content":"flex-end"}},[n("input",{directives:[{name:"model",rawName:"v-model",value:r.$options.editAttributes.state,expression:"$options.editAttributes.state"}],staticClass:"magic-checkbox",attrs:{id:"g3w_edit_attributes_of_select_feature_from_layer",type:"checkbox"},domProps:{checked:Array.isArray(r.$options.editAttributes.state)?-1<r._i(r.$options.editAttributes.state,null):r.$options.editAttributes.state},on:{change:function(e){var t,i=r.$options.editAttributes.state,e=e.target,n=!!e.checked;Array.isArray(i)?(t=r._i(i,null),e.checked?t<0&&r.$set(r.$options.editAttributes,"state",i.concat([null])):-1<t&&r.$set(r.$options.editAttributes,"state",i.slice(0,t).concat(i.slice(t+1)))):r.$set(r.$options.editAttributes,"state",n)}}}),r._v(" "),n("label",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.modal.tools.copyfeaturefromotherlayer.edit_attributes",expression:"'editing.modal.tools.copyfeaturefromotherlayer.edit_attributes'"}],staticStyle:{color:"#000000"},attrs:{for:"g3w_edit_attributes_of_select_feature_from_layer"}})]):r._e(),r._v(" "),n("section",{staticClass:"g3w-editing-other-layers-features",style:{height:r.$data._height+"px"}},r._l(Object.keys(r.$options.layers),function(i){return n("div",[n("div",{staticClass:"skin-color",staticStyle:{"font-weight":"bold","font-size":"1.2em"}},[r._v(r._s(r.getLayerTitle(i)))]),r._v(" "),n("divider"),r._v(" "),n("div",{staticClass:"copy-features-for-layer-content",staticStyle:{"overflow-x":"auto"}},r._l(r.$options.layers[i].features,function(t,e){return n("div",{staticStyle:{padding:"5px",position:"relative",display:"flex","align-items":"baseline","border-bottom":"1px solid #eee"}},[n("div",{staticStyle:{display:"flex","flex-direction":"column","border-right":"1px solid #eee"}},[n("div",{staticClass:"skin-color",class:r.g3wtemplate.font.marker,staticStyle:{padding:"0 5px 15px 5px","font-size":"1.1em",cursor:"pointer","margin-right":"5px"},on:{click:function(e){return e.stopPropagation(),r.zoomToFeature(t)}}}),r._v(" "),n("div",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:"plugins.editing.steps.help.select_elements",expression:"'plugins.editing.steps.help.select_elements'",arg:"right",modifiers:{create:!0}}]},[n("input",{staticClass:"magic-checkbox",attrs:{id:i+"_"+e+"_select_feature_from_layer",type:"checkbox"},on:{click:function(e){return e.stopPropagation(),r.selectFeature(t)}}}),r._v(" "),n("label",{staticStyle:{color:"#FFF"},attrs:{for:i+"_"+e+"_select_feature_from_layer"}},[r._v(" "+r._s(t.getId()||0)+"\n                  ")])])]),r._v(" "),r._l(r.getAttributesFeature(t,i),function(e){var t=e.attribute,e=e.value;return n("div",{staticStyle:{display:"flex","flex-direction":"column",padding:"10px"}},[n("span",{staticStyle:{"font-weight":"bold","margin-bottom":"10px"}},[r._v(r._s(t))]),r._v(" "),n("span",{staticStyle:{"align-self":"start"}},[r._v(r._s(e))])])})],2)}),0)],1)}),0)])},i.staticRenderFns=[],i._scopeId="data-v-0a61c6b7"},{"vueify/lib/insert-css":1}],5:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),n=g3wsdk.constant.G3W_FID,r=g3wsdk.gui.GUI,a=g3wsdk.core.geoutils.getAlphanumericPropertiesFromFeature,o=g3wsdk.core.map.MapLayersStoreRegistry,i.default={name:"Copyfeaturesfromotherlayers",data:function(){return{features:this.$options.features,selectfeature:null,selectedFeatures:this.$options.selectedFeatures}},methods:{getAttributesFeature:function(e){var i=this.$options.fields;return a(e.getProperties()).filter(function(e){return e!==n}).map(function(t){return{attribute:i?i.find(function(e){return e.name===t}).label:t,value:e.get(t)}})},getLayerTitle:function(e){return o.getLayerById(e).getTitle()},zoomToFeature:function(e){r.getService("map").zoomToFeatures([e],{highlight:!0,duration:1e3})}},watch:{selectfeature:function(e){this.selectedFeatures.splice(0,1,e)}}},t.exports.__esModule&&(t.exports=t.exports.default);var n,r,a,o,i="function"==typeof t.exports?t.exports.options:t.exports;i.render=function(){var i=this,e=i.$createElement,n=i._self._c||e;return n("div",{staticClass:"editing-layers-features"},[n("div",{staticClass:"copy-features-for-layer-content",staticStyle:{"overflow-x":"auto"}},i._l(i.features,function(t,e){return n("div",{staticStyle:{padding:"5px",position:"relative",display:"flex","align-items":"baseline","border-bottom":"1px solid #eee"}},[n("div",{staticStyle:{display:"flex","flex-direction":"column","border-right":"1px solid #eee"}},[n("div",{staticClass:"skin-color",class:i.g3wtemplate.font.marker,staticStyle:{padding:"0 5px 15px 5px","font-size":"1.1em",cursor:"pointer","margin-right":"5px"},on:{click:function(e){return e.stopPropagation(),i.zoomToFeature(t)}}}),i._v(" "),n("div",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:"plugins.editing.steps.help.select_elements",expression:"'plugins.editing.steps.help.select_elements'",arg:"right",modifiers:{create:!0}}]},[n("input",{directives:[{name:"model",rawName:"v-model",value:i.selectfeature,expression:"selectfeature"}],staticClass:"magic-radio",attrs:{id:i.layerId+"_"+e+"_select_feature_from_layer",name:"radio",type:"radio"},domProps:{value:t,checked:i._q(i.selectfeature,t)},on:{change:function(e){i.selectfeature=t}}}),i._v(" "),n("label",{staticStyle:{color:"#FFF"},attrs:{for:i.layerId+"_"+e+"_select_feature_from_layer"}},[i._v(i._s(e))])])]),i._v(" "),i._l(i.getAttributesFeature(t),function(e){var t=e.attribute,e=e.value;return n("div",{staticStyle:{display:"flex","flex-direction":"column",padding:"10px"}},[n("span",{staticStyle:{"font-weight":"bold","margin-bottom":"10px"}},[i._v(i._s(t))]),i._v(" "),n("span",{staticStyle:{"align-self":"start"}},[i._v(i._s(e))])])})],2)}),0)])},i.staticRenderFns=[]},{}],6:[function(e,t,i){function n(e){return e&&e.__esModule?e:{default:e}}function r(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}Object.defineProperty(i,"__esModule",{value:!0}),a=n(e("./Toolbox.vue")),e=n(e("./SelectEditingLayers.vue")),l=g3wsdk.gui.GUI,u=g3wsdk.core.ApplicationState,i.default={name:"Editing",data:function(){return{saving:!1,layersInEditing:0}},components:{toolbox:a.default,selectlayers:e.default},transitions:{addremovetransition:"showhide"},methods:{updateLayersInEditing:function(e){this.layersInEditing+=e?1:-1},undo:function(){this.$options.service.undo()},redo:function(){this.$options.service.redo()},commit:function(e){var t=this;this.saving=!0,this.$options.service.commit({toolbox:this.$options.service.getToolBoxById(e),modal:!1}).always(function(){return t.saving=!1})},saveAll:function(){},startToolBox:(s=r(function*(e){var t=this,e=this._getToolBoxById(e);if(u.online&&e.canEdit()){var i=e.getDependencies().find(function(e){return t._getToolBoxById(e).isDirty()});if(i)try{yield this.$options.service.commitDirtyToolBoxes(i)}catch(e){}e.start()}}),function(e){return s.apply(this,arguments)}),stopToolBox:function(e){var t=this._getToolBoxById(e);t.state.editing.history.commit?this.$options.service.commit().always(function(){return t.stop()}):t.stop()},saveToolBox:function(e){this._getToolBoxById(e).save()},_setActiveToolOfToolbooxSelected:function(e,t){var i=this._getToolBoxById(t);this.state.toolboxidactivetool=t,i.setActiveTool(i.getToolById(e))},startActiveTool:function(t,i){var n=this;this.state.toolboxidactivetool&&i!==this.state.toolboxidactivetool?this._checkDirtyToolBoxes(this.state.toolboxidactivetool).then(function(e){e&&e.stopActiveTool(),n._setActiveToolOfToolbooxSelected(t,i)}):this._setActiveToolOfToolbooxSelected(t,i)},stopActiveTool:function(e){this._getToolBoxById(e).stopActiveTool()},setSelectedToolbox:(o=r(function*(e){var e=this._getToolBoxById(e),t=this.$options.service.getToolBoxes().find(function(e){return e.isSelected()});t&&(t.setSelected(!1),t.clearMessage()),e.setSelected(!0),this.state.toolboxselected=e}),function(e){return o.apply(this,arguments)}),_checkDirtyToolBoxes:function(e){return this.$options.service.commitDirtyToolBoxes(e)},_getToolBoxById:function(e){return this.$options.service.getToolBoxById(e)},_enableEditingButtons:function(e){this.editingButtonsEnabled=!e}},computed:{message:function(){return""},canCommit:function(){return"default"===this.$options.service.getSaveConfig().mode&&this.state.toolboxselected&&this.state.toolboxselected.state.editing.history.commit&&this.editingButtonsEnabled},canUndo:function(){var e=this.state.toolboxselected&&this.state.toolboxselected.state.editing.history.undo&&this.editingButtonsEnabled;return this.$options.service.fireEvent("canUndo",e),e},canRedo:function(){var e=this.state.toolboxselected&&this.state.toolboxselected.state.editing.history.redo&&this.editingButtonsEnabled;return this.$options.service.fireEvent("canRedo",e),e}},watch:{canCommit:function(e){this.$options.service.registerLeavePage(e)},layersInEditing:function(e){document.getElementsByClassName("close-pane-button")[0].classList[0===e?"remove":"add"]("g3w-disabled")}},created:function(){this.appState=u,this.$options.service.registerOnLineOffLineEvent(),l.closeContent(),this.$options.service.setOpenEditingPanel(!0),l.on("opencontent",this._enableEditingButtons),l.on("closeform",this._enableEditingButtons),l.on("closecontent",this._enableEditingButtons)},beforeDestroy:function(){this.$options.service.setOpenEditingPanel(!1),l.off("opencontent",this._enableEditingButtons),l.off("closeform",this._enableEditingButtons),l.off("closecontent",this._enableEditingButtons),this.$options.service.unregisterOnLineOffLineEvent(),this.$options.service.fireEvent("closeeditingpanel"),this.$options.service.onCloseEditingPanel(),this.$options.service.clearAllLayersUniqueFieldsValues()}},t.exports.__esModule&&(t.exports=t.exports.default);var a,o,s,l,u,i="function"==typeof t.exports?t.exports.options:t.exports;i.render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"g3w-editing-panel"},[i("bar-loader",{attrs:{loading:t.saving}}),t._v(" "),0<t.layersInEditing?i("helpdiv",{staticStyle:{"font-weight":"bold"},attrs:{message:"plugins.editing.close_editing_panel.message"}}):t._e(),t._v(" "),t.appState.online?t._e():i("div",{staticStyle:{"margin-bottom":"5px",padding:"5px","border-radius":"3px","background-color":"orange",color:"white","font-weight":"bold"},attrs:{id:"onlineofflinemessage"}},[i("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.messages.offline",expression:"'editing.messages.offline'"}]})]),t._v(" "),t.showcommitbar?i("div",{directives:[{name:"disabled",rawName:"v-disabled",value:t.saving,expression:"saving"}],staticStyle:{display:"flex","justify-content":"flex-end","margin-bottom":"5px"}},[i("div",{staticClass:"editing-button",class:{enabled:t.canCommit},staticStyle:{"margin-right":"auto"},on:{click:function(e){e.stopPropagation(),t.canCommit&&t.commit()}}},[i("span",{staticClass:"editing-icon",class:t.g3wtemplate.font.save})]),t._v(" "),i("div",{staticClass:"editing-button",class:{enabled:t.canUndo},on:{click:function(e){e.stopPropagation(),t.canUndo&&t.undo()}}},[i("span",{staticClass:"editing-icon",class:t.g3wtemplate.font["arrow-left"]})]),t._v(" "),i("div",{staticClass:"editing-button",class:{enabled:t.canRedo},on:{click:function(e){e.stopPropagation(),t.canRedo&&t.redo()}}},[i("span",{staticClass:"editing-icon",class:t.g3wtemplate.font["arrow-right"]})])]):i("div",{staticStyle:{height:"10px"}}),t._v(" "),t.state.showselectlayers&&1<t.state.toolboxes.length?i("selectlayers"):t._e(),t._v(" "),i("div",{attrs:{id:"toolboxes"}},t._l(t.state.toolboxes,function(e){return i("toolbox",{key:e.id,attrs:{state:e,resourcesurl:t.resourcesurl},on:{setselectedtoolbox:t.setSelectedToolbox,starttoolbox:t.startToolBox,stoptoolbox:t.stopToolBox,savetoolbox:t.saveToolBox,setactivetool:t.startActiveTool,stopactivetool:t.stopActiveTool,"on-editing":t.updateLayersInEditing}})}),1)],1)},i.staticRenderFns=[]},{"./SelectEditingLayers.vue":9,"./Toolbox.vue":12}],7:[function(h,e,t){var i,n,r,a,o,v,s,l,u,y;h("vueify/lib/insert-css").insert(".g3w-editing-new-relation-vector-type[data-v-112912af]{margin-bottom:5px;font-weight:700}");function m(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function d(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}Object.defineProperty(t,"__esModule",{value:!0}),a=g3wsdk.core.i18n.tPlugin,o=g3wsdk.core.utils.toRawType,v=g3wsdk.core.layer.Layer,s=g3wsdk.gui.vue.Mixins,l=s.fieldsMixin,u=s.resizeMixin,s=s.mediaMixin,y=h("../services/relationservice"),t.default={mixins:[s,l,u],name:"g3w-relation",data:function(){return{loading:!1,showAddVectorRelationTools:!1,copylayerid:null,active:!1,showallfieldsindex:null,tooltips:{add_relation:"plugins.editing.form.relations.tooltips.add_relation",link_relation:"plugins.editing.form.relations.tooltips.link_relation",open_relation_tool:"plugins.editing.form.relations.tooltips.open_relation_tools",unlink_relation:"plugins.editing.form.relations.tooltips.unlink_relation"},value:null,placeholdersearch:a("editing.search")+" ..."}},methods:{resize:function(){this.active&&"none"!==this.$el.style.display&&($(this.$refs.relation_body).find("div.dataTables_scrollBody").height($(".g3wform_body:visible").height()-$(".g3wform_footer:visible").height()-$(this.$refs.relation_header_title).outerHeight()-$(this.$refs.relation_header_tools).outerHeight()-$(this.$el).find(".dataTables_scrollHead").outerHeight()-$(this.$el).find(".dataTables_paginate.paging_simple_numbers").outerHeight()-$(".editing-save-all-form:visible").outerHeight()-(this.isVectorRelation&&this.showAddVectorRelationTools?$(this.$refs.relation_vector_tools).outerHeight():0)),this.relationsTable)&&this.relationsTable.columns.adjust()},unlinkRelation:function(e){this._service.unlinkRelation(e)},copyFeatureFromOtherLayer:function(){var t=this,e=h("../services/editingservice"),i=this.copyFeatureLayers.find(function(e){return e.id===t.copylayerid});this._service.addRelationFromOtherLayer({layer:i.external?e.getMapService().getLayerById(this.copylayerid):e.getProjectLayerById(this.copylayerid),external:i.external})},addVectorRelation:function(){this._service.addRelation(),this.showAddVectorRelationTools=!1},addRelationAndLink:(r=d(function*(){this.isVectorRelation&&this.copyFeatureLayers.length?(this.showAddVectorRelationTools=!this.showAddVectorRelationTools,yield this.$nextTick(),this.resize()):this._service.addRelation()}),function(){return r.apply(this,arguments)}),startTool:function(e,t){this._service.startTool(e,t).then(function(){}).catch(console.warn)},linkRelation:function(){this._service.linkRelation()},updateExternalKeyValueRelations:function(e){this._service.updateExternalKeyValueRelations(e)},isRequired:function(){return this._service.isRequired()},relationAttributesSubset:function(e){return this.relationsFields(e).flatMap(function(e){var t=e.name,i=e.label,e=e.value;return Array.isArray(e)?[]:[{name:t,label:i,value:e}]})},relationsAttributesSubsetLength:function(e){return 0<this.relationAttributesSubset(e).length},relationsFields:function(e){return this._service.relationFields(e)},showAllRelationFields:function(e){this.showallfieldsindex=this.showallfieldsindex==e?null:e},showAllFields:function(e){return this.showallfieldsindex==e},getRelationTools:function(){return this._service.getRelationTools()},isLink:function(e){return-1!==["photo","link"].indexOf(this.getFieldType(e))},getValue:function(e){return e&&"Object"===o(e)?e=e.value:"string"==typeof e&&0===e.indexOf("_new_")&&(e=null),this.value=e},getFileName:function(e){return this.getValue(e).split("/").pop()},_setDataTableSearch:function(){var e=this.relationsTable;$("#filterRelation").on("keyup",function(){e.search($(this).val()).draw()})},_createDataTable:function(){this.relationsTable=$(this.$refs.relationTable).DataTable({scrollX:!0,order:[2,"asc"],destroy:!0,scrollResize:!0,scrollCollapse:!0,pageLength:10,columnDefs:[{orderable:!1,targets:[0,1]}]}),$(".dataTables_filter, .dataTables_length").hide(),this._setDataTableSearch()},destroyTable:function(){this.relationsTable&&(this.relationsTable=this.relationsTable.destroy(),this.relationsTable=null,$("#filterRelation").off())},updateTable:(n=d(function*(){this.destroyTable(),this.show=!1,yield this.$nextTick(),this.show=!0,yield this.$nextTick(),this._createDataTable()}),function(){return n.apply(this,arguments)}),updateNewRelationId:function(){var n=this;this._new_relations_ids.forEach(function(e){var t=e.clientid,e=e.id,i=n.relations.find(function(e){return t===e.id});i&&(i.id=e)})}},computed:{relationsLength:function(){return 0<this.relations.length},fieldrequired:function(){return this._service.isRequired()},enableAddLinkButtons:function(){return 0===this.relations.length||"ONE"!==this.relation.type}},watch:{relations:function(){0===(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[]).length?this.destroyTable():(this.updateNewRelationId(),this.updateTable())}},beforeCreate:function(){this.delayType="debounce"},created:function(){var t=this,e=h("../services/editingservice"),i=e.getLayerById(this.relation.child);if(this._new_relations_ids=[],this.listenNewCommitRelations=function(e){e=e.new_relations,e=void 0===e?{}:e;e[i.getId()]&&Array.isArray(e[i.getId()].new)&&(t._new_relations_ids=[].concat(m(t._new_relations_ids),m(e[i.getId()].new.map(function(e){return{clientid:e.clientid,id:e.id}}))),t.active)&&t.updateNewRelationId()},e.on("commit",this.listenNewCommitRelations),this.isVectorRelation=i.getType()===v.LayerTypes.VECTOR,this.isVectorRelation){var n=e.getProjectLayersWithSameGeometryOfLayer(i,{exclude:[this.relation.father]}),e=e.getExternalLayersWithSameGeometryOfLayer(i),r=[],a=!0,o=!1,s=void 0;try{for(var l,u=n[Symbol.iterator]();!(a=(l=u.next()).done);a=!0){var d=l.value;r.push({id:d.getId(),name:d.getName(),external:!1})}}catch(e){o=!0,s=e}finally{try{!a&&u.return&&u.return()}finally{if(o)throw s}}var c=!0,n=!1,o=void 0;try{for(var f,g=e[Symbol.iterator]();!(c=(f=g.next()).done);c=!0){var p=f.value;r.push({id:p.get("id"),name:p.get("name"),external:!0})}}catch(e){n=!0,o=e}finally{try{!c&&g.return&&g.return()}finally{if(n)throw o}}this.copyFeatureLayers=r.sort(function(e,t){return e.name.toLowerCase().localeCompare(t.name.toLowerCase())}),this.copylayerid=this.copyFeatureLayers.length?this.copyFeatureLayers[0].id:null}this.loadEventuallyRelationValuesForInputs=!1,this._service=new y(this.layerId,{relation:this.relation,relations:this.relations}),this.capabilities=this._service.getEditingCapabilities(),this.formeventbus.$on("changeinput",this.updateExternalKeyValueRelations)},activated:(i=d(function*(){if(this.showAddVectorRelationTools=!1,!this.loadEventuallyRelationValuesForInputs){var e=h("../services/editingservice");this.loading=!0;try{yield e.runEventHandler({type:"show-relation-editing",id:e._getRelationId({layerId:this.layerId,relation:this.relation}),component:this})}catch(e){}this.loading=!1,this.loadEventuallyRelationValuesForInputs=!0}this.active=!0,yield this.$nextTick(),!this.relationsTable&&this.relationsLength&&this._createDataTable(),this.resize()}),function(){return i.apply(this,arguments)}),deactivated:function(){this.destroyTable(),this.active=!1},beforeDestroy:function(){var e=h("../services/editingservice");this.loadEventuallyRelationValuesForInputs=!0,e.off("commit",this.listenNewCommitRelations)}},e.exports.__esModule&&(e.exports=e.exports.default);t="function"==typeof e.exports?e.exports.options:e.exports;t.render=function(){var n=this,e=n.$createElement,r=n._self._c||e;return r("div",{directives:[{name:"disabled",rawName:"v-disabled",value:n.loading,expression:"loading"}],staticStyle:{"margin-bottom":"5px"}},[r("bar-loader",{attrs:{loading:n.loading}}),n._v(" "),r("div",{ref:"relation_header_title",staticClass:"box-header with-border skin-color",staticStyle:{width:"100%",display:"flex","font-weight":"bold","font-size":"1.3em","align-items":"center","background-color":"#fff"}},[r("span",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.edit_relation",expression:"'editing.edit_relation'"}]}),n._v(" "),r("span",{staticStyle:{"margin-left":"2px"}},[n._v(": "+n._s(n.relation.name.toUpperCase()))])]),n._v(" "),r("div",{ref:"relation_header_tools",staticClass:"box-header with-border",staticStyle:{width:"100%",display:"flex","background-color":"#fff"}},[r("div",{staticStyle:{"margin-right":"auto"},attrs:{id:"search-box"}},[n.relationsLength?r("input",{staticClass:"form-control",attrs:{type:"text",id:"filterRelation",placeholder:n.placeholdersearch}}):n._e()]),n._v(" "),r("div",{staticStyle:{display:"flex","justify-content":"flex-end"}},[void 0!==n.capabilities.relation.find(function(e){return"change_attr_feature"===e})?r("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:bottom.create",value:n.tooltips.link_relation,expression:"tooltips.link_relation",arg:"bottom",modifiers:{create:!0}}],staticClass:"g3w-icon add-link",class:[{disabled:!n.enableAddLinkButtons},n.g3wtemplate.font.link],attrs:{align:"center"},on:{click:function(e){e.stopPropagation(),n.enableAddLinkButtons&&n.linkRelation()}}}):n._e(),n._v(" "),void 0!==n.capabilities.relation.find(function(e){return"add_feature"===e})?r("span",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:bottom.create",value:n.tooltips.add_relation,expression:"tooltips.add_relation",arg:"bottom",modifiers:{create:!0}}],staticClass:"g3w-icon add-link pull-right",class:[{disabled:!n.enableAddLinkButtons},n.g3wtemplate.font.plus],on:{click:function(e){n.enableAddLinkButtons&&n.addRelationAndLink()}}}):n._e()])]),n._v(" "),n.showAddVectorRelationTools?r("section",{ref:"relation_vector_tools",staticStyle:{display:"flex","flex-direction":"column",border:"2px solid #eee","background-color":"#fff",padding:"10px"}},[r("div",[r("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.relation.draw_new_feature",expression:"'editing.relation.draw_new_feature'"}],staticClass:"g3w-editing-new-relation-vector-type"}),n._v(" "),r("button",{staticClass:"btn skin-button",staticStyle:{width:"100%"},on:{click:function(e){return e.stopPropagation(),n.addVectorRelation(e)}}},[r("i",{class:n.g3wtemplate.font.pencil})])]),n._v(" "),r("divider"),n._v(" "),r("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.relation.draw_or_copy",expression:"'editing.relation.draw_or_copy'"}],staticStyle:{"align-self":"center"}}),n._v(" "),r("divider"),n._v(" "),r("div",{staticStyle:{"flex-grow":"1",display:"flex","flex-direction":"column"},attrs:{id:"g3w-select-editable-layers-content"}},[r("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.relation.copy_feature_from_other_layer",expression:"'editing.relation.copy_feature_from_other_layer'"}],staticClass:"g3w-editing-new-relation-vector-type"}),n._v(" "),r("select",{directives:[{name:"select2",rawName:"v-select2",value:"copylayerid",expression:"'copylayerid'"}],attrs:{id:"g3w-select-editable-layers-to-copy"}},n._l(n.copyFeatureLayers,function(e){return r("option",{key:e.id,domProps:{value:e.id}},[n._v("\n              "+n._s(e.name)+"\n          ")])}),0),n._v(" "),r("button",{staticClass:"btn skin-button",on:{click:function(e){return e.stopPropagation(),n.copyFeatureFromOtherLayer(e)}}},[r("i",{class:n.g3wtemplate.font.clipboard})])])],1):n._e(),n._v(" "),r("div",{ref:"relation_body",staticClass:"box-body",staticStyle:{padding:"0"}},[n.relationsLength?r("table",{ref:"relationTable",staticClass:"table g3wform-relation-table table-striped",staticStyle:{width:"100%"}},[r("thead",[r("tr",[r("th",{directives:[{name:"t",rawName:"v-t",value:"tools",expression:"'tools'"}]}),n._v(" "),r("th"),n._v(" "),n._l(n.relationAttributesSubset(n.relations[0]),function(e){return r("th",[n._v("\n                "+n._s(e.label)+"\n              ")])})],2)]),n._v(" "),r("tbody",n._l(n.relations,function(t,i){return r("tr",{staticClass:"featurebox-header"},[r("td",[r("div",{staticStyle:{display:"flex"}},n._l(n.getRelationTools(),function(t){return r("div",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:plugin",value:t.state.name,expression:"relationtool.state.name",arg:"plugin"}],key:t.state.name,staticClass:"skin-tooltip-right editbtn enabled",attrs:{"data-toggle":"tooltip","data-placement":"right"},on:{click:function(e){return e.stopPropagation(),n.startTool(t,i)}}},[r("img",{attrs:{height:"20px",width:"20px",src:n.resourcesurl+"images/"+t.state.icon}})])}),0)]),n._v(" "),r("td",{staticClass:"action-cell"},[n.fieldrequired||void 0===n.capabilities.relation.find(function(e){return"change_attr_feature"===e})?n._e():r("div",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:n.tooltips.unlink_relation,expression:"tooltips.unlink_relation",arg:"right",modifiers:{create:!0}}],staticClass:"g3w-mini-relation-icon g3w-icon",class:n.g3wtemplate.font.unlink,attrs:{"aria-hidden":"true"},on:{click:function(e){return e.stopPropagation(),n.unlinkRelation(i)}}})]),n._v(" "),n._l(n.relationAttributesSubset(t),function(e){return r("td",{directives:[{name:"show",rawName:"v-show",value:!n.showAllFields(i),expression:"!showAllFields(index)"}]},[n.isMedia(e.value)&&n.getValue(e.value)?r("div",{staticClass:"preview"},[r("a",{attrs:{href:n.getValue(e.value),target:"_blank"}},[r("div",{staticClass:"previewtype",class:n.getMediaType(e.value.mime_type).type},[r("i",{staticClass:"fa-2x",class:n.g3wtemplate.font[n.getMediaType(e.value.mime_type).type]})])]),n._v(" "),r("div",{staticClass:"filename"},[n._v(n._s(n.getFileName(e.value)))])]):n.isLink(e)?r("a",{attrs:{href:n.getValue(e.value),target:"_blank"}},[n._v(n._s(n.getValue(e.value))+"\n                ")]):r("span",[n._v(n._s(n.getValue(n._service.getRelationFeatureValue(t.id,e.name))))])])})],2)}),0)]):n._e()])],1)},t.staticRenderFns=[],t._scopeId="data-v-112912af"},{"../services/editingservice":31,"../services/relationservice":32,"vueify/lib/insert-css":1}],8:[function(n,e,t){Object.defineProperty(t,"__esModule",{value:!0}),r=g3wsdk.core.workflow.WorkflowsStack,a=g3wsdk.gui.vue.services.FormService,t.default={name:"Saveall",props:{update:{type:Boolean},valid:{type:Boolean}},data:function(){return{loading:!1,enabled:!1}},computed:{disabled:function(){return!this.enabled||!(this.valid&&this.update)}},methods:{save:function(){var e=this,t=n("../services/editingservice"),i=(this.loading=!0,[].concat(function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(r._workflows)).reverse());Promise.allSettled(i.filter(function(e){return"function"==typeof e.getLastStep().getTask().saveAll}).map(function(e){return e.getLastStep().getTask().saveAll(e.getContext().service.state.fields)})).then(function(){t.commit({modal:!1}).then(function(){r._workflows.forEach(function(e){return e.getContext().service.setUpdate(!1,{force:!1})})}).fail(function(e){}).always(function(){e.loading=!1})})}},created:function(){this.enabled=!0,r.getLength()<2||(this.enabled=r._workflows.slice(0,r.getLength()-1).reduce(function(e,t){var t=t.getContext().service,t=t instanceof a?t.getState():{},i=t.valid,t=t.update;return(void 0===i||i)&&(void 0!==t&&t)&&e},!0))}},e.exports.__esModule&&(e.exports=e.exports.default);var r,a,t="function"==typeof e.exports?e.exports.options:e.exports;t.render=function(){var t=this,e=t.$createElement,e=t._self._c||e;return e("section",{staticClass:"editing-save-all-form"},[e("bar-loader",{attrs:{loading:t.loading}}),t._v(" "),e("div",{staticClass:"editing-button",staticStyle:{"background-color":"#fff",display:"flex",width:"100%"}},[e("span",{directives:[{name:"disabled",rawName:"v-disabled",value:t.disabled,expression:"disabled"}],on:{click:function(e){return e.stopPropagation(),e.preventDefault(),t.save(e)}}},[e("i",{staticClass:"skin-color",class:t.g3wtemplate.font.save,staticStyle:{"font-size":"1.8em",padding:"5px","border-radius":"5px",cursor:"pointer","box-shadow":"0 3px 5px rgba(0,0,0,0.5)",margin:"5px"}})])])],1)},t.staticRenderFns=[]},{"../services/editingservice":31}],9:[function(e,t,i){e("vueify/lib/insert-css").insert("#g3w-select-editable-layers-content[data-v-45d7f042]{margin-bottom:10px;font-weight:700}#g3w-select-editable-layers-content label[data-v-45d7f042]{color:#fff!important}#g3w-select-editable-layers-to-show[data-v-45d7f042]{cursor:pointer}");Object.defineProperty(i,"__esModule",{value:!0}),n=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var i=t,n=[],r=!0,t=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!i||n.length!==i);r=!0);}catch(e){t=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(t)throw a}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},a=e("../services/editingservice"),i.default={name:"Selecteditinglayers",data:function(){return{selectedlayers:[],editinglayers:Object.entries(a.getEditableLayers()).map(function(e){var e=n(e,2),t=e[0],e=e[1];return{id:t,name:e.getName(),title:e.getTitle()}})}},watch:{selectedlayers:function(n){var r=0<n.length;this.editinglayers.forEach(function(e){var e=e.id,t=a.getToolBoxById(e),i=r&&t.state.editing.history.commit,e=-1!==n.indexOf(e);t.setShow(!r||e),r&&!e&&i&&a.commit({toolbox:t}).always(function(){return t.stop()}),!r||e||i||t.stop()})}}},t.exports.__esModule&&(t.exports=t.exports.default);var n,a,e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"skin-color",attrs:{id:"g3w-select-editable-layers-content"}},[i("label",{directives:[{name:"t",rawName:"v-t",value:"Layers",expression:"'Layers'"}],attrs:{for:"g3w-select-editable-layers-to-show"}}),t._v(" "),i("select",{directives:[{name:"select2",rawName:"v-select2",value:"selectedlayers",expression:"'selectedlayers'"}],attrs:{id:"g3w-select-editable-layers-to-show",multiple:"multiple",clear:"true"}},t._l(t.editinglayers,function(e){return i("option",{key:e.id,domProps:{value:e.id}},[t._v(t._s(e.name))])}),0)])},e.staticRenderFns=[],e._scopeId="data-v-45d7f042"},{"../services/editingservice":31,"vueify/lib/insert-css":1}],10:[function(e,t,i){var n,r,a,o,s,l;e("vueify/lib/insert-css").insert("#table-editing-tools[data-v-13f4ce0f]{display:flex;justify-content:space-between}#table-editing-tools i[data-v-13f4ce0f]{margin:5px}.table_editing_footer_buttons[data-v-13f4ce0f]{position:absolute;bottom:10px;width:100%;display:flex;justify-content:center}.editing_table_header_content[data-v-13f4ce0f]{display:flex;justify-content:space-between;align-items:baseline}.editing_table_relation_messagge[data-v-13f4ce0f]{font-weight:700}");function u(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}Object.defineProperty(i,"__esModule",{value:!0}),n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e=g3wsdk.gui.vue.Mixins.resizeMixin,l=g3wsdk.gui.vue.Fields.media_field,i.default={name:"Table",mixins:[e],components:{"g3w-media":l},data:function(){return{state:this.dataTable=null,show:!0}},methods:{changeSize:(s=u(function*(){var e=this;yield this.$nextTick(),setTimeout(function(){return e.resize()})}),function(){return s.apply(this,arguments)}),showTool:function(t){return void 0!==this.state.capabilities.find(function(e){return e===t})},resize:(o=u(function*(){"none"!==this.$el.style.display&&(yield this.$nextTick(),$("#editing_table  div.dataTables_scrollBody").height($(".content").height()-$(".close-panel-block").outerHeight()-$("#editing_table  div.dataTables_scrollHeadInner").outerHeight()-$(".editing_table_title").outerHeight()-$(".editing_table_header").outerHeight()-$(".editing_table_relation_messagge").outerHeight()-$(".dataTables_length").outerHeight()-$(".dataTables_paginate.paging_simple_numbers").outerHeight()-$(".dataTables_info").outerHeight()-$(".dataTables_filter").outerHeight()-$(".table_editing_footer_buttons").outerHeight()-$("#editing_table .dataTables_paginate.paging_simple_numbers").outerHeight()),this.dataTable)&&this.dataTable.columns.adjust()}),function(){return o.apply(this,arguments)}),showValue:function(t){return!!this.state.headers.find(function(e){return e.name===t})},isMediaField:function(e){return this.$options.service.isMediaField(e)},stop:function(){this.$options.service.cancel()},save:function(){this.state.isrelation?this.$options.service.linkFeatures(this._linkFeatures):this.$options.service.save()},cancel:function(){this.$options.service.cancel()},deleteFeature:(a=u(function*(e){var t=this,i=$("#editing_table table tr#"+e);this.$options.service.deleteFeature(e).then(u(function*(){t.dataTable.row(i).remove().draw(),yield t.$nextTick()})).catch(function(){})}),function(e){return a.apply(this,arguments)}),copyFeature:function(e){var t,i=this;this.$options.service.copyFeature(e).then((t=u(function*(e){i.show=!1,i.dataTable.destroy(),yield i.$nextTick(),i.show=!0,yield i.$nextTick(),i.setDataTable()}),function(e){return t.apply(this,arguments)}))},editFeature:function(e){this.$options.service.editFeature(e)},linkFeature:function(t,e){e.target.checked?this._linkFeatures.push(t):this._linkFeatures=this._linkFeatures.filter(function(e){return e!==t})},_setLayout:function(){return this.$options.service._setLayout()},getValue:function(e){return e&&"object"===(void 0===e?"undefined":n(e))&&Object===e.constructor?e=e.value:"string"==typeof e&&0===e.indexOf("_new_")&&(e=null),e},setDataTable:function(){this.dataTable=$("#editing_table table").DataTable({pageLength:10,scrollX:!0,scrollCollapse:!0,scrollResize:!0,order:[1,"asc"],columnDefs:[{orderable:!1,targets:0}]}),this.resize()}},watch:{"state.features":function(e){}},beforeCreate:function(){this.delayType="debounce"},mounted:(r=u(function*(){yield this.$nextTick(),this.state.isrelation&&(this._linkFeatures=[]),this.setDataTable(),$("#table-editing-tools i").tooltip(),this.$options.service.emit("ready"),this.resize()}),function(){return r.apply(this,arguments)}),beforeDestroy:function(){this._linkFeatures&&(this._linkFeatures=null),this.dataTable.destroy()}},t.exports.__esModule&&(t.exports=t.exports.default);i="function"==typeof t.exports?t.exports.options:t.exports;i.render=function(){var n=this,e=n.$createElement,r=n._self._c||e;return r("div",{staticClass:"g3w-editing-table",attrs:{id:"editing_table"}},[r("div",{ref:"editing_table_header",staticClass:"editing_table_header"},[r("div",{staticClass:"editing_table_header_content"},[r("h3",{staticClass:"editing_table_title"},[n._v(n._s(n.state.title))]),n._v(" "),r("h-resize",{on:{h_size_change:n.changeSize}})],1),n._v(" "),n.state.isrelation?r("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.relation.table.info",expression:"'editing.relation.table.info'"}],staticClass:"editing_table_relation_messagge"}):n._e()]),n._v(" "),n.show?r("table",{staticClass:"display",staticStyle:{width:"100%"}},[r("thead",[r("tr",[n.state.isrelation?n._e():r("th",{staticStyle:{"max-width":"60px"}}),n._v(" "),n.state.isrelation?r("th"):n._e(),n._v(" "),n._l(n.state.headers,function(e){return r("th",[n._v(n._s(e.label))])})],2)]),n._v(" "),r("tbody",n._l(n.state.features,function(t,i){return r("tr",{key:t.__gis3w_feature_uid,attrs:{id:t.__gis3w_feature_uid}},[n.state.isrelation?n._e():r("td",[r("div",{attrs:{id:"table-editing-tools"}},[n.showTool("change_attr_feature")?r("i",{directives:[{name:"t-title",rawName:"v-t-title:plugin",value:"editing.table.edit",expression:"'editing.table.edit'",arg:"plugin"}],staticClass:"g3w-icon skin-tooltip-right",class:n.g3wtemplate.font.pencil,staticStyle:{color:"#30cce7"},attrs:{"data-placement":"right","aria-hidden":"true"},on:{click:function(e){return e.stopPropagation(),n.editFeature(t.__gis3w_feature_uid)}}}):n._e(),n._v(" "),n.showTool("add_feature")?r("i",{directives:[{name:"t-title",rawName:"v-t-title:plugin",value:"editing.table.copy",expression:"'editing.table.copy'",arg:"plugin"}],staticClass:"g3w-icon skin-tooltip-right",class:n.g3wtemplate.font["copy-paste"],staticStyle:{color:"#d98b14",padding:"5px 7px 5px 7px"},attrs:{"data-placement":"right","aria-hidden":"true"},on:{click:function(e){return e.stopPropagation(),n.copyFeature(t.__gis3w_feature_uid)}}}):n._e(),n._v(" "),n.showTool("delete_feature")?r("i",{directives:[{name:"t-title",rawName:"v-t-title:plugin",value:"editing.table.delete",expression:"'editing.table.delete'",arg:"plugin"}],staticClass:"g3w-icon skin-tooltip-right",class:n.g3wtemplate.font["trash-o"],staticStyle:{color:"red"},attrs:{"data-placement":"right","aria-hidden":"true"},on:{click:function(e){return e.stopPropagation(),n.deleteFeature(t.__gis3w_feature_uid)}}}):n._e()])]),n._v(" "),n.state.isrelation?r("td",[r("input",{staticClass:"magic-checkbox",attrs:{id:"relation__"+i,type:"checkbox"},on:{change:function(e){return n.linkFeature(i,e)}}}),n._v(" "),r("label",{attrs:{for:"relation__"+i}})]):n._e(),n._v(" "),n._l(t,function(e,t){return n.showValue(t)?r("td",{key:t},[n.getValue(e)&&n.isMediaField(t)?r("g3w-media",{attrs:{state:e}}):r("p",[n._v(n._s(n.getValue(e)))])],1):n._e()})],2)}),0)]):n._e(),n._v(" "),r("div",{ref:"table_editing_footer_buttons",staticClass:"table_editing_footer_buttons",attrs:{id:"buttons"}},[r("button",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:n.state.isrelation?"editing.form.buttons.save_and_back":"editing.form.buttons.save",expression:"state.isrelation ? 'editing.form.buttons.save_and_back' : 'editing.form.buttons.save'"}],staticClass:"btn btn-success",staticStyle:{"margin-right":"10px"},on:{click:function(e){return e.stopPropagation(),n.save(e)}}}),n._v(" "),r("button",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.form.buttons.cancel",expression:"'editing.form.buttons.cancel'"}],staticClass:"btn btn-danger",on:{click:function(e){return e.stopPropagation(),n.cancel(e)}}})])])},i.staticRenderFns=[],i._scopeId="data-v-13f4ce0f"},{"vueify/lib/insert-css":1}],11:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={name:"Tool",props:["state","resourcesurl"],data:function(){return{}},methods:{toggletool:function(){this.state.active?this.$emit("stopactivetool"):this.$emit("setactivetool",this.state.id)}}},t.exports.__esModule&&(t.exports=t.exports.default);i="function"==typeof t.exports?t.exports.options:t.exports;i.render=function(){var t=this,e=t.$createElement,e=t._self._c||e;return t.state.visible?e("div",{staticClass:"editbtn",class:{enabled:t.state.enabled,toggled:t.state.active},on:{click:function(e){e.preventDefault(),e.stopPropagation(),t.state.enabled&&t.toggletool()}}},[e("img",{directives:[{name:"t-title",rawName:"v-t-title:plugin",value:""+t.state.name,expression:"`${state.name}`",arg:"plugin"}],attrs:{height:"25",width:"25",src:t.resourcesurl+"images/"+t.state.icon}})]):t._e()},i.staticRenderFns=[]},{}],12:[function(e,t,i){var n,r,a;e("vueify/lib/insert-css").insert(".toolbox[data-v-c4a84298]{padding-bottom:5px}.panel:not(.toolboxselected) .has-relations[data-v-c4a84298]{opacity:.4}");function o(e){return e&&e.__esModule?e:{default:e}}function s(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}Object.defineProperty(i,"__esModule",{value:!0}),a=o(e("./Tool.vue")),e=o(e("./ToolsOfTool.vue")),i.default={name:"Toolbox",props:["state","resourcesurl"],data:function(){return{active:!1,currenttoolhelpmessage:null}},components:{tool:a.default,toolsoftool:e.default},computed:{editDisabled:function(){return this.state.loading&&!this.state.startstopediting},hasRelations:function(){return 0<this.state.editing.dependencies.length},loading:function(){return this.state.loading||this.state.changingtools},toolsrow1:function(){return this.state.tools.filter(function(e){return 1===e.row})},toolsrow2:function(){return this.state.tools.filter(function(e){return 2===e.row})},toolsrow3:function(){return this.state.tools.filter(function(e){return 3===e.row})},canEdit:function(){return this.state.editing.canEdit},father:function(){return this.state.editing.father&&!!this.state.editing.dependencies.length},showtoolsoftool:function(){return!!this.state.toolsoftool.length},isLayerReady:function(){return this.state.layerstate.editing.ready}},methods:{select:function(){this.isLayerReady&&!this.state.selected&&this.$emit("setselectedtoolbox",this.state.id)},toggleEditing:function(){this.select(),this.state.layerstate.editing.ready&&!this.state.loading&&this.$emit(this.state.editing.on?"stoptoolbox":"starttoolbox",this.state.id)},saveEdits:function(){this.$emit("savetoolbox",this.state.id)},stopActiveTool:function(){this.$emit("stopactivetool",this.state.id),this.select()},setActiveTool:function(e){this.$emit("setactivetool",e,this.state.id),this.select()}},watch:{"state.activetool":(r=s(function*(e){yield this.$nextTick(),this.currenttoolhelpmessage=e&&e.getHelpMessage()}),function(e){return r.apply(this,arguments)}),"state.editing.on":function(e){this.$emit("on-editing",e)}},created:function(){this.edit_layer_tooltip="editing.tooltip.edit_layer",this.$emit("canEdit",{id:this.state.id})},mounted:(n=s(function*(){yield this.$nextTick(),$(this.$refs.editingbutton).tooltip()}),function(){return n.apply(this,arguments)})},t.exports.__esModule&&(t.exports=t.exports.default);i="function"==typeof t.exports?t.exports.options:t.exports;i.render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{directives:[{name:"show",rawName:"v-show",value:t.state.show,expression:"state.show"}],staticClass:"toolbox"},[i("div",{class:{disableddiv:!t.isLayerReady||!t.canEdit},attrs:{id:"id_toolbox_"+t.state.id}},[i("div",{staticClass:"panel",class:{mobile:t.isMobile(),toolboxselected:t.state.selected},staticStyle:{"margin-bottom":"8px"},on:{click:function(e){return e.stopPropagation(),t.select(e)}}},[i("div",{directives:[{name:"show",rawName:"v-show",value:!t.isLayerReady,expression:"!isLayerReady"}],staticClass:"bar-loader"}),t._v(" "),t.state.toolboxheader?i("div",{staticClass:"panel-heading container",staticStyle:{width:"100%"},style:{background:t.state.color}},[t.father?i("div",{staticClass:"pull-left enabled dropdown",staticStyle:{"margin-right":"5px",cursor:"pointer"}},[i("span",{class:t.g3wtemplate.font.relation}),t._v(" "),i("div",{staticClass:"dropdown-content skin-background-color",staticStyle:{padding:"5px","border-radius":"3px"}},t._l(t.state.editing.dependencies,function(e){return i("div",{staticStyle:{"font-weight":"bold"}},[t._v(t._s(e))])}),0)]):t._e(),t._v(" "),i("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin:pre",value:"editing.toolbox.title",expression:"'editing.toolbox.title'",arg:"pre"}],staticClass:"panel-title",class:[t.father?"col-md-6":"col-md-8"]},[t._v(t._s(t.state.title))]),t._v(" "),i("div",{directives:[{name:"disabled",rawName:"v-disabled",value:t.editDisabled,expression:"editDisabled"},{name:"t-title",rawName:"v-t-title:plugin",value:t.edit_layer_tooltip,expression:"edit_layer_tooltip",arg:"plugin"}],ref:"editingbutton",staticClass:"start-editing editbtn skin-tooltip-left",class:{"pull-right":!t.isMobile(),enabled:t.isLayerReady,"g3w-icon-toggled":t.state.editing.on},attrs:{"data-placement":"left","data-toggle":"tooltip"},on:{click:function(e){return e.stopPropagation(),t.toggleEditing(e)}}},[i("span",{class:t.g3wtemplate.font.pencil,staticStyle:{"font-size":"1.1em",padding:"5px"}})])]):t._e(),t._v(" "),i("bar-loader",{attrs:{loading:t.loading}}),t._v(" "),i("div",{directives:[{name:"show",rawName:"v-show",value:!t.state.changingtools,expression:"!state.changingtools"}],staticClass:"panel-body"},[t.hasRelations?i("div",{staticClass:"has-relations",staticStyle:{color:"#000000"}},[i("span",{class:t.g3wtemplate.font.info,staticStyle:{color:"#007bff","padding-right":"2px"}}),t._v(" "),i("span",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:"editing.messages.toolbox_has_relation",expression:"'editing.messages.toolbox_has_relation'"}]}),t._v(" "),i("divider")],1):t._e(),t._v(" "),t.state.message?i("div",{staticStyle:{color:"#000"}},[i("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:t.state.message,expression:"state.message"}],staticClass:"text-justify"}),t._v(" "),i("divider")],1):t._e(),t._v(" "),i("div",{staticClass:"tools-content row1",staticStyle:{display:"flex","flex-wrap":"wrap"}},t._l(t.toolsrow1,function(e){return i("tool",{key:e.id,attrs:{state:e,resourcesurl:t.resourcesurl},on:{stopactivetool:t.stopActiveTool,setactivetool:t.setActiveTool}})}),1),t._v(" "),i("div",{staticClass:"tools-content row2",staticStyle:{display:"flex","flex-wrap":"wrap"}},t._l(t.toolsrow2,function(e){return i("tool",{key:e.id,attrs:{state:e,resourcesurl:t.resourcesurl},on:{stopactivetool:t.stopActiveTool,setactivetool:t.setActiveTool}})}),1),t._v(" "),i("div",{staticClass:"tools-content row3",staticStyle:{display:"flex","flex-wrap":"wrap"}},t._l(t.toolsrow3,function(e){return i("tool",{key:e.id,attrs:{state:e,resourcesurl:t.resourcesurl},on:{stopactivetool:t.stopActiveTool,setactivetool:t.setActiveTool}})}),1),t._v(" "),i("div",{staticClass:"message",staticStyle:{"margin-top":"5px"},attrs:{id:"id_toolbox_messages_"+t.state.id}},[i("transition",{attrs:{name:"fade"}},[t.showtoolsoftool?i("toolsoftool",{attrs:{tools:t.state.toolsoftool}}):t._e()],1),t._v(" "),t.currenttoolhelpmessage?i("div",{directives:[{name:"t-plugin",rawName:"v-t-plugin",value:t.currenttoolhelpmessage,expression:"currenttoolhelpmessage"}],staticClass:"toolbox_help_message"}):t._e()],1)])],1)])])},i.staticRenderFns=[],i._scopeId="data-v-c4a84298"},{"./Tool.vue":11,"./ToolsOfTool.vue":13,"vueify/lib/insert-css":1}],13:[function(e,t,i){var n;e("vueify/lib/insert-css").insert("#toolsoftoolcontainer[data-v-21f6c16a]{display:flex;flex-direction:column;margin:5px;padding:5px;border-radius:5px}");function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(i,"__esModule",{value:!0}),n=r(e("./ToolsOfToolSnap.vue")),e=r(e("./ToolsOfToolMeasure.vue")),i.default={name:"Toolsoftool",props:["tools"],components:{snap:n.default,measure:e.default},data:function(){return{}}},t.exports.__esModule&&(t.exports=t.exports.default);i="function"==typeof t.exports?t.exports.options:t.exports;i.render=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticStyle:{display:"flex","flex-direction":"column",margin:"5px",padding:"5px","border-radius":"5px"},attrs:{id:"toolsoftoolcontainer"}},[t._l(t.tools,function(e){return[i(e.type,{tag:"component",attrs:{options:e.options}}),t._v(" "),i("divider")]})],2)},i.staticRenderFns=[],i._scopeId="data-v-21f6c16a"},{"./ToolsOfToolMeasure.vue":14,"./ToolsOfToolSnap.vue":15,"vueify/lib/insert-css":1}],14:[function(e,t,i){e("vueify/lib/insert-css").insert("label span[data-v-0b8314c3]{color:#222d32!important}");Object.defineProperty(i,"__esModule",{value:!0}),i.default={name:"measure",props:["options"],data:function(){return{checked:this.options.checked}},watch:{checked:function(e){this.options.onChange(e)}},beforeDestroy:function(){this.options.onBeforeDestroy()}},t.exports.__esModule&&(t.exports=t.exports.default);e="function"==typeof t.exports?t.exports.options:t.exports;e.render=function(){var r=this,e=r.$createElement,e=r._self._c||e;return e("div",{staticStyle:{display:"flex"}},[e("input",{directives:[{name:"model",rawName:"v-model",value:r.checked,expression:"checked"}],staticClass:"magic-checkbox snap_tools_of_tools",attrs:{id:"g3w_editing_show_measure_tool",type:"checkbox"},domProps:{checked:Array.isArray(r.checked)?-1<r._i(r.checked,null):r.checked},on:{change:function(e){var t,i=r.checked,e=e.target,n=!!e.checked;Array.isArray(i)?(t=r._i(i,null),e.checked?t<0&&(r.checked=i.concat([null])):-1<t&&(r.checked=i.slice(0,t).concat(i.slice(t+1)))):r.checked=n}}}),r._v(" "),e("label",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:"plugins.editing.toolsoftool.measure",expression:"'plugins.editing.toolsoftool.measure'",arg:"right",modifiers:{create:!0}}],attrs:{for:"g3w_editing_show_measure_tool"}},[e("span",{class:r.g3wtemplate.font.measure,staticStyle:{"font-weight":"bold"}})])])},e.staticRenderFns=[],e._scopeId="data-v-0b8314c3"},{"vueify/lib/insert-css":1}],15:[function(e,t,i){e("vueify/lib/insert-css").insert("label span[data-v-66af2696]{color:#222d32!important}");Object.defineProperty(i,"__esModule",{value:!0}),s=g3wsdk.gui.GUI,a=g3wsdk.core.layer.Layer,n=s.getService("map"),o=e("../services/editingservice"),r=void 0,i.default={name:"snap",props:["options"],data:function(){return{id:"snap_"+Date.now(),idAll:"snap_"+Date.now()+"_all",checked:!1,checkedAll:!1,showSnapAll:!1}},computed:{add:function(){return(this.checked||this.checkedAll)&&this.options.active}},methods:{addFeatures:function(e){this.features.extend(e)},addFeature:function(e){this.addFeatures([e])},removeFeatures:function(e){var t=this;e.forEach(function(e){return t.features.remove(e)})},setShowSnapAll:function(){this.showSnapAll=!!this.vectorToolboxesEditingState.find(function(e){return e.on}),this.checkedAll=!!this.showSnapAll&&this.checkedAll},activeSnapInteraction:function(){r&&n.removeInteraction(r),r=null,this.add&&(r=new ol.interaction.Snap({source:!this.checkedAll&&this.checked&&this.options.source,features:this.checkedAll&&this.features}),n.addInteraction(r))},enableSnapInteraction:function(e){e?this.activeSnapInteraction():r&&n.removeInteraction(r)}},watch:{checked:function(e){this.options.checked=e,this.activeSnapInteraction()},checkedAll:function(e){this.options.checkedAll=e,this.activeSnapInteraction()},"options.active":function(e){this.enableSnapInteraction(e)}},created:function(){var r=this;this.features=new ol.Collection,this.sourcesAndEventsKeys=[],this.vectorToolboxesEditingState=[],this.unwatches=[],o.getLayers().forEach(function(e){var t,i,n=e.getId();a.LayerTypes.VECTOR===e.getType()&&(e=o.getToolBoxById(n),t=e.getLayer().getEditingSource(),r.features.extend(t.readFeatures()),r.sourcesAndEventsKeys.push({source:t,olKey:t.getFeaturesCollection().on("add",function(e){return r.addFeature(e.element)}),settersAndKeys:{addFeatures:t.onbefore("addFeatures",r.addFeatures),addFeature:t.onbefore("addFeature",r.addFeatures),clear:t.onbefore("clear",function(){r.removeFeatures(t.readFeatures())})}}),r.options.layerId!==n)&&(i=e.getState().editing,r.unwatches.push(r.$watch(function(){return i.on},r.setShowSnapAll)),r.vectorToolboxesEditingState.push(i))}),this.setShowSnapAll()},beforeDestroy:function(){this.sourcesAndEventsKeys.forEach(function(t){Object.keys(t.settersAndKeys).forEach(function(e){t.source.un(e,t.settersAndKeys[e])}),ol.Observable.unByKey(t.olKey)}),this.unwatches.forEach(function(e){return e()}),r=null,this.unwatches=null,this.vectorToolboxesEditingState=null,this.sourcesAndEventsKeys=null}},t.exports.__esModule&&(t.exports=t.exports.default);var a,n,o,r,s="function"==typeof t.exports?t.exports.options:t.exports;s.render=function(){var r=this,e=r.$createElement,e=r._self._c||e;return e("div",{staticStyle:{display:"flex",width:"100%","justify-content":"space-between"}},[e("input",{directives:[{name:"model",rawName:"v-model",value:r.checked,expression:"checked"}],staticClass:"magic-checkbox snap_tools_of_tools",attrs:{type:"checkbox",id:r.id},domProps:{checked:Array.isArray(r.checked)?-1<r._i(r.checked,null):r.checked},on:{change:function(e){var t,i=r.checked,e=e.target,n=!!e.checked;Array.isArray(i)?(t=r._i(i,null),e.checked?t<0&&(r.checked=i.concat([null])):-1<t&&(r.checked=i.slice(0,t).concat(i.slice(t+1)))):r.checked=n}}}),r._v(" "),e("label",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:right.create",value:"plugins.editing.toolsoftool.snap",expression:"'plugins.editing.toolsoftool.snap'",arg:"right",modifiers:{create:!0}}],attrs:{for:r.id}},[e("span",{class:r.g3wtemplate.font.magnete})]),r._v(" "),r.showSnapAll?[e("input",{directives:[{name:"model",rawName:"v-model",value:r.checkedAll,expression:"checkedAll"}],staticClass:"magic-checkbox snap_tools_of_tools",attrs:{type:"checkbox",id:r.idAll},domProps:{checked:Array.isArray(r.checkedAll)?-1<r._i(r.checkedAll,null):r.checkedAll},on:{change:function(e){var t,i=r.checkedAll,e=e.target,n=!!e.checked;Array.isArray(i)?(t=r._i(i,null),e.checked?t<0&&(r.checkedAll=i.concat([null])):-1<t&&(r.checkedAll=i.slice(0,t).concat(i.slice(t+1)))):r.checkedAll=n}}}),r._v(" "),e("label",{directives:[{name:"t-tooltip",rawName:"v-t-tooltip:left.create",value:"plugins.editing.toolsoftool.snapall",expression:"'plugins.editing.toolsoftool.snapall'",arg:"left",modifiers:{create:!0}}],attrs:{for:r.idAll}},[e("span",{class:r.g3wtemplate.font.magnete}),r._v(" "),e("span",{class:r.g3wtemplate.font.layers,staticStyle:{"font-weight":"bold"}})])]:r._e()],2)},s.staticRenderFns=[],s._scopeId="data-v-66af2696"},{"../services/editingservice":31,"vueify/lib/insert-css":1}],16:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={close_editing_panel:{message:"To close editing form need to exit from editing layer"},errors:{no_layers:"Es tritt ein Fehler auf. Es ist nicht möglich, Layer zu bearbeiten",some_layers:"Es tritt ein Fehler auf: Es ist nicht möglich, einige Layer zu bearbeiten"},search:"Suche",editing_changes:"Änderungen bearbeiten",editing_data:"Layer bearbeiten",editing_attributes:"Attribute bearbeiten",relations:"Relationen",edit_relation:"Relation bearbeiten",back_to_relations:"Zurück zu Relationen",no_relations_found:"Keine Relationen gefunden",relation_data:"Relationsdaten",relation_already_added:"Relation bereits hinzugefügt",list_of_relations_feature:"Liste der Relations-Features ",tooltip:{edit_layer:"Layer bearbeiten"},toolbox:{title:"bearbeiten"},table:{edit:"Feature bearbeiten",copy:"Kopie erstellen",delete:"Feature löschen"},tools:{copy:"Features kopieren",pastefeaturesfromotherlayers:"Paste features from other layer",addpart:"Teil zu Multipart hinzufügen",deletepart:"Teil aus Multipart löschen",merge:"Feature auflösen",split:"Feature trennen",add_feature:"Feature hinzufügen",delete_feature:"Feature löschen",move_feature:"Feature verschieben",update_vertex:"Feature vertex aktualisieren",update_feature:"Feature-Attribut aktualisieren",update_multi_features:"Attribute ausgewählter Features aktualisieren",copyfeaturefromexternallayer:"Create Feature from added layer"},toolsoftool:{measure:"Messung anzeigen",snap:"Snap Layer",snapall:"Snap auf alle Layer"},steps:{help:{select_elements:"Features auswählen",select_element:"Feature auswählen",copy:"Neue Kopie der ausgewählten Features erstellen",merge:"Features auflösen",split:"Feature trennen",new:"Neues Feature erstellen",edit_table:"Features der Tabelle bearbeiten",draw_new_feature:"Feature auf Karte zeichnen",action_confirm:"Aktion bestätigen",double_click_delete:"Zu löschendes Feature auf der Karte auswählen",edit_feature_vertex:"Ändern oder Hinzufügen eines Eckpunktes auf dem ausgewählten Feature",move:"Ausgewähltes Feature verschieben",select_feature_to_relation:"Feature auswählen, welches die Relation verknüpft",show_edit_feature_form:"Feature-Formular zum Bearbeiten von Attributen anzeigen",pick_feature:"Zu änderndes Feature auf der Karte auswählen",insert_attributes_feature:"Attribute des Features einfügen"}},workflow:{steps:{select:"Zum Auswählen auf ein Feature klicken",draw_part:"Neues Teil zeichnen",merge:"Feature zum Auflösen auswählen",selectSHIFT:"Features auswählen indem ein Rechteck mit SHIFT gezeichnet wird",selectDrawBox:"Features auswählen, indem man ein Rechteck mit zwei gegenüberliegenden Eckpunkten zeichnet",selectDrawBoxAtLeast2Feature:"Mindestens Features auswählen, indem man ein Rechteck mit zwei gegenüberliegenden Eckpunkten zeichnet",selectPoint:"Zum Auswählen auf ein Feature klicken",selectPointSHIFT:"Features auswählen, indem ein Rechteck mit SHIFT gezeichnet wird (Multifeatures) oder auf ein Feature klicken",selectMultiPointSHIFT:"Features auswählen, indem man ein Rechteck zeichnet und SHIFT drückt oder auf ein Feature klickt",selectMultiPointSHIFTAtLeast2Feature:"Mindestens 2 Features auswählen und mit SHIFT ein Rechteck zeichnen oder auf ein Feature klicken",copyCTRL:"Kopieren ausgewählter Features mit CTRL+C",selectStartVertex:"Start-Eckpunkt der ausgewählten Features auswählen",selectToPaste:"Den Punkt auswählen, an dem die ausgewählten Features eingefügt werden sollen",draw_split_line:"Eine Linie zeichnen, um das ausgewählte Feature zu teilen"}},messages:{featureslockbyotheruser:"Einige Geometrien/Datensätze können nicht bearbeitet werden, da sie von anderen Benutzern bearbeitet werden",splitted:"Getrennt",nosplittedfeature:"Feature nicht getrennt",press_esc:"Mit ESC zurück",online:"Wieder ONLINE. Jetzt kann man die Änderungen in der Datenbank speichern",offline:"OFFLINE. Alle Änderungen werden lokal gespeichert",delete_feature:"Soll das ausgewählte Feature gelöscht werden?",delete_feature_relations:"Wenn ein Feature Verknüpfungen beinhaltet, werden diese Relationen verwaist. Wir schlagen vor, diese Relationen zu behandeln, bevor das Feature gelöscht wird",unlink_relation:"Soll die Verknüpfung aufgehoben werden?",commit_feature:"Änderungen speichern?",toolbox_has_relation:"Diese Ebene ist Teil einer Beziehung",saved:"Daten erfolgreich gespeichert",saved_local:"Daten erfolgreich lokal gespeichert",loading_data:"Daten laden",saving:"Daten werden gespeichert. Bitte warten ...",constraints:{enable_editing:"Bitte zoomen Sie hinein, um die Editier-Tools zu aktivieren \nAktivierungsskala bei 1:"},pdf:"Dokumentenvorschau nicht verfügbar. Bitte hier klicken ",commit:{header:"Die folgende Liste zeigt alle zu übernehmenden Änderungen.",header_add:"<b>Hinzufgefügt</b> Die Anzahl der hinzugefügten Features anzeigen",header_update_delete:"<b>Bearbeitet</b> und <b>Gelöscht</b> Die Liste der Feature-ID anzeigen",add:"Hinzugefügt(n. Features)",delete:"Gelöscht(id)",update:"Bearbeitet(id)"},loading_table_data:"Datentabelle wird erstellt. Bitte warten ...",copy_and_paste_from_other_layer_mandatory_fields:"Vor dem Speichern müssen alle Pflichtfelder des eingegebenen features ausgefüllt werden",no_feature_selected:"Keine feature ausgewählt",select_min_2_features:"Select at least 2 features"},relation:{table:{info:"<div>Wählen Sie Relationen aus, um sie mit dem aktuellen Feature zu verknüpfen.</div>"},draw_new_feature:"Zeichnen Sie eine neue feature",draw_or_copy:"oder",copy_feature_from_other_layer:"Kopieren Sie feature aus einer anderen layer"},form:{relations:{tooltips:{back_to_father:"Zurück zur Bearbeitung des Vaters",add_relation:"Neue Relation erstellen und verknüpfen",link_relation:"Eine Relation zu diesem Feature herstellen",open_relation_tools:"Relationstools anzeigen",unlink_relation:"Relation trennen"}},buttons:{save:"Einfügung/Bearbeiten",save_and_back:"Speichern und zurück",save_and_back_table:"Speichern und zurück",cancel:"Änderungen ignorieren"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Select feature/s",edit_attributes:"Edit attributes of pasted features in multiple mode"},copyfeaturefromprojectlayer:{title:"Select one feature"}}}}},{}],17:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={close_editing_panel:{message:"To close editing form need to exit from editing layer"},errors:{no_layers:"An error occurs. It's no possible to edit layers",some_layers:"An error occurs: It's no possible to edit some layers"},search:"Search",editing_changes:"Editing Changes",editing_data:"Editing Layers",editing_attributes:"Editing attributes",relations:"Relations",edit_relation:"Edit relation",back_to_relations:"Back to Relations",no_relations_found:"No relations found",relation_data:"Relation data",relation_already_added:"Relation already added",list_of_relations_feature:"List of relations feature ",tooltip:{edit_layer:"Edit Layer"},toolbox:{title:"Edit"},table:{edit:"Edit feature",copy:"Create a copy",delete:"Delete feature"},tools:{copy:"Copy features",pastefeaturesfromotherlayers:"Paste features from other layer",addpart:"Add part to multipart",deletepart:"Delete part from multipart",merge:"Dissolve features",split:"Split Feature",add_feature:"Add feature",delete_feature:"Delete feature",move_feature:"Move feature",update_vertex:"Update feature vertex",update_feature:"Update feature attribute",update_multi_features:"Update attributes of selected features",copyfeaturefromexternallayer:"Create Feature from added layer"},toolsoftool:{measure:"Show measure",snap:"Snap layer",snapall:"Snap to all layers"},steps:{help:{select_elements:"Select features",select_element:"Select feature",copy:"Create new copy of selected features",merge:"Dissolve features",split:"Split Feature",new:"Create new feature",edit_table:"Edit table features",draw_new_feature:"Draw feature on map",action_confirm:"Confirm action",double_click_delete:"Select feature on map to delete",edit_feature_vertex:"Modify or add a vertex on selected feature",move:"Move selected feature",select_feature_to_relation:"Select feature that you bind relation",show_edit_feature_form:"Show feature form to edit attributes",pick_feature:"Select feature on map to modify",insert_attributes_feature:"Insert attributes of the feature"}},workflow:{steps:{select:"Click on feature to select",draw_part:"Draw new part",merge:"Select featurewhere dissolve",selectSHIFT:"Select features drawing a rectangle pressing SHIFT",selectDrawBox:"Select features drawing a rectangle by two point of opposite corners",selectDrawBoxAtLeast2Feature:"Select at least features drawing a rectangle by two point of opposite corners",selectPoint:"Click on feature to select",selectPointSHIFT:"Select features drawing a rectangle pressing SHIFT (multifeatures) or click on one feature",selectMultiPointSHIFT:"Select features drawing a rectangle pressing SHIFT or click on feature",selectMultiPointSHIFTAtLeast2Feature:"Select at least 2 features drawing a rectangle pressing SHIFT or click on feature",copyCTRL:"Copy selected features using CTRL+C",selectStartVertex:"Select starting vertex of selected features",selectToPaste:"Select the point where paste the features selected",draw_split_line:"Draw a line to split selected feature"}},messages:{featureslockbyotheruser:"Some geometries/records are not editable because in editing by other user",splitted:"Splitted",nosplittedfeature:"Feature not spitted",press_esc:"Press ESC to back",online:"Back ONLINE. Now you can save your changes on database",offline:"You are OFFLINE. All changes are saved locally",delete_feature:"Do you want delete selected feature ?",delete_feature_relations:"If feature has bindings relations, these relations become orphans. We suggest to handle these relations before detele this feature",unlink_relation:"Do you want unlink relation?",commit_feature:"Do you want to save the changes",toolbox_has_relation:"this layer is part of a relation",saved:"Data saved successfully",saved_local:"Data saved locally successfully",loading_data:"Loading data",saving:"Saving data. Please wait ...",constraints:{enable_editing:"Please Zoom In to enable editing tools \nActivation scale at 1:"},pdf:"Document preview not available. Please click here ",commit:{header:"The following list show all changes to commit.",header_add:"<b>Added</b> show the number of features added",header_update_delete:"<b>Modified</b> and <b>Deleted</b> show the list of features id",add:"Added(n. features)",delete:"Deleted(id)",update:"Modified(id)"},loading_table_data:"Building Data Table. Please wait ...",copy_and_paste_from_other_layer_mandatory_fields:"It is necessary to fill in any mandatory fields on the features pasted before saving",no_feature_selected:"No feature selected",select_min_2_features:"Select at least 2 features"},relation:{table:{info:"<div>Select relations to link it to current editing feature.</div>"},draw_new_feature:"Draw new feature",draw_or_copy:"or",copy_feature_from_other_layer:"Copy feature from other layer"},form:{relations:{tooltips:{back_to_father:"Back to edit father",add_relation:"Create and link new relation",link_relation:"Join a relation to this feature",open_relation_tools:"Show relation tools",unlink_relation:"Unlink relation"}},buttons:{save:"Insert/Edit",save_and_back:"Save and Back",save_and_back_table:"Save and Back",cancel:"Ignore Changes"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Select feature/s",edit_attributes:"Edit attributes of pasted features in multiple mode"},copyfeaturefromprojectlayer:{title:"Select a feature"}}}}},{}],18:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={close_editing_panel:{message:"To close editing form need to exit from editing layer"},errors:{no_layers:"Tapahtui virhe. Tasoja ei ole mahdollista muokata.",some_layers:"Tapahtui virhe. Jotkin tasot eivät ole muokattavissa."},search:"Haku",editing_changes:"Editing Changes",editing_data:"Muokataan tasoja",editing_attributes:"Muokataan attribuutteja",relations:"Relaatiot",edit_relation:"Muokkaa relaatiota",back_to_relations:"Takaisin relaatioihin",no_relations_found:"Relaatioita ei löytynyt",relation_data:"Relaation tiedot",relation_already_added:"Relaatio on jo lisätty",list_of_relations_feature:"Lista relaation ominaisuuksista",tooltip:{edit_layer:"Muokkaa tasoa"},toolbox:{title:"Muokkaa"},table:{edit:"Muokkaa ominaisuutta",copy:"Luo kopio",delete:"Poista ominaisuus"},tools:{copy:"Kopio ominaisuuksia",pastefeaturesfromotherlayers:"Paste features from other layer",addpart:"Lisää osa",deletepart:"Poista osa",merge:"Yhdistä ominaisuudet",split:"Leikkaa ominaisuus",add_feature:"Lisää ominaisuus",delete_feature:"Poista ominaisuus",move_feature:"Siirrä ominaisuutta",update_vertex:"Päivitä pisteen ominaisuutta",update_feature:"Päivitä ominaisuus",update_multi_features:"Muokkaa valittujen ominaisuuksien attribuutteja",copyfeaturefromexternallayer:"Create Feature from added layer"},toolsoftool:{measure:"Show measure",snap:"Snap layer",snapall:"Snap to all layers"},steps:{help:{select_elements:"Valitse ominaisuudet",select_element:"Valitse ominaisuus",copy:"Luo kopio valituista ominaisuuksista",merge:"Yhdistä ominaisuudet",split:"Leikkaa ominaisuus",new:"Luo uusi ominaisuus",edit_table:"Muuta taulun ominaisuuksia",draw_new_feature:"Piirrä ominaisuus kartalle",action_confirm:"Hyväksy toiminto",double_click_delete:"Valitse poistettava ominaisuus kartalta",edit_feature_vertex:"Muuta pistettä tai lisää piste valittuun ominaisuuteen",move:"Siirrä valittu ominaisuus",select_feature_to_relation:"Valitse relaatio",show_edit_feature_form:"Näytä ominaisuuslomake muokataksesi attribuutteja",pick_feature:"Valitse muokattava ominaisuus kartalta",insert_attributes_feature:"Lisää ominaisuuden attribuutit"}},workflow:{steps:{select:"Valitse ominaisuus",draw_part:"Piirrä uusi osa",merge:"Valitse ominaisuus yhdistääksesi",selectSHIFT:"Paina SHIFT, jos haluat valita kohteita suorakulmiovalinnalla.",selectDrawBox:"Piirrä suorakulmio, jonka siältä kohteet valitaan ",selectDrawBoxAtLeast2Feature:"Piirrä suorakulmio, jonka siältä kohteet vähintään 2 valitaan ",selectPoint:"Valitse ominaisuus",selectPointSHIFT:"Paina SHIFT, jos haluat valita ominaisuuksia suorakulmiovalinnalla, tai valitse yksittäinen ominaisuus.",selectMultiPointSHIFT:"Paina SHIFT, jos haluat valita ominaisuuksia suorakulmiovalinnalla, tai valitse yksittäinen ominaisuus.",selectMultiPointSHIFTAtLeast2Feature:"Paina SHIFT, jos haluat valita vähintään 2 ominaisuuksia suorakulmiovalinnalla, tai valitse yksittäinen ominaisuus.",copyCTRL:"CTRL+C, voit kopioida valitut ominaisuudet.",selectStartVertex:"Osoita valittujen ominaisuuksien alkupiste.",selectToPaste:"Valitse kohta, johon liität valitut ominaisuudet.",draw_split_line:"Piirrä viiva, jonka mukaan valittu ominaisuus jaetaan."}},messages:{featureslockbyotheruser:"Some features are locked by another user",splitted:"Jaettu",nosplittedfeature:"Ominaisuutta ei jaettu",press_esc:"Paina ESC palataksesi",online:"Yhteys muodostettu. Muutokset voidaan tallentaa tietokantaan.",offline:"Olet offline-tilassa. Muutokset tallennetaan paikallisesti",delete_feature:"Haluatko poistaa valitun ominaisuuden?",delete_feature_relations:"Mikäli ominaisuudella on sitovia relaatioita, näistä relaatiosta tulee orpoja. Suosittelemme käsittelemään nämä relaatiot ennen poistamista",unlink_relation:"Haluatko poistaa relaation?",commit_feature:"Tallennetaanko muutokset?",toolbox_has_relation:"tämä kerros on osa relaatiota",saved:"Tiedot tallennettu onnistuneesti",saved_local:"Tiedot on tallennettu onnistuneesti paikallisesti.",loading_data:"Ladataan tietoja",saving:"Tallentaan tietoja. Odota...",constraints:{enable_editing:"Lähennä ottaaksesi muokkaustyökalut käyttöön \nAktivointi mittakaava 1:"},pdf:"Dokumentin esikatselu ei ole saatavilla. Paina tästä ",commit:{header:"Seuraava luettelo näyttää kaikki muutokset.",header_add:"<b>Lisätty</b> näytä lisättyjen ominaisuuksien lukumäärä",header_update_delete:"<b>Muokattu</b> ja <b>Poistettu</b> Näytä listä ominaisuuksien id:stä",add:"Lisätty(n. ominaisuutta)",delete:"Poistettu(id)",update:"Muokattu(id)"},loading_table_data:"Building Data Table. Please wait ...",copy_and_paste_from_other_layer_mandatory_fields:"It is necessary to fill in any mandatory fields on the features pasted before saving",no_feature_selected:"No feature selected",select_min_2_features:"Select at least 2 features"},relation:{table:{info:"<div>Valitse relaatiota linkittääksesi ne muokattavaan ominaisuuteen.</div>"},draw_new_feature:"Draw new feature",draw_or_copy:"or",copy_feature_from_other_layer:"Copy feature from other layer"},form:{relations:{tooltips:{back_to_father:"Back to edit father",add_relation:"Luo ja linkitä uusi relaatio",link_relation:"Liitä relaatio tähän ominaisuuteen",open_relation_tools:"Näytä relaatiotyökalut",unlink_relation:"Poista relaatio"}},buttons:{save:"Lisää/muokkaa",save_and_back:"Tallenna ja palaa",save_and_back_table:"Tallenna ja palaa",cancel:"Peruuta"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Select feature/s",edit_attributes:"Edit attributes of pasted features in multiple mode"},copyfeaturefromprojectlayer:{title:"Select a feature"}}}}},{}],19:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={close_editing_panel:{message:"To close editing form need to exit from editing layer"},errors:{no_layers:"Une erreur s'est produite lors du chargement des layers dans l'édition.",some_layers:"Une erreur s'est produite lors du chargement de certaines layers dans l'édition."},search:"Recherche",editing_changes:"Editing Changes",editing_data:"Modifier les donnes",editing_attributes:"Modifier les attributs",relations:"Relations",edit_relation:"Modifier la relation",back_to_relations:"Retour aux relations",no_relations_found:"Il n'y a pas de relations",relation_data:"Données sur les relations",relation_already_added:"Relation déjà présente",list_of_relations_feature:"Lister les relations de la fonctionnalité",tooltip:{edit_layer:"Modifier le layer"},toolbox:{title:"Modifier"},table:{edit:"Modifier fonctionnalités",copy:"Créer une copie",delete:"Supprimer la fonctionnalité"},tools:{copy:"Copier les fonctionnalités",pastefeaturesfromotherlayers:"Paste features from other layer",addpart:"Ajouter une pièce à la géométrie",deletepart:"Supprimer la partie de la géométrie",merge:"Dissoudre les fonctionnalités",split:"Couper la fonctionnalité",add_feature:"Ajouter une fonctionnalité",delete_feature:"Supprimer la fonctionnalité",move_feature:"Déplacez la fonctionnalité",update_vertex:"Mettre à jour les sommets des fonctionnalités",update_feature:"Modifier les attributs des fonctionnalités",update_multi_features:"Modifier les attributs des fonctionnalités sélectionnées",copyfeaturefromexternallayer:"Create Feature from added layer"},toolsoftool:{measure:"Show measure",snap:"Snap layer",snapall:"Snap to all layers"},steps:{help:{select_elements:"Sélectionner les fonctionnalités",select_element:"Sélectionner une fonctionnalité",copy:"Créer une copie des fonctionnalités sélectionnées",merge:"Dissoudre les fonctionnalités",split:"Couper la fonctionnalité",new:"Créer une nouvelle fonctionnalité",edit_table:"Modifier les fonctionnalités de la table",draw_new_feature:"Dessiner une fonctionnalité sur la carte",action_confirm:"Confirmer l'action",double_click_delete:"Sélectionner la fonctionnalité sur la carte à supprimer",edit_feature_vertex:"Modifier ou ajouter un sommet à la fonctionnalité sélectionnée",move:"Déplacer la fonctionnalité sélectionnée",select_feature_to_relation:"Sélectionner la fonctionnalité que vous souhaitez mettre en relation",show_edit_feature_form:"Afficher le formulaire de la fonctionnalité permettant de modifier les attributs",pick_feature:"Sélectionner l'élément de la carte à modifier",insert_attributes_feature:"Insérer les attributs de la fonctionnalité"}},workflow:{steps:{select:"Cliquer sur la fonctionnalité à sélectionner",draw_part:"Dessiner la nouvelle partie",merge:"Sélectionner la fonction à introduire en fondu",selectPoint:"Cliquer sur la fonctionnalité pour la sélectionner",selectSHIFT:"Sélectionner des fonctionnalités en maintenant la touche SHIFT enfoncée",selectDrawBox:"Sélectionner les fonctionnalités en dessinant un rectangle par la création des deux points de la diagonale",selectDrawBoxAtLeast2Feature:"Sélectionner au moins 2 fonctionnalités en dessinant un rectangle par la création des deux points de la diagonale",selectPointSHIFT:"Sélectionner des caractéristiques en maintenant la touche SHIFT enfoncée (multi-sélection) ou en cliquant sur une seule caractéristique",selectMultiPointSHIFT:"Sélectionner des fonctionnalités en maintenant la touche SHIFT appuyée ou en cliquant sur la fonctionnalité individuelle",selectMultiPointSHIFTAtLeast2Feature:"Sélectionner au moins 2 fonctionnalités en maintenant la touche SHIFT appuyée ou en cliquant sur la fonctionnalité individuelle",copyCTRL:"Copier les fonctionnalités sélectionnées avec CTRL+C",selectStartVertex:"Sélectionner le sommet de départ des fonctionnalités choisies",selectToPaste:"Sélectionner le point où les fonctionnalités sélectionnées seront collées",draw_split_line:"Tracez une ligne pour couper la fonctionnalité sélectionnée"}},messages:{featureslockbyotheruser:"Certaines géométries/enregistrements ne sont pas modifiables car ils ont été modifiés par un autre utilisateur",splitted:"Fonctionnalité(s) divisé(es)",nosplittedfeature:"La (les) fonctionnalité(s) n’a (n'ont) pas été divisé(es)",press_esc:"Appuyez sur ESC pour revenir",online:"Vous êtes à nouveau EN LIGNE. Vous pouvez enregistrer les modifications de façon permanente",offline:"Vous êtes HORS LIGNE. Toutes les modifications seront enregistrées temporairement en local",delete_feature:"Voulez-vous supprimer la fonctionnalité sélectionnée ?",delete_feature_relations:"La suppression d'une fonctionnalité avec des relations associées laissera ces relations orphelines. Il est recommandé de gérer ces relations avant de supprimer la fonctionnalité",unlink_relation:"Voulez-vous détacher la relation ?",commit_feature:"Voulez-vous enregistrer définitivement les changements ?",toolbox_has_relation:"cette couche fait partie d'une relation",saved:"Les données ont été enregistrées correctement",saved_local:"Les données ont été correctement sauvegardées localement",loading_data:"Chargement des données",saving:"Sauvegarde des données. Veuillez patienter ...",constraints:{enable_editing:"Augmenter le niveau de zoom pour permettre l'édition \nEchelle de déclenchement 1 :"},pdf:"Aperçu du document non disponible. Cliquez ici ",commit:{header:"La liste ci-dessous montre toutes les modifications qui seront enregistrées.",header_add:"<b>Ajouts</b> indique le nombre de fonctionnalités ajoutées",header_update_delete:"<b>Modifié</b> e <b>Supprimé</b> liste les ids",add:"Ajouté (n. fonctionnalités)",delete:"Supprimé(id)",update:"Modifié(id)"},loading_table_data:"Building Data Table. Please wait ...",copy_and_paste_from_other_layer_mandatory_fields:"Avant d'enregistrer, il est nécessaire de remplir tous les champs obligatoires du features saisi",no_feature_selected:"Aucune feature sélectionnée",select_min_2_features:"Select at least 2 features"},relation:{table:{info:"<div>Sélectionner les relations pour les associer à l'élément en cours d'édition.</div>"},draw_new_feature:"Dessiner une nouvelle feature",draw_or_copy:"ou",copy_feature_from_other_layer:"Copier feature d'une autre layer"},form:{relations:{tooltips:{back_to_father:"Back to edit father",add_relation:"Créer et ajouter une nouvelle relation",link_relation:"Associer une relation existante à cette fonctionnalité",open_relation_tools:"Outils de relation ouverte",unlink_relation:"Annuler la relation"}},buttons:{save:"Insérer/Modifier",save_and_back:"Sauvegarder et retourner au parent",save_and_back_table:"Sauvegarder et et revenir en arrière",cancel:"Ignorer modifications"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Select feature/s",edit_attributes:"Edit attributes of pasted features in multiple mode"},copyfeaturefromprojectlayer:{title:"Select a feature"}}}}},{}],20:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n=u(e("./it")),r=u(e("./en")),a=u(e("./fi")),o=u(e("./se")),s=u(e("./fr")),l=u(e("./de")),e=u(e("./ro"));function u(e){return e&&e.__esModule?e:{default:e}}i.default={it:n.default,en:r.default,fi:a.default,se:o.default,fr:s.default,de:l.default,ro:e.default}},{"./de":16,"./en":17,"./fi":18,"./fr":19,"./it":21,"./ro":22,"./se":23}],21:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={close_editing_panel:{message:"Uscire dall'editing per chiudere il form"},errors:{no_layers:"Si è verificato un errore nel caricamento dei layers in editing.",some_layers:"Si è verificato un errore nel caricamento di alcuni layers in editing"},search:"Cerca",editing_changes:"Modifiche Editing",editing_data:"Edita Dati",editing_attributes:"Edita attributi",relations:"Relazioni",edit_relation:"Edita relazione",back_to_relations:"Ritorna alle Relazioni",no_relations_found:"Non ci sono relazioni",relation_data:"Dati relativi alla relazione",relation_already_added:"Relazione già presente",list_of_relations_feature:"Elenco Relazioni della feature ",tooltip:{edit_layer:"Modifica Layer"},toolbox:{title:"Edita"},table:{edit:"Edita feature",copy:"Crea una copia",delete:"Cancella feature"},tools:{copy:"Copia features",pastefeaturesfromotherlayers:"Incolla features da altro layer",addpart:"Aggiungi parte alla geometria",deletepart:"Cancella parte dalla geometria",merge:"Dissolvi features",split:"Taglia Feature",add_feature:"Aggiungi feature",delete_feature:"Elimina feature",move_feature:"Muovi feature",update_vertex:"Aggiorna vertici feature",update_feature:"Modifica attributi feature",update_multi_features:"Modifica gli attributi delle features selezionate",copyfeaturefromexternallayer:"Crea feature dal layer aggiunto"},toolsoftool:{measure:"Visualizza misura",snap:"Snap sul layer",snapall:"Snap su tutti i layer"},steps:{help:{select_elements:"Seleziona le features",select_element:"Seleziona la feature",copy:"Crea una copia delle feature selezionate",merge:"Dissolvi features",split:"Taglia Feature",new:"Creo una nuova feature",edit_table:"Edita le features della tabella",draw_new_feature:"Disegna sulla mappa la feature",action_confirm:"Conferma azione",double_click_delete:"Seleziona la feature sulla mappa da cancellare",edit_feature_vertex:"Modifica o aggiungi un vertice alla feature selezionata",move:"Muovi la feature selezionata",select_feature_to_relation:"Seleziona la feature che vuoi mettere in relazione",show_edit_feature_form:"Mostra il form della feature per poter editare gli attributi",pick_feature:"Seleziona la feature sulla mappa da modificare",insert_attributes_feature:"Inserisci gli attributi della feature"}},workflow:{steps:{select:"Clicca sulla feature da selezionare",draw_part:"Disegna la nuova parte",merge:"Seleziona la feature su cui dissolvere",selectPoint:"Clicca sulla feature per selezionarla",selectSHIFT:"Seleziona le features tenedo premuto il tasto SHIFT",selectDrawBox:"Seleziona le features disegnando un rettangolo mediante la creazione dei due punti della diagonale",selectDrawBoxAtLeast2Feature:"Seleziona almeno 2 features disegnando un rettangolo mediante la creazione dei due punti della diagonale",selectPointSHIFT:"Seleziona le features tenedo premuto il tasto SHIFT (multiselezione) oppure cliccando sulla singola feature",selectMultiPointSHIFT:"Seleziona le features tenedo premuto il tasto SHIFT oppure cliccando sulla singola feature",selectMultiPointSHIFTAtLeast2Feature:"Seleziona almeno 2 features tenedo premuto il tasto SHIFT oppure cliccando sulla singola feature",copyCTRL:"Copia le features selezionate con CTRL+C",selectStartVertex:"Seleziona il vertice di partenza delle feature selezionate",selectToPaste:"Seleziona il punto dove verranno incollate le features selezionate",draw_split_line:"Disegna una linea per tagliare la feature selezionata"}},messages:{featureslockbyotheruser:"Ci sono alcune geometrie/records non editabili perchè in modifica da altri utenti",splitted:"Feature(s) splittata(e)",nosplittedfeature:"La(e) feature(s) non è stata splittata",press_esc:"Premi ESC per tornare indietro",online:"Ora sei di nuovo ONLINE. Puoi slavare le modifiche in modo permanente",offline:"Sei OFFLINE. Tutte le modifiche saranno salvate temporaneamente in locale",delete_feature:"Vuoi eliminare l'elemento selezionato?",delete_feature_relations:"Cancellando una feature con relazioni associate, tale relazioni rimarranno orfane. Si consiglia di gestire tali relazioni prima di cancellare la feature",unlink_relation:"Vuoi staccare la relazione?",commit_feature:"Vuoi salvare definitivamente le modifiche",toolbox_has_relation:"questo livello fa parte di una relazione",saved:"I dati sono stati salvati correttamente",saved_local:"I dati sono stati salvati correttamente in locale",loading_data:"Caricamento dati",saving:"Salvataggio dati in corso. Attendere ...",constraints:{enable_editing:"Aumentare il livello di zoom per abilitare l'editing \nScala di attivazione 1:"},pdf:"Anteprima del documento non disponibile. Clicca qui ",commit:{header:"La lista sotto riporta tutte le modifiche che verranno salvate.",header_add:"<b>Aggiunte</b> riporta il numero delle features aggiunte",header_update_delete:"<b>Modificate</b> e <b>Cancellate</b> riporta la lista degli id",add:"Aggiunte (n. features)",delete:"Cancellate(id)",update:"Modificate(id)"},loading_table_data:"Costruzione tabella dati in corso. Attendere ...",copy_and_paste_from_other_layer_mandatory_fields:"Necessario compilare eventuali campi obbligatori sulle features incollate prima del salvataggio",no_feature_selected:"Nessuna feature selezionata",select_min_2_features:"Seleziona come minimo due features"},relation:{table:{info:"<div>Seleziona le relazioni per associarle alla feature in editing.</div>"},draw_new_feature:"Disegna nuova geometria",draw_or_copy:"oppure",copy_feature_from_other_layer:"Copia geometria da altro layer"},form:{relations:{tooltips:{back_to_father:"Torna ad editare il padre",add_relation:"Crea ed aggiungi nuova relazione",link_relation:"Associa una relazione esistente a questa feature",open_relation_tools:"Apri strumenti relatione",unlink_relation:"Annulla relazione"}},buttons:{save:"Inserisci/Modifica",save_table:"Modifica",save_and_back:"Salva e torna al padre",save_and_back_table:"Salva e torna indietro",cancel:"Ignora Modifiche"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Seleziona feature/s",edit_attributes:"Edita attributi delle features in multiple mode"},copyfeaturefromprojectlayer:{title:"Seleziona una feature"}}}}},{}],22:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={close_editing_panel:{message:"To close editing form need to exit from editing layer"},errors:{no_layers:"Avem o eroare. Straturile nu sunt editabile",some_layers:"Avem o eroare: Anumite straturi nu se pot edita"},search:"Caută",editing_changes:"Modificare schimbări",editing_data:"Modificare straturi",editing_attributes:"Modificare atribute",relations:"Relații",edit_relation:"Modifică relația",back_to_relations:"Înapoi la Relații",no_relations_found:"Nu am găsit relații",relation_data:"Date relații",relation_already_added:"Relație adăugată deja",list_of_relations_feature:"Lista relații entitatea ",tooltip:{edit_layer:"Modifică strat"},toolbox:{title:"Modifică"},table:{edit:"Modifică entitate",copy:"Creează o copie",delete:"Elimină entitatea"},tools:{copy:"Copiază entitățile",pastefeaturesfromotherlayers:"Paste features from other layer",addpart:"Adaugă o parte la multiparte",deletepart:"Elimină partea din multiparte",merge:"Dizolvare entități",split:"Divizare Entitate",add_feature:"Adaugă entitate",delete_feature:"Eliminare entitate",move_feature:"Mută entitate",update_vertex:"Actualizează vertecșii entității",update_feature:"Actualizează atributul entității",update_multi_features:"Actualizează atributele entităților selectate",copyfeaturefromexternallayer:"Create Feature from added layer"},toolsoftool:{measure:"Arată măsurătorile",snap:"Acroșare strat",snapall:"Acroșare pe toate straturile"},steps:{help:{select_elements:"Selectează entități",select_element:"Selectează entitate",copy:"Creează o nouă copie a entităților selectate",merge:"Dizolvă entitățile",split:"Divizare Entitate",new:"Creează o entitate",edit_table:"Modifică entitățile tabelare",draw_new_feature:"Desenează entitate pe hartă",action_confirm:"Confirmă acțiunea",double_click_delete:"Selectează entitatea de eliminat din hartă",edit_feature_vertex:"Modifică sau adaugă un vertex la entitatea selectată",move:"Mută entitatea selectată",select_feature_to_relation:"Selectează entitate pentru relaționare",show_edit_feature_form:"Arată formularul entității pentru modificări",pick_feature:"Selectează entitățile de modificat din hartă",insert_attributes_feature:"Inserează atributele entității"}},workflow:{steps:{select:"Click pe entitate pentru a o selecta",draw_part:"Desenează o parte nouă",merge:"Selectează partea de dizolvat",selectSHIFT:"Selectează entități prin desen triunghi apăsând SHIFT",selectDrawBox:"Selectează entități desenând un dreptunghi prin două puncte opuse",selectDrawBoxAtLeast2Feature:"Selectează cel puțin 2 entități prin desenul unui dreptunghi",selectPoint:"Click pe entitate pentru selectare",selectPointSHIFT:"Selectează entități prin desen dreptunghi apăsând SHIFT (multientități) sau prin click pe entitate",selectMultiPointSHIFT:"Selectează entități prin desen dreptunghi apăsând SHIFT sau prin click pe entitate",selectMultiPointSHIFTAtLeast2Feature:"Selectează cel puțin 2 entități prin desen dreptunghi apăsând SHIFT sau prin click pe entitate",copyCTRL:"Copiază entitățile selectate folosint CTRL+C",selectStartVertex:"Selectează vertexul de start a entităților selectate",selectToPaste:"Selectează punctul unde să lipim entitățile selectate",draw_split_line:"Desenează o linie pentru a diviza entitatea selectată"}},messages:{featureslockbyotheruser:"Unele geometrii/înregistrări nu sunt editabile deoarece sunt editate de către alt utilizator",splitted:"Divizat",nosplittedfeature:"Entitate nedivizată",press_esc:"ESC pentru înapoi",online:"Înapoi ONLINE. Acum se pot salva schimbările",offline:"OFFLINE. Schimbările sunt salvate local",delete_feature:"Șterg entitatea selectată?",delete_feature_relations:"Dacă entitatea are relații care trimit la ea, acele relații devin orfane. Sugerăm să vă ocupați de acele elemente înainte să eliminați această entitate.",unlink_relation:"Dorești să eliminați legătura cu relația?",commit_feature:"Salvăm?",toolbox_has_relation:"acest strat face parte dintr-o relație",saved:"Datele sunt salvate",saved_local:"Datele s-au salvat local",loading_data:"Datele se încarcă.",saving:"Salvăm datele. Așteptați ...",constraints:{enable_editing:"Pentru a activa Modificare faceți zoom la \nScara de activare 1:"},pdf:"Previzualizarea documentului nu este disponibilă. Click aici ",commit:{header:"Lista cu toate modificările.",header_add:"<b>Adăugate</b> arată nr. de entități adăugate",header_update_delete:"<b>Modificate</b> și <b>Șterse</b> arată lista de id-uri de entități",add:"Adăugate(n. entități)",delete:"Eliminate(id)",update:"Modificate(id)"},loading_table_data:"Încărcăm tabelul de date ...",copy_and_paste_from_other_layer_mandatory_fields:"Înainte de a salva, este necesar să completați toate câmpurile obligatorii ale entități introduse",no_feature_selected:"Nicio feature selectată",select_min_2_features:"Select at least 2 features"},relation:{table:{info:"<div>Selectează relațiile pentru a face legătura cu entitatea curentă.</div>"},draw_new_feature:"Desenați o nouă feature",draw_or_copy:"sau",copy_feature_from_other_layer:"Copiați feature dintr-un alt layer"},form:{relations:{tooltips:{back_to_father:"Înapoi la modificările entității părinte",add_relation:"Creează și fă legătura unei relații noi",link_relation:"Leagă o relație de entitate",open_relation_tools:"Arată instrumentele pentru relații",unlink_relation:"Elimină legătura la relație"}},buttons:{save:"Inserați/Editați",save_and_back:"Salvează și dă înapoi",save_and_back_table:"Salvează și dă înapoi",cancel:"Ignorați modificările"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Select feature/s",edit_attributes:"Edit attributes of pasted features in multiple mode"},copyfeaturefromprojectlayer:{title:"Select a feature"}}}}},{}],23:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.default={close_editing_panel:{message:"To close editing form need to exit from editing layer"},errors:{no_layers:"Ett fel uppstod. Nivåerna kan inte redigeras.",some_layers:"Ett fel uppstod. Vissa nivåer kan inte redigeras."},search:"Sökning",editing_changes:"Editing Changes",editing_data:"Nivåerna redigeras",editing_attributes:"Attributen redigeras",relations:"Relationer",edit_relation:"Redigera relationen",back_to_relations:"Tillbaka till relationerna",no_relations_found:"Inga relationer hittades",relation_data:"Relationsuppgifter",relation_already_added:"Relationen har redan lagts till",list_of_relations_feature:"Lista på relationens egenskaper",tooltip:{edit_layer:"Redigera nivån"},toolbox:{title:"Redigera"},table:{edit:"Redigera egenskap",copy:"Skapa en kopia",delete:"Ta bort egenskap"},tools:{copy:"Kopiera egenskaper",pastefeaturesfromotherlayers:"Paste features from other layer",addpart:"Lägg till del",deletepart:"Ta bort del",merge:"Slå samman egenskaper",split:"Dela upp egenskap",add_feature:"Lägg till egenskap",delete_feature:"Ta bort egenskap",move_feature:"Flytta egenskap",update_vertex:"Uppdatera punktens egenskap",update_feature:"Uppdatera egenskap",update_multi_features:"Ändra attributen för de valda funktionerna",copyfeaturefromexternallayer:"Create Feature from added layer"},toolsoftool:{measure:"Show measure",snap:"Snap layer",snapall:"Snap to all layers"},steps:{help:{select_elements:"Välj egenskaper",select_element:"Välj egenskapalitse ominaisuus",copy:"Skapa kopia av valda egenskaper",merge:"Slå samman egenskaper",split:"Dela upp egenskap",new:"Skapa ny egenskap",edit_table:"Ändra egenskaper i tabellen",draw_new_feature:"Piirrä ominaisuus kartalle",action_confirm:"Godkänn funktionen",double_click_delete:"Välj funktionen som du vill ta bort på kartan",edit_feature_vertex:"Ändra punkten eller lägg till punkten till den valda egenskapen",move:"Flytta den valda egenskapen",select_feature_to_relation:"Välj relation",show_edit_feature_form:"Visa egenskapsformuläret för redigering av attribut",pick_feature:"Välj funktion på kartan för att ändras",insert_attributes_feature:"Lägg till egenskapens attribut"}},workflow:{steps:{select:"Välj egenskap",draw_part:"Rita ny del",merge:"Välj egenskap att slå samman",selectSHIFT:"Tryck SHIFT, om du vill välja objekt med hjälp av rektangel.",selectDrawBox:"Rita upp den rektangel inom vilken objekten väljs ",selectDrawBoxAtLeast2Feature:"Rita rektangeln inom vilken minst två objekt är markerade ",selectPoint:"Välj egenskap",selectPointSHIFT:"Tryck SHIFT, om du vill välja objekt med hjälp av rektangel, eller välj en enskild egenskap.",selectMultiPointSHIFT:"Tryck SHIFT, om du vill välja objekt med hjälp av rektangel, eller välj en enskild egenskap.",selectMultiPointSHIFTAtLeast2Feature:"Tryck på SKIFT för att välja minst två objekt med en rektangel eller välj en enda egenskap. ",copyCTRL:"CTRL+C, du kan kopiera valda egenskaper.",selectStartVertex:"Visa startpunkten för valda egenskaper.",selectToPaste:"Välj punkt till vilken de valda egenskaperna ska fogas.",draw_split_line:"Rita en linje enligt vilken den valda egenskapen ska uppdelas."}},messages:{featureslockbyotheruser:"Jotkut geometriat/tietueet eivät ole muokattavissa, koska muut käyttäjät muokkaavat niitä",splitted:"Uppdelad",nosplittedfeature:"Egenskapen har inte delats upp",press_esc:"Tryck ESC för att gå tillbaka",online:"Förbindelsen har upprättats. Ändringar kan sparas i databasen.",offline:"Du är i offline-läge. Ändringarna sparas lokalt",delete_feature:"Vill du ta bort den valda egenskapen?",delete_feature_relations:"Om egenskapen saknar bindande relationer blir dessa relationer föräldralösa. Vi rekommenderar att du behandlar dessa relationer innan du lämnar programmet",unlink_relation:"Vill du ta bort relationen?",commit_feature:"Ska ändringarna sparas?",toolbox_has_relation:"detta lager är en del av en relation",saved:"Uppgifterna sparades",saved_local:"Uppgifterna sparades lokalt.",loading_data:"Uppgifterna laddas",saving:"Uppgifterna sparas. Vänta...",constraints:{enable_editing:"Zooma in för att börja använda redigeringsverktyg \nAktivering skala 1:"},pdf:"Förhandsgranskning av dokument är inte tillgänglig. Tryck här",commit:{header:"Följande lista visar alla ändringar.",header_add:"<b>Tillagda</b> visar antalet egenskaper som lagts till",header_update_delete:"<b>Redigerad</b> och <b>Borttagen</b> Visa en lista på egenskapernas id",add:"(n. egenskaper) har lagts till",delete:"Borttagen (id)",update:"Redigerad(id)"},loading_table_data:"Building Data Table. Please wait ...",copy_and_paste_from_other_layer_mandatory_fields:"It is necessary to fill in any mandatory fields on the features pasted before saving",no_feature_selected:"No feature selected",select_min_2_features:"Select at least 2 features"},relation:{table:{info:"<div>Välj relation för länkning till egenskap som ska redigeras.</div>"},draw_new_feature:"Draw new feature",draw_or_copy:"or",copy_feature_from_other_layer:"Copy feature from other layer"},form:{relations:{tooltips:{back_to_father:"Back to edit father",add_relation:"Skapa och länka ny relation",link_relation:"Foga relationen till denna egenskap",open_relation_tools:"Visa relationsverktyg",unlink_relation:"Ta bort relation"}},buttons:{save:"Infoga/Redigera",save_and_back:"Spara och gå tillbaka",save_and_back_table:"Spara och gå tillbaka",cancel:"Ignorera ändringar"}},modal:{tools:{copyfeaturefromotherlayer:{title:"Select feature/s",edit_attributes:"Edit attributes of pasted features in multiple mode"},copyfeaturefromprojectlayer:{title:"Select a feature"}}}}},{}],24:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var e=e("./i18n"),e=(e=e)&&e.__esModule?e:{default:e};i.default={i18n:e.default}},{"./i18n":20}],25:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});var n=i.VM=new Vue;i.default={VM:n}},{}],26:[function(i,e,t){function l(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}var n=g3wsdk.core.utils,u=n.base,n=n.inherit,d=g3wsdk.gui.GUI,r=g3wsdk.gui.vue.FormComponent,c=i("./editingformservice");function a(){var n=this,r=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=(u(this,r),i("../services/editingservice")),o=r.context_inputs||null,s=r.layer.getId(),e=r.layer.getLayerEditingFormStructure(),t=o&&o.inputs&&o.inputs.features&&o.inputs.features[o.inputs.features.length-1];e&&t&&(t.isNew()?Promise.resolve():a.getLayersDependencyFeatures(s,{relations:r.layer.getRelations().getArray().filter(function(e){return s===e.getFather()&&a.getLayerById(e.getChild())&&"ONE"!==e.getType()}),feature:t,filterType:"fid"})).then(function(){o.formEventBus=n.getService().getEventBus();var t,e=new c(o).buildRelationComponents(),i=a.getFormComponentsById(s);0<i.length&&n.addFormComponents(i),0<e.length&&n.addFormComponents(e),n.getService().handleRelation=(t=l(function*(e){e=e.relation;d.setLoadingContent(!0),yield a.setLayerUniqueFieldValues(r.layer.getRelationById(e.name).getChild()),this.setCurrentComponentById(e.name),d.setLoadingContent(!1)}),function(e){return t.apply(this,arguments)})})}n(a,r),e.exports=a},{"../services/editingservice":31,"./editingformservice":27}],27:[function(r,e,t){var s=g3wsdk.gui.GUI,l=r("../components/FormRelation.vue");e.exports=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=r("../services/editingservice"),i=(this.state={relations:[]},e.inputs||{}),n=i.layer,i=i.features,a=(this._formEventBus=e.formEventBus||null,n.getId()),o=n.getRelations().getArray().filter(function(e){return"ONE"!==e.getType()&&e.getFather()===a}),o=t.getRelationsInEditing({layerId:a,relations:o,feature:i[i.length-1]});this.hasRelations=function(){return 0<o.length},this.buildRelationComponents=function(){var n=this,r=[];return o.forEach(function(e){var t=e.relation,i=e.relations,e=Vue.extend({mixins:[l],name:"relation_"+Date.now(),methods:{getService:function(){return n._relationsService}},data:function(){return{layerId:a,relation:t,relations:i,resourcesurl:s.getResourcesUrl(),formeventbus:n._formEventBus}}});r.push({title:"plugins.editing.edit_relation",name:t.name,id:t.id,header:!1,component:e})}),r}}},{"../components/FormRelation.vue":7,"../services/editingservice":31}],28:[function(e,t,i){var n=e("./config"),r=(n=n)&&n.__esModule?n:{default:n};function a(){var e=this,t=(o(this,{name:"editing",i18n:r.default.i18n,service:u,fontClasses:[{name:"measure",className:"fas fa-ruler-combined"},{name:"magnete",className:"fas fa-magnet"},{name:"clipboard",className:"fas fa-clipboard"}]}),{position:0,title:"EDITING"}),i={some_layers:!1};this.panel=null,this.service.loadPlugin()&&(this.setHookLoading({loading:!0}),this.service.once("ready",function(){e.registerPlugin(e.config.gid)&&(l.isready?e.setupGui():l.on("ready",e.setupGui.bind(e))),e.setHookLoading({loading:!1}),e.setApi(e.service.getApi()),e.setReady(!0)}),this.service.init(this.config)),this.setupGui=function(){if(!1===this.config.visible)return!1;this.config.name=this.config.name||"plugins.editing.editing_data",this.addToolGroup(t),this.addTools({action:this.showEditingPanel,offline:!1,icon:"pencil"},t)},this.showEditingPanel=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return 0<this.service.getLayers().length?(this.panel=new d(e),l.showPanel(this.panel),!i.some_layers&&this.service.getLayersInError()&&(l.showUserMessage({type:"warning",message:"plugins.editing.errors.some_layers",closable:!0}),i.some_layers=!0)):l.showUserMessage({type:"alert",message:"plugins.editing.errors.no_layers"}),this.panel},this.hideEditingPanel=function(){null!==this.panel&&(l.closePanel(),this.panel=null)},this.unload=function(){this.hideEditingPanel(),this.config.visible&&this.removeTools(),this.service.clear()}}var n=g3wsdk.core.utils,o=n.base,n=n.inherit,s=g3wsdk.core.plugin.Plugin,l=g3wsdk.gui.GUI,u=e("./services/editingservice"),d=e("./panel");n(a,s),new a},{"./config":24,"./panel":30,"./services/editingservice":31}],29:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0});function n(e,t,i,n){this.type=e,this.features=n,this.coordinate=t,this.layer=i}var r="picked",i=i.PickFeaturesInteraction=function e(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};ol.interaction.Pointer.call(this,{handleDownEvent:e.handleDownEvent_,handleUpEvent:e.handleUpEvent_,handleMoveEvent:e.handleMoveEvent_}),this.layer=t.layer,this.pickedFeatures=[]};ol.inherits(i,ol.interaction.Pointer),i.handleDownEvent_=function(e){return this.pickedFeatures=this.featuresAtPixel(e),this.pickedFeatures},i.handleUpEvent_=function(e){return this.pickedFeatures&&this.pickedFeatures.length&&this.dispatchEvent(new n(r,e.coordinate,this.layer,this.pickedFeatures)),!0},i.prototype.featuresAtPixel=function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=e.pixel;return e.map.getFeaturesAtPixel(i,{layerFilter:function(e){return e===t.layer},hitTolerance:isMobile&&isMobile.any?10:0})},i.handleMoveEvent_=function(e){var t=e.map.getTargetElement(),e=this.featuresAtPixel(e);t.style.cursor=e?"pointer":""},i.prototype.shouldStopEvent=function(){return!1},i.prototype.setMap=function(e){e||(this.getMap().getTargetElement().style.cursor=""),ol.interaction.Pointer.prototype.setMap.call(this,e)}},{}],30:[function(e,t,i){var n=e("./components/Editing.vue"),r=(n=n)&&n.__esModule?n:{default:n};var n=g3wsdk.core.utils,a=n.base,o=n.inherit,s=n.merge,l=g3wsdk.gui.GUI,n=g3wsdk.gui.vue.Component,u=e("./services/editingservice");function d(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=(t.id="editing-panel",t.title=t.title||"plugins.editing.editing_data",t.name="Editing Layer",t.toolboxes=t.toolboxes||null,t.showcommitbar=void 0===t.showcommitbar||t.showcommitbar,a(this,t),this.vueComponent=r.default,this.name=void 0!==t.name?t.name:"Editing data",s(this,t),this._resourcesUrl=t.resourcesUrl||l.getResourcesUrl(),this._service=t.service||u,Vue.extend(this.vueComponent));this.internalComponent=new i({service:this._service,data:function(){return{state:e._service.state,resourcesurl:e._resourcesUrl,showcommitbar:t.showcommitbar,editingButtonsEnabled:!0}}}),this.mount=function(e){return a(this,"mount",e,!0)},this.unmount=function(){var e=this,t=$.Deferred();return this._service.stop().finally(function(){e.unmount=function(){a(this,"unmount").then(function(){return t.resolve()})},e.unmount()}),t.promise()}}o(d,n),t.exports=d},{"./components/Editing.vue":6,"./services/editingservice":31}],31:[function(l,e,O){var r=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,n=arguments[t];for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},g=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var i=t,n=[],r=!0,t=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!i||n.length!==i);r=!0);}catch(e){t=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(t)throw a}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},t=l("../api"),i=(t=t)&&t.__esModule?t:{default:t};function d(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}function y(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}var u=g3wsdk.constant.G3W_FID,t=g3wsdk.core,m=t.ApplicationState,c=t.ApplicationService,a=g3wsdk.core.data.DataRouterService,t=g3wsdk.core.utils,n=t.base,o=t.inherit,s=t.XHR,f=g3wsdk.core.geometry.Geometry,t=g3wsdk.core.geoutils,p=t.getFeaturesFromResponseVectorApi,h=t.isSameBaseGeometryType,v=g3wsdk.core.workflow.WorkflowsStack,t=g3wsdk.core.plugin.PluginService,w=g3wsdk.core.editing.SessionsRegistry,b=g3wsdk.core.catalog.CatalogLayersStoresRegistry,k=g3wsdk.core.map.MapLayersStoreRegistry,F=g3wsdk.core.layer,x=F.Layer,S=F.LayersStore,I=g3wsdk.core.layer.features.Feature,E=g3wsdk.gui.GUI,T=g3wsdk.core.errors.parsers.Server,L=g3wsdk.core.i18n.tPlugin,F=g3wsdk.ol.utils,C=F.getScaleFromResolution,R=F.getResolutionFromScale,D=l("../toolboxes/toolboxesfactory"),j=l("../workflows/commitfeaturesworkflow"),P="mapcontrol:toggled",A={CHANGES:"EDITING_CHANGES"};function M(){var t=this;n(this),this._sessions={},this.constraints={},this._vectorUrl,this._projectType,this._unByKeys=[],this.setterKeys=[],this._events={layer:{start_editing:{before:{},after:{}}}},this.layersUniqueFieldsValues={},this.saveConfig={mode:"default",modal:!1,messages:void 0,cb:{done:void 0,error:void 0}},this.applicationEditingConstraints={toolboxes:{},showToolboxesExcluded:!0},this.state={open:!1,toolboxes:[],toolboxselected:null,toolboxidactivetool:null,showselectlayers:!0,message:null,relations:[]},this.loadLayersFeaturesToResultWhenCloseEditing={},this._layers_in_error=!1,this._mapService=E.getService("map"),this.mapControlToggleEventHandler=function(e){e.target.isToggled()&&e.target.isClickMap()&&t.state.toolboxselected&&t.state.toolboxselected.getActiveTool()&&t.state.toolboxselected.stopActiveTool()},this._mapService.on(P,this.mapControlToggleEventHandler),this._formComponents={},this._subscribers={},this.init=function(){var i=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=(this._vectorUrl=e.vectorurl,this._projectType=e.project_type,this._layersstore=new S({id:"editing",queryable:!1}),k.addLayersStore(this._layersstore),this.config=e,this._editableLayers={},this._toolboxes=[],this.state.toolboxes=[],this._getEditableLayersFromCatalog()),t=[],n=!0,r=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var l=o.value;t.push(l.getLayerForEditing({vectorurl:this._vectorUrl,project_type:this._projectType}))}}catch(e){r=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(r)throw a}}Promise.allSettled(t).then(function(e){e.forEach(function(e){var t;"fulfilled"===e.status?(t=e.value.getId(),i._editableLayers[t]=e.value,i._attachLayerWidgetsEvent(e.value),i._sessions[t]=null):i._layers_in_error=!0}),i._ready()})},this._ready=function(){this.setRelations1_1FieldsEditable(),this.setLayersColor(),this._layersstore.addLayers(this.getLayers()),this._buildToolBoxes(),this._createToolBoxDependencies(),this.setApi({api:new i.default({service:this})}),this.registerResultEditingAction(),this.emit("ready")}}o(M,t);var B,V,F=M.prototype;F.getAppState=function(){return m},F.getFormComponentsById=function(e){return this._formComponents[e]||[]},F.getFormComponents=function(){return this._formComponents},F.addFormComponents=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layerId,e=e.components,i=void 0===e?[]:e;this._formComponents[t]||(this._formComponents[t]=[]);for(var n=0;n<i.length;n++)this._formComponents[t].push(i[n])},F.getSession=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).layerId;return this.getToolBoxById(e).getSession()},F.getFeature=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).layerId;return this.getToolBoxById(e).getActiveTool().getFeature()},F.subscribe=function(e,t){return this._subscribers[e]||(this._subscribers[e]=[]),this._subscribers[e].find(function(e){return e===t})||this._subscribers[e].push(t),t},F.unsubscribe=function(e,t){this._subscribers[e]=this._subscribers[e].filter(function(e){return e!==t})},F.setRelations1_1FieldsEditable=function(){var n=this;this.getLayers().forEach(function(e){var i=e.getId();n.getRelation1_1ByLayerId(i).forEach(function(e){var t;i===e.getFather()&&(t=void 0!==n.getLayerById(e.getChild()),n.getRelation1_1EditingLayerFieldsReferredToChildRelation(e).forEach(function(e){e.editable=e.editable&&t}))})})},F.getRelation1_1EditingLayerFieldsReferredToChildRelation=function(t){return this.getLayerById(t.getFather()).getEditingFields().filter(function(e){return e.vectorjoin_id&&e.vectorjoin_id===t.getId()})},F.getRelation1_1ByLayerId=function(e){return b.getLayerById(e).getRelations().getArray().filter(function(e){return"ONE"===e.getType()})},F.setShowSelectLayers=function(){this.state.showselectlayers=!(0<arguments.length&&void 0!==arguments[0])||arguments[0]},F.registerResultEditingAction=function(){var i=this,e=E.getService("queryresults");this.setterKeys.push({setter:"editFeature",key:e.onafter("editFeature",function(e){var t=e.layer,e=e.feature;i.editResultLayerFeature({layer:t,feature:e})})})},F.unregisterResultEditingAction=function(){var i=E.getService("queryresults");this.setterKeys.forEach(function(e){var t=e.setter,e=e.key;return i.un(t,e)})},F.editResultLayerFeature=function(){var n=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layer,e=e.feature,r=e.attributes[u],a=(this.getToolBoxes().forEach(function(e){return e.setShow(e.getId()===t.id)}),this.getPlugin().showEditingPanel(),this.getToolBoxById(t.id)),o=a.getEditingConstraints().scale,s=e.geometry&&void 0!==o;a.start({filter:{fids:r}}).then(function(e){e.features;var t,e=a.getLayer(),i=e.getEditingLayer().getSource(),i=(e.getType()===x.LayerTypes.VECTOR?i.getFeatures():i.readFeatures()).find(function(e){return e.getId()==r});i&&(i.getGeometry()&&(n._mapService.zoomToGeometry(i.getGeometry()),s)?n._mapService.getMap().once("moveend",function(){var e=n._mapService.getMapUnits(),t=n._mapService.getMap(),i=parseInt(C(t.getView().getResolution(),e));o<i&&t.getView().setResolution(R(o,e)),a.setSelected(!0)}):a.setSelected(!0),t=a.getSession(),n.setSelectedToolbox(a),new(l("../workflows/editnopickmapfeatureattributesworkflow"))({runOnce:!0}).start({inputs:{layer:e,features:[i]},context:{session:t}}).then(function(){return t.save().then(function(){return n.saveChange()})}).fail(function(){return t.rollback()}))}).fail(function(e){})},F.disableMapControlsConflict=function(){this._mapService.disableClickMapControls(!(0<arguments.length&&void 0!==arguments[0])||arguments[0])},F.setSelectedToolbox=function(e){this.state.toolboxselected=e},F.getToolboxSelected=function(){return this.state.toolboxselected},F.addNewFeature=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=new I,t=(t.geometry&&i.setGeometry(new ol.geom[t.geometry.type](t.geometry.coordinates)),i.setProperties(t.properties),i.setTemporaryId(),this.getToolBoxById(e)),n=t.getLayer().getEditingLayer(),t=t.getSession();return n.getSource().addFeature(i),t.pushAdd(e,i,!1),i},F.getLayersInError=function(){return this._layers_in_error},F.getMapService=function(){return this._mapService},F._initOffLineItems=function(){for(var e in A)this.getOfflineItem(A[e])||c.setOfflineItem(A[e])},F._handleOfflineChangesBeforeSave=function(e){function t(e){var i=e.layerId,n=e.current,e=e.previous;n[i].add=[].concat(y(e[i].add),y(n[i].add)),n[i].delete=[].concat(y(e[i].delete),y(n[i].delete)),e[i].update.forEach(function(e){var t=e.id;n[i].update.find(function(e){return e.id===t})||n[i].update.unshift(e)}),(e[i].lockids||[]).forEach(function(e){var t=e.featureid;n[i].lockids.find(function(e){return e.featureid===t})||n[i].update.unshift(e)})}var i,n=c.getOfflineItem(A.CHANGES);for(i in n){var r,a=e[i]?e:e[Object.keys(e)[0]].relations[i]?e[Object.keys(e)[0]].relations:null;a?t({layerId:i,current:a,previous:n}):(a=Object.keys(e)[0],(r=Object.keys(n[i].relations)).length?-1!==r.indexOf(a)&&(t({layerId:a,current:e,previous:n[i].relations}),n[i].relations[a]=e[a],e=n):e[i]=n[i])}return e},F.saveOfflineItem=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.id,e=e.data;return t===A.CHANGES&&(e=this._handleOfflineChangesBeforeSave(e)),c.setOfflineItem(t,e)},F.setOfflineItem=function(e,t){c.setOfflineItem(e,t)},F.getOfflineItem=function(e){return c.getOfflineItem(e)},F.checkOfflineChanges=function(){var s=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.modal,l=void 0===t||t,t=e.unlock,u=void 0!==t&&t;return new Promise(function(i,n){var r,a,o=c.getOfflineItem(A.CHANGES);o&&(r=[],a=[],setTimeout(function(){for(var e in o){a.push(e);var t=s.getToolBoxById(e),e=o[e];r.push(s.commit({toolbox:t,commitItems:e,modal:l}))}$.when.apply(s,r).then(function(){return i()}).fail(function(e){return n(e)}).always(function(){u&&a.forEach(function(e){s.getLayerById(e).unlock()}),s.setOfflineItem(A.CHANGES)})},1e3))})},F.registerOnLineOffLineEvent=function(){var e=this,t=(m.online&&this.checkOfflineChanges({unlock:!0}),c.onafter("offline",function(){})),i=c.onafter("online",function(){e.checkOfflineChanges({modal:!1}).then(function(){}).catch(function(e){return E.notify.error(e)})});this._unByKeys.push({owner:c,setter:"offline",key:t}),this._unByKeys.push({owner:c,setter:"online",key:i})},F.unregisterOnLineOffLineEvent=function(){this.unregisterSettersEvents(["online","offline"])},F.unregisterSettersEvents=function(){this._unByKeys.forEach(function(e){var t=e.owner,i=e.setter,e=e.key;t.un(i,e)})},F.fireEvent=function(i){var n=this,r=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return new Promise(function(e){n._subscribers[i]&&n._subscribers[i].forEach(function(e){var t=e(r);t&&t.once&&n.unsubscribe(i,e)}),e()})},F.activeQueryInfo=function(){this._mapService.activeMapControl("query")},F.setLayersColor=function(){var e=["#C43C39","#d95f02","#91522D","#7F9801","#0B2637","#8D5A99","#85B66F","#8D2307","#2B83BA","#7D8B8F","#E8718D","#1E434C","#9B4F07","#1b9e77","#FF9E17","#7570b3","#204B24","#9795A3","#C94F44","#7B9F35","#373276","#882D61","#AA9039","#F38F3A","#712333","#3B3A73","#9E5165","#A51E22","#261326","#e4572e","#29335c","#f3a712","#669bbc","#eb6841","#4f372d","#cc2a36","#00a0b0","#00b159","#f37735","#ffc425"],t=!0,i=!1,n=void 0;try{for(var r,a=this.getLayers()[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var o=r.value;o.getColor()||o.setColor(e.splice(0,1)[0])}}catch(e){i=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw n}}},F._layerChildrenRelationInEditing=function(e){var t=this;return e.getChildren().filter(function(e){return t.getLayerById(e)})},F.undo=function(){var e=this.state.toolboxselected.getSession(),t=e.getId(),i=e.getLastHistoryState().items,t=(this.undoRedoLayerUniqueFieldValues({layerId:t,sessionItems:i,action:"undo"}),e.undo());this.undoRedoRelationUniqueFieldValues({relationSessionItems:t,action:"undo"}),this.undoRelations(t)},F.undoRelations=function(e){var i=this;Object.entries(e).forEach(function(e){var e=g(e,2),t=e[0],e=e[1];i.getToolBoxById(t).getSession().undo(e)})},F.rollbackRelations=function(e){var i=this;Object.entries(e).forEach(function(e){var e=g(e,2),t=e[0],e=e[1];i.getToolBoxById(t).getSession().rollback(e)})},F.redo=function(){var e=this.state.toolboxselected.getSession(),t=e.getId(),i=e.getLastHistoryState().items,t=(this.undoRedoLayerUniqueFieldValues({layerId:t,sessionItems:i,action:"redo"}),e.redo());this.undoRedoRelationUniqueFieldValues({relationSessionItems:t,action:"redo"}),this.redoRelations(t)},F.redoRelations=function(e){var i=this;Object.entries(e).forEach(function(e){var e=g(e,2),t=e[0],e=e[1];i.getToolBoxById(t).getSession().redo(e)})},F.getEditingLayer=function(e){return this._editableLayers[e].getEditingLayer()},F._buildToolBoxes=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=!0,i=!1,n=void 0;try{for(var r,a=this.getLayers()[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var o=r.value,s=D.build(o,e);this.addToolBox(s)}}catch(e){i=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw n}}},F.addToolBox=function(e){this._toolboxes.push(e),this._sessions[e.getId()]=e.getSession(),this.state.toolboxes.push(e.state)},F.setOpenEditingPanel=function(t){this.state.open=t,this._getEditableLayersFromCatalog().forEach(function(e){return e.setInEditing(t)})},F.addEvent=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.type,i=e.id,e=e.fnc;this._events[t]||(this._events[t]={}),this._events[t][i]||(this._events[t][i]=[]),this._events[t][i].push(e)},F.addEvents=function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=e.types,i=void 0===i?[]:i,n=e.id,r=e.fnc;i.forEach(function(e){return t.addEvent({type:e,id:n,fnc:r})})},F.runEventHandler=d(function*(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.type,e=e.id;yield this._events[t]&&this._events[t][e]&&Promise.allSettled(this._events[t][e].map(function(e){return e()}))}),F.setSaveConfig=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.mode,i=e.cb,i=void 0===i?{}:i,n=e.modal,n=void 0!==n&&n,e=e.messages;this.saveConfig.mode=void 0===t?"default":t,this.saveConfig.modal=n,this.saveConfig.messages=e,this.saveConfig.cb=r({},this.saveConfig.cb,i)},F.getSaveConfig=function(){return this.saveConfig},F.resetDefault=function(){this.saveConfig={mode:"default",modal:!1,messages:null,cb:{done:null,error:null}},this.disableMapControlsConflict(!1)},F._attachLayerWidgetsEvent=function(c){for(var n=this,f=c.getEditingFields(),e=0;e<f.length;e++)!function(e){var r,a,t,i,o,s,l,u,d=f[e];!d.input||"select_autocomplete"!==d.input.type||d.input.options.filter_expression||(e=d.input.options,r=e.key,e.values,a=e.value,t=e.usecompleter,i=e.layer_id,o=e.loading,e.relation_id,s=e.relation_reference,e=e.filter_fields,l=void 0===e?[]:e,u=n,t)||n.addEvents({types:["start-editing","show-relation-editing"],id:c.getId(),fnc:function(){return new Promise(function(n,t){var e;o.state="loading",d.input.options.values=[],s&&(-1<[void 0,null].indexOf(l)||0===l.length)?c.getFilterData({fformatter:d.name}).then(function(e){e&&e.data&&(e.data.forEach(function(e){var e=g(e,2),t=e[0],e=e[1];d.input.options.values.push({key:e,value:t})}),o.state="ready",u.fireEvent("autocomplete",{field:d,data:[e.data]}),n(d.input.options.values))}).catch(function(e){o.state="error",t(e)}):i?(e=b.getLayerById(i))&&e.getDataTable({ordering:r}).then(function(e){if(e&&e.features){for(var t=e.features,i=0;i<t.length;i++)d.input.options.values.push({key:t[i].properties[r],value:t[i].properties[a]});o.state="ready",u.fireEvent("autocomplete",{field:d,features:t}),n(d.input.options.values)}}).fail(function(e){o.state="error",t(e)}):(e=[],o.state="ready",u.fireEvent("autocomplete",{field:d,features:e}),n(e))})}})}(e)},F._createToolBoxDependencies=function(){var a=this;this._toolboxes.forEach(function(e){var t=e.getLayer();if(e.setFather(t.isFather()),e.state.editing.dependencies=a._getToolBoxEditingDependencies(t),t.isFather()&&e.hasDependencies()){var i,n=t.getRelations().getRelations();for(i in n){var r=n[i];e.addRelation(r)}}})},F.isFieldRequired=function(e,t){return this.getLayerById(e).isFieldRequired(t)},F._getToolBoxEditingDependencies=function(e){var t=this;return[].concat(y(e.getChildren()),y(e.getFathers())).filter(function(e){return void 0!==t.getLayerById(e)})},F._hasEditingDependencies=function(e){return 0<this._getToolBoxEditingDependencies(e).length},F.handleToolboxDependencies=function(e){var t=this;e.isFather()&&this.getLayersDependencyFeatures(e.getId()),e.getDependencies().forEach(function(e){t.getToolBoxById(e).setEditing(!1)})},F._getEditableLayersFromCatalog=function(){return b.getLayers({EDITABLE:!0})},F.getLayers=function(){return Object.values(this._editableLayers)},F.getCurrentWorkflow=function(){return v.getCurrent()},F.getCurrentWorkflowData=function(){var e=v.getCurrent();return{session:e.getSession(),inputs:e.getInputs(),context:e.getContext(),feature:e.getCurrentFeature(),layer:e.getLayer()}},F.getRelationsAttributesByFeature=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layerId,i=e.relation,e=e.feature,n=this.getToolBoxById(t).getLayer();return this.getRelationsByFeature({layerId:t,relation:i,feature:e}).map(function(e){return{fields:n.getFieldsWithValues(e,{relation:!0}),id:e.getId()}})},F._getRelationLayerId=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layerId,e=e.relation,i=e.getChild?e.getChild():e.child,e=e.getFatherField?e.getFatherField():e.fatherField;return i===t?e:i},F.getRelationsByFeature=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layerId,i=e.relation,n=e.feature,r=this.getLayerById(i.getFather?i.getFather():i.father),e=this._getRelationFieldsFromRelation({layerId:t,relation:i}),a=e.ownField,o=e.relationField.map(function(e){return n.isNew()&&r.isPkField(e)?n.getId():n.get(e)});return this._getFeaturesByLayerId(t).filter(function(i){return a.every(function(e,t){return i.get(e)==o[t]})})},F.registerLeavePage=function(e){c.registerLeavePage({bool:e})},F.loadPlugin=function(){return this._load=!!this._getEditableLayersFromCatalog().length},F.getLayerById=function(e){return this._editableLayers[e]},F.beforeEditingStart=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).layer;this._checkLayerWidgets(e)},F.afterEditingStart=function(){(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).layer},F.getToolBoxById=function(t){return this._toolboxes.find(function(e){return e.getId()===t})},F.getSessionById=function(e){return this._sessions[e]},F.setApplicationEditingConstraints=function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{showToolboxesExcluded:!0,toolboxes:{}},i=(this.applicationEditingConstraints=r({},this.applicationEditingConstraints,e),e.toolboxes),e=e.showToolboxesExcluded,n=Object.keys(i);!1===e&&this.state.toolboxes.forEach(function(e){return e.show=-1!==n.indexOf(e.id)}),n.forEach(function(e){return t.getToolBoxById(e).setEditingConstraints(i[e])})},F.getApplicationEditingConstraints=function(){return this.applicationEditingConstraints},F.getApplicationEditingConstraintById=function(e){return this.applicationEditingConstraints.toolboxes[e]},F.getToolBoxes=function(){return this._toolboxes},F.getEditableLayers=function(){return this._editableLayers},F._cancelOrSave=function(){return resolve()},F.stop=function(){var n=this;return new Promise(function(e,t){var i=[];n._toolboxes.forEach(function(e){e.getSession().getHistory().state.commit&&i.push(n.commit({toolbox:e,modal:!0}))}),$.when.apply(n,i).always(function(){n._toolboxes.forEach(function(e){return e.stop()}),n.clearState(),n._mapService.refreshMap(),e()})})},F.clear=function(){k.removeLayersStore(this._layersstore),w.clear(),this._mapService.off(P,this.mapControlToggleEventHandler),this.unregisterResultEditingAction()},F.clearState=function(){this.state.toolboxselected=null,this.state.toolboxidactivetool=null,this.state.message=null},F.getRelationsInEditing=function(){var i=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=e.layerId,t=e.relations,t=void 0===t?[]:t,r=e.feature,a=[],o=void 0;return t.forEach(function(e){var t=i._getRelationLayerId({layerId:n,relation:e});i.getLayerById(t)&&(o={relation:e.getState(),relations:i.getRelationsAttributesByFeature({layerId:t,relation:e,feature:r}),validate:{valid:!0}},a.push(o))}),a},F._filterRelationsInEditing=function(e){var t=this,i=e.layerId,e=e.relations;return(void 0===e?[]:e).filter(function(e){return t.getToolBoxById(t._getRelationId({layerId:i,relation:e}))})},F.stopToolboxesChildren=function(t){var i=this,e=this.getLayerById(t);this._filterRelationsInEditing({relations:e.getRelations()?e.getRelations().getArray():[],layerId:t}).filter(function(e){return e.getFather()===t}).forEach(function(e){e=i._getRelationId({layerId:t,relation:e});i.getToolBoxById(e).inEditing()&&i.getToolBoxById(e).stop()})},F.stopSessionChildren=function(t){var i=this,e=this.getLayerById(t);this._filterRelationsInEditing({relations:e.getRelations()?e.getRelations().getArray():[],layerId:t}).filter(function(e){return e.getFather()===t}).forEach(function(e){e=i._getRelationId({layerId:t,relation:e});i.getToolBoxById(e).inEditing()||i._sessions[e].stop()})},F.fathersInEditing=function(t){var i=this;return this.getLayerById(t).getFathers().filter(function(e){var e=i.getToolBoxById(e);if(e&&e.inEditing()&&e.isDirty())return e=e.getSession().getCommitItems().relations,Object.keys(void 0===e?{}:e).find(function(e){return t===e})})},F._getRelationFieldsFromRelation=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layerId,e=e.relation,t=(e.getChild?e.getChild():e.child)!==t,i=e.getFatherField?e.getFatherField():e.fatherField,e=e.getChildField?e.getChildField():e.childField;return{ownField:t?i:e,relationField:t?e:i}},F.createEditingDataOptions=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"all",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=void 0;switch(e){case"all":i=void 0;break;case"bbox":i={bbox:this._mapService.getMapBBOX()};break;case"field":i={field:{field:t.field,type:"editing"}};break;case"fid":"not"!==t.operator&&(i={fid:{fid:t.feature.getId(),layer:{id:t.layerId},type:"editing",relation:t.relation.state,formatter:0}});break;case"1:1":i={field:t.relation.getChildField()[0]+"|eq|"+t.feature.get(t.relation.getFatherField()[0]),type:"editing"}}return{registerEvents:!0,editing:!0,filter:i}},F._getFeaturesByLayerId=function(e){return this.getLayerById(e).readEditingFeatures()},F.getLayersDependencyFeaturesFromSource=function(){var a=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},o=e.layerId,s=e.relation,l=e.feature,e=e.operator,u=void 0===e?"eq":e;return new Promise(function(e){if("eq"!==u)return e(!1);var t=a._getRelationFieldsFromRelation({layerId:o,relation:s}),i=t.ownField,t=t.relationField,n=a._getFeaturesByLayerId(o),r=t.map(function(e){return l.get(e)});e(i.every(function(t,i){return n.find(function(e){return e.get(t)==r[i]})}))})},F._getRelationId=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layerId,e=e.relation,i=e.getFather?e.getFather():e.father,e=e.getChild?e.getChild():e.child;return i===t?e:i},F.getLayersDependencyFeatures=function(s){var l=this,u=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},t=[],e=this.getLayerById(s),i=u.relations||(e.getChildren().length&&e.getRelations()?this._filterRelationsInEditing({relations:e.getRelations().getArray().filter(function(e){return e.getFather()===s}),layerId:s}):[]),d=m.online;return i.forEach(function(a){a.setLoading?a.setLoading(!0):a.loading=!0;var o=l._getRelationId({layerId:s,relation:a}),e=new Promise(function(t){u.relation=a,u.layerId=s,u.filterType="ONE"===a.getType()?"1:1":u.filterType;var e=u.filterType||"fid",i=l.createEditingDataOptions(e,u),n=l._sessions[o],r=l.getToolBoxById(o);d&&n?(r.startLoading(),n.isStarted()?l.getLayersDependencyFeaturesFromSource({layerId:o,relation:a,feature:u.feature,operator:u.operator}).then(function(e){e?(t(o),r.stopLoading()):n.getFeatures(i).always(function(e){e.always(function(){r.stopLoading(),t(o)})})}):n.start(i).always(function(e){e.always(function(){r.stopLoading(),t(o)})})):l.getLayersDependencyFeaturesFromSource({layerId:o,relation:a,feature:u.feature,operator:u.operator}).then(function(){return t(o)})});t.push(e)}),Promise.all(t).finally(function(){return i.forEach(function(e){e.setLoading?e.setLoading(!1):e.loading=!1})}),Promise.all(t)},F.commitDirtyToolBoxes=function(n){var r=this;return new Promise(function(e,t){var i=r.getToolBoxById(n);i.isDirty()&&i.hasDependencies()?r.commit({toolbox:i}).then(function(){e(i)}).fail(function(){i.revert().then(function(){i.getDependencies().forEach(function(e){-1!==r.getLayerById(e).getChildren().indexOf(e)&&r.getToolBoxById(e).revert()})}),t(i)}):e(i)})},F._createCommitMessage=function(e){function i(e,t,i){var n={},r=(n[""+L("editing.messages.commit.add")]=e.length,n[""+L("editing.messages.commit.update")]="["+t.map(function(e){return e.id}).join(",")+"]",n[""+L("editing.messages.commit.delete")]="["+i.join(",")+"]","<h4>"+L("editing.messages.commit.header")+"</h4>"),r=(r+="<h5>"+L("editing.messages.commit.header_add")+"</h5>")+("<h5>"+L("editing.messages.commit.header_update_delete")+"</h5>")+"<ul style='border-bottom-color: #f4f4f4;'>";return Object.entries(n).forEach(function(e){var e=g(e,2),t=e[0],e=e[1];r+="<li>"+t+" : "+e+" </li>"}),r+="</ul>"}var n="";return n+=i(e.add,e.update,e.delete),_.isEmpty(e.relations)||(n=(n+="<div style='height:1px; background:#f4f4f4;border-bottom:1px solid #f4f4f4;'></div>")+"<div style='margin-left: 40%'><h4>"+L("editing.relations")+"</h4></div>",Object.entries(e.relations).forEach(function(e){var e=g(e,2),t=e[0],e=e[1];n=(n+="<div><span style='font-weight: bold'>"+t+"</span></div>")+i(e.add,e.update,e.delete)})),n},F.showCommitModalWindow=function(e){var l=this,r=e.layer,a=e.commitItems,o=e.close,s=e.commitPromise,u={success:{message:"plugins.editing.messages.saved",autoclose:!0},error:{}};return new Promise(function(t,i){var n,e=new j({type:"commit"});e.start({inputs:{layer:r,message:l._createCommitMessage(a),close:o}}).then(function(){var e=E.dialog.dialog({message:'<h4 class="text-center"><i style="margin-right: 5px;" class='+E.getFontClass("spinner")+"></i>"+L("editing.messages.saving")+"</h4>",closeButton:!1});t(u),s.always(function(){return e.modal("hide")})}).fail((n=d(function*(e){var s=[];(function o(){Object.entries(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).forEach(function(e){var e=g(e,2),t=e[0],e=e[1],i=e.add,n=e.delete,r=e.update,e=e.relations,e=void 0===e?{}:e,a=l.getLayerById(t).getEditingSource();0<a.readFeatures().length&&(i.forEach(function(e){e=e.id;a.removeFeature(a.getFeatureById(e))}),r.forEach(function(e){var n=e.id;s.push(new Promise(function(i,e){l.getProjectLayerFeatureById({layerId:t,fid:n}).then(function(e){var t=a.getFeatureById(n);t.setProperties(e.properties),t.setGeometry(e.geometry),i()}).catch(e)}))})),n.forEach(function(n){s.push(new Promise(function(i,e){l.getProjectLayerFeatureById({layerId:t,fid:n}).then(function(e){var t=new ol.Feature({geometry:e.geometry});t.setProperties(e.properties),t.setId(n),a.addFeature(new I({feature:t})),i()}).catch(e)}))}),o(e)})})(a.relations),yield Promise.allSettled(s),i(e)}),function(e){return n.apply(this,arguments)})).always(function(){return e.stop()})})},F.saveChange=d(function*(){if("autosave"===this.saveConfig.mode)return this.commit({modal:!1})}),F.addLayersFeaturesToShowOnResult=function(e){var t=this,i=e.layerId,e=e.fids,e=void 0===e?[]:e;void 0===this.loadLayersFeaturesToResultWhenCloseEditing[i]&&(this.loadLayersFeaturesToResultWhenCloseEditing[i]=new Set),e.forEach(function(e){return t.loadLayersFeaturesToResultWhenCloseEditing[i].add(e)})},F.onCloseEditingPanel=d(function*(){yield this.showChangesToResult(),this.getToolBoxes().forEach(function(e){return e.resetDefault()})}),F.showChangesToResult=d(function*(){var i=this,e=Object.keys(this.loadLayersFeaturesToResultWhenCloseEditing);if(e.length){var n={layers:[],fids:[],formatter:1},e=(e.forEach(function(e){var t=[].concat(y(i.loadLayersFeaturesToResultWhenCloseEditing[e]));t.length&&(e=b.getLayerById(e),n.layers.push(e),n.fids.push(t))}),n.layers.length?a.getData("search:layersfids",{inputs:n,outputs:{title:"plugins.editing.editing_changes",show:{loading:!1}}}):Promise.resolve());try{yield e}catch(e){}}this.loadLayersFeaturesToResultWhenCloseEditing={}}),F.commit=function(){var a=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},o=e.toolbox,n=e.commitItems,t=e.modal,t=void 0===t||t,e=e.close,e=void 0!==e&&e,s=$.Deferred(),i=s.promise(),r=this.saveConfig,l=r.cb,u=void 0===l?{}:l,l=r.messages,r=void 0===l?{success:{},error:{}}:l,d=(o=o||this.state.toolboxselected).getSession(),l=o.getLayer(),c=l.getType(),f=n,g=(n=n||d.getCommitItems()).add,p=n.delete,p=void 0===p?[]:p,h=n.update,h=void 0===h?[]:h,v=n.relations,v=void 0===v?{}:v;return 0===[].concat(y(void 0===g?[]:g),y(p),y(h),y(Object.keys(v))).length?(E.showUserMessage({type:"info",message:"Nothing to save",autoclose:!0,closable:!1}),s.resolve(o),s.promise()):((t?this.showCommitModalWindow({layer:l,commitItems:n,close:e,commitPromise:i}):Promise.resolve(r)).then(function(r){var e,t,i;m.online?d.commit({items:f||n}).then(function(e,t){var i,n;m.online&&(t.result?(n=(i=r.success).autoclose,i=i.message,r&&r.success&&E.showUserMessage({type:"success",message:void 0===i?"plugins.editing.messages.saved":i,duration:3e3,autoclose:void 0===n||n}),c===x.LayerTypes.VECTOR&&a._mapService.refreshMap({force:!0}),u.done&&u.done instanceof Function&&u.done(o),a.addLayersFeaturesToShowOnResult({layerId:o.getId(),fids:[].concat(y(t.response.new.map(function(e){return e.id})),y(e.update.map(function(e){return e.id})))}),a.emit("commit",t.response)):(i=new T({error:t.errors}).parse({type:"String"}),e=(n=r.error).autoclose,t=n.message,E.showUserMessage({type:"alert",message:t||i,textMessage:!t,autoclose:void 0!==e&&e}),u.error&&u.error instanceof Function&&u.error(o,t||i)),s.resolve(o))}).fail(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=new T({error:e.errors||e}).parse({type:"String"}),t=r.error,i=t.autoclose,t=t.message;E.showUserMessage({type:"alert",message:t||e,textMessage:!t,autoclose:void 0!==i&&i}),s.reject(o),u.error&&u.error instanceof Function&&u.error(o,t||e)}):a.saveOfflineItem({data:(e={},t=d.getId(),i=n,t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e),id:A.CHANGES}).then(function(){E.showUserMessage({type:"success",message:"plugins.editing.messages.saved_local",autoclose:!0}),d.clearHistory(),s.resolve(o)}).catch(function(e){E.showUserMessage({type:"alert",message:e,textMessage:!0}),s.reject(o)})}).catch(function(e){s.reject(o)}),i)},F.clearAllLayersUniqueFieldsValues=function(){this.layersUniqueFieldsValues={}},F.clearLayerUniqueFieldsValues=function(e){this.layersUniqueFieldsValues[e]={}},F.removeLayerUniqueFieldValuesFromFeature=function(e){var t=e.layerId,i=e.feature,n=this.layersUniqueFieldsValues[t];n&&Object.keys(i.getProperties()).filter(function(e){return void 0!==n[e]}).forEach(function(e){return n[e].delete(i.get(e))})},F.removeRelationLayerUniqueFieldValuesFromFeature=function(e){var i=e.layerId,t=e.relationLayerId,n=e.feature,r=this.layersUniqueFieldsValues[t],a=this.layersUniqueFieldsValues[i];void 0!==r&&void 0!==a&&(void 0===r.__uniqueFieldsValuesRelations&&(r.__uniqueFieldsValuesRelations={}),Object.keys(n.getProperties()).forEach(function(e){var t;void 0===r.__uniqueFieldsValuesRelations[i]&&(r.__uniqueFieldsValuesRelations[i]={}),void 0!==a[e]&&((t=new Set(a[e])).delete(n.get(e)),r.__uniqueFieldsValuesRelations[i][e]=t)}))},F.setLayerUniqueFieldValues=(B=d(function*(i){var n=this,e=[],r=b.getLayerById(i);return r.getEditingFields().forEach(function(t){t.validate.unique&&void 0===n.getLayerUniqueFieldValues({layerId:i,field:t})&&e.push(r.getFilterData({unique:t.name}).then(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];void 0===n.layersUniqueFieldsValues[i]&&(n.layersUniqueFieldsValues[i]={}),n.layersUniqueFieldsValues[i][t.name]=new Set(e)}))}),yield Promise.allSettled(e),this.layersUniqueFieldsValues[i]}),function(e){return B.apply(this,arguments)}),F.saveTemporaryRelationsUniqueFieldsValues=function(e){var n=this,t=this.layersUniqueFieldsValues[e]&&this.layersUniqueFieldsValues[e].__uniqueFieldsValuesRelations;void 0!==t&&(Object.keys(t).forEach(function(i){Object.entries(t[i]).forEach(function(e){var e=g(e,2),t=e[0],e=e[1];n.layersUniqueFieldsValues[i][t]=e})}),this.clearTemporaryRelationsUniqueFieldsValues(e))},F.clearTemporaryRelationsUniqueFieldsValues=function(e){this.layersUniqueFieldsValues[e]&&delete this.layersUniqueFieldsValues[e].__uniqueFieldsValuesRelations},F.getLayerUniqueFieldValues=function(e){var t=e.layerId,e=e.field;return this.layersUniqueFieldsValues[t]?this.layersUniqueFieldsValues[t][e.name]:[]},F.getChildLayerUniqueFieldValues=function(e){var t=e.layerId,i=e.relationLayerId,e=e.field,i=this.layersUniqueFieldsValues[i]&&this.layersUniqueFieldsValues[i].__uniqueFieldsValuesRelations;return void 0!==i&&void 0!==i[t]&&void 0!==i[t][e.name]?i[t][e.name]:this.getLayerUniqueFieldValues({layerId:t,field:e})},F.changeLayerUniqueFieldValues=function(e){var t=e.layerId,i=e.field,n=e.oldValue,e=e.newValue;void 0!==this.layersUniqueFieldsValues[t]&&void 0!==this.layersUniqueFieldsValues[t][i.name]&&((t=this.layersUniqueFieldsValues[t][i.name]).delete(n),t.add(e))},F.changeRelationLayerUniqueFieldValues=function(e){var t,i=e.layerId,n=e.relationLayerId,r=e.field,a=e.oldValue,e=e.newValue,n=this.layersUniqueFieldsValues[n];void 0!==n&&(void 0===n.__uniqueFieldsValuesRelations&&(n.__uniqueFieldsValuesRelations={}),void 0===n.__uniqueFieldsValuesRelations[i]&&(n.__uniqueFieldsValuesRelations[i]={}),(t=new Set(this.layersUniqueFieldsValues[i][r.name])).delete(a),t.add(e),n.__uniqueFieldsValuesRelations[i][r.name]=t)},F.addLayerUniqueFieldValue=function(e){var t=e.layerId,i=e.field,e=e.value;this.layersUniqueFieldsValues[t][i.name].add(e)},F.deleteLayerUniqueFieldValue=function(e){var t=e.layerId,i=e.field,e=e.value;this.layersUniqueFieldsValues[t][i.name].delete(e)},F.undoRedoLayerUniqueFieldValues=function(e){var a=this,o=e.layerId,t=e.sessionItems,t=void 0===t?[]:t,s=e.action;void 0!==this.layersUniqueFieldsValues[o]&&t.forEach(function(r){Object.keys(a.layersUniqueFieldsValues[o]).forEach(function(e){var t,i=void 0,n=void 0;n=Array.isArray(r)?(i=(t=r[1].feature.get(e)!=r[0].feature.get(e))?("undo"===s?r[1]:r[0]).feature.get(e):void 0,t?("undo"===s?r[0]:r[1]).feature.get(e):void 0):(i="add"===r.feature.getState()?r.feature.get(e):void 0,"delete"===r.feature.getState()?r.feature.get(e):void 0),void 0!==i&&a.deleteLayerUniqueFieldValue({layerId:o,field:{name:e},value:i}),void 0!==n&&a.addLayerUniqueFieldValue({layerId:o,field:{name:e},value:n})})})},F.undoRedoRelationUniqueFieldValues=function(e){var n=this,t=e.relationSessionItems,r=e.action;Object.entries(t).forEach(function(e){var e=g(e,2),t=e[0],e=e[1],i=e.own,e=e.dependencies;n.undoRedoLayerUniqueFieldValues({layerId:t,sessionItems:i,action:r}),n.undoRedoRelationUniqueFieldValues({relationSessionItems:e,action:r})})},F.getProjectLayerById=function(e){return b.getLayerById(e)},F.getProjectLayerFeatureById=(V=d(function*(e){var t=e.layerId,e=e.fid,i=void 0;try{var n=yield s.get({url:this.getProjectLayerById(t).getUrl("data"),params:{fids:e}}),r=p(n);0<r.length&&(i=r[0])}catch(e){}return i}),function(e){return V.apply(this,arguments)}),F.getProjectLayersWithSameGeometryOfLayer=function(e){var t=(1<arguments.length&&void 0!==arguments[1]?arguments[1]:{exclude:[]}).exclude,i=void 0===t?[]:t,n=e.getGeometryType();return b.getLayers().filter(function(e){return e.isGeoLayer()&&e.getGeometryType&&e.getGeometryType()&&-1===i.indexOf(e.getId())&&(e.getGeometryType()===n||h(e.getGeometryType(),n)&&f.isMultiGeometry(n))})},F.getExternalLayersWithSameGeometryOfLayer=function(e){var t=e.getGeometryType();return this._mapService.getExternalLayers().filter(function(e){var e=e.getSource().getFeatures();return!(!(e&&0<e.length)||e&&e[0]&&!e[0].getGeometry())&&(e=e[0].getGeometry().getType(),t===e||h(t,e))})},F.getFeatureTableFieldValue=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layerId,i=e.feature,e=e.property,t=this.getLayerById(t).config.editing.fields,n=i.get(e),i=null!==n&&(t.filter(function(e){return["select_autocomplete","select"].includes(e.input.type)})||[]).reduce(function(e,t){return e[t.name]=t.input.options.values,e},{}),t=i&&i[e]&&i[e].find(function(e){return n==e.value});return t?t.key:n},M.EDITING_FIELDS_TYPE=["unique"],e.exports=new M},{"../api":2,"../toolboxes/toolboxesfactory":36,"../workflows/commitfeaturesworkflow":43,"../workflows/editnopickmapfeatureattributesworkflow":52}],32:[function(d,e,t){var c=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var i=t,n=[],r=!0,t=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!i||n.length!==i);r=!0);}catch(e){t=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(t)throw a}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")};function f(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}function i(e,t,i){t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i}function n(e){var i=this,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},n=(this._parentLayerId=e,this._parentWorkFlow=this.getCurrentWorkflow(),this._parentLayer=this._parentWorkFlow.getLayer(),t.relation),t=t.relations,n=(this.relation=n,this.relations=t,this._editingService,this._isExternalFieldRequired=!1,this._relationLayerId=this.relation.child===this._parentLayerId?this.relation.father:this.relation.child,this.getLayer()),r=(this._layerType=n.getType(),this._layerType===h.LayerTypes.VECTOR?n.getGeometryType():h.LayerTypes.TABLE),t=this.getEditingService()._getRelationFieldsFromRelation({layerId:this._parentLayerId,relation:this.relation}).ownField;this._fatherRelationFields={editable:t.filter(function(e){return i._parentLayer.isEditingFieldEditable(e)}),pk:t.find(function(e){return i._parentLayer.isPkField(e)&&!i._parentLayer.isEditingFieldEditable(e)})},this._isExternalFieldRequired=this._checkIfExternalFieldRequired(),this._currentParentFeatureRelationFieldsValue=t.reduce(function(e,t){return e[t]=t===i._fatherRelationFields.pk?i.getCurrentWorkflowData().feature.getId():i.getCurrentWorkflowData().feature.get(t),e},{}),this._relationTools=[],this._add_link_workflow=null,this.capabilities={parent:this._parentLayer.getEditingCapabilities(),relation:this._parentLayer.getEditingCapabilities()},r===h.LayerTypes.TABLE?(void 0!==this.capabilities.relation.find(function(e){return"delete_feature"===e})&&this._relationTools.push({state:{icon:"deleteTableRow.png",id:"deletefeature",name:"editing.tools.delete_feature"}}),void 0!==this.capabilities.relation.find(function(e){return"change_attr_feature"===e})&&this._relationTools.push({state:{icon:"editAttributes.png",id:"editattributes",name:"editing.tools.update_feature"}})):this.getEditingService().getToolBoxById(this._relationLayerId).getTools().forEach(function(e){-1!==_.concat(a[r],a.default).indexOf(e.getId())&&i._relationTools.push(_.cloneDeep(e))}),this._setAddLinkWorkflow()}var g=g3wsdk.gui.GUI,p=g3wsdk.core.i18n.tPlugin,h=g3wsdk.core.layer.Layer,r=g3wsdk.core.workflow.WorkflowsStack,a={default:["editattributes","deletefeature"],table:[],Point:["movefeature"],LineString:["movevertex"],Polygon:["movefeature","movevertex"]},o=n.prototype;o.getEditingCapabilities=function(){return this.capabilities},o._setAddLinkWorkflow=function(){var e;i(e={},h.LayerTypes.VECTOR,{link:d("../workflows/linkrelationworkflow"),add:d("../workflows/addfeatureworkflow"),selectandcopy:d("../workflows/selectandcopyfeaturesfromotherlayerworkflow")}),i(e,h.LayerTypes.TABLE,{link:d("../workflows/edittableworkflow"),add:d("../workflows/addtablefeatureworkflow")}),this._add_link_workflow=e[this._layerType]},o._getLinkFeatureWorkflow=function(){return new this._add_link_workflow.link},o._getAddFeatureWorkflow=function(){return new this._add_link_workflow.add},o._getSelectCopyWorkflow=function(){return new this._add_link_workflow.selectandcopy(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})},o.getRelationTools=function(){return this._relationTools},o._highlightRelationSelect=function(e){var t=this.getLayer().getEditingLayer().getStyle(),i=this.getLayer().getGeometryType(),n=void 0;return"LineString"===i||"MultiLineString"===i?n=new ol.style.Style({stroke:new ol.style.Stroke({color:"rgb(255,255,0)",width:4})}):"Point"===i||"MultiPoint"===i?n=new ol.style.Style({image:new ol.style.Circle({radius:8,fill:new ol.style.Fill({color:"rgb(255,255,0)"})})}):"MultiPolygon"!==i&&"Polygon"!==i||(n=new ol.style.Style({stroke:new ol.style.Stroke({color:"rgb(255,255,0)",width:4}),fill:new ol.style.Fill({color:"rgba(255, 255, 0, 0.5)"})})),e.setStyle(n),t},o.startTool=function(i,n){var r=this;return"movefeature"===i.state.id&&g.hideContent(!0),new Promise(function(e,t){(r._layerType===h.LayerTypes.VECTOR&&r.startVectorTool(i,n)||r._layerType===h.LayerTypes.TABLE&&r.startTableTool(i,n)).then(function(){r.emitEventToParentWorkFlow(),e()}).fail(function(e){return t(e)}).always(function(){return g.hideContent(!1)})})},o.forceParentsFromServiceWorkflowToUpdated=function(){(r.getParents()||[this.getCurrentWorkflow()]).forEach(function(e){e.getContextService()&&e.getContextService().setUpdate(!0,{force:!0})})},o.startTableTool=function(e,t){var i,n=this,r=$.Deferred(),a=this.relations[t],o=this.getLayer().getEditingSource(),s=o.getFeatureById(a.id),l=this._createWorkflowOptions({features:[s]});return"deletefeature"===e.state.id&&g.dialog.confirm(p("editing.messages.delete_feature"),function(e){e?(n.getCurrentWorkflowData().session.pushDelete(n._relationLayerId,s),n.relations.splice(t,1),n.getEditingService().removeRelationLayerUniqueFieldValuesFromFeature({layerId:n._relationLayerId,relationLayerId:n._parentLayerId,feature:s}),o.removeFeature(s),n.forceParentsFromServiceWorkflowToUpdated(),r.resolve(e)):r.reject(e)}),"editattributes"===e.state.id&&(i=new(d("../workflows/edittablefeatureworkflow"))).start(l).then(function(){n._getRelationFieldsValue(s).forEach(function(t){a.fields.forEach(function(e){e.name===t.name&&(e.value=t.value)})}),r.resolve(!0)}).fail(function(e){return r.reject(!1)}).always(function(){i.stop()}),r.promise()},o.startVectorTool=function(t,i){var n=this,r=$.Deferred(),a=this.relations[i],o=this._getRelationFeature(a.id),e={ModifyGeometryVertexWorkflow:d("../workflows/modifygeometryvertexworkflow"),MoveFeatureWorkflow:d("../workflows/movefeatureworkflow"),DeleteFeatureWorkflow:d("../workflows/deletefeatureworkflow"),EditFeatureAttributesWorkflow:d("../workflows/editfeatureattributesworkflow")},s=(g.setModal(!1),this._createWorkflowOptions({features:[o]})),l=new(Object.values(e).find(function(e){return t.getOperator()instanceof e})),u=this._highlightRelationSelect(o),e=(l instanceof e.DeleteFeatureWorkflow||l instanceof e.EditFeatureAttributesWorkflow)&&l.startFromLastStep(s)||l.start(s);return l.bindEscKeyUp(function(){return o.setStyle(n._originalLayerStyle)}),e.then(function(e){"deletefeature"===t.getId()&&(o.setStyle(n._originalLayerStyle),n.getCurrentWorkflowData().session.pushDelete(n._relationLayerId,o),n.relations.splice(i,1),n.forceParentsFromServiceWorkflowToUpdated()),"editattributes"===t.getId()&&n._getRelationFieldsValue(o).forEach(function(t){return a.fields.forEach(function(e){e.name===t.name&&(e.value=t.value)})}),r.resolve(e)}).fail(function(e){return r.reject(e)}).always(function(){l.stop(),g.hideContent(!1),l.unbindEscKeyUp(),g.setModal(!0),o.setStyle(u)}),r.promise()},o.getLayer=function(){return this.getEditingService().getLayerById(this._relationLayerId)},o.getEditingLayer=function(){return this.getEditingService().getEditingLayer(this._relationLayerId)},o.getEditingService=function(){return this._editingService=this._editingService||d("./editingservice"),this._editingService},o.updateExternalKeyValueRelations=function(n){var r=this,a=this.getEditingService().getToolBoxById(this._relationLayerId).getSession(),e=this.getEditingService()._getRelationFieldsFromRelation({layerId:this._relationLayerId,relation:this.relation}),o=e.ownField,e=e.relationField;0<this._fatherRelationFields.editable.length&&e.find(function(e){return e===n.name})&&(this._currentParentFeatureRelationFieldsValue[n.name]=n.value,this.relations.forEach(function(e){var t,i=e.fields.find(function(e){return-1!==o.indexOf(e.name)});i&&(i.value=r._currentParentFeatureRelationFieldsValue[i.name],t=(e=r._getRelationFeature(e.id)).clone(),e.set(i.name,n.value),e.isNew()||a.pushUpdate(r._relationLayerId,e,t))}))},o._getRelationFieldsValue=function(e){return this.getLayer().getFieldsWithValues(e,{relation:!0})},o._createRelationObj=function(e){return{fields:this._getRelationFieldsValue(e),id:e.getId()}},o.emitEventToParentWorkFlow=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};e&&this._parentWorkFlow.getContextService().getEventBus().$emit(e,t)},o._getRelationAsFatherStyleColor=function(e){var t=this.getEditingLayer(this._parentLayerId).getStyle(),i=void 0;switch(e){case"Point":i=t.getImage()&&t.getImage().getFill();break;case"Line":i=t.getStroke()||t.getFill();break;case"Polygon":i=t.getFill()||t.getStroke()}return i&&i.getColor()||"#000000"},o.addRelationFromOtherLayer=function(e){var t=e.layer,e=e.external,i=void 0,n=!1;(e||t.isGeoLayer())&&(i=this._getSelectCopyWorkflow({copyLayer:t,isVector:n=!0,external:e})),this.runAddRelationWorkflow({workflow:i,isVector:n})},o.addRelation=function(){this.runAddRelationWorkflow({workflow:this._getAddFeatureWorkflow(),isVector:this._layerType===h.LayerTypes.VECTOR})},o.runAddRelationWorkflow=function(){var a=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.workflow,e=e.isVector,i=void 0!==e&&e,e=(i&&(g.setModal(!1),g.hideContent(!0)),this._createWorkflowOptions()),o=e.context.session,n=this.getEditingService()._getRelationFieldsFromRelation({layerId:this._relationLayerId,relation:this.relation}),s=n.ownField,l=n.relationField,u=e.parentFeature,n=t.start(e);i&&t.bindEscKeyUp(),n.then(function(e){function i(e){var i=e.oIndex,n=e.value;t.forEach(function(e,t){t=r[t];e.set(s[i],n),u.isNew()&&t.set(s[i],n),a.getLayer().getEditingSource().updateFeature(e),o.pushUpdate(a._relationLayerId,e,t)})}var n,e=e.relationFeatures,t=e.newFeatures,r=e.originalFeatures;Object.entries(a._currentParentFeatureRelationFieldsValue).forEach(function(e){var e=c(e,2),t=e[0],e=e[1];i({oIndex:l.findIndex(function(e){return t===e}),value:e})}),u.isNew()&&0<a._fatherRelationFields.editable.length&&(n=u.on("propertychange",function(t){var e;u.isNew()?-1!==l.indexOf(t.key)&&(e=t.target.get(t.key),i({oIndex:l.findIndex(function(e){return t.key===e}),value:e})):ol.Observable.unByKey(n)})),t.forEach(function(e){a.relations.push(a._createRelationObj(e))}),a.emitEventToParentWorkFlow()}).fail(function(e){e&&e.relationFeatures&&(void 0===(e=e.relationFeatures.newFeatures)?[]:e).forEach(function(e){a.relations.push(a._createRelationObj(e))}),o.rollbackDependecies([a._relationLayerId])}).always(function(){t.stop(),i&&(t.unbindEscKeyUp(),g.hideContent(!1),g.setModal(!0))})},o.linkRelation=function(){var r=this,e=this._layerType===h.LayerTypes.VECTOR,a=this._getLinkFeatureWorkflow(),o=this._createWorkflowOptions(),s=o.context.session,t=this.getEditingService()._getRelationFieldsFromRelation({layerId:this._relationLayerId,relation:this.relation}),l=t.ownField,u=t.relationField;o.context.excludeFeatures=u.reduce(function(e,t,i){return e[l[i]]=r._currentParentFeatureRelationFieldsValue[t],e},{}),e&&(g.setModal(!1),g.hideContent(!0),o.context.style=this.getUnlinkedStyle());function i(){return r.getEditingService().getLayersDependencyFeatures(r._parentLayerId,d)}var n,t=this.getCurrentWorkflowData().feature,d={relations:[this.relation],feature:t,operator:"not",filterType:e?"bbox":"fid"};(e?(n=this.getEditingService().getMapService(),o.context.beforeRun=f(function*(){n.showMapSpinner(),yield new Promise(function(e){return setTimeout(e)}),yield i(),n.hideMapSpinner(),g.showUserMessage({type:"info",size:"small",message:p("editing.messages.press_esc"),closable:!1})}),new Promise(function(e){a.bindEscKeyUp(),e({promise:a.start(o),showContent:!0})})):new Promise(function(e){i().then(function(){return e({})})})).then(function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.promise,e=e.showContent,i=void 0!==e&&e,n=!1;(t=t||a.start(o)).then(function(e){0<e.features.length&&e.features.forEach(function(i){var e;void 0===r.relations.find(function(e){return e.id===i.getId()})?(n=n||!0,e=i.clone(),Object.entries(r._currentParentFeatureRelationFieldsValue).forEach(function(e){var e=c(e,2),t=e[0],e=e[1];i.set(l[u.findIndex(function(e){return t===e})],e)}),r.getCurrentWorkflowData().session.pushUpdate(r._relationLayerId,i,e),r.relations.push(r._createRelationObj(i)),r.emitEventToParentWorkFlow()):g.notify.warning(p("editing.relation_already_added"))})}).fail(function(){return s.rollbackDependecies([r._relationLayerId])}).always(function(){i&&(g.closeUserMessage(),g.hideContent(!1),a.unbindEscKeyUp()),n&&r.forceParentsFromServiceWorkflowToUpdated(),a.stop()})})},o._checkIfExternalFieldRequired=function(){var t=this;return this.getEditingService()._getRelationFieldsFromRelation({layerId:this._relationLayerId,relation:this.relation}).ownField.some(function(e){return t.getEditingService().isFieldRequired(t._relationLayerId,e)})},o.isRequired=function(){return this._isExternalFieldRequired},o._getRelationFeature=function(e){return this.getLayer().getEditingSource().getFeatureById(e)},o.getRelationFeatureValue=function(e,t){return this.getEditingService().getFeatureTableFieldValue({layerId:this._relationLayerId,feature:this._getRelationFeature(e),property:t})},o.unlinkRelation=function(i){function t(){var e=n.relations[i],t=n.getLayer().getEditingSource().getFeatureById(e.id),e=t.clone();a.forEach(function(e){return t.set(e,null)}),n.getCurrentWorkflowData().session.pushUpdate(n._relationLayerId,t,e),n.relations.splice(i,1),n.forceParentsFromServiceWorkflowToUpdated(),r.resolve(!0)}var n=this,e=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],r=$.Deferred(),a=this.getEditingService()._getRelationFieldsFromRelation({layerId:this._relationLayerId,relation:this.relation}).ownField;return e?g.dialog.confirm(p("editing.messages.unlink_relation"),function(e){e?t():r.reject(!1)}):t(),r.promise()},o.getCurrentWorkflow=function(){return this.getEditingService().getCurrentWorkflow()},o.getCurrentWorkflowData=function(){return this.getEditingService().getCurrentWorkflowData()},o._createWorkflowOptions=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this.getEditingService()._getRelationFieldsFromRelation({layerId:this._relationLayerId,relation:this.relation}),n=t.ownField,r=t.relationField,t=this.getCurrentWorkflowData(),i=t.feature,t=t.session,a=[],o=[];return Object.entries(this._currentParentFeatureRelationFieldsValue).forEach(function(e){var e=c(e,2),t=e[0],e=e[1],i=r.findIndex(function(e){return t===e});o.push(n[i]),a.push(e)}),{parentFeature:i,context:{session:t,excludeFields:n,fatherValue:a,fatherField:o},inputs:{features:e.features||[],layer:this.getLayer()}}},o.getUnlinkedStyle=function(){var e=void 0;switch(this.getLayer().getGeometryType()){case"Point":e=new ol.style.Style({image:new ol.style.Circle({radius:8,fill:new ol.style.Fill({color:this._getRelationAsFatherStyleColor("Point")}),stroke:new ol.style.Stroke({width:5,color:"yellow"})})});break;case"Line":e=new ol.style.Style({fill:new ol.style.Fill({color:this._getRelationAsFatherStyleColor("Line")}),stroke:new ol.style.Stroke({width:5,color:"yellow"})});break;case"Polygon":e=new ol.style.Style({stroke:new ol.style.Stroke({color:"yellow",width:5}),fill:new ol.style.Fill({color:this._getRelationAsFatherStyleColor("Polygon"),opacity:.5})})}return e},o.relationFields=function(e){return e.fields.map(function(e){var t=e.label;return{name:e.name,label:t,value:e.value}})},e.exports=n},{"../workflows/addfeatureworkflow":40,"../workflows/addtablefeatureworkflow":42,"../workflows/deletefeatureworkflow":46,"../workflows/editfeatureattributesworkflow":49,"../workflows/edittablefeatureworkflow":53,"../workflows/edittableworkflow":54,"../workflows/linkrelationworkflow":55,"../workflows/modifygeometryvertexworkflow":57,"../workflows/movefeatureworkflow":58,"../workflows/selectandcopyfeaturesfromotherlayerworkflow":59,"./editingservice":31}],33:[function(l,e,t){function i(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(this._features=e.features||[],this._promise=e.promise,this._context=e.context,this._inputs=e.inputs,this._layerId=e.inputs.layer.getId(),this._fatherValue=e.fatherValue,this._foreignKey=e.foreignKey,this._workflow=null,this._deleteFeaturesIndexes=[],this._isrelation=e.isrelation||!1,e.capabilities),i=e.headers,n=e.title,e=e.push;this.state={headers:void 0===i?[]:i,features:[],title:void 0===n?"Link relation":n,isrelation:e,capabilities:t},this.init=function(){var t,e,i,n=this,r=l("./editingservice");this._isrelation&&this._features.filter(function(e){return e.get(n._foreignKey)!==n._fatherValue}),0<this._features.length&&(i=this._features[0],t=Object.keys(i.getProperties()),this.state.headers=this.state.headers.filter(function(e){return-1!==t.indexOf(e.name)}),e=this.state.headers.map(function(e){return e.name}),i=this._features,this.state.features=i.map(function(t){var i={};return e.forEach(function(e){i[e]=r.getFeatureTableFieldValue({layerId:n._layerId,feature:t,property:e})}),i.__gis3w_feature_uid=t.getUid(),i}))},this.init(),r(this)}var s=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var i=t,n=[],r=!0,t=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!i||n.length!==i);r=!0);}catch(e){t=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(t)throw a}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},u=l("../utils/cloneFeature"),n=g3wsdk.core.utils,r=n.base,n=n.inherit,a=g3wsdk.core.G3WObject,d=g3wsdk.gui.GUI,c=g3wsdk.core.i18n.tPlugin,n=(n(i,a),i.prototype);n.isMediaField=function(e){for(var t=!1,i=0;i<this.state.headers.length;i++){var n=this.state.headers[i];if(n.name===e&&"media"===n.input.type){t=!0;break}}return t},n.save=function(){this._promise.resolve()},n.cancel=function(){this._promise.reject()},n.deleteFeature=function(o){var s=this,e=l("./editingservice"),t=this._inputs.layer,i=t.getId(),n=t.getChildren().length&&0<e._filterRelationsInEditing({layerId:i,relations:t.getRelations().getArray()}).length;return new Promise(function(r,a){d.dialog.confirm("<h4>"+c("editing.messages.delete_feature")+'</h4>\n      <div style="font-size:1.2em;">'+(n?c("editing.messages.delete_feature_relations"):"")+"</div>",function(e){var t,i,n;(e?(e=s._features.findIndex(function(e){return e.getUid()===o}),t=s._features[e],i=s._context.session,n=s._inputs.layer.getId(),s._inputs.layer.getEditingSource().removeFeature(t),i.pushDelete(n,t),s.state.features.splice(e,1),r):a)()})})},n.copyFeature=function(r){var a=this,o=l("./editingservice");return new Promise(function(t,e){var i=(0,u.cloneFeature)(a._features.find(function(e){return e.getUid()===r}),a._inputs.layer.getEditingLayer()),n=l("../workflows/addtablefeatureworkflow"),n=(a._workflow=new n,a._inputs);n.features.push(i),a._workflow.start({context:a._context,inputs:n}).then(function(e){var i=e.features[e.features.length-1],n={};Object.entries(a.state.features[0]).forEach(function(e){var e=s(e,2),t=e[0];e[1];n[t]=o.getFeatureTableFieldValue({layerId:a._layerId,feature:i,property:t})}),n.__gis3w_feature_uid=i.getUid(),a.state.features.push(n),t(n)}).fail(e).always(function(){a._workflow.stop()})})},n.editFeature=function(t){var n=this,r=l("./editingservice"),a=this._features.findIndex(function(e){return e.getUid()===t}),e=this._features[a],i=l("../workflows/edittablefeatureworkflow"),i=(this._workflow=new i,this._inputs);i.features.push(e),this._workflow.start({context:this._context,inputs:i}).then(function(e){var i=e.features[e.features.length-1];Object.entries(n.state.features[a]).forEach(function(e){var e=s(e,2),t=e[0];e[1];n.state.features[a][t]=r.getFeatureTableFieldValue({layerId:n._layerId,feature:i,property:t})})}).fail(console.warn).always(function(){return n._workflow.stop()})},n.linkFeatures=function(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];this._promise.resolve({features:e.map(function(e){return t._features[e]})})},n.linkFeature=function(e){this._promise.resolve({features:[this._features[e]]})},e.exports=i},{"../utils/cloneFeature":38,"../workflows/addtablefeatureworkflow":42,"../workflows/edittablefeatureworkflow":53,"./editingservice":31}],34:[function(f,e,t){var i=g3wsdk.core.utils,g=i.base,i=i.inherit,r=g3wsdk.gui.GUI;function n(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=(g(this),this.editingService=f("../services/editingservice"),t.name),n=t.row,r=t.id,a=t.icon,o=t.session,s=t.layer,l=t.once,l=void 0!==l&&l,u=t.type,u=void 0===u?[]:u,d=t.visible,d=void 0===d||d,c=t.conditions,c=void 0===c?{}:c;this._options=null,this._session=o,this._layer=s,this._op=new t.op({layer:s}),this._once=l,this.type=u,this.conditions=c,this.disabledtoolsoftools=[],this.state={id:r,name:i,enabled:!1,visible:d instanceof Function?d(e):d,active:!1,icon:a,message:null,row:n||1,messages:this._op.getMessages()}}i(n,g3wsdk.core.G3WObject);i=n.prototype;i.setOptions=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.messages,i=e.enabled,i=void 0!==i&&i,n=e.visible,n=void 0===n||n,e=e.disabledtoolsoftools,e=void 0===e?[]:e;this.state.messages=t||this.state.messages,this.state.visible=n,this.state.enabled=i,this.disabledtoolsoftools=e},i.getLayer=function(){return this._layer},i.getType=function(){return this.type},i.getFeature=function(){return this._options.inputs.features[0]},i.createOperatorOptions=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{features:[]}).features;return{inputs:{layer:this._layer,features:void 0===e?[]:e},context:{session:this._session}}},i.start=function(){function t(e){i._op.once("settoolsoftool",function(e){(e=e.filter(function(e){return!i.disabledtoolsoftools.includes(e.type)})).length&&i.emit("settoolsoftool",e)}),i._op.once("active",function(e){return i.emit("active",e)}),i._op.once("deactive",function(e){return i.emit("deactive",e)}),e.inputs.features=[],n&&r.hideSidebar(),i._op.start(e).then(function(){i._session.save().then(function(){return i.editingService.saveChange()})}).fail(function(){n&&r.showSidebar(),i._session.rollback().then(function(){})}).always(function(){i._once||"table"===i._layer.getType()?i.stop():t(e)})}var i=this,n=0<arguments.length&&void 0!==arguments[0]&&arguments[0],e=this.createOperatorOptions();this._options=e;this._op&&(this.state.active=!0,setTimeout(function(){t(e)}))},i.stop=function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],i=$.Deferred();return this._op?this._op.stop(t).then(function(){}).fail(function(){return e._session.rollback()}).always(function(){e._options=null,e.state.active=!1,e.emit("stop",{session:e._session}),i.resolve()}):(this.emit("stop",{session:this._session}),i.resolve()),i.promise()},i.getState=function(){return this.state},i.setState=function(e){this.state=e},i.getId=function(){return this.state.id},i.setId=function(e){this.state.id=e},i.getName=function(){return this.state.name},i.setActive=function(){this.state.active=0<arguments.length&&void 0!==arguments[0]&&arguments[0]},i.isActive=function(){return this.state.active},i.getIcon=function(){return this.state.icon},i.setIcon=function(e){this.state.icon=e},i.setEnabled=function(){this.state.enabled=0<arguments.length&&void 0!==arguments[0]&&arguments[0]},i.isEnabled=function(){return this.state.enabled},i.setVisible=function(){this.state.visible=!(0<arguments.length&&void 0!==arguments[0])||arguments[0]},i.isVisible=function(){return this.state.visible},i.getOperator=function(){return this._op},i.getSession=function(){return this._session},i.setSession=function(e){this._session=e},i.clear=function(){this.state.enabled=!1,this.state.active=!1},i.getMessage=function(){var e=this.getOperator();return e.getHelpMessage()||e.getRunningStep()?this.state.messages:null},i.getHelpMessage=function(){return this.state.messages.help||this.getName()},i.setMessage=function(e){this.state.message=e},i.clearMessage=function(){this.state.message=null},i.resetDefault=function(){this.state.visible=!0,this.state.enabled=!1,this.state.messages=this._op.getMessages(),this.disabledtoolsoftools=[]},e.exports=n},{"../services/editingservice":31}],35:[function(a,e,t){var r=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var i=t,n=[],r=!0,t=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!i||n.length!==i);r=!0);}catch(e){t=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(t)throw a}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")};function f(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}var i=g3wsdk.core,g=i.ApplicationState,i=i.G3WObject,n=g3wsdk.core.utils,o=n.base,s=n.inherit,l=n.debounce,u=n.toRawType,p=g3wsdk.gui.GUI,d=g3wsdk.core.i18n.tPlugin,h=g3wsdk.core.layer.Layer,c=g3wsdk.core.editing.Session,v=g3wsdk.ol.utils.getScaleFromResolution;function y(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=(o(this),this.editingService=a("../services/editingservice"),this._mapService=p.getService("map"),this._start=!1,this._constraints=e.constraints||{},this._layer=e.layer,this.uniqueFields=this.getUniqueFieldsType(this._layer.getEditingFields()),this.uniqueFields&&this.getFieldUniqueValuesFromServer(),this._layerType=e.type||h.LayerTypes.VECTOR,this._loadedExtent=null,this._tools=e.tools,this._enabledtools,this._disabledtools,this._getFeaturesOption={},[]),n=(this._tools.forEach(function(e){return i.push(e.getState())}),this.constraints={filter:null,show:null,tools:[]},this._session=new c({id:e.id,editor:this._layer.getEditor()}),this.uniqueFields&&this._session.onafter("saveChangesOnServer",function(){t._resetUniqueValues()}),this._getFeaturesOption={},this._session.getHistory().state),r=this._session.state;this.state={id:e.id,changingtools:!1,show:!0,color:e.color||"blue",title:e.title||"Edit Layer",customTitle:!1,loading:!1,enabled:!1,toolboxheader:!0,startstopediting:!0,message:null,toolmessages:{help:null},toolsoftool:[],tools:i,selected:!1,activetool:null,editing:{session:r,history:n,on:!1,dependencies:[],relations:[],father:!1,canEdit:!0},layerstate:this._layer.state},this.originalState={title:this.state.title,toolsoftool:[].concat(function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(this.state.toolsoftool))},this._unregisterStartSettersEventsKey=[],this._tools.forEach(function(e){return e.setSession(t._session)}),this._session.onafter("stop",function(){t.inEditing()&&(g.online&&t.editingService.stopSessionChildren(t.state.id),t._getFeaturesOption.registerEvents)&&t._unregisterGetFeaturesEvent()}),this._session.onafter("start",function(e){e.registerEvents&&(t._getFeaturesEvent={event:null,fnc:null},t._getFeaturesOption=e,t._registerGetFeaturesEvent(t._getFeaturesOption),e.type===h.LayerTypes.VECTOR)&&p.getContentLength()&&p.once("closecontent",function(){setTimeout(function(){t._mapService.getMap().dispatchEvent(t._getFeaturesEvent.event)})})})}s(y,i);n=y.prototype;n.getState=function(){return this.state},n.setShow=function(){this.state.show=!(0<arguments.length&&void 0!==arguments[0])||arguments[0]},n.getLayer=function(){return this._layer},n.setFather=function(e){this.state.editing.father=e},n.isFather=function(){return this.state.editing.father},n.addRelations=function(e){var t=this;e.forEach(function(e){return t.addRelation(e)})},n.revert=function(){return this._session.revert()},n.addRelation=function(e){this.state.editing.relations.push(e)},n.getDependencies=function(){return this.state.editing.dependencies},n.hasDependencies=function(){return!!this.state.editing.dependencies.length},n.addDependencies=function(e){var t=this;e.forEach(function(e){return t.addDependency(e)})},n.addDependency=function(e){this.state.editing.dependencies.push(e)},n.getFieldUniqueValuesFromServer=function(){var i=this,e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).reset,n=void 0!==e&&e,e=Object.values(this.uniqueFields).map(function(e){return e.name});this._layer.getWidgetData({type:"unique",fields:e.join()}).then(function(e){e=e.data;Object.entries(e).forEach(function(e){var e=r(e,2),t=e[0],e=e[1];n&&i.uniqueFields[t].input.options.values.splice(0),e.forEach(function(e){return i.uniqueFields[t].input.options.values.push(e)})})}).fail(console.log)},n.getUniqueFieldsType=function(e){var t={},i=!1;return e.forEach(function(e){e.input&&"unique"===e.input.type&&(t[e.name]=e,i=!0)}),i&&t||null},n._resetUniqueValues=function(){this.getFieldUniqueValuesFromServer({reset:!0})},n.isVectorLayer=function(){return this._layerType===h.LayerTypes.VECTOR},n.setFeaturesOptions=function(){var e=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).filter;e?(e.nofeatures&&(e.nofeatures_field=e.nofeatures_field||this._layer.getEditingFields()[0].name),this._getFeaturesOption={filter:e,editing:!0,registerEvents:!1},e.constraint&&this.setConstraintFeaturesFilter(e)):(e=this._layerType===h.LayerTypes.TABLE?"all":"bbox",this._getFeaturesOption=this.editingService.createEditingDataOptions(e,{layerId:this.getId()}))},n.setEditingConstraints=function(){var t=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};Object.keys(i).forEach(function(e){return t.constraints[e]=i[e]})},n.setLayerUniqueFieldValues=f(function*(){yield this.editingService.setLayerUniqueFieldValues(this.getId())}),n.clearLayerUniqueFieldsValues=function(){this.editingService.clearLayerUniqueFieldsValues(this.getId())},n.start=function(){function e(e){n.emit(s),n.setLayerUniqueFieldValues().then(f(function*(){var t,i;yield n.editingService.runEventHandler({type:s,id:u}),e.then((i=f(function*(e){n.stopLoading(),n.setEditing(!0),yield n.editingService.runEventHandler({type:"get-features-editing",id:u,options:{features:e}}),l.resolve({features:e})}),function(e){return i.apply(this,arguments)})).fail((t=f(function*(e){p.notify.error(e.message),yield n.editingService.runEventHandler({type:"error-editing",id:u,error:e}),n.stop(),n.stopLoading(),l.reject(e)}),function(e){return t.apply(this,arguments)}))}))}var n=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=t.filter,r=t.toolboxheader,r=void 0===r||r,a=t.startstopediting,a=void 0===a||a,o=(t.showtools,t.tools),t=t.changingtools,s=(this.state.changingtools=void 0!==t&&t,o&&this.setEnablesDisablesTools(o),this.state.toolboxheader=r,this.state.startstopediting=a,"start-editing"),l=$.Deferred(),u=this.getId(),t=this.editingService.getApplicationEditingConstraintById(this.getId()),i=t&&t.filter||this.constraints.filter||i,d=(this.setFeaturesOptions({filter:i}),"featuresLockedByOtherUser"),c=this._layer.getFeaturesStore().onceafter(d,function(){p.showUserMessage({type:"warning",subtitle:n._layer.getName().toUpperCase(),message:"plugins.editing.messages.featureslockbyotheruser"})});this._unregisterStartSettersEventsKey.push(function(){return n._layer.getFeaturesStore().un(d,c)});return this._session&&(this._session.isStarted()?(this._start||(this.startLoading(),this._session.getFeatures(this._getFeaturesOption).then(e),this._start=!0),this.setEditing(!0)):g.ismobile&&this._mapService.isMapHidden()&&this._layerType===h.LayerTypes.VECTOR?(this.setEditing(!0),p.getService("map").onceafter("setHidden",function(){setTimeout(function(){n._start=!0,n.startLoading(),n.setFeaturesOptions({filter:i}),n._session.start(n._getFeaturesOption).then(e).fail(function(){return n.setEditing(!1)})},300)})):(this._start=!0,this.startLoading(),this._session.start(this._getFeaturesOption).then(e))),l.promise()},n.startLoading=function(){this.state.loading=!0},n.stopLoading=function(){this.state.loading=!1},n.getFeaturesOption=function(){return this._getFeaturesOption},n.stop=function(){var t=this,i=$.Deferred();return this.disableCanEditEvent&&this.disableCanEditEvent(),this._unregisterStartSettersEventsKey.forEach(function(e){return e()}),this._unregisterStartSettersEventsKey=[],this._session&&this._session.isStarted()?g.online&&(0<this.editingService.fathersInEditing(this.state.id).length?(this.stopActiveTool(),this.state.editing.on=!1,this.enableTools(!1),this.clearToolboxMessages(),this._unregisterGetFeaturesEvent(),this.editingService.stopSessionChildren(this.state.id),this.setSelected(!1),this.clearLayerUniqueFieldsValues()):this._session.stop().then(function(e){e.then(function(){t._start=!1,t.state.editing.on=!1,t.state.enabled=!1,t.stopLoading(),t._getFeaturesOption={},t.stopActiveTool(),t.enableTools(!1),t.clearToolboxMessages(),t.setSelected(!1),t.emit("stop-editing"),t.clearLayerUniqueFieldsValues(),i.resolve(!0)})}).fail(function(e){return i.reject(e)}).always(function(){return t.setSelected(!1)})):(this.setSelected(!1),i.resolve(!0)),i.promise()},n.save=function(){this._session.commit()},n._unregisterGetFeaturesEvent=function(){this._layerType===h.LayerTypes.VECTOR&&this._mapService.getMap().un(this._getFeaturesEvent.event,this._getFeaturesEvent.fnc)},n._registerGetFeaturesEvent=function(){var t=this,i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this._layerType===h.LayerTypes.VECTOR&&i.filter.bbox&&(this._getFeaturesEvent.event="moveend",this._getFeaturesEvent.fnc=l(function(){var e=t.state.editing.canEdit;t._layer.getEditingLayer().setVisible(e),g.online&&e&&0===p.getContentLength()&&(e=t._mapService.getMapBBOX(),i.filter.bbox=e,t.state.loading=!0,t._session.getFeatures(i).then(function(e){e.then(function(){t.state.loading=!1})}))},300),this._mapService.getMap().on("moveend",this._getFeaturesEvent.fnc))},n.setConstraintFeaturesFilter=function(e){this.constraintFeatureFilter=e},n.getEditingConstraints=function(){return this._constraints},n.getEditingConstraint=function(e){return this.getEditingConstraints()[e]},n.canEdit=function(){return this.state.editing.canEdit},n._canEdit=function(){var t,i,e,n=this;this._constraints.scale&&(t=this._constraints.scale,i=(""+d("editing.messages.constraints.enable_editing")+t).toUpperCase(),this.state.editing.canEdit=v(this._mapService.getMap().getView().getResolution())<=t,p.setModal(!this.state.editing.canEdit,i),e=function(e){n.state.editing.canEdit=v(e.target.getResolution())<=t,p.setModal(!n.state.editing.canEdit,i)},this._mapService.getMap().getView().on("change:resolution",e),this.disableCanEditEvent=function(){p.setModal(!1),n._mapService.getMap().getView().un("change:resolution",e)})},n._disableCanEdit=function(){this.state.editing.canEdit=!0,this.disableCanEditEvent&&this.disableCanEditEvent()},n.setMessage=function(e){this.state.message=e},n.getMessage=function(){return this.state.message},n.clearMessage=function(){this.setMessage(null)},n.clearToolboxMessages=function(){this.clearToolMessage(),this.clearMessage()},n.getId=function(){return this.state.id},n.setId=function(e){this.state.id=e},n.getTitle=function(){return this.state.title},n.setTitle=function(e){this.state.customTitle=!0,this.state.title=e},n.getColor=function(){return this.state.color},n.setEditing=function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0];this.setEnable(e),this.state.editing.on=e,this.enableTools(e)},n.inEditing=function(){return this.state.editing.on},n.isEnabled=function(){return this.state.enabled},n.setEnable=function(){return this.state.enabled=0<arguments.length&&void 0!==arguments[0]&&arguments[0],this.state.enabled},n.isLoading=function(){return this.state.loading},n.isDirty=function(){return this.state.editing.history.commit},n.isSelected=function(){return this.state.selected},n.setSelected=function(){this.state.selected=0<arguments.length&&void 0!==arguments[0]&&arguments[0],this.state.selected?this._canEdit():this._disableCanEdit()},n.getTools=function(){return this._tools},n.getToolById=function(t){return this._tools.find(function(e){return t===e.getId()})},n.setEnableTool=function(t){this._tools.find(function(e){return e.getId()===t}).setEnabled(!0)},n.setAddEnableTools=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.tools,i=void 0===t?{}:t,t=e.options,e=(void 0===t?{editing_constraints:!0}:t).editing_constraints,n=void 0!==e&&e,r=["addfeature","editattributes","movefeature","movevertex"],t=this._tools.filter(function(e){return n?e.getType().find(function(e){return"add_feature"===e}):-1!==r.indexOf(e.getId())}).map(function(e){e=e.getId();return{id:e,options:i[e]}});this.setEnablesDisablesTools({enabled:t}),this.enableTools(!0)},n.setUpdateEnableTools=function(e){var t=e.tools,i=void 0===t?{}:t,t=e.excludetools,n=void 0===t?[]:t,t=e.options,e=(void 0===t?{editing_constraints:!0}:t).editing_constraints,r=void 0!==e&&e,a=["editattributes","movefeature","movevertex"],t=this._tools.filter(function(e){return-1===n.indexOf(e.getId())&&(r?e.getType().find(function(e){return"change_feature"===e||"change_attr_feature"===e}):-1!==a.indexOf(e.getId()))}).map(function(e){e=e.getId();return{id:e,options:i[e]}});this.setEnablesDisablesTools({enabled:t}),this.enableTools(!0)},n.setDeleteEnableTools=function(){},n.setEnablesDisablesTools=function(e){var t,r,a=this;e&&(this.state.changingtools=!0,t=e.enabled,e=void 0===(e=e.disabled)?[]:e,r=(t=void 0===t?[]:t).length?[]:this._tools.map(function(e){return e.getId()}),t.forEach(function(e){var t,i=e.id,e=e.options,e=void 0===e?{}:e,n=a.getToolById(i);n&&(t=void 0!==(t=e.active)&&t,n.setOptions(e),n.isVisible()&&r.push(i),t&&a.setActiveTool(n),void 0===a._enabledtools&&(a._enabledtools=[]),a._enabledtools.push(n))}),e.forEach(function(e){var t=e.id;e.options;a.getToolById(t)&&(void 0===a._disabledtools&&(a._disabledtools=[]),a._disabledtools.push(t),r.push(t))}),this._tools.forEach(function(e){return!r.includes(e.getId())&&e.setVisible(!1)}),this.state.changingtools=!1)},n.enableTools=function(){var i=0<arguments.length&&void 0!==arguments[0]&&arguments[0],e=this._enabledtools||this._tools,n=this._disabledtools||[];e.forEach(function(e){var t=e.conditions.enabled,t=void 0===t?i:t,t=i&&n.length?-1===n.indexOf(e.getId()):"Boolean"===u(t)?t:t({bool:i,tool:e});e.setEnabled(t),i||e.setActive(i)})},n.setActiveTool=function(i){var n=this;this.stopActiveTool(i).then(function(){n.clearToolsOfTool(),(n.state.activetool=i).once("settoolsoftool",function(e){return e.forEach(function(e){return n.state.toolsoftool.push(e)})});function e(t,i){n.state.toolsoftool.forEach(function(e){-1!==t.indexOf(e.type)&&(e.options.active=i)})}i.on("active",function(){return e(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],!0)}),i.on("deactive",function(){return e(0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],!1)});var t=n._mapService.isMapHidden(),t=(i.start(t),n.getToolMessage());n.setToolMessage(t)})},n.clearToolsOfTool=function(){this.state.toolsoftool.splice(0)},n.getActiveTool=function(){return this.state.activetool},n.restartActiveTool=function(){var e=this.getActiveTool();this.stopActiveTool(),this.setActiveTool(e)},n.stopActiveTool=function(e){var t=this,i=$.Deferred(),n=this.getActiveTool();return n&&n!==e?(n.removeAllListeners(),n.stop(!0).then(function(){t.clearToolsOfTool(),t.clearToolMessage(),t.state.activetool=null,setTimeout(i.resolve)})):(e&&e.removeAllListeners(),i.resolve()),i.promise()},n.clearToolMessage=function(){this.state.toolmessages.help=null},n.getToolMessage=function(){return this.getActiveTool().getMessage()},n.setToolMessage=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.state.toolmessages.help=e&&e.help||null},n.getSession=function(){return this._session},n.getEditor=function(){return this._editor},n.setEditor=function(e){this._editor=e},n.hasChildren=function(){return this._layer.hasChildren()},n.hasFathers=function(){return this._layer.hasFathers()},n.hasRelations=function(){return this._layer.hasRelations()},n.resetDefault=function(){this.state.title=this.originalState.title,this.state.toolboxheader=!0,this.state.startstopediting=!0,this.constraints={filter:null,show:null,tools:[]},this._enabledtools&&(this._enabledtools=void 0,this.enableTools(),this._tools.forEach(function(e){return e.resetDefault()})),this._disabledtools=null,this.setShow(!0)},e.exports=y},{"../services/editingservice":31}],36:[function(e,t,i){var s=g3wsdk.core.layer.Layer,l=e("./toolsfactory"),u=e("./toolbox");t.exports=new function(){this.build=function(e){var t=e.getEditingConstrains(),i=e.getEditingCapabilities(),n=e.getType(),r=e.getId(),a=e.getColor(),o=[];switch(n){case s.LayerTypes.VECTOR:o=l.build({layer:e,geometryType:e.getGeometryType(),type:n,capabilities:i});break;case s.LayerTypes.TABLE:o=l.build({layer:e,type:n,capabilities:i})}return new u({id:r,color:a,type:n,layer:e,tools:o,lngTitle:"editing.toolbox.title",title:" "+e.getTitle(),constraints:t})}}},{"./toolbox":35,"./toolsfactory":37}],37:[function(e,t,i){function y(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}var s=g3wsdk.core.layer.Layer,m=g3wsdk.core.geometry.Geometry,_=g3wsdk.gui.GUI,w=g3wsdk.core.geoutils.isSameBaseGeometryType,b=e("./tool"),k=e("../workflows/addfeatureworkflow"),F=e("../workflows/modifygeometryvertexworkflow"),x=e("../workflows/movefeatureworkflow"),S=e("../workflows/deletefeatureworkflow"),I=e("../workflows/editfeatureattributesworkflow"),E=e("../workflows/edittableworkflow"),T=e("../workflows/addtablefeatureworkflow"),L=e("../workflows/copyfeaturesworkflow"),C=e("../workflows/splitfeatureworkflow"),R=e("../workflows/mergefeaturesworkflow"),P=e("../workflows/addparttomultigeometriesworkflow"),A=e("../workflows/deletepartfrommultigeometriesworkflow"),M=e("../workflows/editmultifeatureattributesworkflow"),B=e("../workflows/addfeaturefrommapvectorlayersworkflow"),V=e("../workflows/copyfeaturesfromotherlayerworkflow");t.exports=new function(){this.createTools=function(e){var n,r,a,o,s,l,u,d,t=e.type,i=e.isMultiGeometry,c=e.layer,f=e.capabilities,g=[],p=_.getService("map");switch(t){case"Point":g=[{config:{id:"addfeature",name:"editing.tools.add_feature",icon:"addPoint.png",layer:c,row:1,op:k,type:["add_feature"]}},{config:{id:"editattributes",name:"editing.tools.update_feature",icon:"editAttributes.png",layer:c,row:1,op:I,type:["change_attr_feature"]}},{config:{id:"deletefeature",name:"editing.tools.delete_feature",icon:"deletePoint.png",layer:c,row:1,op:S,type:["delete_feature"]}},{config:{id:"editmultiattributes",name:"editing.tools.update_multi_features",icon:"multiEditAttributes.png",layer:c,row:2,once:!0,op:M,type:["change_attr_feature"]}},{config:{id:"movefeature",name:"editing.tools.move_feature",icon:"movePoint.png",layer:c,row:2,op:x,type:["change_feature"]}},{config:{id:"copyfeaturesfromotherlayer",name:"editing.tools.pastefeaturesfromotherlayers",icon:"pasteFeaturesFromOtherLayers.png",layer:c,once:!0,conditions:{enabled:(s=c.getId(),l=c.getGeometryType(),u=p.defaultsLayers.selectionLayer.getSource(),d={bool:!1,tool:void 0},function(e){var t=e.bool,e=e.tool;return d.tool=void 0===e?{}:e,d.bool=t,u[t?"on":"un"]("addfeature",v),u[t?"on":"un"]("removefeature",v),v()})},row:2,op:V,type:["add_feature"]}},{config:{id:"copyfeatures",name:"editing.tools.copy",icon:"copyPoint.png",layer:c,once:!0,row:2,op:L,type:["add_feature"]}}].concat(y(i?[{config:{id:"addPart",name:"editing.tools.addpart",icon:"addPart.png",layer:c,once:!0,row:3,op:P,type:["add_feature","change_feature"]}}]:[]),y(i?[{config:{id:"deletePart",name:"editing.tools.deletepart",icon:"deletePart.png",layer:c,row:3,op:A,type:["change_feature"]}}]:[]));break;case"Line":case"Polygon":g=[{config:{id:"addfeature",name:"editing.tools.add_feature",icon:"add"+t+".png",layer:c,row:1,op:k,type:["add_feature"]}},{config:{id:"editattributes",name:"editing.tools.update_feature",icon:"editAttributes.png",layer:c,row:1,op:I,type:["change_attr_feature"]}},{config:{id:"movevertex",name:"editing.tools.update_vertex",icon:"moveVertex.png",layer:c,row:1,op:F,type:["change_feature"]}},{config:{id:"deletefeature",name:"editing.tools.delete_feature",icon:"delete"+t+".png",layer:c,row:1,op:S,type:["delete_feature"]}},{config:{id:"editmultiattributes",name:"editing.tools.update_multi_features",icon:"multiEditAttributes.png",layer:c,row:2,once:!0,op:M,type:["change_attr_feature"]}},{config:{id:"movefeature",name:"editing.tools.move_feature",icon:"move"+t+".png",layer:c,row:2,op:x,type:["change_feature"]}},{config:{id:"copyfeaturesfromotherlayer",name:"editing.tools.pastefeaturesfromotherlayers",icon:"pasteFeaturesFromOtherLayers.png",layer:c,once:!0,conditions:{enabled:(n=c.getId(),r=c.getGeometryType(),a=p.defaultsLayers.selectionLayer.getSource(),o={bool:!1,tool:void 0},function(e){var t=e.bool,e=e.tool;return o.tool=void 0===e?{}:e,o.bool=t,a[t?"on":"un"]("addfeature",h),a[t?"on":"un"]("removefeature",h),h()})},row:2,op:V,type:["add_feature"]}},{config:{id:"copyfeatures",name:"editing.tools.copy",icon:"copy"+t+".png",layer:c,row:2,once:!0,op:L,type:["add_feature"]}}].concat(y(i?[{config:{id:"addPart",name:"editing.tools.addpart",icon:"addPart.png",layer:c,row:3,once:!0,op:P,type:["add_feature","change_feature"]}}]:[]),y(i?[{config:{id:"deletePart",name:"editing.tools.deletepart",icon:"deletePart.png",layer:c,row:3,op:A,type:["change_feature"]}}]:[]),[{config:{id:"splitfeature",name:"editing.tools.split",icon:"splitFeatures.png",layer:c,row:3,once:!0,op:C,type:["change_feature"]}},{config:{id:"mergefeatures",name:"editing.tools.merge",icon:"mergeFeatures.png",layer:c,row:3,once:!0,op:R,type:["change_feature"]}},{config:{id:"copyfeaturefromexternallayer",name:"editing.tools.copyfeaturefromexternallayer",icon:"copyPolygonFromFeature.png",layer:c,row:3,once:!0,visible:function(i){function n(e){var t=!0;return"VECTOR"===e.getType()&&(e=e.getSource().getFeatures()).length&&(e=e[0].getGeometry().getType(),t=w(e,r)),t}var r=i.getLayer().getGeometryType();return p.onbefore("loadExternalLayer",function(e){return!i.isVisible()&&i.setVisible(n(e))}),p.onafter("unloadExternalLayer",function(e){var t=e.getType();i.isVisible()&&"VECTOR"===t&&(t=e.getSource().getFeatures()).length&&(e=t[0].getGeometry().getType(),w(e,r))&&(t=void 0!==p.getExternalLayers().find(n),i.setVisible(t))}),!1},op:B,type:["add_feature"]}}]);break;case"Table":g=[{config:{id:"addfeature",name:"editing.tools.add_feature",icon:"addTableRow.png",layer:c,op:T,type:["add_feature"]}},{config:{id:"edittable",name:"editing.tools.update_feature",icon:"editAttributes.png",layer:c,once:!0,op:E,type:["delete_feature","change_attr_feature"]}}]}function h(){var e=o.bool,t=o.tool,i=a.getFeatures().filter(function(e){var t=e.getGeometry()&&e.getGeometry().getType();return!(e.__layerId===n||!w(r,t))&&(r===t||m.isMultiGeometry(r)||!m.isMultiGeometry(t))}),e=e&&0<i.length;return t.setEnabled(e),e}function v(){var e=d.bool,t=d.tool,i=u.getFeatures().filter(function(e){var t=e.getGeometry()&&e.getGeometry().getType();return!(e.__layerId===s||!w(l,t))&&(l===t||m.isMultiGeometry(l)||!m.isMultiGeometry(t))}),e=e&&0<i.length;return t.setEnabled(e),e}return f?g.filter(function(e){return 0<e.config.type.filter(function(e){return f.includes(e)}).length}).map(function(e){return e.config.row=1,new b(e.config)}):g.map(function(e){return new b(e.config)})},this.build=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.type,t=void 0===t?s.LayerTypes.VECTOR:t,i=e.layer,n=e.capabilities,r=[];switch(t){case s.LayerTypes.VECTOR:var a=e.geometryType,o=m.isMultiGeometry(a);m.isPointGeometryType(a)?r=this.createTools({layer:i,capabilities:n,type:"Point",isMultiGeometry:o}):m.isLineGeometryType(a)?r=this.createTools({layer:i,type:"Line",capabilities:n,isMultiGeometry:o}):m.isPolygonGeometryType(a)&&(r=this.createTools({layer:i,type:"Polygon",capabilities:n,isMultiGeometry:o}));break;case s.LayerTypes.TABLE:r=this.createTools({layer:i,type:"Table",capabilities:n});break;default:r=[]}return r}}},{"../workflows/addfeaturefrommapvectorlayersworkflow":39,"../workflows/addfeatureworkflow":40,"../workflows/addparttomultigeometriesworkflow":41,"../workflows/addtablefeatureworkflow":42,"../workflows/copyfeaturesfromotherlayerworkflow":44,"../workflows/copyfeaturesworkflow":45,"../workflows/deletefeatureworkflow":46,"../workflows/deletepartfrommultigeometriesworkflow":47,"../workflows/editfeatureattributesworkflow":49,"../workflows/editmultifeatureattributesworkflow":51,"../workflows/edittableworkflow":54,"../workflows/mergefeaturesworkflow":56,"../workflows/modifygeometryvertexworkflow":57,"../workflows/movefeatureworkflow":58,"../workflows/splitfeatureworkflow":60,"./tool":34}],38:[function(e,t,i){Object.defineProperty(i,"__esModule",{value:!0}),i.cloneFeature=function(e,t){e=e.cloneNew(),t=t&&t.getEditingFields().find(function(e){return e.pk});t&&!1===t.editable&&e.set(t.name,null);return e}},{}],39:[function(e,t,i){var n=g3wsdk.core.utils,r=n.base,n=n.inherit,a=e("./editingworkflow"),o=e("./steps/selectelementsstep"),s=e("./steps/openformstep");function l(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(e.type="external",e.help="editing.steps.help.copy",e.steps=[],new o(e,!1)),i=new s(e);e.steps=[t,i],this.registerEscKeyEvent(),r(this,e)}n(l,a),t.exports=l},{"./editingworkflow":50,"./steps/openformstep":77,"./steps/selectelementsstep":81}],40:[function(e,t,i){var n=g3wsdk.core.utils,r=n.base,n=n.inherit,a=e("./editingworkflow"),o=e("./steps/addfeaturestep"),s=e("./steps/openformstep");function l(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=new o(e),i=new s(e);e.steps=[t,i],r(this,e),this.addToolsOfTools({step:t,tools:["snap","measure"]})}n(l,a),t.exports=l},{"./editingworkflow":50,"./steps/addfeaturestep":61,"./steps/openformstep":77}],41:[function(e,t,i){var n=g3wsdk.core.utils,a=n.base,n=n.inherit,r=e("./editingworkflow"),o=e("./steps/pickfeaturestep"),s=e("./steps/choosefeaturestep"),l=e("./steps/addfeaturestep"),u=e("./steps/addparttomultigeometriesstep");function d(){var i=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(e.type="single",e.helpMessage="editing.tools.addpart",e.help="editing.steps.help.select_element",new o),n=(t.getTask().setSteps({select:{description:"editing.workflow.steps.select",directive:"t-plugin",done:!1}}),e.add=!1,new l(e)),r=(n.getTask().setSteps({addfeature:{description:"editing.workflow.steps.draw_part",directive:"t-plugin",done:!1}}),n.on("run",function(e){var t=e.inputs,e=(e.context,t.layer),t={type:"snap",options:{layerId:e.getId(),source:e.getEditingLayer().getSource(),active:!0}};i.emit("settoolsoftool",[t])}),n.on("run",function(){i.emit("active",["snap"])}),n.on("stop",function(){i.emit("deactive",["snap"])}),new u(e));e.steps=[t,new s,n,r],this.registerEscKeyEvent(),a(this,e)}n(d,r),t.exports=d},{"./editingworkflow":50,"./steps/addfeaturestep":61,"./steps/addparttomultigeometriesstep":62,"./steps/choosefeaturestep":64,"./steps/pickfeaturestep":79}],42:[function(e,t,i){var n=g3wsdk.core.utils,r=n.base,n=n.inherit,a=e("./editingworkflow"),o=e("./steps/addtablefeaturestep"),s=e("./steps/openformstep");function l(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.steps=[new o,new s],r(this,e)}n(l,a),t.exports=l},{"./editingworkflow":50,"./steps/addtablefeaturestep":63,"./steps/openformstep":77}],43:[function(e,t,i){var n=g3wsdk.core.utils,r=n.base,n=n.inherit,a=e("./editingworkflow"),o=e("./steps/confirmstep");function s(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.steps=[new o(e)],r(this,e)}n(s,a),t.exports=s},{"./editingworkflow":50,"./steps/confirmstep":65}],44:[function(e,t,i){var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,n=arguments[t];for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},r=g3wsdk.core.utils,a=r.base,r=r.inherit,o=e("./editingworkflow"),s=e("./steps/copyfeaturesfromotherlayerstep"),l=e("./steps/openformstep");function u(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(e.help="editing.steps.help.copy",new l(e));e.steps=[new s(n({},e,{openFormTask:t.getTask()})),t],this.registerEscKeyEvent(),a(this,e)}r(u,o),t.exports=u},{"./editingworkflow":50,"./steps/copyfeaturesfromotherlayerstep":66,"./steps/openformstep":77}],45:[function(e,t,i){var n=g3wsdk.core.utils,r=n.base,n=n.inherit,a=e("./editingworkflow"),o=e("./steps/selectelementsstep"),s=e("./steps/getvertexstep"),l=e("./steps/movelementsstep"),u=g3wsdk.core.ApplicationState;function d(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=-1!==e.layer.getGeometryType().indexOf("Point"),i=(e.type=u.ismobile?"single":"multiple",e.help="editing.steps.help.copy",e.steps=[],new o(e,!0)),t=(i.getTask().setSteps({select:{description:"multiple"===e.type?"editing.workflow.steps.selectPointSHIFT":"editing.workflow.steps.selectPoint",directive:"t-plugin",done:!1}}),e.steps.push(i),t||((i=new s(e,!0)).getTask().setSteps({from:{description:"editing.workflow.steps.selectStartVertex",directive:"t-plugin",done:!1}}),e.steps.push(i)),new l(e,!0));t.getTask().setSteps({to:{description:"editing.workflow.steps.selectToPaste",directive:"t-plugin",done:!1}}),e.steps.push(t),this.registerEscKeyEvent(),r(this,e)}n(d,a),t.exports=d},{"./editingworkflow":50,"./steps/getvertexstep":71,"./steps/movelementsstep":76,"./steps/selectelementsstep":81}],46:[function(e,t,i){var n=g3wsdk.core.utils,r=n.base,n=n.inherit,a=e("./editingworkflow"),o=e("./steps/deletefeaturestep"),s=e("./steps/pickfeaturestep"),l=e("./steps/choosefeaturestep"),u=e("./steps/confirmstep");function d(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.steps=[new s,new l,new o,new u({type:"delete"})],r(this,e)}n(d,a),t.exports=d},{"./editingworkflow":50,"./steps/choosefeaturestep":64,"./steps/confirmstep":65,"./steps/deletefeaturestep":68,"./steps/pickfeaturestep":79}],47:[function(e,t,i){var n=g3wsdk.core.utils,r=n.base,n=n.inherit,a=e("./editingworkflow"),o=e("./steps/deletepartfrommultigeometriesstep"),s=e("./steps/pickfeaturestep"),l=e("./steps/choosefeaturestep");function u(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.helpMessage="editing.tools.deletepart",e.steps=[new s,new l,new o(e)],r(this,e)}n(u,a),t.exports=u},{"./editingworkflow":50,"./steps/choosefeaturestep":64,"./steps/deletepartfrommultigeometriesstep":69,"./steps/pickfeaturestep":79}],48:[function(e,t,i){var n=g3wsdk.core.utils,r=n.base,n=n.inherit,a=e("./editingworkflow"),o=e("./steps/openformstep");function s(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=new o(e);e.steps=[t],r(this,e)}n(s,a),t.exports=s},{"./editingworkflow":50,"./steps/openformstep":77}],49:[function(e,t,i){var n=g3wsdk.core.utils,r=n.base,n=n.inherit,a=e("./editingworkflow"),o=e("./steps/pickfeaturestep"),s=e("./steps/choosefeaturestep"),l=e("./steps/openformstep");function u(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.helpMessage="editing.tools.update_feature",e.steps=[new o,new s,new l],r(this,e)}n(u,a),t.exports=u},{"./editingworkflow":50,"./steps/choosefeaturestep":64,"./steps/openformstep":77,"./steps/pickfeaturestep":79}],50:[function(e,t,i){var n=g3wsdk.core.utils,r=n.base,n=n.inherit,a=g3wsdk.core.workflow.Workflow,o=g3wsdk.core.layer.Layer,s=g3wsdk.core.geometry.Geometry.isPointGeometryType;function l(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};r(this,e),this.helpMessage=e.helpMessage?{help:e.helpMessage}:null,this._toolsoftool=[]}n(l,a);n=l.prototype;n.addToolsOfTools=function(e){var n=this,t=e.step,e=e.tools,r=void 0===e?[]:e,a={snap:{type:"snap",options:{checkedAll:!1,checked:!1,active:!0,run:function(e){e=e.layer;this.active=!0,this.layerId=e.getId(),this.source=e.getEditingLayer().getSource()},stop:function(){this.active=!1}}},measure:{type:"measure",options:{checked:!1,run:function(){var e=this;setTimeout(function(){e.onChange(e.checked)})},stop:function(){t.getTask().removeMeasureInteraction()},onChange:function(e){this.checked=e,t.getTask()[e?"addMeasureInteraction":"removeMeasureInteraction"]()},onBeforeDestroy:function(){this.onChange(!1)}}}};t.on("run",function(e){var t=e.inputs,i=(e.context,t.layer);0==n._toolsoftool.length&&r.forEach(function(e){"measure"===e&&("measure"!==e||o.LayerTypes.VECTOR!==i.getType()||s(i.getGeometryType()))||n._toolsoftool.push(a[e])}),n._toolsoftool.forEach(function(e){return e.options.run({layer:i})}),n.emit("settoolsoftool",n._toolsoftool)}),t.on("stop",function(){n._toolsoftool.forEach(function(e){return e.options.stop()})})},n.setHelpMessage=function(e){this.helpMessage={help:e}},n.getHelpMessage=function(){return this.helpMessage},n.getFeatures=function(){return this.getInputs().features},n.startFromLastStep=function(e){return this.setSteps([this.getSteps().pop()]),this.start(e)},n.getCurrentFeature=function(){var e=this.getFeatures();return e[e.length-1]},n.getLayer=function(){return this.getSession().getEditor().getLayer()},n.getSession=function(){return this.getContext().session},n.escKeyUpHandler=function(e){27===e.keyCode&&(e.data.workflow.reject(),e.data.callback())},n.unbindEscKeyUp=function(){$(document).unbind("keyup",this.escKeyUpHandler)},n.bindEscKeyUp=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:function(){};$(document).on("keyup",{workflow:this,callback:e},this.escKeyUpHandler)},n.registerEscKeyEvent=function(e){var t=this;this.on("start",function(){return t.bindEscKeyUp(e)}),this.on("stop",function(){return t.unbindEscKeyUp()})},t.exports=l},{}],51:[function(e,t,i){var n=g3wsdk.core.utils,r=n.base,n=n.inherit,a=g3wsdk.core.ApplicationState,o=e("./editingworkflow"),s=e("./steps/selectelementsstep"),l=e("./steps/openformstep");function u(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(e.helpMessage="editing.tools.update_multi_features",new s({type:"multiple"}));t.getTask().setSteps({select:{description:a.ismobile?"editing.workflow.steps.selectDrawBoxAtLeast2Feature":"editing.workflow.steps.selectMultiPointSHIFTAtLeast2Feature",buttonnext:{disabled:!0,condition:function(e){e=e.features;return(void 0===e?[]:e).length<2},done:function(){}},directive:"t-plugin",dynamic:0,done:!1}}),e.steps=[t,new l({multi:!0})],this.registerEscKeyEvent(),r(this,e)}n(u,o),t.exports=u},{"./editingworkflow":50,"./steps/openformstep":77,"./steps/selectelementsstep":81}],52:[function(e,t,i){var n=g3wsdk.core.utils,r=n.inherit,a=n.base,n=e("./editingworkflow"),o=e("./steps/openformstep");function s(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(e.helpMessage="editing.tools.update_feature",new o);e.steps=[t],a(this,e)}r(s,n),t.exports=s},{"./editingworkflow":50,"./steps/openformstep":77}],53:[function(e,t,i){var n=g3wsdk.core.utils,r=n.base,n=n.inherit,a=e("./editingworkflow"),o=e("./steps/openformstep");function s(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.steps=[new o],r(this,e)}n(s,a),t.exports=s},{"./editingworkflow":50,"./steps/openformstep":77}],54:[function(e,t,i){var n=g3wsdk.core.utils,r=n.base,n=n.inherit,a=e("./editingworkflow"),o=e("./steps/opentablestep");function s(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.steps=[new o],e.backbuttonlabel="plugins.editing.form.buttons.save_and_back_table",r(this,e)}n(s,a),t.exports=s},{"./editingworkflow":50,"./steps/opentablestep":78}],55:[function(e,t,i){var n=g3wsdk.core.utils,r=n.base,n=n.inherit,a=e("./editingworkflow"),o=e("./steps/linkrelationstep");function s(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.steps=[new o],r(this,e)}n(s,a),t.exports=s},{"./editingworkflow":50,"./steps/linkrelationstep":72}],56:[function(e,t,i){var n=g3wsdk.core.utils,r=n.base,n=n.inherit,a=g3wsdk.core.ApplicationState,o=e("./editingworkflow"),s=e("./steps/selectelementsstep"),l=e("./steps/mergefeaturesstep");function u(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(e.type="bbox",e.help="editing.steps.help.merge",new s(e,!0)),i=(t.getTask().setSteps({select:{description:a.ismobile?"editing.workflow.steps.selectDrawBox":"editing.workflow.steps.selectSHIFT",directive:"t-plugin",done:!1}}),new l(e,!0));i.getTask().setSteps({choose:{description:"editing.workflow.steps.merge",directive:"t-plugin",done:!1}}),e.steps=[t,i],this.registerEscKeyEvent(),r(this,e)}n(u,o),t.exports=u},{"./editingworkflow":50,"./steps/mergefeaturesstep":73,"./steps/selectelementsstep":81}],57:[function(e,t,i){var n=g3wsdk.core.utils,r=n.base,n=n.inherit,a=e("./editingworkflow"),o=e("./steps/pickfeaturestep"),s=e("./steps/choosefeaturestep"),l=e("./steps/modifygeometryvertexstep");function u(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(e.helpMessage="editing.tools.update_vertex",new o(e)),i=new l;e.steps=[t,new s,i],r(this,e),this.addToolsOfTools({step:i,tools:["snap","measure"]})}n(u,a),t.exports=u},{"./editingworkflow":50,"./steps/choosefeaturestep":64,"./steps/modifygeometryvertexstep":74,"./steps/pickfeaturestep":79}],58:[function(e,t,i){var n=g3wsdk.core.utils,r=n.base,n=n.inherit,a=e("./editingworkflow"),o=e("./steps/pickfeaturestep"),s=e("./steps/choosefeaturestep"),l=e("./steps/movefeaturestep");function u(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.helpMessage="editing.tools.move_feature",e.steps=[new o,new s,new l],r(this,e)}n(u,a),t.exports=u},{"./editingworkflow":50,"./steps/choosefeaturestep":64,"./steps/movefeaturestep":75,"./steps/pickfeaturestep":79}],59:[function(e,t,i){var n=g3wsdk.core.utils,r=n.base,n=n.inherit,a=e("./editingworkflow"),o=e("./steps/pickprojectlayerfeaturesstep"),s=e("./steps/copyfeaturesfromotherprojectlayerstep"),l=e("./steps/openformstep");function u(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.help="editing.steps.help.copy",e.steps=[new o(e),new s(e),new l(e)],this.registerEscKeyEvent(),r(this,e)}n(u,a),t.exports=u},{"./editingworkflow":50,"./steps/copyfeaturesfromotherprojectlayerstep":67,"./steps/openformstep":77,"./steps/pickprojectlayerfeaturesstep":80}],60:[function(e,t,i){var n=g3wsdk.core.utils,r=n.base,n=n.inherit,a=e("./editingworkflow"),o=e("./steps/selectelementsstep"),s=e("./steps/splitfeaturestep"),l=g3wsdk.core.ApplicationState;function u(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=(e.type=l.ismobile?"single":"multiple",e.help="editing.steps.help.split",new o(e,!0)),i=(t.getTask().setSteps({select:{description:"multiple"===e.type?"editing.workflow.steps.selectPointSHIFT":"editing.workflow.steps.selectPoint",directive:"t-plugin",done:!1}}),new s(e,!0));i.getTask().setSteps({draw_line:{description:"editing.workflow.steps.draw_split_line",directive:"t-plugin",done:!1}}),e.steps=[t,i],this.registerEscKeyEvent(),r(this,e)}n(u,a),t.exports=u},{"./editingworkflow":50,"./steps/selectelementsstep":81,"./steps/splitfeaturestep":82}],61:[function(e,t,i){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.task=new s(e),e.help="editing.steps.help.draw_new_feature",a(this,e)}var r=g3wsdk.core.utils,a=r.base,r=r.inherit,o=e("./editingstep"),s=e("./tasks/addfeaturetask");r(n,o),t.exports=n},{"./editingstep":70,"./tasks/addfeaturetask":84}],62:[function(e,t,i){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.task=new s(e),a(this,e)}var r=g3wsdk.core.utils,a=r.base,r=r.inherit,o=e("./editingstep"),s=e("./tasks/addparttomultigeometriestask");r(n,o),t.exports=n},{"./editingstep":70,"./tasks/addparttomultigeometriestask":85}],63:[function(e,t,i){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.task=new s,e.help="editing.steps.help.new",a(this,e)}var r=g3wsdk.core.utils,a=r.base,r=r.inherit,o=g3wsdk.core.workflow.Step,s=e("./tasks/addfeaturetabletask");r(n,o),t.exports=n},{"./tasks/addfeaturetabletask":83}],64:[function(e,t,i){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.task=new s(e),a(this,e)}var r=g3wsdk.core.utils,a=r.base,r=r.inherit,o=g3wsdk.core.workflow.Step,s=e("./tasks/choosefeaturetask");r(n,o),t.exports=n},{"./tasks/choosefeaturetask":86}],65:[function(e,t,i){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.task=new s(e),a(this,e)}var r=g3wsdk.core.utils,a=r.base,r=r.inherit,o=e("./editingstep"),s=e("./tasks/confirmtask");r(n,o),t.exports=n},{"./editingstep":70,"./tasks/confirmtask":87}],66:[function(e,t,i){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.task=new s(e),e.help="editing.steps.help.draw_new_feature",a(this,e)}var r=g3wsdk.core.utils,a=r.base,r=r.inherit,o=e("./editingstep"),s=e("./tasks/copyfeaturesfromotherlayertask");r(n,o),t.exports=n},{"./editingstep":70,"./tasks/copyfeaturesfromotherlayertask":88}],67:[function(e,t,i){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.task=new s(e),e.help="editing.steps.help.draw_new_feature",a(this,e)}var r=g3wsdk.core.utils,a=r.base,r=r.inherit,o=e("./editingstep"),s=e("./tasks/copyfeaturesfromotherprojectlayertask");r(n,o),t.exports=n},{"./editingstep":70,"./tasks/copyfeaturesfromotherprojectlayertask":89}],68:[function(e,t,i){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.task=new s,e.help="editing.steps.help.double_click_delete",a(this,e)}var r=g3wsdk.core.utils,a=r.base,r=r.inherit,o=e("./editingstep"),s=e("./tasks/deletefeaturetask");r(n,o),t.exports=n},{"./editingstep":70,"./tasks/deletefeaturetask":90}],69:[function(e,t,i){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.task=new s(e),a(this,e)}var r=g3wsdk.core.utils,a=r.base,r=r.inherit,o=e("./editingstep"),s=e("./tasks/deletepartfrommultigeometriestask");r(n,o),t.exports=n},{"./editingstep":70,"./tasks/deletepartfrommultigeometriestask":91}],70:[function(e,t,i){function n(){a(this,0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}var r=g3wsdk.core.utils,a=r.base;(0,r.inherit)(n,g3wsdk.core.workflow.Step),t.exports=n},{}],71:[function(e,t,i){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.task=new s(e),e.help="editing.steps.help.select",a(this,e)}var r=g3wsdk.core.utils,a=r.base,r=r.inherit,o=e("./editingstep"),s=e("./tasks/getvertextask");r(n,o),t.exports=n},{"./editingstep":70,"./tasks/getvertextask":93}],72:[function(e,t,i){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.task=new s,e.help="editing.steps.help.select_feature_to_relation",a(this,e)}var r=g3wsdk.core.utils,a=r.base,r=r.inherit,o=e("./editingstep"),s=e("./tasks/linkrelationtask");r(n,o),t.exports=n},{"./editingstep":70,"./tasks/linkrelationtask":94}],73:[function(e,t,i){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.task=new s,e.help="editing.steps.help.merge",a(this,e)}var r=g3wsdk.core.utils,a=r.base,r=r.inherit,o=e("./editingstep"),s=e("./tasks/mergefeaturestask");r(n,o),t.exports=n},{"./editingstep":70,"./tasks/mergefeaturestask":95}],74:[function(e,t,i){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{snap:!0},t=new s(e);e.task=t,e.help="editing.steps.help.edit_feature_vertex",a(this,e)}var r=g3wsdk.core.utils,a=r.base,r=r.inherit,o=e("./editingstep"),s=e("./tasks/modifygeometryvertextask");r(n,o),t.exports=n},{"./editingstep":70,"./tasks/modifygeometryvertextask":96}],75:[function(e,t,i){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.task=new s(e),e.help="editing.steps.help.move",a(this,e)}var r=g3wsdk.core.utils,a=r.base,r=r.inherit,o=e("./editingstep"),s=e("./tasks/movefeaturettask");r(n,o),t.exports=n},{"./editingstep":70,"./tasks/movefeaturettask":98}],76:[function(e,t,i){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=new s(e);e.task=t,e.help="editing.steps.help.select_vertex_to_paste",a(this,e)}var r=g3wsdk.core.utils,a=r.base,r=r.inherit,o=e("./editingstep"),s=e("./tasks/moveelementstask");r(n,o),t.exports=n},{"./editingstep":70,"./tasks/moveelementstask":97}],77:[function(e,t,i){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.task=new s(e),e.help="editing.steps.help.insert_attributes_feature",a(this,e)}var r=g3wsdk.core.utils,a=r.base,r=r.inherit,o=g3wsdk.core.workflow.Step,s=e("./tasks/openformtask");r(n,o),t.exports=n},{"./tasks/openformtask":99}],78:[function(e,t,i){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.task=new s,e.help="editing.steps.help.edit_table",a(this,e)}var r=g3wsdk.core.utils,a=r.base,r=r.inherit,o=g3wsdk.core.workflow.Step,s=e("./tasks/opentabletask");r(n,o),t.exports=n},{"./tasks/opentabletask":100}],79:[function(e,t,i){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=new s(e);e.task=t,e.help="editing.steps.help.pick_feature",a(this,e)}var r=g3wsdk.core.utils,a=r.base,r=r.inherit,o=g3wsdk.core.workflow.Step,s=e("./tasks/pickfeaturetask");r(n,o),t.exports=n},{"./tasks/pickfeaturetask":101}],80:[function(e,t,i){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};e.task=new s(e),e.help="editing.steps.help.pick_feature",a(this,e)}var r=g3wsdk.core.utils,a=r.base,r=r.inherit,o=g3wsdk.core.workflow.Step,s=e("./tasks/pickprojectlayerfeaturestask");r(n,o),t.exports=n},{"./tasks/pickprojectlayerfeaturestask":102}],81:[function(e,t,i){function n(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=arguments[1];t.task=new l(t),t.help=t.help||"editing.steps.help.select_elements",i&&this.on("run",function(){e.emit("next-step",o("editing.steps.help.select_elements"))}),a(this,t)}var r=g3wsdk.core.utils,a=r.base,r=r.inherit,o=g3wsdk.core.i18n.tPlugin,s=e("./editingstep"),l=e("./tasks/selectelementstask");r(n,s),t.exports=n},{"./editingstep":70,"./tasks/selectelementstask":103}],82:[function(e,t,i){function n(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=new s(e);e.task=t,e.help="",a(this,e)}var r=g3wsdk.core.utils,a=r.base,r=r.inherit,o=e("./editingstep"),s=e("./tasks/splitfeaturetask");r(n,o),t.exports=n},{"./editingstep":70,"./tasks/splitfeaturetask":104}],83:[function(e,t,i){var n=g3wsdk.core.utils,r=n.base;function a(){r(this,0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}(0,n.inherit)(a,e("./editingtask"));n=a.prototype;n.run=function(e,t){var i=$.Deferred(),n=0<e.features.length?e.features[e.features.length-1]:e.layer.createNewFeature();return n.setTemporaryId(),e.layer.getEditingLayer().getEditingSource().addFeature(n),t.session.pushAdd(e.layer.getId(),n,!1),e.features.push(n),this.setContextGetDefaultValue(!0),i.resolve(e,t),i.promise()},n.stop=function(){},t.exports=a},{"./editingtask":92}],84:[function(e,t,i){var n=g3wsdk.core.utils,r=n.base,n=n.inherit,c=g3wsdk.core.layer.Layer,f=g3wsdk.core.geometry.Geometry,g=g3wsdk.core.layer.features.Feature,a=g3wsdk.ol.interactions.measure,o=a.AreaInteraction,s=a.LengthInteraction;function l(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this._add=void 0===e.add||e.add,this._busy=!1,this.drawInteraction,this.measeureInteraction,this.drawingFeature,this._snap=!1!==e.snap,this._finishCondition=e.finishCondition||function(){return!0},this._condition=e.condition||function(){return!0},this._stopPromise,this._delKeyRemoveLastPoint=function(e){return 46===e.keyCode&&t.removeLastPoint()},r(this,e)}n(l,e("./editingtask"));a=l.prototype;a.run=function(i,e){var n,r,a,o=this,s=(this._stopPromise=$.Deferred(),$.Deferred()),t=i.layer,l=t.getEditingLayer(),u=e.session,d=t.getId();return t.getType()===c.LayerTypes.VECTOR&&(this.setAndUnsetSelectedFeaturesStyle({promise:this._stopPromise}),n=t.getEditingGeometryType(),this.geometryType=f.getOLGeometry(n),r=l.getSource(),a=t.getEditingFields(),e=new ol.source.Vector,this.drawInteraction=new ol.interaction.Draw({type:this.geometryType,source:e,condition:this._condition,freehandCondition:ol.events.condition.never,finishCondition:this._finishCondition}),this.addInteraction(this.drawInteraction),this.drawInteraction.setActive(!0),this.drawInteraction.on("drawstart",function(e){e=e.feature;o.drawingFeature=e,document.addEventListener("keydown",o._delKeyRemoveLastPoint)}),this.drawInteraction.on("drawend",function(t){var e=void 0;o._add?(a.forEach(function(e){t.feature.set(e.name,null)}),(e=new g({feature:t.feature})).setTemporaryId(),r.addFeature(e),u.pushAdd(d,e,!1)):e=t.feature,e=f.addZValueToOLFeatureGeometry({feature:e,geometryType:n}),i.features.push(e),o.setContextGetDefaultValue(!0),o.fireEvent("addfeature",e),s.resolve(i)})),s.promise()},a.addMeasureInteraction=function(){var e={projection:this.getMapService().getProjection(),drawColor:"transparent",feature:this.drawingFeature};f.isLineGeometryType(this.geometryType)?this.measureInteraction=new s(e):f.isPolygonGeometryType(this.geometryType)&&(this.measureInteraction=new o(e)),this.measureInteraction&&(this.measureInteraction.setActive(!0),this.addInteraction(this.measureInteraction))},a.removeMeasureInteraction=function(){this.measureInteraction&&(this.measureInteraction.clear(),this.removeInteraction(this.measureInteraction),this.measureInteraction=null)},a.stop=function(){return this.removeInteraction(this.drawInteraction),this.removeMeasureInteraction(),this.drawInteraction=null,this.drawingFeature=null,document.removeEventListener("keydown",this._delKeyRemoveLastPoint),this._stopPromise.resolve(!0),!0},a.removeLastPoint=function(){if(this.drawInteraction)try{this.drawInteraction.removeLastPoint()}catch(e){}},t.exports=l},{"./editingtask":92}],85:[function(e,t,i){function u(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}var n=g3wsdk.core.utils,r=n.base;function a(){r(this,0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}(0,n.inherit)(a,e("./editingtask"));n=a.prototype;n.run=function(e,t){var i=$.Deferred(),n=e.layer,r=e.features,a=n.getId(),o=t.session,s=r[0],n=s.getGeometry(),l=s.clone();return n.setCoordinates([].concat(u(n.getCoordinates()),u(r[1].getGeometry().getCoordinates()))),this.evaluateExpressionFields({inputs:e,context:t,feature:s}).finally(function(){o.pushUpdate(a,s,l),e.features=[s],i.resolve(e)}),i.promise()},n.stop=function(){},t.exports=a},{"./editingtask":92}],86:[function(e,t,i){var n=g3wsdk.core.utils,r=n.base;function a(){r(this,0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}(0,n.inherit)(a,e("./editingtask"));n=a.prototype;n.run=function(t){var i=$.Deferred(),e=t.features;return 1===e.length?i.resolve(t):this.chooseFeatureFromFeatures({promise:i,features:e}).then(function(e){t.features=[e],i.resolve(t)}).catch(function(){i.reject()}),i.promise()},n.stop=function(){return!0},t.exports=a},{"./editingtask":92}],87:[function(s,e,t){var i=g3wsdk.core.utils,n=i.base,i=i.inherit,r=g3wsdk.core.i18n,a=r.t,l=r.tPlugin,u=g3wsdk.gui.GUI,r=s("./editingtask"),o={delete:{fnc:function(t){var i=$.Deferred(),n=s("../../../services/editingservice"),e=t.layer,r=e.getEditingLayer(),a=t.features[0],o=e.getId(),e=e.getChildren().length&&0<n._filterRelationsInEditing({layerId:o,relations:e.getRelations().getArray()}).length;return u.dialog.confirm("<h4>"+l("editing.messages.delete_feature")+'</h4>\n                  <div style="font-size:1.2em;">'+(e?l("editing.messages.delete_feature_relations"):"")+"</div>",function(e){e?(r.getSource().removeFeature(a),n.removeLayerUniqueFieldValuesFromFeature({layerId:o,feature:a}),i.resolve(t)):i.reject(t)}),i.promise()}},commit:{fnc:function(e){var t=$.Deferred(),i=e.close,n={SAVE:{label:a("save"),className:"btn-success",callback:function(){t.resolve(e)}},CANCEL:{label:a(i?"exitnosave":"annul"),className:"btn-danger",callback:function(){t.reject()}}},r=(i&&(n.CLOSEMODAL={label:a("annul"),className:"btn-primary",callback:function(){r.modal("hide")}}),u.dialog.dialog({message:e.message,title:l("editing.messages.commit_feature")+" "+e.layer.getName()+"?",buttons:n}));return t.promise()}}};function d(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.type||"default";this._dialog=o[t],n(this,e)}i(d,r);i=d.prototype;i.run=function(e,t){t=this._dialog.fnc(e,t);return e.features&&this.setAndUnsetSelectedFeaturesStyle({promise:t}),t},i.stop=function(){return!0},e.exports=d},{"../../../services/editingservice":31,"./editingtask":92}],88:[function(e,t,i){var n=e("../../../components/CopyFeaturesFromOtherLayers.vue"),v=(n=n)&&n.__esModule?n:{default:n};function y(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}var m=g3wsdk.constant.G3W_FID,n=g3wsdk.core.utils,r=n.base,n=n.inherit,_=g3wsdk.core.geoutils.Geometry.removeZValueToOLFeatureGeometry,w=g3wsdk.gui.GUI,b=g3wsdk.core.i18n.tPlugin,k=g3wsdk.core.layer.features.Feature,F=g3wsdk.core.catalog.CatalogLayersStoresRegistry;function a(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.openFormTask=e.openFormTask,r(this,e)}n(a,e("./editingtask"));n=a.prototype;n.run=function(i,e){var t,n=this,r=$.Deferred(),s=i.layer,a=s.getGeometryType(),l=s.getId(),u=s.getEditingFields().filter(function(e){return!e.pk}),d=e.session,c=s.getEditingLayer().getSource(),e=this.getFeaturesFromSelectionFeatures({layerId:l,geometryType:a}),f=[],o={},g=((e||[]).forEach(function(e){var t;void 0===o[e.__layerId]&&(t=!F.getLayerById(e.__layerId),o[e.__layerId]={external:t,fields:!t&&F.getLayerById(e.__layerId).getFields(),features:[]}),o[e.__layerId].features.push(e)}),Vue.observable({state:!1})),p=new(Vue.extend(v.default))({layers:o,selectedFeatures:f,editAttributes:g}),a=p.$mount().$el,h=w.showModalDialog({title:b("editing.modal.tools.copyfeaturefromotherlayer.title"),className:"modal-left",closeButton:!1,message:a,buttons:{cancel:{label:"Cancel",className:"btn-danger",callback:function(){r.reject()}},ok:{label:"Ok",className:"btn-success",callback:(t=y(function*(){var a=[],o=!1,t=[];f.forEach(function(e){n.getEditingService().getProjectLayerById(e.__layerId)?t.push(n.getEditingService().getProjectLayerFeatureById({layerId:e.__layerId,fid:e.get(m)})):t.push({properties:e.getProperties()})}),(yield Promise.allSettled(t)).forEach(function(e,t){var i,n=e.status,r=e.value;"fulfilled"===n&&(e=f[t],o=void 0!==u.find(function(e){var t=e.name,e=e.validate.required;return void 0===r.properties[t]&&(void 0!==e&&e)}),i=new k({feature:e,properties:u.map(function(e){return e.name})}),u.forEach(function(e){e=e.name;void 0===i.get(e)&&i.set(e,null)}),s.getEditingNotEditableFields().find(function(e){s.isPkField(e)&&i.set(e,null)}),_({feature:i}),i.setTemporaryId(),c.addFeature(i),a.push(i),d.pushAdd(l,i,!1))}),1<a.length&&(g.state&&n.openFormTask?n.openFormTask.updateMulti(!0):o&&w.showUserMessage({type:"warning",message:"plugins.editing.messages.copy_and_paste_from_other_layer_mandatory_fields",autoclose:!0,duration:2e3})),a.forEach(function(e){i.features.push(e),n.fireEvent("addfeature",e)}),p.$destroy(),r.resolve(i)}),function(){return t.apply(this,arguments)})}}});return h.find("button.btn-success").prop("disabled",!0),p.$watch("selectedFeatures",function(e){return h.find("button.btn-success").prop("disabled",0===e.length)}),r.promise()},n.stop=function(){return!0},t.exports=a},{"../../../components/CopyFeaturesFromOtherLayers.vue":4,"./editingtask":92}],89:[function(e,t,i){var n=e("../../../components/CopyFeaturesFromOtherProjectLayer.vue"),a=(n=n)&&n.__esModule?n:{default:n};function p(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}var h=g3wsdk.constant.G3W_FID,n=g3wsdk.core.utils,r=n.base,n=n.inherit,v=g3wsdk.gui.GUI,y=g3wsdk.core.geoutils.Geometry.removeZValueToOLFeatureGeometry,m=g3wsdk.core.i18n.tPlugin,_=g3wsdk.core.layer.features.Feature,w=g3wsdk.core.catalog.CatalogLayersStoresRegistry;function o(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.copyLayer,i=e.external,n=e.isVector;this.copyLayer=t,this.external=i,this.isVector=n,r(this,e)}n(o,e("./editingtask"));n=o.prototype;n.run=function(n,e){var t,o=this,s=$.Deferred(),i=n.features,l=n.layer,u=l.getId(),d=l.getEditingFields().filter(function(e){return!e.pk}),c=e.session,f=l.getEditingLayer().getSource(),g=[],e=new(Vue.extend(a.default))({fields:this.external?null:w.getLayerById(this.copyLayer.getId()).getFields(),features:void 0!==i?i:[],selectedFeatures:g}),i=e.$mount().$el,r=v.showModalDialog({title:m("editing.modal.tools.copyfeaturefromprojectlayer.title"),className:"modal-left",closeButton:!1,message:i,buttons:{cancel:{label:"Cancel",className:"btn-danger",callback:function(){s.reject()}},ok:{label:"Ok",className:"btn-success",callback:(t=p(function*(){var e=[],r=!1;if(g.length){function t(n){d.forEach(function(e){var t=e.name,e=e.validate.required,i=n[t]||null;r=r||null===i&&(void 0!==e&&e),a.set(t,i)});var t=new _({feature:a,properties:d.map(function(e){return e.name})});l.getEditingNotEditableFields().find(function(e){l.isPkField(e)&&t.set(e,null)}),y({feature:t}),t.setTemporaryId(),f.addFeature(t),e.push(t),c.pushAdd(u,t,!1)}var a=g[0];if(o.isVector)if(o.external)t(a.getProperties());else try{var i=yield o.getEditingService().getProjectLayerFeatureById({layerId:o.copyLayer.getId(),fid:a.get(h)});i&&t(i.properties)}catch(e){}}e.length&&1===e.length?n.features.push(e[0]):(r&&v.showUserMessage({type:"warning",message:"plugins.editing.messages.copy_and_paste_from_other_layer_mandatory_fields",autoclose:!0,duration:2e3}),n.features.push(e)),e.forEach(function(e){return o.fireEvent("addfeature",e)}),s.resolve(n)}),function(){return t.apply(this,arguments)})}}});return r.find("button.btn-success").prop("disabled",!0),e.$watch("selectedFeatures",function(e){return r.find("button.btn-success").prop("disabled",0===e.length)}),s.promise()},n.stop=function(){return!0},t.exports=o},{"../../../components/CopyFeaturesFromOtherProjectLayer.vue":5,"./editingtask":92}],90:[function(d,e,t){var i=g3wsdk.core.utils,n=i.base;function r(e){this.drawInteraction=null,this._selectInteraction=null,n(this,e)}(0,i.inherit)(r,d("./editingtask"));i=r.prototype;i.run=function(t,e){var r=d("../../../services/editingservice"),a=d("../../../services/relationservice"),i=$.Deferred(),n=t.layer,o=n.getId(),s=e.session,l=t.features[0],u=r._filterRelationsInEditing({layerId:o,relations:n.getRelations()?n.getRelations().getArray():[]}).filter(function(e){var t=r._getRelationId({layerId:o,relation:e}),i=r.getLayerById(t),n=r._getRelationFieldsFromRelation({layerId:t,relation:e}).ownField;return i.getEditingFields().filter(function(e){return n.includes(e.name)}).every(function(e){return!e.validate.required})});return(0<u.length?r.getLayersDependencyFeatures(o,{feature:l,relations:u}):Promise.resolve()).then(function(){var e=r.getRelationsInEditing({layerId:o,relations:u,feature:l});t.features=[l],e.forEach(function(e){for(var t=e.relation,e=e.relations,i=new a(o,{relation:t,relations:e}),n=e.length,r=0;r<n;r++)i.unlinkRelation(0,!1)}),s.pushDelete(o,l),i.resolve(t)}),i.promise()},i.stop=function(){return Promise.resolve(!0)},e.exports=r},{"../../../services/editingservice":31,"../../../services/relationservice":32,"./editingtask":92}],91:[function(e,t,i){var n=g3wsdk.core.utils,r=n.base,n=n.inherit,a=g3wsdk.core.geoutils,h=a.multiGeometryToSingleGeometries,v=a.singleGeometriesToMultiGeometry;function o(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.pickFeatureInteraction=null,r(this,e)}n(o,e("./editingtask"));a=o.prototype;a.run=function(i,n){var r=this,a=$.Deferred(),e=i.layer,o=i.layer.getEditingLayer(),s=e.getId(),l=n.session,e=i.features,t=i.coordinate,u=e[0],d=u.clone(),e=u.getGeometry(),e=h(e),c=new ol.source.Vector({features:e.map(function(e){return new ol.Feature(e)})}),f=this.getMap(),g=f.getPixelFromCoordinate(t),p=new ol.layer.Vector({source:c,style:o.getStyle()});return f.addLayer(p),f.once("postrender",function(){var t=!1;f.forEachFeatureAtPixel(g,function(e){t||(c.removeFeature(e),c.getFeatures().length?(e=v(c.getFeatures().map(function(e){return e.getGeometry()})),u.setGeometry(e),r.evaluateExpressionFields({inputs:i,context:n,feature:u}).finally(function(){l.pushUpdate(s,u,d),a.resolve(i)})):(o.getSource().removeFeature(u),l.pushDelete(s,u),a.resolve(i)),t=!0)},{layerFilter:function(e){return e===p},hitTolerance:1}),f.removeLayer(p),p=null}),a.promise()},a.stop=function(){},t.exports=o},{"./editingtask":92}],92:[function(e,t,i){var c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=e("../../../components/ChooseFeatureToEdit.vue"),l=(n=n)&&n.__esModule?n:{default:n},f=e("../../../eventbus");function v(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}var n=g3wsdk.core.utils,r=n.base,a=n.inherit,p=n.createFilterFormInputs,o=g3wsdk.core.geometry.Geometry,n=g3wsdk.core.geoutils,s=n.convertSingleMultiGeometry,u=n.isSameBaseGeometryType,d=n.createSelectedStyle,g=n.areCoordinatesEqual,n=g3wsdk.core.layer,h=n.Layer,y=n.features.Feature,m=g3wsdk.gui.GUI,n=g3wsdk.core.workflow,w=n.WorkflowsStack,n=n.Task,b=g3wsdk.core.input.inputService,k=g3wsdk.core.i18n.tPlugin,F=g3wsdk.core.data.DataRouterService;function x(){r(this,0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}),this._editingServive,this._mapService=m.getService("map"),this.addInteraction=function(e){this._mapService.addInteraction(e)},this.removeInteraction=function(e){var t=this;setTimeout(function(){return t._mapService.removeInteraction(e)})}}a(x,n);var S,a=x.prototype;a.getEditingType=function(){return null},a.registerPointerMoveCursor=function(){this._mapService.getMap().on("pointermove",this._pointerMoveCursor)},a.unregisterPointerMoveCursor=function(){this._mapService.getMap().un("pointermove",this._pointerMoveCursor)},a._pointerMoveCursor=function(e){this.getTargetElement().style.cursor=this.forEachFeatureAtPixel(e.pixel,function(){return!0})?"pointer":""},a.setSteps=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this._steps=e,this.setUserMessageSteps(e)},a.getSteps=function(){return this._steps},a.getMapService=function(){return this._mapService},a.getMap=function(){return this._mapService.getMap()},a.areCoordinatesEqual=function(e){function t(e){return g(n,e)}var i=e.feature,n=e.coordinates,r=i.getGeometry(),e=r.getType();switch(e){case"Polygon":case"MultiLineString":return _.flatMap(r.getCoordinates()).some(t);case"LineString":case"MultiPoint":return r.getCoordinates().some(t);case"MultiPolygon":return r.getPolygons().some(function(e){return _.flatMap(e.getCoordinates()).some(t)});case"Point":return g(n,r.getCoordinates());default:return!1}},a.setFeaturesSelectedStyle=function(){var t,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];if(0<e.length)return e=e.flat(),t=this.getSelectedStyle(e[0]),e.forEach(function(e){return e.setStyle(t.selectedStyle)}),t.originalStyle},a.setAndUnsetSelectedFeaturesStyle=function(){function e(){var t=i.setFeaturesSelectedStyle(a);n.always(function(){a.flat().forEach(function(e){return e.setStyle(t)})})}var i=this,n=(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).promise,t=this.getInputs(),r=t.layer,t=t.features,a=void 0===t?[]:t,t=h.LayerTypes.VECTOR===r.getType(),r=w.getLength();t&&r?setTimeout(function(){e()}):t&&e()},a.getSelectedStyle=function(e){return{originalStyle:e.getStyle(),selectedStyle:d({geometryType:e.getGeometry().getType()})}},a.disableSidebar=function(){this._isContentChild||m.disableSideBar(!(0<arguments.length&&void 0!==arguments[0])||arguments[0])},a.getEditingService=function(){return this._editingServive=this._editingServive||e("../../../services/editingservice"),this._editingServive},a.fireEvent=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{};return this.getEditingService().fireEvent(e,t)},a.setNullMediaFields=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.layer,i=e.feature;t.getEditingMediaFields({}).forEach(function(e){return i.set(e,null)})},a.run=function(e,t){},a.stop=function(){},a.saveSingle=function(e,t){var i=this;t.session.save().then(function(){return i.getEditingService().saveChange()})},a.cancelSingle=function(e,t){t.session.rollback()},a.getRootWorkflowLayerId=function(){return w.getFirst().getInputs().layer.getId()},a.getFormFields=v(function*(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=t.inputs,i=t.context,r=t.feature,t=t.isChild,a=void 0!==t&&t,o=!1,s=this.getEditingService(),l=this.getRootWorkflowLayerId(),u=n.layer.getId(),d=[],t=n.layer.getFieldsWithValues(r,{exclude:i.excludeFields,get_default_value:void 0!==i.get_default_value&&i.get_default_value});return t.forEach(function(e){e.validate.unique&&e.editable&&(o=!0,d.push({field:e,_value:r.get(e.name)}))}),d.forEach(function(e){var t=e._value,i=e.field;(a?s.getChildLayerUniqueFieldValues({layerId:u,relationLayerId:l,field:i}):s.getLayerUniqueFieldValues({layerId:u,field:i})).forEach(function(e){i.validate.exclude_values.add(-1===[null,void 0].indexOf(e)?""+e:e)}),n.features.forEach(function(e){e=e.get(i.name);-1===[null,void 0].indexOf(e)&&i.validate.exclude_values.add(""+e)}),i.validate.exclude_values.delete(t)}),o&&(s.subscribe("savedfeature_"+u,e=function(){return d.forEach(function(e){var t=e._value,e=e.field;t!==e.value&&(a?s.changeRelationLayerUniqueFieldValues({layerId:u,relationLayerId:l,field:e,oldValue:t,newValueconvertSingleMultiGeometry:e.value}):s.changeLayerUniqueFieldValues({layerId:u,field:e,oldValue:t,newValue:e.value}))}),!1===a&&s.saveTemporaryRelationsUniqueFieldsValues(u),{once:!0}}),s.subscribe("closeform_"+u,function(){return s.unsubscribe("savedfeature_"+u,e),s.clearTemporaryRelationsUniqueFieldsValues(u),{once:!0}})),t}),a.evaluateExpressionFields=v(function*(){var a=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},o=e.inputs,t=e.context,s=e.feature,l=[];return o.layer.getFieldsWithValues(s,{exclude:t.excludeFields,get_default_value:void 0!==t.get_default_value&&t.get_default_value}).forEach(function(i){var n,r;i.input.options.default_expression&&(i.input.options.default_expression.apply_on_update||s.isNew())&&l.push(new Promise((n=v(function*(e,t){try{yield b.handleDefaultExpressionFormInput({field:i,feature:s,qgs_layer_id:o.layer.getId(),parentData:a.getParentFormData()}),s.set(i.name,i.value),e(s)}catch(e){t(e)}}),function(e,t){return n.apply(this,arguments)}))),i.input.options.filter_expression&&l.push(new Promise((r=v(function*(e,t){try{yield b.handleFilterExpressionFormInput({field:i,feature:s,qgs_layer_id:o.layer.getId(),parentData:a.getParentFormData()}),s.set(i.name,i.value),e(s)}catch(e){t(e)}}),function(e,t){return r.apply(this,arguments)})))}),yield Promise.allSettled(l),s}),a.getNotEditableFieldsNoPkValues=function(e){var i=e.layer,n=e.feature;return i.getEditingNotEditableFields().reduce(function(e,t){return e[t]=i.isPkField(t)?null:n.get(t),e},{})},a.setContextGetDefaultValue=function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this.getContext().get_default_value=e},a.getParentFormData=function(){var e,t,i,n;if(1<w.getLength())return e=(i=w.getParent().getInputs()).features,t=i.layer,i=void 0===(i=i.fields)?[]:i,n=e[e.length-1].clone(),i.forEach(function(e){var t=e.name,e=e.value;n.set(t,e)}),{feature:n,qgs_layer_id:t.getId()}},a.getFeaturesFromSelectionFeatures=function(e){var t=e.layerId,e=e.geometryType;return this.convertFeaturesGeometryToGeometryTypeOfLayer({features:this._mapService.defaultsLayers.selectionLayer.getSource().getFeatures().filter(function(e){return e.__layerId!==t}),geometryType:e})},a.convertFeaturesGeometryToGeometryTypeOfLayer=function(e){var t=e.features,t=void 0===t?[]:t,i=e.geometryType,n=[];return t.forEach(function(e){var t=e.getGeometry()&&e.getGeometry().getType();i===t?n.push(e):!u(t,i)||!o.isMultiGeometry(i)&&o.isMultiGeometry(t)||((t=e.clone()).__layerId=e.__layerId,t.setGeometry(s(e.getGeometry(),i)),n.push(t))}),n},a.chooseFeatureFromFeatures=function(e){var o=this,e=e.features,s=void 0===e?[]:e;return new Promise(function(e,t){var i=o.getInputs(),n=[],i=new(Vue.extend(l.default))({features:Array.isArray(s)?s:[],feature:n,attributes:i.layer.getEditingFields().map(function(e){return{name:e.name,label:e.label}})}),r=i.$mount().$el,a=m.showModalDialog({title:k("editing.modal.tools.copyfeaturefromprojectlayer.title"),className:"modal-left",closeButton:!1,message:r,buttons:{cancel:{label:"Cancel",className:"btn-danger",callback:function(){t()}},ok:{label:"Ok",className:"btn-success",callback:function(){e(n[0])}}}});a.find("button.btn-success").prop("disabled",!0),i.$watch("feature",function(e){return a.find("button.btn-success").prop("disabled",null===e)})})},a.handleRelation1_1LayerFields=v(function*(){var c,f=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},g=e.layerId,t=e.features,p=void 0===t?[]:t,t=e.fields,h=void 0===t?[]:t;0!==p.length&&(e=(c=this.getEditingService()).getRelation1_1ByLayerId(g).map(function(d){return new Promise((t=v(function*(e){var t,i,n,r,a,o,s,l,u;g===d.getFather()&&(t=d.getFatherField()[0],null!==(i=p[0].get(t))&&(n=d.getChild(),r=d.getChildField()[0],a=c.getLayerById(n).getEditingSource(),o=s=void 0,s=a.readFeatures().find(function(e){return e.get(r)===i}),l=void 0!==c.getRelation1_1EditingLayerFieldsReferredToChildRelation(d).find(function(e){var t=e.name;return h.find(function(e){return e.name==t}).update}),u=void 0===s,l)&&(u?((s=new y).setTemporaryId(),c.getProjectLayerById(n).getEditingFields().forEach(function(e){return s.set(e.name,null)}),s.set(r,h.find(function(e){return t===e.name}).value),a.addFeature(s),o=s):s&&(o=s.clone()),s))&&(c.getRelation1_1EditingLayerFieldsReferredToChildRelation(d).filter(function(e){return e.editable}).forEach(function(e){return o.set(f.getChildFieldNameFromRelation1_1({relation:d,field:e}),p[0].get(e.name))}),u?(c.getLayerById(g).isPkField(t)&&s.set(r,p[0].getId()),f.getContext().session.pushAdd(n,o,!1)):(a.updateFeature(o),f.getContext().session.pushUpdate(n,o,s))),e()}),function(e){return t.apply(this,arguments)}));var t}),yield Promise.allSettled(e))}),a._getRelation1_1ChildFeature=(S=v(function*(e){var t,i,n,r,a=e.relation,o=e.fatherFormRelationField,e=this.getEditingService(),s=a.getFather(),l=a.getChild(),u=a.getChildField()[0],d=!1,c=e.getLayerById(l).getEditingSource().readFeatures().find(function(e){return e.get(u)===o.value});if(void 0===(c=void 0===c&&(i=(t=e.getLayerById(l).getFeaturesStore()).oncebefore("featuresLockedByOtherUser",function(e){c=e[0]}),yield e.getLayersDependencyFeatures(s,{feature:new ol.Feature((s={},n=o.name,r=o.value,n in s?Object.defineProperty(s,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):s[n]=r,s)),relations:[a]}),t.un("featuresLockedByOtherUser",i),void 0===c)?e.getLayerById(l).getEditingSource().readFeatures().find(function(e){return e.get(u)===o.value}):c))try{var f=e.getProjectLayerById(l),g=(yield F.getData("search:features",{inputs:{layer:f,formatter:0,filter:p({layer:f,search_endpoint:"api",inputs:[{attribute:u,value:o.value}]}),search_endpoint:"api"},outputs:!1})).data;g&&g[0]&&1===g[0].features.length&&(d=!0,c=g[0].features[0])}catch(e){}return{feature:c,locked:d}}),function(e){return S.apply(this,arguments)}),a.listenRelation1_1FieldChange=v(function*(){var l=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},e=t.layerId,t=t.fields,u=void 0===t?[]:t,n=[],d=this.getEditingService(),i=!0,t=!1,r=void 0;try{for(var a,o=this.getEditingService().getRelation1_1ByLayerId(e)[Symbol.iterator]();!(i=(a=o.next()).done);i=!0){var s=yield*function*(r){var e=r.getChild(),t=r.getFatherField(),a={},o=u.find(function(e){return t.includes(e.name)});if(!o||!d.getLayerById(e))return{v:void 0};var i,s=d.getRelation1_1EditingLayerFieldsReferredToChildRelation(r).reduce(function(e,t){var i=u.find(function(e){return e.name===t.name});return e[i.name]=i.editable,e},{});o.input.options.loading.state="loading",a[o.value]=yield l._getRelation1_1ChildFeature({relation:r,fatherFormRelationField:o}),o.input.options.loading.state=null,a[o.value].locked&&Object.keys(s).forEach(function(t){return u.find(function(e){return e.name===t}).editable=!1}),n.push(f.VM.$watch(function(){return o.value},(i=v(function*(e){if(e){if(o.editable=!1,o.input.options.loading.state="loading",void 0===a[o.value])try{a[o.value]=yield l._getRelation1_1ChildFeature({relation:r,fatherFormRelationField:o})}catch(e){}var e,i=(e=a[o.value]).feature,n=e.locked;Object.keys(s).forEach(function(t){var e=u.find(function(e){return e.name===t});e.editable=!n&&s[t],e.value=i?i.get(l.getChildFieldNameFromRelation1_1({relation:r,field:e})):null})}o.input.options.loading.state=null,o.editable=!0}),function(e){return i.apply(this,arguments)})))}(a.value);if("object"===(void 0===s?"undefined":c(s)))return s.v}}catch(e){t=!0,r=e}finally{try{!i&&o.return&&o.return()}finally{if(t)throw r}}return n}),a.getChildFieldNameFromRelation1_1=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.relation,e=e.field;return t.getPrefix()?e.name.split(t.getPrefix())[1]:e.name},t.exports=x},{"../../../components/ChooseFeatureToEdit.vue":3,"../../../eventbus":25,"../../../services/editingservice":31}],93:[function(e,t,i){var n=g3wsdk.core.utils,r=n.base;function a(){this._drawInteraction,this._snapIteraction,this._stopPromise,r(this,0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}(0,n.inherit)(a,e("./editingtask"));n=a.prototype;n.run=function(t){var i=this,n=$.Deferred(),r=t.features;if(r.length)return this._stopPromise=$.Deferred(),this.setAndUnsetSelectedFeaturesStyle({promise:this._stopPromise}),this._snapIteraction=new ol.interaction.Snap({features:new ol.Collection(r),edge:!1}),this._drawIteraction=new ol.interaction.Draw({type:"Point",condition:function(e){var t=e.coordinate;return!!r.find(function(e){return i.areCoordinatesEqual({feature:e,coordinates:t})})}}),this._drawIteraction.on("drawend",function(e){t.coordinates=e.feature.getGeometry().getCoordinates(),i.setUserMessageStepDone("from"),n.resolve(t)}),this.addInteraction(this._drawIteraction),this.addInteraction(this._snapIteraction),n.promise()},n.stop=function(){this.removeInteraction(this._drawIteraction),this.removeInteraction(this._snapIteraction),this._snapIteraction=null,this._drawIteraction=null,this._stopPromise.resolve(!0)},t.exports=a},{"./editingtask":92}],94:[function(e,t,i){var l=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var i=t,n=[],r=!0,t=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!i||n.length!==i);r=!0);}catch(e){t=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(t)throw a}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},n=g3wsdk.core.utils,r=n.base,n=n.inherit,e=e("./editingtask"),u=g3wsdk.gui.GUI,d=g3wsdk.ol.interactions.PickFeatureInteraction;function a(){r(this,0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}n(a,e);n=a.prototype;n.run=function(t,e){var i=this,n=$.Deferred(),r=(u.setModal(!1),t.layer.getEditingLayer()),a=(this._originalLayerStyle=r.getStyle(),e.beforeRun),a=a&&"function"==typeof a?a():Promise.resolve(),o=e.excludeFeatures,s=e.style;return this._features=r.getSource().getFeatures(),o&&(this._features=this._features.filter(function(n){return Object.entries(o).reduce(function(e,t){var t=l(t,2),i=t[0],t=t[1];return e&&n.get(i)!=t},!0)})),s&&this._features.forEach(function(e){return e.setStyle(s)}),a.then(function(){i.pickFeatureInteraction=new d({layers:[r],features:i._features}),i.addInteraction(i.pickFeatureInteraction),i.pickFeatureInteraction.on("picked",function(e){e=e.feature;t.features.push(e),u.setModal(!0),n.resolve(t)})}).catch(function(e){return n.reject(e)}),n.promise()},n.stop=function(){var t=this;return u.setModal(!0),this.removeInteraction(this.pickFeatureInteraction),this._features.forEach(function(e){return e.setStyle(t._originalLayerStyle)}),this.pickFeatureInteraction=null,this._features=null,!(this._originalLayerStyle=null)},t.exports=a},{"./editingtask":92}],95:[function(e,t,i){function c(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}var n=g3wsdk.core.utils,r=n.base,n=n.inherit,f=g3wsdk.core.geoutils.dissolve,e=e("./editingtask"),g=g3wsdk.gui.GUI;function a(){r(this,0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}n(a,e);n=a.prototype;n.run=function(n,r){var t,a=this,o=$.Deferred(),e=n.layer,s=n.features,l=e.getEditingLayer().getSource(),u=e.getId(),d=r.session;return s.length<2?(g.showUserMessage({type:"warning",message:"plugins.editing.messages.select_min_2_features",autoclose:!0}),o.reject()):this.chooseFeatureFromFeatures({features:s}).then((t=c(function*(t){var e=s.findIndex(function(e){return t===e}),i=t.clone(),e=f({features:s,index:e});if(e){try{yield a.evaluateExpressionFields({inputs:n,context:r,feature:e})}catch(e){}d.pushUpdate(u,e,i),s.filter(function(e){return e!==t}).forEach(function(e){d.pushDelete(u,e),l.removeFeature(e)}),n.features=[t],o.resolve(n)}else g.showUserMessage({type:"warning",message:"plugins.editing.messages.no_feature_selected",autoclose:!0}),o.reject()}),function(e){return t.apply(this,arguments)})).catch(function(){o.reject()}),o.promise()},n.stop=function(){this.removeInteraction(this._pickInteraction)},t.exports=a},{"./editingtask":92}],96:[function(e,t,i){var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,n=arguments[t];for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},r=g3wsdk.core.utils,a=r.base,r=r.inherit,o=g3wsdk.ol.utils,s=o.createMeasureTooltip,l=o.removeMeasureTooltip;function u(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.drawInteraction=null,this._originalStyle=null,this._feature=null,this.tooltip,this._deleteCondition=e.deleteCondition,a(this,e)}r(u,e("./editingtask"));o=u.prototype;o.run=function(i,n){var r,a=this,o=$.Deferred(),e=i.layer,t=e.getEditingLayer(),s=n.session,l=e.getId(),u=void 0,e=this._feature=i.features[0],t=(this.deleteVertexKey,this._originalStyle=t.getStyle(),e.setStyle(function(){var e=new ol.style.Circle({radius:5,fill:null,stroke:new ol.style.Stroke({color:"orange",width:2})});return[new ol.style.Style({image:e,geometry:function(e){e=e.getGeometry().getCoordinates()[0];return new ol.geom.MultiPoint(e)}}),new ol.style.Style({stroke:new ol.style.Stroke({color:"yellow",width:4})})]}),new ol.Collection(i.features));return this._modifyInteraction=new ol.interaction.Modify({features:t,deleteCondition:this._deleteCondition}),this._modifyInteraction.on("modifystart",function(e){e=e.features.getArray()[0];u=e.clone()}),this.addInteraction(this._modifyInteraction),this._modifyInteraction.on("modifyend",function(e){var t=e.features.getArray()[0];t.getGeometry().getExtent()!==u.getGeometry().getExtent()&&a.evaluateExpressionFields({inputs:i,context:n,feature:t}).finally(function(){r=t.clone(),s.pushUpdate(l,r,u),i.features.push(r),o.resolve(i)})}),o.promise()},o.addMeasureInteraction=function(){var t=this,i=this.getMap();this._modifyInteraction.on("modifystart",function(e){e=e.features.getArray()[0];t.tooltip=s({map:i,feature:e})})},o.removeMeasureInteraction=function(){var e=this.getMap();this.tooltip&&l(n({map:e},this.tooltip)),this.tooltip=null},o.stop=function(){return this._feature.setStyle(this._originalStyle),this.removeInteraction(this._modifyInteraction),!0},t.exports=u},{"./editingtask":92}],97:[function(e,t,i){var _=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var i=t,n=[],r=!0,t=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!i||n.length!==i);r=!0);}catch(e){t=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(t)throw a}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},w=e("../../../utils/cloneFeature"),n=g3wsdk.core.utils,r=n.base;function a(){r(this,0<arguments.length&&void 0!==arguments[0]?arguments[0]:{})}(0,n.inherit)(a,e("./editingtask"));n=a.prototype;n.getDeltaXY=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.x,i=e.y,e=function e(t){return Array.isArray(t[0])?e(t[0]):{x:t[0],y:t[1]}}(e.coordinates);return{x:t-e.x,y:i-e.y}},n.run=function(u,d){var c=this,f=$.Deferred(),g=u.layer,p=u.features,h=u.coordinates,v=(this.setAndUnsetSelectedFeaturesStyle({promise:f}),g.getEditingLayer().getSource()),y=g.getId(),m=d.session;return this._snapIteraction=new ol.interaction.Snap({source:v,edge:!1}),this._drawInteraction=new ol.interaction.Draw({type:"Point",features:new ol.Collection}),this._drawInteraction.on("drawend",function(e){for(var e=e.feature.getGeometry().getCoordinates(),e=_(e,2),t=e[0],i=e[1],n=h?c.getDeltaXY({x:t,y:i,coordinates:h}):null,r=p.length,a=[],o=0;o<r;o++){var s=(0,w.cloneFeature)(p[o],g),l=(n?s.getGeometry().translate(n.x,n.y):(l=s.getGeometry().getCoordinates(),l=c.getDeltaXY({x:t,y:i,coordinates:l}),s.getGeometry().translate(l.x,l.y)),c.setNullMediaFields({feature:s,layer:g}),c.evaluateExpressionFields({inputs:u,context:d,feature:s}));a.push(l)}Promise.allSettled(a).then(function(e){e.forEach(function(e){e.status;var e=e.value,t=c.getNotEditableFieldsNoPkValues({layer:g,feature:e}),i=m.pushAdd(y,e);Object.entries(t).length&&Object.entries(t).forEach(function(e){var e=_(e,2),t=e[0],e=e[1];return i.set(t,e)}),v.addFeature(i),u.features.push(i)})}).finally(function(){c._steps.to.done=!0,f.resolve(u)})}),this.addInteraction(this._drawInteraction),this.addInteraction(this._snapIteraction),f.promise()},n.stop=function(){return this.removeInteraction(this._drawInteraction),this.removeInteraction(this._snapIteraction),this._drawInteraction=null,!(this._snapIteraction=null)},t.exports=a},{"../../../utils/cloneFeature":38,"./editingtask":92}],98:[function(e,t,i){var n=g3wsdk.core.utils,r=n.base;function a(e){this.drawInteraction=null,this.promise,r(this,e)}(0,n.inherit)(a,e("./editingtask"));n=a.prototype;n.run=function(i,n){var r=this,a=(this.promise=$.Deferred(),$.Deferred()),e=i.layer,o=n.session,s=e.getId(),e=new ol.Collection(i.features),l=null,u=(this.changeKey=null,!1);return this.setAndUnsetSelectedFeaturesStyle({promise:this.promise}),this._translateInteraction=new ol.interaction.Translate({features:e,hitTolerance:isMobile&&isMobile.any?10:0}),this.addInteraction(this._translateInteraction),this._translateInteraction.on("translatestart",function(e){e=e.features.getArray()[0];r.changeKey=e.once("change",function(){return u=!0}),l=e.clone()}),this._translateInteraction.on("translateend",function(e){ol.Observable.unByKey(r.changeKey);var t=e.features.getArray()[0];u?r.evaluateExpressionFields({inputs:i,context:n,feature:t}).finally(function(){var e=t.clone();o.pushUpdate(s,e,l),a.resolve(i)}):a.resolve(i)}),a.promise()},n.stop=function(){this.promise.resolve(),this.removeInteraction(this._translateInteraction),this._translateInteraction=null,this.changeKey=null},t.exports=a},{"./editingtask":92}],99:[function(e,t,i){var n=e("../../../components/SaveAll.vue"),l=(n=n)&&n.__esModule?n:{default:n};function r(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}var n=g3wsdk.core.utils,a=n.base,n=n.inherit,u=g3wsdk.gui.GUI,d=g3wsdk.core.workflow.WorkflowsStack,o=e("./editingtask"),c=e("../../../form/editingform"),s=e("../../edittableworkflow");function f(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.push,t=void 0!==t&&t,i=e.saveAll,i=void 0===i||i,n=e.multi,n=void 0!==n&&n,r=e.showgoback;this.showgoback=r,this.push=t,this._saveAll=i,this._multi=n,this._edit_relations=void 0===e.edit_relations||e._edit_relations,this._formIdPrefix="form_",this.layerId,this._isContentChild=!1,this._features,this._originalLayer,this._editingLayer,this._layerName,this._originalFeatures,this._fields,this._session,this._editorFormStructure,this.promise,this._unwatchs=[],a(this,e)}n(f,o);var g,p,e=(t.exports=f).prototype;e.updateMulti=function(){this._multi=0<arguments.length&&void 0!==arguments[0]&&arguments[0]},e._getForm=(g=r(function*(e,t){var i,n,r=this,a=(this._session=t.session,this._originalLayer=e.layer,this._editingLayer=this._originalLayer.getEditingLayer(),this._layerName=this._originalLayer.getName(),this._features=this._multi?e.features:[e.features[e.features.length-1]],this._originalFeatures=this._features.map(function(e){return e.clone()}),this._features[0]);return this._isContentChild&&(n=t.fatherValue,i=void 0===n?[]:n,(void 0===(n=t.fatherField)?[]:n).forEach(function(e,t){a.set(e,i[t]),r._originalFeatures[0].set(e,i[t])})),this._fields=yield this.getFormFields({inputs:e,context:t,feature:a,isChild:this._isContentChild}),this._fields=this._multi?this._fields.map(function(e){e=JSON.parse(JSON.stringify(e));return e.value=null,e.forceNull=!0,e.validate.required=!1,e}).filter(function(e){return!e.pk}):this._fields,this._originalLayer.hasFormStructure()&&(n=this._originalLayer.getEditorFormStructure(),this._editorFormStructure=n.length?n:null),u.showContentFactory("form")}),function(e,t){return g.apply(this,arguments)}),e.saveAll=function(a){var i,o=this;return new Promise((i=r(function*(e,t){var i,n=o.getContext().session,r=o.getInputs();(a=o._multi?a.filter(function(e){return null!==e.value}):a).length&&(yield d.getCurrent().getContextService().saveDefaultExpressionFieldsNotDependencies(),i=[],o._features.forEach(function(e){o._originalLayer.setFieldsWithValues(e,a),i.push(e.clone())}),o._isContentChild&&(r.relationFeatures={newFeatures:i,originalFeatures:o._originalFeatures}),o.fireEvent("saveform",{newFeatures:i,originalFeatures:o._originalFeatures}).then(function(){i.forEach(function(e,t){n.pushUpdate(o.layerId,e,o._originalFeatures[t])}),o.handleRelation1_1LayerFields({layerId:o.layerId,features:i,fields:a}).then(function(){o.fireEvent("savedfeature",i),o.fireEvent("savedfeature_"+o.layerId,i),n.save(),e({promise:o.promise})})}))}),function(e,t){return i.apply(this,arguments)}))},e._saveFeatures=(p=r(function*(e){var t,i=this,n=e.fields,r=e.promise,a=e.session,o=e.inputs;(n=this._multi?n.filter(function(e){return null!==e.value}):n).length?(t=[],u.setLoadingContent(!0),u.disableContent(!0),yield d.getCurrent().getContextService().saveDefaultExpressionFieldsNotDependencies(),u.setLoadingContent(!1),u.disableContent(!1),this._features.forEach(function(e){i._originalLayer.setFieldsWithValues(e,n),t.push(e.clone())}),this._isContentChild&&(o.relationFeatures={newFeatures:t,originalFeatures:this._originalFeatures}),this.fireEvent("saveform",{newFeatures:t,originalFeatures:this._originalFeatures}).then(function(){t.forEach(function(e,t){return a.pushUpdate(i.layerId,e,i._originalFeatures[t])}),i.handleRelation1_1LayerFields({layerId:i.layerId,features:t,fields:n}).then(function(){u.setModal(!1),i.fireEvent("savedfeature",t),i.fireEvent("savedfeature_"+i.layerId,t),i._isContentChild&&d.getParents().forEach(function(e){return e.getContextService().setUpdate(!0,{force:!0})}),r.resolve(o)})})):(u.setModal(!1),r.resolve(o))}),function(e){return p.apply(this,arguments)}),e.startForm=r(function*(){var t=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=(this.getEditingService().setCurrentLayout(),e.inputs),n=e.context,r=e.promise,a=n.session,e=e.formComponent||c,o=yield this._getForm(i,n),s=this._originalFeatures[0],o=(d.getCurrent().setInput({key:"fields",value:this._fields}),o({formComponent:e,title:"plugins.editing.editing_attributes",name:this._layerName,crumb:{title:this._layerName},id:this._generateFormId(this._layerName),dataid:this._layerName,layer:this._originalLayer,isnew:!(1<this._originalFeatures.length)&&s.isNew(),feature:s,parentData:this.getParentFormData(),fields:this._fields,context_inputs:!this._multi&&this._edit_relations&&{context:n,inputs:i},formStructure:this._editorFormStructure,modal:!0,push:this.push||this._isContentChild,showgoback:void 0!==this.showgoback?this.showgoback:!this._isContentChild,headerComponent:this._saveAll&&l.default,buttons:[{id:"save",title:this._isContentChild?d.getParent().getBackButtonLabel()||"plugins.editing.form.buttons.save_and_back":"plugins.editing.form.buttons.save",type:"save",class:"btn-success",cbk:function(e){t._saveFeatures({fields:e,promise:r,inputs:i,session:n.session})}},{id:"cancel",title:"plugins.editing.form.buttons.cancel",type:"cancel",class:"btn-danger",eventButtons:{update:{false:{id:"close",title:"close",type:"cancel",class:"btn-danger"}}},cbk:function(){t._isContentChild||(u.setModal(!1),t.fireEvent("cancelform",i.features)),r.reject(i)}}]})),e=(this.fireEvent("openform",{layerId:this.layerId,session:a,feature:this._originalFeature,formService:o}),d.getCurrent());e&&e.setContextService(o),this._unwatchs=yield this.listenRelation1_1FieldChange({layerId:this.layerId,fields:this._fields})}),e.run=function(e,t){var i=$.Deferred(),n=(this.promise=i,this._isContentChild=1<d.getLength(),e.layer),r=e.features;return this.layerId=n.getId(),u.setLoadingContent(!1),this.getEditingService().disableMapControlsConflict(!0),this.setAndUnsetSelectedFeaturesStyle({promise:i}),!this._multi&&Array.isArray(r[r.length-1])?i.resolve():(this.startForm({inputs:e,context:t,promise:i}),this.disableSidebar(!0)),i.promise()},e._generateFormId=function(e){return this._formIdPrefix+e},e.stop=function(){this.disableSidebar(!1);var e=this.getEditingService(),t=void 0;(!1===this._isContentChild||2===d.getLength()&&d.getParent()instanceof s)&&(e.disableMapControlsConflict(!1),t=d.getCurrent().getContextService()),t&&!this._isContentChild&&t.setUpdate(!1,{force:!1}),u.closeForm({pop:this.push||this._isContentChild}),e.resetCurrentLayout(),this.fireEvent("closeform"),this.fireEvent("closeform_"+this.layerId),this.layerId=null,this.promise=null,this._unwatchs.forEach(function(e){return e()}),this._unwatchs=[]}},{"../../../components/SaveAll.vue":8,"../../../form/editingform":26,"../../edittableworkflow":54,"./editingtask":92}],100:[function(e,t,i){var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i,n=arguments[t];for(i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])}return e},r=e("../../../components/Table.vue"),r=(r=r)&&r.__esModule?r:{default:r};function f(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=(s(this),t.service||new l(n({},t))),t=(this.setService(i),new u({service:i}));this.setInternalComponent(t),t.state=i.state,i.once("ready",function(){return e.emit("ready")}),this.unmount=function(){return i.cancel(),s(this,"unmount")}}var a=g3wsdk.core.utils,o=a.inherit,s=a.base,g=g3wsdk.core.workflow.WorkflowsStack,p=g3wsdk.gui.GUI,a=g3wsdk.gui.vue.Component,l=e("../../../services/tableservice"),e=e("./editingtask"),u=Vue.extend(r.default);function d(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this._formIdPrefix="form_",s(this,e)}o(f,a),o(d,e);r=d.prototype;r.run=function(e,t){var i,n=this,r=$.Deferred(),a=(this.getEditingService().setCurrentLayout(),e.layer),o=a.getName(),s=a.getEditingFields(),l=(this._isContentChild=1<g.getLength(),this._isContentChild&&t.excludeFields?t.excludeFields[0]:null),u=this._isContentChild&&t.exclude,d=a.getEditingCapabilities(),a=a.getEditingLayer().readEditingFeatures(),c=(u&&0<a.length&&(i=u.value,a=a.filter(function(e){return e.get(l)!=i})),new f({title:""+o,features:a,promise:r,push:this._isContentChild,headers:s,context:t,inputs:e,capabilities:d,fatherValue:t.fatherValue,foreignKey:l}));return p.disableSideBar(!0),p.showUserMessage({type:"loading",message:"plugins.editing.messages.loading_table_data",autoclose:!1,closable:!1}),setTimeout(function(){c.once("ready",function(){return setTimeout(function(){p.closeUserMessage()})}),p.showContent({content:c,push:n._isContentChild,showgoback:!1,closable:!1})},300),r.promise()},r._generateFormId=function(e){return""+this._formIdPrefix+e},r.stop=function(){this.disableSidebar(!1),p[this._isContentChild?"popContent":"closeContent"](),this.getEditingService().resetCurrentLayout()},t.exports=d},{"../../../components/Table.vue":10,"../../../services/tableservice":33,"./editingtask":92}],101:[function(e,t,i){var a=e("../../../interactions/pickfeaturesinteraction"),n=g3wsdk.core.utils,r=n.base;function o(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this._options={highlight:e.highlight||!1,multi:e.multi||!1},this.pickFeatureInteraction=null,this._busy=!1,this._tools=e.tools||[],r(this,e)}(0,n.inherit)(o,e("./editingtask"));n=o.prototype;n.run=function(i,e){var n=this,r=$.Deferred(),t=i.layer.getEditingLayer();return this.pickFeatureInteraction=new a.PickFeaturesInteraction({layer:t}),this.addInteraction(this.pickFeatureInteraction),this.pickFeatureInteraction.on("picked",function(e){var t=e.features,e=e.coordinate;0===i.features.length&&(i.features=t,i.coordinate=e),n.setAndUnsetSelectedFeaturesStyle({promise:r}),n._steps&&n.setUserMessageStepDone("select"),r.resolve(i)}),r.promise()},n.stop=function(){return this.removeInteraction(this.pickFeatureInteraction),!(this.pickFeatureInteraction=null)},t.exports=o},{"../../../interactions/pickfeaturesinteraction":29,"./editingtask":92}],102:[function(e,t,i){var u=e("../../../interactions/pickfeaturesinteraction");function d(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}var c=g3wsdk.ol.interactions.PickCoordinatesInteraction,f=g3wsdk.core.data.DataRouterService,g=g3wsdk.core.project.ProjectsRegistry,n=g3wsdk.core.utils,r=n.base,n=n.inherit,p=g3wsdk.gui.GUI;function a(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.copyLayer,i=e.external,n=e.isVector;this.copyLayer=t,this.external=i,this.isVector=n,this.pickInteraction=null,r(this,e)}n(a,e("./editingtask"));n=a.prototype;n.run=function(e,t){var i=$.Deferred();return this.copyLayer&&this.getFeaturesFromLayer({inputs:e,promise:i}),i.promise()},n.getFeaturesFromLayer=d(function*(){var i,a=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.inputs,o=e.promise,s=[],l=t.layer.getGeometryType();yield new Promise((i=d(function*(n,e){var r,t;a.isVector&&(a.external?(a.pickInteraction=new u.PickFeaturesInteraction({layer:a.copyLayer}),a.addInteraction(a.pickInteraction),a.pickInteraction.on("picked",function(e){e=e.features;s=a.convertFeaturesGeometryToGeometryTypeOfLayer({features:e,geometryType:l}),n()})):(a.pickInteraction=new c,a.addInteraction(a.pickInteraction),r=g.getCurrentProject(),a.pickInteraction.once("picked",(t=d(function*(e){e=e.coordinate;try{var t=(yield f.getData("query:coordinates",{inputs:{coordinates:e,query_point_tolerance:r.getQueryPointTolerance(),layerIds:[a.copyLayer.getId()],multilayers:!1},outputs:null})).data,i=void 0===t?[]:t;i.length&&(s=a.convertFeaturesGeometryToGeometryTypeOfLayer({features:i[0].features,geometryType:l}))}catch(e){o.reject(e)}finally{n()}}),function(e){return t.apply(this,arguments)}))))}),function(e,t){return i.apply(this,arguments)})),s.length?(t.features=s,o.resolve(t)):(p.showUserMessage({type:"warning",message:"plugins.editing.messages.no_feature_selected",closable:!1,autoclose:!0}),o.reject())}),n.stop=function(){return this.removeInteraction(this.pickInteraction),!(this.pickInteraction=null)},t.exports=a},{"../../../interactions/pickfeaturesinteraction":29,"./editingtask":92}],103:[function(e,t,i){var g=e("../../../interactions/pickfeaturesinteraction");function s(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}var u=g3wsdk.core.ApplicationState,n=g3wsdk.core.utils,r=n.base,n=n.inherit,a=g3wsdk.core.geoutils,p=a.isSameBaseGeometryType,h=a.convertSingleMultiGeometry,v=a.Geometry.removeZValueToOLFeatureGeometry,y=g3wsdk.core.layer.features.Feature;function o(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this._type=e.type||"bbox",this._selectInteractions=[],this.multipleselectfeatures=[],this._originalStyle,this._vectorLayer,r(this,e)}n(o,e("./editingtask"));a=o.prototype;a.addSingleSelectInteraction=function(){var t,i=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=e.layer,r=e.inputs,a=e.promise,e=e.buttonnext,o=void 0!==e&&e,e=new g.PickFeaturesInteraction({layer:n.getEditingLayer()});e.on("picked",(t=s(function*(e){var e=e.features,t=void 0;if(1<e.length)try{t=yield i.chooseFeatureFromFeatures({promise:a,features:e})}catch(e){}else t=e[0];t&&(r.features=e=[t],o?i.addRemoveToMultipleSelectFeatures([t],r):(i._originalStyle=i.setFeaturesSelectedStyle(e),i._steps&&i.setUserMessageStepDone("select"),a.resolve(r)))}),function(e){return t.apply(this,arguments)})),this._selectInteractions.push(e),this.addInteraction(e)},a.addExternalSelectInteraction=function(){var r=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},a=e.layer,o=e.inputs,s=e.context,l=e.promise,u=(e.buttonnext,a.getGeometryType()),d=a.getId(),c=a.getEditingLayer().getSource(),f=this.getContext().session,e=this.getMapService().getExternalLayers().filter(function(e){var t=!0;return"VECTOR"===e.getType()&&0<(e=e.getSource().getFeatures()).length&&(e=e[0].getGeometry().getType(),t=p(e,u)),t}),e=new g.PickFeaturesInteraction({layers:e});e.on("picked",function(t){var e,i,n;0<t.features.length?(e=a.getEditingFields(),(i=t.features[0].getGeometry()).getType()!==u&&t.feature.setGeometry(h(i,u)),n=new y({feature:t.feature,properties:e.map(function(e){return"media"!==e.input.type&&void 0!==t.feature.get(e.name)&&!e.pk||t.feature.set(e.name,null),e.name})}),r.evaluateExpressionFields({inputs:o,context:s,feature:n}).finally(function(){v({feature:n}),n.setTemporaryId(),c.addFeature(n),f.pushAdd(d,n,!1),o.features.push(n),l.resolve(o)})):l.reject()}),this._selectInteractions.push(e),this.addInteraction(e)},a.addRemoveToMultipleSelectFeatures=function(){var i=this,e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],n=arguments[1];e.forEach(function(e){var t=i.multipleselectfeatures.indexOf(e);t<0?(i._originalStyle=i.setFeaturesSelectedStyle([e]),i.multipleselectfeatures.push(e)):(i.multipleselectfeatures.splice(t,1),e.setStyle(i._originalStyle)),n.features=i.multipleselectfeatures}),this._steps.select.buttonnext.disabled=this._steps.select.buttonnext.condition?this._steps.select.buttonnext.condition({features:this.multipleselectfeatures}):0===this.multipleselectfeatures.length,void 0!==this._steps.select.dynamic&&(this._steps.select.dynamic=this.multipleselectfeatures.length)},a.addMultipleSelectInteraction=function(){var e,n=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},r=t.layer,a=t.inputs,o=t.promise,t=t.buttonnext,s=void 0!==t&&t,l=void 0;u.ismobile?(t=ol.interaction.Draw.createBox(),e=new ol.source.Vector({}),this._vectorLayer=new ol.layer.Vector({source:e}),this.getMap().addLayer(this._vectorLayer),(l=new ol.interaction.Draw({type:"Circle",source:e,geometryFunction:t})).on("drawend",function(e){e=e.feature.getGeometry().getExtent(),e=r.getEditingLayer().getSource().getFeaturesInExtent(e);s?n.addRemoveToMultipleSelectFeatures(e,a):0<e.length?(a.features=e,n._originalStyle=n.setFeaturesSelectedStyle(e),n._steps&&n.setUserMessageStepDone("select"),setTimeout(function(){o.resolve(a)},500)):o.reject()})):(l=new ol.interaction.DragBox({condition:ol.events.condition.shiftKeyOnly})).on("boxend",function(e){var t=[],i=l.getGeometry().getExtent();r.getEditingLayer().getSource().forEachFeatureIntersectingExtent(i,function(e){t.push(e)}),s?n.addRemoveToMultipleSelectFeatures(t,a):0<t.length?(a.features=t,n._originalStyle=n.setFeaturesSelectedStyle(t),n._steps&&n.setUserMessageStepDone("select"),o.resolve(a)):o.reject()}),this._selectInteractions.push(l),this.addInteraction(l)},a.run=function(e,t){var i=e.layer,n=$.Deferred();switch(this._type){case"single":this.addSingleSelectInteraction({layer:i,inputs:e,promise:n});break;case"multiple":var r=!!this._steps.select.buttonnext;r&&(this._steps.select.buttonnext.done=function(){n.resolve(e)}),this.addSingleSelectInteraction({layer:i,inputs:e,promise:n,buttonnext:r}),this.addMultipleSelectInteraction({layer:i,inputs:e,promise:n,buttonnext:r});break;case"bbox":this.addMultipleSelectInteraction({layer:i,inputs:e,promise:n});break;case"external":this.addExternalSelectInteraction({layer:i,inputs:e,context:t,promise:n})}return n.promise()},a.stop=function(){var t=this;this._selectInteractions.forEach(function(e){return t.removeInteraction(e)}),this._vectorLayer&&this.getMap().removeLayer(this._vectorLayer),this.getInputs().features.forEach(function(e){return e.setStyle(t._originalStyle)}),this._originalStyle=null,this._vectorLayer=null,this._selectInteractions=[],this.multipleselectfeatures=[]},t.exports=o},{"../../../interactions/pickfeaturesinteraction":29,"./editingtask":92}],104:[function(e,t,i){var v=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e)){var i=t,n=[],r=!0,t=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(n.push(o.value),!i||n.length!==i);r=!0);}catch(e){t=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(t)throw a}}return n}throw new TypeError("Invalid attempt to destructure non-iterable instance")},y=e("../../../utils/cloneFeature");function n(e){return function(){var s=e.apply(this,arguments);return new Promise(function(a,o){return function t(e,i){try{var n=s[e](i),r=n.value}catch(e){return void o(e)}if(!n.done)return Promise.resolve(r).then(function(e){t("next",e)},function(e){t("throw",e)});a(r)}("next")})}}var r=g3wsdk.core.utils,a=r.base,r=r.inherit,c=g3wsdk.core.geoutils.splitFeatures,m=g3wsdk.core.layer.features.Feature,f=g3wsdk.gui.GUI;function o(){a(this,0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}),this._stopPromise}r(o,e("./editingtask"));r=o.prototype;r.run=function(a,o){var t,s=this,l=(this._stopPromise=$.Deferred(),this.setAndUnsetSelectedFeaturesStyle({promise:this._stopPromise}),$.Deferred()),e=a.layer,u=a.features,e=e.getEditingLayer().getSource(),d=o.session;return this._snapIteraction=new ol.interaction.Snap({source:e,edge:!0}),this._drawInteraction=new ol.interaction.Draw({type:"LineString",features:new ol.Collection,freehandCondition:ol.events.condition.never}),this._drawInteraction.on("drawend",(t=n(function*(e){for(var e=e.feature,n=!1,r=c({splitfeature:e,features:u}),t=r.length,i=0;i<t;i++)yield*function*(e){var t,e=r[e],i=e.uid,e=e.geometries;1<e.length&&(n=!0,t=u.find(function(e){return e.getUid()===i}),yield s._handleSplitFeature({feature:t,context:o,splittedGeometries:e,inputs:a,session:d}))}(i);n?(f.showUserMessage({type:"success",message:"plugins.editing.messages.splitted",autoclose:!0}),l.resolve(a)):(f.showUserMessage({type:"warning",message:"plugins.editing.messages.nosplittedfeature",autoclose:!0}),l.reject())}),function(e){return t.apply(this,arguments)})),this.addInteraction(this._drawInteraction),this.addInteraction(this._snapIteraction),l.promise()},r._handleSplitFeature=n(function*(){for(var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=e.feature,i=e.inputs,n=e.context,e=e.splittedGeometries,r=void 0===e?[]:e,a=[],o=i.layer,s=n.session,l=o.getEditingLayer().getSource(),u=o.getId(),d=t.clone(),c=(i.features=r.length?[]:i.features,r.length),f=0;f<c;f++){var g=r[f];if(0===f){t.setGeometry(g);try{yield this.evaluateExpressionFields({inputs:i,context:n,feature:t})}catch(e){}s.pushUpdate(u,t,d)}else{var p=(0,y.cloneFeature)(d,o);p.setGeometry(g),this.setNullMediaFields({layer:o,feature:p}),(t=new m({feature:p})).setTemporaryId();try{yield this.evaluateExpressionFields({inputs:i,context:n,feature:t})}catch(e){}var h=this.getNotEditableFieldsNoPkValues({layer:o,feature:t});Object.entries(h).length?function(){var i=s.pushAdd(u,t);Object.entries(h).forEach(function(e){var e=v(e,2),t=e[0],e=e[1];return i.set(t,e)}),a.push(i),l.addFeature(i)}():(a.push(s.pushAdd(u,t)),l.addFeature(t))}i.features.push(t)}return a}),r.stop=function(){this.removeInteraction(this._drawInteraction),this.removeInteraction(this._snapIteraction),this._drawInteraction=null,this._snapIteraction=null,this._stopPromise.resolve(!0)},t.exports=o},{"../../../utils/cloneFeature":38,"./editingtask":92}]},{},[28]);
//# sourceMappingURL=../g3w-client/src/plugins/editing/plugin.js.map
